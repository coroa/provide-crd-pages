var wx=Object.defineProperty,Ex=Object.defineProperties;var Tx=Object.getOwnPropertyDescriptors;var q_=Object.getOwnPropertySymbols;var Ax=Object.prototype.hasOwnProperty,Sx=Object.prototype.propertyIsEnumerable;var Z_=(h,o,l)=>o in h?wx(h,o,{enumerable:!0,configurable:!0,writable:!0,value:l}):h[o]=l,Xi=(h,o)=>{for(var l in o||(o={}))Ax.call(o,l)&&Z_(h,l,o[l]);if(q_)for(var l of q_(o))Sx.call(o,l)&&Z_(h,l,o[l]);return h},Ur=(h,o)=>Ex(h,Tx(o));import{S as Jt,i as Qt,s as ei,I as co,C as Fi,e as He,k as bt,c as Ye,a as Ce,d as W,m as wt,b as H,J as Dt,V as Lr,g as Me,P as de,K as uo,L as ho,M as po,z as yn,q as Le,o as Xe,W as Rr,X as sc,N as xt,r as qp,D as Ip,u as Mx,Y as os,Z as cr,t as Oe,h as Fe,j as zt,_ as Oi,$ as ny,E as ti,G as $s,Q as kr,a0 as fi,a1 as di,w as ht,x as pt,y as ft,B as dt,l as Gi,n as br,p as wr,v as Zp,a2 as u1,a3 as $p,a4 as $_,U as Br,a5 as Ix,a6 as Cn,a7 as zn,a8 as h1,f as lr,a9 as Cp,A as Na,aa as Id,ab as kx,ac as Cx,ad as Vr,ae as W_,af as zx,O as X_,ag as Px,T as Dx}from"../../chunks/index-08858dcd.js";import{d as H_,w as kn}from"../../chunks/index-57b0d6bc.js";import{q as Lx,i as oy,g as ja}from"../../chunks/get-dc35f30d.js";import{f as Rx,g as kd,h as Bx,i as Ox,j as ac,k as Ru,m as $a,e as Bu,n as p1,o as Wa,E as Fx,p as Ux,C as Cd,q as sy,A as ay,r as Ou,D as zd,s as Y_,t as K_,M as Vx,P as Nx,H as jx,u as Gx,v as qx,w as ly,x as Zx,y as wp,z as $x,B as Wx,F as Xx,d as Pd,J as J_,G as Hx,a as Yx,K as Kx,I as Jx,L as Qx,N as e3,S as t3}from"../../chunks/store-d40713cf.js";import{f as i3,a as Hr,S as Wp,l as zp,L as Xp,d as Fu,u as r3,b as Dd,c as Hp,e as Yp,A as cy,g as uy,h as Ld,i as n3,M as o3}from"../../chunks/LineTimeSeries-e2264e2a.js";import{o as s3,r as a3,l as hy}from"../../chunks/ordinal-404f5655.js";import{a as l3}from"../../chunks/init-7803c2a3.js";import{b as c3,s as f1}from"../../chunks/sortBy-6d8c0258.js";import{m as py,j as u3}from"../../chunks/_baseMap-5b96295c.js";import"../../chunks/theme-store-7b033aac.js";import"../../chunks/_arrayReduce-379e7792.js";import"../../chunks/utils-3952ae38.js";import"../../chunks/singletons-d1fb5791.js";function h3(h,o){let l,u;if(o===void 0)for(const d of h)d!=null&&(l===void 0?d>=d&&(l=u=d):(l>d&&(l=d),u<d&&(u=d)));else{let d=-1;for(let g of h)(g=o(g,++d,h))!=null&&(l===void 0?g>=g&&(l=u=g):(l>g&&(l=g),u<g&&(u=g)))}return[l,u]}class Ga{constructor(){this._partials=new Float64Array(32),this._n=0}add(o){const l=this._partials;let u=0;for(let d=0;d<this._n&&d<32;d++){const g=l[d],y=o+g,n=Math.abs(o)<Math.abs(g)?o-(y-g):g-(y-o);n&&(l[u++]=n),o=y}return l[u]=o,this._n=u+1,this}valueOf(){const o=this._partials;let l=this._n,u,d,g,y=0;if(l>0){for(y=o[--l];l>0&&(u=y,d=o[--l],y=u+d,g=d-(y-u),!g););l>0&&(g<0&&o[l-1]<0||g>0&&o[l-1]>0)&&(d=g*2,u=y+d,d==u-y&&(y=u))}return y}}function fy(h,o){let l;if(o===void 0)for(const u of h)u!=null&&(l<u||l===void 0&&u>=u)&&(l=u);else{let u=-1;for(let d of h)(d=o(d,++u,h))!=null&&(l<d||l===void 0&&d>=d)&&(l=d)}return l}function p3(h,o){let l;if(o===void 0)for(const u of h)u!=null&&(l>u||l===void 0&&u>=u)&&(l=u);else{let u=-1;for(let d of h)(d=o(d,++u,h))!=null&&(l>d||l===void 0&&d>=d)&&(l=d)}return l}function*f3(h){for(const o of h)yield*o}function dy(h){return Array.from(f3(h))}function d3(h,o,l){h=+h,o=+o,l=(d=arguments.length)<2?(o=h,h=0,1):d<3?1:+l;for(var u=-1,d=Math.max(0,Math.ceil((o-h)/l))|0,g=new Array(d);++u<d;)g[u]=h+u*l;return g}function my(){var h=s3().unknown(void 0),o=h.domain,l=h.range,u=0,d=1,g,y,n=!1,w=0,T=0,M=.5;delete h.unknown;function I(){var P=o().length,z=d<u,R=z?d:u,F=z?u:d;g=(F-R)/Math.max(1,P-w+T*2),n&&(g=Math.floor(g)),R+=(F-R-g*(P-w))*M,y=g*(1-w),n&&(R=Math.round(R),y=Math.round(y));var q=d3(P).map(function(ae){return R+g*ae});return l(z?q.reverse():q)}return h.domain=function(P){return arguments.length?(o(P),I()):o()},h.range=function(P){return arguments.length?([u,d]=P,u=+u,d=+d,I()):[u,d]},h.rangeRound=function(P){return[u,d]=P,u=+u,d=+d,n=!0,I()},h.bandwidth=function(){return y},h.step=function(){return g},h.round=function(P){return arguments.length?(n=!!P,I()):n},h.padding=function(P){return arguments.length?(w=Math.min(1,T=+P),I()):w},h.paddingInner=function(P){return arguments.length?(w=Math.min(1,P),I()):w},h.paddingOuter=function(P){return arguments.length?(T=+P,I()):T},h.align=function(P){return arguments.length?(M=Math.max(0,Math.min(1,P)),I()):M},h.copy=function(){return my(o(),[u,d]).round(n).paddingInner(w).paddingOuter(T).align(M)},l3.apply(I(),arguments)}function m3(h){var o=h==null?0:h.length;return o?c3(h,1):[]}function _3(h,o){return h>o}function g3(h,o){return h<o}function _y(h,o,l){for(var u=-1,d=h.length;++u<d;){var g=h[u],y=o(g);if(y!=null&&(n===void 0?y===y&&!Lx(y):l(y,n)))var n=y,w=g}return w}function Q_(h){return h&&h.length?_y(h,py,_3):void 0}function eg(h){return h&&h.length?_y(h,py,g3):void 0}var y3=u3(function(h,o,l){h[l?0:1].push(o)},function(){return[[],[]]}),v3=y3,x3=Array.prototype,b3=x3.reverse;function w3(h){return h==null?h:b3.call(h)}const E3=h=>({}),tg=h=>({});function T3(h){let o,l,u,d,g;const y=h[14].default,n=co(y,h,h[13],null);let w=[h[5],{role:"navigation"},{class:u=`tabs-type-${h[0]}`}],T={};for(let P=0;P<w.length;P+=1)T=Fi(T,w[P]);const M=h[14].content,I=co(M,h,h[13],tg);return{c(){o=He("div"),l=He("ul"),n&&n.c(),d=bt(),I&&I.c(),this.h()},l(P){o=Ye(P,"DIV",{role:!0,class:!0});var z=Ce(o);l=Ye(z,"UL",{role:!0,class:!0});var R=Ce(l);n&&n.l(R),R.forEach(W),z.forEach(W),d=wt(P),I&&I.l(P),this.h()},h(){H(l,"role","tablist"),H(l,"class","svelte-1tzkkb5"),Dt(l,"tabs__nav",!0),Lr(o,T),Dt(o,"tabs",!0),Dt(o,"svelte-1tzkkb5",!0)},m(P,z){Me(P,o,z),de(o,l),n&&n.m(l,null),h[15](l),Me(P,d,z),I&&I.m(P,z),g=!0},p(P,[z]){n&&n.p&&(!g||z&8192)&&uo(n,y,P,P[13],g?po(y,P[13],z,null):ho(P[13]),null),Lr(o,T=yn(w,[z&32&&P[5],{role:"navigation"},(!g||z&1&&u!==(u=`tabs-type-${P[0]}`))&&{class:u}])),Dt(o,"tabs",!0),Dt(o,"svelte-1tzkkb5",!0),I&&I.p&&(!g||z&8192)&&uo(I,M,P,P[13],g?po(M,P[13],z,E3):ho(P[13]),tg)},i(P){g||(Le(n,P),Le(I,P),g=!0)},o(P){Xe(n,P),Xe(I,P),g=!1},d(P){P&&W(o),n&&n.d(P),h[15](null),P&&W(d),I&&I.d(P)}}}function A3(h,o,l){let u,d;const g=["type","format","selected"];let y=Rr(o,g),n,w,T,{$$slots:M={},$$scope:I}=o,{type:P="list"}=o,{format:z=void 0}=o,{selected:R=0}=o;const F=sc(),q=kn([]);xt(h,q,Pe=>l(12,w=Pe));const ae=H_(q,Pe=>Pe.reduce((Ge,Qe)=>Ur(Xi({},Ge),{[Qe.id]:Qe}),{}));xt(h,ae,Pe=>l(17,T=Pe));const se=kn(void 0),ie=kn([]);xt(h,ie,Pe=>l(11,n=Pe));const Q=H_(ie,Pe=>Pe.reduce((Ge,Qe)=>Ur(Xi({},Ge),{[Qe.id]:Qe}),{})),re=kn(void 0);let Ae=null;qp("Tabs",{type:P,format:z,tabs:q,contentById:Q,selectedTab:se,selectedContent:re,add:Pe=>{q.update(Ge=>[...Ge,Ur(Xi({},Pe),{index:Ge.length})])},addContent:Pe=>{ie.update(Ge=>[...Ge,Ur(Xi({},Pe),{index:Ge.length})])},update:Pe=>{l(8,$e=T[Pe].index)},change:async Pe=>{let Ge=$e+Pe;Ge<0?Ge=w.length-1:Ge>=w.length&&(Ge=0);let Qe=w[Ge].disabled;for(;Qe;)Ge=Ge+Pe,Ge<0?Ge=w.length-1:Ge>=w.length&&(Ge=0),Qe=w[Ge].disabled;l(8,$e=Ge),await Ip();const Rt=Ae==null?void 0:Ae.querySelectorAll("[role='tab']")[$e];Rt==null||Rt.focus()}}),Mx(()=>{l(6,R=$e),Je>-1&&Je!==$e&&F("change",$e),Je=$e});let $e=R,Je=-1;function ze(Pe){cr[Pe?"unshift":"push"](()=>{Ae=Pe,l(1,Ae)})}return h.$$set=Pe=>{o=Fi(Fi({},o),os(Pe)),l(5,y=Rr(o,g)),"type"in Pe&&l(0,P=Pe.type),"format"in Pe&&l(7,z=Pe.format),"selected"in Pe&&l(6,R=Pe.selected),"$$scope"in Pe&&l(13,I=Pe.$$scope)},h.$$.update=()=>{h.$$.dirty&64&&l(8,$e=R),h.$$.dirty&4352&&l(10,u=w[$e]||void 0),h.$$.dirty&2304&&l(9,d=n[$e]||void 0),h.$$.dirty&1536&&(u&&se.set(u.id),d&&re.set(d.id))},[P,Ae,q,ae,ie,y,R,z,$e,d,u,n,w,I,M,ze]}class Uu extends Jt{constructor(o){super(),Qt(this,o,A3,T3,ei,{type:0,format:7,selected:6})}}function ig(h){let o,l;return{c(){o=He("i"),l=Oe(h[1]),this.h()},l(u){o=Ye(u,"I",{class:!0});var d=Ce(o);l=Fe(d,h[1]),d.forEach(W),this.h()},h(){H(o,"class","emoji")},m(u,d){Me(u,o,d),de(o,l)},p(u,d){d&2&&zt(l,u[1])},d(u){u&&W(o)}}}function S3(h){let o,l,u,d,g,y,n,w,T,M,I,P=h[1]&&ig(h),z=[{tabindex:"-1"},{role:"presentation"},{class:n=`tab-type-${h[11]}`},{"aria-selected":h[7]},{"aria-disabled":h[4]},{"aria-current":w=h[7]?h[2]:"false"},{title:T=h[4]?"Not yet available":h[3]},h[13]],R={};for(let F=0;F<z.length;F+=1)R=Fi(R,z[F]);return{c(){o=He("li"),l=He("div"),P&&P.c(),u=bt(),d=He("span"),g=Oe(h[3]),this.h()},l(F){o=Ye(F,"LI",{tabindex:!0,role:!0,class:!0,"aria-selected":!0,"aria-disabled":!0,"aria-current":!0,title:!0});var q=Ce(o);l=Ye(q,"DIV",{role:!0,tabindex:!0,"aria-selected":!0,"aria-disabled":!0,id:!0,class:!0});var ae=Ce(l);P&&P.l(ae),u=wt(ae),d=Ye(ae,"SPAN",{class:!0});var se=Ce(d);g=Fe(se,h[3]),se.forEach(W),ae.forEach(W),q.forEach(W),this.h()},h(){H(d,"class","title svelte-2tqfj4"),H(l,"role","tab"),H(l,"tabindex",y=h[4]?"-1":h[5]),H(l,"aria-selected",h[7]),H(l,"aria-disabled",h[4]),H(l,"id",h[6]),H(l,"class","svelte-2tqfj4"),Dt(l,"link",!0),Lr(o,R),Dt(o,"tab",!0),Dt(o,"tab--compact",h[12]==="compact"),Dt(o,"active",h[7]),Dt(o,"svelte-2tqfj4",!0)},m(F,q){Me(F,o,q),de(o,l),P&&P.m(l,null),de(l,u),de(l,d),de(d,g),h[15](l),M||(I=[Oi(o,"click",ny(h[16])),Oi(o,"keydown",h[17])],M=!0)},p(F,[q]){F[1]?P?P.p(F,q):(P=ig(F),P.c(),P.m(l,u)):P&&(P.d(1),P=null),q&8&&zt(g,F[3]),q&48&&y!==(y=F[4]?"-1":F[5])&&H(l,"tabindex",y),q&128&&H(l,"aria-selected",F[7]),q&16&&H(l,"aria-disabled",F[4]),q&64&&H(l,"id",F[6]),Lr(o,R=yn(z,[{tabindex:"-1"},{role:"presentation"},{class:n},q&128&&{"aria-selected":F[7]},q&16&&{"aria-disabled":F[4]},q&132&&w!==(w=F[7]?F[2]:"false")&&{"aria-current":w},q&24&&T!==(T=F[4]?"Not yet available":F[3])&&{title:T},q&8192&&F[13]])),Dt(o,"tab",!0),Dt(o,"tab--compact",F[12]==="compact"),Dt(o,"active",F[7]),Dt(o,"svelte-2tqfj4",!0)},i:ti,o:ti,d(F){F&&W(o),P&&P.d(),h[15](null),M=!1,$s(I)}}}function M3(h,o,l){let u;const d=["icon","loc","label","disabled","tabindex","id","ref"];let g=Rr(o,d),y,{icon:n=""}=o,{loc:w="step"}=o,{label:T=""}=o,{disabled:M=!1}=o,{tabindex:I="0"}=o,{id:P="ccs-"+Math.random().toString(36)}=o,{ref:z=null}=o;const{selectedTab:R,add:F,update:q,change:ae,type:se,format:ie}=kr("Tabs");xt(h,R,$e=>l(14,y=$e)),F({id:P,label:T,disabled:M});function Q($e){cr[$e?"unshift":"push"](()=>{z=$e,l(0,z)})}const re=()=>{M||q(P)},Ae=({key:$e})=>{M||($e==="ArrowRight"||$e==="ArrowBottom"?ae(1):$e==="ArrowLeft"||$e==="ArrowTop"?ae(-1):($e===" "||$e==="Enter")&&q(P))};return h.$$set=$e=>{o=Fi(Fi({},o),os($e)),l(13,g=Rr(o,d)),"icon"in $e&&l(1,n=$e.icon),"loc"in $e&&l(2,w=$e.loc),"label"in $e&&l(3,T=$e.label),"disabled"in $e&&l(4,M=$e.disabled),"tabindex"in $e&&l(5,I=$e.tabindex),"id"in $e&&l(6,P=$e.id),"ref"in $e&&l(0,z=$e.ref)},h.$$.update=()=>{h.$$.dirty&16448&&l(7,u=y===P)},[z,n,w,T,M,I,P,u,R,q,ae,se,ie,g,y,Q,re,Ae]}class Gs extends Jt{constructor(o){super(),Qt(this,o,M3,S3,ei,{icon:1,loc:2,label:3,disabled:4,tabindex:5,id:6,ref:0})}}function I3(h){let o,l,u,d,g,y;return{c(){o=fi("svg"),l=fi("path"),u=fi("path"),g=fi("path"),this.h()},l(n){o=di(n,"svg",{xmlns:!0,class:!0,width:!0,height:!0,viewBox:!0,"stroke-width":!0,stroke:!0,fill:!0,"stroke-linecap":!0,"stroke-linejoin":!0});var w=Ce(o);l=di(w,"path",{stroke:!0,d:!0,fill:!0,class:!0}),Ce(l).forEach(W),u=di(w,"path",{d:!0,transform:!0,class:!0}),Ce(u).forEach(W),g=di(w,"path",{d:!0,transform:!0,class:!0}),Ce(g).forEach(W),w.forEach(W),this.h()},h(){H(l,"stroke","none"),H(l,"d","M0 0h24v24H0z"),H(l,"fill","none"),H(l,"class","svelte-f5yip7"),H(u,"d","M9 10l3 -3l3 3"),H(u,"transform",d=`translate(0 ${h[0]?-3:0})`),H(u,"class","svelte-f5yip7"),H(g,"d","M9 14l3 3l3 -3"),H(g,"transform",y=`translate(0 ${h[0]?3:0})`),H(g,"class","svelte-f5yip7"),H(o,"xmlns","http://www.w3.org/2000/svg"),H(o,"class","accordion svelte-f5yip7"),H(o,"width","24"),H(o,"height","24"),H(o,"viewBox","0 0 24 24"),H(o,"stroke-width","2"),H(o,"stroke","currentColor"),H(o,"fill","none"),H(o,"stroke-linecap","round"),H(o,"stroke-linejoin","round"),Dt(o,"isOpen",h[0])},m(n,w){Me(n,o,w),de(o,l),de(o,u),de(o,g)},p(n,[w]){w&1&&d!==(d=`translate(0 ${n[0]?-3:0})`)&&H(u,"transform",d),w&1&&y!==(y=`translate(0 ${n[0]?3:0})`)&&H(g,"transform",y),w&1&&Dt(o,"isOpen",n[0])},i:ti,o:ti,d(n){n&&W(o)}}}function k3(h,o,l){let{isOpen:u}=o;return h.$$set=d=>{"isOpen"in d&&l(0,u=d.isOpen)},[u]}class C3 extends Jt{constructor(o){super(),Qt(this,o,k3,I3,ei,{isOpen:0})}}function rg(h){let o,l;return{c(){o=He("label"),l=Oe(h[2]),this.h()},l(u){o=Ye(u,"LABEL",{class:!0,for:!0});var d=Ce(o);l=Fe(d,h[2]),d.forEach(W),this.h()},h(){H(o,"class","text-label svelte-824phq"),H(o,"for",h[5])},m(u,d){Me(u,o,d),de(o,l)},p(u,d){d&4&&zt(l,u[2]),d&32&&H(o,"for",u[5])},d(u){u&&W(o)}}}function ng(h){let o,l,u,d,g;return{c(){o=He("small"),l=Oe("+"),u=Oe(h[6]),d=Oe(" more"),this.h()},l(y){o=Ye(y,"SMALL",{title:!0,class:!0});var n=Ce(o);l=Fe(n,"+"),u=Fe(n,h[6]),d=Fe(n," more"),n.forEach(W),this.h()},h(){H(o,"title",g=h[8].join(" and ")),H(o,"class","svelte-824phq")},m(y,n){Me(y,o,n),de(o,l),de(o,u),de(o,d)},p(y,n){n&64&&zt(u,y[6]),n&256&&g!==(g=y[8].join(" and "))&&H(o,"title",g)},d(y){y&&W(o)}}}function z3(h){let o,l,u,d,g,y,n,w,T,M,I,P,z,R=h[2]&&rg(h),F=h[6]&&ng(h);w=new C3({props:{isOpen:h[10]}});let q=[{tabindex:"-1"},{role:"presentation"},{"aria-selected":h[10]},{"aria-disabled":h[3]},{"aria-current":M=h[10]?h[1]:"false"},h[14]],ae={};for(let se=0;se<q.length;se+=1)ae=Fi(ae,q[se]);return{c(){o=He("li"),R&&R.c(),l=bt(),u=He("span"),d=He("strong"),g=Oe(h[9]),y=bt(),F&&F.c(),n=bt(),ht(w.$$.fragment),this.h()},l(se){o=Ye(se,"LI",{tabindex:!0,role:!0,"aria-selected":!0,"aria-disabled":!0,"aria-current":!0});var ie=Ce(o);R&&R.l(ie),l=wt(ie),u=Ye(ie,"SPAN",{role:!0,tabindex:!0,"aria-selected":!0,"aria-disabled":!0,id:!0,class:!0});var Q=Ce(u);d=Ye(Q,"STRONG",{class:!0});var re=Ce(d);g=Fe(re,h[9]),re.forEach(W),y=wt(Q),F&&F.l(Q),n=wt(Q),pt(w.$$.fragment,Q),Q.forEach(W),ie.forEach(W),this.h()},h(){H(d,"class","svelte-824phq"),H(u,"role","tab"),H(u,"tabindex",T=h[3]?"-1":h[4]),H(u,"aria-selected",h[10]),H(u,"aria-disabled",h[3]),H(u,"id",h[5]),H(u,"class","svelte-824phq"),Dt(u,"tabs-link",!0),Dt(u,"tabs--missing",h[7]),Dt(u,"hasMoreItems",h[6]),Lr(o,ae),Dt(o,"tab",!0),Dt(o,"svelte-824phq",!0)},m(se,ie){Me(se,o,ie),R&&R.m(o,null),de(o,l),de(o,u),de(u,d),de(d,g),de(u,y),F&&F.m(u,null),de(u,n),ft(w,u,null),h[19](u),I=!0,P||(z=[Oi(o,"click",ny(h[20])),Oi(o,"keydown",h[21])],P=!0)},p(se,[ie]){se[2]?R?R.p(se,ie):(R=rg(se),R.c(),R.m(o,l)):R&&(R.d(1),R=null),(!I||ie&512)&&zt(g,se[9]),se[6]?F?F.p(se,ie):(F=ng(se),F.c(),F.m(u,n)):F&&(F.d(1),F=null);const Q={};ie&1024&&(Q.isOpen=se[10]),w.$set(Q),(!I||ie&24&&T!==(T=se[3]?"-1":se[4]))&&H(u,"tabindex",T),(!I||ie&1024)&&H(u,"aria-selected",se[10]),(!I||ie&8)&&H(u,"aria-disabled",se[3]),(!I||ie&32)&&H(u,"id",se[5]),ie&128&&Dt(u,"tabs--missing",se[7]),ie&64&&Dt(u,"hasMoreItems",se[6]),Lr(o,ae=yn(q,[{tabindex:"-1"},{role:"presentation"},(!I||ie&1024)&&{"aria-selected":se[10]},(!I||ie&8)&&{"aria-disabled":se[3]},(!I||ie&1026&&M!==(M=se[10]?se[1]:"false"))&&{"aria-current":M},ie&16384&&se[14]])),Dt(o,"tab",!0),Dt(o,"svelte-824phq",!0)},i(se){I||(Le(w.$$.fragment,se),I=!0)},o(se){Xe(w.$$.fragment,se),I=!1},d(se){se&&W(o),R&&R.d(),F&&F.d(),dt(w),h[19](null),P=!1,$s(z)}}}function P3(h,o,l){let u,d,g,y,n,w;const T=["loc","label","selectedValues","missingValue","disabled","tabindex","id","ref"];let M=Rr(o,T),I,{loc:P="step"}=o,{label:z=""}=o,{selectedValues:R=null}=o,{missingValue:F="Select a value"}=o,{disabled:q=!1}=o,{tabindex:ae="0"}=o,{id:se="ccs-"+Math.random().toString(36)}=o,{ref:ie=null}=o;const{selectedTab:Q,useAutoWidth:re,add:Ae,update:$e,change:Je}=kr("Tabs");xt(h,Q,Qe=>l(18,I=Qe)),Ae({id:se,label:z,disabled:q});function ze(Qe){cr[Qe?"unshift":"push"](()=>{ie=Qe,l(0,ie)})}const Pe=()=>{q||$e(se)},Ge=({key:Qe})=>{q||(Qe==="ArrowRight"?Je(1):Qe==="ArrowLeft"?Je(-1):(Qe===" "||Qe==="Enter")&&$e(se))};return h.$$set=Qe=>{o=Fi(Fi({},o),os(Qe)),l(14,M=Rr(o,T)),"loc"in Qe&&l(1,P=Qe.loc),"label"in Qe&&l(2,z=Qe.label),"selectedValues"in Qe&&l(15,R=Qe.selectedValues),"missingValue"in Qe&&l(16,F=Qe.missingValue),"disabled"in Qe&&l(3,q=Qe.disabled),"tabindex"in Qe&&l(4,ae=Qe.tabindex),"id"in Qe&&l(5,se=Qe.id),"ref"in Qe&&l(0,ie=Qe.ref)},h.$$.update=()=>{h.$$.dirty&262176&&l(10,u=I===se),h.$$.dirty&32768&&l(17,d=oy(R)),h.$$.dirty&163840&&l(7,g=d?R.length===0:!Boolean(R)),h.$$.dirty&229376&&l(9,y=(d?R[0]:R)||F),h.$$.dirty&163968&&l(6,n=d&&!g?R.length-1:0),h.$$.dirty&32832&&l(8,w=n>0?R.slice(1):[])},[ie,P,z,q,ae,se,n,g,w,y,u,Q,$e,Je,M,R,F,d,I,ze,Pe,Ge]}class bd extends Jt{constructor(o){super(),Qt(this,o,P3,z3,ei,{loc:1,label:2,selectedValues:15,missingValue:16,disabled:3,tabindex:4,id:5,ref:0})}}function D3(h){let o,l,u,d;const g=h[6].default,y=co(g,h,h[5],null);let n=[{role:"tabpanel"},{"aria-hidden":l=!h[1]},{hidden:u=h[1]?void 0:""},{id:h[0]},h[3]],w={};for(let T=0;T<n.length;T+=1)w=Fi(w,n[T]);return{c(){o=He("div"),y&&y.c(),this.h()},l(T){o=Ye(T,"DIV",{role:!0,"aria-hidden":!0,id:!0});var M=Ce(o);y&&y.l(M),M.forEach(W),this.h()},h(){Lr(o,w),Dt(o,"bx--tab-content",!0)},m(T,M){Me(T,o,M),y&&y.m(o,null),d=!0},p(T,[M]){y&&y.p&&(!d||M&32)&&uo(y,g,T,T[5],d?po(g,T[5],M,null):ho(T[5]),null),Lr(o,w=yn(n,[{role:"tabpanel"},(!d||M&2&&l!==(l=!T[1]))&&{"aria-hidden":l},(!d||M&2&&u!==(u=T[1]?void 0:""))&&{hidden:u},(!d||M&1)&&{id:T[0]},M&8&&T[3]])),Dt(o,"bx--tab-content",!0)},i(T){d||(Le(y,T),d=!0)},o(T){Xe(y,T),d=!1},d(T){T&&W(o),y&&y.d(T)}}}function L3(h,o,l){let u;const d=["id"];let g=Rr(o,d),y,{$$slots:n={},$$scope:w}=o,{id:T="ccs-"+Math.random().toString(36)}=o;const{selectedContent:M,addContent:I,tabs:P,contentById:z}=kr("Tabs");return xt(h,M,R=>l(4,y=R)),I({id:T}),h.$$set=R=>{o=Fi(Fi({},o),os(R)),l(3,g=Rr(o,d)),"id"in R&&l(0,T=R.id),"$$scope"in R&&l(5,w=R.$$scope)},h.$$.update=()=>{h.$$.dirty&17&&l(1,u=y===T)},[T,u,M,g,y,w,n]}class ao extends Jt{constructor(o){super(),Qt(this,o,L3,D3,ei,{id:0})}}var gy={exports:{}};(function(h,o){(function(l,u){h.exports=u()})(Rx,function(){var l,u,d;function g(n,w){if(!l)l=w;else if(!u)u=w;else{var T="self.onerror = function() { console.error('An error occurred while parsing the WebWorker bundle. This is most likely due to improper transpilation by Babel; please see https://docs.mapbox.com/mapbox-gl-js/guides/install/#transpiling'); }; var sharedChunk = {}; ("+l+")(sharedChunk); ("+u+")(sharedChunk); self.onerror = null;",M={};l(M),d=w(M),typeof window!="undefined"&&window&&window.URL&&window.URL.createObjectURL&&(d.workerUrl=window.URL.createObjectURL(new Blob([T],{type:"text/javascript"})))}}g(["exports"],function(n){var w=typeof self!="undefined"?self:{},T=M;function M(i,e,r,s){this.cx=3*i,this.bx=3*(r-i)-this.cx,this.ax=1-this.cx-this.bx,this.cy=3*e,this.by=3*(s-e)-this.cy,this.ay=1-this.cy-this.by,this.p1x=i,this.p1y=s,this.p2x=r,this.p2y=s}M.prototype.sampleCurveX=function(i){return((this.ax*i+this.bx)*i+this.cx)*i},M.prototype.sampleCurveY=function(i){return((this.ay*i+this.by)*i+this.cy)*i},M.prototype.sampleCurveDerivativeX=function(i){return(3*this.ax*i+2*this.bx)*i+this.cx},M.prototype.solveCurveX=function(i,e){var r,s,c,f,_;for(e===void 0&&(e=1e-6),c=i,_=0;_<8;_++){if(f=this.sampleCurveX(c)-i,Math.abs(f)<e)return c;var x=this.sampleCurveDerivativeX(c);if(Math.abs(x)<1e-6)break;c-=f/x}if((c=i)<(r=0))return r;if(c>(s=1))return s;for(;r<s;){if(f=this.sampleCurveX(c),Math.abs(f-i)<e)return c;i>f?r=c:s=c,c=.5*(s-r)+r}return c},M.prototype.solve=function(i,e){return this.sampleCurveY(this.solveCurveX(i,e))};var I=P;function P(i,e){this.x=i,this.y=e}P.prototype={clone:function(){return new P(this.x,this.y)},add:function(i){return this.clone()._add(i)},sub:function(i){return this.clone()._sub(i)},multByPoint:function(i){return this.clone()._multByPoint(i)},divByPoint:function(i){return this.clone()._divByPoint(i)},mult:function(i){return this.clone()._mult(i)},div:function(i){return this.clone()._div(i)},rotate:function(i){return this.clone()._rotate(i)},rotateAround:function(i,e){return this.clone()._rotateAround(i,e)},matMult:function(i){return this.clone()._matMult(i)},unit:function(){return this.clone()._unit()},perp:function(){return this.clone()._perp()},round:function(){return this.clone()._round()},mag:function(){return Math.sqrt(this.x*this.x+this.y*this.y)},equals:function(i){return this.x===i.x&&this.y===i.y},dist:function(i){return Math.sqrt(this.distSqr(i))},distSqr:function(i){var e=i.x-this.x,r=i.y-this.y;return e*e+r*r},angle:function(){return Math.atan2(this.y,this.x)},angleTo:function(i){return Math.atan2(this.y-i.y,this.x-i.x)},angleWith:function(i){return this.angleWithSep(i.x,i.y)},angleWithSep:function(i,e){return Math.atan2(this.x*e-this.y*i,this.x*i+this.y*e)},_matMult:function(i){var e=i[2]*this.x+i[3]*this.y;return this.x=i[0]*this.x+i[1]*this.y,this.y=e,this},_add:function(i){return this.x+=i.x,this.y+=i.y,this},_sub:function(i){return this.x-=i.x,this.y-=i.y,this},_mult:function(i){return this.x*=i,this.y*=i,this},_div:function(i){return this.x/=i,this.y/=i,this},_multByPoint:function(i){return this.x*=i.x,this.y*=i.y,this},_divByPoint:function(i){return this.x/=i.x,this.y/=i.y,this},_unit:function(){return this._div(this.mag()),this},_perp:function(){var i=this.y;return this.y=this.x,this.x=-i,this},_rotate:function(i){var e=Math.cos(i),r=Math.sin(i),s=r*this.x+e*this.y;return this.x=e*this.x-r*this.y,this.y=s,this},_rotateAround:function(i,e){var r=Math.cos(i),s=Math.sin(i),c=e.y+s*(this.x-e.x)+r*(this.y-e.y);return this.x=e.x+r*(this.x-e.x)-s*(this.y-e.y),this.y=c,this},_round:function(){return this.x=Math.round(this.x),this.y=Math.round(this.y),this}},P.convert=function(i){return i instanceof P?i:Array.isArray(i)?new P(i[0],i[1]):i};const z=Math.PI/180,R=180/Math.PI;function F(i){return i*z}function q(i){return i*R}const ae=[[0,0],[1,0],[1,1],[0,1]];function se(i){if(i<=0)return 0;if(i>=1)return 1;const e=i*i,r=e*i;return 4*(i<.5?r:3*(i-e)+r-.75)}function ie(i,e,r,s){const c=new T(i,e,r,s);return function(f){return c.solve(f)}}const Q=ie(.25,.1,.25,1);function re(i,e,r){return Math.min(r,Math.max(e,i))}function Ae(i,e,r){return(r=re((r-i)/(e-i),0,1))*r*(3-2*r)}function $e(i,e,r){const s=r-e,c=((i-e)%s+s)%s+e;return c===e?r:c}function Je(i,e,r){if(!i.length)return r(null,[]);let s=i.length;const c=new Array(i.length);let f=null;i.forEach((_,x)=>{e(_,(E,A)=>{E&&(f=E),c[x]=A,--s==0&&r(f,c)})})}function ze(i){const e=[];for(const r in i)e.push(i[r]);return e}function Pe(i,...e){for(const r of e)for(const s in r)i[s]=r[s];return i}let Ge=1;function Qe(){return Ge++}function Rt(){return function i(e){return e?(e^Math.random()*(16>>e/4)).toString(16):([1e7]+-[1e3]+-4e3+-8e3+-1e11).replace(/[018]/g,i)}()}function mt(i){return i<=1?1:Math.pow(2,Math.ceil(Math.log(i)/Math.LN2))}function Ne(i){return!!i&&/^[0-9a-f]{8}-[0-9a-f]{4}-[4][0-9a-f]{3}-[89ab][0-9a-f]{3}-[0-9a-f]{12}$/i.test(i)}function At(i,e){i.forEach(r=>{e[r]&&(e[r]=e[r].bind(e))})}function $t(i,e){return i.indexOf(e,i.length-e.length)!==-1}function _t(i,e,r){const s={};for(const c in i)s[c]=e.call(r||this,i[c],c,i);return s}function Ht(i,e,r){const s={};for(const c in i)e.call(r||this,i[c],c,i)&&(s[c]=i[c]);return s}function Ci(i){return Array.isArray(i)?i.map(Ci):typeof i=="object"&&i?_t(i,Ci):i}const Ui={};function Kt(i){Ui[i]||(typeof console!="undefined"&&console.warn(i),Ui[i]=!0)}function Yt(i,e,r){return(r.y-i.y)*(e.x-i.x)>(e.y-i.y)*(r.x-i.x)}function Lt(i){let e=0;for(let r,s,c=0,f=i.length,_=f-1;c<f;_=c++)r=i[c],s=i[_],e+=(s.x-r.x)*(r.y+s.y);return e}function Zt(){return typeof WorkerGlobalScope!="undefined"&&typeof self!="undefined"&&self instanceof WorkerGlobalScope}function vr(i){const e={};if(i.replace(/(?:^|(?:\s*\,\s*))([^\x00-\x20\(\)<>@\,;\:\\"\/\[\]\?\=\{\}\x7F]+)(?:\=(?:([^\x00-\x20\(\)<>@\,;\:\\"\/\[\]\?\=\{\}\x7F]+)|(?:\"((?:[^"\\]|\\.)*)\")))?/g,(r,s,c,f)=>{const _=c||f;return e[s]=!_||_.toLowerCase(),""}),e["max-age"]){const r=parseInt(e["max-age"],10);isNaN(r)?delete e["max-age"]:e["max-age"]=r}return e}let vi=null;function vn(i){if(vi==null){const e=i.navigator?i.navigator.userAgent:null;vi=!!i.safari||!(!e||!(/\b(iPad|iPhone|iPod)\b/.test(e)||e.match("Safari")&&!e.match("Chrome")))}return vi}function fo(i){try{const e=w[i];return e.setItem("_mapbox_test_",1),e.removeItem("_mapbox_test_"),!0}catch{return!1}}function xn(i,e){return[i[4*e],i[4*e+1],i[4*e+2],i[4*e+3]]}const Do=w.performance;function Lo(i){const e=i?i.url.toString():void 0;return Do.getEntriesByName(e)}var Ro="2.9.2";let xi,$n,Bo,Pn;const nn={now:()=>Bo!==void 0?Bo:w.performance.now(),setNow(i){Bo=i},restoreNow(){Bo=void 0},frame(i){const e=w.requestAnimationFrame(i);return{cancel:()=>w.cancelAnimationFrame(e)}},getImageData(i,e=0){const{width:r,height:s}=i;Pn||(Pn=w.document.createElement("canvas"));const c=Pn.getContext("2d");if(!c)throw new Error("failed to create canvas 2d context");return(r>Pn.width||s>Pn.height)&&(Pn.width=r,Pn.height=s),c.clearRect(-e,-e,r+2*e,s+2*e),c.drawImage(i,0,0,r,s),c.getImageData(-e,-e,r+2*e,s+2*e)},resolveURL:i=>(xi||(xi=w.document.createElement("a")),xi.href=i,xi.href),get devicePixelRatio(){return w.devicePixelRatio},get prefersReducedMotion(){return!!w.matchMedia&&($n==null&&($n=w.matchMedia("(prefers-reduced-motion: reduce)")),$n.matches)}};let ss;const gi={API_URL:"https://api.mapbox.com",get API_URL_REGEX(){if(ss==null){const i=/^((https?:)?\/\/)?([^\/]+\.)?mapbox\.c(n|om)(\/|\?|$)/i;try{ss={}.API_URL_REGEX!=null?new RegExp({}.API_URL_REGEX):i}catch{ss=i}}return ss},get EVENTS_URL(){return this.API_URL?this.API_URL.indexOf("https://api.mapbox.cn")===0?"https://events.mapbox.cn/events/v2":this.API_URL.indexOf("https://api.mapbox.com")===0?"https://events.mapbox.com/events/v2":null:null},SESSION_PATH:"/map-sessions/v1",FEEDBACK_URL:"https://apps.mapbox.com/feedback",TILE_URL_VERSION:"v4",RASTER_URL_PREFIX:"raster/v1",REQUIRE_ACCESS_TOKEN:!0,ACCESS_TOKEN:null,MAX_PARALLEL_IMAGE_REQUESTS:16},mo={supported:!1,testSupport:function(i){!Oo&&Xn&&(as?Hs(i):Wn=i)}};let Wn,Xn,Oo=!1,as=!1;function Hs(i){const e=i.createTexture();i.bindTexture(i.TEXTURE_2D,e);try{if(i.texImage2D(i.TEXTURE_2D,0,i.RGBA,i.RGBA,i.UNSIGNED_BYTE,Xn),i.isContextLost())return;mo.supported=!0}catch{}i.deleteTexture(e),Oo=!0}w.document&&(Xn=w.document.createElement("img"),Xn.onload=function(){Wn&&Hs(Wn),Wn=null,as=!0},Xn.onerror=function(){Oo=!0,Wn=null},Xn.src="data:image/webp;base64,UklGRh4AAABXRUJQVlA4TBEAAAAvAQAAAAfQ//73v/+BiOh/AAA=");const Ys="01",Yr="NO_ACCESS_TOKEN";function Dn(i){return i.indexOf("mapbox:")===0}function Fo(i){return gi.API_URL_REGEX.test(i)}const Xa=/^(\w+):\/\/([^/?]*)(\/[^?]+)?\??(.+)?/;function Kr(i){const e=i.match(Xa);if(!e)throw new Error("Unable to parse URL object");return{protocol:e[1],authority:e[2],path:e[3]||"/",params:e[4]?e[4].split("&"):[]}}function Hn(i){const e=i.params.length?`?${i.params.join("&")}`:"";return`${i.protocol}://${i.authority}${i.path}${e}`}function Ha(i){if(!i)return null;const e=i.split(".");if(!e||e.length!==3)return null;try{return JSON.parse(decodeURIComponent(w.atob(e[1]).split("").map(r=>"%"+("00"+r.charCodeAt(0).toString(16)).slice(-2)).join("")))}catch{return null}}class Ks{constructor(e){this.type=e,this.anonId=null,this.eventData={},this.queue=[],this.pendingRequest=null}getStorageKey(e){const r=Ha(gi.ACCESS_TOKEN);let s="";return s=r&&r.u?w.btoa(encodeURIComponent(r.u).replace(/%([0-9A-F]{2})/g,(c,f)=>String.fromCharCode(Number("0x"+f)))):gi.ACCESS_TOKEN||"",e?`mapbox.eventData.${e}:${s}`:`mapbox.eventData:${s}`}fetchEventData(){const e=fo("localStorage"),r=this.getStorageKey(),s=this.getStorageKey("uuid");if(e)try{const c=w.localStorage.getItem(r);c&&(this.eventData=JSON.parse(c));const f=w.localStorage.getItem(s);f&&(this.anonId=f)}catch{Kt("Unable to read from LocalStorage")}}saveEventData(){const e=fo("localStorage"),r=this.getStorageKey(),s=this.getStorageKey("uuid");if(e)try{w.localStorage.setItem(s,this.anonId),Object.keys(this.eventData).length>=1&&w.localStorage.setItem(r,JSON.stringify(this.eventData))}catch{Kt("Unable to write to LocalStorage")}}processRequests(e){}postEvent(e,r,s,c){if(!gi.EVENTS_URL)return;const f=Kr(gi.EVENTS_URL);f.params.push(`access_token=${c||gi.ACCESS_TOKEN||""}`);const _={event:this.type,created:new Date(e).toISOString(),sdkIdentifier:"mapbox-gl-js",sdkVersion:Ro,skuId:Ys,userId:this.anonId},x=r?Pe(_,r):_,E={url:Hn(f),headers:{"Content-Type":"text/plain"},body:JSON.stringify([x])};this.pendingRequest=Re(E,A=>{this.pendingRequest=null,s(A),this.saveEventData(),this.processRequests(c)})}queueRequest(e,r){this.queue.push(e),this.processRequests(r)}}const Js=new class extends Ks{constructor(i){super("appUserTurnstile"),this._customAccessToken=i}postTurnstileEvent(i,e){gi.EVENTS_URL&&gi.ACCESS_TOKEN&&Array.isArray(i)&&i.some(r=>Dn(r)||Fo(r))&&this.queueRequest(Date.now(),e)}processRequests(i){if(this.pendingRequest||this.queue.length===0)return;this.anonId&&this.eventData.lastSuccess&&this.eventData.tokenU||this.fetchEventData();const e=Ha(gi.ACCESS_TOKEN),r=e?e.u:gi.ACCESS_TOKEN;let s=r!==this.eventData.tokenU;Ne(this.anonId)||(this.anonId=Rt(),s=!0);const c=this.queue.shift();if(this.eventData.lastSuccess){const f=new Date(this.eventData.lastSuccess),_=new Date(c),x=(c-this.eventData.lastSuccess)/864e5;s=s||x>=1||x<-1||f.getDate()!==_.getDate()}else s=!0;s?this.postEvent(c,{"enabled.telemetry":!1},f=>{f||(this.eventData.lastSuccess=c,this.eventData.tokenU=r)},i):this.processRequests()}},Qs=Js.postTurnstileEvent.bind(Js),ea=new class extends Ks{constructor(){super("map.load"),this.success={},this.skuToken=""}postMapLoadEvent(i,e,r,s){this.skuToken=e,this.errorCb=s,gi.EVENTS_URL&&(r||gi.ACCESS_TOKEN?this.queueRequest({id:i,timestamp:Date.now()},r):this.errorCb(new Error(Yr)))}processRequests(i){if(this.pendingRequest||this.queue.length===0)return;const{id:e,timestamp:r}=this.queue.shift();e&&this.success[e]||(this.anonId||this.fetchEventData(),Ne(this.anonId)||(this.anonId=Rt()),this.postEvent(r,{skuToken:this.skuToken},s=>{s?this.errorCb(s):e&&(this.success[e]=!0)},i))}},Ya=ea.postMapLoadEvent.bind(ea),Ka=new class extends Ks{constructor(){super("map.auth"),this.success={},this.skuToken=""}getSession(i,e,r,s){if(!gi.API_URL||!gi.SESSION_PATH)return;const c=Kr(gi.API_URL+gi.SESSION_PATH);c.params.push(`sku=${e||""}`),c.params.push(`access_token=${s||gi.ACCESS_TOKEN||""}`);const f={url:Hn(c),headers:{"Content-Type":"text/plain"}};this.pendingRequest=nt(f,_=>{this.pendingRequest=null,r(_),this.saveEventData(),this.processRequests(s)})}getSessionAPI(i,e,r,s){this.skuToken=e,this.errorCb=s,gi.SESSION_PATH&&gi.API_URL&&(r||gi.ACCESS_TOKEN?this.queueRequest({id:i,timestamp:Date.now()},r):this.errorCb(new Error(Yr)))}processRequests(i){if(this.pendingRequest||this.queue.length===0)return;const{id:e,timestamp:r}=this.queue.shift();e&&this.success[e]||this.getSession(r,this.skuToken,s=>{s?this.errorCb(s):e&&(this.success[e]=!0)},i)}},cc=Ka.getSessionAPI.bind(Ka),_o=new Set;let Yn,ls=500,Ja=50,Nr={};function ta(i){const e=j(i);let r,s;e&&e.forEach(f=>{const _=f.split("=");_[0]==="language"?r=_[1]:_[0]==="worldview"&&(s=_[1])});let c="mapbox-tiles";return r&&(c+=`-${r}`),s&&(c+=`-${s}`),c}function ce(i){w.caches&&!Nr[i]&&(Nr[i]=w.caches.open(i))}function j(i){const e=i.indexOf("?");return e>0?i.slice(e+1).split("&"):[]}function Z(i){const e=i.indexOf("?");if(e<0)return i;const r=j(i).filter(s=>{const c=s.split("=");return c[0]==="language"||c[0]==="worldview"});return r.length?`${i.slice(0,e)}?${r.join("&")}`:i.slice(0,e)}let le=1/0;const me={Unknown:"Unknown",Style:"Style",Source:"Source",Tile:"Tile",Glyphs:"Glyphs",SpriteImage:"SpriteImage",SpriteJSON:"SpriteJSON",Image:"Image"};typeof Object.freeze=="function"&&Object.freeze(me);class we extends Error{constructor(e,r,s){r===401&&Fo(s)&&(e+=": you may have provided an invalid Mapbox access token. See https://www.mapbox.com/api-documentation/#access-tokens-and-token-scopes"),super(e),this.status=r,this.url=s}toString(){return`${this.name}: ${this.message} (${this.status}): ${this.url}`}}const De=Zt()?()=>self.worker&&self.worker.referrer:()=>(w.location.protocol==="blob:"?w.parent:w).location.href,Ie=function(i,e){if(!(/^file:/.test(r=i.url)||/^file:/.test(De())&&!/^\w+:/.test(r))){if(w.fetch&&w.Request&&w.AbortController&&w.Request.prototype.hasOwnProperty("signal"))return function(s,c){const f=new w.AbortController,_=new w.Request(s.url,{method:s.method||"GET",body:s.body,credentials:s.credentials,headers:s.headers,referrer:De(),signal:f.signal});let x=!1,E=!1;const A=(C=_.url).indexOf("sku=")>0&&Fo(C);var C;s.type==="json"&&_.headers.set("Accept","application/json");const L=(U,N,$)=>{if(E)return;if(U&&U.message!=="SecurityError"&&Kt(U),N&&$)return B(N);const te=Date.now();w.fetch(_).then(ue=>{if(ue.ok){const ve=A?ue.clone():null;return B(ue,ve,te)}return c(new we(ue.statusText,ue.status,s.url))}).catch(ue=>{ue.code!==20&&c(new Error(ue.message))})},B=(U,N,$)=>{(s.type==="arrayBuffer"?U.arrayBuffer():s.type==="json"?U.json():U.text()).then(te=>{E||(N&&$&&function(ue,ve,ye){const xe=ta(ue.url);if(ce(xe),!Nr[xe])return;const Ee={status:ve.status,statusText:ve.statusText,headers:new w.Headers};ve.headers.forEach((We,tt)=>Ee.headers.set(tt,We));const Se=vr(ve.headers.get("Cache-Control")||"");if(Se["no-store"])return;Se["max-age"]&&Ee.headers.set("Expires",new Date(ye+1e3*Se["max-age"]).toUTCString());const qe=Ee.headers.get("Expires");qe&&(new Date(qe).getTime()-ye<42e4||function(We,tt){if(Yn===void 0)try{new Response(new ReadableStream),Yn=!0}catch{Yn=!1}Yn?tt(We.body):We.blob().then(tt)}(ve,We=>{const tt=new w.Response(We,Ee);ce(xe),Nr[xe]&&Nr[xe].then(at=>at.put(Z(ue.url),tt)).catch(at=>Kt(at.message))}))}(_,N,$),x=!0,c(null,te,U.headers.get("Cache-Control"),U.headers.get("Expires")))}).catch(te=>{E||c(new Error(te.message))})};return A?function(U,N){const $=ta(U.url);if(ce($),!Nr[$])return N(null);const te=Z(U.url);Nr[$].then(ue=>{ue.match(te).then(ve=>{const ye=function(xe){if(!xe)return!1;const Ee=new Date(xe.headers.get("Expires")||0),Se=vr(xe.headers.get("Cache-Control")||"");return Ee>Date.now()&&!Se["no-cache"]}(ve);ue.delete(te),ye&&ue.put(te,ve.clone()),N(null,ve,ye)}).catch(N)}).catch(N)}(_,L):L(null,null),{cancel:()=>{E=!0,x||f.abort()}}}(i,e);if(Zt()&&self.worker&&self.worker.actor)return self.worker.actor.send("getResource",i,e,void 0,!0)}var r;return function(s,c){const f=new w.XMLHttpRequest;f.open(s.method||"GET",s.url,!0),s.type==="arrayBuffer"&&(f.responseType="arraybuffer");for(const _ in s.headers)f.setRequestHeader(_,s.headers[_]);return s.type==="json"&&(f.responseType="text",f.setRequestHeader("Accept","application/json")),f.withCredentials=s.credentials==="include",f.onerror=()=>{c(new Error(f.statusText))},f.onload=()=>{if((f.status>=200&&f.status<300||f.status===0)&&f.response!==null){let _=f.response;if(s.type==="json")try{_=JSON.parse(f.response)}catch(x){return c(x)}c(null,_,f.getResponseHeader("Cache-Control"),f.getResponseHeader("Expires"))}else c(new we(f.statusText,f.status,s.url))},f.send(s.body),{cancel:()=>f.abort()}}(i,e)},Te=function(i,e){return Ie(Pe(i,{type:"arrayBuffer"}),e)},Re=function(i,e){return Ie(Pe(i,{method:"POST"}),e)},nt=function(i,e){return Ie(Pe(i,{method:"GET"}),e)};function It(i){const e=w.document.createElement("a");return e.href=i,e.protocol===w.document.location.protocol&&e.host===w.document.location.host}const st="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAYAAAAfFcSJAAAAC0lEQVQYV2NgAAIAAAUAAarVyFEAAAAASUVORK5CYII=";let Nt,Gt;Nt=[],Gt=0;const jt=function(i,e){if(mo.supported&&(i.headers||(i.headers={}),i.headers.accept="image/webp,*/*"),Gt>=gi.MAX_PARALLEL_IMAGE_REQUESTS){const f={requestParameters:i,callback:e,cancelled:!1,cancel(){this.cancelled=!0}};return Nt.push(f),f}Gt++;let r=!1;const s=()=>{if(!r)for(r=!0,Gt--;Nt.length&&Gt<gi.MAX_PARALLEL_IMAGE_REQUESTS;){const f=Nt.shift(),{requestParameters:_,callback:x,cancelled:E}=f;E||(f.cancel=jt(_,x).cancel)}},c=Te(i,(f,_,x,E)=>{s(),f?e(f):_&&(w.createImageBitmap?function(A,C){const L=new w.Blob([new Uint8Array(A)],{type:"image/png"});w.createImageBitmap(L).then(B=>{C(null,B)}).catch(B=>{C(new Error(`Could not load image because of ${B.message}. Please make sure to use a supported image type such as PNG or JPEG. Note that SVGs are not supported.`))})}(_,(A,C)=>e(A,C,x,E)):function(A,C){const L=new w.Image,B=w.URL;L.onload=()=>{C(null,L),B.revokeObjectURL(L.src),L.onload=null,w.requestAnimationFrame(()=>{L.src=st})},L.onerror=()=>C(new Error("Could not load image. Please make sure to use a supported image type such as PNG or JPEG. Note that SVGs are not supported."));const U=new w.Blob([new Uint8Array(A)],{type:"image/png"});L.src=A.byteLength?B.createObjectURL(U):st}(_,(A,C)=>e(A,C,x,E)))});return{cancel:()=>{c.cancel(),s()}}};function Wt(i,e,r){r[i]&&r[i].indexOf(e)!==-1||(r[i]=r[i]||[],r[i].push(e))}function ai(i,e,r){if(r&&r[i]){const s=r[i].indexOf(e);s!==-1&&r[i].splice(s,1)}}class Ti{constructor(e,r={}){Pe(this,r),this.type=e}}class ji extends Ti{constructor(e,r={}){super("error",Pe({error:e},r))}}class ki{on(e,r){return this._listeners=this._listeners||{},Wt(e,r,this._listeners),this}off(e,r){return ai(e,r,this._listeners),ai(e,r,this._oneTimeListeners),this}once(e,r){return r?(this._oneTimeListeners=this._oneTimeListeners||{},Wt(e,r,this._oneTimeListeners),this):new Promise(s=>this.once(e,s))}fire(e,r){typeof e=="string"&&(e=new Ti(e,r||{}));const s=e.type;if(this.listens(s)){e.target=this;const c=this._listeners&&this._listeners[s]?this._listeners[s].slice():[];for(const x of c)x.call(this,e);const f=this._oneTimeListeners&&this._oneTimeListeners[s]?this._oneTimeListeners[s].slice():[];for(const x of f)ai(s,x,this._oneTimeListeners),x.call(this,e);const _=this._eventedParent;_&&(Pe(e,typeof this._eventedParentData=="function"?this._eventedParentData():this._eventedParentData),_.fire(e))}else e instanceof ji&&console.error(e.error);return this}listens(e){return!!(this._listeners&&this._listeners[e]&&this._listeners[e].length>0||this._oneTimeListeners&&this._oneTimeListeners[e]&&this._oneTimeListeners[e].length>0||this._eventedParent&&this._eventedParent.listens(e))}setEventedParent(e,r){return this._eventedParent=e,this._eventedParentData=r,this}}var ke=JSON.parse('{"$version":8,"$root":{"version":{"required":true,"type":"enum","values":[8]},"name":{"type":"string"},"metadata":{"type":"*"},"center":{"type":"array","value":"number"},"zoom":{"type":"number"},"bearing":{"type":"number","default":0,"period":360,"units":"degrees"},"pitch":{"type":"number","default":0,"units":"degrees"},"light":{"type":"light"},"terrain":{"type":"terrain"},"fog":{"type":"fog"},"sources":{"required":true,"type":"sources"},"sprite":{"type":"string"},"glyphs":{"type":"string"},"transition":{"type":"transition"},"projection":{"type":"projection"},"layers":{"required":true,"type":"array","value":"layer"}},"sources":{"*":{"type":"source"}},"source":["source_vector","source_raster","source_raster_dem","source_geojson","source_video","source_image"],"source_vector":{"type":{"required":true,"type":"enum","values":{"vector":{}}},"url":{"type":"string"},"tiles":{"type":"array","value":"string"},"bounds":{"type":"array","value":"number","length":4,"default":[-180,-85.051129,180,85.051129]},"scheme":{"type":"enum","values":{"xyz":{},"tms":{}},"default":"xyz"},"minzoom":{"type":"number","default":0},"maxzoom":{"type":"number","default":22},"attribution":{"type":"string"},"promoteId":{"type":"promoteId"},"volatile":{"type":"boolean","default":false},"*":{"type":"*"}},"source_raster":{"type":{"required":true,"type":"enum","values":{"raster":{}}},"url":{"type":"string"},"tiles":{"type":"array","value":"string"},"bounds":{"type":"array","value":"number","length":4,"default":[-180,-85.051129,180,85.051129]},"minzoom":{"type":"number","default":0},"maxzoom":{"type":"number","default":22},"tileSize":{"type":"number","default":512,"units":"pixels"},"scheme":{"type":"enum","values":{"xyz":{},"tms":{}},"default":"xyz"},"attribution":{"type":"string"},"volatile":{"type":"boolean","default":false},"*":{"type":"*"}},"source_raster_dem":{"type":{"required":true,"type":"enum","values":{"raster-dem":{}}},"url":{"type":"string"},"tiles":{"type":"array","value":"string"},"bounds":{"type":"array","value":"number","length":4,"default":[-180,-85.051129,180,85.051129]},"minzoom":{"type":"number","default":0},"maxzoom":{"type":"number","default":22},"tileSize":{"type":"number","default":512,"units":"pixels"},"attribution":{"type":"string"},"encoding":{"type":"enum","values":{"terrarium":{},"mapbox":{}},"default":"mapbox"},"volatile":{"type":"boolean","default":false},"*":{"type":"*"}},"source_geojson":{"type":{"required":true,"type":"enum","values":{"geojson":{}}},"data":{"type":"*"},"maxzoom":{"type":"number","default":18},"attribution":{"type":"string"},"buffer":{"type":"number","default":128,"maximum":512,"minimum":0},"filter":{"type":"*"},"tolerance":{"type":"number","default":0.375},"cluster":{"type":"boolean","default":false},"clusterRadius":{"type":"number","default":50,"minimum":0},"clusterMaxZoom":{"type":"number"},"clusterMinPoints":{"type":"number"},"clusterProperties":{"type":"*"},"lineMetrics":{"type":"boolean","default":false},"generateId":{"type":"boolean","default":false},"promoteId":{"type":"promoteId"}},"source_video":{"type":{"required":true,"type":"enum","values":{"video":{}}},"urls":{"required":true,"type":"array","value":"string"},"coordinates":{"required":true,"type":"array","length":4,"value":{"type":"array","length":2,"value":"number"}}},"source_image":{"type":{"required":true,"type":"enum","values":{"image":{}}},"url":{"required":true,"type":"string"},"coordinates":{"required":true,"type":"array","length":4,"value":{"type":"array","length":2,"value":"number"}}},"layer":{"id":{"type":"string","required":true},"type":{"type":"enum","values":{"fill":{},"line":{},"symbol":{},"circle":{},"heatmap":{},"fill-extrusion":{},"raster":{},"hillshade":{},"background":{},"sky":{}},"required":true},"metadata":{"type":"*"},"source":{"type":"string"},"source-layer":{"type":"string"},"minzoom":{"type":"number","minimum":0,"maximum":24},"maxzoom":{"type":"number","minimum":0,"maximum":24},"filter":{"type":"filter"},"layout":{"type":"layout"},"paint":{"type":"paint"}},"layout":["layout_fill","layout_line","layout_circle","layout_heatmap","layout_fill-extrusion","layout_symbol","layout_raster","layout_hillshade","layout_background","layout_sky"],"layout_background":{"visibility":{"type":"enum","values":{"visible":{},"none":{}},"default":"visible","property-type":"constant"}},"layout_sky":{"visibility":{"type":"enum","values":{"visible":{},"none":{}},"default":"visible","property-type":"constant"}},"layout_fill":{"fill-sort-key":{"type":"number","expression":{"interpolated":false,"parameters":["zoom","feature"]},"property-type":"data-driven"},"visibility":{"type":"enum","values":{"visible":{},"none":{}},"default":"visible","property-type":"constant"}},"layout_circle":{"circle-sort-key":{"type":"number","expression":{"interpolated":false,"parameters":["zoom","feature"]},"property-type":"data-driven"},"visibility":{"type":"enum","values":{"visible":{},"none":{}},"default":"visible","property-type":"constant"}},"layout_heatmap":{"visibility":{"type":"enum","values":{"visible":{},"none":{}},"default":"visible","property-type":"constant"}},"layout_fill-extrusion":{"visibility":{"type":"enum","values":{"visible":{},"none":{}},"default":"visible","property-type":"constant"}},"layout_line":{"line-cap":{"type":"enum","values":{"butt":{},"round":{},"square":{}},"default":"butt","expression":{"interpolated":false,"parameters":["zoom","feature"]},"property-type":"data-driven"},"line-join":{"type":"enum","values":{"bevel":{},"round":{},"miter":{}},"default":"miter","expression":{"interpolated":false,"parameters":["zoom","feature"]},"property-type":"data-driven"},"line-miter-limit":{"type":"number","default":2,"requires":[{"line-join":"miter"}],"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"line-round-limit":{"type":"number","default":1.05,"requires":[{"line-join":"round"}],"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"line-sort-key":{"type":"number","expression":{"interpolated":false,"parameters":["zoom","feature"]},"property-type":"data-driven"},"visibility":{"type":"enum","values":{"visible":{},"none":{}},"default":"visible","property-type":"constant"}},"layout_symbol":{"symbol-placement":{"type":"enum","values":{"point":{},"line":{},"line-center":{}},"default":"point","expression":{"interpolated":false,"parameters":["zoom"]},"property-type":"data-constant"},"symbol-spacing":{"type":"number","default":250,"minimum":1,"units":"pixels","requires":[{"symbol-placement":"line"}],"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"symbol-avoid-edges":{"type":"boolean","default":false,"expression":{"interpolated":false,"parameters":["zoom"]},"property-type":"data-constant"},"symbol-sort-key":{"type":"number","expression":{"interpolated":false,"parameters":["zoom","feature"]},"property-type":"data-driven"},"symbol-z-order":{"type":"enum","values":{"auto":{},"viewport-y":{},"source":{}},"default":"auto","expression":{"interpolated":false,"parameters":["zoom"]},"property-type":"data-constant"},"icon-allow-overlap":{"type":"boolean","default":false,"requires":["icon-image"],"expression":{"interpolated":false,"parameters":["zoom"]},"property-type":"data-constant"},"icon-ignore-placement":{"type":"boolean","default":false,"requires":["icon-image"],"expression":{"interpolated":false,"parameters":["zoom"]},"property-type":"data-constant"},"icon-optional":{"type":"boolean","default":false,"requires":["icon-image","text-field"],"expression":{"interpolated":false,"parameters":["zoom"]},"property-type":"data-constant"},"icon-rotation-alignment":{"type":"enum","values":{"map":{},"viewport":{},"auto":{}},"default":"auto","requires":["icon-image"],"expression":{"interpolated":false,"parameters":["zoom"]},"property-type":"data-constant"},"icon-size":{"type":"number","default":1,"minimum":0,"units":"factor of the original icon size","requires":["icon-image"],"expression":{"interpolated":true,"parameters":["zoom","feature"]},"property-type":"data-driven"},"icon-text-fit":{"type":"enum","values":{"none":{},"width":{},"height":{},"both":{}},"default":"none","requires":["icon-image","text-field"],"expression":{"interpolated":false,"parameters":["zoom"]},"property-type":"data-constant"},"icon-text-fit-padding":{"type":"array","value":"number","length":4,"default":[0,0,0,0],"units":"pixels","requires":["icon-image","text-field",{"icon-text-fit":["both","width","height"]}],"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"icon-image":{"type":"resolvedImage","tokens":true,"expression":{"interpolated":false,"parameters":["zoom","feature"]},"property-type":"data-driven"},"icon-rotate":{"type":"number","default":0,"period":360,"units":"degrees","requires":["icon-image"],"expression":{"interpolated":true,"parameters":["zoom","feature"]},"property-type":"data-driven"},"icon-padding":{"type":"number","default":2,"minimum":0,"units":"pixels","requires":["icon-image"],"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"icon-keep-upright":{"type":"boolean","default":false,"requires":["icon-image",{"icon-rotation-alignment":"map"},{"symbol-placement":["line","line-center"]}],"expression":{"interpolated":false,"parameters":["zoom"]},"property-type":"data-constant"},"icon-offset":{"type":"array","value":"number","length":2,"default":[0,0],"requires":["icon-image"],"expression":{"interpolated":true,"parameters":["zoom","feature"]},"property-type":"data-driven"},"icon-anchor":{"type":"enum","values":{"center":{},"left":{},"right":{},"top":{},"bottom":{},"top-left":{},"top-right":{},"bottom-left":{},"bottom-right":{}},"default":"center","requires":["icon-image"],"expression":{"interpolated":false,"parameters":["zoom","feature"]},"property-type":"data-driven"},"icon-pitch-alignment":{"type":"enum","values":{"map":{},"viewport":{},"auto":{}},"default":"auto","requires":["icon-image"],"expression":{"interpolated":false,"parameters":["zoom"]},"property-type":"data-constant"},"text-pitch-alignment":{"type":"enum","values":{"map":{},"viewport":{},"auto":{}},"default":"auto","requires":["text-field"],"expression":{"interpolated":false,"parameters":["zoom"]},"property-type":"data-constant"},"text-rotation-alignment":{"type":"enum","values":{"map":{},"viewport":{},"auto":{}},"default":"auto","requires":["text-field"],"expression":{"interpolated":false,"parameters":["zoom"]},"property-type":"data-constant"},"text-field":{"type":"formatted","default":"","tokens":true,"expression":{"interpolated":false,"parameters":["zoom","feature"]},"property-type":"data-driven"},"text-font":{"type":"array","value":"string","default":["Open Sans Regular","Arial Unicode MS Regular"],"requires":["text-field"],"expression":{"interpolated":false,"parameters":["zoom","feature"]},"property-type":"data-driven"},"text-size":{"type":"number","default":16,"minimum":0,"units":"pixels","requires":["text-field"],"expression":{"interpolated":true,"parameters":["zoom","feature"]},"property-type":"data-driven"},"text-max-width":{"type":"number","default":10,"minimum":0,"units":"ems","requires":["text-field",{"symbol-placement":["point"]}],"expression":{"interpolated":true,"parameters":["zoom","feature"]},"property-type":"data-driven"},"text-line-height":{"type":"number","default":1.2,"units":"ems","requires":["text-field"],"expression":{"interpolated":true,"parameters":["zoom","feature"]},"property-type":"data-driven"},"text-letter-spacing":{"type":"number","default":0,"units":"ems","requires":["text-field"],"expression":{"interpolated":true,"parameters":["zoom","feature"]},"property-type":"data-driven"},"text-justify":{"type":"enum","values":{"auto":{},"left":{},"center":{},"right":{}},"default":"center","requires":["text-field"],"expression":{"interpolated":false,"parameters":["zoom","feature"]},"property-type":"data-driven"},"text-radial-offset":{"type":"number","units":"ems","default":0,"requires":["text-field"],"property-type":"data-driven","expression":{"interpolated":true,"parameters":["zoom","feature"]}},"text-variable-anchor":{"type":"array","value":"enum","values":{"center":{},"left":{},"right":{},"top":{},"bottom":{},"top-left":{},"top-right":{},"bottom-left":{},"bottom-right":{}},"requires":["text-field",{"symbol-placement":["point"]}],"expression":{"interpolated":false,"parameters":["zoom"]},"property-type":"data-constant"},"text-anchor":{"type":"enum","values":{"center":{},"left":{},"right":{},"top":{},"bottom":{},"top-left":{},"top-right":{},"bottom-left":{},"bottom-right":{}},"default":"center","requires":["text-field",{"!":"text-variable-anchor"}],"expression":{"interpolated":false,"parameters":["zoom","feature"]},"property-type":"data-driven"},"text-max-angle":{"type":"number","default":45,"units":"degrees","requires":["text-field",{"symbol-placement":["line","line-center"]}],"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"text-writing-mode":{"type":"array","value":"enum","values":{"horizontal":{},"vertical":{}},"requires":["text-field"],"expression":{"interpolated":false,"parameters":["zoom"]},"property-type":"data-constant"},"text-rotate":{"type":"number","default":0,"period":360,"units":"degrees","requires":["text-field"],"expression":{"interpolated":true,"parameters":["zoom","feature"]},"property-type":"data-driven"},"text-padding":{"type":"number","default":2,"minimum":0,"units":"pixels","requires":["text-field"],"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"text-keep-upright":{"type":"boolean","default":true,"requires":["text-field",{"text-rotation-alignment":"map"},{"symbol-placement":["line","line-center"]}],"expression":{"interpolated":false,"parameters":["zoom"]},"property-type":"data-constant"},"text-transform":{"type":"enum","values":{"none":{},"uppercase":{},"lowercase":{}},"default":"none","requires":["text-field"],"expression":{"interpolated":false,"parameters":["zoom","feature"]},"property-type":"data-driven"},"text-offset":{"type":"array","value":"number","units":"ems","length":2,"default":[0,0],"requires":["text-field",{"!":"text-radial-offset"}],"expression":{"interpolated":true,"parameters":["zoom","feature"]},"property-type":"data-driven"},"text-allow-overlap":{"type":"boolean","default":false,"requires":["text-field"],"expression":{"interpolated":false,"parameters":["zoom"]},"property-type":"data-constant"},"text-ignore-placement":{"type":"boolean","default":false,"requires":["text-field"],"expression":{"interpolated":false,"parameters":["zoom"]},"property-type":"data-constant"},"text-optional":{"type":"boolean","default":false,"requires":["text-field","icon-image"],"expression":{"interpolated":false,"parameters":["zoom"]},"property-type":"data-constant"},"visibility":{"type":"enum","values":{"visible":{},"none":{}},"default":"visible","property-type":"constant"}},"layout_raster":{"visibility":{"type":"enum","values":{"visible":{},"none":{}},"default":"visible","property-type":"constant"}},"layout_hillshade":{"visibility":{"type":"enum","values":{"visible":{},"none":{}},"default":"visible","property-type":"constant"}},"filter":{"type":"array","value":"*"},"filter_symbol":{"type":"boolean","default":false,"transition":false,"property-type":"data-driven","expression":{"interpolated":false,"parameters":["zoom","feature","pitch","distance-from-center"]}},"filter_fill":{"type":"boolean","default":false,"transition":false,"property-type":"data-driven","expression":{"interpolated":false,"parameters":["zoom","feature"]}},"filter_line":{"type":"boolean","default":false,"transition":false,"property-type":"data-driven","expression":{"interpolated":false,"parameters":["zoom","feature"]}},"filter_circle":{"type":"boolean","default":false,"transition":false,"property-type":"data-driven","expression":{"interpolated":false,"parameters":["zoom","feature"]}},"filter_fill-extrusion":{"type":"boolean","default":false,"transition":false,"property-type":"data-driven","expression":{"interpolated":false,"parameters":["zoom","feature"]}},"filter_heatmap":{"type":"boolean","default":false,"transition":false,"property-type":"data-driven","expression":{"interpolated":false,"parameters":["zoom","feature"]}},"filter_operator":{"type":"enum","values":{"==":{},"!=":{},">":{},">=":{},"<":{},"<=":{},"in":{},"!in":{},"all":{},"any":{},"none":{},"has":{},"!has":{},"within":{}}},"geometry_type":{"type":"enum","values":{"Point":{},"LineString":{},"Polygon":{}}},"function":{"expression":{"type":"expression"},"stops":{"type":"array","value":"function_stop"},"base":{"type":"number","default":1,"minimum":0},"property":{"type":"string","default":"$zoom"},"type":{"type":"enum","values":{"identity":{},"exponential":{},"interval":{},"categorical":{}},"default":"exponential"},"colorSpace":{"type":"enum","values":{"rgb":{},"lab":{},"hcl":{}},"default":"rgb"},"default":{"type":"*","required":false}},"function_stop":{"type":"array","minimum":0,"maximum":24,"value":["number","color"],"length":2},"expression":{"type":"array","value":"*","minimum":1},"fog":{"range":{"type":"array","default":[0.5,10],"minimum":-20,"maximum":20,"length":2,"value":"number","property-type":"data-constant","transition":true,"expression":{"interpolated":true,"parameters":["zoom"]}},"color":{"type":"color","property-type":"data-constant","default":"#ffffff","expression":{"interpolated":true,"parameters":["zoom"]},"transition":true},"high-color":{"type":"color","property-type":"data-constant","default":"#245cdf","expression":{"interpolated":true,"parameters":["zoom"]},"transition":true},"space-color":{"type":"color","property-type":"data-constant","default":["interpolate",["linear"],["zoom"],4,"#010b19",7,"#367ab9"],"expression":{"interpolated":true,"parameters":["zoom"]},"transition":true},"horizon-blend":{"type":"number","property-type":"data-constant","default":["interpolate",["linear"],["zoom"],4,0.2,7,0.1],"minimum":0,"maximum":1,"expression":{"interpolated":true,"parameters":["zoom"]},"transition":true},"star-intensity":{"type":"number","property-type":"data-constant","default":["interpolate",["linear"],["zoom"],5,0.35,6,0],"minimum":0,"maximum":1,"expression":{"interpolated":true,"parameters":["zoom"]},"transition":true}},"light":{"anchor":{"type":"enum","default":"viewport","values":{"map":{},"viewport":{}},"property-type":"data-constant","transition":false,"expression":{"interpolated":false,"parameters":["zoom"]}},"position":{"type":"array","default":[1.15,210,30],"length":3,"value":"number","property-type":"data-constant","transition":true,"expression":{"interpolated":true,"parameters":["zoom"]}},"color":{"type":"color","property-type":"data-constant","default":"#ffffff","expression":{"interpolated":true,"parameters":["zoom"]},"transition":true},"intensity":{"type":"number","property-type":"data-constant","default":0.5,"minimum":0,"maximum":1,"expression":{"interpolated":true,"parameters":["zoom"]},"transition":true}},"projection":{"name":{"type":"enum","values":{"albers":{},"equalEarth":{},"equirectangular":{},"lambertConformalConic":{},"mercator":{},"naturalEarth":{},"winkelTripel":{},"globe":{}},"default":"mercator","required":true},"center":{"type":"array","length":2,"value":"number","property-type":"data-constant","minimum":[-180,-90],"maximum":[180,90],"transition":false,"requires":[{"name":["albers","lambertConformalConic"]}]},"parallels":{"type":"array","length":2,"value":"number","property-type":"data-constant","minimum":[-90,-90],"maximum":[90,90],"transition":false,"requires":[{"name":["albers","lambertConformalConic"]}]}},"terrain":{"source":{"type":"string","required":true},"exaggeration":{"type":"number","property-type":"data-constant","default":1,"minimum":0,"maximum":1000,"expression":{"interpolated":true,"parameters":["zoom"]},"transition":true,"requires":["source"]}},"paint":["paint_fill","paint_line","paint_circle","paint_heatmap","paint_fill-extrusion","paint_symbol","paint_raster","paint_hillshade","paint_background","paint_sky"],"paint_fill":{"fill-antialias":{"type":"boolean","default":true,"expression":{"interpolated":false,"parameters":["zoom"]},"property-type":"data-constant"},"fill-opacity":{"type":"number","default":1,"minimum":0,"maximum":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state"]},"property-type":"data-driven"},"fill-color":{"type":"color","default":"#000000","transition":true,"requires":[{"!":"fill-pattern"}],"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state"]},"property-type":"data-driven"},"fill-outline-color":{"type":"color","transition":true,"requires":[{"!":"fill-pattern"},{"fill-antialias":true}],"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state"]},"property-type":"data-driven"},"fill-translate":{"type":"array","value":"number","length":2,"default":[0,0],"transition":true,"units":"pixels","expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"fill-translate-anchor":{"type":"enum","values":{"map":{},"viewport":{}},"default":"map","requires":["fill-translate"],"expression":{"interpolated":false,"parameters":["zoom"]},"property-type":"data-constant"},"fill-pattern":{"type":"resolvedImage","transition":true,"expression":{"interpolated":false,"parameters":["zoom","feature"]},"property-type":"cross-faded-data-driven"}},"paint_fill-extrusion":{"fill-extrusion-opacity":{"type":"number","default":1,"minimum":0,"maximum":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"fill-extrusion-color":{"type":"color","default":"#000000","transition":true,"requires":[{"!":"fill-extrusion-pattern"}],"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state"]},"property-type":"data-driven"},"fill-extrusion-translate":{"type":"array","value":"number","length":2,"default":[0,0],"transition":true,"units":"pixels","expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"fill-extrusion-translate-anchor":{"type":"enum","values":{"map":{},"viewport":{}},"default":"map","requires":["fill-extrusion-translate"],"expression":{"interpolated":false,"parameters":["zoom"]},"property-type":"data-constant"},"fill-extrusion-pattern":{"type":"resolvedImage","transition":true,"expression":{"interpolated":false,"parameters":["zoom","feature"]},"property-type":"cross-faded-data-driven"},"fill-extrusion-height":{"type":"number","default":0,"minimum":0,"units":"meters","transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state"]},"property-type":"data-driven"},"fill-extrusion-base":{"type":"number","default":0,"minimum":0,"units":"meters","transition":true,"requires":["fill-extrusion-height"],"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state"]},"property-type":"data-driven"},"fill-extrusion-vertical-gradient":{"type":"boolean","default":true,"transition":false,"expression":{"interpolated":false,"parameters":["zoom"]},"property-type":"data-constant"}},"paint_line":{"line-opacity":{"type":"number","default":1,"minimum":0,"maximum":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state"]},"property-type":"data-driven"},"line-color":{"type":"color","default":"#000000","transition":true,"requires":[{"!":"line-pattern"}],"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state"]},"property-type":"data-driven"},"line-translate":{"type":"array","value":"number","length":2,"default":[0,0],"transition":true,"units":"pixels","expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"line-translate-anchor":{"type":"enum","values":{"map":{},"viewport":{}},"default":"map","requires":["line-translate"],"expression":{"interpolated":false,"parameters":["zoom"]},"property-type":"data-constant"},"line-width":{"type":"number","default":1,"minimum":0,"transition":true,"units":"pixels","expression":{"interpolated":true,"parameters":["zoom","feature","feature-state"]},"property-type":"data-driven"},"line-gap-width":{"type":"number","default":0,"minimum":0,"transition":true,"units":"pixels","expression":{"interpolated":true,"parameters":["zoom","feature","feature-state"]},"property-type":"data-driven"},"line-offset":{"type":"number","default":0,"transition":true,"units":"pixels","expression":{"interpolated":true,"parameters":["zoom","feature","feature-state"]},"property-type":"data-driven"},"line-blur":{"type":"number","default":0,"minimum":0,"transition":true,"units":"pixels","expression":{"interpolated":true,"parameters":["zoom","feature","feature-state"]},"property-type":"data-driven"},"line-dasharray":{"type":"array","value":"number","minimum":0,"transition":true,"units":"line widths","requires":[{"!":"line-pattern"}],"expression":{"interpolated":false,"parameters":["zoom","feature"]},"property-type":"cross-faded-data-driven"},"line-pattern":{"type":"resolvedImage","transition":true,"expression":{"interpolated":false,"parameters":["zoom","feature"]},"property-type":"cross-faded-data-driven"},"line-gradient":{"type":"color","transition":false,"requires":[{"!":"line-pattern"},{"source":"geojson","has":{"lineMetrics":true}}],"expression":{"interpolated":true,"parameters":["line-progress"]},"property-type":"color-ramp"},"line-trim-offset":{"type":"array","value":"number","length":2,"default":[0,0],"minimum":[0,0],"maximum":[1,1],"transition":false,"requires":[{"source":"geojson","has":{"lineMetrics":true}}],"property-type":"constant"}},"paint_circle":{"circle-radius":{"type":"number","default":5,"minimum":0,"transition":true,"units":"pixels","expression":{"interpolated":true,"parameters":["zoom","feature","feature-state"]},"property-type":"data-driven"},"circle-color":{"type":"color","default":"#000000","transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state"]},"property-type":"data-driven"},"circle-blur":{"type":"number","default":0,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state"]},"property-type":"data-driven"},"circle-opacity":{"type":"number","default":1,"minimum":0,"maximum":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state"]},"property-type":"data-driven"},"circle-translate":{"type":"array","value":"number","length":2,"default":[0,0],"transition":true,"units":"pixels","expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"circle-translate-anchor":{"type":"enum","values":{"map":{},"viewport":{}},"default":"map","requires":["circle-translate"],"expression":{"interpolated":false,"parameters":["zoom"]},"property-type":"data-constant"},"circle-pitch-scale":{"type":"enum","values":{"map":{},"viewport":{}},"default":"map","expression":{"interpolated":false,"parameters":["zoom"]},"property-type":"data-constant"},"circle-pitch-alignment":{"type":"enum","values":{"map":{},"viewport":{}},"default":"viewport","expression":{"interpolated":false,"parameters":["zoom"]},"property-type":"data-constant"},"circle-stroke-width":{"type":"number","default":0,"minimum":0,"transition":true,"units":"pixels","expression":{"interpolated":true,"parameters":["zoom","feature","feature-state"]},"property-type":"data-driven"},"circle-stroke-color":{"type":"color","default":"#000000","transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state"]},"property-type":"data-driven"},"circle-stroke-opacity":{"type":"number","default":1,"minimum":0,"maximum":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state"]},"property-type":"data-driven"}},"paint_heatmap":{"heatmap-radius":{"type":"number","default":30,"minimum":1,"transition":true,"units":"pixels","expression":{"interpolated":true,"parameters":["zoom","feature","feature-state"]},"property-type":"data-driven"},"heatmap-weight":{"type":"number","default":1,"minimum":0,"transition":false,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state"]},"property-type":"data-driven"},"heatmap-intensity":{"type":"number","default":1,"minimum":0,"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"heatmap-color":{"type":"color","default":["interpolate",["linear"],["heatmap-density"],0,"rgba(0, 0, 255, 0)",0.1,"royalblue",0.3,"cyan",0.5,"lime",0.7,"yellow",1,"red"],"transition":false,"expression":{"interpolated":true,"parameters":["heatmap-density"]},"property-type":"color-ramp"},"heatmap-opacity":{"type":"number","default":1,"minimum":0,"maximum":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"}},"paint_symbol":{"icon-opacity":{"type":"number","default":1,"minimum":0,"maximum":1,"transition":true,"requires":["icon-image"],"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state"]},"property-type":"data-driven"},"icon-color":{"type":"color","default":"#000000","transition":true,"requires":["icon-image"],"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state"]},"property-type":"data-driven"},"icon-halo-color":{"type":"color","default":"rgba(0, 0, 0, 0)","transition":true,"requires":["icon-image"],"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state"]},"property-type":"data-driven"},"icon-halo-width":{"type":"number","default":0,"minimum":0,"transition":true,"units":"pixels","requires":["icon-image"],"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state"]},"property-type":"data-driven"},"icon-halo-blur":{"type":"number","default":0,"minimum":0,"transition":true,"units":"pixels","requires":["icon-image"],"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state"]},"property-type":"data-driven"},"icon-translate":{"type":"array","value":"number","length":2,"default":[0,0],"transition":true,"units":"pixels","requires":["icon-image"],"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"icon-translate-anchor":{"type":"enum","values":{"map":{},"viewport":{}},"default":"map","requires":["icon-image","icon-translate"],"expression":{"interpolated":false,"parameters":["zoom"]},"property-type":"data-constant"},"text-opacity":{"type":"number","default":1,"minimum":0,"maximum":1,"transition":true,"requires":["text-field"],"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state"]},"property-type":"data-driven"},"text-color":{"type":"color","default":"#000000","transition":true,"overridable":true,"requires":["text-field"],"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state"]},"property-type":"data-driven"},"text-halo-color":{"type":"color","default":"rgba(0, 0, 0, 0)","transition":true,"requires":["text-field"],"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state"]},"property-type":"data-driven"},"text-halo-width":{"type":"number","default":0,"minimum":0,"transition":true,"units":"pixels","requires":["text-field"],"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state"]},"property-type":"data-driven"},"text-halo-blur":{"type":"number","default":0,"minimum":0,"transition":true,"units":"pixels","requires":["text-field"],"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state"]},"property-type":"data-driven"},"text-translate":{"type":"array","value":"number","length":2,"default":[0,0],"transition":true,"units":"pixels","requires":["text-field"],"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"text-translate-anchor":{"type":"enum","values":{"map":{},"viewport":{}},"default":"map","requires":["text-field","text-translate"],"expression":{"interpolated":false,"parameters":["zoom"]},"property-type":"data-constant"}},"paint_raster":{"raster-opacity":{"type":"number","default":1,"minimum":0,"maximum":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"raster-hue-rotate":{"type":"number","default":0,"period":360,"transition":true,"units":"degrees","expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"raster-brightness-min":{"type":"number","default":0,"minimum":0,"maximum":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"raster-brightness-max":{"type":"number","default":1,"minimum":0,"maximum":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"raster-saturation":{"type":"number","default":0,"minimum":-1,"maximum":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"raster-contrast":{"type":"number","default":0,"minimum":-1,"maximum":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"raster-resampling":{"type":"enum","values":{"linear":{},"nearest":{}},"default":"linear","expression":{"interpolated":false,"parameters":["zoom"]},"property-type":"data-constant"},"raster-fade-duration":{"type":"number","default":300,"minimum":0,"transition":false,"units":"milliseconds","expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"}},"paint_hillshade":{"hillshade-illumination-direction":{"type":"number","default":335,"minimum":0,"maximum":359,"transition":false,"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"hillshade-illumination-anchor":{"type":"enum","values":{"map":{},"viewport":{}},"default":"viewport","expression":{"interpolated":false,"parameters":["zoom"]},"property-type":"data-constant"},"hillshade-exaggeration":{"type":"number","default":0.5,"minimum":0,"maximum":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"hillshade-shadow-color":{"type":"color","default":"#000000","transition":true,"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"hillshade-highlight-color":{"type":"color","default":"#FFFFFF","transition":true,"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"hillshade-accent-color":{"type":"color","default":"#000000","transition":true,"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"}},"paint_background":{"background-color":{"type":"color","default":"#000000","transition":true,"requires":[{"!":"background-pattern"}],"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"background-pattern":{"type":"resolvedImage","transition":true,"expression":{"interpolated":false,"parameters":["zoom"]},"property-type":"cross-faded"},"background-opacity":{"type":"number","default":1,"minimum":0,"maximum":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"}},"paint_sky":{"sky-type":{"type":"enum","values":{"gradient":{},"atmosphere":{}},"default":"atmosphere","expression":{"interpolated":false,"parameters":["zoom"]},"property-type":"data-constant"},"sky-atmosphere-sun":{"type":"array","value":"number","length":2,"units":"degrees","minimum":[0,0],"maximum":[360,180],"transition":false,"requires":[{"sky-type":"atmosphere"}],"expression":{"interpolated":false,"parameters":["zoom"]},"property-type":"data-constant"},"sky-atmosphere-sun-intensity":{"type":"number","requires":[{"sky-type":"atmosphere"}],"default":10,"minimum":0,"maximum":100,"transition":false,"property-type":"data-constant"},"sky-gradient-center":{"type":"array","requires":[{"sky-type":"gradient"}],"value":"number","default":[0,0],"length":2,"units":"degrees","minimum":[0,0],"maximum":[360,180],"transition":false,"expression":{"interpolated":false,"parameters":["zoom"]},"property-type":"data-constant"},"sky-gradient-radius":{"type":"number","requires":[{"sky-type":"gradient"}],"default":90,"minimum":0,"maximum":180,"transition":false,"expression":{"interpolated":false,"parameters":["zoom"]},"property-type":"data-constant"},"sky-gradient":{"type":"color","default":["interpolate",["linear"],["sky-radial-progress"],0.8,"#87ceeb",1,"white"],"transition":false,"requires":[{"sky-type":"gradient"}],"expression":{"interpolated":true,"parameters":["sky-radial-progress"]},"property-type":"color-ramp"},"sky-atmosphere-halo-color":{"type":"color","default":"white","transition":false,"requires":[{"sky-type":"atmosphere"}],"property-type":"data-constant"},"sky-atmosphere-color":{"type":"color","default":"white","transition":false,"requires":[{"sky-type":"atmosphere"}],"property-type":"data-constant"},"sky-opacity":{"type":"number","default":1,"minimum":0,"maximum":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"}},"transition":{"duration":{"type":"number","default":300,"minimum":0,"units":"milliseconds"},"delay":{"type":"number","default":0,"minimum":0,"units":"milliseconds"}},"property-type":{"data-driven":{"type":"property-type"},"cross-faded":{"type":"property-type"},"cross-faded-data-driven":{"type":"property-type"},"color-ramp":{"type":"property-type"},"data-constant":{"type":"property-type"},"constant":{"type":"property-type"}},"promoteId":{"*":{"type":"string"}}}');function Jr(i,...e){for(const r of e)for(const s in r)i[s]=r[s];return i}function Hi(i){return i instanceof Number||i instanceof String||i instanceof Boolean?i.valueOf():i}function on(i){if(Array.isArray(i))return i.map(on);if(i instanceof Object&&!(i instanceof Number||i instanceof String||i instanceof Boolean)){const e={};for(const r in i)e[r]=on(i[r]);return e}return Hi(i)}class Kp extends Error{constructor(e,r){super(r),this.message=r,this.key=e}}var Qr=Kp;class Qa{constructor(e,r=[]){this.parent=e,this.bindings={};for(const[s,c]of r)this.bindings[s]=c}concat(e){return new Qa(this,e)}get(e){if(this.bindings[e])return this.bindings[e];if(this.parent)return this.parent.get(e);throw new Error(`${e} not found in scope.`)}has(e){return!!this.bindings[e]||!!this.parent&&this.parent.has(e)}}var Gu=Qa;const ia={kind:"null"},St={kind:"number"},mi={kind:"string"},li={kind:"boolean"},bn={kind:"color"},Uo={kind:"object"},ni={kind:"value"},Kn={kind:"collator"},cs={kind:"formatted"},ra={kind:"resolvedImage"};function sn(i,e){return{kind:"array",itemType:i,N:e}}function Yi(i){if(i.kind==="array"){const e=Yi(i.itemType);return typeof i.N=="number"?`array<${e}, ${i.N}>`:i.itemType.kind==="value"?"array":`array<${e}>`}return i.kind}const qu=[ia,St,mi,li,bn,cs,Uo,sn(ni),ra];function us(i,e){if(e.kind==="error")return null;if(i.kind==="array"){if(e.kind==="array"&&(e.N===0&&e.itemType.kind==="value"||!us(i.itemType,e.itemType))&&(typeof i.N!="number"||i.N===e.N))return null}else{if(i.kind===e.kind)return null;if(i.kind==="value"){for(const r of qu)if(!us(r,e))return null}}return`Expected ${Yi(i)} but found ${Yi(e)} instead.`}function el(i,e){return e.some(r=>r.kind===i.kind)}function hs(i,e){return e.some(r=>r==="null"?i===null:r==="array"?Array.isArray(i):r==="object"?i&&!Array.isArray(i)&&typeof i=="object":r===typeof i)}function ps(i){var e={exports:{}};return i(e,e.exports),e.exports}var Zu=ps(function(i,e){var r={transparent:[0,0,0,0],aliceblue:[240,248,255,1],antiquewhite:[250,235,215,1],aqua:[0,255,255,1],aquamarine:[127,255,212,1],azure:[240,255,255,1],beige:[245,245,220,1],bisque:[255,228,196,1],black:[0,0,0,1],blanchedalmond:[255,235,205,1],blue:[0,0,255,1],blueviolet:[138,43,226,1],brown:[165,42,42,1],burlywood:[222,184,135,1],cadetblue:[95,158,160,1],chartreuse:[127,255,0,1],chocolate:[210,105,30,1],coral:[255,127,80,1],cornflowerblue:[100,149,237,1],cornsilk:[255,248,220,1],crimson:[220,20,60,1],cyan:[0,255,255,1],darkblue:[0,0,139,1],darkcyan:[0,139,139,1],darkgoldenrod:[184,134,11,1],darkgray:[169,169,169,1],darkgreen:[0,100,0,1],darkgrey:[169,169,169,1],darkkhaki:[189,183,107,1],darkmagenta:[139,0,139,1],darkolivegreen:[85,107,47,1],darkorange:[255,140,0,1],darkorchid:[153,50,204,1],darkred:[139,0,0,1],darksalmon:[233,150,122,1],darkseagreen:[143,188,143,1],darkslateblue:[72,61,139,1],darkslategray:[47,79,79,1],darkslategrey:[47,79,79,1],darkturquoise:[0,206,209,1],darkviolet:[148,0,211,1],deeppink:[255,20,147,1],deepskyblue:[0,191,255,1],dimgray:[105,105,105,1],dimgrey:[105,105,105,1],dodgerblue:[30,144,255,1],firebrick:[178,34,34,1],floralwhite:[255,250,240,1],forestgreen:[34,139,34,1],fuchsia:[255,0,255,1],gainsboro:[220,220,220,1],ghostwhite:[248,248,255,1],gold:[255,215,0,1],goldenrod:[218,165,32,1],gray:[128,128,128,1],green:[0,128,0,1],greenyellow:[173,255,47,1],grey:[128,128,128,1],honeydew:[240,255,240,1],hotpink:[255,105,180,1],indianred:[205,92,92,1],indigo:[75,0,130,1],ivory:[255,255,240,1],khaki:[240,230,140,1],lavender:[230,230,250,1],lavenderblush:[255,240,245,1],lawngreen:[124,252,0,1],lemonchiffon:[255,250,205,1],lightblue:[173,216,230,1],lightcoral:[240,128,128,1],lightcyan:[224,255,255,1],lightgoldenrodyellow:[250,250,210,1],lightgray:[211,211,211,1],lightgreen:[144,238,144,1],lightgrey:[211,211,211,1],lightpink:[255,182,193,1],lightsalmon:[255,160,122,1],lightseagreen:[32,178,170,1],lightskyblue:[135,206,250,1],lightslategray:[119,136,153,1],lightslategrey:[119,136,153,1],lightsteelblue:[176,196,222,1],lightyellow:[255,255,224,1],lime:[0,255,0,1],limegreen:[50,205,50,1],linen:[250,240,230,1],magenta:[255,0,255,1],maroon:[128,0,0,1],mediumaquamarine:[102,205,170,1],mediumblue:[0,0,205,1],mediumorchid:[186,85,211,1],mediumpurple:[147,112,219,1],mediumseagreen:[60,179,113,1],mediumslateblue:[123,104,238,1],mediumspringgreen:[0,250,154,1],mediumturquoise:[72,209,204,1],mediumvioletred:[199,21,133,1],midnightblue:[25,25,112,1],mintcream:[245,255,250,1],mistyrose:[255,228,225,1],moccasin:[255,228,181,1],navajowhite:[255,222,173,1],navy:[0,0,128,1],oldlace:[253,245,230,1],olive:[128,128,0,1],olivedrab:[107,142,35,1],orange:[255,165,0,1],orangered:[255,69,0,1],orchid:[218,112,214,1],palegoldenrod:[238,232,170,1],palegreen:[152,251,152,1],paleturquoise:[175,238,238,1],palevioletred:[219,112,147,1],papayawhip:[255,239,213,1],peachpuff:[255,218,185,1],peru:[205,133,63,1],pink:[255,192,203,1],plum:[221,160,221,1],powderblue:[176,224,230,1],purple:[128,0,128,1],rebeccapurple:[102,51,153,1],red:[255,0,0,1],rosybrown:[188,143,143,1],royalblue:[65,105,225,1],saddlebrown:[139,69,19,1],salmon:[250,128,114,1],sandybrown:[244,164,96,1],seagreen:[46,139,87,1],seashell:[255,245,238,1],sienna:[160,82,45,1],silver:[192,192,192,1],skyblue:[135,206,235,1],slateblue:[106,90,205,1],slategray:[112,128,144,1],slategrey:[112,128,144,1],snow:[255,250,250,1],springgreen:[0,255,127,1],steelblue:[70,130,180,1],tan:[210,180,140,1],teal:[0,128,128,1],thistle:[216,191,216,1],tomato:[255,99,71,1],turquoise:[64,224,208,1],violet:[238,130,238,1],wheat:[245,222,179,1],white:[255,255,255,1],whitesmoke:[245,245,245,1],yellow:[255,255,0,1],yellowgreen:[154,205,50,1]};function s(x){return(x=Math.round(x))<0?0:x>255?255:x}function c(x){return s(x[x.length-1]==="%"?parseFloat(x)/100*255:parseInt(x))}function f(x){return(E=x[x.length-1]==="%"?parseFloat(x)/100:parseFloat(x))<0?0:E>1?1:E;var E}function _(x,E,A){return A<0?A+=1:A>1&&(A-=1),6*A<1?x+(E-x)*A*6:2*A<1?E:3*A<2?x+(E-x)*(2/3-A)*6:x}try{e.parseCSSColor=function(x){var E,A=x.replace(/ /g,"").toLowerCase();if(A in r)return r[A].slice();if(A[0]==="#")return A.length===4?(E=parseInt(A.substr(1),16))>=0&&E<=4095?[(3840&E)>>4|(3840&E)>>8,240&E|(240&E)>>4,15&E|(15&E)<<4,1]:null:A.length===7&&(E=parseInt(A.substr(1),16))>=0&&E<=16777215?[(16711680&E)>>16,(65280&E)>>8,255&E,1]:null;var C=A.indexOf("("),L=A.indexOf(")");if(C!==-1&&L+1===A.length){var B=A.substr(0,C),U=A.substr(C+1,L-(C+1)).split(","),N=1;switch(B){case"rgba":if(U.length!==4)return null;N=f(U.pop());case"rgb":return U.length!==3?null:[c(U[0]),c(U[1]),c(U[2]),N];case"hsla":if(U.length!==4)return null;N=f(U.pop());case"hsl":if(U.length!==3)return null;var $=(parseFloat(U[0])%360+360)%360/360,te=f(U[1]),ue=f(U[2]),ve=ue<=.5?ue*(te+1):ue+te-ue*te,ye=2*ue-ve;return[s(255*_(ye,ve,$+1/3)),s(255*_(ye,ve,$)),s(255*_(ye,ve,$-1/3)),N];default:return null}}return null}}catch{}});class _r{constructor(e,r,s,c=1){this.r=e,this.g=r,this.b=s,this.a=c}static parse(e){if(!e)return;if(e instanceof _r)return e;if(typeof e!="string")return;const r=Zu.parseCSSColor(e);return r?new _r(r[0]/255*r[3],r[1]/255*r[3],r[2]/255*r[3],r[3]):void 0}toString(){const[e,r,s,c]=this.toArray();return`rgba(${Math.round(e)},${Math.round(r)},${Math.round(s)},${c})`}toArray(){const{r:e,g:r,b:s,a:c}=this;return c===0?[0,0,0,0]:[255*e/c,255*r/c,255*s/c,c]}toArray01(){const{r:e,g:r,b:s,a:c}=this;return c===0?[0,0,0,0]:[e/c,r/c,s/c,c]}toArray01PremultipliedAlpha(){const{r:e,g:r,b:s,a:c}=this;return[e,r,s,c]}}_r.black=new _r(0,0,0,1),_r.white=new _r(1,1,1,1),_r.transparent=new _r(0,0,0,0),_r.red=new _r(1,0,0,1),_r.blue=new _r(0,0,1,1);var tr=_r;class an{constructor(e,r,s){this.sensitivity=e?r?"variant":"case":r?"accent":"base",this.locale=s,this.collator=new Intl.Collator(this.locale?this.locale:[],{sensitivity:this.sensitivity,usage:"search"})}compare(e,r){return this.collator.compare(e,r)}resolvedLocale(){return new Intl.Collator(this.locale?this.locale:[]).resolvedOptions().locale}}class uc{constructor(e,r,s,c,f){this.text=e.normalize?e.normalize():e,this.image=r,this.scale=s,this.fontStack=c,this.textColor=f}}class Cr{constructor(e){this.sections=e}static fromString(e){return new Cr([new uc(e,null,null,null,null)])}isEmpty(){return this.sections.length===0||!this.sections.some(e=>e.text.length!==0||e.image&&e.image.name.length!==0)}static factory(e){return e instanceof Cr?e:Cr.fromString(e)}toString(){return this.sections.length===0?"":this.sections.map(e=>e.text).join("")}serialize(){const e=["format"];for(const r of this.sections){if(r.image){e.push(["image",r.image.name]);continue}e.push(r.text);const s={};r.fontStack&&(s["text-font"]=["literal",r.fontStack.split(",")]),r.scale&&(s["font-scale"]=r.scale),r.textColor&&(s["text-color"]=["rgba"].concat(r.textColor.toArray())),e.push(s)}return e}}class ln{constructor(e){this.name=e.name,this.available=e.available}toString(){return this.name}static fromString(e){return e?new ln({name:e,available:!1}):null}serialize(){return["image",this.name]}}function tl(i,e,r,s){return typeof i=="number"&&i>=0&&i<=255&&typeof e=="number"&&e>=0&&e<=255&&typeof r=="number"&&r>=0&&r<=255?s===void 0||typeof s=="number"&&s>=0&&s<=1?null:`Invalid rgba value [${[i,e,r,s].join(", ")}]: 'a' must be between 0 and 1.`:`Invalid rgba value [${(typeof s=="number"?[i,e,r,s]:[i,e,r]).join(", ")}]: 'r', 'g', and 'b' must be between 0 and 255.`}function na(i){if(i===null||typeof i=="string"||typeof i=="boolean"||typeof i=="number"||i instanceof tr||i instanceof an||i instanceof Cr||i instanceof ln)return!0;if(Array.isArray(i)){for(const e of i)if(!na(e))return!1;return!0}if(typeof i=="object"){for(const e in i)if(!na(i[e]))return!1;return!0}return!1}function Qi(i){if(i===null)return ia;if(typeof i=="string")return mi;if(typeof i=="boolean")return li;if(typeof i=="number")return St;if(i instanceof tr)return bn;if(i instanceof an)return Kn;if(i instanceof Cr)return cs;if(i instanceof ln)return ra;if(Array.isArray(i)){const e=i.length;let r;for(const s of i){const c=Qi(s);if(r){if(r===c)continue;r=ni;break}r=c}return sn(r||ni,e)}return Uo}function Vo(i){const e=typeof i;return i===null?"":e==="string"||e==="number"||e==="boolean"?String(i):i instanceof tr||i instanceof Cr||i instanceof ln?i.toString():JSON.stringify(i)}class hc{constructor(e,r){this.type=e,this.value=r}static parse(e,r){if(e.length!==2)return r.error(`'literal' expression requires exactly one argument, but found ${e.length-1} instead.`);if(!na(e[1]))return r.error("invalid value");const s=e[1];let c=Qi(s);const f=r.expectedType;return c.kind!=="array"||c.N!==0||!f||f.kind!=="array"||typeof f.N=="number"&&f.N!==0||(c=f),new hc(c,s)}evaluate(){return this.value}eachChild(){}outputDefined(){return!0}serialize(){return this.type.kind==="array"||this.type.kind==="object"?["literal",this.value]:this.value instanceof tr?["rgba"].concat(this.value.toArray()):this.value instanceof Cr?this.value.serialize():this.value}}var oa=hc,Tr=class{constructor(i){this.name="ExpressionEvaluationError",this.message=i}toJSON(){return this.message}};const il={string:mi,number:St,boolean:li,object:Uo};class sa{constructor(e,r){this.type=e,this.args=r}static parse(e,r){if(e.length<2)return r.error("Expected at least one argument.");let s,c=1;const f=e[0];if(f==="array"){let x,E;if(e.length>2){const A=e[1];if(typeof A!="string"||!(A in il)||A==="object")return r.error('The item type argument of "array" must be one of string, number, boolean',1);x=il[A],c++}else x=ni;if(e.length>3){if(e[2]!==null&&(typeof e[2]!="number"||e[2]<0||e[2]!==Math.floor(e[2])))return r.error('The length argument to "array" must be a positive integer literal',2);E=e[2],c++}s=sn(x,E)}else s=il[f];const _=[];for(;c<e.length;c++){const x=r.parse(e[c],c,ni);if(!x)return null;_.push(x)}return new sa(s,_)}evaluate(e){for(let r=0;r<this.args.length;r++){const s=this.args[r].evaluate(e);if(!us(this.type,Qi(s)))return s;if(r===this.args.length-1)throw new Tr(`Expected value to be of type ${Yi(this.type)}, but found ${Yi(Qi(s))} instead.`)}return null}eachChild(e){this.args.forEach(e)}outputDefined(){return this.args.every(e=>e.outputDefined())}serialize(){const e=this.type,r=[e.kind];if(e.kind==="array"){const s=e.itemType;if(s.kind==="string"||s.kind==="number"||s.kind==="boolean"){r.push(s.kind);const c=e.N;(typeof c=="number"||this.args.length>1)&&r.push(c)}}return r.concat(this.args.map(s=>s.serialize()))}}var Jn=sa;class go{constructor(e){this.type=cs,this.sections=e}static parse(e,r){if(e.length<2)return r.error("Expected at least one argument.");const s=e[1];if(!Array.isArray(s)&&typeof s=="object")return r.error("First argument must be an image or text section.");const c=[];let f=!1;for(let _=1;_<=e.length-1;++_){const x=e[_];if(f&&typeof x=="object"&&!Array.isArray(x)){f=!1;let E=null;if(x["font-scale"]&&(E=r.parse(x["font-scale"],1,St),!E))return null;let A=null;if(x["text-font"]&&(A=r.parse(x["text-font"],1,sn(mi)),!A))return null;let C=null;if(x["text-color"]&&(C=r.parse(x["text-color"],1,bn),!C))return null;const L=c[c.length-1];L.scale=E,L.font=A,L.textColor=C}else{const E=r.parse(e[_],1,ni);if(!E)return null;const A=E.type.kind;if(A!=="string"&&A!=="value"&&A!=="null"&&A!=="resolvedImage")return r.error("Formatted text type must be 'string', 'value', 'image' or 'null'.");f=!0,c.push({content:E,scale:null,font:null,textColor:null})}}return new go(c)}evaluate(e){return new Cr(this.sections.map(r=>{const s=r.content.evaluate(e);return Qi(s)===ra?new uc("",s,null,null,null):new uc(Vo(s),null,r.scale?r.scale.evaluate(e):null,r.font?r.font.evaluate(e).join(","):null,r.textColor?r.textColor.evaluate(e):null)}))}eachChild(e){for(const r of this.sections)e(r.content),r.scale&&e(r.scale),r.font&&e(r.font),r.textColor&&e(r.textColor)}outputDefined(){return!1}serialize(){const e=["format"];for(const r of this.sections){e.push(r.content.serialize());const s={};r.scale&&(s["font-scale"]=r.scale.serialize()),r.font&&(s["text-font"]=r.font.serialize()),r.textColor&&(s["text-color"]=r.textColor.serialize()),e.push(s)}return e}}class rl{constructor(e){this.type=ra,this.input=e}static parse(e,r){if(e.length!==2)return r.error("Expected two arguments.");const s=r.parse(e[1],1,mi);return s?new rl(s):r.error("No image name provided.")}evaluate(e){const r=this.input.evaluate(e),s=ln.fromString(r);return s&&e.availableImages&&(s.available=e.availableImages.indexOf(r)>-1),s}eachChild(e){e(this.input)}outputDefined(){return!1}serialize(){return["image",this.input.serialize()]}}const Jp={"to-boolean":li,"to-color":bn,"to-number":St,"to-string":mi};class pc{constructor(e,r){this.type=e,this.args=r}static parse(e,r){if(e.length<2)return r.error("Expected at least one argument.");const s=e[0];if((s==="to-boolean"||s==="to-string")&&e.length!==2)return r.error("Expected one argument.");const c=Jp[s],f=[];for(let _=1;_<e.length;_++){const x=r.parse(e[_],_,ni);if(!x)return null;f.push(x)}return new pc(c,f)}evaluate(e){if(this.type.kind==="boolean")return Boolean(this.args[0].evaluate(e));if(this.type.kind==="color"){let r,s;for(const c of this.args){if(r=c.evaluate(e),s=null,r instanceof tr)return r;if(typeof r=="string"){const f=e.parseColor(r);if(f)return f}else if(Array.isArray(r)&&(s=r.length<3||r.length>4?`Invalid rbga value ${JSON.stringify(r)}: expected an array containing either three or four numeric values.`:tl(r[0],r[1],r[2],r[3]),!s))return new tr(r[0]/255,r[1]/255,r[2]/255,r[3])}throw new Tr(s||`Could not parse color from value '${typeof r=="string"?r:String(JSON.stringify(r))}'`)}if(this.type.kind==="number"){let r=null;for(const s of this.args){if(r=s.evaluate(e),r===null)return 0;const c=Number(r);if(!isNaN(c))return c}throw new Tr(`Could not convert ${JSON.stringify(r)} to number.`)}return this.type.kind==="formatted"?Cr.fromString(Vo(this.args[0].evaluate(e))):this.type.kind==="resolvedImage"?ln.fromString(Vo(this.args[0].evaluate(e))):Vo(this.args[0].evaluate(e))}eachChild(e){this.args.forEach(e)}outputDefined(){return this.args.every(e=>e.outputDefined())}serialize(){if(this.type.kind==="formatted")return new go([{content:this.args[0],scale:null,font:null,textColor:null}]).serialize();if(this.type.kind==="resolvedImage")return new rl(this.args[0]).serialize();const e=[`to-${this.type.kind}`];return this.eachChild(r=>{e.push(r.serialize())}),e}}var fs=pc;const Qp=["Unknown","Point","LineString","Polygon"];var $u=class{constructor(){this.globals=null,this.feature=null,this.featureState=null,this.formattedSection=null,this._parseColorCache={},this.availableImages=null,this.canonical=null,this.featureTileCoord=null,this.featureDistanceData=null}id(){return this.feature&&"id"in this.feature&&this.feature.id?this.feature.id:null}geometryType(){return this.feature?typeof this.feature.type=="number"?Qp[this.feature.type]:this.feature.type:null}geometry(){return this.feature&&"geometry"in this.feature?this.feature.geometry:null}canonicalID(){return this.canonical}properties(){return this.feature&&this.feature.properties||{}}distanceFromCenter(){if(this.featureTileCoord&&this.featureDistanceData){const i=this.featureDistanceData.center,e=this.featureDistanceData.scale,{x:r,y:s}=this.featureTileCoord;return this.featureDistanceData.bearing[0]*(r*e-i[0])+this.featureDistanceData.bearing[1]*(s*e-i[1])}return 0}parseColor(i){let e=this._parseColorCache[i];return e||(e=this._parseColorCache[i]=tr.parse(i)),e}};class ds{constructor(e,r,s,c){this.name=e,this.type=r,this._evaluate=s,this.args=c}evaluate(e){return this._evaluate(e,this.args)}eachChild(e){this.args.forEach(e)}outputDefined(){return!1}serialize(){return[this.name].concat(this.args.map(e=>e.serialize()))}static parse(e,r){const s=e[0],c=ds.definitions[s];if(!c)return r.error(`Unknown expression "${s}". If you wanted a literal array, use ["literal", [...]].`,0);const f=Array.isArray(c)?c[0]:c.type,_=Array.isArray(c)?[[c[1],c[2]]]:c.overloads,x=_.filter(([A])=>!Array.isArray(A)||A.length===e.length-1);let E=null;for(const[A,C]of x){E=new Yu(r.registry,r.path,null,r.scope);const L=[];let B=!1;for(let U=1;U<e.length;U++){const N=e[U],$=Array.isArray(A)?A[U-1]:A.type,te=E.parse(N,1+L.length,$);if(!te){B=!0;break}L.push(te)}if(!B)if(Array.isArray(A)&&A.length!==L.length)E.error(`Expected ${A.length} arguments, but found ${L.length} instead.`);else{for(let U=0;U<L.length;U++){const N=Array.isArray(A)?A[U]:A.type,$=L[U];E.concat(U+1).checkSubtype(N,$.type)}if(E.errors.length===0)return new ds(s,f,C,L)}}if(x.length===1)r.errors.push(...E.errors);else{const A=(x.length?x:_).map(([L])=>{return B=L,Array.isArray(B)?`(${B.map(Yi).join(", ")})`:`(${Yi(B.type)}...)`;var B}).join(" | "),C=[];for(let L=1;L<e.length;L++){const B=r.parse(e[L],1+C.length);if(!B)return null;C.push(Yi(B.type))}r.error(`Expected arguments of type ${A}, but found (${C.join(", ")}) instead.`)}return null}static register(e,r){ds.definitions=r;for(const s in r)e[s]=ds}}var Qn=ds;class No{constructor(e,r,s){this.type=Kn,this.locale=s,this.caseSensitive=e,this.diacriticSensitive=r}static parse(e,r){if(e.length!==2)return r.error("Expected one argument.");const s=e[1];if(typeof s!="object"||Array.isArray(s))return r.error("Collator options argument must be an object.");const c=r.parse(s["case-sensitive"]!==void 0&&s["case-sensitive"],1,li);if(!c)return null;const f=r.parse(s["diacritic-sensitive"]!==void 0&&s["diacritic-sensitive"],1,li);if(!f)return null;let _=null;return s.locale&&(_=r.parse(s.locale,1,mi),!_)?null:new No(c,f,_)}evaluate(e){return new an(this.caseSensitive.evaluate(e),this.diacriticSensitive.evaluate(e),this.locale?this.locale.evaluate(e):null)}eachChild(e){e(this.caseSensitive),e(this.diacriticSensitive),this.locale&&e(this.locale)}outputDefined(){return!1}serialize(){const e={};return e["case-sensitive"]=this.caseSensitive.serialize(),e["diacritic-sensitive"]=this.diacriticSensitive.serialize(),this.locale&&(e.locale=this.locale.serialize()),["collator",e]}}const yo=8192;function fc(i,e){i[0]=Math.min(i[0],e[0]),i[1]=Math.min(i[1],e[1]),i[2]=Math.max(i[2],e[0]),i[3]=Math.max(i[3],e[1])}function nl(i,e){return!(i[0]<=e[0]||i[2]>=e[2]||i[1]<=e[1]||i[3]>=e[3])}function ef(i,e){const r=(180+i[0])/360,s=(180-180/Math.PI*Math.log(Math.tan(Math.PI/4+i[1]*Math.PI/360)))/360,c=Math.pow(2,e.z);return[Math.round(r*c*yo),Math.round(s*c*yo)]}function tf(i,e,r){const s=i[0]-e[0],c=i[1]-e[1],f=i[0]-r[0],_=i[1]-r[1];return s*_-f*c==0&&s*f<=0&&c*_<=0}function dc(i,e){let r=!1;for(let _=0,x=e.length;_<x;_++){const E=e[_];for(let A=0,C=E.length;A<C-1;A++){if(tf(i,E[A],E[A+1]))return!1;(c=E[A])[1]>(s=i)[1]!=(f=E[A+1])[1]>s[1]&&s[0]<(f[0]-c[0])*(s[1]-c[1])/(f[1]-c[1])+c[0]&&(r=!r)}}var s,c,f;return r}function Wu(i,e){for(let r=0;r<e.length;r++)if(dc(i,e[r]))return!0;return!1}function aa(i,e,r,s){const c=s[0]-r[0],f=s[1]-r[1],_=(i[0]-r[0])*f-c*(i[1]-r[1]),x=(e[0]-r[0])*f-c*(e[1]-r[1]);return _>0&&x<0||_<0&&x>0}function rf(i,e,r){for(const A of r)for(let C=0;C<A.length-1;++C)if((x=[(_=A[C+1])[0]-(f=A[C])[0],_[1]-f[1]])[0]*(E=[(c=e)[0]-(s=i)[0],c[1]-s[1]])[1]-x[1]*E[0]!=0&&aa(s,c,f,_)&&aa(f,_,s,c))return!0;var s,c,f,_,x,E;return!1}function Xu(i,e){for(let r=0;r<i.length;++r)if(!dc(i[r],e))return!1;for(let r=0;r<i.length-1;++r)if(rf(i[r],i[r+1],e))return!1;return!0}function nf(i,e){for(let r=0;r<e.length;r++)if(Xu(i,e[r]))return!0;return!1}function mc(i,e,r){const s=[];for(let c=0;c<i.length;c++){const f=[];for(let _=0;_<i[c].length;_++){const x=ef(i[c][_],r);fc(e,x),f.push(x)}s.push(f)}return s}function wn(i,e,r){const s=[];for(let c=0;c<i.length;c++){const f=mc(i[c],e,r);s.push(f)}return s}function _c(i,e,r,s){if(i[0]<r[0]||i[0]>r[2]){const c=.5*s;let f=i[0]-r[0]>c?-s:r[0]-i[0]>c?s:0;f===0&&(f=i[0]-r[2]>c?-s:r[2]-i[0]>c?s:0),i[0]+=f}fc(e,i)}function gc(i,e,r,s){const c=Math.pow(2,s.z)*yo,f=[s.x*yo,s.y*yo],_=[];if(!i)return _;for(const x of i)for(const E of x){const A=[E.x+f[0],E.y+f[1]];_c(A,e,r,c),_.push(A)}return _}function la(i,e,r,s){const c=Math.pow(2,s.z)*yo,f=[s.x*yo,s.y*yo],_=[];if(!i)return _;for(const E of i){const A=[];for(const C of E){const L=[C.x+f[0],C.y+f[1]];fc(e,L),A.push(L)}_.push(A)}if(e[2]-e[0]<=c/2){(x=e)[0]=x[1]=1/0,x[2]=x[3]=-1/0;for(const E of _)for(const A of E)_c(A,e,r,c)}var x;return _}class eo{constructor(e,r){this.type=li,this.geojson=e,this.geometries=r}static parse(e,r){if(e.length!==2)return r.error(`'within' expression requires exactly one argument, but found ${e.length-1} instead.`);if(na(e[1])){const s=e[1];if(s.type==="FeatureCollection")for(let c=0;c<s.features.length;++c){const f=s.features[c].geometry.type;if(f==="Polygon"||f==="MultiPolygon")return new eo(s,s.features[c].geometry)}else if(s.type==="Feature"){const c=s.geometry.type;if(c==="Polygon"||c==="MultiPolygon")return new eo(s,s.geometry)}else if(s.type==="Polygon"||s.type==="MultiPolygon")return new eo(s,s)}return r.error("'within' expression requires valid geojson object that contains polygon geometry type.")}evaluate(e){if(e.geometry()!=null&&e.canonicalID()!=null){if(e.geometryType()==="Point")return function(r,s){const c=[1/0,1/0,-1/0,-1/0],f=[1/0,1/0,-1/0,-1/0],_=r.canonicalID();if(!_)return!1;if(s.type==="Polygon"){const x=mc(s.coordinates,f,_),E=gc(r.geometry(),c,f,_);if(!nl(c,f))return!1;for(const A of E)if(!dc(A,x))return!1}if(s.type==="MultiPolygon"){const x=wn(s.coordinates,f,_),E=gc(r.geometry(),c,f,_);if(!nl(c,f))return!1;for(const A of E)if(!Wu(A,x))return!1}return!0}(e,this.geometries);if(e.geometryType()==="LineString")return function(r,s){const c=[1/0,1/0,-1/0,-1/0],f=[1/0,1/0,-1/0,-1/0],_=r.canonicalID();if(!_)return!1;if(s.type==="Polygon"){const x=mc(s.coordinates,f,_),E=la(r.geometry(),c,f,_);if(!nl(c,f))return!1;for(const A of E)if(!Xu(A,x))return!1}if(s.type==="MultiPolygon"){const x=wn(s.coordinates,f,_),E=la(r.geometry(),c,f,_);if(!nl(c,f))return!1;for(const A of E)if(!nf(A,x))return!1}return!0}(e,this.geometries)}return!1}eachChild(){}outputDefined(){return!0}serialize(){return["within",this.geojson]}}var ol=eo;function ms(i){if(i instanceof Qn&&(i.name==="get"&&i.args.length===1||i.name==="feature-state"||i.name==="has"&&i.args.length===1||i.name==="properties"||i.name==="geometry-type"||i.name==="id"||/^filter-/.test(i.name))||i instanceof ol)return!1;let e=!0;return i.eachChild(r=>{e&&!ms(r)&&(e=!1)}),e}function _s(i){if(i instanceof Qn&&i.name==="feature-state")return!1;let e=!0;return i.eachChild(r=>{e&&!_s(r)&&(e=!1)}),e}function sl(i,e){if(i instanceof Qn&&e.indexOf(i.name)>=0)return!1;let r=!0;return i.eachChild(s=>{r&&!sl(s,e)&&(r=!1)}),r}class Ai{constructor(e,r){this.type=r.type,this.name=e,this.boundExpression=r}static parse(e,r){if(e.length!==2||typeof e[1]!="string")return r.error("'var' expression requires exactly one string literal argument.");const s=e[1];return r.scope.has(s)?new Ai(s,r.scope.get(s)):r.error(`Unknown variable "${s}". Make sure "${s}" has been bound in an enclosing "let" expression before using it.`,1)}evaluate(e){return this.boundExpression.evaluate(e)}eachChild(){}outputDefined(){return!1}serialize(){return["var",this.name]}}var Hu=Ai;class yc{constructor(e,r=[],s,c=new Gu,f=[]){this.registry=e,this.path=r,this.key=r.map(_=>`[${_}]`).join(""),this.scope=c,this.errors=f,this.expectedType=s}parse(e,r,s,c,f={}){return r?this.concat(r,s,c)._parse(e,f):this._parse(e,f)}_parse(e,r){function s(c,f,_){return _==="assert"?new Jn(f,[c]):_==="coerce"?new fs(f,[c]):c}if(e!==null&&typeof e!="string"&&typeof e!="boolean"&&typeof e!="number"||(e=["literal",e]),Array.isArray(e)){if(e.length===0)return this.error('Expected an array with at least one element. If you wanted a literal array, use ["literal", []].');const c=e[0];if(typeof c!="string")return this.error(`Expression name must be a string, but found ${typeof c} instead. If you wanted a literal array, use ["literal", [...]].`,0),null;const f=this.registry[c];if(f){let _=f.parse(e,this);if(!_)return null;if(this.expectedType){const x=this.expectedType,E=_.type;if(x.kind!=="string"&&x.kind!=="number"&&x.kind!=="boolean"&&x.kind!=="object"&&x.kind!=="array"||E.kind!=="value")if(x.kind!=="color"&&x.kind!=="formatted"&&x.kind!=="resolvedImage"||E.kind!=="value"&&E.kind!=="string"){if(this.checkSubtype(x,E))return null}else _=s(_,x,r.typeAnnotation||"coerce");else _=s(_,x,r.typeAnnotation||"assert")}if(!(_ instanceof oa)&&_.type.kind!=="resolvedImage"&&al(_)){const x=new $u;try{_=new oa(_.type,_.evaluate(x))}catch(E){return this.error(E.message),null}}return _}return this.error(`Unknown expression "${c}". If you wanted a literal array, use ["literal", [...]].`,0)}return this.error(e===void 0?"'undefined' value invalid. Use null instead.":typeof e=="object"?'Bare objects invalid. Use ["literal", {...}] instead.':`Expected an array, but found ${typeof e} instead.`)}concat(e,r,s){const c=typeof e=="number"?this.path.concat(e):this.path,f=s?this.scope.concat(s):this.scope;return new yc(this.registry,c,r||null,f,this.errors)}error(e,...r){const s=`${this.key}${r.map(c=>`[${c}]`).join("")}`;this.errors.push(new Qr(s,e))}checkSubtype(e,r){const s=us(e,r);return s&&this.error(s),s}}var Yu=yc;function al(i){if(i instanceof Hu)return al(i.boundExpression);if(i instanceof Qn&&i.name==="error"||i instanceof No||i instanceof ol)return!1;const e=i instanceof fs||i instanceof Jn;let r=!0;return i.eachChild(s=>{r=e?r&&al(s):r&&s instanceof oa}),!!r&&ms(i)&&sl(i,["zoom","heatmap-density","line-progress","sky-radial-progress","accumulated","is-supported-script","pitch","distance-from-center"])}function ll(i,e){const r=i.length-1;let s,c,f=0,_=r,x=0;for(;f<=_;)if(x=Math.floor((f+_)/2),s=i[x],c=i[x+1],s<=e){if(x===r||e<c)return x;f=x+1}else{if(!(s>e))throw new Tr("Input is not a number.");_=x-1}return 0}class cl{constructor(e,r,s){this.type=e,this.input=r,this.labels=[],this.outputs=[];for(const[c,f]of s)this.labels.push(c),this.outputs.push(f)}static parse(e,r){if(e.length-1<4)return r.error(`Expected at least 4 arguments, but found only ${e.length-1}.`);if((e.length-1)%2!=0)return r.error("Expected an even number of arguments.");const s=r.parse(e[1],1,St);if(!s)return null;const c=[];let f=null;r.expectedType&&r.expectedType.kind!=="value"&&(f=r.expectedType);for(let _=1;_<e.length;_+=2){const x=_===1?-1/0:e[_],E=e[_+1],A=_,C=_+1;if(typeof x!="number")return r.error('Input/output pairs for "step" expressions must be defined using literal numeric values (not computed expressions) for the input values.',A);if(c.length&&c[c.length-1][0]>=x)return r.error('Input/output pairs for "step" expressions must be arranged with input values in strictly ascending order.',A);const L=r.parse(E,C,f);if(!L)return null;f=f||L.type,c.push([x,L])}return new cl(f,s,c)}evaluate(e){const r=this.labels,s=this.outputs;if(r.length===1)return s[0].evaluate(e);const c=this.input.evaluate(e);if(c<=r[0])return s[0].evaluate(e);const f=r.length;return c>=r[f-1]?s[f-1].evaluate(e):s[ll(r,c)].evaluate(e)}eachChild(e){e(this.input);for(const r of this.outputs)e(r)}outputDefined(){return this.outputs.every(e=>e.outputDefined())}serialize(){const e=["step",this.input.serialize()];for(let r=0;r<this.labels.length;r++)r>0&&e.push(this.labels[r]),e.push(this.outputs[r].serialize());return e}}var ul=cl;function bi(i,e,r){return i*(1-r)+e*r}var ca=Object.freeze({__proto__:null,number:bi,color:function(i,e,r){return new tr(bi(i.r,e.r,r),bi(i.g,e.g,r),bi(i.b,e.b,r),bi(i.a,e.a,r))},array:function(i,e,r){return i.map((s,c)=>bi(s,e[c],r))}});const jo=.95047,ua=1.08883,Ku=4/29,ha=6/29,vc=3*ha*ha,of=Math.PI/180,sf=180/Math.PI;function hl(i){return i>.008856451679035631?Math.pow(i,1/3):i/vc+Ku}function xc(i){return i>ha?i*i*i:vc*(i-Ku)}function pl(i){return 255*(i<=.0031308?12.92*i:1.055*Math.pow(i,1/2.4)-.055)}function fl(i){return(i/=255)<=.04045?i/12.92:Math.pow((i+.055)/1.055,2.4)}function bc(i){const e=fl(i.r),r=fl(i.g),s=fl(i.b),c=hl((.4124564*e+.3575761*r+.1804375*s)/jo),f=hl((.2126729*e+.7151522*r+.072175*s)/1);return{l:116*f-16,a:500*(c-f),b:200*(f-hl((.0193339*e+.119192*r+.9503041*s)/ua)),alpha:i.a}}function Ju(i){let e=(i.l+16)/116,r=isNaN(i.a)?e:e+i.a/500,s=isNaN(i.b)?e:e-i.b/200;return e=1*xc(e),r=jo*xc(r),s=ua*xc(s),new tr(pl(3.2404542*r-1.5371385*e-.4985314*s),pl(-.969266*r+1.8760108*e+.041556*s),pl(.0556434*r-.2040259*e+1.0572252*s),i.alpha)}function Qu(i,e,r){const s=e-i;return i+r*(s>180||s<-180?s-360*Math.round(s/360):s)}const pa={forward:bc,reverse:Ju,interpolate:function(i,e,r){return{l:bi(i.l,e.l,r),a:bi(i.a,e.a,r),b:bi(i.b,e.b,r),alpha:bi(i.alpha,e.alpha,r)}}},gs={forward:function(i){const{l:e,a:r,b:s}=bc(i),c=Math.atan2(s,r)*sf;return{h:c<0?c+360:c,c:Math.sqrt(r*r+s*s),l:e,alpha:i.a}},reverse:function(i){const e=i.h*of,r=i.c;return Ju({l:i.l,a:Math.cos(e)*r,b:Math.sin(e)*r,alpha:i.alpha})},interpolate:function(i,e,r){return{h:Qu(i.h,e.h,r),c:bi(i.c,e.c,r),l:bi(i.l,e.l,r),alpha:bi(i.alpha,e.alpha,r)}}};var wc=Object.freeze({__proto__:null,lab:pa,hcl:gs});class dl{constructor(e,r,s,c,f){this.type=e,this.operator=r,this.interpolation=s,this.input=c,this.labels=[],this.outputs=[];for(const[_,x]of f)this.labels.push(_),this.outputs.push(x)}static interpolationFactor(e,r,s,c){let f=0;if(e.name==="exponential")f=Ec(r,e.base,s,c);else if(e.name==="linear")f=Ec(r,1,s,c);else if(e.name==="cubic-bezier"){const _=e.controlPoints;f=new T(_[0],_[1],_[2],_[3]).solve(Ec(r,1,s,c))}return f}static parse(e,r){let[s,c,f,..._]=e;if(!Array.isArray(c)||c.length===0)return r.error("Expected an interpolation type expression.",1);if(c[0]==="linear")c={name:"linear"};else if(c[0]==="exponential"){const A=c[1];if(typeof A!="number")return r.error("Exponential interpolation requires a numeric base.",1,1);c={name:"exponential",base:A}}else{if(c[0]!=="cubic-bezier")return r.error(`Unknown interpolation type ${String(c[0])}`,1,0);{const A=c.slice(1);if(A.length!==4||A.some(C=>typeof C!="number"||C<0||C>1))return r.error("Cubic bezier interpolation requires four numeric arguments with values between 0 and 1.",1);c={name:"cubic-bezier",controlPoints:A}}}if(e.length-1<4)return r.error(`Expected at least 4 arguments, but found only ${e.length-1}.`);if((e.length-1)%2!=0)return r.error("Expected an even number of arguments.");if(f=r.parse(f,2,St),!f)return null;const x=[];let E=null;s==="interpolate-hcl"||s==="interpolate-lab"?E=bn:r.expectedType&&r.expectedType.kind!=="value"&&(E=r.expectedType);for(let A=0;A<_.length;A+=2){const C=_[A],L=_[A+1],B=A+3,U=A+4;if(typeof C!="number")return r.error('Input/output pairs for "interpolate" expressions must be defined using literal numeric values (not computed expressions) for the input values.',B);if(x.length&&x[x.length-1][0]>=C)return r.error('Input/output pairs for "interpolate" expressions must be arranged with input values in strictly ascending order.',B);const N=r.parse(L,U,E);if(!N)return null;E=E||N.type,x.push([C,N])}return E.kind==="number"||E.kind==="color"||E.kind==="array"&&E.itemType.kind==="number"&&typeof E.N=="number"?new dl(E,s,c,f,x):r.error(`Type ${Yi(E)} is not interpolatable.`)}evaluate(e){const r=this.labels,s=this.outputs;if(r.length===1)return s[0].evaluate(e);const c=this.input.evaluate(e);if(c<=r[0])return s[0].evaluate(e);const f=r.length;if(c>=r[f-1])return s[f-1].evaluate(e);const _=ll(r,c),x=dl.interpolationFactor(this.interpolation,c,r[_],r[_+1]),E=s[_].evaluate(e),A=s[_+1].evaluate(e);return this.operator==="interpolate"?ca[this.type.kind.toLowerCase()](E,A,x):this.operator==="interpolate-hcl"?gs.reverse(gs.interpolate(gs.forward(E),gs.forward(A),x)):pa.reverse(pa.interpolate(pa.forward(E),pa.forward(A),x))}eachChild(e){e(this.input);for(const r of this.outputs)e(r)}outputDefined(){return this.outputs.every(e=>e.outputDefined())}serialize(){let e;e=this.interpolation.name==="linear"?["linear"]:this.interpolation.name==="exponential"?this.interpolation.base===1?["linear"]:["exponential",this.interpolation.base]:["cubic-bezier"].concat(this.interpolation.controlPoints);const r=[this.operator,e,this.input.serialize()];for(let s=0;s<this.labels.length;s++)r.push(this.labels[s],this.outputs[s].serialize());return r}}function Ec(i,e,r,s){const c=s-r,f=i-r;return c===0?0:e===1?f/c:(Math.pow(e,f)-1)/(Math.pow(e,c)-1)}var Ln=dl;class Tc{constructor(e,r){this.type=e,this.args=r}static parse(e,r){if(e.length<2)return r.error("Expectected at least one argument.");let s=null;const c=r.expectedType;c&&c.kind!=="value"&&(s=c);const f=[];for(const x of e.slice(1)){const E=r.parse(x,1+f.length,s,void 0,{typeAnnotation:"omit"});if(!E)return null;s=s||E.type,f.push(E)}const _=c&&f.some(x=>us(c,x.type));return new Tc(_?ni:s,f)}evaluate(e){let r,s=null,c=0;for(const f of this.args){if(c++,s=f.evaluate(e),s&&s instanceof ln&&!s.available&&(r||(r=s),s=null,c===this.args.length))return r;if(s!==null)break}return s}eachChild(e){this.args.forEach(e)}outputDefined(){return this.args.every(e=>e.outputDefined())}serialize(){const e=["coalesce"];return this.eachChild(r=>{e.push(r.serialize())}),e}}var eh=Tc;class Ac{constructor(e,r){this.type=r.type,this.bindings=[].concat(e),this.result=r}evaluate(e){return this.result.evaluate(e)}eachChild(e){for(const r of this.bindings)e(r[1]);e(this.result)}static parse(e,r){if(e.length<4)return r.error(`Expected at least 3 arguments, but found ${e.length-1} instead.`);const s=[];for(let f=1;f<e.length-1;f+=2){const _=e[f];if(typeof _!="string")return r.error(`Expected string, but found ${typeof _} instead.`,f);if(/[^a-zA-Z0-9_]/.test(_))return r.error("Variable names must contain only alphanumeric characters or '_'.",f);const x=r.parse(e[f+1],f+1);if(!x)return null;s.push([_,x])}const c=r.parse(e[e.length-1],e.length-1,r.expectedType,s);return c?new Ac(s,c):null}outputDefined(){return this.result.outputDefined()}serialize(){const e=["let"];for(const[r,s]of this.bindings)e.push(r,s.serialize());return e.push(this.result.serialize()),e}}var Sc=Ac;class Mc{constructor(e,r,s){this.type=e,this.index=r,this.input=s}static parse(e,r){if(e.length!==3)return r.error(`Expected 2 arguments, but found ${e.length-1} instead.`);const s=r.parse(e[1],1,St),c=r.parse(e[2],2,sn(r.expectedType||ni));return s&&c?new Mc(c.type.itemType,s,c):null}evaluate(e){const r=this.index.evaluate(e),s=this.input.evaluate(e);if(r<0)throw new Tr(`Array index out of bounds: ${r} < 0.`);if(r>=s.length)throw new Tr(`Array index out of bounds: ${r} > ${s.length-1}.`);if(r!==Math.floor(r))throw new Tr(`Array index must be an integer, but found ${r} instead.`);return s[r]}eachChild(e){e(this.index),e(this.input)}outputDefined(){return!1}serialize(){return["at",this.index.serialize(),this.input.serialize()]}}var af=Mc;class Ic{constructor(e,r){this.type=li,this.needle=e,this.haystack=r}static parse(e,r){if(e.length!==3)return r.error(`Expected 2 arguments, but found ${e.length-1} instead.`);const s=r.parse(e[1],1,ni),c=r.parse(e[2],2,ni);return s&&c?el(s.type,[li,mi,St,ia,ni])?new Ic(s,c):r.error(`Expected first argument to be of type boolean, string, number or null, but found ${Yi(s.type)} instead`):null}evaluate(e){const r=this.needle.evaluate(e),s=this.haystack.evaluate(e);if(s==null)return!1;if(!hs(r,["boolean","string","number","null"]))throw new Tr(`Expected first argument to be of type boolean, string, number or null, but found ${Yi(Qi(r))} instead.`);if(!hs(s,["string","array"]))throw new Tr(`Expected second argument to be of type array or string, but found ${Yi(Qi(s))} instead.`);return s.indexOf(r)>=0}eachChild(e){e(this.needle),e(this.haystack)}outputDefined(){return!0}serialize(){return["in",this.needle.serialize(),this.haystack.serialize()]}}var lf=Ic;class fa{constructor(e,r,s){this.type=St,this.needle=e,this.haystack=r,this.fromIndex=s}static parse(e,r){if(e.length<=2||e.length>=5)return r.error(`Expected 3 or 4 arguments, but found ${e.length-1} instead.`);const s=r.parse(e[1],1,ni),c=r.parse(e[2],2,ni);if(!s||!c)return null;if(!el(s.type,[li,mi,St,ia,ni]))return r.error(`Expected first argument to be of type boolean, string, number or null, but found ${Yi(s.type)} instead`);if(e.length===4){const f=r.parse(e[3],3,St);return f?new fa(s,c,f):null}return new fa(s,c)}evaluate(e){const r=this.needle.evaluate(e),s=this.haystack.evaluate(e);if(!hs(r,["boolean","string","number","null"]))throw new Tr(`Expected first argument to be of type boolean, string, number or null, but found ${Yi(Qi(r))} instead.`);if(!hs(s,["string","array"]))throw new Tr(`Expected second argument to be of type array or string, but found ${Yi(Qi(s))} instead.`);if(this.fromIndex){const c=this.fromIndex.evaluate(e);return s.indexOf(r,c)}return s.indexOf(r)}eachChild(e){e(this.needle),e(this.haystack),this.fromIndex&&e(this.fromIndex)}outputDefined(){return!1}serialize(){if(this.fromIndex!=null&&this.fromIndex!==void 0){const e=this.fromIndex.serialize();return["index-of",this.needle.serialize(),this.haystack.serialize(),e]}return["index-of",this.needle.serialize(),this.haystack.serialize()]}}var th=fa;class ml{constructor(e,r,s,c,f,_){this.inputType=e,this.type=r,this.input=s,this.cases=c,this.outputs=f,this.otherwise=_}static parse(e,r){if(e.length<5)return r.error(`Expected at least 4 arguments, but found only ${e.length-1}.`);if(e.length%2!=1)return r.error("Expected an even number of arguments.");let s,c;r.expectedType&&r.expectedType.kind!=="value"&&(c=r.expectedType);const f={},_=[];for(let A=2;A<e.length-1;A+=2){let C=e[A];const L=e[A+1];Array.isArray(C)||(C=[C]);const B=r.concat(A);if(C.length===0)return B.error("Expected at least one branch label.");for(const N of C){if(typeof N!="number"&&typeof N!="string")return B.error("Branch labels must be numbers or strings.");if(typeof N=="number"&&Math.abs(N)>Number.MAX_SAFE_INTEGER)return B.error(`Branch labels must be integers no larger than ${Number.MAX_SAFE_INTEGER}.`);if(typeof N=="number"&&Math.floor(N)!==N)return B.error("Numeric branch labels must be integer values.");if(s){if(B.checkSubtype(s,Qi(N)))return null}else s=Qi(N);if(f[String(N)]!==void 0)return B.error("Branch labels must be unique.");f[String(N)]=_.length}const U=r.parse(L,A,c);if(!U)return null;c=c||U.type,_.push(U)}const x=r.parse(e[1],1,ni);if(!x)return null;const E=r.parse(e[e.length-1],e.length-1,c);return E?x.type.kind!=="value"&&r.concat(1).checkSubtype(s,x.type)?null:new ml(s,c,x,f,_,E):null}evaluate(e){const r=this.input.evaluate(e);return(Qi(r)===this.inputType&&this.outputs[this.cases[r]]||this.otherwise).evaluate(e)}eachChild(e){e(this.input),this.outputs.forEach(e),e(this.otherwise)}outputDefined(){return this.outputs.every(e=>e.outputDefined())&&this.otherwise.outputDefined()}serialize(){const e=["match",this.input.serialize()],r=Object.keys(this.cases).sort(),s=[],c={};for(const _ of r){const x=c[this.cases[_]];x===void 0?(c[this.cases[_]]=s.length,s.push([this.cases[_],[_]])):s[x][1].push(_)}const f=_=>this.inputType.kind==="number"?Number(_):_;for(const[_,x]of s)e.push(x.length===1?f(x[0]):x.map(f)),e.push(this.outputs[_].serialize());return e.push(this.otherwise.serialize()),e}}var cf=ml;class kc{constructor(e,r,s){this.type=e,this.branches=r,this.otherwise=s}static parse(e,r){if(e.length<4)return r.error(`Expected at least 3 arguments, but found only ${e.length-1}.`);if(e.length%2!=0)return r.error("Expected an odd number of arguments.");let s;r.expectedType&&r.expectedType.kind!=="value"&&(s=r.expectedType);const c=[];for(let _=1;_<e.length-1;_+=2){const x=r.parse(e[_],_,li);if(!x)return null;const E=r.parse(e[_+1],_+1,s);if(!E)return null;c.push([x,E]),s=s||E.type}const f=r.parse(e[e.length-1],e.length-1,s);return f?new kc(s,c,f):null}evaluate(e){for(const[r,s]of this.branches)if(r.evaluate(e))return s.evaluate(e);return this.otherwise.evaluate(e)}eachChild(e){for(const[r,s]of this.branches)e(r),e(s);e(this.otherwise)}outputDefined(){return this.branches.every(([e,r])=>r.outputDefined())&&this.otherwise.outputDefined()}serialize(){const e=["case"];return this.eachChild(r=>{e.push(r.serialize())}),e}}var ih=kc;class da{constructor(e,r,s,c){this.type=e,this.input=r,this.beginIndex=s,this.endIndex=c}static parse(e,r){if(e.length<=2||e.length>=5)return r.error(`Expected 3 or 4 arguments, but found ${e.length-1} instead.`);const s=r.parse(e[1],1,ni),c=r.parse(e[2],2,St);if(!s||!c)return null;if(!el(s.type,[sn(ni),mi,ni]))return r.error(`Expected first argument to be of type array or string, but found ${Yi(s.type)} instead`);if(e.length===4){const f=r.parse(e[3],3,St);return f?new da(s.type,s,c,f):null}return new da(s.type,s,c)}evaluate(e){const r=this.input.evaluate(e),s=this.beginIndex.evaluate(e);if(!hs(r,["string","array"]))throw new Tr(`Expected first argument to be of type array or string, but found ${Yi(Qi(r))} instead.`);if(this.endIndex){const c=this.endIndex.evaluate(e);return r.slice(s,c)}return r.slice(s)}eachChild(e){e(this.input),e(this.beginIndex),this.endIndex&&e(this.endIndex)}outputDefined(){return!1}serialize(){if(this.endIndex!=null&&this.endIndex!==void 0){const e=this.endIndex.serialize();return["slice",this.input.serialize(),this.beginIndex.serialize(),e]}return["slice",this.input.serialize(),this.beginIndex.serialize()]}}var rh=da;function nh(i,e){return i==="=="||i==="!="?e.kind==="boolean"||e.kind==="string"||e.kind==="number"||e.kind==="null"||e.kind==="value":e.kind==="string"||e.kind==="number"||e.kind==="value"}function oh(i,e,r,s){return s.compare(e,r)===0}function ys(i,e,r){const s=i!=="=="&&i!=="!=";return class yy{constructor(f,_,x){this.type=li,this.lhs=f,this.rhs=_,this.collator=x,this.hasUntypedArgument=f.type.kind==="value"||_.type.kind==="value"}static parse(f,_){if(f.length!==3&&f.length!==4)return _.error("Expected two or three arguments.");const x=f[0];let E=_.parse(f[1],1,ni);if(!E)return null;if(!nh(x,E.type))return _.concat(1).error(`"${x}" comparisons are not supported for type '${Yi(E.type)}'.`);let A=_.parse(f[2],2,ni);if(!A)return null;if(!nh(x,A.type))return _.concat(2).error(`"${x}" comparisons are not supported for type '${Yi(A.type)}'.`);if(E.type.kind!==A.type.kind&&E.type.kind!=="value"&&A.type.kind!=="value")return _.error(`Cannot compare types '${Yi(E.type)}' and '${Yi(A.type)}'.`);s&&(E.type.kind==="value"&&A.type.kind!=="value"?E=new Jn(A.type,[E]):E.type.kind!=="value"&&A.type.kind==="value"&&(A=new Jn(E.type,[A])));let C=null;if(f.length===4){if(E.type.kind!=="string"&&A.type.kind!=="string"&&E.type.kind!=="value"&&A.type.kind!=="value")return _.error("Cannot use collator to compare non-string types.");if(C=_.parse(f[3],3,Kn),!C)return null}return new yy(E,A,C)}evaluate(f){const _=this.lhs.evaluate(f),x=this.rhs.evaluate(f);if(s&&this.hasUntypedArgument){const E=Qi(_),A=Qi(x);if(E.kind!==A.kind||E.kind!=="string"&&E.kind!=="number")throw new Tr(`Expected arguments for "${i}" to be (string, string) or (number, number), but found (${E.kind}, ${A.kind}) instead.`)}if(this.collator&&!s&&this.hasUntypedArgument){const E=Qi(_),A=Qi(x);if(E.kind!=="string"||A.kind!=="string")return e(f,_,x)}return this.collator?r(f,_,x,this.collator.evaluate(f)):e(f,_,x)}eachChild(f){f(this.lhs),f(this.rhs),this.collator&&f(this.collator)}outputDefined(){return!0}serialize(){const f=[i];return this.eachChild(_=>{f.push(_.serialize())}),f}}}const uf=ys("==",function(i,e,r){return e===r},oh),_l=ys("!=",function(i,e,r){return e!==r},function(i,e,r,s){return!oh(0,e,r,s)}),sh=ys("<",function(i,e,r){return e<r},function(i,e,r,s){return s.compare(e,r)<0}),ah=ys(">",function(i,e,r){return e>r},function(i,e,r,s){return s.compare(e,r)>0}),hf=ys("<=",function(i,e,r){return e<=r},function(i,e,r,s){return s.compare(e,r)<=0}),pf=ys(">=",function(i,e,r){return e>=r},function(i,e,r,s){return s.compare(e,r)>=0});class Cc{constructor(e,r,s,c,f){this.type=mi,this.number=e,this.locale=r,this.currency=s,this.minFractionDigits=c,this.maxFractionDigits=f}static parse(e,r){if(e.length!==3)return r.error("Expected two arguments.");const s=r.parse(e[1],1,St);if(!s)return null;const c=e[2];if(typeof c!="object"||Array.isArray(c))return r.error("NumberFormat options argument must be an object.");let f=null;if(c.locale&&(f=r.parse(c.locale,1,mi),!f))return null;let _=null;if(c.currency&&(_=r.parse(c.currency,1,mi),!_))return null;let x=null;if(c["min-fraction-digits"]&&(x=r.parse(c["min-fraction-digits"],1,St),!x))return null;let E=null;return c["max-fraction-digits"]&&(E=r.parse(c["max-fraction-digits"],1,St),!E)?null:new Cc(s,f,_,x,E)}evaluate(e){return new Intl.NumberFormat(this.locale?this.locale.evaluate(e):[],{style:this.currency?"currency":"decimal",currency:this.currency?this.currency.evaluate(e):void 0,minimumFractionDigits:this.minFractionDigits?this.minFractionDigits.evaluate(e):void 0,maximumFractionDigits:this.maxFractionDigits?this.maxFractionDigits.evaluate(e):void 0}).format(this.number.evaluate(e))}eachChild(e){e(this.number),this.locale&&e(this.locale),this.currency&&e(this.currency),this.minFractionDigits&&e(this.minFractionDigits),this.maxFractionDigits&&e(this.maxFractionDigits)}outputDefined(){return!1}serialize(){const e={};return this.locale&&(e.locale=this.locale.serialize()),this.currency&&(e.currency=this.currency.serialize()),this.minFractionDigits&&(e["min-fraction-digits"]=this.minFractionDigits.serialize()),this.maxFractionDigits&&(e["max-fraction-digits"]=this.maxFractionDigits.serialize()),["number-format",this.number.serialize(),e]}}class gl{constructor(e){this.type=St,this.input=e}static parse(e,r){if(e.length!==2)return r.error(`Expected 1 argument, but found ${e.length-1} instead.`);const s=r.parse(e[1],1);return s?s.type.kind!=="array"&&s.type.kind!=="string"&&s.type.kind!=="value"?r.error(`Expected argument of type string or array, but found ${Yi(s.type)} instead.`):new gl(s):null}evaluate(e){const r=this.input.evaluate(e);if(typeof r=="string"||Array.isArray(r))return r.length;throw new Tr(`Expected value to be of type string or array, but found ${Yi(Qi(r))} instead.`)}eachChild(e){e(this.input)}outputDefined(){return!1}serialize(){const e=["length"];return this.eachChild(r=>{e.push(r.serialize())}),e}}const zc={"==":uf,"!=":_l,">":ah,"<":sh,">=":pf,"<=":hf,array:Jn,at:af,boolean:Jn,case:ih,coalesce:eh,collator:No,format:go,image:rl,in:lf,"index-of":th,interpolate:Ln,"interpolate-hcl":Ln,"interpolate-lab":Ln,length:gl,let:Sc,literal:oa,match:cf,number:Jn,"number-format":Cc,object:Jn,slice:rh,step:ul,string:Jn,"to-boolean":fs,"to-color":fs,"to-number":fs,"to-string":fs,var:Hu,within:ol};function Pc(i,[e,r,s,c]){e=e.evaluate(i),r=r.evaluate(i),s=s.evaluate(i);const f=c?c.evaluate(i):1,_=tl(e,r,s,f);if(_)throw new Tr(_);return new tr(e/255*f,r/255*f,s/255*f,f)}function yl(i,e){return i in e}function Dc(i,e){const r=e[i];return r===void 0?null:r}function Go(i){return{type:i}}Qn.register(zc,{error:[{kind:"error"},[mi],(i,[e])=>{throw new Tr(e.evaluate(i))}],typeof:[mi,[ni],(i,[e])=>Yi(Qi(e.evaluate(i)))],"to-rgba":[sn(St,4),[bn],(i,[e])=>e.evaluate(i).toArray()],rgb:[bn,[St,St,St],Pc],rgba:[bn,[St,St,St,St],Pc],has:{type:li,overloads:[[[mi],(i,[e])=>yl(e.evaluate(i),i.properties())],[[mi,Uo],(i,[e,r])=>yl(e.evaluate(i),r.evaluate(i))]]},get:{type:ni,overloads:[[[mi],(i,[e])=>Dc(e.evaluate(i),i.properties())],[[mi,Uo],(i,[e,r])=>Dc(e.evaluate(i),r.evaluate(i))]]},"feature-state":[ni,[mi],(i,[e])=>Dc(e.evaluate(i),i.featureState||{})],properties:[Uo,[],i=>i.properties()],"geometry-type":[mi,[],i=>i.geometryType()],id:[ni,[],i=>i.id()],zoom:[St,[],i=>i.globals.zoom],pitch:[St,[],i=>i.globals.pitch||0],"distance-from-center":[St,[],i=>i.distanceFromCenter()],"heatmap-density":[St,[],i=>i.globals.heatmapDensity||0],"line-progress":[St,[],i=>i.globals.lineProgress||0],"sky-radial-progress":[St,[],i=>i.globals.skyRadialProgress||0],accumulated:[ni,[],i=>i.globals.accumulated===void 0?null:i.globals.accumulated],"+":[St,Go(St),(i,e)=>{let r=0;for(const s of e)r+=s.evaluate(i);return r}],"*":[St,Go(St),(i,e)=>{let r=1;for(const s of e)r*=s.evaluate(i);return r}],"-":{type:St,overloads:[[[St,St],(i,[e,r])=>e.evaluate(i)-r.evaluate(i)],[[St],(i,[e])=>-e.evaluate(i)]]},"/":[St,[St,St],(i,[e,r])=>e.evaluate(i)/r.evaluate(i)],"%":[St,[St,St],(i,[e,r])=>e.evaluate(i)%r.evaluate(i)],ln2:[St,[],()=>Math.LN2],pi:[St,[],()=>Math.PI],e:[St,[],()=>Math.E],"^":[St,[St,St],(i,[e,r])=>Math.pow(e.evaluate(i),r.evaluate(i))],sqrt:[St,[St],(i,[e])=>Math.sqrt(e.evaluate(i))],log10:[St,[St],(i,[e])=>Math.log(e.evaluate(i))/Math.LN10],ln:[St,[St],(i,[e])=>Math.log(e.evaluate(i))],log2:[St,[St],(i,[e])=>Math.log(e.evaluate(i))/Math.LN2],sin:[St,[St],(i,[e])=>Math.sin(e.evaluate(i))],cos:[St,[St],(i,[e])=>Math.cos(e.evaluate(i))],tan:[St,[St],(i,[e])=>Math.tan(e.evaluate(i))],asin:[St,[St],(i,[e])=>Math.asin(e.evaluate(i))],acos:[St,[St],(i,[e])=>Math.acos(e.evaluate(i))],atan:[St,[St],(i,[e])=>Math.atan(e.evaluate(i))],min:[St,Go(St),(i,e)=>Math.min(...e.map(r=>r.evaluate(i)))],max:[St,Go(St),(i,e)=>Math.max(...e.map(r=>r.evaluate(i)))],abs:[St,[St],(i,[e])=>Math.abs(e.evaluate(i))],round:[St,[St],(i,[e])=>{const r=e.evaluate(i);return r<0?-Math.round(-r):Math.round(r)}],floor:[St,[St],(i,[e])=>Math.floor(e.evaluate(i))],ceil:[St,[St],(i,[e])=>Math.ceil(e.evaluate(i))],"filter-==":[li,[mi,ni],(i,[e,r])=>i.properties()[e.value]===r.value],"filter-id-==":[li,[ni],(i,[e])=>i.id()===e.value],"filter-type-==":[li,[mi],(i,[e])=>i.geometryType()===e.value],"filter-<":[li,[mi,ni],(i,[e,r])=>{const s=i.properties()[e.value],c=r.value;return typeof s==typeof c&&s<c}],"filter-id-<":[li,[ni],(i,[e])=>{const r=i.id(),s=e.value;return typeof r==typeof s&&r<s}],"filter->":[li,[mi,ni],(i,[e,r])=>{const s=i.properties()[e.value],c=r.value;return typeof s==typeof c&&s>c}],"filter-id->":[li,[ni],(i,[e])=>{const r=i.id(),s=e.value;return typeof r==typeof s&&r>s}],"filter-<=":[li,[mi,ni],(i,[e,r])=>{const s=i.properties()[e.value],c=r.value;return typeof s==typeof c&&s<=c}],"filter-id-<=":[li,[ni],(i,[e])=>{const r=i.id(),s=e.value;return typeof r==typeof s&&r<=s}],"filter->=":[li,[mi,ni],(i,[e,r])=>{const s=i.properties()[e.value],c=r.value;return typeof s==typeof c&&s>=c}],"filter-id->=":[li,[ni],(i,[e])=>{const r=i.id(),s=e.value;return typeof r==typeof s&&r>=s}],"filter-has":[li,[ni],(i,[e])=>e.value in i.properties()],"filter-has-id":[li,[],i=>i.id()!==null&&i.id()!==void 0],"filter-type-in":[li,[sn(mi)],(i,[e])=>e.value.indexOf(i.geometryType())>=0],"filter-id-in":[li,[sn(ni)],(i,[e])=>e.value.indexOf(i.id())>=0],"filter-in-small":[li,[mi,sn(ni)],(i,[e,r])=>r.value.indexOf(i.properties()[e.value])>=0],"filter-in-large":[li,[mi,sn(ni)],(i,[e,r])=>function(s,c,f,_){for(;f<=_;){const x=f+_>>1;if(c[x]===s)return!0;c[x]>s?_=x-1:f=x+1}return!1}(i.properties()[e.value],r.value,0,r.value.length-1)],all:{type:li,overloads:[[[li,li],(i,[e,r])=>e.evaluate(i)&&r.evaluate(i)],[Go(li),(i,e)=>{for(const r of e)if(!r.evaluate(i))return!1;return!0}]]},any:{type:li,overloads:[[[li,li],(i,[e,r])=>e.evaluate(i)||r.evaluate(i)],[Go(li),(i,e)=>{for(const r of e)if(r.evaluate(i))return!0;return!1}]]},"!":[li,[li],(i,[e])=>!e.evaluate(i)],"is-supported-script":[li,[mi],(i,[e])=>{const r=i.globals&&i.globals.isSupportedScript;return!r||r(e.evaluate(i))}],upcase:[mi,[mi],(i,[e])=>e.evaluate(i).toUpperCase()],downcase:[mi,[mi],(i,[e])=>e.evaluate(i).toLowerCase()],concat:[mi,Go(ni),(i,e)=>e.map(r=>Vo(r.evaluate(i))).join("")],"resolved-locale":[mi,[Kn],(i,[e])=>e.evaluate(i).resolvedLocale()]});var ma=zc;function lh(i){return{result:"success",value:i}}function vs(i){return{result:"error",value:i}}function xs(i){return i["property-type"]==="data-driven"||i["property-type"]==="cross-faded-data-driven"}function Lc(i){return!!i.expression&&i.expression.parameters.indexOf("zoom")>-1}function vl(i){return!!i.expression&&i.expression.interpolated}function wi(i){return i instanceof Number?"number":i instanceof String?"string":i instanceof Boolean?"boolean":Array.isArray(i)?"array":i===null?"null":typeof i}function xl(i){return typeof i=="object"&&i!==null&&!Array.isArray(i)}function ff(i){return i}function ch(i,e){const r=e.type==="color",s=i.stops&&typeof i.stops[0][0]=="object",c=s||!(s||i.property!==void 0),f=i.type||(vl(e)?"exponential":"interval");if(r&&((i=Jr({},i)).stops&&(i.stops=i.stops.map(A=>[A[0],tr.parse(A[1])])),i.default=tr.parse(i.default?i.default:e.default)),i.colorSpace&&i.colorSpace!=="rgb"&&!wc[i.colorSpace])throw new Error(`Unknown color space: ${i.colorSpace}`);let _,x,E;if(f==="exponential")_=hh;else if(f==="interval")_=bs;else if(f==="categorical"){_=uh,x=Object.create(null);for(const A of i.stops)x[A[0]]=A[1];E=typeof i.stops[0][0]}else{if(f!=="identity")throw new Error(`Unknown function type "${f}"`);_=df}if(s){const A={},C=[];for(let U=0;U<i.stops.length;U++){const N=i.stops[U],$=N[0].zoom;A[$]===void 0&&(A[$]={zoom:$,type:i.type,property:i.property,default:i.default,stops:[]},C.push($)),A[$].stops.push([N[0].value,N[1]])}const L=[];for(const U of C)L.push([A[U].zoom,ch(A[U],e)]);const B={name:"linear"};return{kind:"composite",interpolationType:B,interpolationFactor:Ln.interpolationFactor.bind(void 0,B),zoomStops:L.map(U=>U[0]),evaluate:({zoom:U},N)=>hh({stops:L,base:i.base},e,U).evaluate(U,N)}}if(c){const A=f==="exponential"?{name:"exponential",base:i.base!==void 0?i.base:1}:null;return{kind:"camera",interpolationType:A,interpolationFactor:Ln.interpolationFactor.bind(void 0,A),zoomStops:i.stops.map(C=>C[0]),evaluate:({zoom:C})=>_(i,e,C,x,E)}}return{kind:"source",evaluate(A,C){const L=C&&C.properties?C.properties[i.property]:void 0;return L===void 0?cn(i.default,e.default):_(i,e,L,x,E)}}}function cn(i,e,r){return i!==void 0?i:e!==void 0?e:r!==void 0?r:void 0}function uh(i,e,r,s,c){return cn(typeof r===c?s[r]:void 0,i.default,e.default)}function bs(i,e,r){if(wi(r)!=="number")return cn(i.default,e.default);const s=i.stops.length;if(s===1||r<=i.stops[0][0])return i.stops[0][1];if(r>=i.stops[s-1][0])return i.stops[s-1][1];const c=ll(i.stops.map(f=>f[0]),r);return i.stops[c][1]}function hh(i,e,r){const s=i.base!==void 0?i.base:1;if(wi(r)!=="number")return cn(i.default,e.default);const c=i.stops.length;if(c===1||r<=i.stops[0][0])return i.stops[0][1];if(r>=i.stops[c-1][0])return i.stops[c-1][1];const f=ll(i.stops.map(C=>C[0]),r),_=function(C,L,B,U){const N=U-B,$=C-B;return N===0?0:L===1?$/N:(Math.pow(L,$)-1)/(Math.pow(L,N)-1)}(r,s,i.stops[f][0],i.stops[f+1][0]),x=i.stops[f][1],E=i.stops[f+1][1];let A=ca[e.type]||ff;if(i.colorSpace&&i.colorSpace!=="rgb"){const C=wc[i.colorSpace];A=(L,B)=>C.reverse(C.interpolate(C.forward(L),C.forward(B),_))}return typeof x.evaluate=="function"?{evaluate(...C){const L=x.evaluate.apply(void 0,C),B=E.evaluate.apply(void 0,C);if(L!==void 0&&B!==void 0)return A(L,B,_)}}:A(x,E,_)}function df(i,e,r){return e.type==="color"?r=tr.parse(r):e.type==="formatted"?r=Cr.fromString(r.toString()):e.type==="resolvedImage"?r=ln.fromString(r.toString()):wi(r)===e.type||e.type==="enum"&&e.values[r]||(r=void 0),cn(r,i.default,e.default)}class bl{constructor(e,r){this.expression=e,this._warningHistory={},this._evaluator=new $u,this._defaultValue=r?function(s){return s.type==="color"&&(xl(s.default)||Array.isArray(s.default))?new tr(0,0,0,0):s.type==="color"?tr.parse(s.default)||null:s.default===void 0?null:s.default}(r):null,this._enumValues=r&&r.type==="enum"?r.values:null}evaluateWithoutErrorHandling(e,r,s,c,f,_,x,E){return this._evaluator.globals=e,this._evaluator.feature=r,this._evaluator.featureState=s,this._evaluator.canonical=c||null,this._evaluator.availableImages=f||null,this._evaluator.formattedSection=_,this._evaluator.featureTileCoord=x||null,this._evaluator.featureDistanceData=E||null,this.expression.evaluate(this._evaluator)}evaluate(e,r,s,c,f,_,x,E){this._evaluator.globals=e,this._evaluator.feature=r||null,this._evaluator.featureState=s||null,this._evaluator.canonical=c||null,this._evaluator.availableImages=f||null,this._evaluator.formattedSection=_||null,this._evaluator.featureTileCoord=x||null,this._evaluator.featureDistanceData=E||null;try{const A=this.expression.evaluate(this._evaluator);if(A==null||typeof A=="number"&&A!=A)return this._defaultValue;if(this._enumValues&&!(A in this._enumValues))throw new Tr(`Expected value to be one of ${Object.keys(this._enumValues).map(C=>JSON.stringify(C)).join(", ")}, but found ${JSON.stringify(A)} instead.`);return A}catch(A){return this._warningHistory[A.message]||(this._warningHistory[A.message]=!0,typeof console!="undefined"&&console.warn(A.message)),this._defaultValue}}}function wl(i){return Array.isArray(i)&&i.length>0&&typeof i[0]=="string"&&i[0]in ma}function qo(i,e){const r=new Yu(ma,[],e?function(c){const f={color:bn,string:mi,number:St,enum:mi,boolean:li,formatted:cs,resolvedImage:ra};return c.type==="array"?sn(f[c.value]||ni,c.length):f[c.type]}(e):void 0),s=r.parse(i,void 0,void 0,void 0,e&&e.type==="string"?{typeAnnotation:"coerce"}:void 0);return s?lh(new bl(s,e)):vs(r.errors)}class El{constructor(e,r){this.kind=e,this._styleExpression=r,this.isStateDependent=e!=="constant"&&!_s(r.expression)}evaluateWithoutErrorHandling(e,r,s,c,f,_){return this._styleExpression.evaluateWithoutErrorHandling(e,r,s,c,f,_)}evaluate(e,r,s,c,f,_){return this._styleExpression.evaluate(e,r,s,c,f,_)}}class _a{constructor(e,r,s,c){this.kind=e,this.zoomStops=s,this._styleExpression=r,this.isStateDependent=e!=="camera"&&!_s(r.expression),this.interpolationType=c}evaluateWithoutErrorHandling(e,r,s,c,f,_){return this._styleExpression.evaluateWithoutErrorHandling(e,r,s,c,f,_)}evaluate(e,r,s,c,f,_){return this._styleExpression.evaluate(e,r,s,c,f,_)}interpolationFactor(e,r,s){return this.interpolationType?Ln.interpolationFactor(this.interpolationType,e,r,s):0}}function Tl(i,e){if((i=qo(i,e)).result==="error")return i;const r=i.value.expression,s=ms(r);if(!s&&!xs(e))return vs([new Qr("","data expressions not supported")]);const c=sl(r,["zoom","pitch","distance-from-center"]);if(!c&&!Lc(e))return vs([new Qr("","zoom expressions not supported")]);const f=ws(r);return f||c?f instanceof Qr?vs([f]):f instanceof Ln&&!vl(e)?vs([new Qr("",'"interpolate" expressions cannot be used with this property')]):lh(f?new _a(s?"camera":"composite",i.value,f.labels,f instanceof Ln?f.interpolation:void 0):new El(s?"constant":"source",i.value)):vs([new Qr("",'"zoom" expression may only be used as input to a top-level "step" or "interpolate" expression.')])}class ga{constructor(e,r){this._parameters=e,this._specification=r,Jr(this,ch(this._parameters,this._specification))}static deserialize(e){return new ga(e._parameters,e._specification)}static serialize(e){return{_parameters:e._parameters,_specification:e._specification}}}function ws(i){let e=null;if(i instanceof Sc)e=ws(i.result);else if(i instanceof eh){for(const r of i.args)if(e=ws(r),e)break}else(i instanceof ul||i instanceof Ln)&&i.input instanceof Qn&&i.input.name==="zoom"&&(e=i);return e instanceof Qr||i.eachChild(r=>{const s=ws(r);s instanceof Qr?e=s:!e&&s?e=new Qr("",'"zoom" expression may only be used as input to a top-level "step" or "interpolate" expression.'):e&&s&&e!==s&&(e=new Qr("",'Only one zoom-based "step" or "interpolate" subexpression may be used in an expression.'))}),e}class kt{constructor(e,r,s,c){this.message=(e?`${e}: `:"")+s,c&&(this.identifier=c),r!=null&&r.__line__&&(this.line=r.__line__)}}function un(i){const e=i.key,r=i.value,s=i.valueSpec||{},c=i.objectElementValidators||{},f=i.style,_=i.styleSpec;let x=[];const E=wi(r);if(E!=="object")return[new kt(e,r,`object expected, ${E} found`)];for(const A in r){const C=A.split(".")[0],L=s[C]||s["*"];let B;c[C]?B=c[C]:s[C]?B=xr:c["*"]?B=c["*"]:s["*"]&&(B=xr),B?x=x.concat(B({key:(e&&`${e}.`)+A,value:r[A],valueSpec:L,style:f,styleSpec:_,object:r,objectKey:A},r)):x.push(new kt(e,r[A],`unknown property "${A}"`))}for(const A in s)c[A]||s[A].required&&s[A].default===void 0&&r[A]===void 0&&x.push(new kt(e,r,`missing required property "${A}"`));return x}function ya(i){const e=i.value,r=i.valueSpec,s=i.style,c=i.styleSpec,f=i.key,_=i.arrayElementValidator||xr;if(wi(e)!=="array")return[new kt(f,e,`array expected, ${wi(e)} found`)];if(r.length&&e.length!==r.length)return[new kt(f,e,`array length ${r.length} expected, length ${e.length} found`)];if(r["min-length"]&&e.length<r["min-length"])return[new kt(f,e,`array length at least ${r["min-length"]} expected, length ${e.length} found`)];let x={type:r.value,values:r.values,minimum:r.minimum,maximum:r.maximum,function:void 0};c.$version<7&&(x.function=r.function),wi(r.value)==="object"&&(x=r.value);let E=[];for(let A=0;A<e.length;A++)E=E.concat(_({array:e,arrayIndex:A,value:e[A],valueSpec:x,style:s,styleSpec:c,key:`${f}[${A}]`}));return E}function Zo(i){const e=i.key,r=i.value,s=i.valueSpec;let c=wi(r);if(c==="number"&&r!=r&&(c="NaN"),c!=="number")return[new kt(e,r,`number expected, ${c} found`)];if("minimum"in s){let f=s.minimum;if(wi(s.minimum)==="array"&&(f=s.minimum[i.arrayIndex]),r<f)return[new kt(e,r,`${r} is less than the minimum value ${f}`)]}if("maximum"in s){let f=s.maximum;if(wi(s.maximum)==="array"&&(f=s.maximum[i.arrayIndex]),r>f)return[new kt(e,r,`${r} is greater than the maximum value ${f}`)]}return[]}function Rc(i){const e=i.valueSpec,r=Hi(i.value.type);let s,c,f,_={};const x=r!=="categorical"&&i.value.property===void 0,E=!x,A=wi(i.value.stops)==="array"&&wi(i.value.stops[0])==="array"&&wi(i.value.stops[0][0])==="object",C=un({key:i.key,value:i.value,valueSpec:i.styleSpec.function,style:i.style,styleSpec:i.styleSpec,objectElementValidators:{stops:function(U){if(r==="identity")return[new kt(U.key,U.value,'identity function may not have a "stops" property')];let N=[];const $=U.value;return N=N.concat(ya({key:U.key,value:$,valueSpec:U.valueSpec,style:U.style,styleSpec:U.styleSpec,arrayElementValidator:L})),wi($)==="array"&&$.length===0&&N.push(new kt(U.key,$,"array must have at least one stop")),N},default:function(U){return xr({key:U.key,value:U.value,valueSpec:e,style:U.style,styleSpec:U.styleSpec})}}});return r==="identity"&&x&&C.push(new kt(i.key,i.value,'missing required property "property"')),r==="identity"||i.value.stops||C.push(new kt(i.key,i.value,'missing required property "stops"')),r==="exponential"&&i.valueSpec.expression&&!vl(i.valueSpec)&&C.push(new kt(i.key,i.value,"exponential functions not supported")),i.styleSpec.$version>=8&&(E&&!xs(i.valueSpec)?C.push(new kt(i.key,i.value,"property functions not supported")):x&&!Lc(i.valueSpec)&&C.push(new kt(i.key,i.value,"zoom functions not supported"))),r!=="categorical"&&!A||i.value.property!==void 0||C.push(new kt(i.key,i.value,'"property" property is required')),C;function L(U){let N=[];const $=U.value,te=U.key;if(wi($)!=="array")return[new kt(te,$,`array expected, ${wi($)} found`)];if($.length!==2)return[new kt(te,$,`array length 2 expected, length ${$.length} found`)];if(A){if(wi($[0])!=="object")return[new kt(te,$,`object expected, ${wi($[0])} found`)];if($[0].zoom===void 0)return[new kt(te,$,"object stop key must have zoom")];if($[0].value===void 0)return[new kt(te,$,"object stop key must have value")];const ue=Hi($[0].zoom);if(typeof ue!="number")return[new kt(te,$[0].zoom,"stop zoom values must be numbers")];if(f&&f>ue)return[new kt(te,$[0].zoom,"stop zoom values must appear in ascending order")];ue!==f&&(f=ue,c=void 0,_={}),N=N.concat(un({key:`${te}[0]`,value:$[0],valueSpec:{zoom:{}},style:U.style,styleSpec:U.styleSpec,objectElementValidators:{zoom:Zo,value:B}}))}else N=N.concat(B({key:`${te}[0]`,value:$[0],valueSpec:{},style:U.style,styleSpec:U.styleSpec},$));return wl(on($[1]))?N.concat([new kt(`${te}[1]`,$[1],"expressions are not allowed in function stops.")]):N.concat(xr({key:`${te}[1]`,value:$[1],valueSpec:e,style:U.style,styleSpec:U.styleSpec}))}function B(U,N){const $=wi(U.value),te=Hi(U.value),ue=U.value!==null?U.value:N;if(s){if($!==s)return[new kt(U.key,ue,`${$} stop domain type must match previous stop domain type ${s}`)]}else s=$;if($!=="number"&&$!=="string"&&$!=="boolean"&&typeof te!="number"&&typeof te!="string"&&typeof te!="boolean")return[new kt(U.key,ue,"stop domain value must be a number, string, or boolean")];if($!=="number"&&r!=="categorical"){let ve=`number expected, ${$} found`;return xs(e)&&r===void 0&&(ve+='\nIf you intended to use a categorical function, specify `"type": "categorical"`.'),[new kt(U.key,ue,ve)]}return r!=="categorical"||$!=="number"||typeof te=="number"&&isFinite(te)&&Math.floor(te)===te?r!=="categorical"&&$==="number"&&typeof te=="number"&&typeof c=="number"&&c!==void 0&&te<c?[new kt(U.key,ue,"stop domain values must appear in ascending order")]:(c=te,r==="categorical"&&te in _?[new kt(U.key,ue,"stop domain values must be unique")]:(_[te]=!0,[])):[new kt(U.key,ue,`integer expected, found ${String(te)}`)]}}function $o(i){const e=(i.expressionContext==="property"?Tl:qo)(on(i.value),i.valueSpec);if(e.result==="error")return e.value.map(s=>new kt(`${i.key}${s.key}`,i.value,s.message));const r=e.value.expression||e.value._styleExpression.expression;if(i.expressionContext==="property"&&i.propertyKey==="text-font"&&!r.outputDefined())return[new kt(i.key,i.value,`Invalid data expression for "${i.propertyKey}". Output values must be contained as literals within the expression.`)];if(i.expressionContext==="property"&&i.propertyType==="layout"&&!_s(r))return[new kt(i.key,i.value,'"feature-state" data expressions are not supported with layout properties.')];if(i.expressionContext==="filter")return Al(r,i);if(i.expressionContext&&i.expressionContext.indexOf("cluster")===0){if(!sl(r,["zoom","feature-state"]))return[new kt(i.key,i.value,'"zoom" and "feature-state" expressions are not supported with cluster properties.')];if(i.expressionContext==="cluster-initial"&&!ms(r))return[new kt(i.key,i.value,"Feature data expressions are not supported with initial expression part of cluster properties.")]}return[]}function Al(i,e){const r=new Set(["zoom","feature-state","pitch","distance-from-center"]);if(e.valueSpec&&e.valueSpec.expression)for(const c of e.valueSpec.expression.parameters)r.delete(c);if(r.size===0)return[];const s=[];return i instanceof Qn&&r.has(i.name)?[new kt(e.key,e.value,`["${i.name}"] expression is not supported in a filter for a ${e.object.type} layer with id: ${e.object.id}`)]:(i.eachChild(c=>{s.push(...Al(c,e))}),s)}function va(i){const e=i.key,r=i.value,s=i.valueSpec,c=[];return Array.isArray(s.values)?s.values.indexOf(Hi(r))===-1&&c.push(new kt(e,r,`expected one of [${s.values.join(", ")}], ${JSON.stringify(r)} found`)):Object.keys(s.values).indexOf(Hi(r))===-1&&c.push(new kt(e,r,`expected one of [${Object.keys(s.values).join(", ")}], ${JSON.stringify(r)} found`)),c}function Bc(i){if(i===!0||i===!1)return!0;if(!Array.isArray(i)||i.length===0)return!1;switch(i[0]){case"has":return i.length>=2&&i[1]!=="$id"&&i[1]!=="$type";case"in":return i.length>=3&&(typeof i[1]!="string"||Array.isArray(i[2]));case"!in":case"!has":case"none":return!1;case"==":case"!=":case">":case">=":case"<":case"<=":return i.length!==3||Array.isArray(i[1])||Array.isArray(i[2]);case"any":case"all":for(const e of i.slice(1))if(!Bc(e)&&typeof e!="boolean")return!1;return!0;default:return!0}}function Wo(i,e="fill"){if(i==null)return{filter:()=>!0,needGeometry:!1,needFeature:!1};Bc(i)||(i=Xo(i));const r=i;let s=!0;try{s=function(A){if(!Es(A))return A;let C=on(A);return fh(C),C=ph(C),C}(r)}catch{console.warn(`Failed to extract static filter. Filter will continue working, but at higher memory usage and slower framerate.
This is most likely a bug, please report this via https://github.com/mapbox/mapbox-gl-js/issues/new?assignees=&labels=&template=Bug_report.md
and paste the contents of this message in the report.
Thank you!
Filter Expression:
${JSON.stringify(r,null,2)}
        `)}const c=ke[`filter_${e}`],f=qo(s,c);let _=null;if(f.result==="error")throw new Error(f.value.map(A=>`${A.key}: ${A.message}`).join(", "));_=(A,C,L)=>f.value.evaluate(A,C,{},L);let x=null,E=null;if(s!==r){const A=qo(r,c);if(A.result==="error")throw new Error(A.value.map(C=>`${C.key}: ${C.message}`).join(", "));x=(C,L,B,U,N)=>A.value.evaluate(C,L,{},B,void 0,void 0,U,N),E=!ms(A.value.expression)}return _=_,{filter:_,dynamicFilter:x||void 0,needGeometry:xa(s),needFeature:!!E}}function ph(i){if(!Array.isArray(i))return i;const e=function(r){if(mf.has(r[0])){for(let s=1;s<r.length;s++)if(Es(r[s]))return!0}return r}(i);return e===!0?e:e.map(r=>ph(r))}function fh(i){let e=!1;const r=[];if(i[0]==="case"){for(let s=1;s<i.length-1;s+=2)e=e||Es(i[s]),r.push(i[s+1]);r.push(i[i.length-1])}else if(i[0]==="match"){e=e||Es(i[1]);for(let s=2;s<i.length-1;s+=2)r.push(i[s+1]);r.push(i[i.length-1])}else if(i[0]==="step"){e=e||Es(i[1]);for(let s=1;s<i.length-1;s+=2)r.push(i[s+1])}e&&(i.length=0,i.push("any",...r));for(let s=1;s<i.length;s++)fh(i[s])}function Es(i){if(!Array.isArray(i))return!1;if((e=i[0])==="pitch"||e==="distance-from-center")return!0;var e;for(let r=1;r<i.length;r++)if(Es(i[r]))return!0;return!1}const mf=new Set(["in","==","!=",">",">=","<","<=","to-boolean"]);function _f(i,e){return i<e?-1:i>e?1:0}function xa(i){if(!Array.isArray(i))return!1;if(i[0]==="within")return!0;for(let e=1;e<i.length;e++)if(xa(i[e]))return!0;return!1}function Xo(i){if(!i)return!0;const e=i[0];return i.length<=1?e!=="any":e==="=="?Or(i[1],i[2],"=="):e==="!="?Sl(Or(i[1],i[2],"==")):e==="<"||e===">"||e==="<="||e===">="?Or(i[1],i[2],e):e==="any"?(r=i.slice(1),["any"].concat(r.map(Xo))):e==="all"?["all"].concat(i.slice(1).map(Xo)):e==="none"?["all"].concat(i.slice(1).map(Xo).map(Sl)):e==="in"?ba(i[1],i.slice(2)):e==="!in"?Sl(ba(i[1],i.slice(2))):e==="has"?dh(i[1]):e==="!has"?Sl(dh(i[1])):e!=="within"||i;var r}function Or(i,e,r){switch(i){case"$type":return[`filter-type-${r}`,e];case"$id":return[`filter-id-${r}`,e];default:return[`filter-${r}`,i,e]}}function ba(i,e){if(e.length===0)return!1;switch(i){case"$type":return["filter-type-in",["literal",e]];case"$id":return["filter-id-in",["literal",e]];default:return e.length>200&&!e.some(r=>typeof r!=typeof e[0])?["filter-in-large",i,["literal",e.sort(_f)]]:["filter-in-small",i,["literal",e]]}}function dh(i){switch(i){case"$type":return!0;case"$id":return["filter-has-id"];default:return["filter-has",i]}}function Sl(i){return["!",i]}function Oc(i){return Bc(on(i.value))?$o(Jr({},i,{expressionContext:"filter",valueSpec:i.styleSpec[`filter_${i.layerType||"fill"}`]})):mh(i)}function mh(i){const e=i.value,r=i.key;if(wi(e)!=="array")return[new kt(r,e,`array expected, ${wi(e)} found`)];const s=i.styleSpec;let c,f=[];if(e.length<1)return[new kt(r,e,"filter array must have at least 1 element")];switch(f=f.concat(va({key:`${r}[0]`,value:e[0],valueSpec:s.filter_operator,style:i.style,styleSpec:i.styleSpec})),Hi(e[0])){case"<":case"<=":case">":case">=":e.length>=2&&Hi(e[1])==="$type"&&f.push(new kt(r,e,`"$type" cannot be use with operator "${e[0]}"`));case"==":case"!=":e.length!==3&&f.push(new kt(r,e,`filter array for operator "${e[0]}" must have 3 elements`));case"in":case"!in":e.length>=2&&(c=wi(e[1]),c!=="string"&&f.push(new kt(`${r}[1]`,e[1],`string expected, ${c} found`)));for(let _=2;_<e.length;_++)c=wi(e[_]),Hi(e[1])==="$type"?f=f.concat(va({key:`${r}[${_}]`,value:e[_],valueSpec:s.geometry_type,style:i.style,styleSpec:i.styleSpec})):c!=="string"&&c!=="number"&&c!=="boolean"&&f.push(new kt(`${r}[${_}]`,e[_],`string, number, or boolean expected, ${c} found`));break;case"any":case"all":case"none":for(let _=1;_<e.length;_++)f=f.concat(mh({key:`${r}[${_}]`,value:e[_],style:i.style,styleSpec:i.styleSpec}));break;case"has":case"!has":c=wi(e[1]),e.length!==2?f.push(new kt(r,e,`filter array for "${e[0]}" operator must have 2 elements`)):c!=="string"&&f.push(new kt(`${r}[1]`,e[1],`string expected, ${c} found`));break;case"within":c=wi(e[1]),e.length!==2?f.push(new kt(r,e,`filter array for "${e[0]}" operator must have 2 elements`)):c!=="object"&&f.push(new kt(`${r}[1]`,e[1],`object expected, ${c} found`))}return f}function Ml(i,e){const r=i.key,s=i.style,c=i.styleSpec,f=i.value,_=i.objectKey,x=c[`${e}_${i.layerType}`];if(!x)return[];const E=_.match(/^(.*)-transition$/);if(e==="paint"&&E&&x[E[1]]&&x[E[1]].transition)return xr({key:r,value:f,valueSpec:c.transition,style:s,styleSpec:c});const A=i.valueSpec||x[_];if(!A)return[new kt(r,f,`unknown property "${_}"`)];let C;if(wi(f)==="string"&&xs(A)&&!A.tokens&&(C=/^{([^}]+)}$/.exec(f)))return[new kt(r,f,`"${_}" does not support interpolation syntax
Use an identity property function instead: \`{ "type": "identity", "property": ${JSON.stringify(C[1])} }\`.`)];const L=[];return i.layerType==="symbol"&&(_==="text-field"&&s&&!s.glyphs&&L.push(new kt(r,f,'use of "text-field" requires a style "glyphs" property')),_==="text-font"&&xl(on(f))&&Hi(f.type)==="identity"&&L.push(new kt(r,f,'"text-font" does not support identity functions'))),L.concat(xr({key:i.key,value:f,valueSpec:A,style:s,styleSpec:c,expressionContext:"property",propertyType:e,propertyKey:_}))}function _h(i){return Ml(i,"paint")}function Il(i){return Ml(i,"layout")}function gh(i){let e=[];const r=i.value,s=i.key,c=i.style,f=i.styleSpec;r.type||r.ref||e.push(new kt(s,r,'either "type" or "ref" is required'));let _=Hi(r.type);const x=Hi(r.ref);if(r.id){const E=Hi(r.id);for(let A=0;A<i.arrayIndex;A++){const C=c.layers[A];Hi(C.id)===E&&e.push(new kt(s,r.id,`duplicate layer id "${r.id}", previously used at line ${C.id.__line__}`))}}if("ref"in r){let E;["type","source","source-layer","filter","layout"].forEach(A=>{A in r&&e.push(new kt(s,r[A],`"${A}" is prohibited for ref layers`))}),c.layers.forEach(A=>{Hi(A.id)===x&&(E=A)}),E?E.ref?e.push(new kt(s,r.ref,"ref cannot reference another ref layer")):_=Hi(E.type):typeof x=="string"&&e.push(new kt(s,r.ref,`ref layer "${x}" not found`))}else if(_!=="background"&&_!=="sky")if(r.source){const E=c.sources&&c.sources[r.source],A=E&&Hi(E.type);E?A==="vector"&&_==="raster"?e.push(new kt(s,r.source,`layer "${r.id}" requires a raster source`)):A==="raster"&&_!=="raster"?e.push(new kt(s,r.source,`layer "${r.id}" requires a vector source`)):A!=="vector"||r["source-layer"]?A==="raster-dem"&&_!=="hillshade"?e.push(new kt(s,r.source,"raster-dem source can only be used with layer type 'hillshade'.")):_!=="line"||!r.paint||!r.paint["line-gradient"]&&!r.paint["line-trim-offset"]||A==="geojson"&&E.lineMetrics||e.push(new kt(s,r,`layer "${r.id}" specifies a line-gradient, which requires a GeoJSON source with \`lineMetrics\` enabled.`)):e.push(new kt(s,r,`layer "${r.id}" must specify a "source-layer"`)):e.push(new kt(s,r.source,`source "${r.source}" not found`))}else e.push(new kt(s,r,'missing required property "source"'));return e=e.concat(un({key:s,value:r,valueSpec:f.layer,style:i.style,styleSpec:i.styleSpec,objectElementValidators:{"*":()=>[],type:()=>xr({key:`${s}.type`,value:r.type,valueSpec:f.layer.type,style:i.style,styleSpec:i.styleSpec,object:r,objectKey:"type"}),filter:E=>Oc(Jr({layerType:_},E)),layout:E=>un({layer:r,key:E.key,value:E.value,valueSpec:{},style:E.style,styleSpec:E.styleSpec,objectElementValidators:{"*":A=>Il(Jr({layerType:_},A))}}),paint:E=>un({layer:r,key:E.key,value:E.value,valueSpec:{},style:E.style,styleSpec:E.styleSpec,objectElementValidators:{"*":A=>_h(Jr({layerType:_},A))}})}})),e}function Ts(i){const e=i.value,r=i.key,s=wi(e);return s!=="string"?[new kt(r,e,`string expected, ${s} found`)]:[]}const kl={promoteId:function({key:i,value:e}){if(wi(e)==="string")return Ts({key:i,value:e});{const r=[];for(const s in e)r.push(...Ts({key:`${i}.${s}`,value:e[s]}));return r}}};function yh(i){const e=i.value,r=i.key,s=i.styleSpec,c=i.style;if(!e.type)return[new kt(r,e,'"type" is required')];const f=Hi(e.type);let _;switch(f){case"vector":case"raster":case"raster-dem":return _=un({key:r,value:e,valueSpec:s[`source_${f.replace("-","_")}`],style:i.style,styleSpec:s,objectElementValidators:kl}),_;case"geojson":if(_=un({key:r,value:e,valueSpec:s.source_geojson,style:c,styleSpec:s,objectElementValidators:kl}),e.cluster)for(const x in e.clusterProperties){const[E,A]=e.clusterProperties[x],C=typeof E=="string"?[E,["accumulated"],["get",x]]:E;_.push(...$o({key:`${r}.${x}.map`,value:A,expressionContext:"cluster-map"})),_.push(...$o({key:`${r}.${x}.reduce`,value:C,expressionContext:"cluster-reduce"}))}return _;case"video":return un({key:r,value:e,valueSpec:s.source_video,style:c,styleSpec:s});case"image":return un({key:r,value:e,valueSpec:s.source_image,style:c,styleSpec:s});case"canvas":return[new kt(r,null,"Please use runtime APIs to add canvas sources, rather than including them in stylesheets.","source.canvas")];default:return va({key:`${r}.type`,value:e.type,valueSpec:{values:["vector","raster","raster-dem","geojson","video","image"]},style:c,styleSpec:s})}}function Fc(i){const e=i.value,r=i.styleSpec,s=r.light,c=i.style;let f=[];const _=wi(e);if(e===void 0)return f;if(_!=="object")return f=f.concat([new kt("light",e,`object expected, ${_} found`)]),f;for(const x in e){const E=x.match(/^(.*)-transition$/);f=f.concat(E&&s[E[1]]&&s[E[1]].transition?xr({key:x,value:e[x],valueSpec:r.transition,style:c,styleSpec:r}):s[x]?xr({key:x,value:e[x],valueSpec:s[x],style:c,styleSpec:r}):[new kt(x,e[x],`unknown property "${x}"`)])}return f}function Uc(i){const e=i.value,r=i.key,s=i.style,c=i.styleSpec,f=c.terrain;let _=[];const x=wi(e);if(e===void 0)return _;if(x!=="object")return _=_.concat([new kt("terrain",e,`object expected, ${x} found`)]),_;for(const E in e){const A=E.match(/^(.*)-transition$/);_=_.concat(A&&f[A[1]]&&f[A[1]].transition?xr({key:E,value:e[E],valueSpec:c.transition,style:s,styleSpec:c}):f[E]?xr({key:E,value:e[E],valueSpec:f[E],style:s,styleSpec:c}):[new kt(E,e[E],`unknown property "${E}"`)])}if(e.source){const E=s.sources&&s.sources[e.source],A=E&&Hi(E.type);E?A!=="raster-dem"&&_.push(new kt(r,e.source,`terrain cannot be used with a source of type ${String(A)}, it only be used with a "raster-dem" source type`)):_.push(new kt(r,e.source,`source "${e.source}" not found`))}else _.push(new kt(r,e,'terrain is missing required property "source"'));return _}function vh(i){const e=i.value,r=i.style,s=i.styleSpec,c=s.fog;let f=[];const _=wi(e);if(e===void 0)return f;if(_!=="object")return f=f.concat([new kt("fog",e,`object expected, ${_} found`)]),f;for(const x in e){const E=x.match(/^(.*)-transition$/);f=f.concat(E&&c[E[1]]&&c[E[1]].transition?xr({key:x,value:e[x],valueSpec:s.transition,style:r,styleSpec:s}):c[x]?xr({key:x,value:e[x],valueSpec:c[x],style:r,styleSpec:s}):[new kt(x,e[x],`unknown property "${x}"`)])}return f}const Cl={"*":()=>[],array:ya,boolean:function(i){const e=i.value,r=i.key,s=wi(e);return s!=="boolean"?[new kt(r,e,`boolean expected, ${s} found`)]:[]},number:Zo,color:function(i){const e=i.key,r=i.value,s=wi(r);return s!=="string"?[new kt(e,r,`color expected, ${s} found`)]:Zu.parseCSSColor(r)===null?[new kt(e,r,`color expected, "${r}" found`)]:[]},enum:va,filter:Oc,function:Rc,layer:gh,object:un,source:yh,light:Fc,terrain:Uc,fog:vh,string:Ts,formatted:function(i){return Ts(i).length===0?[]:$o(i)},resolvedImage:function(i){return Ts(i).length===0?[]:$o(i)},projection:function(i){const e=i.value,r=i.styleSpec,s=r.projection,c=i.style;let f=[];const _=wi(e);if(_==="object")for(const x in e)f=f.concat(xr({key:x,value:e[x],valueSpec:s[x],style:c,styleSpec:r}));else _!=="string"&&(f=f.concat([new kt("projection",e,`object or string expected, ${_} found`)]));return f}};function xr(i){const e=i.value,r=i.valueSpec,s=i.styleSpec;return r.expression&&xl(Hi(e))?Rc(i):r.expression&&wl(on(e))?$o(i):r.type&&Cl[r.type]?Cl[r.type](i):un(Jr({},i,{valueSpec:r.type?s[r.type]:r}))}function xh(i){const e=i.value,r=i.key,s=Ts(i);return s.length||(e.indexOf("{fontstack}")===-1&&s.push(new kt(r,e,'"glyphs" url must include a "{fontstack}" token')),e.indexOf("{range}")===-1&&s.push(new kt(r,e,'"glyphs" url must include a "{range}" token'))),s}function bh(i,e=ke){return En(xr({key:"",value:i,valueSpec:e.$root,styleSpec:e,style:i,objectElementValidators:{glyphs:xh,"*":()=>[]}}))}const wh=i=>En(_h(i)),gf=i=>En(Il(i));function En(i){return i.slice().sort((e,r)=>e.line&&r.line?e.line-r.line:0)}function Eh(i,e){let r=!1;if(e&&e.length)for(const s of e)i.fire(new ji(new Error(s.message))),r=!0;return r}var As=Rn;function Rn(i,e,r){var s=this.cells=[];if(i instanceof ArrayBuffer){this.arrayBuffer=i;var c=new Int32Array(this.arrayBuffer);i=c[0],this.d=(e=c[1])+2*(r=c[2]);for(var f=0;f<this.d*this.d;f++){var _=c[3+f],x=c[3+f+1];s.push(_===x?null:c.subarray(_,x))}var E=c[3+s.length+1];this.keys=c.subarray(c[3+s.length],E),this.bboxes=c.subarray(E),this.insert=this._insertReadonly}else{this.d=e+2*r;for(var A=0;A<this.d*this.d;A++)s.push([]);this.keys=[],this.bboxes=[]}this.n=e,this.extent=i,this.padding=r,this.scale=e/i,this.uid=0;var C=r/e*i;this.min=-C,this.max=i+C}Rn.prototype.insert=function(i,e,r,s,c){this._forEachCell(e,r,s,c,this._insertCell,this.uid++),this.keys.push(i),this.bboxes.push(e),this.bboxes.push(r),this.bboxes.push(s),this.bboxes.push(c)},Rn.prototype._insertReadonly=function(){throw"Cannot insert into a GridIndex created from an ArrayBuffer."},Rn.prototype._insertCell=function(i,e,r,s,c,f){this.cells[c].push(f)},Rn.prototype.query=function(i,e,r,s,c){var f=this.min,_=this.max;if(i<=f&&e<=f&&_<=r&&_<=s&&!c)return Array.prototype.slice.call(this.keys);var x=[];return this._forEachCell(i,e,r,s,this._queryCell,x,{},c),x},Rn.prototype._queryCell=function(i,e,r,s,c,f,_,x){var E=this.cells[c];if(E!==null)for(var A=this.keys,C=this.bboxes,L=0;L<E.length;L++){var B=E[L];if(_[B]===void 0){var U=4*B;(x?x(C[U+0],C[U+1],C[U+2],C[U+3]):i<=C[U+2]&&e<=C[U+3]&&r>=C[U+0]&&s>=C[U+1])?(_[B]=!0,f.push(A[B])):_[B]=!1}}},Rn.prototype._forEachCell=function(i,e,r,s,c,f,_,x){for(var E=this._convertToCellCoord(i),A=this._convertToCellCoord(e),C=this._convertToCellCoord(r),L=this._convertToCellCoord(s),B=E;B<=C;B++)for(var U=A;U<=L;U++){var N=this.d*U+B;if((!x||x(this._convertFromCellCoord(B),this._convertFromCellCoord(U),this._convertFromCellCoord(B+1),this._convertFromCellCoord(U+1)))&&c.call(this,i,e,r,s,N,f,_,x))return}},Rn.prototype._convertFromCellCoord=function(i){return(i-this.padding)/this.scale},Rn.prototype._convertToCellCoord=function(i){return Math.max(0,Math.min(this.d-1,Math.floor(i*this.scale)+this.padding))},Rn.prototype.toArrayBuffer=function(){if(this.arrayBuffer)return this.arrayBuffer;for(var i=this.cells,e=3+this.cells.length+1+1,r=0,s=0;s<this.cells.length;s++)r+=this.cells[s].length;var c=new Int32Array(e+r+this.keys.length+this.bboxes.length);c[0]=this.extent,c[1]=this.n,c[2]=this.padding;for(var f=e,_=0;_<i.length;_++){var x=i[_];c[3+_]=f,c.set(x,f),f+=x.length}return c[3+i.length]=f,c.set(this.keys,f),c[3+i.length+1]=f+=this.keys.length,c.set(this.bboxes,f),f+=this.bboxes.length,c.buffer};const zl={};function Ct(i,e,r={}){Object.defineProperty(i,"_classRegistryKey",{value:e,writeable:!1}),zl[e]={klass:i,omit:r.omit||[]}}Ct(Object,"Object"),As.serialize=function(i,e){const r=i.toArrayBuffer();return e&&e.push(r),{buffer:r}},As.deserialize=function(i){return new As(i.buffer)},Object.defineProperty(As,"name",{value:"Grid"}),Ct(As,"Grid"),Ct(tr,"Color"),Ct(Error,"Error"),Ct(we,"AJAXError"),Ct(ln,"ResolvedImage"),Ct(ga,"StylePropertyFunction"),Ct(bl,"StyleExpression",{omit:["_evaluator"]}),Ct(_a,"ZoomDependentExpression"),Ct(El,"ZoomConstantExpression"),Ct(Qn,"CompoundExpression",{omit:["_evaluate"]});for(const i in ma)zl[ma[i]._classRegistryKey]||Ct(ma[i],`Expression${i}`);function Th(i){return i&&typeof ArrayBuffer!="undefined"&&(i instanceof ArrayBuffer||i.constructor&&i.constructor.name==="ArrayBuffer")}function Ah(i){return w.ImageBitmap&&i instanceof w.ImageBitmap}function wa(i,e){if(i==null||typeof i=="boolean"||typeof i=="number"||typeof i=="string"||i instanceof Boolean||i instanceof Number||i instanceof String||i instanceof Date||i instanceof RegExp)return i;if(Th(i)||Ah(i))return e&&e.push(i),i;if(ArrayBuffer.isView(i)){const r=i;return e&&e.push(r.buffer),r}if(i instanceof w.ImageData)return e&&e.push(i.data.buffer),i;if(Array.isArray(i)){const r=[];for(const s of i)r.push(wa(s,e));return r}if(typeof i=="object"){const r=i.constructor,s=r._classRegistryKey;if(!s)throw new Error(`can't serialize object of unregistered class ${s}`);const c=r.serialize?r.serialize(i,e):{};if(!r.serialize){for(const f in i)i.hasOwnProperty(f)&&(zl[s].omit.indexOf(f)>=0||(c[f]=wa(i[f],e)));i instanceof Error&&(c.message=i.message)}if(c.$name)throw new Error("$name property is reserved for worker serialization logic.");return s!=="Object"&&(c.$name=s),c}throw new Error("can't serialize object of type "+typeof i)}function Ea(i){if(i==null||typeof i=="boolean"||typeof i=="number"||typeof i=="string"||i instanceof Boolean||i instanceof Number||i instanceof String||i instanceof Date||i instanceof RegExp||Th(i)||Ah(i)||ArrayBuffer.isView(i)||i instanceof w.ImageData)return i;if(Array.isArray(i))return i.map(Ea);if(typeof i=="object"){const e=i.$name||"Object",{klass:r}=zl[e];if(!r)throw new Error(`can't deserialize unregistered class ${e}`);if(r.deserialize)return r.deserialize(i);const s=Object.create(r.prototype);for(const c of Object.keys(i))c!=="$name"&&(s[c]=Ea(i[c]));return s}throw new Error("can't deserialize object of type "+typeof i)}class Sh{constructor(){this.first=!0}update(e,r){const s=Math.floor(e);return this.first?(this.first=!1,this.lastIntegerZoom=s,this.lastIntegerZoomTime=0,this.lastZoom=e,this.lastFloorZoom=s,!0):(this.lastFloorZoom>s?(this.lastIntegerZoom=s+1,this.lastIntegerZoomTime=r):this.lastFloorZoom<s&&(this.lastIntegerZoom=s,this.lastIntegerZoomTime=r),e!==this.lastZoom&&(this.lastZoom=e,this.lastFloorZoom=s,!0))}}const Mh=i=>i>=1536&&i<=1791,Ih=i=>i>=1872&&i<=1919,Ta=i=>i>=2208&&i<=2303,kh=i=>i>=11904&&i<=12031,Ch=i=>i>=12032&&i<=12255,Aa=i=>i>=12272&&i<=12287,Pl=i=>i>=12288&&i<=12351,Dl=i=>i>=12352&&i<=12447,Ll=i=>i>=12448&&i<=12543,Vc=i=>i>=12544&&i<=12591,Nc=i=>i>=12704&&i<=12735,jc=i=>i>=12736&&i<=12783,Gc=i=>i>=12784&&i<=12799,Rl=i=>i>=12800&&i<=13055,Bl=i=>i>=13056&&i<=13311,zh=i=>i>=13312&&i<=19903,qc=i=>i>=19968&&i<=40959,Ph=i=>i>=40960&&i<=42127,Ol=i=>i>=42128&&i<=42191,Dh=i=>i>=44032&&i<=55215,Lh=i=>i>=63744&&i<=64255,Zc=i=>i>=64336&&i<=65023,Rh=i=>i>=65040&&i<=65055,$c=i=>i>=65072&&i<=65103,Wc=i=>i>=65104&&i<=65135,Xc=i=>i>=65136&&i<=65279,Hc=i=>i>=65280&&i<=65519;function Fl(i){for(const e of i)if(t(e.charCodeAt(0)))return!0;return!1}function Ul(i){for(const e of i)if(!p(e.charCodeAt(0)))return!1;return!0}function p(i){return!(Mh(i)||Ih(i)||Ta(i)||Zc(i)||Xc(i))}function t(i){return!(i!==746&&i!==747&&(i<4352||!(Nc(i)||Vc(i)||$c(i)&&!(i>=65097&&i<=65103)||Lh(i)||Bl(i)||kh(i)||jc(i)||!(!Pl(i)||i>=12296&&i<=12305||i>=12308&&i<=12319||i===12336)||zh(i)||qc(i)||Rl(i)||(e=>e>=12592&&e<=12687)(i)||(e=>e>=43360&&e<=43391)(i)||(e=>e>=55216&&e<=55295)(i)||(e=>e>=4352&&e<=4607)(i)||Dh(i)||Dl(i)||Aa(i)||(e=>e>=12688&&e<=12703)(i)||Ch(i)||Gc(i)||Ll(i)&&i!==12540||!(!Hc(i)||i===65288||i===65289||i===65293||i>=65306&&i<=65310||i===65339||i===65341||i===65343||i>=65371&&i<=65503||i===65507||i>=65512&&i<=65519)||!(!Wc(i)||i>=65112&&i<=65118||i>=65123&&i<=65126)||(e=>e>=5120&&e<=5759)(i)||(e=>e>=6320&&e<=6399)(i)||Rh(i)||(e=>e>=19904&&e<=19967)(i)||Ph(i)||Ol(i))))}function a(i){return!(t(i)||function(e){return!!((r=>r>=128&&r<=255)(e)&&(e===167||e===169||e===174||e===177||e===188||e===189||e===190||e===215||e===247)||(r=>r>=8192&&r<=8303)(e)&&(e===8214||e===8224||e===8225||e===8240||e===8241||e===8251||e===8252||e===8258||e===8263||e===8264||e===8265||e===8273)||(r=>r>=8448&&r<=8527)(e)||(r=>r>=8528&&r<=8591)(e)||(r=>r>=8960&&r<=9215)(e)&&(e>=8960&&e<=8967||e>=8972&&e<=8991||e>=8996&&e<=9e3||e===9003||e>=9085&&e<=9114||e>=9150&&e<=9165||e===9167||e>=9169&&e<=9179||e>=9186&&e<=9215)||(r=>r>=9216&&r<=9279)(e)&&e!==9251||(r=>r>=9280&&r<=9311)(e)||(r=>r>=9312&&r<=9471)(e)||(r=>r>=9632&&r<=9727)(e)||(r=>r>=9728&&r<=9983)(e)&&!(e>=9754&&e<=9759)||(r=>r>=11008&&r<=11263)(e)&&(e>=11026&&e<=11055||e>=11088&&e<=11097||e>=11192&&e<=11243)||Pl(e)||Ll(e)||(r=>r>=57344&&r<=63743)(e)||$c(e)||Wc(e)||Hc(e)||e===8734||e===8756||e===8757||e>=9984&&e<=10087||e>=10102&&e<=10131||e===65532||e===65533)}(i))}function m(i){return i>=1424&&i<=2303||Zc(i)||Xc(i)}function v(i,e){return!(!e&&m(i)||i>=2304&&i<=3583||i>=3840&&i<=4255||(r=>r>=6016&&r<=6143)(i))}function b(i){for(const e of i)if(m(e.charCodeAt(0)))return!0;return!1}const S="deferred",k="loading",D="loaded";let O=null,V="unavailable",G=null;const X=function(i){i&&typeof i=="string"&&i.indexOf("NetworkError")>-1&&(V="error"),O&&O(i)};function J(){ee.fire(new Ti("pluginStateChange",{pluginStatus:V,pluginURL:G}))}const ee=new ki,Y=function(){return V},pe=function(){if(V!==S||!G)throw new Error("rtl-text-plugin cannot be downloaded unless a pluginURL is specified");V=k,J(),G&&Te({url:G},i=>{i?X(i):(V=D,J())})},K={applyArabicShaping:null,processBidirectionalText:null,processStyledBidirectionalText:null,isLoaded:()=>V===D||K.applyArabicShaping!=null,isLoading:()=>V===k,setState(i){V=i.pluginStatus,G=i.pluginURL},isParsed:()=>K.applyArabicShaping!=null&&K.processBidirectionalText!=null&&K.processStyledBidirectionalText!=null,getPluginURL:()=>G};class ne{constructor(e,r){this.zoom=e,r?(this.now=r.now,this.fadeDuration=r.fadeDuration,this.zoomHistory=r.zoomHistory,this.transition=r.transition,this.pitch=r.pitch):(this.now=0,this.fadeDuration=0,this.zoomHistory=new Sh,this.transition={},this.pitch=0)}isSupportedScript(e){return function(r,s){for(const c of r)if(!v(c.charCodeAt(0),s))return!1;return!0}(e,K.isLoaded())}crossFadingFactor(){return this.fadeDuration===0?1:Math.min((this.now-this.zoomHistory.lastIntegerZoomTime)/this.fadeDuration,1)}getCrossfadeParameters(){const e=this.zoom,r=e-Math.floor(e),s=this.crossFadingFactor();return e>this.zoomHistory.lastIntegerZoom?{fromScale:2,toScale:1,t:r+(1-r)*s}:{fromScale:.5,toScale:1,t:1-(1-s)*r}}}class oe{constructor(e,r){this.property=e,this.value=r,this.expression=function(s,c){if(xl(s))return new ga(s,c);if(wl(s)){const f=Tl(s,c);if(f.result==="error")throw new Error(f.value.map(_=>`${_.key}: ${_.message}`).join(", "));return f.value}{let f=s;return typeof s=="string"&&c.type==="color"&&(f=tr.parse(s)),{kind:"constant",evaluate:()=>f}}}(r===void 0?e.specification.default:r,e.specification)}isDataDriven(){return this.expression.kind==="source"||this.expression.kind==="composite"}possiblyEvaluate(e,r,s){return this.property.possiblyEvaluate(this,e,r,s)}}class ge{constructor(e){this.property=e,this.value=new oe(e,void 0)}transitioned(e,r){return new fe(this.property,this.value,r,Pe({},e.transition,this.transition),e.now)}untransitioned(){return new fe(this.property,this.value,null,{},0)}}class he{constructor(e){this._properties=e,this._values=Object.create(e.defaultTransitionablePropertyValues)}getValue(e){return Ci(this._values[e].value.value)}setValue(e,r){this._values.hasOwnProperty(e)||(this._values[e]=new ge(this._values[e].property)),this._values[e].value=new oe(this._values[e].property,r===null?void 0:Ci(r))}getTransition(e){return Ci(this._values[e].transition)}setTransition(e,r){this._values.hasOwnProperty(e)||(this._values[e]=new ge(this._values[e].property)),this._values[e].transition=Ci(r)||void 0}serialize(){const e={};for(const r of Object.keys(this._values)){const s=this.getValue(r);s!==void 0&&(e[r]=s);const c=this.getTransition(r);c!==void 0&&(e[`${r}-transition`]=c)}return e}transitioned(e,r){const s=new be(this._properties);for(const c of Object.keys(this._values))s._values[c]=this._values[c].transitioned(e,r._values[c]);return s}untransitioned(){const e=new be(this._properties);for(const r of Object.keys(this._values))e._values[r]=this._values[r].untransitioned();return e}}class fe{constructor(e,r,s,c,f){const _=c.delay||0,x=c.duration||0;f=f||0,this.property=e,this.value=r,this.begin=f+_,this.end=this.begin+x,e.specification.transition&&(c.delay||c.duration)&&(this.prior=s)}possiblyEvaluate(e,r,s){const c=e.now||0,f=this.value.possiblyEvaluate(e,r,s),_=this.prior;if(_){if(c>this.end)return this.prior=null,f;if(this.value.isDataDriven())return this.prior=null,f;if(c<this.begin)return _.possiblyEvaluate(e,r,s);{const x=(c-this.begin)/(this.end-this.begin);return this.property.interpolate(_.possiblyEvaluate(e,r,s),f,se(x))}}return f}}class be{constructor(e){this._properties=e,this._values=Object.create(e.defaultTransitioningPropertyValues)}possiblyEvaluate(e,r,s){const c=new je(this._properties);for(const f of Object.keys(this._values))c._values[f]=this._values[f].possiblyEvaluate(e,r,s);return c}hasTransition(){for(const e of Object.keys(this._values))if(this._values[e].prior)return!0;return!1}}class Ve{constructor(e){this._properties=e,this._values=Object.create(e.defaultPropertyValues)}getValue(e){return Ci(this._values[e].value)}setValue(e,r){this._values[e]=new oe(this._values[e].property,r===null?void 0:Ci(r))}serialize(){const e={};for(const r of Object.keys(this._values)){const s=this.getValue(r);s!==void 0&&(e[r]=s)}return e}possiblyEvaluate(e,r,s){const c=new je(this._properties);for(const f of Object.keys(this._values))c._values[f]=this._values[f].possiblyEvaluate(e,r,s);return c}}class Ze{constructor(e,r,s){this.property=e,this.value=r,this.parameters=s}isConstant(){return this.value.kind==="constant"}constantOr(e){return this.value.kind==="constant"?this.value.value:e}evaluate(e,r,s,c){return this.property.evaluate(this.value,this.parameters,e,r,s,c)}}class je{constructor(e){this._properties=e,this._values=Object.create(e.defaultPossiblyEvaluatedValues)}get(e){return this._values[e]}}class Ue{constructor(e){this.specification=e}possiblyEvaluate(e,r){return e.expression.evaluate(r)}interpolate(e,r,s){const c=ca[this.specification.type];return c?c(e,r,s):e}}class _e{constructor(e,r){this.specification=e,this.overrides=r}possiblyEvaluate(e,r,s,c){return new Ze(this,e.expression.kind==="constant"||e.expression.kind==="camera"?{kind:"constant",value:e.expression.evaluate(r,null,{},s,c)}:e.expression,r)}interpolate(e,r,s){if(e.value.kind!=="constant"||r.value.kind!=="constant")return e;if(e.value.value===void 0||r.value.value===void 0)return new Ze(this,{kind:"constant",value:void 0},e.parameters);const c=ca[this.specification.type];return c?new Ze(this,{kind:"constant",value:c(e.value.value,r.value.value,s)},e.parameters):e}evaluate(e,r,s,c,f,_){return e.kind==="constant"?e.value:e.evaluate(r,s,c,f,_)}}class rt extends _e{possiblyEvaluate(e,r,s,c){if(e.value===void 0)return new Ze(this,{kind:"constant",value:void 0},r);if(e.expression.kind==="constant"){const f=e.expression.evaluate(r,null,{},s,c),_=e.property.specification.type==="resolvedImage"&&typeof f!="string"?f.name:f,x=this._calculate(_,_,_,r);return new Ze(this,{kind:"constant",value:x},r)}if(e.expression.kind==="camera"){const f=this._calculate(e.expression.evaluate({zoom:r.zoom-1}),e.expression.evaluate({zoom:r.zoom}),e.expression.evaluate({zoom:r.zoom+1}),r);return new Ze(this,{kind:"constant",value:f},r)}return new Ze(this,e.expression,r)}evaluate(e,r,s,c,f,_){if(e.kind==="source"){const x=e.evaluate(r,s,c,f,_);return this._calculate(x,x,x,r)}return e.kind==="composite"?this._calculate(e.evaluate({zoom:Math.floor(r.zoom)-1},s,c),e.evaluate({zoom:Math.floor(r.zoom)},s,c),e.evaluate({zoom:Math.floor(r.zoom)+1},s,c),r):e.value}_calculate(e,r,s,c){return c.zoom>c.zoomHistory.lastIntegerZoom?{from:e,to:r,other:s}:{from:s,to:r,other:e}}interpolate(e){return e}}class it{constructor(e){this.specification=e}possiblyEvaluate(e,r,s,c){if(e.value!==void 0){if(e.expression.kind==="constant"){const f=e.expression.evaluate(r,null,{},s,c);return this._calculate(f,f,f,r)}return this._calculate(e.expression.evaluate(new ne(Math.floor(r.zoom-1),r)),e.expression.evaluate(new ne(Math.floor(r.zoom),r)),e.expression.evaluate(new ne(Math.floor(r.zoom+1),r)),r)}}_calculate(e,r,s,c){return c.zoom>c.zoomHistory.lastIntegerZoom?{from:e,to:r}:{from:s,to:r}}interpolate(e){return e}}class Et{constructor(e){this.specification=e}possiblyEvaluate(e,r,s,c){return!!e.expression.evaluate(r,null,{},s,c)}interpolate(){return!1}}class Ke{constructor(e){this.properties=e,this.defaultPropertyValues={},this.defaultTransitionablePropertyValues={},this.defaultTransitioningPropertyValues={},this.defaultPossiblyEvaluatedValues={},this.overridableProperties=[];const r=new ne(0,{});for(const s in e){const c=e[s];c.specification.overridable&&this.overridableProperties.push(s);const f=this.defaultPropertyValues[s]=new oe(c,void 0),_=this.defaultTransitionablePropertyValues[s]=new ge(c);this.defaultTransitioningPropertyValues[s]=_.untransitioned(),this.defaultPossiblyEvaluatedValues[s]=f.possiblyEvaluate(r)}}}function Ft(i,e){return 256*(i=re(Math.floor(i),0,255))+re(Math.floor(e),0,255)}Ct(_e,"DataDrivenProperty"),Ct(Ue,"DataConstantProperty"),Ct(rt,"CrossFadedDataDrivenProperty"),Ct(it,"CrossFadedProperty"),Ct(Et,"ColorRampProperty");const vt={Int8:Int8Array,Uint8:Uint8Array,Int16:Int16Array,Uint16:Uint16Array,Int32:Int32Array,Uint32:Uint32Array,Float32:Float32Array};class yt{constructor(e,r){this._structArray=e,this._pos1=r*this.size,this._pos2=this._pos1/2,this._pos4=this._pos1/4,this._pos8=this._pos1/8}}class ut{constructor(){this.isTransferred=!1,this.capacity=-1,this.resize(0)}static serialize(e,r){return e._trim(),r&&(e.isTransferred=!0,r.push(e.arrayBuffer)),{length:e.length,arrayBuffer:e.arrayBuffer}}static deserialize(e){const r=Object.create(this.prototype);return r.arrayBuffer=e.arrayBuffer,r.length=e.length,r.capacity=e.arrayBuffer.byteLength/r.bytesPerElement,r._refreshViews(),r}_trim(){this.length!==this.capacity&&(this.capacity=this.length,this.arrayBuffer=this.arrayBuffer.slice(0,this.length*this.bytesPerElement),this._refreshViews())}clear(){this.length=0}resize(e){this.reserve(e),this.length=e}reserve(e){if(e>this.capacity){this.capacity=Math.max(e,Math.floor(5*this.capacity),128),this.arrayBuffer=new ArrayBuffer(this.capacity*this.bytesPerElement);const r=this.uint8;this._refreshViews(),r&&this.uint8.set(r)}}_refreshViews(){throw new Error("_refreshViews() must be implemented by each concrete StructArray layout")}destroy(){this.int8=this.uint8=this.int16=this.uint16=this.int32=this.uint32=this.float32=null,this.arrayBuffer=null}}function gt(i,e=1){let r=0,s=0;return{members:i.map(c=>{const f=vt[c.type].BYTES_PER_ELEMENT,_=r=Xt(r,Math.max(e,f)),x=c.components||1;return s=Math.max(s,f),r+=f*x,{name:c.name,type:c.type,components:x,offset:_}}),size:Xt(r,Math.max(s,e)),alignment:e}}function Xt(i,e){return Math.ceil(i/e)*e}class Vt extends ut{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer)}emplaceBack(e,r){const s=this.length;return this.resize(s+1),this.emplace(s,e,r)}emplace(e,r,s){const c=2*e;return this.int16[c+0]=r,this.int16[c+1]=s,e}}Vt.prototype.bytesPerElement=4,Ct(Vt,"StructArrayLayout2i4");class oi extends ut{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer)}emplaceBack(e,r,s){const c=this.length;return this.resize(c+1),this.emplace(c,e,r,s)}emplace(e,r,s,c){const f=3*e;return this.int16[f+0]=r,this.int16[f+1]=s,this.int16[f+2]=c,e}}oi.prototype.bytesPerElement=6,Ct(oi,"StructArrayLayout3i6");class Ot extends ut{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer)}emplaceBack(e,r,s,c){const f=this.length;return this.resize(f+1),this.emplace(f,e,r,s,c)}emplace(e,r,s,c,f){const _=4*e;return this.int16[_+0]=r,this.int16[_+1]=s,this.int16[_+2]=c,this.int16[_+3]=f,e}}Ot.prototype.bytesPerElement=8,Ct(Ot,"StructArrayLayout4i8");class ii extends ut{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)}emplaceBack(e,r,s,c,f,_,x){const E=this.length;return this.resize(E+1),this.emplace(E,e,r,s,c,f,_,x)}emplace(e,r,s,c,f,_,x,E){const A=6*e,C=12*e,L=3*e;return this.int16[A+0]=r,this.int16[A+1]=s,this.uint8[C+4]=c,this.uint8[C+5]=f,this.uint8[C+6]=_,this.uint8[C+7]=x,this.float32[L+2]=E,e}}ii.prototype.bytesPerElement=12,Ct(ii,"StructArrayLayout2i4ub1f12");class Si extends ut{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)}emplaceBack(e,r,s,c){const f=this.length;return this.resize(f+1),this.emplace(f,e,r,s,c)}emplace(e,r,s,c,f){const _=4*e;return this.float32[_+0]=r,this.float32[_+1]=s,this.float32[_+2]=c,this.float32[_+3]=f,e}}Si.prototype.bytesPerElement=16,Ct(Si,"StructArrayLayout4f16");class zi extends ut{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer)}emplaceBack(e,r,s,c,f,_,x,E,A,C){const L=this.length;return this.resize(L+1),this.emplace(L,e,r,s,c,f,_,x,E,A,C)}emplace(e,r,s,c,f,_,x,E,A,C,L){const B=10*e;return this.uint16[B+0]=r,this.uint16[B+1]=s,this.uint16[B+2]=c,this.uint16[B+3]=f,this.uint16[B+4]=_,this.uint16[B+5]=x,this.uint16[B+6]=E,this.uint16[B+7]=A,this.uint16[B+8]=C,this.uint16[B+9]=L,e}}zi.prototype.bytesPerElement=20,Ct(zi,"StructArrayLayout10ui20");class nr extends ut{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer)}emplaceBack(e,r,s,c,f,_,x,E){const A=this.length;return this.resize(A+1),this.emplace(A,e,r,s,c,f,_,x,E)}emplace(e,r,s,c,f,_,x,E,A){const C=8*e;return this.uint16[C+0]=r,this.uint16[C+1]=s,this.uint16[C+2]=c,this.uint16[C+3]=f,this.uint16[C+4]=_,this.uint16[C+5]=x,this.uint16[C+6]=E,this.uint16[C+7]=A,e}}nr.prototype.bytesPerElement=16,Ct(nr,"StructArrayLayout8ui16");class Ri extends ut{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer)}emplaceBack(e,r,s,c,f,_){const x=this.length;return this.resize(x+1),this.emplace(x,e,r,s,c,f,_)}emplace(e,r,s,c,f,_,x){const E=6*e;return this.int16[E+0]=r,this.int16[E+1]=s,this.int16[E+2]=c,this.int16[E+3]=f,this.int16[E+4]=_,this.int16[E+5]=x,e}}Ri.prototype.bytesPerElement=12,Ct(Ri,"StructArrayLayout6i12");class en extends ut{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer)}emplaceBack(e,r,s,c,f,_,x,E,A,C,L,B){const U=this.length;return this.resize(U+1),this.emplace(U,e,r,s,c,f,_,x,E,A,C,L,B)}emplace(e,r,s,c,f,_,x,E,A,C,L,B,U){const N=12*e;return this.int16[N+0]=r,this.int16[N+1]=s,this.int16[N+2]=c,this.int16[N+3]=f,this.uint16[N+4]=_,this.uint16[N+5]=x,this.uint16[N+6]=E,this.uint16[N+7]=A,this.int16[N+8]=C,this.int16[N+9]=L,this.int16[N+10]=B,this.int16[N+11]=U,e}}en.prototype.bytesPerElement=24,Ct(en,"StructArrayLayout4i4ui4i24");class Bn extends ut{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)}emplaceBack(e,r,s,c,f,_){const x=this.length;return this.resize(x+1),this.emplace(x,e,r,s,c,f,_)}emplace(e,r,s,c,f,_,x){const E=10*e,A=5*e;return this.int16[E+0]=r,this.int16[E+1]=s,this.int16[E+2]=c,this.float32[A+2]=f,this.float32[A+3]=_,this.float32[A+4]=x,e}}Bn.prototype.bytesPerElement=20,Ct(Bn,"StructArrayLayout3i3f20");class to extends ut{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.uint32=new Uint32Array(this.arrayBuffer)}emplaceBack(e){const r=this.length;return this.resize(r+1),this.emplace(r,e)}emplace(e,r){return this.uint32[1*e+0]=r,e}}to.prototype.bytesPerElement=4,Ct(to,"StructArrayLayout1ul4");class qi extends ut{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer),this.uint32=new Uint32Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer)}emplaceBack(e,r,s,c,f,_,x,E,A,C,L,B,U){const N=this.length;return this.resize(N+1),this.emplace(N,e,r,s,c,f,_,x,E,A,C,L,B,U)}emplace(e,r,s,c,f,_,x,E,A,C,L,B,U,N){const $=20*e,te=10*e;return this.int16[$+0]=r,this.int16[$+1]=s,this.int16[$+2]=c,this.int16[$+3]=f,this.int16[$+4]=_,this.float32[te+3]=x,this.float32[te+4]=E,this.float32[te+5]=A,this.float32[te+6]=C,this.int16[$+14]=L,this.uint32[te+8]=B,this.uint16[$+18]=U,this.uint16[$+19]=N,e}}qi.prototype.bytesPerElement=40,Ct(qi,"StructArrayLayout5i4f1i1ul2ui40");class $i extends ut{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer)}emplaceBack(e,r,s,c,f,_,x){const E=this.length;return this.resize(E+1),this.emplace(E,e,r,s,c,f,_,x)}emplace(e,r,s,c,f,_,x,E){const A=8*e;return this.int16[A+0]=r,this.int16[A+1]=s,this.int16[A+2]=c,this.int16[A+4]=f,this.int16[A+5]=_,this.int16[A+6]=x,this.int16[A+7]=E,e}}$i.prototype.bytesPerElement=16,Ct($i,"StructArrayLayout3i2i2i16");class Mi extends ut{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer)}emplaceBack(e,r,s,c,f){const _=this.length;return this.resize(_+1),this.emplace(_,e,r,s,c,f)}emplace(e,r,s,c,f,_){const x=4*e,E=8*e;return this.float32[x+0]=r,this.float32[x+1]=s,this.float32[x+2]=c,this.int16[E+6]=f,this.int16[E+7]=_,e}}Mi.prototype.bytesPerElement=16,Ct(Mi,"StructArrayLayout2f1f2i16");class ur extends ut{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)}emplaceBack(e,r,s,c){const f=this.length;return this.resize(f+1),this.emplace(f,e,r,s,c)}emplace(e,r,s,c,f){const _=12*e,x=3*e;return this.uint8[_+0]=r,this.uint8[_+1]=s,this.float32[x+1]=c,this.float32[x+2]=f,e}}ur.prototype.bytesPerElement=12,Ct(ur,"StructArrayLayout2ub2f12");class Ar extends ut{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)}emplaceBack(e,r,s){const c=this.length;return this.resize(c+1),this.emplace(c,e,r,s)}emplace(e,r,s,c){const f=3*e;return this.float32[f+0]=r,this.float32[f+1]=s,this.float32[f+2]=c,e}}Ar.prototype.bytesPerElement=12,Ct(Ar,"StructArrayLayout3f12");class yi extends ut{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer)}emplaceBack(e,r,s){const c=this.length;return this.resize(c+1),this.emplace(c,e,r,s)}emplace(e,r,s,c){const f=3*e;return this.uint16[f+0]=r,this.uint16[f+1]=s,this.uint16[f+2]=c,e}}yi.prototype.bytesPerElement=6,Ct(yi,"StructArrayLayout3ui6");class jr extends ut{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer),this.uint32=new Uint32Array(this.arrayBuffer)}emplaceBack(e,r,s,c,f,_,x,E,A,C,L,B,U,N,$,te,ue,ve,ye,xe,Ee){const Se=this.length;return this.resize(Se+1),this.emplace(Se,e,r,s,c,f,_,x,E,A,C,L,B,U,N,$,te,ue,ve,ye,xe,Ee)}emplace(e,r,s,c,f,_,x,E,A,C,L,B,U,N,$,te,ue,ve,ye,xe,Ee,Se){const qe=30*e,We=15*e,tt=60*e;return this.int16[qe+0]=r,this.int16[qe+1]=s,this.int16[qe+2]=c,this.float32[We+2]=f,this.float32[We+3]=_,this.uint16[qe+8]=x,this.uint16[qe+9]=E,this.uint32[We+5]=A,this.uint32[We+6]=C,this.uint32[We+7]=L,this.uint16[qe+16]=B,this.uint16[qe+17]=U,this.uint16[qe+18]=N,this.float32[We+10]=$,this.float32[We+11]=te,this.uint8[tt+48]=ue,this.uint8[tt+49]=ve,this.uint8[tt+50]=ye,this.uint32[We+13]=xe,this.int16[qe+28]=Ee,this.uint8[tt+58]=Se,e}}jr.prototype.bytesPerElement=60,Ct(jr,"StructArrayLayout3i2f2ui3ul3ui2f3ub1ul1i1ub60");class Ho extends ut{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer),this.uint32=new Uint32Array(this.arrayBuffer)}emplaceBack(e,r,s,c,f,_,x,E,A,C,L,B,U,N,$,te,ue,ve,ye,xe,Ee,Se,qe,We,tt,at,Be,et,lt,ct){const Mt=this.length;return this.resize(Mt+1),this.emplace(Mt,e,r,s,c,f,_,x,E,A,C,L,B,U,N,$,te,ue,ve,ye,xe,Ee,Se,qe,We,tt,at,Be,et,lt,ct)}emplace(e,r,s,c,f,_,x,E,A,C,L,B,U,N,$,te,ue,ve,ye,xe,Ee,Se,qe,We,tt,at,Be,et,lt,ct,Mt){const ot=38*e,Tt=19*e;return this.int16[ot+0]=r,this.int16[ot+1]=s,this.int16[ot+2]=c,this.float32[Tt+2]=f,this.float32[Tt+3]=_,this.int16[ot+8]=x,this.int16[ot+9]=E,this.int16[ot+10]=A,this.int16[ot+11]=C,this.int16[ot+12]=L,this.int16[ot+13]=B,this.uint16[ot+14]=U,this.uint16[ot+15]=N,this.uint16[ot+16]=$,this.uint16[ot+17]=te,this.uint16[ot+18]=ue,this.uint16[ot+19]=ve,this.uint16[ot+20]=ye,this.uint16[ot+21]=xe,this.uint16[ot+22]=Ee,this.uint16[ot+23]=Se,this.uint16[ot+24]=qe,this.uint16[ot+25]=We,this.uint16[ot+26]=tt,this.uint16[ot+27]=at,this.uint16[ot+28]=Be,this.uint32[Tt+15]=et,this.float32[Tt+16]=lt,this.float32[Tt+17]=ct,this.float32[Tt+18]=Mt,e}}Ho.prototype.bytesPerElement=76,Ct(Ho,"StructArrayLayout3i2f6i15ui1ul3f76");class Tn extends ut{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)}emplaceBack(e){const r=this.length;return this.resize(r+1),this.emplace(r,e)}emplace(e,r){return this.float32[1*e+0]=r,e}}Tn.prototype.bytesPerElement=4,Ct(Tn,"StructArrayLayout1f4");class Ss extends ut{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)}emplaceBack(e,r,s,c,f,_,x){const E=this.length;return this.resize(E+1),this.emplace(E,e,r,s,c,f,_,x)}emplace(e,r,s,c,f,_,x,E){const A=7*e;return this.float32[A+0]=r,this.float32[A+1]=s,this.float32[A+2]=c,this.float32[A+3]=f,this.float32[A+4]=_,this.float32[A+5]=x,this.float32[A+6]=E,e}}Ss.prototype.bytesPerElement=28,Ct(Ss,"StructArrayLayout7f28");class Ms extends ut{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)}emplaceBack(e,r,s,c,f){const _=this.length;return this.resize(_+1),this.emplace(_,e,r,s,c,f)}emplace(e,r,s,c,f,_){const x=5*e;return this.float32[x+0]=r,this.float32[x+1]=s,this.float32[x+2]=c,this.float32[x+3]=f,this.float32[x+4]=_,e}}Ms.prototype.bytesPerElement=20,Ct(Ms,"StructArrayLayout5f20");class vo extends ut{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.uint32=new Uint32Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer)}emplaceBack(e,r,s,c){const f=this.length;return this.resize(f+1),this.emplace(f,e,r,s,c)}emplace(e,r,s,c,f){const _=6*e;return this.uint32[3*e+0]=r,this.uint16[_+2]=s,this.uint16[_+3]=c,this.uint16[_+4]=f,e}}vo.prototype.bytesPerElement=12,Ct(vo,"StructArrayLayout1ul3ui12");class hr extends ut{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer)}emplaceBack(e,r){const s=this.length;return this.resize(s+1),this.emplace(s,e,r)}emplace(e,r,s){const c=2*e;return this.uint16[c+0]=r,this.uint16[c+1]=s,e}}hr.prototype.bytesPerElement=4,Ct(hr,"StructArrayLayout2ui4");class On extends ut{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer)}emplaceBack(e){const r=this.length;return this.resize(r+1),this.emplace(r,e)}emplace(e,r){return this.uint16[1*e+0]=r,e}}On.prototype.bytesPerElement=2,Ct(On,"StructArrayLayout1ui2");class io extends ut{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)}emplaceBack(e,r){const s=this.length;return this.resize(s+1),this.emplace(s,e,r)}emplace(e,r,s){const c=2*e;return this.float32[c+0]=r,this.float32[c+1]=s,e}}io.prototype.bytesPerElement=8,Ct(io,"StructArrayLayout2f8");class Sa extends yt{get a_pos_30(){return this._structArray.int16[this._pos2+0]}get a_pos_31(){return this._structArray.int16[this._pos2+1]}get a_pos_32(){return this._structArray.int16[this._pos2+2]}get a_pos_normal_30(){return this._structArray.int16[this._pos2+3]}get a_pos_normal_31(){return this._structArray.int16[this._pos2+4]}get a_pos_normal_32(){return this._structArray.int16[this._pos2+5]}}Sa.prototype.size=12;class b1 extends Ri{get(e){return new Sa(this,e)}}Ct(b1,"FillExtrusionExtArray");class w1 extends yt{get projectedAnchorX(){return this._structArray.int16[this._pos2+0]}get projectedAnchorY(){return this._structArray.int16[this._pos2+1]}get projectedAnchorZ(){return this._structArray.int16[this._pos2+2]}get tileAnchorX(){return this._structArray.int16[this._pos2+3]}get tileAnchorY(){return this._structArray.int16[this._pos2+4]}get x1(){return this._structArray.float32[this._pos4+3]}get y1(){return this._structArray.float32[this._pos4+4]}get x2(){return this._structArray.float32[this._pos4+5]}get y2(){return this._structArray.float32[this._pos4+6]}get padding(){return this._structArray.int16[this._pos2+14]}get featureIndex(){return this._structArray.uint32[this._pos4+8]}get sourceLayerIndex(){return this._structArray.uint16[this._pos2+18]}get bucketIndex(){return this._structArray.uint16[this._pos2+19]}}w1.prototype.size=40;class yf extends qi{get(e){return new w1(this,e)}}Ct(yf,"CollisionBoxArray");class E1 extends yt{get projectedAnchorX(){return this._structArray.int16[this._pos2+0]}get projectedAnchorY(){return this._structArray.int16[this._pos2+1]}get projectedAnchorZ(){return this._structArray.int16[this._pos2+2]}get tileAnchorX(){return this._structArray.float32[this._pos4+2]}get tileAnchorY(){return this._structArray.float32[this._pos4+3]}get glyphStartIndex(){return this._structArray.uint16[this._pos2+8]}get numGlyphs(){return this._structArray.uint16[this._pos2+9]}get vertexStartIndex(){return this._structArray.uint32[this._pos4+5]}get lineStartIndex(){return this._structArray.uint32[this._pos4+6]}get lineLength(){return this._structArray.uint32[this._pos4+7]}get segment(){return this._structArray.uint16[this._pos2+16]}get lowerSize(){return this._structArray.uint16[this._pos2+17]}get upperSize(){return this._structArray.uint16[this._pos2+18]}get lineOffsetX(){return this._structArray.float32[this._pos4+10]}get lineOffsetY(){return this._structArray.float32[this._pos4+11]}get writingMode(){return this._structArray.uint8[this._pos1+48]}get placedOrientation(){return this._structArray.uint8[this._pos1+49]}set placedOrientation(e){this._structArray.uint8[this._pos1+49]=e}get hidden(){return this._structArray.uint8[this._pos1+50]}set hidden(e){this._structArray.uint8[this._pos1+50]=e}get crossTileID(){return this._structArray.uint32[this._pos4+13]}set crossTileID(e){this._structArray.uint32[this._pos4+13]=e}get associatedIconIndex(){return this._structArray.int16[this._pos2+28]}get flipState(){return this._structArray.uint8[this._pos1+58]}set flipState(e){this._structArray.uint8[this._pos1+58]=e}}E1.prototype.size=60;class T1 extends jr{get(e){return new E1(this,e)}}Ct(T1,"PlacedSymbolArray");class A1 extends yt{get projectedAnchorX(){return this._structArray.int16[this._pos2+0]}get projectedAnchorY(){return this._structArray.int16[this._pos2+1]}get projectedAnchorZ(){return this._structArray.int16[this._pos2+2]}get tileAnchorX(){return this._structArray.float32[this._pos4+2]}get tileAnchorY(){return this._structArray.float32[this._pos4+3]}get rightJustifiedTextSymbolIndex(){return this._structArray.int16[this._pos2+8]}get centerJustifiedTextSymbolIndex(){return this._structArray.int16[this._pos2+9]}get leftJustifiedTextSymbolIndex(){return this._structArray.int16[this._pos2+10]}get verticalPlacedTextSymbolIndex(){return this._structArray.int16[this._pos2+11]}get placedIconSymbolIndex(){return this._structArray.int16[this._pos2+12]}get verticalPlacedIconSymbolIndex(){return this._structArray.int16[this._pos2+13]}get key(){return this._structArray.uint16[this._pos2+14]}get textBoxStartIndex(){return this._structArray.uint16[this._pos2+15]}get textBoxEndIndex(){return this._structArray.uint16[this._pos2+16]}get verticalTextBoxStartIndex(){return this._structArray.uint16[this._pos2+17]}get verticalTextBoxEndIndex(){return this._structArray.uint16[this._pos2+18]}get iconBoxStartIndex(){return this._structArray.uint16[this._pos2+19]}get iconBoxEndIndex(){return this._structArray.uint16[this._pos2+20]}get verticalIconBoxStartIndex(){return this._structArray.uint16[this._pos2+21]}get verticalIconBoxEndIndex(){return this._structArray.uint16[this._pos2+22]}get featureIndex(){return this._structArray.uint16[this._pos2+23]}get numHorizontalGlyphVertices(){return this._structArray.uint16[this._pos2+24]}get numVerticalGlyphVertices(){return this._structArray.uint16[this._pos2+25]}get numIconVertices(){return this._structArray.uint16[this._pos2+26]}get numVerticalIconVertices(){return this._structArray.uint16[this._pos2+27]}get useRuntimeCollisionCircles(){return this._structArray.uint16[this._pos2+28]}get crossTileID(){return this._structArray.uint32[this._pos4+15]}set crossTileID(e){this._structArray.uint32[this._pos4+15]=e}get textOffset0(){return this._structArray.float32[this._pos4+16]}get textOffset1(){return this._structArray.float32[this._pos4+17]}get collisionCircleDiameter(){return this._structArray.float32[this._pos4+18]}}A1.prototype.size=76;class S1 extends Ho{get(e){return new A1(this,e)}}Ct(S1,"SymbolInstanceArray");class M1 extends Tn{getoffsetX(e){return this.float32[1*e+0]}}Ct(M1,"GlyphOffsetArray");class I1 extends oi{getx(e){return this.int16[3*e+0]}gety(e){return this.int16[3*e+1]}gettileUnitDistanceFromAnchor(e){return this.int16[3*e+2]}}Ct(I1,"SymbolLineVertexArray");class k1 extends yt{get featureIndex(){return this._structArray.uint32[this._pos4+0]}get sourceLayerIndex(){return this._structArray.uint16[this._pos2+2]}get bucketIndex(){return this._structArray.uint16[this._pos2+3]}get layoutVertexArrayOffset(){return this._structArray.uint16[this._pos2+4]}}k1.prototype.size=12;class C1 extends vo{get(e){return new k1(this,e)}}Ct(C1,"FeatureIndexArray");class z1 extends yt{get a_centroid_pos0(){return this._structArray.uint16[this._pos2+0]}get a_centroid_pos1(){return this._structArray.uint16[this._pos2+1]}}z1.prototype.size=4;class P1 extends hr{get(e){return new z1(this,e)}}Ct(P1,"FillExtrusionCentroidArray");class D1 extends yt{get a_pos_30(){return this._structArray.int16[this._pos2+0]}get a_pos_31(){return this._structArray.int16[this._pos2+1]}get a_pos_32(){return this._structArray.int16[this._pos2+2]}get a_pos_normal_30(){return this._structArray.int16[this._pos2+3]}get a_pos_normal_31(){return this._structArray.int16[this._pos2+4]}get a_pos_normal_32(){return this._structArray.int16[this._pos2+5]}}D1.prototype.size=12;class L1 extends Ri{get(e){return new D1(this,e)}}Ct(L1,"CircleGlobeExtArray");const Jy=gt([{name:"a_pattern_to",components:4,type:"Uint16"},{name:"a_pattern_from",components:4,type:"Uint16"},{name:"a_pixel_ratio_to",components:1,type:"Uint16"},{name:"a_pixel_ratio_from",components:1,type:"Uint16"}]),Qy=gt([{name:"a_dash_to",components:4,type:"Uint16"},{name:"a_dash_from",components:4,type:"Uint16"}]);var R1=ps(function(i){i.exports=function(e,r){var s,c,f,_,x,E,A,C;for(c=e.length-(s=3&e.length),f=r,x=3432918353,E=461845907,C=0;C<c;)A=255&e.charCodeAt(C)|(255&e.charCodeAt(++C))<<8|(255&e.charCodeAt(++C))<<16|(255&e.charCodeAt(++C))<<24,++C,f=27492+(65535&(_=5*(65535&(f=(f^=A=(65535&(A=(A=(65535&A)*x+(((A>>>16)*x&65535)<<16)&4294967295)<<15|A>>>17))*E+(((A>>>16)*E&65535)<<16)&4294967295)<<13|f>>>19))+((5*(f>>>16)&65535)<<16)&4294967295))+((58964+(_>>>16)&65535)<<16);switch(A=0,s){case 3:A^=(255&e.charCodeAt(C+2))<<16;case 2:A^=(255&e.charCodeAt(C+1))<<8;case 1:f^=A=(65535&(A=(A=(65535&(A^=255&e.charCodeAt(C)))*x+(((A>>>16)*x&65535)<<16)&4294967295)<<15|A>>>17))*E+(((A>>>16)*E&65535)<<16)&4294967295}return f^=e.length,f=2246822507*(65535&(f^=f>>>16))+((2246822507*(f>>>16)&65535)<<16)&4294967295,f=3266489909*(65535&(f^=f>>>13))+((3266489909*(f>>>16)&65535)<<16)&4294967295,(f^=f>>>16)>>>0}}),e2=ps(function(i){i.exports=function(e,r){for(var s,c=e.length,f=r^c,_=0;c>=4;)s=1540483477*(65535&(s=255&e.charCodeAt(_)|(255&e.charCodeAt(++_))<<8|(255&e.charCodeAt(++_))<<16|(255&e.charCodeAt(++_))<<24))+((1540483477*(s>>>16)&65535)<<16),f=1540483477*(65535&f)+((1540483477*(f>>>16)&65535)<<16)^(s=1540483477*(65535&(s^=s>>>24))+((1540483477*(s>>>16)&65535)<<16)),c-=4,++_;switch(c){case 3:f^=(255&e.charCodeAt(_+2))<<16;case 2:f^=(255&e.charCodeAt(_+1))<<8;case 1:f=1540483477*(65535&(f^=255&e.charCodeAt(_)))+((1540483477*(f>>>16)&65535)<<16)}return f=1540483477*(65535&(f^=f>>>13))+((1540483477*(f>>>16)&65535)<<16),(f^=f>>>15)>>>0}}),Yc=R1,t2=e2;Yc.murmur3=R1,Yc.murmur2=t2;class Bh{constructor(){this.ids=[],this.positions=[],this.indexed=!1}add(e,r,s,c){this.ids.push(B1(e)),this.positions.push(r,s,c)}getPositions(e){const r=B1(e);let s=0,c=this.ids.length-1;for(;s<c;){const _=s+c>>1;this.ids[_]>=r?c=_:s=_+1}const f=[];for(;this.ids[s]===r;)f.push({index:this.positions[3*s],start:this.positions[3*s+1],end:this.positions[3*s+2]}),s++;return f}static serialize(e,r){const s=new Float64Array(e.ids),c=new Uint32Array(e.positions);return vf(s,c,0,s.length-1),r&&r.push(s.buffer,c.buffer),{ids:s,positions:c}}static deserialize(e){const r=new Bh;return r.ids=e.ids,r.positions=e.positions,r.indexed=!0,r}}function B1(i){const e=+i;return!isNaN(e)&&Number.MIN_SAFE_INTEGER<=e&&e<=Number.MAX_SAFE_INTEGER?e:Yc(String(i))}function vf(i,e,r,s){for(;r<s;){const c=i[r+s>>1];let f=r-1,_=s+1;for(;;){do f++;while(i[f]<c);do _--;while(i[_]>c);if(f>=_)break;Oh(i,f,_),Oh(e,3*f,3*_),Oh(e,3*f+1,3*_+1),Oh(e,3*f+2,3*_+2)}_-r<s-_?(vf(i,e,r,_),r=_+1):(vf(i,e,_+1,s),s=_)}}function Oh(i,e,r){const s=i[e];i[e]=i[r],i[r]=s}Ct(Bh,"FeaturePositionMap");class Yo{constructor(e,r){this.gl=e.gl,this.location=r}}class Fh extends Yo{constructor(e,r){super(e,r),this.current=0}set(e){this.current!==e&&(this.current=e,this.gl.uniform1f(this.location,e))}}class O1 extends Yo{constructor(e,r){super(e,r),this.current=[0,0,0,0]}set(e){e[0]===this.current[0]&&e[1]===this.current[1]&&e[2]===this.current[2]&&e[3]===this.current[3]||(this.current=e,this.gl.uniform4f(this.location,e[0],e[1],e[2],e[3]))}}class F1 extends Yo{constructor(e,r){super(e,r),this.current=tr.transparent}set(e){e.r===this.current.r&&e.g===this.current.g&&e.b===this.current.b&&e.a===this.current.a||(this.current=e,this.gl.uniform4f(this.location,e.r,e.g,e.b,e.a))}}const i2=new Float32Array(16),r2=new Float32Array(9),n2=new Float32Array(4);function xf(i){return[Ft(255*i.r,255*i.g),Ft(255*i.b,255*i.a)]}class Kc{constructor(e,r,s){this.value=e,this.uniformNames=r.map(c=>`u_${c}`),this.type=s}setUniform(e,r,s){e.set(s.constantOr(this.value))}getBinding(e,r,s){return this.type==="color"?new F1(e,r):new Fh(e,r)}}class Vl{constructor(e,r){this.uniformNames=r.map(s=>`u_${s}`),this.patternFrom=null,this.patternTo=null,this.pixelRatioFrom=1,this.pixelRatioTo=1}setConstantPatternPositions(e,r){this.pixelRatioFrom=r.pixelRatio||1,this.pixelRatioTo=e.pixelRatio||1,this.patternFrom=r.tl.concat(r.br),this.patternTo=e.tl.concat(e.br)}setUniform(e,r,s,c){const f=c==="u_pattern_to"||c==="u_dash_to"?this.patternTo:c==="u_pattern_from"||c==="u_dash_from"?this.patternFrom:c==="u_pixel_ratio_to"?this.pixelRatioTo:c==="u_pixel_ratio_from"?this.pixelRatioFrom:null;f&&e.set(f)}getBinding(e,r,s){return s==="u_pattern_from"||s==="u_pattern_to"||s==="u_dash_from"||s==="u_dash_to"?new O1(e,r):new Fh(e,r)}}class Ko{constructor(e,r,s,c){this.expression=e,this.type=s,this.maxValue=0,this.paintVertexAttributes=r.map(f=>({name:`a_${f}`,type:"Float32",components:s==="color"?2:1,offset:0})),this.paintVertexArray=new c}populatePaintArray(e,r,s,c,f,_){const x=this.paintVertexArray.length,E=this.expression.evaluate(new ne(0),r,{},f,c,_);this.paintVertexArray.resize(e),this._setPaintValue(x,e,E)}updatePaintArray(e,r,s,c,f){const _=this.expression.evaluate({zoom:0},s,c,void 0,f);this._setPaintValue(e,r,_)}_setPaintValue(e,r,s){if(this.type==="color"){const c=xf(s);for(let f=e;f<r;f++)this.paintVertexArray.emplace(f,c[0],c[1])}else{for(let c=e;c<r;c++)this.paintVertexArray.emplace(c,s);this.maxValue=Math.max(this.maxValue,Math.abs(s))}}upload(e){this.paintVertexArray&&this.paintVertexArray.arrayBuffer&&(this.paintVertexBuffer&&this.paintVertexBuffer.buffer?this.paintVertexBuffer.updateData(this.paintVertexArray):this.paintVertexBuffer=e.createVertexBuffer(this.paintVertexArray,this.paintVertexAttributes,this.expression.isStateDependent))}destroy(){this.paintVertexBuffer&&this.paintVertexBuffer.destroy()}}class ro{constructor(e,r,s,c,f,_){this.expression=e,this.uniformNames=r.map(x=>`u_${x}_t`),this.type=s,this.useIntegerZoom=c,this.zoom=f,this.maxValue=0,this.paintVertexAttributes=r.map(x=>({name:`a_${x}`,type:"Float32",components:s==="color"?4:2,offset:0})),this.paintVertexArray=new _}populatePaintArray(e,r,s,c,f,_){const x=this.expression.evaluate(new ne(this.zoom),r,{},f,c,_),E=this.expression.evaluate(new ne(this.zoom+1),r,{},f,c,_),A=this.paintVertexArray.length;this.paintVertexArray.resize(e),this._setPaintValue(A,e,x,E)}updatePaintArray(e,r,s,c,f){const _=this.expression.evaluate({zoom:this.zoom},s,c,void 0,f),x=this.expression.evaluate({zoom:this.zoom+1},s,c,void 0,f);this._setPaintValue(e,r,_,x)}_setPaintValue(e,r,s,c){if(this.type==="color"){const f=xf(s),_=xf(c);for(let x=e;x<r;x++)this.paintVertexArray.emplace(x,f[0],f[1],_[0],_[1])}else{for(let f=e;f<r;f++)this.paintVertexArray.emplace(f,s,c);this.maxValue=Math.max(this.maxValue,Math.abs(s),Math.abs(c))}}upload(e){this.paintVertexArray&&this.paintVertexArray.arrayBuffer&&(this.paintVertexBuffer&&this.paintVertexBuffer.buffer?this.paintVertexBuffer.updateData(this.paintVertexArray):this.paintVertexBuffer=e.createVertexBuffer(this.paintVertexArray,this.paintVertexAttributes,this.expression.isStateDependent))}destroy(){this.paintVertexBuffer&&this.paintVertexBuffer.destroy()}setUniform(e,r){const s=this.useIntegerZoom?Math.floor(r.zoom):r.zoom,c=re(this.expression.interpolationFactor(s,this.zoom,this.zoom+1),0,1);e.set(c)}getBinding(e,r,s){return new Fh(e,r)}}class Is{constructor(e,r,s,c,f,_,x){this.expression=e,this.type=s,this.useIntegerZoom=c,this.zoom=f,this.layerId=x,this.paintVertexAttributes=(s==="array"?Qy:Jy).members;for(let E=0;E<r.length;++E);this.zoomInPaintVertexArray=new _,this.zoomOutPaintVertexArray=new _}populatePaintArray(e,r,s){const c=this.zoomInPaintVertexArray.length;this.zoomInPaintVertexArray.resize(e),this.zoomOutPaintVertexArray.resize(e),this._setPaintValues(c,e,r.patterns&&r.patterns[this.layerId],s)}updatePaintArray(e,r,s,c,f,_){this._setPaintValues(e,r,s.patterns&&s.patterns[this.layerId],_)}_setPaintValues(e,r,s,c){if(!c||!s)return;const{min:f,mid:_,max:x}=s,E=c[f],A=c[_],C=c[x];if(E&&A&&C)for(let L=e;L<r;L++)this._setPaintValue(this.zoomInPaintVertexArray,L,A,E),this._setPaintValue(this.zoomOutPaintVertexArray,L,A,C)}_setPaintValue(e,r,s,c){e.emplace(r,s.tl[0],s.tl[1],s.br[0],s.br[1],c.tl[0],c.tl[1],c.br[0],c.br[1],s.pixelRatio,c.pixelRatio)}upload(e){this.zoomInPaintVertexArray&&this.zoomInPaintVertexArray.arrayBuffer&&this.zoomOutPaintVertexArray&&this.zoomOutPaintVertexArray.arrayBuffer&&(this.zoomInPaintVertexBuffer=e.createVertexBuffer(this.zoomInPaintVertexArray,this.paintVertexAttributes,this.expression.isStateDependent),this.zoomOutPaintVertexBuffer=e.createVertexBuffer(this.zoomOutPaintVertexArray,this.paintVertexAttributes,this.expression.isStateDependent))}destroy(){this.zoomOutPaintVertexBuffer&&this.zoomOutPaintVertexBuffer.destroy(),this.zoomInPaintVertexBuffer&&this.zoomInPaintVertexBuffer.destroy()}}class ks{constructor(e,r,s=()=>!0){this.binders={},this._buffers=[];const c=[];for(const f in e.paint._values){if(!s(f))continue;const _=e.paint.get(f);if(!(_ instanceof Ze&&xs(_.property.specification)))continue;const x=s2(f,e.type),E=_.value,A=_.property.specification.type,C=_.property.useIntegerZoom,L=_.property.specification["property-type"],B=L==="cross-faded"||L==="cross-faded-data-driven",U=String(f)==="line-dasharray"&&e.layout.get("line-cap").value.kind!=="constant";if(E.kind!=="constant"||U)if(E.kind==="source"||U||B){const N=U1(f,A,"source");this.binders[f]=B?new Is(E,x,A,C,r,N,e.id):new Ko(E,x,A,N),c.push(`/a_${f}`)}else{const N=U1(f,A,"composite");this.binders[f]=new ro(E,x,A,C,r,N),c.push(`/z_${f}`)}else this.binders[f]=B?new Vl(E.value,x):new Kc(E.value,x,A),c.push(`/u_${f}`)}this.cacheKey=c.sort().join("")}getMaxValue(e){const r=this.binders[e];return r instanceof Ko||r instanceof ro?r.maxValue:0}populatePaintArrays(e,r,s,c,f,_){for(const x in this.binders){const E=this.binders[x];(E instanceof Ko||E instanceof ro||E instanceof Is)&&E.populatePaintArray(e,r,s,c,f,_)}}setConstantPatternPositions(e,r){for(const s in this.binders){const c=this.binders[s];c instanceof Vl&&c.setConstantPatternPositions(e,r)}}updatePaintArrays(e,r,s,c,f,_){let x=!1;for(const E in e){const A=r.getPositions(E);for(const C of A){const L=s.feature(C.index);for(const B in this.binders){const U=this.binders[B];if((U instanceof Ko||U instanceof ro||U instanceof Is)&&U.expression.isStateDependent===!0){const N=c.paint.get(B);U.expression=N.value,U.updatePaintArray(C.start,C.end,L,e[E],f,_),x=!0}}}}return x}defines(){const e=[];for(const r in this.binders){const s=this.binders[r];(s instanceof Kc||s instanceof Vl)&&e.push(...s.uniformNames.map(c=>`#define HAS_UNIFORM_${c}`))}return e}getBinderAttributes(){const e=[];for(const r in this.binders){const s=this.binders[r];if(s instanceof Ko||s instanceof ro||s instanceof Is)for(let c=0;c<s.paintVertexAttributes.length;c++)e.push(s.paintVertexAttributes[c].name)}return e}getBinderUniforms(){const e=[];for(const r in this.binders){const s=this.binders[r];if(s instanceof Kc||s instanceof Vl||s instanceof ro)for(const c of s.uniformNames)e.push(c)}return e}getPaintVertexBuffers(){return this._buffers}getUniforms(e,r){const s=[];for(const c in this.binders){const f=this.binders[c];if(f instanceof Kc||f instanceof Vl||f instanceof ro){for(const _ of f.uniformNames)if(r[_]){const x=f.getBinding(e,r[_],_);s.push({name:_,property:c,binding:x})}}}return s}setUniforms(e,r,s,c){for(const{name:f,property:_,binding:x}of r)this.binders[_].setUniform(x,c,s.get(_),f)}updatePaintBuffers(e){this._buffers=[];for(const r in this.binders){const s=this.binders[r];if(e&&s instanceof Is){const c=e.fromScale===2?s.zoomInPaintVertexBuffer:s.zoomOutPaintVertexBuffer;c&&this._buffers.push(c)}else(s instanceof Ko||s instanceof ro)&&s.paintVertexBuffer&&this._buffers.push(s.paintVertexBuffer)}}upload(e){for(const r in this.binders){const s=this.binders[r];(s instanceof Ko||s instanceof ro||s instanceof Is)&&s.upload(e)}this.updatePaintBuffers()}destroy(){for(const e in this.binders){const r=this.binders[e];(r instanceof Ko||r instanceof ro||r instanceof Is)&&r.destroy()}}}class Ma{constructor(e,r,s=()=>!0){this.programConfigurations={};for(const c of e)this.programConfigurations[c.id]=new ks(c,r,s);this.needsUpload=!1,this._featureMap=new Bh,this._bufferOffset=0}populatePaintArrays(e,r,s,c,f,_,x){for(const E in this.programConfigurations)this.programConfigurations[E].populatePaintArrays(e,r,c,f,_,x);r.id!==void 0&&this._featureMap.add(r.id,s,this._bufferOffset,e),this._bufferOffset=e,this.needsUpload=!0}updatePaintArrays(e,r,s,c,f){for(const _ of s)this.needsUpload=this.programConfigurations[_.id].updatePaintArrays(e,this._featureMap,r,_,c,f)||this.needsUpload}get(e){return this.programConfigurations[e]}upload(e){if(this.needsUpload){for(const r in this.programConfigurations)this.programConfigurations[r].upload(e);this.needsUpload=!1}}destroy(){for(const e in this.programConfigurations)this.programConfigurations[e].destroy()}}const o2={"text-opacity":["opacity"],"icon-opacity":["opacity"],"text-color":["fill_color"],"icon-color":["fill_color"],"text-halo-color":["halo_color"],"icon-halo-color":["halo_color"],"text-halo-blur":["halo_blur"],"icon-halo-blur":["halo_blur"],"text-halo-width":["halo_width"],"icon-halo-width":["halo_width"],"line-gap-width":["gapwidth"],"line-pattern":["pattern_to","pattern_from","pixel_ratio_to","pixel_ratio_from"],"fill-pattern":["pattern_to","pattern_from","pixel_ratio_to","pixel_ratio_from"],"fill-extrusion-pattern":["pattern_to","pattern_from","pixel_ratio_to","pixel_ratio_from"],"line-dasharray":["dash_to","dash_from"]};function s2(i,e){return o2[i]||[i.replace(`${e}-`,"").replace(/-/g,"_")]}const a2={"line-pattern":{source:zi,composite:zi},"fill-pattern":{source:zi,composite:zi},"fill-extrusion-pattern":{source:zi,composite:zi},"line-dasharray":{source:nr,composite:nr}},l2={color:{source:io,composite:Si},number:{source:Tn,composite:io}};function U1(i,e,r){const s=a2[i];return s&&s[r]||l2[e][r]}Ct(Kc,"ConstantBinder"),Ct(Vl,"CrossFadedConstantBinder"),Ct(Ko,"SourceExpressionBinder"),Ct(Is,"CrossFadedCompositeBinder"),Ct(ro,"CompositeExpressionBinder"),Ct(ks,"ProgramConfiguration",{omit:["_buffers"]}),Ct(Ma,"ProgramConfigurationSet");const Uh="-transition";class no extends ki{constructor(e,r){if(super(),this.id=e.id,this.type=e.type,this._featureFilter={filter:()=>!0,needGeometry:!1,needFeature:!1},this._filterCompiled=!1,e.type!=="custom"&&(this.metadata=(e=e).metadata,this.minzoom=e.minzoom,this.maxzoom=e.maxzoom,e.type!=="background"&&e.type!=="sky"&&(this.source=e.source,this.sourceLayer=e["source-layer"],this.filter=e.filter),r.layout&&(this._unevaluatedLayout=new Ve(r.layout)),r.paint)){this._transitionablePaint=new he(r.paint);for(const s in e.paint)this.setPaintProperty(s,e.paint[s],{validate:!1});for(const s in e.layout)this.setLayoutProperty(s,e.layout[s],{validate:!1});this._transitioningPaint=this._transitionablePaint.untransitioned(),this.paint=new je(r.paint)}}getCrossfadeParameters(){return this._crossfadeParameters}getLayoutProperty(e){return e==="visibility"?this.visibility:this._unevaluatedLayout.getValue(e)}setLayoutProperty(e,r,s={}){r!=null&&this._validate(gf,`layers.${this.id}.layout.${e}`,e,r,s)||(e!=="visibility"?this._unevaluatedLayout.setValue(e,r):this.visibility=r)}getPaintProperty(e){return $t(e,Uh)?this._transitionablePaint.getTransition(e.slice(0,-Uh.length)):this._transitionablePaint.getValue(e)}setPaintProperty(e,r,s={}){if(r!=null&&this._validate(wh,`layers.${this.id}.paint.${e}`,e,r,s))return!1;if($t(e,Uh))return this._transitionablePaint.setTransition(e.slice(0,-Uh.length),r||void 0),!1;{const c=this._transitionablePaint._values[e],f=c.property.specification["property-type"]==="cross-faded-data-driven",_=c.value.isDataDriven(),x=c.value;this._transitionablePaint.setValue(e,r),this._handleSpecialPaintPropertyUpdate(e);const E=this._transitionablePaint._values[e].value;return E.isDataDriven()||_||f||this._handleOverridablePaintPropertyUpdate(e,x,E)}}_handleSpecialPaintPropertyUpdate(e){}getProgramIds(){return null}getProgramConfiguration(e){return null}_handleOverridablePaintPropertyUpdate(e,r,s){return!1}isHidden(e){return!!(this.minzoom&&e<this.minzoom)||!!(this.maxzoom&&e>=this.maxzoom)||this.visibility==="none"}updateTransitions(e){this._transitioningPaint=this._transitionablePaint.transitioned(e,this._transitioningPaint)}hasTransition(){return this._transitioningPaint.hasTransition()}recalculate(e,r){e.getCrossfadeParameters&&(this._crossfadeParameters=e.getCrossfadeParameters()),this._unevaluatedLayout&&(this.layout=this._unevaluatedLayout.possiblyEvaluate(e,void 0,r)),this.paint=this._transitioningPaint.possiblyEvaluate(e,void 0,r)}serialize(){const e={id:this.id,type:this.type,source:this.source,"source-layer":this.sourceLayer,metadata:this.metadata,minzoom:this.minzoom,maxzoom:this.maxzoom,filter:this.filter,layout:this._unevaluatedLayout&&this._unevaluatedLayout.serialize(),paint:this._transitionablePaint&&this._transitionablePaint.serialize()};return this.visibility&&(e.layout=e.layout||{},e.layout.visibility=this.visibility),Ht(e,(r,s)=>!(r===void 0||s==="layout"&&!Object.keys(r).length||s==="paint"&&!Object.keys(r).length))}_validate(e,r,s,c,f={}){return(!f||f.validate!==!1)&&Eh(this,e.call(bh,{key:r,layerType:this.type,objectKey:s,value:c,styleSpec:ke,style:{glyphs:!0,sprite:!0}}))}is3D(){return!1}isSky(){return!1}isTileClipped(){return!1}hasOffscreenPass(){return!1}resize(){}isStateDependent(){for(const e in this.paint._values){const r=this.paint.get(e);if(r instanceof Ze&&xs(r.property.specification)&&(r.value.kind==="source"||r.value.kind==="composite")&&r.value.isStateDependent)return!0}return!1}compileFilter(){this._filterCompiled||(this._featureFilter=Wo(this.filter),this._filterCompiled=!0)}invalidateCompiledFilter(){this._filterCompiled=!1}dynamicFilter(){return this._featureFilter.dynamicFilter}dynamicFilterNeedsFeature(){return this._featureFilter.needFeature}}const c2=gt([{name:"a_pos",components:2,type:"Int16"}],4),u2=gt([{name:"a_pos_3",components:3,type:"Int16"},{name:"a_pos_normal_3",components:3,type:"Int16"}]);class or{constructor(e=[]){this.segments=e}prepareSegment(e,r,s,c){let f=this.segments[this.segments.length-1];return e>or.MAX_VERTEX_ARRAY_LENGTH&&Kt(`Max vertices per segment is ${or.MAX_VERTEX_ARRAY_LENGTH}: bucket requested ${e}`),(!f||f.vertexLength+e>or.MAX_VERTEX_ARRAY_LENGTH||f.sortKey!==c)&&(f={vertexOffset:r.length,primitiveOffset:s.length,vertexLength:0,primitiveLength:0},c!==void 0&&(f.sortKey=c),this.segments.push(f)),f}get(){return this.segments}destroy(){for(const e of this.segments)for(const r in e.vaos)e.vaos[r].destroy()}static simpleSegment(e,r,s,c){return new or([{vertexOffset:e,primitiveOffset:r,vertexLength:s,primitiveLength:c,vaos:{},sortKey:0}])}}or.MAX_VERTEX_ARRAY_LENGTH=Math.pow(2,16)-1,Ct(or,"SegmentVector");var qt=8192;class Cs{constructor(e,r){e&&(r?this.setSouthWest(e).setNorthEast(r):e.length===4?this.setSouthWest([e[0],e[1]]).setNorthEast([e[2],e[3]]):this.setSouthWest(e[0]).setNorthEast(e[1]))}setNorthEast(e){return this._ne=e instanceof Di?new Di(e.lng,e.lat):Di.convert(e),this}setSouthWest(e){return this._sw=e instanceof Di?new Di(e.lng,e.lat):Di.convert(e),this}extend(e){const r=this._sw,s=this._ne;let c,f;if(e instanceof Di)c=e,f=e;else{if(!(e instanceof Cs))return Array.isArray(e)?e.length===4||e.every(Array.isArray)?this.extend(Cs.convert(e)):this.extend(Di.convert(e)):this;if(c=e._sw,f=e._ne,!c||!f)return this}return r||s?(r.lng=Math.min(c.lng,r.lng),r.lat=Math.min(c.lat,r.lat),s.lng=Math.max(f.lng,s.lng),s.lat=Math.max(f.lat,s.lat)):(this._sw=new Di(c.lng,c.lat),this._ne=new Di(f.lng,f.lat)),this}getCenter(){return new Di((this._sw.lng+this._ne.lng)/2,(this._sw.lat+this._ne.lat)/2)}getSouthWest(){return this._sw}getNorthEast(){return this._ne}getNorthWest(){return new Di(this.getWest(),this.getNorth())}getSouthEast(){return new Di(this.getEast(),this.getSouth())}getWest(){return this._sw.lng}getSouth(){return this._sw.lat}getEast(){return this._ne.lng}getNorth(){return this._ne.lat}toArray(){return[this._sw.toArray(),this._ne.toArray()]}toString(){return`LngLatBounds(${this._sw.toString()}, ${this._ne.toString()})`}isEmpty(){return!(this._sw&&this._ne)}contains(e){const{lng:r,lat:s}=Di.convert(e);let c=this._sw.lng<=r&&r<=this._ne.lng;return this._sw.lng>this._ne.lng&&(c=this._sw.lng>=r&&r>=this._ne.lng),this._sw.lat<=s&&s<=this._ne.lat&&c}static convert(e){return!e||e instanceof Cs?e:new Cs(e)}}const bf=63710088e-1;class Di{constructor(e,r){if(isNaN(e)||isNaN(r))throw new Error(`Invalid LngLat object: (${e}, ${r})`);if(this.lng=+e,this.lat=+r,this.lat>90||this.lat<-90)throw new Error("Invalid LngLat latitude value: must be between -90 and 90")}wrap(){return new Di($e(this.lng,-180,180),this.lat)}toArray(){return[this.lng,this.lat]}toString(){return`LngLat(${this.lng}, ${this.lat})`}distanceTo(e){const r=Math.PI/180,s=this.lat*r,c=e.lat*r,f=Math.sin(s)*Math.sin(c)+Math.cos(s)*Math.cos(c)*Math.cos((e.lng-this.lng)*r);return bf*Math.acos(Math.min(f,1))}toBounds(e=0){const r=360*e/40075017,s=r/Math.cos(Math.PI/180*this.lat);return new Cs(new Di(this.lng-s,this.lat-r),new Di(this.lng+s,this.lat+r))}static convert(e){if(e instanceof Di)return e;if(Array.isArray(e)&&(e.length===2||e.length===3))return new Di(Number(e[0]),Number(e[1]));if(!Array.isArray(e)&&typeof e=="object"&&e!==null)return new Di(Number("lng"in e?e.lng:e.lon),Number(e.lat));throw new Error("`LngLatLike` argument must be specified as a LngLat instance, an object {lng: <lng>, lat: <lat>}, an object {lon: <lng>, lat: <lat>}, or an array of [<lng>, <lat>]")}}const V1=2*Math.PI*bf;function wf(i){return V1*Math.cos(i*Math.PI/180)}function Ia(i){return(180+i)/360}function ka(i){return(180-180/Math.PI*Math.log(Math.tan(Math.PI/4+i*Math.PI/360)))/360}function Fn(i,e){return i/wf(e)}function Gr(i){return 360*i-180}function gr(i){return 360/Math.PI*Math.atan(Math.exp((180-360*i)*Math.PI/180))-90}function N1(i,e){return i*wf(gr(e))}const xo=85.051129;class Nl{constructor(e,r,s=0){this.x=+e,this.y=+r,this.z=+s}static fromLngLat(e,r=0){const s=Di.convert(e);return new Nl(Ia(s.lng),ka(s.lat),Fn(r,s.lat))}toLngLat(){return new Di(Gr(this.x),gr(this.y))}toAltitude(){return N1(this.z,this.y)}meterInMercatorCoordinateUnits(){return 1/V1*(e=gr(this.y),1/Math.cos(e*Math.PI/180));var e}}function Ef(i,e,r,s,c,f,_,x,E){const A=(e+s)/2,C=(r+c)/2,L=new I(A,C);x(L),function(B,U,N,$,te,ue){const ve=N-te,ye=$-ue;return Math.abs(($-U)*ve-(N-B)*ye)/Math.hypot(ve,ye)}(L.x,L.y,f.x,f.y,_.x,_.y)>=E?(Ef(i,e,r,A,C,f,L,x,E),Ef(i,A,C,s,c,L,_,x,E)):i.push(_)}function j1(i,e,r){let s=i[0],c=s.x,f=s.y;e(s);const _=[s];for(let x=1;x<i.length;x++){const E=i[x],{x:A,y:C}=E;e(E),Ef(_,c,f,A,C,s,E,e,r),c=A,f=C,s=E}return _}function Tf(i,e,r,s,c){if(c(e,r)){const f=e.add(r).mult(.5);s(f),Tf(i,e,f,s,c),Tf(i,f,r,s,c)}else i.push(r)}function h2(i,e,r){let s=i[0];e(s);const c=[s];for(let f=1;f<i.length;f++){const _=i[f];e(_),Tf(c,s,_,e,r),s=_}return c}const Af=Math.pow(2,14)-1,G1=-Af-1;function p2(i,e){const r=Math.round(i.x*e),s=Math.round(i.y*e);return i.x=re(r,G1,Af),i.y=re(s,G1,Af),(r<i.x||r>i.x+1||s<i.y||s>i.y+1)&&Kt("Geometry exceeds allowed extent, reduce your vector tile buffer size"),i}function Jo(i,e,r){const s=i.loadGeometry(),c=i.extent,f=qt/c;if(e&&r&&r.projection.isReprojectedInTileSpace){const _=1<<e.z,{scale:x,x:E,y:A,projection:C}=r,L=B=>{const U=Gr((e.x+B.x/c)/_),N=gr((e.y+B.y/c)/_),$=C.project(U,N);B.x=($.x*x-E)*c,B.y=($.y*x-A)*c};for(let B=0;B<s.length;B++)if(i.type!==1)s[B]=j1(s[B],L,1);else{const U=[];for(const N of s[B])N.x<0||N.x>=c||N.y<0||N.y>=c||(L(N),U.push(N));s[B]=U}}for(const _ of s)for(const x of _)p2(x,f);return s}function Ca(i,e){return{type:i.type,id:i.id,properties:i.properties,geometry:e?Jo(i):[]}}function Vh(i,e,r,s,c){i.emplaceBack(2*e+(s+1)/2,2*r+(c+1)/2)}function Nh(i,e,r){i.emplaceBack(e.x,e.y,e.z,r[0]*16384,r[1]*16384,r[2]*16384)}class Sf{constructor(e){this.zoom=e.zoom,this.overscaling=e.overscaling,this.layers=e.layers,this.layerIds=this.layers.map(r=>r.id),this.index=e.index,this.hasPattern=!1,this.projection=e.projection,this.layoutVertexArray=new Vt,this.indexArray=new yi,this.segments=new or,this.programConfigurations=new Ma(e.layers,e.zoom),this.stateDependentLayerIds=this.layers.filter(r=>r.isStateDependent()).map(r=>r.id)}populate(e,r,s,c){const f=this.layers[0],_=[];let x=null;f.type==="circle"&&(x=f.layout.get("circle-sort-key"));for(const{feature:A,id:C,index:L,sourceLayerIndex:B}of e){const U=this.layers[0]._featureFilter.needGeometry,N=Ca(A,U);if(!this.layers[0]._featureFilter.filter(new ne(this.zoom),N,s))continue;const $=x?x.evaluate(N,{},s):void 0,te={id:C,properties:A.properties,type:A.type,sourceLayerIndex:B,index:L,geometry:U?N.geometry:Jo(A,s,c),patterns:{},sortKey:$};_.push(te)}x&&_.sort((A,C)=>A.sortKey-C.sortKey);let E=null;c.projection.name==="globe"&&(this.globeExtVertexArray=new L1,E=c.projection);for(const A of _){const{geometry:C,index:L,sourceLayerIndex:B}=A,U=e[L].feature;this.addFeature(A,C,L,r.availableImages,s,E),r.featureIndex.insert(U,C,L,B,this.index)}}update(e,r,s,c){this.stateDependentLayers.length&&this.programConfigurations.updatePaintArrays(e,r,this.stateDependentLayers,s,c)}isEmpty(){return this.layoutVertexArray.length===0}uploadPending(){return!this.uploaded||this.programConfigurations.needsUpload}upload(e){this.uploaded||(this.layoutVertexBuffer=e.createVertexBuffer(this.layoutVertexArray,c2.members),this.indexBuffer=e.createIndexBuffer(this.indexArray),this.globeExtVertexArray&&(this.globeExtVertexBuffer=e.createVertexBuffer(this.globeExtVertexArray,u2.members))),this.programConfigurations.upload(e),this.uploaded=!0}destroy(){this.layoutVertexBuffer&&(this.layoutVertexBuffer.destroy(),this.indexBuffer.destroy(),this.programConfigurations.destroy(),this.segments.destroy(),this.globeExtVertexBuffer&&this.globeExtVertexBuffer.destroy())}addFeature(e,r,s,c,f,_){for(const x of r)for(const E of x){const A=E.x,C=E.y;if(A<0||A>=qt||C<0||C>=qt)continue;if(_){const U=_.projectTilePoint(A,C,f),N=_.upVector(f,A,C),$=this.globeExtVertexArray;Nh($,U,N),Nh($,U,N),Nh($,U,N),Nh($,U,N)}const L=this.segments.prepareSegment(4,this.layoutVertexArray,this.indexArray,e.sortKey),B=L.vertexLength;Vh(this.layoutVertexArray,A,C,-1,-1),Vh(this.layoutVertexArray,A,C,1,-1),Vh(this.layoutVertexArray,A,C,1,1),Vh(this.layoutVertexArray,A,C,-1,1),this.indexArray.emplaceBack(B,B+1,B+2),this.indexArray.emplaceBack(B,B+2,B+3),L.vertexLength+=4,L.primitiveLength+=2}this.programConfigurations.populatePaintArrays(this.layoutVertexArray.length,e,s,{},c,f)}}function q1(i,e){for(let r=0;r<i.length;r++)if(za(e,i[r]))return!0;for(let r=0;r<e.length;r++)if(za(i,e[r]))return!0;return!!Mf(i,e)}function f2(i,e,r){return!!za(i,e)||!!If(e,i,r)}function Z1(i,e){if(i.length===1)return W1(e,i[0]);for(let r=0;r<e.length;r++){const s=e[r];for(let c=0;c<s.length;c++)if(za(i,s[c]))return!0}for(let r=0;r<i.length;r++)if(W1(e,i[r]))return!0;for(let r=0;r<e.length;r++)if(Mf(i,e[r]))return!0;return!1}function d2(i,e,r){if(i.length>1){if(Mf(i,e))return!0;for(let s=0;s<e.length;s++)if(If(e[s],i,r))return!0}for(let s=0;s<i.length;s++)if(If(i[s],e,r))return!0;return!1}function Mf(i,e){if(i.length===0||e.length===0)return!1;for(let r=0;r<i.length-1;r++){const s=i[r],c=i[r+1];for(let f=0;f<e.length-1;f++)if(m2(s,c,e[f],e[f+1]))return!0}return!1}function m2(i,e,r,s){return Yt(i,r,s)!==Yt(e,r,s)&&Yt(i,e,r)!==Yt(i,e,s)}function If(i,e,r){const s=r*r;if(e.length===1)return i.distSqr(e[0])<s;for(let c=1;c<e.length;c++)if($1(i,e[c-1],e[c])<s)return!0;return!1}function $1(i,e,r){const s=e.distSqr(r);if(s===0)return i.distSqr(e);const c=((i.x-e.x)*(r.x-e.x)+(i.y-e.y)*(r.y-e.y))/s;return i.distSqr(c<0?e:c>1?r:r.sub(e)._mult(c)._add(e))}function W1(i,e){let r,s,c,f=!1;for(let _=0;_<i.length;_++){r=i[_];for(let x=0,E=r.length-1;x<r.length;E=x++)s=r[x],c=r[E],s.y>e.y!=c.y>e.y&&e.x<(c.x-s.x)*(e.y-s.y)/(c.y-s.y)+s.x&&(f=!f)}return f}function za(i,e){let r=!1;for(let s=0,c=i.length-1;s<i.length;c=s++){const f=i[s],_=i[c];f.y>e.y!=_.y>e.y&&e.x<(_.x-f.x)*(e.y-f.y)/(_.y-f.y)+f.x&&(r=!r)}return r}function X1(i,e,r,s,c){for(const _ of i)if(e<=_.x&&r<=_.y&&s>=_.x&&c>=_.y)return!0;const f=[new I(e,r),new I(e,c),new I(s,c),new I(s,r)];if(i.length>2){for(const _ of f)if(za(i,_))return!0}for(let _=0;_<i.length-1;_++)if(_2(i[_],i[_+1],f))return!0;return!1}function _2(i,e,r){const s=r[0],c=r[2];if(i.x<s.x&&e.x<s.x||i.x>c.x&&e.x>c.x||i.y<s.y&&e.y<s.y||i.y>c.y&&e.y>c.y)return!1;const f=Yt(i,e,r[0]);return f!==Yt(i,e,r[1])||f!==Yt(i,e,r[2])||f!==Yt(i,e,r[3])}function jl(i,e,r){const s=e.paint.get(i).value;return s.kind==="constant"?s.value:r.programConfigurations.get(e.id).getMaxValue(i)}function jh(i){return Math.sqrt(i[0]*i[0]+i[1]*i[1])}function H1(i,e,r,s,c){if(!e[0]&&!e[1])return i;const f=I.convert(e)._mult(c);r==="viewport"&&f._rotate(-s);const _=[];for(let x=0;x<i.length;x++)_.push(i[x].sub(f));return _}function Y1(i,e,r,s){const c=I.convert(i)._mult(s);return e==="viewport"&&c._rotate(-r),c}Ct(Sf,"CircleBucket",{omit:["layers"]});const g2=new Ke({"circle-sort-key":new _e(ke.layout_circle["circle-sort-key"])});var y2={paint:new Ke({"circle-radius":new _e(ke.paint_circle["circle-radius"]),"circle-color":new _e(ke.paint_circle["circle-color"]),"circle-blur":new _e(ke.paint_circle["circle-blur"]),"circle-opacity":new _e(ke.paint_circle["circle-opacity"]),"circle-translate":new Ue(ke.paint_circle["circle-translate"]),"circle-translate-anchor":new Ue(ke.paint_circle["circle-translate-anchor"]),"circle-pitch-scale":new Ue(ke.paint_circle["circle-pitch-scale"]),"circle-pitch-alignment":new Ue(ke.paint_circle["circle-pitch-alignment"]),"circle-stroke-width":new _e(ke.paint_circle["circle-stroke-width"]),"circle-stroke-color":new _e(ke.paint_circle["circle-stroke-color"]),"circle-stroke-opacity":new _e(ke.paint_circle["circle-stroke-opacity"])}),layout:g2},Gh=1e-6,hn=typeof Float32Array!="undefined"?Float32Array:Array;function K1(){var i=new hn(9);return hn!=Float32Array&&(i[1]=0,i[2]=0,i[3]=0,i[5]=0,i[6]=0,i[7]=0),i[0]=1,i[4]=1,i[8]=1,i}function pn(i){return i[0]=1,i[1]=0,i[2]=0,i[3]=0,i[4]=0,i[5]=1,i[6]=0,i[7]=0,i[8]=0,i[9]=0,i[10]=1,i[11]=0,i[12]=0,i[13]=0,i[14]=0,i[15]=1,i}function zs(i,e,r){var s=e[0],c=e[1],f=e[2],_=e[3],x=e[4],E=e[5],A=e[6],C=e[7],L=e[8],B=e[9],U=e[10],N=e[11],$=e[12],te=e[13],ue=e[14],ve=e[15],ye=r[0],xe=r[1],Ee=r[2],Se=r[3];return i[0]=ye*s+xe*x+Ee*L+Se*$,i[1]=ye*c+xe*E+Ee*B+Se*te,i[2]=ye*f+xe*A+Ee*U+Se*ue,i[3]=ye*_+xe*C+Ee*N+Se*ve,i[4]=(ye=r[4])*s+(xe=r[5])*x+(Ee=r[6])*L+(Se=r[7])*$,i[5]=ye*c+xe*E+Ee*B+Se*te,i[6]=ye*f+xe*A+Ee*U+Se*ue,i[7]=ye*_+xe*C+Ee*N+Se*ve,i[8]=(ye=r[8])*s+(xe=r[9])*x+(Ee=r[10])*L+(Se=r[11])*$,i[9]=ye*c+xe*E+Ee*B+Se*te,i[10]=ye*f+xe*A+Ee*U+Se*ue,i[11]=ye*_+xe*C+Ee*N+Se*ve,i[12]=(ye=r[12])*s+(xe=r[13])*x+(Ee=r[14])*L+(Se=r[15])*$,i[13]=ye*c+xe*E+Ee*B+Se*te,i[14]=ye*f+xe*A+Ee*U+Se*ue,i[15]=ye*_+xe*C+Ee*N+Se*ve,i}function Pa(i,e,r){var s,c,f,_,x,E,A,C,L,B,U,N,$=r[0],te=r[1],ue=r[2];return e===i?(i[12]=e[0]*$+e[4]*te+e[8]*ue+e[12],i[13]=e[1]*$+e[5]*te+e[9]*ue+e[13],i[14]=e[2]*$+e[6]*te+e[10]*ue+e[14],i[15]=e[3]*$+e[7]*te+e[11]*ue+e[15]):(c=e[1],f=e[2],_=e[3],x=e[4],E=e[5],A=e[6],C=e[7],L=e[8],B=e[9],U=e[10],N=e[11],i[0]=s=e[0],i[1]=c,i[2]=f,i[3]=_,i[4]=x,i[5]=E,i[6]=A,i[7]=C,i[8]=L,i[9]=B,i[10]=U,i[11]=N,i[12]=s*$+x*te+L*ue+e[12],i[13]=c*$+E*te+B*ue+e[13],i[14]=f*$+A*te+U*ue+e[14],i[15]=_*$+C*te+N*ue+e[15]),i}function bo(i,e,r){var s=r[0],c=r[1],f=r[2];return i[0]=e[0]*s,i[1]=e[1]*s,i[2]=e[2]*s,i[3]=e[3]*s,i[4]=e[4]*c,i[5]=e[5]*c,i[6]=e[6]*c,i[7]=e[7]*c,i[8]=e[8]*f,i[9]=e[9]*f,i[10]=e[10]*f,i[11]=e[11]*f,i[12]=e[12],i[13]=e[13],i[14]=e[14],i[15]=e[15],i}function qh(i,e,r){var s=Math.sin(r),c=Math.cos(r),f=e[4],_=e[5],x=e[6],E=e[7],A=e[8],C=e[9],L=e[10],B=e[11];return e!==i&&(i[0]=e[0],i[1]=e[1],i[2]=e[2],i[3]=e[3],i[12]=e[12],i[13]=e[13],i[14]=e[14],i[15]=e[15]),i[4]=f*c+A*s,i[5]=_*c+C*s,i[6]=x*c+L*s,i[7]=E*c+B*s,i[8]=A*c-f*s,i[9]=C*c-_*s,i[10]=L*c-x*s,i[11]=B*c-E*s,i}function Zh(i,e,r){var s=Math.sin(r),c=Math.cos(r),f=e[0],_=e[1],x=e[2],E=e[3],A=e[8],C=e[9],L=e[10],B=e[11];return e!==i&&(i[4]=e[4],i[5]=e[5],i[6]=e[6],i[7]=e[7],i[12]=e[12],i[13]=e[13],i[14]=e[14],i[15]=e[15]),i[0]=f*c-A*s,i[1]=_*c-C*s,i[2]=x*c-L*s,i[3]=E*c-B*s,i[8]=f*s+A*c,i[9]=_*s+C*c,i[10]=x*s+L*c,i[11]=E*s+B*c,i}function J1(i,e,r){var s,c,f,_=r[0],x=r[1],E=r[2],A=Math.hypot(_,x,E);return A<Gh?null:(_*=A=1/A,x*=A,E*=A,s=Math.sin(e),c=Math.cos(e),i[0]=_*_*(f=1-c)+c,i[1]=x*_*f+E*s,i[2]=E*_*f-x*s,i[3]=0,i[4]=_*x*f-E*s,i[5]=x*x*f+c,i[6]=E*x*f+_*s,i[7]=0,i[8]=_*E*f+x*s,i[9]=x*E*f-_*s,i[10]=E*E*f+c,i[11]=0,i[12]=0,i[13]=0,i[14]=0,i[15]=1,i)}Math.hypot||(Math.hypot=function(){for(var i=0,e=arguments.length;e--;)i+=arguments[e]*arguments[e];return Math.sqrt(i)});var v2=zs;function kf(){var i=new hn(3);return hn!=Float32Array&&(i[0]=0,i[1]=0,i[2]=0),i}function Q1(i){var e=new hn(3);return e[0]=i[0],e[1]=i[1],e[2]=i[2],e}function Jc(i){return Math.hypot(i[0],i[1],i[2])}function Gl(i,e,r){var s=new hn(3);return s[0]=i,s[1]=e,s[2]=r,s}function Ps(i,e,r){return i[0]=e[0]+r[0],i[1]=e[1]+r[1],i[2]=e[2]+r[2],i}function Cf(i,e,r){return i[0]=e[0]-r[0],i[1]=e[1]-r[1],i[2]=e[2]-r[2],i}function em(i,e,r){return i[0]=e[0]*r[0],i[1]=e[1]*r[1],i[2]=e[2]*r[2],i}function $h(i,e,r){return i[0]=Math.min(e[0],r[0]),i[1]=Math.min(e[1],r[1]),i[2]=Math.min(e[2],r[2]),i}function Wh(i,e,r){return i[0]=Math.max(e[0],r[0]),i[1]=Math.max(e[1],r[1]),i[2]=Math.max(e[2],r[2]),i}function wo(i,e,r){return i[0]=e[0]*r,i[1]=e[1]*r,i[2]=e[2]*r,i}function Xh(i,e,r,s){return i[0]=e[0]+r[0]*s,i[1]=e[1]+r[1]*s,i[2]=e[2]+r[2]*s,i}function qr(i,e){var r=e[0],s=e[1],c=e[2],f=r*r+s*s+c*c;return f>0&&(f=1/Math.sqrt(f)),i[0]=e[0]*f,i[1]=e[1]*f,i[2]=e[2]*f,i}function Un(i,e){return i[0]*e[0]+i[1]*e[1]+i[2]*e[2]}function zf(i,e,r){var s=e[0],c=e[1],f=e[2],_=r[0],x=r[1],E=r[2];return i[0]=c*E-f*x,i[1]=f*_-s*E,i[2]=s*x-c*_,i}function zr(i,e,r){var s=e[0],c=e[1],f=e[2],_=r[3]*s+r[7]*c+r[11]*f+r[15];return i[0]=(r[0]*s+r[4]*c+r[8]*f+r[12])/(_=_||1),i[1]=(r[1]*s+r[5]*c+r[9]*f+r[13])/_,i[2]=(r[2]*s+r[6]*c+r[10]*f+r[14])/_,i}function tm(i,e,r){var s=r[0],c=r[1],f=r[2],_=e[0],x=e[1],E=e[2],A=c*E-f*x,C=f*_-s*E,L=s*x-c*_,B=c*L-f*C,U=f*A-s*L,N=s*C-c*A,$=2*r[3];return C*=$,L*=$,U*=2,N*=2,i[0]=_+(A*=$)+(B*=2),i[1]=x+C+U,i[2]=E+L+N,i}var Qc,Vn=Cf,x2=em,b2=Jc;function im(i,e,r){return i[0]=e[0]*r,i[1]=e[1]*r,i[2]=e[2]*r,i[3]=e[3]*r,i}function Da(i,e,r){var s=e[0],c=e[1],f=e[2],_=e[3];return i[0]=r[0]*s+r[4]*c+r[8]*f+r[12]*_,i[1]=r[1]*s+r[5]*c+r[9]*f+r[13]*_,i[2]=r[2]*s+r[6]*c+r[10]*f+r[14]*_,i[3]=r[3]*s+r[7]*c+r[11]*f+r[15]*_,i}function rm(){var i=new hn(4);return hn!=Float32Array&&(i[0]=0,i[1]=0,i[2]=0),i[3]=1,i}function nm(i){return i[0]=0,i[1]=0,i[2]=0,i[3]=1,i}function om(i,e,r){r*=.5;var s=e[0],c=e[1],f=e[2],_=e[3],x=Math.sin(r),E=Math.cos(r);return i[0]=s*E+_*x,i[1]=c*E+f*x,i[2]=f*E-c*x,i[3]=_*E-s*x,i}function sm(i,e,r){r*=.5;var s=e[0],c=e[1],f=e[2],_=e[3],x=Math.sin(r),E=Math.cos(r);return i[0]=s*E-f*x,i[1]=c*E+_*x,i[2]=f*E+s*x,i[3]=_*E-c*x,i}kf(),Qc=new hn(4),hn!=Float32Array&&(Qc[0]=0,Qc[1]=0,Qc[2]=0,Qc[3]=0),kf(),Gl(1,0,0),Gl(0,1,0),rm(),rm(),K1();class Pf{constructor(e,r){this.pos=e,this.dir=r}intersectsPlane(e,r,s){const c=Un(r,this.dir);if(Math.abs(c)<1e-6)return!1;const f=((e[0]-this.pos[0])*r[0]+(e[1]-this.pos[1])*r[1]+(e[2]-this.pos[2])*r[2])/c;return s[0]=this.pos[0]+this.dir[0]*f,s[1]=this.pos[1]+this.dir[1]*f,s[2]=this.pos[2]+this.dir[2]*f,!0}closestPointOnSphere(e,r,s){if(function(U,N){var $=U[0],te=U[1],ue=U[2],ve=N[0],ye=N[1],xe=N[2];return Math.abs($-ve)<=Gh*Math.max(1,Math.abs($),Math.abs(ve))&&Math.abs(te-ye)<=Gh*Math.max(1,Math.abs(te),Math.abs(ye))&&Math.abs(ue-xe)<=Gh*Math.max(1,Math.abs(ue),Math.abs(xe))}(this.pos,e)||r===0)return s[0]=s[1]=s[2]=0,!1;const[c,f,_]=this.dir,x=this.pos[0]-e[0],E=this.pos[1]-e[1],A=this.pos[2]-e[2],C=c*c+f*f+_*_,L=2*(x*c+E*f+A*_),B=L*L-4*C*(x*x+E*E+A*A-r*r);if(B<0){const U=Math.max(-L/2,0),N=x+c*U,$=E+f*U,te=A+_*U,ue=Math.hypot(N,$,te);return s[0]=N*r/ue,s[1]=$*r/ue,s[2]=te*r/ue,!1}{const U=(-L-Math.sqrt(B))/(2*C);if(U<0){const N=Math.hypot(x,E,A);return s[0]=x*r/N,s[1]=E*r/N,s[2]=A*r/N,!1}return s[0]=x+c*U,s[1]=E+f*U,s[2]=A+_*U,!0}}}class Df{constructor(e,r,s,c,f){this.TL=e,this.TR=r,this.BR=s,this.BL=c,this.horizon=f}static fromInvProjectionMatrix(e,r,s){const c=[-1,1,1],f=[1,1,1],_=[1,-1,1],x=[-1,-1,1],E=zr(c,c,e),A=zr(f,f,e),C=zr(_,_,e),L=zr(x,x,e);return new Df(E,A,C,L,r/s)}}class Lf{constructor(e,r){this.points=e,this.planes=r}static fromInvProjectionMatrix(e,r,s,c){const f=Math.pow(2,s),_=[[-1,1,-1,1],[1,1,-1,1],[1,-1,-1,1],[-1,-1,-1,1],[-1,1,1,1],[1,1,1,1],[1,-1,1,1],[-1,-1,1,1]].map(E=>{const A=Da([],E,e),C=1/A[3]/r*f;return function(L,B,U){return L[0]=B[0]*U[0],L[1]=B[1]*U[1],L[2]=B[2]*U[2],L[3]=B[3]*U[3],L}(A,A,[C,C,c?1/A[3]:C,C])}),x=[[0,1,2],[6,5,4],[0,3,7],[2,1,5],[3,2,6],[0,4,5]].map(E=>{const A=qr([],zf([],Vn([],_[E[0]],_[E[1]]),Vn([],_[E[2]],_[E[1]]))),C=-Un(A,_[E[1]]);return A.concat(C)});return new Lf(_,x)}}class An{constructor(e,r){this.min=e,this.max=r,this.center=wo([],Ps([],this.min,this.max),.5)}quadrant(e){const r=[e%2==0,e<2],s=Q1(this.min),c=Q1(this.max);for(let f=0;f<r.length;f++)s[f]=r[f]?this.min[f]:this.center[f],c[f]=r[f]?this.center[f]:this.max[f];return c[2]=this.max[2],new An(s,c)}distanceX(e){return Math.max(Math.min(this.max[0],e[0]),this.min[0])-e[0]}distanceY(e){return Math.max(Math.min(this.max[1],e[1]),this.min[1])-e[1]}distanceZ(e){return Math.max(Math.min(this.max[2],e[2]),this.min[2])-e[2]}getCorners(){const e=this.min,r=this.max;return[[e[0],e[1],e[2]],[r[0],e[1],e[2]],[r[0],r[1],e[2]],[e[0],r[1],e[2]],[e[0],e[1],r[2]],[r[0],e[1],r[2]],[r[0],r[1],r[2]],[e[0],r[1],r[2]]]}intersects(e){const r=this.getCorners();let s=!0;for(let c=0;c<e.planes.length;c++){const f=e.planes[c];let _=0;for(let x=0;x<r.length;x++)_+=Un(f,r[x])+f[3]>=0;if(_===0)return 0;_!==r.length&&(s=!1)}if(s)return 2;for(let c=0;c<3;c++){let f=Number.MAX_VALUE,_=-Number.MAX_VALUE;for(let x=0;x<e.points.length;x++){const E=e.points[x][c]-this.min[c];f=Math.min(f,E),_=Math.max(_,E)}if(_<0||f>this.max[c]-this.min[c])return 0}return 1}}function am(i,e,r,s,c,f,_,x,E){if(f&&i.queryGeometry.isAboveHorizon)return!1;f&&(E*=i.pixelToTileUnitsFactor);const A=i.tileID.canonical,C=r.projection.upVectorScale(A,r.center.lat,r.worldSize).metersToTile;for(const L of e)for(const B of L){const U=B.add(x),N=c&&r.elevation?r.elevation.exaggeration()*c.getElevationAt(U.x,U.y,!0):0,$=r.projection.projectTilePoint(U.x,U.y,A);if(N>0){const ye=r.projection.upVector(A,U.x,U.y);$.x+=ye[0]*C*N,$.y+=ye[1]*C*N,$.z+=ye[2]*C*N}const te=f?U:w2($.x,$.y,$.z,s),ue=f?i.tilespaceRays.map(ye=>T2(ye,N)):i.queryGeometry.screenGeometry,ve=Da([],[$.x,$.y,$.z,1],s);if(!_&&f?E*=ve[3]/r.cameraToCenterDistance:_&&!f&&(E*=r.cameraToCenterDistance/ve[3]),f){const ye=gr((B.y/qt+A.y)/(1<<A.z));E/=r.projection.pixelsPerMeter(ye,1)/Fn(1,ye)}if(f2(ue,te,E))return!0}return!1}function w2(i,e,r,s){const c=Da([],[i,e,r,1],s);return new I(c[0]/c[3],c[1]/c[3])}const lm=Gl(0,0,0),E2=Gl(0,0,1);function T2(i,e){const r=kf();return lm[2]=e,i.intersectsPlane(lm,E2,r),new I(r[0],r[1])}class cm extends Sf{}function um(i,{width:e,height:r},s,c){if(c){if(c instanceof Uint8ClampedArray)c=new Uint8Array(c.buffer);else if(c.length!==e*r*s)throw new RangeError("mismatched image size")}else c=new Uint8Array(e*r*s);return i.width=e,i.height=r,i.data=c,i}function hm(i,e,r){const{width:s,height:c}=e;s===i.width&&c===i.height||(Rf(i,e,{x:0,y:0},{x:0,y:0},{width:Math.min(i.width,s),height:Math.min(i.height,c)},r),i.width=s,i.height=c,i.data=e.data)}function Rf(i,e,r,s,c,f){if(c.width===0||c.height===0)return e;if(c.width>i.width||c.height>i.height||r.x>i.width-c.width||r.y>i.height-c.height)throw new RangeError("out of range source coordinates for image copy");if(c.width>e.width||c.height>e.height||s.x>e.width-c.width||s.y>e.height-c.height)throw new RangeError("out of range destination coordinates for image copy");const _=i.data,x=e.data;for(let E=0;E<c.height;E++){const A=((r.y+E)*i.width+r.x)*f,C=((s.y+E)*e.width+s.x)*f;for(let L=0;L<c.width*f;L++)x[C+L]=_[A+L]}return e}Ct(cm,"HeatmapBucket",{omit:["layers"]});class Qo{constructor(e,r){um(this,e,1,r)}resize(e){hm(this,new Qo(e),1)}clone(){return new Qo({width:this.width,height:this.height},new Uint8Array(this.data))}static copy(e,r,s,c,f){Rf(e,r,s,c,f,1)}}class fn{constructor(e,r){um(this,e,4,r)}resize(e){hm(this,new fn(e),4)}replace(e,r){r?this.data.set(e):this.data=e instanceof Uint8ClampedArray?new Uint8Array(e.buffer):e}clone(){return new fn({width:this.width,height:this.height},new Uint8Array(this.data))}static copy(e,r,s,c,f){Rf(e,r,s,c,f,4)}}Ct(Qo,"AlphaImage"),Ct(fn,"RGBAImage");var A2={paint:new Ke({"heatmap-radius":new _e(ke.paint_heatmap["heatmap-radius"]),"heatmap-weight":new _e(ke.paint_heatmap["heatmap-weight"]),"heatmap-intensity":new Ue(ke.paint_heatmap["heatmap-intensity"]),"heatmap-color":new Et(ke.paint_heatmap["heatmap-color"]),"heatmap-opacity":new Ue(ke.paint_heatmap["heatmap-opacity"])})};function Bf(i){const e={},r=i.resolution||256,s=i.clips?i.clips.length:1,c=i.image||new fn({width:r,height:s}),f=(_,x,E)=>{e[i.evaluationKey]=E;const A=i.expression.evaluate(e);c.data[_+x+0]=Math.floor(255*A.r/A.a),c.data[_+x+1]=Math.floor(255*A.g/A.a),c.data[_+x+2]=Math.floor(255*A.b/A.a),c.data[_+x+3]=Math.floor(255*A.a)};if(i.clips)for(let _=0,x=0;_<s;++_,x+=4*r)for(let E=0,A=0;E<r;E++,A+=4){const C=E/(r-1),{start:L,end:B}=i.clips[_];f(x,A,L*(1-C)+B*C)}else for(let _=0,x=0;_<r;_++,x+=4)f(0,x,_/(r-1));return c}var S2={paint:new Ke({"hillshade-illumination-direction":new Ue(ke.paint_hillshade["hillshade-illumination-direction"]),"hillshade-illumination-anchor":new Ue(ke.paint_hillshade["hillshade-illumination-anchor"]),"hillshade-exaggeration":new Ue(ke.paint_hillshade["hillshade-exaggeration"]),"hillshade-shadow-color":new Ue(ke.paint_hillshade["hillshade-shadow-color"]),"hillshade-highlight-color":new Ue(ke.paint_hillshade["hillshade-highlight-color"]),"hillshade-accent-color":new Ue(ke.paint_hillshade["hillshade-accent-color"])})};const M2=gt([{name:"a_pos",components:2,type:"Int16"}],4),{members:I2}=M2;var Hh=Yh,k2=Yh;function Yh(i,e,r){r=r||2;var s,c,f,_,x,E,A,C=e&&e.length,L=C?e[0]*r:i.length,B=pm(i,0,L,r,!0),U=[];if(!B||B.next===B.prev)return U;if(C&&(B=function($,te,ue,ve){var ye,xe,Ee,Se=[];for(ye=0,xe=te.length;ye<xe;ye++)(Ee=pm($,te[ye]*ve,ye<xe-1?te[ye+1]*ve:$.length,ve,!1))===Ee.next&&(Ee.steiner=!0),Se.push(O2(Ee));for(Se.sort(L2),ye=0;ye<Se.length;ye++)ue=Ds(ue=R2(Se[ye],ue),ue.next);return ue}(i,e,B,r)),i.length>80*r){s=f=i[0],c=_=i[1];for(var N=r;N<L;N+=r)(x=i[N])<s&&(s=x),(E=i[N+1])<c&&(c=E),x>f&&(f=x),E>_&&(_=E);A=(A=Math.max(f-s,_-c))!==0?1/A:0}return eu(B,U,r,s,c,A),U}function pm(i,e,r,s,c){var f,_;if(c===Uf(i,e,r,s)>0)for(f=e;f<r;f+=s)_=mm(f,i[f],i[f+1],_);else for(f=r-s;f>=e;f-=s)_=mm(f,i[f],i[f+1],_);return _&&Kh(_,_.next)&&(iu(_),_=_.next),_}function Ds(i,e){if(!i)return i;e||(e=i);var r,s=i;do if(r=!1,s.steiner||!Kh(s,s.next)&&pr(s.prev,s,s.next)!==0)s=s.next;else{if(iu(s),(s=e=s.prev)===s.next)break;r=!0}while(r||s!==e);return e}function eu(i,e,r,s,c,f,_){if(i){!_&&f&&function(C,L,B,U){var N=C;do N.z===null&&(N.z=Of(N.x,N.y,L,B,U)),N.prevZ=N.prev,N.nextZ=N.next,N=N.next;while(N!==C);N.prevZ.nextZ=null,N.prevZ=null,function($){var te,ue,ve,ye,xe,Ee,Se,qe,We=1;do{for(ue=$,$=null,xe=null,Ee=0;ue;){for(Ee++,ve=ue,Se=0,te=0;te<We&&(Se++,ve=ve.nextZ);te++);for(qe=We;Se>0||qe>0&&ve;)Se!==0&&(qe===0||!ve||ue.z<=ve.z)?(ye=ue,ue=ue.nextZ,Se--):(ye=ve,ve=ve.nextZ,qe--),xe?xe.nextZ=ye:$=ye,ye.prevZ=xe,xe=ye;ue=ve}xe.nextZ=null,We*=2}while(Ee>1)}(N)}(i,s,c,f);for(var x,E,A=i;i.prev!==i.next;)if(x=i.prev,E=i.next,f?z2(i,s,c,f):C2(i))e.push(x.i/r),e.push(i.i/r),e.push(E.i/r),iu(i),i=E.next,A=E.next;else if((i=E)===A){_?_===1?eu(i=P2(Ds(i),e,r),e,r,s,c,f,2):_===2&&D2(i,e,r,s,c,f):eu(Ds(i),e,r,s,c,f,1);break}}}function C2(i){var e=i.prev,r=i,s=i.next;if(pr(e,r,s)>=0)return!1;for(var c=i.next.next;c!==i.prev;){if(ql(e.x,e.y,r.x,r.y,s.x,s.y,c.x,c.y)&&pr(c.prev,c,c.next)>=0)return!1;c=c.next}return!0}function z2(i,e,r,s){var c=i.prev,f=i,_=i.next;if(pr(c,f,_)>=0)return!1;for(var x=c.x>f.x?c.x>_.x?c.x:_.x:f.x>_.x?f.x:_.x,E=c.y>f.y?c.y>_.y?c.y:_.y:f.y>_.y?f.y:_.y,A=Of(c.x<f.x?c.x<_.x?c.x:_.x:f.x<_.x?f.x:_.x,c.y<f.y?c.y<_.y?c.y:_.y:f.y<_.y?f.y:_.y,e,r,s),C=Of(x,E,e,r,s),L=i.prevZ,B=i.nextZ;L&&L.z>=A&&B&&B.z<=C;){if(L!==i.prev&&L!==i.next&&ql(c.x,c.y,f.x,f.y,_.x,_.y,L.x,L.y)&&pr(L.prev,L,L.next)>=0||(L=L.prevZ,B!==i.prev&&B!==i.next&&ql(c.x,c.y,f.x,f.y,_.x,_.y,B.x,B.y)&&pr(B.prev,B,B.next)>=0))return!1;B=B.nextZ}for(;L&&L.z>=A;){if(L!==i.prev&&L!==i.next&&ql(c.x,c.y,f.x,f.y,_.x,_.y,L.x,L.y)&&pr(L.prev,L,L.next)>=0)return!1;L=L.prevZ}for(;B&&B.z<=C;){if(B!==i.prev&&B!==i.next&&ql(c.x,c.y,f.x,f.y,_.x,_.y,B.x,B.y)&&pr(B.prev,B,B.next)>=0)return!1;B=B.nextZ}return!0}function P2(i,e,r){var s=i;do{var c=s.prev,f=s.next.next;!Kh(c,f)&&fm(c,s,s.next,f)&&tu(c,f)&&tu(f,c)&&(e.push(c.i/r),e.push(s.i/r),e.push(f.i/r),iu(s),iu(s.next),s=i=f),s=s.next}while(s!==i);return Ds(s)}function D2(i,e,r,s,c,f){var _=i;do{for(var x=_.next.next;x!==_.prev;){if(_.i!==x.i&&F2(_,x)){var E=dm(_,x);return _=Ds(_,_.next),E=Ds(E,E.next),eu(_,e,r,s,c,f),void eu(E,e,r,s,c,f)}x=x.next}_=_.next}while(_!==i)}function L2(i,e){return i.x-e.x}function R2(i,e){var r=function(f,_){var x,E=_,A=f.x,C=f.y,L=-1/0;do{if(C<=E.y&&C>=E.next.y&&E.next.y!==E.y){var B=E.x+(C-E.y)*(E.next.x-E.x)/(E.next.y-E.y);if(B<=A&&B>L){if(L=B,B===A){if(C===E.y)return E;if(C===E.next.y)return E.next}x=E.x<E.next.x?E:E.next}}E=E.next}while(E!==_);if(!x)return null;if(A===L)return x;var U,N=x,$=x.x,te=x.y,ue=1/0;E=x;do A>=E.x&&E.x>=$&&A!==E.x&&ql(C<te?A:L,C,$,te,C<te?L:A,C,E.x,E.y)&&(U=Math.abs(C-E.y)/(A-E.x),tu(E,f)&&(U<ue||U===ue&&(E.x>x.x||E.x===x.x&&B2(x,E)))&&(x=E,ue=U)),E=E.next;while(E!==N);return x}(i,e);if(!r)return e;var s=dm(r,i),c=Ds(r,r.next);return Ds(s,s.next),e===r?c:e}function B2(i,e){return pr(i.prev,i,e.prev)<0&&pr(e.next,i,i.next)<0}function Of(i,e,r,s,c){return(i=1431655765&((i=858993459&((i=252645135&((i=16711935&((i=32767*(i-r)*c)|i<<8))|i<<4))|i<<2))|i<<1))|(e=1431655765&((e=858993459&((e=252645135&((e=16711935&((e=32767*(e-s)*c)|e<<8))|e<<4))|e<<2))|e<<1))<<1}function O2(i){var e=i,r=i;do(e.x<r.x||e.x===r.x&&e.y<r.y)&&(r=e),e=e.next;while(e!==i);return r}function ql(i,e,r,s,c,f,_,x){return(c-_)*(e-x)-(i-_)*(f-x)>=0&&(i-_)*(s-x)-(r-_)*(e-x)>=0&&(r-_)*(f-x)-(c-_)*(s-x)>=0}function F2(i,e){return i.next.i!==e.i&&i.prev.i!==e.i&&!function(r,s){var c=r;do{if(c.i!==r.i&&c.next.i!==r.i&&c.i!==s.i&&c.next.i!==s.i&&fm(c,c.next,r,s))return!0;c=c.next}while(c!==r);return!1}(i,e)&&(tu(i,e)&&tu(e,i)&&function(r,s){var c=r,f=!1,_=(r.x+s.x)/2,x=(r.y+s.y)/2;do c.y>x!=c.next.y>x&&c.next.y!==c.y&&_<(c.next.x-c.x)*(x-c.y)/(c.next.y-c.y)+c.x&&(f=!f),c=c.next;while(c!==r);return f}(i,e)&&(pr(i.prev,i,e.prev)||pr(i,e.prev,e))||Kh(i,e)&&pr(i.prev,i,i.next)>0&&pr(e.prev,e,e.next)>0)}function pr(i,e,r){return(e.y-i.y)*(r.x-e.x)-(e.x-i.x)*(r.y-e.y)}function Kh(i,e){return i.x===e.x&&i.y===e.y}function fm(i,e,r,s){var c=Qh(pr(i,e,r)),f=Qh(pr(i,e,s)),_=Qh(pr(r,s,i)),x=Qh(pr(r,s,e));return c!==f&&_!==x||!(c!==0||!Jh(i,r,e))||!(f!==0||!Jh(i,s,e))||!(_!==0||!Jh(r,i,s))||!(x!==0||!Jh(r,e,s))}function Jh(i,e,r){return e.x<=Math.max(i.x,r.x)&&e.x>=Math.min(i.x,r.x)&&e.y<=Math.max(i.y,r.y)&&e.y>=Math.min(i.y,r.y)}function Qh(i){return i>0?1:i<0?-1:0}function tu(i,e){return pr(i.prev,i,i.next)<0?pr(i,e,i.next)>=0&&pr(i,i.prev,e)>=0:pr(i,e,i.prev)<0||pr(i,i.next,e)<0}function dm(i,e){var r=new Ff(i.i,i.x,i.y),s=new Ff(e.i,e.x,e.y),c=i.next,f=e.prev;return i.next=e,e.prev=i,r.next=c,c.prev=r,s.next=r,r.prev=s,f.next=s,s.prev=f,s}function mm(i,e,r,s){var c=new Ff(i,e,r);return s?(c.next=s.next,c.prev=s,s.next.prev=c,s.next=c):(c.prev=c,c.next=c),c}function iu(i){i.next.prev=i.prev,i.prev.next=i.next,i.prevZ&&(i.prevZ.nextZ=i.nextZ),i.nextZ&&(i.nextZ.prevZ=i.prevZ)}function Ff(i,e,r){this.i=i,this.x=e,this.y=r,this.prev=null,this.next=null,this.z=null,this.prevZ=null,this.nextZ=null,this.steiner=!1}function Uf(i,e,r,s){for(var c=0,f=e,_=r-s;f<r;f+=s)c+=(i[_]-i[f])*(i[f+1]+i[_+1]),_=f;return c}function U2(i,e,r,s,c){_m(i,e,r||0,s||i.length-1,c||V2)}function _m(i,e,r,s,c){for(;s>r;){if(s-r>600){var f=s-r+1,_=e-r+1,x=Math.log(f),E=.5*Math.exp(2*x/3),A=.5*Math.sqrt(x*E*(f-E)/f)*(_-f/2<0?-1:1);_m(i,e,Math.max(r,Math.floor(e-_*E/f+A)),Math.min(s,Math.floor(e+(f-_)*E/f+A)),c)}var C=i[e],L=r,B=s;for(ru(i,r,e),c(i[s],C)>0&&ru(i,r,s);L<B;){for(ru(i,L,B),L++,B--;c(i[L],C)<0;)L++;for(;c(i[B],C)>0;)B--}c(i[r],C)===0?ru(i,r,B):ru(i,++B,s),B<=e&&(r=B+1),e<=B&&(s=B-1)}}function ru(i,e,r){var s=i[e];i[e]=i[r],i[r]=s}function V2(i,e){return i<e?-1:i>e?1:0}function Vf(i,e){const r=i.length;if(r<=1)return[i];const s=[];let c,f;for(let _=0;_<r;_++){const x=Lt(i[_]);x!==0&&(i[_].area=Math.abs(x),f===void 0&&(f=x<0),f===x<0?(c&&s.push(c),c=[i[_]]):c.push(i[_]))}if(c&&s.push(c),e>1)for(let _=0;_<s.length;_++)s[_].length<=e||(U2(s[_],e,1,s[_].length-1,N2),s[_]=s[_].slice(0,e));return s}function N2(i,e){return e.area-i.area}function Nf(i,e,r){const s=r.patternDependencies;let c=!1;for(const f of e){const _=f.paint.get(`${i}-pattern`);_.isConstant()||(c=!0);const x=_.constantOr(null);x&&(c=!0,s[x.to]=!0,s[x.from]=!0)}return c}function jf(i,e,r,s,c){const f=c.patternDependencies;for(const _ of e){const x=_.paint.get(`${i}-pattern`).value;if(x.kind!=="constant"){let E=x.evaluate({zoom:s-1},r,{},c.availableImages),A=x.evaluate({zoom:s},r,{},c.availableImages),C=x.evaluate({zoom:s+1},r,{},c.availableImages);E=E&&E.name?E.name:E,A=A&&A.name?A.name:A,C=C&&C.name?C.name:C,f[E]=!0,f[A]=!0,f[C]=!0,r.patterns[_.id]={min:E,mid:A,max:C}}}return r}Yh.deviation=function(i,e,r,s){var c=e&&e.length,f=Math.abs(Uf(i,0,c?e[0]*r:i.length,r));if(c)for(var _=0,x=e.length;_<x;_++)f-=Math.abs(Uf(i,e[_]*r,_<x-1?e[_+1]*r:i.length,r));var E=0;for(_=0;_<s.length;_+=3){var A=s[_]*r,C=s[_+1]*r,L=s[_+2]*r;E+=Math.abs((i[A]-i[L])*(i[C+1]-i[A+1])-(i[A]-i[C])*(i[L+1]-i[A+1]))}return f===0&&E===0?0:Math.abs((E-f)/f)},Yh.flatten=function(i){for(var e=i[0][0].length,r={vertices:[],holes:[],dimensions:e},s=0,c=0;c<i.length;c++){for(var f=0;f<i[c].length;f++)for(var _=0;_<e;_++)r.vertices.push(i[c][f][_]);c>0&&r.holes.push(s+=i[c-1].length)}return r},Hh.default=k2;class ep{constructor(e){this.zoom=e.zoom,this.overscaling=e.overscaling,this.layers=e.layers,this.layerIds=this.layers.map(r=>r.id),this.index=e.index,this.hasPattern=!1,this.patternFeatures=[],this.layoutVertexArray=new Vt,this.indexArray=new yi,this.indexArray2=new hr,this.programConfigurations=new Ma(e.layers,e.zoom),this.segments=new or,this.segments2=new or,this.stateDependentLayerIds=this.layers.filter(r=>r.isStateDependent()).map(r=>r.id),this.projection=e.projection}populate(e,r,s,c){this.hasPattern=Nf("fill",this.layers,r);const f=this.layers[0].layout.get("fill-sort-key"),_=[];for(const{feature:x,id:E,index:A,sourceLayerIndex:C}of e){const L=this.layers[0]._featureFilter.needGeometry,B=Ca(x,L);if(!this.layers[0]._featureFilter.filter(new ne(this.zoom),B,s))continue;const U=f?f.evaluate(B,{},s,r.availableImages):void 0,N={id:E,properties:x.properties,type:x.type,sourceLayerIndex:C,index:A,geometry:L?B.geometry:Jo(x,s,c),patterns:{},sortKey:U};_.push(N)}f&&_.sort((x,E)=>x.sortKey-E.sortKey);for(const x of _){const{geometry:E,index:A,sourceLayerIndex:C}=x;if(this.hasPattern){const L=jf("fill",this.layers,x,this.zoom,r);this.patternFeatures.push(L)}else this.addFeature(x,E,A,s,{},r.availableImages);r.featureIndex.insert(e[A].feature,E,A,C,this.index)}}update(e,r,s,c){this.stateDependentLayers.length&&this.programConfigurations.updatePaintArrays(e,r,this.stateDependentLayers,s,c)}addFeatures(e,r,s,c,f){for(const _ of this.patternFeatures)this.addFeature(_,_.geometry,_.index,r,s,c)}isEmpty(){return this.layoutVertexArray.length===0}uploadPending(){return!this.uploaded||this.programConfigurations.needsUpload}upload(e){this.uploaded||(this.layoutVertexBuffer=e.createVertexBuffer(this.layoutVertexArray,I2),this.indexBuffer=e.createIndexBuffer(this.indexArray),this.indexBuffer2=e.createIndexBuffer(this.indexArray2)),this.programConfigurations.upload(e),this.uploaded=!0}destroy(){this.layoutVertexBuffer&&(this.layoutVertexBuffer.destroy(),this.indexBuffer.destroy(),this.indexBuffer2.destroy(),this.programConfigurations.destroy(),this.segments.destroy(),this.segments2.destroy())}addFeature(e,r,s,c,f,_=[]){for(const x of Vf(r,500)){let E=0;for(const N of x)E+=N.length;const A=this.segments.prepareSegment(E,this.layoutVertexArray,this.indexArray),C=A.vertexLength,L=[],B=[];for(const N of x){if(N.length===0)continue;N!==x[0]&&B.push(L.length/2);const $=this.segments2.prepareSegment(N.length,this.layoutVertexArray,this.indexArray2),te=$.vertexLength;this.layoutVertexArray.emplaceBack(N[0].x,N[0].y),this.indexArray2.emplaceBack(te+N.length-1,te),L.push(N[0].x),L.push(N[0].y);for(let ue=1;ue<N.length;ue++)this.layoutVertexArray.emplaceBack(N[ue].x,N[ue].y),this.indexArray2.emplaceBack(te+ue-1,te+ue),L.push(N[ue].x),L.push(N[ue].y);$.vertexLength+=N.length,$.primitiveLength+=N.length}const U=Hh(L,B);for(let N=0;N<U.length;N+=3)this.indexArray.emplaceBack(C+U[N],C+U[N+1],C+U[N+2]);A.vertexLength+=E,A.primitiveLength+=U.length/3}this.programConfigurations.populatePaintArrays(this.layoutVertexArray.length,e,s,f,_,c)}}Ct(ep,"FillBucket",{omit:["layers","patternFeatures"]});const j2=new Ke({"fill-sort-key":new _e(ke.layout_fill["fill-sort-key"])});var G2={paint:new Ke({"fill-antialias":new Ue(ke.paint_fill["fill-antialias"]),"fill-opacity":new _e(ke.paint_fill["fill-opacity"]),"fill-color":new _e(ke.paint_fill["fill-color"]),"fill-outline-color":new _e(ke.paint_fill["fill-outline-color"]),"fill-translate":new Ue(ke.paint_fill["fill-translate"]),"fill-translate-anchor":new Ue(ke.paint_fill["fill-translate-anchor"]),"fill-pattern":new rt(ke.paint_fill["fill-pattern"])}),layout:j2};const q2=gt([{name:"a_pos_normal_ed",components:4,type:"Int16"}]),Z2=gt([{name:"a_centroid_pos",components:2,type:"Uint16"}]),$2=gt([{name:"a_pos_3",components:3,type:"Int16"},{name:"a_pos_normal_3",components:3,type:"Int16"}]),{members:W2}=q2;var gm=Zl;function Zl(i,e,r,s,c){this.properties={},this.extent=r,this.type=0,this._pbf=i,this._geometry=-1,this._keys=s,this._values=c,i.readFields(X2,this,e)}function X2(i,e,r){i==1?e.id=r.readVarint():i==2?function(s,c){for(var f=s.readVarint()+s.pos;s.pos<f;){var _=c._keys[s.readVarint()],x=c._values[s.readVarint()];c.properties[_]=x}}(r,e):i==3?e.type=r.readVarint():i==4&&(e._geometry=r.pos)}function H2(i){for(var e,r,s=0,c=0,f=i.length,_=f-1;c<f;_=c++)s+=((r=i[_]).x-(e=i[c]).x)*(e.y+r.y);return s}Zl.types=["Unknown","Point","LineString","Polygon"],Zl.prototype.loadGeometry=function(){var i=this._pbf;i.pos=this._geometry;for(var e,r=i.readVarint()+i.pos,s=1,c=0,f=0,_=0,x=[];i.pos<r;){if(c<=0){var E=i.readVarint();s=7&E,c=E>>3}if(c--,s===1||s===2)f+=i.readSVarint(),_+=i.readSVarint(),s===1&&(e&&x.push(e),e=[]),e.push(new I(f,_));else{if(s!==7)throw new Error("unknown command "+s);e&&e.push(e[0].clone())}}return e&&x.push(e),x},Zl.prototype.bbox=function(){var i=this._pbf;i.pos=this._geometry;for(var e=i.readVarint()+i.pos,r=1,s=0,c=0,f=0,_=1/0,x=-1/0,E=1/0,A=-1/0;i.pos<e;){if(s<=0){var C=i.readVarint();r=7&C,s=C>>3}if(s--,r===1||r===2)(c+=i.readSVarint())<_&&(_=c),c>x&&(x=c),(f+=i.readSVarint())<E&&(E=f),f>A&&(A=f);else if(r!==7)throw new Error("unknown command "+r)}return[_,E,x,A]},Zl.prototype.toGeoJSON=function(i,e,r){var s,c,f=this.extent*Math.pow(2,r),_=this.extent*i,x=this.extent*e,E=this.loadGeometry(),A=Zl.types[this.type];function C(U){for(var N=0;N<U.length;N++){var $=U[N];U[N]=[360*($.x+_)/f-180,360/Math.PI*Math.atan(Math.exp((180-360*($.y+x)/f)*Math.PI/180))-90]}}switch(this.type){case 1:var L=[];for(s=0;s<E.length;s++)L[s]=E[s][0];C(E=L);break;case 2:for(s=0;s<E.length;s++)C(E[s]);break;case 3:for(E=function(U){var N=U.length;if(N<=1)return[U];for(var $,te,ue=[],ve=0;ve<N;ve++){var ye=H2(U[ve]);ye!==0&&(te===void 0&&(te=ye<0),te===ye<0?($&&ue.push($),$=[U[ve]]):$.push(U[ve]))}return $&&ue.push($),ue}(E),s=0;s<E.length;s++)for(c=0;c<E[s].length;c++)C(E[s][c])}E.length===1?E=E[0]:A="Multi"+A;var B={type:"Feature",geometry:{type:A,coordinates:E},properties:this.properties};return"id"in this&&(B.id=this.id),B};var ym=vm;function vm(i,e){this.version=1,this.name=null,this.extent=4096,this.length=0,this._pbf=i,this._keys=[],this._values=[],this._features=[],i.readFields(Y2,this,e),this.length=this._features.length}function Y2(i,e,r){i===15?e.version=r.readVarint():i===1?e.name=r.readString():i===5?e.extent=r.readVarint():i===2?e._features.push(r.pos):i===3?e._keys.push(r.readString()):i===4&&e._values.push(function(s){for(var c=null,f=s.readVarint()+s.pos;s.pos<f;){var _=s.readVarint()>>3;c=_===1?s.readString():_===2?s.readFloat():_===3?s.readDouble():_===4?s.readVarint64():_===5?s.readVarint():_===6?s.readSVarint():_===7?s.readBoolean():null}return c}(r))}function K2(i,e,r){if(i===3){var s=new ym(r,r.readVarint()+r.pos);s.length&&(e[s.name]=s)}}vm.prototype.feature=function(i){if(i<0||i>=this._features.length)throw new Error("feature index out of bounds");this._pbf.pos=this._features[i];var e=this._pbf.readVarint()+this._pbf.pos;return new gm(this._pbf,e,this.extent,this._keys,this._values)};var La={VectorTile:function(i,e){this.layers=i.readFields(K2,{},e)},VectorTileFeature:gm,VectorTileLayer:ym};function tp(i,e,r,s){const c=[],f=s===0?(_,x,E,A,C,L)=>{_.push(new I(L,E+(L-x)/(A-x)*(C-E)))}:(_,x,E,A,C,L)=>{_.push(new I(x+(L-E)/(C-E)*(A-x),L))};for(const _ of i){const x=[];for(const E of _){if(E.length<=2)continue;const A=[];for(let B=0;B<E.length-1;B++){const U=E[B].x,N=E[B].y,$=E[B+1].x,te=E[B+1].y,ue=s===0?U:N,ve=s===0?$:te;ue<e?ve>e&&f(A,U,N,$,te,e):ue>r?ve<r&&f(A,U,N,$,te,r):A.push(E[B]),ve<e&&ue>=e&&f(A,U,N,$,te,e),ve>r&&ue<=r&&f(A,U,N,$,te,r)}let C=E[E.length-1];const L=s===0?C.x:C.y;L>=e&&L<=r&&A.push(C),A.length&&(C=A[A.length-1],A[0].x===C.x&&A[0].y===C.y||A.push(A[0]),x.push(A))}x.length&&c.push(x)}return c}const J2=La.VectorTileFeature.types,Q2=Math.pow(2,13);function nu(i,e,r,s,c,f,_,x){i.emplaceBack((e<<1)+_,(r<<1)+f,(Math.floor(s*Q2)<<1)+c,Math.round(x))}function ou(i,e,r){i.emplaceBack(e.x,e.y,e.z,r[0]*16384,r[1]*16384,r[2]*16384)}class xm{constructor(){this.acc=new I(0,0),this.polyCount=[]}startRing(e){this.currentPolyCount={edges:0,top:0},this.polyCount.push(this.currentPolyCount),this.min||(this.min=new I(e.x,e.y),this.max=new I(e.x,e.y))}append(e,r){this.currentPolyCount.edges++,this.acc._add(e);const s=this.min,c=this.max;e.x<s.x?s.x=e.x:e.x>c.x&&(c.x=e.x),e.y<s.y?s.y=e.y:e.y>c.y&&(c.y=e.y),((e.x===0||e.x===qt)&&e.x===r.x)!=((e.y===0||e.y===qt)&&e.y===r.y)&&this.processBorderOverlap(e,r),r.x<0!=e.x<0&&this.addBorderIntersection(0,bi(r.y,e.y,(0-r.x)/(e.x-r.x))),r.x>qt!=e.x>qt&&this.addBorderIntersection(1,bi(r.y,e.y,(qt-r.x)/(e.x-r.x))),r.y<0!=e.y<0&&this.addBorderIntersection(2,bi(r.x,e.x,(0-r.y)/(e.y-r.y))),r.y>qt!=e.y>qt&&this.addBorderIntersection(3,bi(r.x,e.x,(qt-r.y)/(e.y-r.y)))}addBorderIntersection(e,r){this.borders||(this.borders=[[Number.MAX_VALUE,-Number.MAX_VALUE],[Number.MAX_VALUE,-Number.MAX_VALUE],[Number.MAX_VALUE,-Number.MAX_VALUE],[Number.MAX_VALUE,-Number.MAX_VALUE]]);const s=this.borders[e];r<s[0]&&(s[0]=r),r>s[1]&&(s[1]=r)}processBorderOverlap(e,r){if(e.x===r.x){if(e.y===r.y)return;const s=e.x===0?0:1;this.addBorderIntersection(s,r.y),this.addBorderIntersection(s,e.y)}else{const s=e.y===0?2:3;this.addBorderIntersection(s,r.x),this.addBorderIntersection(s,e.x)}}centroid(){const e=this.polyCount.reduce((r,s)=>r+s.edges,0);return e!==0?this.acc.div(e)._round():new I(0,0)}span(){return new I(this.max.x-this.min.x,this.max.y-this.min.y)}intersectsCount(){return this.borders.reduce((e,r)=>e+ +(r[0]!==Number.MAX_VALUE),0)}}class su{constructor(e){this.zoom=e.zoom,this.canonical=e.canonical,this.overscaling=e.overscaling,this.layers=e.layers,this.layerIds=this.layers.map(r=>r.id),this.index=e.index,this.hasPattern=!1,this.projection=e.projection,this.layoutVertexArray=new Ot,this.centroidVertexArray=new P1,this.indexArray=new yi,this.programConfigurations=new Ma(e.layers,e.zoom),this.segments=new or,this.stateDependentLayerIds=this.layers.filter(r=>r.isStateDependent()).map(r=>r.id),this.enableTerrain=e.enableTerrain}populate(e,r,s,c){this.features=[],this.hasPattern=Nf("fill-extrusion",this.layers,r),this.featuresOnBorder=[],this.borders=[[],[],[],[]],this.borderDoneWithNeighborZ=[-1,-1,-1,-1],this.tileToMeter=function(f){const _=Math.exp(Math.PI*(1-f.y/(1<<f.z)*2));return 80150034*_/(_*_+1)/qt/(1<<f.z)}(s);for(const{feature:f,id:_,index:x,sourceLayerIndex:E}of e){const A=this.layers[0]._featureFilter.needGeometry,C=Ca(f,A);if(!this.layers[0]._featureFilter.filter(new ne(this.zoom),C,s))continue;const L={id:_,sourceLayerIndex:E,index:x,geometry:A?C.geometry:Jo(f,s,c),properties:f.properties,type:f.type,patterns:{}},B=this.layoutVertexArray.length;this.hasPattern?this.features.push(jf("fill-extrusion",this.layers,L,this.zoom,r)):this.addFeature(L,L.geometry,x,s,{},r.availableImages,c),r.featureIndex.insert(f,L.geometry,x,E,this.index,B)}this.sortBorders()}addFeatures(e,r,s,c,f){for(const _ of this.features){const{geometry:x}=_;this.addFeature(_,x,_.index,r,s,c,f)}this.sortBorders()}update(e,r,s,c){this.stateDependentLayers.length&&this.programConfigurations.updatePaintArrays(e,r,this.stateDependentLayers,s,c)}isEmpty(){return this.layoutVertexArray.length===0}uploadPending(){return!this.uploaded||this.programConfigurations.needsUpload}upload(e){this.uploaded||(this.layoutVertexBuffer=e.createVertexBuffer(this.layoutVertexArray,W2),this.indexBuffer=e.createIndexBuffer(this.indexArray),this.layoutVertexExtArray&&(this.layoutVertexExtBuffer=e.createVertexBuffer(this.layoutVertexExtArray,$2.members,!0))),this.programConfigurations.upload(e),this.uploaded=!0}uploadCentroid(e){this.centroidVertexArray.length!==0&&(this.centroidVertexBuffer?this.needsCentroidUpdate&&this.centroidVertexBuffer.updateData(this.centroidVertexArray):this.centroidVertexBuffer=e.createVertexBuffer(this.centroidVertexArray,Z2.members,!0),this.needsCentroidUpdate=!1)}destroy(){this.layoutVertexBuffer&&(this.layoutVertexBuffer.destroy(),this.centroidVertexBuffer&&this.centroidVertexBuffer.destroy(),this.layoutVertexExtBuffer&&this.layoutVertexExtBuffer.destroy(),this.indexBuffer.destroy(),this.programConfigurations.destroy(),this.segments.destroy())}addFeature(e,r,s,c,f,_,x){const E=[new I(0,0),new I(qt,qt)],A=x.projection,C=A.name==="globe",L=this.enableTerrain&&!C?new xm:null;C&&!this.layoutVertexExtArray&&(this.layoutVertexExtArray=new b1);const B=Vf(r,500);for(let $=B.length-1;$>=0;$--){const te=B[$];(te.length===0||(U=te[0]).every(ue=>ue.x<=0)||U.every(ue=>ue.x>=qt)||U.every(ue=>ue.y<=0)||U.every(ue=>ue.y>=qt))&&B.splice($,1)}var U;let N;if(C)N=wm(B,E,c);else{N=[];for(const $ of B)N.push({polygon:$,bounds:E})}for(const $ of N){const te=$.polygon;let ue=0,ve=this.segments.prepareSegment(4,this.layoutVertexArray,this.indexArray);for(let qe=0;qe<te.length;qe++){const We=te[qe];if(We.length===0)continue;ue+=We.length;let tt=0;L&&L.startRing(We[0]);for(let at=0;at<We.length;at++){const Be=We[at];if(at>=1){const et=We[at-1];if(!ev(Be,et,$.bounds)){L&&L.append(Be,et),ve.vertexLength+4>or.MAX_VERTEX_ARRAY_LENGTH&&(ve=this.segments.prepareSegment(4,this.layoutVertexArray,this.indexArray));const lt=Be.sub(et)._perp(),ct=lt.x/(Math.abs(lt.x)+Math.abs(lt.y)),Mt=lt.y>0?1:0,ot=et.dist(Be);tt+ot>32768&&(tt=0),nu(this.layoutVertexArray,Be.x,Be.y,ct,Mt,0,0,tt),nu(this.layoutVertexArray,Be.x,Be.y,ct,Mt,0,1,tt),tt+=ot,nu(this.layoutVertexArray,et.x,et.y,ct,Mt,0,0,tt),nu(this.layoutVertexArray,et.x,et.y,ct,Mt,0,1,tt);const Tt=ve.vertexLength;if(this.indexArray.emplaceBack(Tt,Tt+2,Tt+1),this.indexArray.emplaceBack(Tt+1,Tt+2,Tt+3),ve.vertexLength+=4,ve.primitiveLength+=2,C){const ri=this.layoutVertexExtArray,ci=A.projectTilePoint(Be.x,Be.y,c),Ut=A.projectTilePoint(et.x,et.y,c),Pt=A.upVector(c,Be.x,Be.y),hi=A.upVector(c,et.x,et.y);ou(ri,ci,Pt),ou(ri,ci,Pt),ou(ri,Ut,hi),ou(ri,Ut,hi)}}}}}if(ve.vertexLength+ue>or.MAX_VERTEX_ARRAY_LENGTH&&(ve=this.segments.prepareSegment(ue,this.layoutVertexArray,this.indexArray)),J2[e.type]!=="Polygon")continue;const ye=[],xe=[],Ee=ve.vertexLength;for(let qe=0;qe<te.length;qe++){const We=te[qe];if(We.length!==0){We!==te[0]&&xe.push(ye.length/2);for(let tt=0;tt<We.length;tt++){const at=We[tt];nu(this.layoutVertexArray,at.x,at.y,0,0,1,1,0),ye.push(at.x),ye.push(at.y),L&&L.currentPolyCount.top++,C&&ou(this.layoutVertexExtArray,A.projectTilePoint(at.x,at.y,c),A.upVector(c,at.x,at.y))}}}const Se=Hh(ye,xe);for(let qe=0;qe<Se.length;qe+=3)this.indexArray.emplaceBack(Ee+Se[qe],Ee+Se[qe+2],Ee+Se[qe+1]);ve.primitiveLength+=Se.length/3,ve.vertexLength+=ue}if(L&&L.polyCount.length>0){if(L.borders){L.vertexArrayOffset=this.centroidVertexArray.length;const $=L.borders,te=this.featuresOnBorder.push(L)-1;for(let ue=0;ue<4;ue++)$[ue][0]!==Number.MAX_VALUE&&this.borders[ue].push(te)}this.encodeCentroid(L.borders?void 0:L.centroid(),L)}this.programConfigurations.populatePaintArrays(this.layoutVertexArray.length,e,s,f,_,c)}sortBorders(){for(let e=0;e<4;e++)this.borders[e].sort((r,s)=>this.featuresOnBorder[r].borders[e][0]-this.featuresOnBorder[s].borders[e][0])}encodeCentroid(e,r,s=!0){let c,f;if(e)if(e.y!==0){const x=r.span()._mult(this.tileToMeter);c=(Math.max(e.x,1)<<3)+Math.min(7,Math.round(x.x/10)),f=(Math.max(e.y,1)<<3)+Math.min(7,Math.round(x.y/10))}else c=Math.ceil(7*(e.x+450)),f=0;else c=0,f=+s;let _=s?this.centroidVertexArray.length:r.vertexArrayOffset;for(const x of r.polyCount){s&&this.centroidVertexArray.resize(this.centroidVertexArray.length+4*x.edges+x.top);for(let E=0;E<2*x.edges;E++)this.centroidVertexArray.emplace(_++,0,f),this.centroidVertexArray.emplace(_++,c,f);for(let E=0;E<x.top;E++)this.centroidVertexArray.emplace(_++,c,f)}}}function ev(i,e,r){return i.x===e.x&&(i.x<r[0].x||i.x>r[1].x)||i.y===e.y&&(i.y<r[0].y||i.y>r[1].y)}function bm(){const i=Math.PI/32,e=Math.tan(i),r=bf;return r*Math.sqrt(1+2*e*e)-r}function wm(i,e,r){const s=1<<r.z,c=Gr(r.x/s),f=Gr((r.x+1)/s),_=gr(r.y/s),x=gr((r.y+1)/s);return function(E,A,C,L,B=0,U){const N=[];if(!E.length||!C||!L)return N;const $=(Se,qe)=>{for(const We of Se)N.push({polygon:We,bounds:qe})},te=Math.ceil(Math.log2(C)),ue=Math.ceil(Math.log2(L)),ve=te-ue,ye=[];for(let Se=0;Se<Math.abs(ve);Se++)ye.push(ve>0?0:1);for(let Se=0;Se<Math.min(te,ue);Se++)ye.push(0),ye.push(1);let xe=E;if(xe=tp(xe,A[0].y-B,A[1].y+B,1),xe=tp(xe,A[0].x-B,A[1].x+B,0),!xe.length)return N;const Ee=[];for(ye.length?Ee.push({polygons:xe,bounds:A,depth:0}):$(xe,A);Ee.length;){const Se=Ee.pop(),qe=Se.depth,We=ye[qe],tt=Se.bounds[0],at=Se.bounds[1],Be=We===0?tt.x:tt.y,et=We===0?at.x:at.y,lt=U?U(We,Be,et):.5*(Be+et),ct=tp(Se.polygons,Be-B,lt+B,We),Mt=tp(Se.polygons,lt-B,et+B,We);if(ct.length){const ot=[tt,new I(We===0?lt:at.x,We===1?lt:at.y)];ye.length>qe+1?Ee.push({polygons:ct,bounds:ot,depth:qe+1}):$(ct,ot)}if(Mt.length){const ot=[new I(We===0?lt:tt.x,We===1?lt:tt.y),at];ye.length>qe+1?Ee.push({polygons:Mt,bounds:ot,depth:qe+1}):$(Mt,ot)}}return N}(i,e,Math.ceil((f-c)/11.25),Math.ceil((_-x)/11.25),1,(E,A,C)=>{if(E===0)return .5*(A+C);{const L=gr((r.y+A/qt)/s);return(ka(.5*(gr((r.y+C/qt)/s)+L))*s-r.y)*qt}})}Ct(su,"FillExtrusionBucket",{omit:["layers","features"]}),Ct(xm,"PartMetadata");var tv={paint:new Ke({"fill-extrusion-opacity":new Ue(ke["paint_fill-extrusion"]["fill-extrusion-opacity"]),"fill-extrusion-color":new _e(ke["paint_fill-extrusion"]["fill-extrusion-color"]),"fill-extrusion-translate":new Ue(ke["paint_fill-extrusion"]["fill-extrusion-translate"]),"fill-extrusion-translate-anchor":new Ue(ke["paint_fill-extrusion"]["fill-extrusion-translate-anchor"]),"fill-extrusion-pattern":new rt(ke["paint_fill-extrusion"]["fill-extrusion-pattern"]),"fill-extrusion-height":new _e(ke["paint_fill-extrusion"]["fill-extrusion-height"]),"fill-extrusion-base":new _e(ke["paint_fill-extrusion"]["fill-extrusion-base"]),"fill-extrusion-vertical-gradient":new Ue(ke["paint_fill-extrusion"]["fill-extrusion-vertical-gradient"])})};function Em(i,e,r){var s=2*Math.PI*6378137/256/Math.pow(2,r);return[i*s-2*Math.PI*6378137/2,e*s-2*Math.PI*6378137/2]}class ip{constructor(e,r,s){this.z=e,this.x=r,this.y=s,this.key=au(0,e,e,r,s)}equals(e){return this.z===e.z&&this.x===e.x&&this.y===e.y}url(e,r){const s=function(f,_,x){var E=Em(256*f,256*(_=Math.pow(2,x)-_-1),x),A=Em(256*(f+1),256*(_+1),x);return E[0]+","+E[1]+","+A[0]+","+A[1]}(this.x,this.y,this.z),c=function(f,_,x){let E,A="";for(let C=f;C>0;C--)E=1<<C-1,A+=(_&E?1:0)+(x&E?2:0);return A}(this.z,this.x,this.y);return e[(this.x+this.y)%e.length].replace("{prefix}",(this.x%16).toString(16)+(this.y%16).toString(16)).replace(/{z}/g,String(this.z)).replace(/{x}/g,String(this.x)).replace(/{y}/g,String(r==="tms"?Math.pow(2,this.z)-this.y-1:this.y)).replace("{quadkey}",c).replace("{bbox-epsg-3857}",s)}toString(){return`${this.z}/${this.x}/${this.y}`}}class Tm{constructor(e,r){this.wrap=e,this.canonical=r,this.key=au(e,r.z,r.z,r.x,r.y)}}class Zr{constructor(e,r,s,c,f){this.overscaledZ=e,this.wrap=r,this.canonical=new ip(s,+c,+f),this.key=r===0&&e===s?this.canonical.key:au(r,e,s,c,f)}equals(e){return this.overscaledZ===e.overscaledZ&&this.wrap===e.wrap&&this.canonical.equals(e.canonical)}scaledTo(e){const r=this.canonical.z-e;return e>this.canonical.z?new Zr(e,this.wrap,this.canonical.z,this.canonical.x,this.canonical.y):new Zr(e,this.wrap,e,this.canonical.x>>r,this.canonical.y>>r)}calculateScaledKey(e,r=!0){if(this.overscaledZ===e&&r)return this.key;if(e>this.canonical.z)return au(this.wrap*+r,e,this.canonical.z,this.canonical.x,this.canonical.y);{const s=this.canonical.z-e;return au(this.wrap*+r,e,e,this.canonical.x>>s,this.canonical.y>>s)}}isChildOf(e){if(e.wrap!==this.wrap)return!1;const r=this.canonical.z-e.canonical.z;return e.overscaledZ===0||e.overscaledZ<this.overscaledZ&&e.canonical.x===this.canonical.x>>r&&e.canonical.y===this.canonical.y>>r}children(e){if(this.overscaledZ>=e)return[new Zr(this.overscaledZ+1,this.wrap,this.canonical.z,this.canonical.x,this.canonical.y)];const r=this.canonical.z+1,s=2*this.canonical.x,c=2*this.canonical.y;return[new Zr(r,this.wrap,r,s,c),new Zr(r,this.wrap,r,s+1,c),new Zr(r,this.wrap,r,s,c+1),new Zr(r,this.wrap,r,s+1,c+1)]}isLessThan(e){return this.wrap<e.wrap||!(this.wrap>e.wrap)&&(this.overscaledZ<e.overscaledZ||!(this.overscaledZ>e.overscaledZ)&&(this.canonical.x<e.canonical.x||!(this.canonical.x>e.canonical.x)&&this.canonical.y<e.canonical.y))}wrapped(){return new Zr(this.overscaledZ,0,this.canonical.z,this.canonical.x,this.canonical.y)}unwrapTo(e){return new Zr(this.overscaledZ,e,this.canonical.z,this.canonical.x,this.canonical.y)}overscaleFactor(){return Math.pow(2,this.overscaledZ-this.canonical.z)}toUnwrapped(){return new Tm(this.wrap,this.canonical)}toString(){return`${this.overscaledZ}/${this.canonical.x}/${this.canonical.y}`}}function au(i,e,r,s,c){const f=1<<Math.min(r,22);let _=f*(c%f)+s%f;return i&&r<22&&(_+=f*f*((i<0?-2*i-1:2*i)%(1<<2*(22-r)))),16*(32*_+r)+(e-r)}function lu(i,e){return i.x*e.x+i.y*e.y}function Am(i,e){if(i.length===1){let r=0;const s=e[r++];let c;for(;!c||s.equals(c);)if(c=e[r++],!c)return 1/0;for(;r<e.length;r++){const f=e[r],_=i[0],x=c.sub(s),E=f.sub(s),A=_.sub(s),C=lu(x,x),L=lu(x,E),B=lu(E,E),U=lu(A,x),N=lu(A,E),$=C*B-L*L,te=(B*U-L*N)/$,ue=(C*N-L*U)/$,ve=s.z*(1-te-ue)+c.z*te+f.z*ue;if(isFinite(ve))return ve}return 1/0}{let r=1/0;for(const s of e)r=Math.min(r,s.z);return r}}function rp(i){const e=new I(i[0],i[1]);return e.z=i[2],e}function Sm(i,e,r,s,c,f,_,x){const E=_*c.getElevationAt(i,e,!0,!0),A=f[0]!==0,C=A?f[1]===0?_*(f[0]/7-450):_*function(L,B,U){const N=Math.floor(B[0]/8),$=Math.floor(B[1]/8),te=10*(B[0]-8*N),ue=10*(B[1]-8*$),ve=L.getElevationAt(N,$,!0,!0),ye=L.getMeterToDEM(U),xe=Math.floor(.5*(te*ye-1)),Ee=Math.floor(.5*(ue*ye-1)),Se=L.tileCoordToPixel(N,$),qe=2*xe+1,We=2*Ee+1,tt=function(Mt,ot,Tt,ri,ci){return[Mt.getElevationAtPixel(ot,Tt,!0),Mt.getElevationAtPixel(ot+ci,Tt,!0),Mt.getElevationAtPixel(ot,Tt+ci,!0),Mt.getElevationAtPixel(ot+ri,Tt+ci,!0)]}(L,Se.x-xe,Se.y-Ee,qe,We),at=Math.abs(tt[0]-tt[1]),Be=Math.abs(tt[2]-tt[3]),et=Math.abs(tt[0]-tt[2])+Math.abs(tt[1]-tt[3]),lt=Math.min(.25,.5*ye*(at+Be)/qe),ct=Math.min(.25,.5*ye*et/We);return ve+Math.max(lt*te,ct*ue)}(c,f,x):E;return{base:E+(r===0)?-1:r,top:A?Math.max(C+s,E+r+2):E+s}}Ct(ip,"CanonicalTileID"),Ct(Zr,"OverscaledTileID",{omit:["projMatrix"]});const iv=gt([{name:"a_pos_normal",components:2,type:"Int16"},{name:"a_data",components:4,type:"Uint8"},{name:"a_linesofar",components:1,type:"Float32"}],4),{members:rv}=iv,nv=gt([{name:"a_packed",components:4,type:"Float32"}]),{members:ov}=nv,sv=La.VectorTileFeature.types,av=Math.cos(Math.PI/180*37.5);class np{constructor(e){this.zoom=e.zoom,this.overscaling=e.overscaling,this.layers=e.layers,this.layerIds=this.layers.map(r=>r.id),this.index=e.index,this.projection=e.projection,this.hasPattern=!1,this.patternFeatures=[],this.lineClipsArray=[],this.gradients={},this.layers.forEach(r=>{this.gradients[r.id]={}}),this.layoutVertexArray=new ii,this.layoutVertexArray2=new Si,this.indexArray=new yi,this.programConfigurations=new Ma(e.layers,e.zoom),this.segments=new or,this.maxLineLength=0,this.stateDependentLayerIds=this.layers.filter(r=>r.isStateDependent()).map(r=>r.id)}populate(e,r,s,c){this.hasPattern=Nf("line",this.layers,r);const f=this.layers[0].layout.get("line-sort-key"),_=[];for(const{feature:C,id:L,index:B,sourceLayerIndex:U}of e){const N=this.layers[0]._featureFilter.needGeometry,$=Ca(C,N);if(!this.layers[0]._featureFilter.filter(new ne(this.zoom),$,s))continue;const te=f?f.evaluate($,{},s):void 0,ue={id:L,properties:C.properties,type:C.type,sourceLayerIndex:U,index:B,geometry:N?$.geometry:Jo(C,s,c),patterns:{},sortKey:te};_.push(ue)}f&&_.sort((C,L)=>C.sortKey-L.sortKey);const{lineAtlas:x,featureIndex:E}=r,A=this.addConstantDashes(x);for(const C of _){const{geometry:L,index:B,sourceLayerIndex:U}=C;if(A&&this.addFeatureDashes(C,x),this.hasPattern){const N=jf("line",this.layers,C,this.zoom,r);this.patternFeatures.push(N)}else this.addFeature(C,L,B,s,x.positions,r.availableImages);E.insert(e[B].feature,L,B,U,this.index)}}addConstantDashes(e){let r=!1;for(const s of this.layers){const c=s.paint.get("line-dasharray").value,f=s.layout.get("line-cap").value;if(c.kind!=="constant"||f.kind!=="constant")r=!0;else{const _=f.value,x=c.value;if(!x)continue;e.addDash(x.from,_),e.addDash(x.to,_),x.other&&e.addDash(x.other,_)}}return r}addFeatureDashes(e,r){const s=this.zoom;for(const c of this.layers){const f=c.paint.get("line-dasharray").value,_=c.layout.get("line-cap").value;if(f.kind==="constant"&&_.kind==="constant")continue;let x,E,A,C,L,B;if(f.kind==="constant"){const te=f.value;if(!te)continue;x=te.other||te.to,E=te.to,A=te.from}else x=f.evaluate({zoom:s-1},e),E=f.evaluate({zoom:s},e),A=f.evaluate({zoom:s+1},e);_.kind==="constant"?C=L=B=_.value:(C=_.evaluate({zoom:s-1},e),L=_.evaluate({zoom:s},e),B=_.evaluate({zoom:s+1},e)),r.addDash(x,C),r.addDash(E,L),r.addDash(A,B);const U=r.getKey(x,C),N=r.getKey(E,L),$=r.getKey(A,B);e.patterns[c.id]={min:U,mid:N,max:$}}}update(e,r,s,c){this.stateDependentLayers.length&&this.programConfigurations.updatePaintArrays(e,r,this.stateDependentLayers,s,c)}addFeatures(e,r,s,c,f){for(const _ of this.patternFeatures)this.addFeature(_,_.geometry,_.index,r,s,c)}isEmpty(){return this.layoutVertexArray.length===0}uploadPending(){return!this.uploaded||this.programConfigurations.needsUpload}upload(e){this.uploaded||(this.layoutVertexArray2.length!==0&&(this.layoutVertexBuffer2=e.createVertexBuffer(this.layoutVertexArray2,ov)),this.layoutVertexBuffer=e.createVertexBuffer(this.layoutVertexArray,rv),this.indexBuffer=e.createIndexBuffer(this.indexArray)),this.programConfigurations.upload(e),this.uploaded=!0}destroy(){this.layoutVertexBuffer&&(this.layoutVertexBuffer.destroy(),this.indexBuffer.destroy(),this.programConfigurations.destroy(),this.segments.destroy())}lineFeatureClips(e){if(e.properties&&e.properties.hasOwnProperty("mapbox_clip_start")&&e.properties.hasOwnProperty("mapbox_clip_end"))return{start:+e.properties.mapbox_clip_start,end:+e.properties.mapbox_clip_end}}addFeature(e,r,s,c,f,_){const x=this.layers[0].layout,E=x.get("line-join").evaluate(e,{}),A=x.get("line-cap").evaluate(e,{}),C=x.get("line-miter-limit"),L=x.get("line-round-limit");this.lineClips=this.lineFeatureClips(e);for(const B of r)this.addLine(B,e,E,A,C,L);this.programConfigurations.populatePaintArrays(this.layoutVertexArray.length,e,s,f,_,c)}addLine(e,r,s,c,f,_){if(this.distance=0,this.scaledDistance=0,this.totalDistance=0,this.lineSoFar=0,this.lineClips){this.lineClipsArray.push(this.lineClips);for(let ue=0;ue<e.length-1;ue++)this.totalDistance+=e[ue].dist(e[ue+1]);this.updateScaledDistance(),this.maxLineLength=Math.max(this.maxLineLength,this.totalDistance)}const x=sv[r.type]==="Polygon";let E=e.length;for(;E>=2&&e[E-1].equals(e[E-2]);)E--;let A=0;for(;A<E-1&&e[A].equals(e[A+1]);)A++;if(E<(x?3:2))return;s==="bevel"&&(f=1.05);const C=this.overscaling<=16?122880/(512*this.overscaling):0,L=this.segments.prepareSegment(10*E,this.layoutVertexArray,this.indexArray);let B,U,N,$,te;this.e1=this.e2=-1,x&&(B=e[E-2],te=e[A].sub(B)._unit()._perp());for(let ue=A;ue<E;ue++){if(N=ue===E-1?x?e[A+1]:void 0:e[ue+1],N&&e[ue].equals(N))continue;te&&($=te),B&&(U=B),B=e[ue],te=N?N.sub(B)._unit()._perp():$,$=$||te;let ve=$.add(te);ve.x===0&&ve.y===0||ve._unit();const ye=$.x*te.x+$.y*te.y,xe=ve.x*te.x+ve.y*te.y,Ee=xe!==0?1/xe:1/0,Se=2*Math.sqrt(2-2*xe),qe=xe<av&&U&&N,We=$.x*te.y-$.y*te.x>0;if(qe&&ue>A){const Be=B.dist(U);if(Be>2*C){const et=B.sub(B.sub(U)._mult(C/Be)._round());this.updateDistance(U,et),this.addCurrentVertex(et,$,0,0,L),U=et}}const tt=U&&N;let at=tt?s:x?"butt":c;if(tt&&at==="round"&&(Ee<_?at="miter":Ee<=2&&(at="fakeround")),at==="miter"&&Ee>f&&(at="bevel"),at==="bevel"&&(Ee>2&&(at="flipbevel"),Ee<f&&(at="miter")),U&&this.updateDistance(U,B),at==="miter")ve._mult(Ee),this.addCurrentVertex(B,ve,0,0,L);else if(at==="flipbevel"){if(Ee>100)ve=te.mult(-1);else{const Be=Ee*$.add(te).mag()/$.sub(te).mag();ve._perp()._mult(Be*(We?-1:1))}this.addCurrentVertex(B,ve,0,0,L),this.addCurrentVertex(B,ve.mult(-1),0,0,L)}else if(at==="bevel"||at==="fakeround"){const Be=-Math.sqrt(Ee*Ee-1),et=We?Be:0,lt=We?0:Be;if(U&&this.addCurrentVertex(B,$,et,lt,L),at==="fakeround"){const ct=Math.round(180*Se/Math.PI/20);for(let Mt=1;Mt<ct;Mt++){let ot=Mt/ct;if(ot!==.5){const ri=ot-.5;ot+=ot*ri*(ot-1)*((1.0904+ye*(ye*(3.55645-1.43519*ye)-3.2452))*ri*ri+(.848013+ye*(.215638*ye-1.06021)))}const Tt=te.sub($)._mult(ot)._add($)._unit()._mult(We?-1:1);this.addHalfVertex(B,Tt.x,Tt.y,!1,We,0,L)}}N&&this.addCurrentVertex(B,te,-et,-lt,L)}else if(at==="butt")this.addCurrentVertex(B,ve,0,0,L);else if(at==="square"){const Be=U?1:-1;U||this.addCurrentVertex(B,ve,Be,Be,L),this.addCurrentVertex(B,ve,0,0,L),U&&this.addCurrentVertex(B,ve,Be,Be,L)}else at==="round"&&(U&&(this.addCurrentVertex(B,$,0,0,L),this.addCurrentVertex(B,$,1,1,L,!0)),N&&(this.addCurrentVertex(B,te,-1,-1,L,!0),this.addCurrentVertex(B,te,0,0,L)));if(qe&&ue<E-1){const Be=B.dist(N);if(Be>2*C){const et=B.add(N.sub(B)._mult(C/Be)._round());this.updateDistance(B,et),this.addCurrentVertex(et,te,0,0,L),B=et}}}}addCurrentVertex(e,r,s,c,f,_=!1){const x=r.y*c-r.x,E=-r.y-r.x*c;this.addHalfVertex(e,r.x+r.y*s,r.y-r.x*s,_,!1,s,f),this.addHalfVertex(e,x,E,_,!0,-c,f)}addHalfVertex({x:e,y:r},s,c,f,_,x,E){this.layoutVertexArray.emplaceBack((e<<1)+(f?1:0),(r<<1)+(_?1:0),Math.round(63*s)+128,Math.round(63*c)+128,1+(x===0?0:x<0?-1:1),0,this.lineSoFar),this.lineClips&&this.layoutVertexArray2.emplaceBack(this.scaledDistance,this.lineClipsArray.length,this.lineClips.start,this.lineClips.end);const A=E.vertexLength++;this.e1>=0&&this.e2>=0&&(this.indexArray.emplaceBack(this.e1,this.e2,A),E.primitiveLength++),_?this.e2=A:this.e1=A}updateScaledDistance(){if(this.lineClips){const e=this.totalDistance/(this.lineClips.end-this.lineClips.start);this.scaledDistance=this.distance/this.totalDistance,this.lineSoFar=e*this.lineClips.start+this.distance}else this.lineSoFar=this.distance}updateDistance(e,r){this.distance+=e.dist(r),this.updateScaledDistance()}}Ct(np,"LineBucket",{omit:["layers","patternFeatures"]});const lv=new Ke({"line-cap":new _e(ke.layout_line["line-cap"]),"line-join":new _e(ke.layout_line["line-join"]),"line-miter-limit":new Ue(ke.layout_line["line-miter-limit"]),"line-round-limit":new Ue(ke.layout_line["line-round-limit"]),"line-sort-key":new _e(ke.layout_line["line-sort-key"])});var Mm={paint:new Ke({"line-opacity":new _e(ke.paint_line["line-opacity"]),"line-color":new _e(ke.paint_line["line-color"]),"line-translate":new Ue(ke.paint_line["line-translate"]),"line-translate-anchor":new Ue(ke.paint_line["line-translate-anchor"]),"line-width":new _e(ke.paint_line["line-width"]),"line-gap-width":new _e(ke.paint_line["line-gap-width"]),"line-offset":new _e(ke.paint_line["line-offset"]),"line-blur":new _e(ke.paint_line["line-blur"]),"line-dasharray":new rt(ke.paint_line["line-dasharray"]),"line-pattern":new rt(ke.paint_line["line-pattern"]),"line-gradient":new Et(ke.paint_line["line-gradient"]),"line-trim-offset":new Ue(ke.paint_line["line-trim-offset"])}),layout:lv};const Im=new class extends _e{possiblyEvaluate(i,e){return e=new ne(Math.floor(e.zoom),{now:e.now,fadeDuration:e.fadeDuration,zoomHistory:e.zoomHistory,transition:e.transition}),super.possiblyEvaluate(i,e)}evaluate(i,e,r,s){return e=Pe({},e,{zoom:Math.floor(e.zoom)}),super.evaluate(i,e,r,s)}}(Mm.paint.properties["line-width"].specification);function km(i,e){return e>0?e+2*i:i}Im.useIntegerZoom=!0;const cv=gt([{name:"a_pos_offset",components:4,type:"Int16"},{name:"a_tex_size",components:4,type:"Uint16"},{name:"a_pixeloffset",components:4,type:"Int16"}],4),uv=gt([{name:"a_globe_anchor",components:3,type:"Int16"},{name:"a_globe_normal",components:3,type:"Float32"}],4),hv=gt([{name:"a_projected_pos",components:4,type:"Float32"}],4);gt([{name:"a_fade_opacity",components:1,type:"Uint32"}],4);const pv=gt([{name:"a_placed",components:2,type:"Uint8"},{name:"a_shift",components:2,type:"Float32"}]),fv=gt([{name:"a_size_scale",components:1,type:"Float32"},{name:"a_padding",components:2,type:"Float32"}]);gt([{type:"Int16",name:"projectedAnchorX"},{type:"Int16",name:"projectedAnchorY"},{type:"Int16",name:"projectedAnchorZ"},{type:"Int16",name:"tileAnchorX"},{type:"Int16",name:"tileAnchorY"},{type:"Float32",name:"x1"},{type:"Float32",name:"y1"},{type:"Float32",name:"x2"},{type:"Float32",name:"y2"},{type:"Int16",name:"padding"},{type:"Uint32",name:"featureIndex"},{type:"Uint16",name:"sourceLayerIndex"},{type:"Uint16",name:"bucketIndex"}]);const Cm=gt([{name:"a_pos",components:3,type:"Int16"},{name:"a_anchor_pos",components:2,type:"Int16"},{name:"a_extrude",components:2,type:"Int16"}],4),dv=gt([{name:"a_pos_2f",components:2,type:"Float32"},{name:"a_radius",components:1,type:"Float32"},{name:"a_flags",components:2,type:"Int16"}],4);gt([{name:"triangle",components:3,type:"Uint16"}]),gt([{type:"Int16",name:"projectedAnchorX"},{type:"Int16",name:"projectedAnchorY"},{type:"Int16",name:"projectedAnchorZ"},{type:"Float32",name:"tileAnchorX"},{type:"Float32",name:"tileAnchorY"},{type:"Uint16",name:"glyphStartIndex"},{type:"Uint16",name:"numGlyphs"},{type:"Uint32",name:"vertexStartIndex"},{type:"Uint32",name:"lineStartIndex"},{type:"Uint32",name:"lineLength"},{type:"Uint16",name:"segment"},{type:"Uint16",name:"lowerSize"},{type:"Uint16",name:"upperSize"},{type:"Float32",name:"lineOffsetX"},{type:"Float32",name:"lineOffsetY"},{type:"Uint8",name:"writingMode"},{type:"Uint8",name:"placedOrientation"},{type:"Uint8",name:"hidden"},{type:"Uint32",name:"crossTileID"},{type:"Int16",name:"associatedIconIndex"},{type:"Uint8",name:"flipState"}]),gt([{type:"Int16",name:"projectedAnchorX"},{type:"Int16",name:"projectedAnchorY"},{type:"Int16",name:"projectedAnchorZ"},{type:"Float32",name:"tileAnchorX"},{type:"Float32",name:"tileAnchorY"},{type:"Int16",name:"rightJustifiedTextSymbolIndex"},{type:"Int16",name:"centerJustifiedTextSymbolIndex"},{type:"Int16",name:"leftJustifiedTextSymbolIndex"},{type:"Int16",name:"verticalPlacedTextSymbolIndex"},{type:"Int16",name:"placedIconSymbolIndex"},{type:"Int16",name:"verticalPlacedIconSymbolIndex"},{type:"Uint16",name:"key"},{type:"Uint16",name:"textBoxStartIndex"},{type:"Uint16",name:"textBoxEndIndex"},{type:"Uint16",name:"verticalTextBoxStartIndex"},{type:"Uint16",name:"verticalTextBoxEndIndex"},{type:"Uint16",name:"iconBoxStartIndex"},{type:"Uint16",name:"iconBoxEndIndex"},{type:"Uint16",name:"verticalIconBoxStartIndex"},{type:"Uint16",name:"verticalIconBoxEndIndex"},{type:"Uint16",name:"featureIndex"},{type:"Uint16",name:"numHorizontalGlyphVertices"},{type:"Uint16",name:"numVerticalGlyphVertices"},{type:"Uint16",name:"numIconVertices"},{type:"Uint16",name:"numVerticalIconVertices"},{type:"Uint16",name:"useRuntimeCollisionCircles"},{type:"Uint32",name:"crossTileID"},{type:"Float32",components:2,name:"textOffset"},{type:"Float32",name:"collisionCircleDiameter"}]),gt([{type:"Float32",name:"offsetX"}]),gt([{type:"Int16",name:"x"},{type:"Int16",name:"y"},{type:"Int16",name:"tileUnitDistanceFromAnchor"}]);var Pr=24;const Eo=128;function Gf(i,e){const{expression:r}=e;if(r.kind==="constant")return{kind:"constant",layoutSize:r.evaluate(new ne(i+1))};if(r.kind==="source")return{kind:"source"};{const{zoomStops:s,interpolationType:c}=r;let f=0;for(;f<s.length&&s[f]<=i;)f++;f=Math.max(0,f-1);let _=f;for(;_<s.length&&s[_]<i+1;)_++;_=Math.min(s.length-1,_);const x=s[f],E=s[_];return r.kind==="composite"?{kind:"composite",minZoom:x,maxZoom:E,interpolationType:c}:{kind:"camera",minZoom:x,maxZoom:E,minSize:r.evaluate(new ne(x)),maxSize:r.evaluate(new ne(E)),interpolationType:c}}}function op(i,{uSize:e,uSizeT:r},{lowerSize:s,upperSize:c}){return i.kind==="source"?s/Eo:i.kind==="composite"?bi(s/Eo,c/Eo,r):e}function $l(i,e){let r=0,s=0;if(i.kind==="constant")s=i.layoutSize;else if(i.kind!=="source"){const{interpolationType:c,minZoom:f,maxZoom:_}=i,x=c?re(Ln.interpolationFactor(c,e,f,_),0,1):0;i.kind==="camera"?s=bi(i.minSize,i.maxSize,x):r=x}return{uSizeT:r,uSize:s}}var mv=Object.freeze({__proto__:null,getSizeData:Gf,evaluateSizeForFeature:op,evaluateSizeForZoom:$l,SIZE_PACK_FACTOR:Eo});function _v(i,e,r){return i.sections.forEach(s=>{s.text=function(c,f,_){const x=f.layout.get("text-transform").evaluate(_,{});return x==="uppercase"?c=c.toLocaleUpperCase():x==="lowercase"&&(c=c.toLocaleLowerCase()),K.applyArabicShaping&&(c=K.applyArabicShaping(c)),c}(s.text,e,r)}),i}const cu={"!":"\uFE15","#":"\uFF03",$:"\uFF04","%":"\uFF05","&":"\uFF06","(":"\uFE35",")":"\uFE36","*":"\uFF0A","+":"\uFF0B",",":"\uFE10","-":"\uFE32",".":"\u30FB","/":"\uFF0F",":":"\uFE13",";":"\uFE14","<":"\uFE3F","=":"\uFF1D",">":"\uFE40","?":"\uFE16","@":"\uFF20","[":"\uFE47","\\":"\uFF3C","]":"\uFE48","^":"\uFF3E",_:"\uFE33","`":"\uFF40","{":"\uFE37","|":"\u2015","}":"\uFE38","~":"\uFF5E","\xA2":"\uFFE0","\xA3":"\uFFE1","\xA5":"\uFFE5","\xA6":"\uFFE4","\xAC":"\uFFE2","\xAF":"\uFFE3","\u2013":"\uFE32","\u2014":"\uFE31","\u2018":"\uFE43","\u2019":"\uFE44","\u201C":"\uFE41","\u201D":"\uFE42","\u2026":"\uFE19","\u2027":"\u30FB","\u20A9":"\uFFE6","\u3001":"\uFE11","\u3002":"\uFE12","\u3008":"\uFE3F","\u3009":"\uFE40","\u300A":"\uFE3D","\u300B":"\uFE3E","\u300C":"\uFE41","\u300D":"\uFE42","\u300E":"\uFE43","\u300F":"\uFE44","\u3010":"\uFE3B","\u3011":"\uFE3C","\u3014":"\uFE39","\u3015":"\uFE3A","\u3016":"\uFE17","\u3017":"\uFE18","\uFF01":"\uFE15","\uFF08":"\uFE35","\uFF09":"\uFE36","\uFF0C":"\uFE10","\uFF0D":"\uFE32","\uFF0E":"\u30FB","\uFF1A":"\uFE13","\uFF1B":"\uFE14","\uFF1C":"\uFE3F","\uFF1E":"\uFE40","\uFF1F":"\uFE16","\uFF3B":"\uFE47","\uFF3D":"\uFE48","\uFF3F":"\uFE33","\uFF5B":"\uFE37","\uFF5C":"\u2015","\uFF5D":"\uFE38","\uFF5F":"\uFE35","\uFF60":"\uFE36","\uFF61":"\uFE12","\uFF62":"\uFE41","\uFF63":"\uFE42"};function gv(i){return i==="\uFE36"||i==="\uFE48"||i==="\uFE38"||i==="\uFE44"||i==="\uFE42"||i==="\uFE3E"||i==="\uFE3C"||i==="\uFE3A"||i==="\uFE18"||i==="\uFE40"||i==="\uFE10"||i==="\uFE13"||i==="\uFE14"||i==="\uFF40"||i==="\uFFE3"||i==="\uFE11"||i==="\uFE12"}function yv(i){return i==="\uFE35"||i==="\uFE47"||i==="\uFE37"||i==="\uFE43"||i==="\uFE41"||i==="\uFE3D"||i==="\uFE3B"||i==="\uFE39"||i==="\uFE17"||i==="\uFE3F"}var zm=function(i,e,r,s,c){var f,_,x=8*c-s-1,E=(1<<x)-1,A=E>>1,C=-7,L=r?c-1:0,B=r?-1:1,U=i[e+L];for(L+=B,f=U&(1<<-C)-1,U>>=-C,C+=x;C>0;f=256*f+i[e+L],L+=B,C-=8);for(_=f&(1<<-C)-1,f>>=-C,C+=s;C>0;_=256*_+i[e+L],L+=B,C-=8);if(f===0)f=1-A;else{if(f===E)return _?NaN:1/0*(U?-1:1);_+=Math.pow(2,s),f-=A}return(U?-1:1)*_*Math.pow(2,f-s)},Pm=function(i,e,r,s,c,f){var _,x,E,A=8*f-c-1,C=(1<<A)-1,L=C>>1,B=c===23?Math.pow(2,-24)-Math.pow(2,-77):0,U=s?0:f-1,N=s?1:-1,$=e<0||e===0&&1/e<0?1:0;for(e=Math.abs(e),isNaN(e)||e===1/0?(x=isNaN(e)?1:0,_=C):(_=Math.floor(Math.log(e)/Math.LN2),e*(E=Math.pow(2,-_))<1&&(_--,E*=2),(e+=_+L>=1?B/E:B*Math.pow(2,1-L))*E>=2&&(_++,E/=2),_+L>=C?(x=0,_=C):_+L>=1?(x=(e*E-1)*Math.pow(2,c),_+=L):(x=e*Math.pow(2,L-1)*Math.pow(2,c),_=0));c>=8;i[r+U]=255&x,U+=N,x/=256,c-=8);for(_=_<<c|x,A+=c;A>0;i[r+U]=255&_,U+=N,_/=256,A-=8);i[r+U-N]|=128*$},uu=Vi;function Vi(i){this.buf=ArrayBuffer.isView&&ArrayBuffer.isView(i)?i:new Uint8Array(i||0),this.pos=0,this.type=0,this.length=this.buf.length}Vi.Varint=0,Vi.Fixed64=1,Vi.Bytes=2,Vi.Fixed32=5;var qf=4294967296,Dm=1/qf,Lm=typeof TextDecoder=="undefined"?null:new TextDecoder("utf8");function es(i){return i.type===Vi.Bytes?i.readVarint()+i.pos:i.pos+1}function Wl(i,e,r){return r?4294967296*e+(i>>>0):4294967296*(e>>>0)+(i>>>0)}function Rm(i,e,r){var s=e<=16383?1:e<=2097151?2:e<=268435455?3:Math.floor(Math.log(e)/(7*Math.LN2));r.realloc(s);for(var c=r.pos-1;c>=i;c--)r.buf[c+s]=r.buf[c]}function vv(i,e){for(var r=0;r<i.length;r++)e.writeVarint(i[r])}function xv(i,e){for(var r=0;r<i.length;r++)e.writeSVarint(i[r])}function bv(i,e){for(var r=0;r<i.length;r++)e.writeFloat(i[r])}function wv(i,e){for(var r=0;r<i.length;r++)e.writeDouble(i[r])}function Ev(i,e){for(var r=0;r<i.length;r++)e.writeBoolean(i[r])}function Tv(i,e){for(var r=0;r<i.length;r++)e.writeFixed32(i[r])}function Av(i,e){for(var r=0;r<i.length;r++)e.writeSFixed32(i[r])}function Sv(i,e){for(var r=0;r<i.length;r++)e.writeFixed64(i[r])}function Mv(i,e){for(var r=0;r<i.length;r++)e.writeSFixed64(i[r])}function sp(i,e){return(i[e]|i[e+1]<<8|i[e+2]<<16)+16777216*i[e+3]}function Xl(i,e,r){i[r]=e,i[r+1]=e>>>8,i[r+2]=e>>>16,i[r+3]=e>>>24}function Bm(i,e){return(i[e]|i[e+1]<<8|i[e+2]<<16)+(i[e+3]<<24)}function Iv(i,e,r){e.glyphs=[],i===1&&r.readMessage(kv,e)}function kv(i,e,r){if(i===3){const{id:s,bitmap:c,width:f,height:_,left:x,top:E,advance:A}=r.readMessage(Cv,{});e.glyphs.push({id:s,bitmap:new Qo({width:f+6,height:_+6},c),metrics:{width:f,height:_,left:x,top:E,advance:A}})}else i===4?e.ascender=r.readSVarint():i===5&&(e.descender=r.readSVarint())}function Cv(i,e,r){i===1?e.id=r.readVarint():i===2?e.bitmap=r.readBytes():i===3?e.width=r.readVarint():i===4?e.height=r.readVarint():i===5?e.left=r.readSVarint():i===6?e.top=r.readSVarint():i===7&&(e.advance=r.readVarint())}function Zf(i){let e=0,r=0;for(const _ of i)e+=_.w*_.h,r=Math.max(r,_.w);i.sort((_,x)=>x.h-_.h);const s=[{x:0,y:0,w:Math.max(Math.ceil(Math.sqrt(e/.95)),r),h:1/0}];let c=0,f=0;for(const _ of i)for(let x=s.length-1;x>=0;x--){const E=s[x];if(!(_.w>E.w||_.h>E.h)){if(_.x=E.x,_.y=E.y,f=Math.max(f,_.y+_.h),c=Math.max(c,_.x+_.w),_.w===E.w&&_.h===E.h){const A=s.pop();x<s.length&&(s[x]=A)}else _.h===E.h?(E.x+=_.w,E.w-=_.w):_.w===E.w?(E.y+=_.h,E.h-=_.h):(s.push({x:E.x+_.w,y:E.y,w:E.w-_.w,h:_.h}),E.y+=_.h,E.h-=_.h);break}}return{w:c,h:f,fill:e/(c*f)||0}}Vi.prototype={destroy:function(){this.buf=null},readFields:function(i,e,r){for(r=r||this.length;this.pos<r;){var s=this.readVarint(),c=s>>3,f=this.pos;this.type=7&s,i(c,e,this),this.pos===f&&this.skip(s)}return e},readMessage:function(i,e){return this.readFields(i,e,this.readVarint()+this.pos)},readFixed32:function(){var i=sp(this.buf,this.pos);return this.pos+=4,i},readSFixed32:function(){var i=Bm(this.buf,this.pos);return this.pos+=4,i},readFixed64:function(){var i=sp(this.buf,this.pos)+sp(this.buf,this.pos+4)*qf;return this.pos+=8,i},readSFixed64:function(){var i=sp(this.buf,this.pos)+Bm(this.buf,this.pos+4)*qf;return this.pos+=8,i},readFloat:function(){var i=zm(this.buf,this.pos,!0,23,4);return this.pos+=4,i},readDouble:function(){var i=zm(this.buf,this.pos,!0,52,8);return this.pos+=8,i},readVarint:function(i){var e,r,s=this.buf;return e=127&(r=s[this.pos++]),r<128?e:(e|=(127&(r=s[this.pos++]))<<7,r<128?e:(e|=(127&(r=s[this.pos++]))<<14,r<128?e:(e|=(127&(r=s[this.pos++]))<<21,r<128?e:function(c,f,_){var x,E,A=_.buf;if(x=(112&(E=A[_.pos++]))>>4,E<128||(x|=(127&(E=A[_.pos++]))<<3,E<128)||(x|=(127&(E=A[_.pos++]))<<10,E<128)||(x|=(127&(E=A[_.pos++]))<<17,E<128)||(x|=(127&(E=A[_.pos++]))<<24,E<128)||(x|=(1&(E=A[_.pos++]))<<31,E<128))return Wl(c,x,f);throw new Error("Expected varint not more than 10 bytes")}(e|=(15&(r=s[this.pos]))<<28,i,this))))},readVarint64:function(){return this.readVarint(!0)},readSVarint:function(){var i=this.readVarint();return i%2==1?(i+1)/-2:i/2},readBoolean:function(){return Boolean(this.readVarint())},readString:function(){var i=this.readVarint()+this.pos,e=this.pos;return this.pos=i,i-e>=12&&Lm?function(r,s,c){return Lm.decode(r.subarray(s,c))}(this.buf,e,i):function(r,s,c){for(var f="",_=s;_<c;){var x,E,A,C=r[_],L=null,B=C>239?4:C>223?3:C>191?2:1;if(_+B>c)break;B===1?C<128&&(L=C):B===2?(192&(x=r[_+1]))==128&&(L=(31&C)<<6|63&x)<=127&&(L=null):B===3?(E=r[_+2],(192&(x=r[_+1]))==128&&(192&E)==128&&((L=(15&C)<<12|(63&x)<<6|63&E)<=2047||L>=55296&&L<=57343)&&(L=null)):B===4&&(E=r[_+2],A=r[_+3],(192&(x=r[_+1]))==128&&(192&E)==128&&(192&A)==128&&((L=(15&C)<<18|(63&x)<<12|(63&E)<<6|63&A)<=65535||L>=1114112)&&(L=null)),L===null?(L=65533,B=1):L>65535&&(L-=65536,f+=String.fromCharCode(L>>>10&1023|55296),L=56320|1023&L),f+=String.fromCharCode(L),_+=B}return f}(this.buf,e,i)},readBytes:function(){var i=this.readVarint()+this.pos,e=this.buf.subarray(this.pos,i);return this.pos=i,e},readPackedVarint:function(i,e){if(this.type!==Vi.Bytes)return i.push(this.readVarint(e));var r=es(this);for(i=i||[];this.pos<r;)i.push(this.readVarint(e));return i},readPackedSVarint:function(i){if(this.type!==Vi.Bytes)return i.push(this.readSVarint());var e=es(this);for(i=i||[];this.pos<e;)i.push(this.readSVarint());return i},readPackedBoolean:function(i){if(this.type!==Vi.Bytes)return i.push(this.readBoolean());var e=es(this);for(i=i||[];this.pos<e;)i.push(this.readBoolean());return i},readPackedFloat:function(i){if(this.type!==Vi.Bytes)return i.push(this.readFloat());var e=es(this);for(i=i||[];this.pos<e;)i.push(this.readFloat());return i},readPackedDouble:function(i){if(this.type!==Vi.Bytes)return i.push(this.readDouble());var e=es(this);for(i=i||[];this.pos<e;)i.push(this.readDouble());return i},readPackedFixed32:function(i){if(this.type!==Vi.Bytes)return i.push(this.readFixed32());var e=es(this);for(i=i||[];this.pos<e;)i.push(this.readFixed32());return i},readPackedSFixed32:function(i){if(this.type!==Vi.Bytes)return i.push(this.readSFixed32());var e=es(this);for(i=i||[];this.pos<e;)i.push(this.readSFixed32());return i},readPackedFixed64:function(i){if(this.type!==Vi.Bytes)return i.push(this.readFixed64());var e=es(this);for(i=i||[];this.pos<e;)i.push(this.readFixed64());return i},readPackedSFixed64:function(i){if(this.type!==Vi.Bytes)return i.push(this.readSFixed64());var e=es(this);for(i=i||[];this.pos<e;)i.push(this.readSFixed64());return i},skip:function(i){var e=7&i;if(e===Vi.Varint)for(;this.buf[this.pos++]>127;);else if(e===Vi.Bytes)this.pos=this.readVarint()+this.pos;else if(e===Vi.Fixed32)this.pos+=4;else{if(e!==Vi.Fixed64)throw new Error("Unimplemented type: "+e);this.pos+=8}},writeTag:function(i,e){this.writeVarint(i<<3|e)},realloc:function(i){for(var e=this.length||16;e<this.pos+i;)e*=2;if(e!==this.length){var r=new Uint8Array(e);r.set(this.buf),this.buf=r,this.length=e}},finish:function(){return this.length=this.pos,this.pos=0,this.buf.subarray(0,this.length)},writeFixed32:function(i){this.realloc(4),Xl(this.buf,i,this.pos),this.pos+=4},writeSFixed32:function(i){this.realloc(4),Xl(this.buf,i,this.pos),this.pos+=4},writeFixed64:function(i){this.realloc(8),Xl(this.buf,-1&i,this.pos),Xl(this.buf,Math.floor(i*Dm),this.pos+4),this.pos+=8},writeSFixed64:function(i){this.realloc(8),Xl(this.buf,-1&i,this.pos),Xl(this.buf,Math.floor(i*Dm),this.pos+4),this.pos+=8},writeVarint:function(i){(i=+i||0)>268435455||i<0?function(e,r){var s,c;if(e>=0?(s=e%4294967296|0,c=e/4294967296|0):(c=~(-e/4294967296),4294967295^(s=~(-e%4294967296))?s=s+1|0:(s=0,c=c+1|0)),e>=18446744073709552e3||e<-18446744073709552e3)throw new Error("Given varint doesn't fit into 10 bytes");r.realloc(10),function(f,_,x){x.buf[x.pos++]=127&f|128,f>>>=7,x.buf[x.pos++]=127&f|128,f>>>=7,x.buf[x.pos++]=127&f|128,f>>>=7,x.buf[x.pos++]=127&f|128,x.buf[x.pos]=127&(f>>>=7)}(s,0,r),function(f,_){var x=(7&f)<<4;_.buf[_.pos++]|=x|((f>>>=3)?128:0),f&&(_.buf[_.pos++]=127&f|((f>>>=7)?128:0),f&&(_.buf[_.pos++]=127&f|((f>>>=7)?128:0),f&&(_.buf[_.pos++]=127&f|((f>>>=7)?128:0),f&&(_.buf[_.pos++]=127&f|((f>>>=7)?128:0),f&&(_.buf[_.pos++]=127&f)))))}(c,r)}(i,this):(this.realloc(4),this.buf[this.pos++]=127&i|(i>127?128:0),i<=127||(this.buf[this.pos++]=127&(i>>>=7)|(i>127?128:0),i<=127||(this.buf[this.pos++]=127&(i>>>=7)|(i>127?128:0),i<=127||(this.buf[this.pos++]=i>>>7&127))))},writeSVarint:function(i){this.writeVarint(i<0?2*-i-1:2*i)},writeBoolean:function(i){this.writeVarint(Boolean(i))},writeString:function(i){i=String(i),this.realloc(4*i.length),this.pos++;var e=this.pos;this.pos=function(s,c,f){for(var _,x,E=0;E<c.length;E++){if((_=c.charCodeAt(E))>55295&&_<57344){if(!x){_>56319||E+1===c.length?(s[f++]=239,s[f++]=191,s[f++]=189):x=_;continue}if(_<56320){s[f++]=239,s[f++]=191,s[f++]=189,x=_;continue}_=x-55296<<10|_-56320|65536,x=null}else x&&(s[f++]=239,s[f++]=191,s[f++]=189,x=null);_<128?s[f++]=_:(_<2048?s[f++]=_>>6|192:(_<65536?s[f++]=_>>12|224:(s[f++]=_>>18|240,s[f++]=_>>12&63|128),s[f++]=_>>6&63|128),s[f++]=63&_|128)}return f}(this.buf,i,this.pos);var r=this.pos-e;r>=128&&Rm(e,r,this),this.pos=e-1,this.writeVarint(r),this.pos+=r},writeFloat:function(i){this.realloc(4),Pm(this.buf,i,this.pos,!0,23,4),this.pos+=4},writeDouble:function(i){this.realloc(8),Pm(this.buf,i,this.pos,!0,52,8),this.pos+=8},writeBytes:function(i){var e=i.length;this.writeVarint(e),this.realloc(e);for(var r=0;r<e;r++)this.buf[this.pos++]=i[r]},writeRawMessage:function(i,e){this.pos++;var r=this.pos;i(e,this);var s=this.pos-r;s>=128&&Rm(r,s,this),this.pos=r-1,this.writeVarint(s),this.pos+=s},writeMessage:function(i,e,r){this.writeTag(i,Vi.Bytes),this.writeRawMessage(e,r)},writePackedVarint:function(i,e){e.length&&this.writeMessage(i,vv,e)},writePackedSVarint:function(i,e){e.length&&this.writeMessage(i,xv,e)},writePackedBoolean:function(i,e){e.length&&this.writeMessage(i,Ev,e)},writePackedFloat:function(i,e){e.length&&this.writeMessage(i,bv,e)},writePackedDouble:function(i,e){e.length&&this.writeMessage(i,wv,e)},writePackedFixed32:function(i,e){e.length&&this.writeMessage(i,Tv,e)},writePackedSFixed32:function(i,e){e.length&&this.writeMessage(i,Av,e)},writePackedFixed64:function(i,e){e.length&&this.writeMessage(i,Sv,e)},writePackedSFixed64:function(i,e){e.length&&this.writeMessage(i,Mv,e)},writeBytesField:function(i,e){this.writeTag(i,Vi.Bytes),this.writeBytes(e)},writeFixed32Field:function(i,e){this.writeTag(i,Vi.Fixed32),this.writeFixed32(e)},writeSFixed32Field:function(i,e){this.writeTag(i,Vi.Fixed32),this.writeSFixed32(e)},writeFixed64Field:function(i,e){this.writeTag(i,Vi.Fixed64),this.writeFixed64(e)},writeSFixed64Field:function(i,e){this.writeTag(i,Vi.Fixed64),this.writeSFixed64(e)},writeVarintField:function(i,e){this.writeTag(i,Vi.Varint),this.writeVarint(e)},writeSVarintField:function(i,e){this.writeTag(i,Vi.Varint),this.writeSVarint(e)},writeStringField:function(i,e){this.writeTag(i,Vi.Bytes),this.writeString(e)},writeFloatField:function(i,e){this.writeTag(i,Vi.Fixed32),this.writeFloat(e)},writeDoubleField:function(i,e){this.writeTag(i,Vi.Fixed64),this.writeDouble(e)},writeBooleanField:function(i,e){this.writeVarintField(i,Boolean(e))}};class $f{constructor(e,{pixelRatio:r,version:s,stretchX:c,stretchY:f,content:_}){this.paddedRect=e,this.pixelRatio=r,this.stretchX=c,this.stretchY=f,this.content=_,this.version=s}get tl(){return[this.paddedRect.x+1,this.paddedRect.y+1]}get br(){return[this.paddedRect.x+this.paddedRect.w-1,this.paddedRect.y+this.paddedRect.h-1]}get displaySize(){return[(this.paddedRect.w-2)/this.pixelRatio,(this.paddedRect.h-2)/this.pixelRatio]}}class Om{constructor(e,r){const s={},c={};this.haveRenderCallbacks=[];const f=[];this.addImages(e,s,f),this.addImages(r,c,f);const{w:_,h:x}=Zf(f),E=new fn({width:_||1,height:x||1});for(const A in e){const C=e[A],L=s[A].paddedRect;fn.copy(C.data,E,{x:0,y:0},{x:L.x+1,y:L.y+1},C.data)}for(const A in r){const C=r[A],L=c[A].paddedRect,B=L.x+1,U=L.y+1,N=C.data.width,$=C.data.height;fn.copy(C.data,E,{x:0,y:0},{x:B,y:U},C.data),fn.copy(C.data,E,{x:0,y:$-1},{x:B,y:U-1},{width:N,height:1}),fn.copy(C.data,E,{x:0,y:0},{x:B,y:U+$},{width:N,height:1}),fn.copy(C.data,E,{x:N-1,y:0},{x:B-1,y:U},{width:1,height:$}),fn.copy(C.data,E,{x:0,y:0},{x:B+N,y:U},{width:1,height:$})}this.image=E,this.iconPositions=s,this.patternPositions=c}addImages(e,r,s){for(const c in e){const f=e[c],_={x:0,y:0,w:f.data.width+2,h:f.data.height+2};s.push(_),r[c]=new $f(_,f),f.hasRenderCallback&&this.haveRenderCallbacks.push(c)}}patchUpdatedImages(e,r){this.haveRenderCallbacks=this.haveRenderCallbacks.filter(s=>e.hasImage(s)),e.dispatchRenderCallbacks(this.haveRenderCallbacks);for(const s in e.updatedImages)this.patchUpdatedImage(this.iconPositions[s],e.getImage(s),r),this.patchUpdatedImage(this.patternPositions[s],e.getImage(s),r)}patchUpdatedImage(e,r,s){if(!e||!r||e.version===r.version)return;e.version=r.version;const[c,f]=e.tl;s.update(r.data,void 0,{x:c,y:f})}}Ct($f,"ImagePosition"),Ct(Om,"ImageAtlas");const Sn={horizontal:1,vertical:2,horizontalOnly:3};class hu{constructor(){this.scale=1,this.fontStack="",this.imageName=null}static forText(e,r){const s=new hu;return s.scale=e||1,s.fontStack=r,s}static forImage(e){const r=new hu;return r.imageName=e,r}}class Hl{constructor(){this.text="",this.sectionIndex=[],this.sections=[],this.imageSectionID=null}static fromFeature(e,r){const s=new Hl;for(let c=0;c<e.sections.length;c++){const f=e.sections[c];f.image?s.addImageSection(f):s.addTextSection(f,r)}return s}length(){return this.text.length}getSection(e){return this.sections[this.sectionIndex[e]]}getSections(){return this.sections}getSectionIndex(e){return this.sectionIndex[e]}getCharCode(e){return this.text.charCodeAt(e)}verticalizePunctuation(e){this.text=function(r,s){let c="";for(let f=0;f<r.length;f++){const _=r.charCodeAt(f+1)||null,x=r.charCodeAt(f-1)||null;c+=!s&&(_&&a(_)&&!cu[r[f+1]]||x&&a(x)&&!cu[r[f-1]])||!cu[r[f]]?r[f]:cu[r[f]]}return c}(this.text,e)}trim(){let e=0;for(let s=0;s<this.text.length&&ap[this.text.charCodeAt(s)];s++)e++;let r=this.text.length;for(let s=this.text.length-1;s>=0&&s>=e&&ap[this.text.charCodeAt(s)];s--)r--;this.text=this.text.substring(e,r),this.sectionIndex=this.sectionIndex.slice(e,r)}substring(e,r){const s=new Hl;return s.text=this.text.substring(e,r),s.sectionIndex=this.sectionIndex.slice(e,r),s.sections=this.sections,s}toString(){return this.text}getMaxScale(){return this.sectionIndex.reduce((e,r)=>Math.max(e,this.sections[r].scale),0)}addTextSection(e,r){this.text+=e.text,this.sections.push(hu.forText(e.scale,e.fontStack||r));const s=this.sections.length-1;for(let c=0;c<e.text.length;++c)this.sectionIndex.push(s)}addImageSection(e){const r=e.image?e.image.name:"";if(r.length===0)return void Kt("Can't add FormattedSection with an empty image.");const s=this.getNextImageSectionCharCode();s?(this.text+=String.fromCharCode(s),this.sections.push(hu.forImage(r)),this.sectionIndex.push(this.sections.length-1)):Kt("Reached maximum number of images 6401")}getNextImageSectionCharCode(){return this.imageSectionID?this.imageSectionID>=63743?null:++this.imageSectionID:(this.imageSectionID=57344,this.imageSectionID)}}function Wf(i,e,r,s,c,f,_,x,E,A,C,L,B,U,N,$){const te=Hl.fromFeature(i,c);let ue;L===Sn.vertical&&te.verticalizePunctuation(B);const{processBidirectionalText:ve,processStyledBidirectionalText:ye}=K;if(ve&&te.sections.length===1){ue=[];const Se=ve(te.toString(),Xf(te,A,f,e,s,U,N));for(const qe of Se){const We=new Hl;We.text=qe,We.sections=te.sections;for(let tt=0;tt<qe.length;tt++)We.sectionIndex.push(0);ue.push(We)}}else if(ye){ue=[];const Se=ye(te.text,te.sectionIndex,Xf(te,A,f,e,s,U,N));for(const qe of Se){const We=new Hl;We.text=qe[0],We.sectionIndex=qe[1],We.sections=te.sections,ue.push(We)}}else ue=function(Se,qe){const We=[],tt=Se.text;let at=0;for(const Be of qe)We.push(Se.substring(at,Be)),at=Be;return at<tt.length&&We.push(Se.substring(at,tt.length)),We}(te,Xf(te,A,f,e,s,U,N));const xe=[],Ee={positionedLines:xe,text:te.toString(),top:C[1],bottom:C[1],left:C[0],right:C[0],writingMode:L,iconsInText:!1,verticalizable:!1,hasBaseline:!1};return function(Se,qe,We,tt,at,Be,et,lt,ct,Mt,ot,Tt){let ri=0,ci=0,Ut=0;const Pt=lt==="right"?1:lt==="left"?0:.5;let hi=!1;for(const pi of at){const Ei=pi.getSections();for(const Ni of Ei){if(Ni.imageName)continue;const Bi=qe[Ni.fontStack];if(Bi&&(hi=Bi.ascender!==void 0&&Bi.descender!==void 0,!hi))break}if(!hi)break}let si=0;for(const pi of at){pi.trim();const Ei=pi.getMaxScale(),Ni=(Ei-1)*Pr,Bi={positionedGlyphs:[],lineOffset:0};Se.positionedLines[si]=Bi;const Li=Bi.positionedGlyphs;let Zi=0;if(!pi.length()){ci+=Be,++si;continue}let Ki=0,Sr=0;for(let _i=0;_i<pi.length();_i++){const rr=pi.getSection(_i),Fr=pi.getSectionIndex(_i),Ii=pi.getCharCode(_i);let Ji=rr.scale,Wr=null,Wi=null,ar=null,Mr=Pr,Er=0;const Dr=!(ct===Sn.horizontal||!ot&&!t(Ii)||ot&&(ap[Ii]||(Bt=Ii,Mh(Bt)||Ih(Bt)||Ta(Bt)||Zc(Bt)||Xc(Bt))));if(rr.imageName){const Xr=tt[rr.imageName];if(!Xr)continue;ar=rr.imageName,Se.iconsInText=Se.iconsInText||!0,Wi=Xr.paddedRect;const Ir=Xr.displaySize;Ji=Ji*Pr/Tt,Wr={width:Ir[0],height:Ir[1],left:1,top:-3,advance:Dr?Ir[1]:Ir[0],localGlyph:!1},Er=hi?-Wr.height*Ji:Ei*Pr-17-Ir[1]*Ji,Mr=Wr.advance;const is=(Dr?Ir[0]:Ir[1])*Ji-Pr*Ei;is>0&&is>Zi&&(Zi=is)}else{const Xr=We[rr.fontStack];if(!Xr)continue;Xr[Ii]&&(Wi=Xr[Ii]);const Ir=qe[rr.fontStack];if(!Ir)continue;const is=Ir.glyphs[Ii];if(!is)continue;if(Wr=is.metrics,Mr=Ii!==8203?Pr:0,hi){const tc=Ir.ascender!==void 0?Math.abs(Ir.ascender):0,bu=Ir.descender!==void 0?Math.abs(Ir.descender):0,wu=(tc+bu)*Ji;Ki<wu&&(Ki=wu,Sr=(tc-bu)/2*Ji),Er=-tc*Ji}else Er=(Ei-Ji)*Pr-17}Dr?(Se.verticalizable=!0,Li.push({glyph:Ii,imageName:ar,x:ri,y:ci+Er,vertical:Dr,scale:Ji,localGlyph:Wr.localGlyph,fontStack:rr.fontStack,sectionIndex:Fr,metrics:Wr,rect:Wi}),ri+=Mr*Ji+Mt):(Li.push({glyph:Ii,imageName:ar,x:ri,y:ci+Er,vertical:Dr,scale:Ji,localGlyph:Wr.localGlyph,fontStack:rr.fontStack,sectionIndex:Fr,metrics:Wr,rect:Wi}),ri+=Wr.advance*Ji+Mt)}Li.length!==0&&(Ut=Math.max(ri-Mt,Ut),hi?jm(Li,Pt,Zi,Sr,Be*Ei/2):jm(Li,Pt,Zi,0,Be/2)),ri=0;const tn=Be*Ei+Zi;Bi.lineOffset=Math.max(Zi,Ni),ci+=tn,++si}var Bt;const yr=ci,{horizontalAlign:sr,verticalAlign:ir}=Hf(et);(function(pi,Ei,Ni,Bi,Li,Zi){const Ki=(Ei-Ni)*Li,Sr=-Zi*Bi;for(const tn of pi)for(const _i of tn.positionedGlyphs)_i.x+=Ki,_i.y+=Sr})(Se.positionedLines,Pt,sr,ir,Ut,yr),Se.top+=-ir*yr,Se.bottom=Se.top+yr,Se.left+=-sr*Ut,Se.right=Se.left+Ut,Se.hasBaseline=hi}(Ee,e,r,s,ue,_,x,E,L,A,B,$),!function(Se){for(const qe of Se)if(qe.positionedGlyphs.length!==0)return!1;return!0}(xe)&&Ee}const ap={9:!0,10:!0,11:!0,12:!0,13:!0,32:!0},zv={10:!0,32:!0,38:!0,40:!0,41:!0,43:!0,45:!0,47:!0,173:!0,183:!0,8203:!0,8208:!0,8211:!0,8231:!0};function Fm(i,e,r,s,c,f){if(e.imageName){const _=s[e.imageName];return _?_.displaySize[0]*e.scale*Pr/f+c:0}{const _=r[e.fontStack],x=_&&_.glyphs[i];return x?x.metrics.advance*e.scale+c:0}}function Um(i,e,r,s){const c=Math.pow(i-e,2);return s?i<e?c/2:2*c:c+Math.abs(r)*r}function Pv(i,e,r){let s=0;return i===10&&(s-=1e4),r&&(s+=150),i!==40&&i!==65288||(s+=50),e!==41&&e!==65289||(s+=50),s}function Vm(i,e,r,s,c,f){let _=null,x=Um(e,r,c,f);for(const E of s){const A=Um(e-E.x,r,c,f)+E.badness;A<=x&&(_=E,x=A)}return{index:i,x:e,priorBreak:_,badness:x}}function Nm(i){return i?Nm(i.priorBreak).concat(i.index):[]}function Xf(i,e,r,s,c,f,_){if(f!=="point")return[];if(!i)return[];const x=[],E=function(B,U,N,$,te,ue){let ve=0;for(let ye=0;ye<B.length();ye++){const xe=B.getSection(ye);ve+=Fm(B.getCharCode(ye),xe,$,te,U,ue)}return ve/Math.max(1,Math.ceil(ve/N))}(i,e,r,s,c,_),A=i.text.indexOf("\u200B")>=0;let C=0;for(let B=0;B<i.length();B++){const U=i.getSection(B),N=i.getCharCode(B);if(ap[N]||(C+=Fm(N,U,s,c,e,_)),B<i.length()-1){const $=!((L=N)<11904||!(Nc(L)||Vc(L)||$c(L)||Lh(L)||Bl(L)||kh(L)||jc(L)||Pl(L)||zh(L)||qc(L)||Rl(L)||Hc(L)||Dl(L)||Aa(L)||Ch(L)||Gc(L)||Ll(L)||Rh(L)||Ol(L)||Ph(L)));(zv[N]||$||U.imageName)&&x.push(Vm(B+1,C,E,x,Pv(N,i.getCharCode(B+1),$&&A),!1))}}var L;return Nm(Vm(i.length(),C,E,x,0,!0))}function Hf(i){let e=.5,r=.5;switch(i){case"right":case"top-right":case"bottom-right":e=1;break;case"left":case"top-left":case"bottom-left":e=0}switch(i){case"bottom":case"bottom-right":case"bottom-left":r=1;break;case"top":case"top-right":case"top-left":r=0}return{horizontalAlign:e,verticalAlign:r}}function jm(i,e,r,s,c){if(!(e||r||s||c))return;const f=i.length-1,_=i[f],x=(_.x+_.metrics.advance*_.scale)*e;for(let E=0;E<=f;E++)i[E].x-=x,i[E].y+=r+s+c}function Dv(i,e,r){const{horizontalAlign:s,verticalAlign:c}=Hf(r),f=e[0]-i.displaySize[0]*s,_=e[1]-i.displaySize[1]*c;return{image:i,top:_,bottom:_+i.displaySize[1],left:f,right:f+i.displaySize[0]}}function Gm(i,e,r,s,c,f){const _=i.image;let x;if(_.content){const te=_.content,ue=_.pixelRatio||1;x=[te[0]/ue,te[1]/ue,_.displaySize[0]-te[2]/ue,_.displaySize[1]-te[3]/ue]}const E=e.left*f,A=e.right*f;let C,L,B,U;r==="width"||r==="both"?(U=c[0]+E-s[3],L=c[0]+A+s[1]):(U=c[0]+(E+A-_.displaySize[0])/2,L=U+_.displaySize[0]);const N=e.top*f,$=e.bottom*f;return r==="height"||r==="both"?(C=c[1]+N-s[0],B=c[1]+$+s[2]):(C=c[1]+(N+$-_.displaySize[1])/2,B=C+_.displaySize[1]),{image:_,top:C,right:L,bottom:B,left:U,collisionPadding:x}}class ts extends I{constructor(e,r,s,c,f){super(e,r),this.angle=c,this.z=s,f!==void 0&&(this.segment=f)}clone(){return new ts(this.x,this.y,this.z,this.angle,this.segment)}}function qm(i,e,r,s,c){if(e.segment===void 0)return!0;let f=e,_=e.segment+1,x=0;for(;x>-r/2;){if(_--,_<0)return!1;x-=i[_].dist(f),f=i[_]}x+=i[_].dist(i[_+1]),_++;const E=[];let A=0;for(;x<r/2;){const C=i[_],L=i[_+1];if(!L)return!1;let B=i[_-1].angleTo(C)-C.angleTo(L);for(B=Math.abs((B+3*Math.PI)%(2*Math.PI)-Math.PI),E.push({distance:x,angleDelta:B}),A+=B;x-E[0].distance>s;)A-=E.shift().angleDelta;if(A>c)return!1;_++,x+=C.dist(L)}return!0}function Zm(i){let e=0;for(let r=0;r<i.length-1;r++)e+=i[r].dist(i[r+1]);return e}function $m(i,e,r){return i?.6*e*r:0}function Wm(i,e){return Math.max(i?i.right-i.left:0,e?e.right-e.left:0)}function Lv(i,e,r,s,c,f){const _=$m(r,c,f),x=Wm(r,s)*f;let E=0;const A=Zm(i)/2;for(let C=0;C<i.length-1;C++){const L=i[C],B=i[C+1],U=L.dist(B);if(E+U>A){const N=(A-E)/U,$=bi(L.x,B.x,N),te=bi(L.y,B.y,N),ue=new ts($,te,0,B.angleTo(L),C);return!_||qm(i,ue,x,_,e)?ue:void 0}E+=U}}function Rv(i,e,r,s,c,f,_,x,E){const A=$m(s,f,_),C=Wm(s,c),L=C*_,B=i[0].x===0||i[0].x===E||i[0].y===0||i[0].y===E;return e-L<e/4&&(e=L+e/4),Xm(i,B?e/2*x%e:(C/2+2*f)*_*x%e,e,A,r,L,B,!1,E)}function Xm(i,e,r,s,c,f,_,x,E){const A=f/2,C=Zm(i);let L=0,B=e-r,U=[];for(let N=0;N<i.length-1;N++){const $=i[N],te=i[N+1],ue=$.dist(te),ve=te.angleTo($);for(;B+r<L+ue;){B+=r;const ye=(B-L)/ue,xe=bi($.x,te.x,ye),Ee=bi($.y,te.y,ye);if(xe>=0&&xe<E&&Ee>=0&&Ee<E&&B-A>=0&&B+A<=C){const Se=new ts(xe,Ee,0,ve,N);Se._round(),s&&!qm(i,Se,f,s,c)||U.push(Se)}}L+=ue}return x||U.length||_||(U=Xm(i,L/2,r,s,c,f,_,!0,E)),U}function Hm(i,e,r,s,c){const f=[];for(let _=0;_<i.length;_++){const x=i[_];let E;for(let A=0;A<x.length-1;A++){let C=x[A],L=x[A+1];C.x<e&&L.x<e||(C.x<e?C=new I(e,C.y+(e-C.x)/(L.x-C.x)*(L.y-C.y))._round():L.x<e&&(L=new I(e,C.y+(e-C.x)/(L.x-C.x)*(L.y-C.y))._round()),C.y<r&&L.y<r||(C.y<r?C=new I(C.x+(r-C.y)/(L.y-C.y)*(L.x-C.x),r)._round():L.y<r&&(L=new I(C.x+(r-C.y)/(L.y-C.y)*(L.x-C.x),r)._round()),C.x>=s&&L.x>=s||(C.x>=s?C=new I(s,C.y+(s-C.x)/(L.x-C.x)*(L.y-C.y))._round():L.x>=s&&(L=new I(s,C.y+(s-C.x)/(L.x-C.x)*(L.y-C.y))._round()),C.y>=c&&L.y>=c||(C.y>=c?C=new I(C.x+(c-C.y)/(L.y-C.y)*(L.x-C.x),c)._round():L.y>=c&&(L=new I(C.x+(c-C.y)/(L.y-C.y)*(L.x-C.x),c)._round()),E&&C.equals(E[E.length-1])||(E=[C],f.push(E)),E.push(L)))))}}return f}Ct(ts,"Anchor");const pu=1e20;function Ym(i,e,r,s,c,f,_,x,E){for(let A=e;A<e+s;A++)Km(i,r*f+A,f,c,_,x,E);for(let A=r;A<r+c;A++)Km(i,A*f+e,1,s,_,x,E)}function Km(i,e,r,s,c,f,_){f[0]=0,_[0]=-pu,_[1]=pu,c[0]=i[e];for(let x=1,E=0,A=0;x<s;x++){c[x]=i[e+x*r];const C=x*x;do{const L=f[E];A=(c[x]-c[L]+C-L*L)/(x-L)/2}while(A<=_[E]&&--E>-1);E++,f[E]=x,_[E]=A,_[E+1]=pu}for(let x=0,E=0;x<s;x++){for(;_[E+1]<x;)E++;const A=f[E],C=x-A;i[e+x*r]=c[A]+C*C}}const Yf={none:0,ideographs:1,all:2};class Yl{constructor(e,r,s){this.requestManager=e,this.localGlyphMode=r,this.localFontFamily=s,this.entries={},this.localGlyphs={200:{},400:{},500:{},900:{}}}setURL(e){this.url=e}getGlyphs(e,r){const s=[];for(const c in e)for(const f of e[c])s.push({stack:c,id:f});Je(s,({stack:c,id:f},_)=>{let x=this.entries[c];x||(x=this.entries[c]={glyphs:{},requests:{},ranges:{},ascender:void 0,descender:void 0});let E=x.glyphs[f];if(E!==void 0)return void _(null,{stack:c,id:f,glyph:E});if(E=this._tinySDF(x,c,f),E)return x.glyphs[f]=E,void _(null,{stack:c,id:f,glyph:E});const A=Math.floor(f/256);if(256*A>65535)return void _(new Error("glyphs > 65535 not supported"));if(x.ranges[A])return void _(null,{stack:c,id:f,glyph:E});let C=x.requests[A];C||(C=x.requests[A]=[],Yl.loadGlyphRange(c,A,this.url,this.requestManager,(L,B)=>{if(B){x.ascender=B.ascender,x.descender=B.descender;for(const U in B.glyphs)this._doesCharSupportLocalGlyph(+U)||(x.glyphs[+U]=B.glyphs[+U]);x.ranges[A]=!0}for(const U of C)U(L,B);delete x.requests[A]})),C.push((L,B)=>{L?_(L):B&&_(null,{stack:c,id:f,glyph:B.glyphs[f]||null})})},(c,f)=>{if(c)r(c);else if(f){const _={};for(const{stack:x,id:E,glyph:A}of f)_[x]===void 0&&(_[x]={}),_[x].glyphs===void 0&&(_[x].glyphs={}),_[x].glyphs[E]=A&&{id:A.id,bitmap:A.bitmap.clone(),metrics:A.metrics},_[x].ascender=this.entries[x].ascender,_[x].descender=this.entries[x].descender;r(null,_)}})}_doesCharSupportLocalGlyph(e){return this.localGlyphMode!==Yf.none&&(this.localGlyphMode===Yf.all?!!this.localFontFamily:!!this.localFontFamily&&(qc(e)||Dh(e)||Dl(e)||Ll(e)||Pl(e)))}_tinySDF(e,r,s){const c=this.localFontFamily;if(!c||!this._doesCharSupportLocalGlyph(s))return;let f=e.tinySDF;if(!f){let $="400";/bold/i.test(r)?$="900":/medium/i.test(r)?$="500":/light/i.test(r)&&($="200"),f=e.tinySDF=new Yl.TinySDF({fontFamily:c,fontWeight:$,fontSize:48,buffer:6,radius:16}),f.fontWeight=$}if(this.localGlyphs[f.fontWeight][s])return this.localGlyphs[f.fontWeight][s];const _=String.fromCharCode(s),{data:x,width:E,height:A,glyphWidth:C,glyphHeight:L,glyphLeft:B,glyphTop:U,glyphAdvance:N}=f.draw(_);return this.localGlyphs[f.fontWeight][s]={id:s,bitmap:new Qo({width:E,height:A},x),metrics:{width:C/2,height:L/2,left:B/2,top:U/2-27,advance:N/2,localGlyph:!0}}}}function Jm(i,e,r,s){const c=[],f=i.image,_=f.pixelRatio,x=f.paddedRect.w-2,E=f.paddedRect.h-2,A=i.right-i.left,C=i.bottom-i.top,L=f.stretchX||[[0,x]],B=f.stretchY||[[0,E]],U=(Be,et)=>Be+et[1]-et[0],N=L.reduce(U,0),$=B.reduce(U,0),te=x-N,ue=E-$;let ve=0,ye=N,xe=0,Ee=$,Se=0,qe=te,We=0,tt=ue;if(f.content&&s){const Be=f.content;ve=lp(L,0,Be[0]),xe=lp(B,0,Be[1]),ye=lp(L,Be[0],Be[2]),Ee=lp(B,Be[1],Be[3]),Se=Be[0]-ve,We=Be[1]-xe,qe=Be[2]-Be[0]-ye,tt=Be[3]-Be[1]-Ee}const at=(Be,et,lt,ct)=>{const Mt=cp(Be.stretch-ve,ye,A,i.left),ot=up(Be.fixed-Se,qe,Be.stretch,N),Tt=cp(et.stretch-xe,Ee,C,i.top),ri=up(et.fixed-We,tt,et.stretch,$),ci=cp(lt.stretch-ve,ye,A,i.left),Ut=up(lt.fixed-Se,qe,lt.stretch,N),Pt=cp(ct.stretch-xe,Ee,C,i.top),hi=up(ct.fixed-We,tt,ct.stretch,$),si=new I(Mt,Tt),Bt=new I(ci,Tt),yr=new I(ci,Pt),sr=new I(Mt,Pt),ir=new I(ot/_,ri/_),pi=new I(Ut/_,hi/_),Ei=e*Math.PI/180;if(Ei){const Li=Math.sin(Ei),Zi=Math.cos(Ei),Ki=[Zi,-Li,Li,Zi];si._matMult(Ki),Bt._matMult(Ki),sr._matMult(Ki),yr._matMult(Ki)}const Ni=Be.stretch+Be.fixed,Bi=et.stretch+et.fixed;return{tl:si,tr:Bt,bl:sr,br:yr,tex:{x:f.paddedRect.x+1+Ni,y:f.paddedRect.y+1+Bi,w:lt.stretch+lt.fixed-Ni,h:ct.stretch+ct.fixed-Bi},writingMode:void 0,glyphOffset:[0,0],sectionIndex:0,pixelOffsetTL:ir,pixelOffsetBR:pi,minFontScaleX:qe/_/A,minFontScaleY:tt/_/C,isSDF:r}};if(s&&(f.stretchX||f.stretchY)){const Be=Qm(L,te,N),et=Qm(B,ue,$);for(let lt=0;lt<Be.length-1;lt++){const ct=Be[lt],Mt=Be[lt+1];for(let ot=0;ot<et.length-1;ot++)c.push(at(ct,et[ot],Mt,et[ot+1]))}}else c.push(at({fixed:0,stretch:-1},{fixed:0,stretch:-1},{fixed:0,stretch:x+1},{fixed:0,stretch:E+1}));return c}function lp(i,e,r){let s=0;for(const c of i)s+=Math.max(e,Math.min(r,c[1]))-Math.max(e,Math.min(r,c[0]));return s}function Qm(i,e,r){const s=[{fixed:-1,stretch:0}];for(const[c,f]of i){const _=s[s.length-1];s.push({fixed:c-_.stretch,stretch:_.stretch}),s.push({fixed:c-_.stretch,stretch:_.stretch+(f-c)})}return s.push({fixed:e+1,stretch:r}),s}function cp(i,e,r,s){return i/e*r+s}function up(i,e,r,s){return i-e*r/s}function Bv(i,e,r,s){const c=e+i.positionedLines[s].lineOffset;return s===0?r+c/2:r+(c+(e+i.positionedLines[s-1].lineOffset))/2}Yl.loadGlyphRange=function(i,e,r,s,c){const f=256*e,_=f+255,x=s.transformRequest(s.normalizeGlyphsURL(r).replace("{fontstack}",i).replace("{range}",`${f}-${_}`),me.Glyphs);Te(x,(E,A)=>{if(E)c(E);else if(A){const C={},L=function(B){return new uu(B).readFields(Iv,{})}(A);for(const B of L.glyphs)C[B.id]=B;c(null,{glyphs:C,ascender:L.ascender,descender:L.descender})}})},Yl.TinySDF=class{constructor({fontSize:i=24,buffer:e=3,radius:r=8,cutoff:s=.25,fontFamily:c="sans-serif",fontWeight:f="normal",fontStyle:_="normal"}={}){this.buffer=e,this.cutoff=s,this.radius=r;const x=this.size=i+4*e,E=this._createCanvas(x),A=this.ctx=E.getContext("2d",{willReadFrequently:!0});A.font=`${_} ${f} ${i}px ${c}`,A.textBaseline="alphabetic",A.textAlign="left",A.fillStyle="black",this.gridOuter=new Float64Array(x*x),this.gridInner=new Float64Array(x*x),this.f=new Float64Array(x),this.z=new Float64Array(x+1),this.v=new Uint16Array(x)}_createCanvas(i){const e=document.createElement("canvas");return e.width=e.height=i,e}draw(i){const{width:e,actualBoundingBoxAscent:r,actualBoundingBoxDescent:s,actualBoundingBoxLeft:c,actualBoundingBoxRight:f}=this.ctx.measureText(i),_=Math.ceil(r),x=Math.min(this.size-this.buffer,Math.ceil(f-c)),E=Math.min(this.size-this.buffer,_+Math.ceil(s)),A=x+2*this.buffer,C=E+2*this.buffer,L=Math.max(A*C,0),B=new Uint8ClampedArray(L),U={data:B,width:A,height:C,glyphWidth:x,glyphHeight:E,glyphTop:_,glyphLeft:0,glyphAdvance:e};if(x===0||E===0)return U;const{ctx:N,buffer:$,gridInner:te,gridOuter:ue}=this;N.clearRect($,$,x,E),N.fillText(i,$,$+_);const ve=N.getImageData($,$,x,E);ue.fill(pu,0,L),te.fill(0,0,L);for(let ye=0;ye<E;ye++)for(let xe=0;xe<x;xe++){const Ee=ve.data[4*(ye*x+xe)+3]/255;if(Ee===0)continue;const Se=(ye+$)*A+xe+$;if(Ee===1)ue[Se]=0,te[Se]=pu;else{const qe=.5-Ee;ue[Se]=qe>0?qe*qe:0,te[Se]=qe<0?qe*qe:0}}Ym(ue,0,0,A,C,A,this.f,this.v,this.z),Ym(te,$,$,x,E,A,this.f,this.v,this.z);for(let ye=0;ye<L;ye++){const xe=Math.sqrt(ue[ye])-Math.sqrt(te[ye]);B[ye]=Math.round(255-255*(xe/this.radius+this.cutoff))}return U}};class Ov{constructor(e=[],r=Fv){if(this.data=e,this.length=this.data.length,this.compare=r,this.length>0)for(let s=(this.length>>1)-1;s>=0;s--)this._down(s)}push(e){this.data.push(e),this.length++,this._up(this.length-1)}pop(){if(this.length===0)return;const e=this.data[0],r=this.data.pop();return this.length--,this.length>0&&(this.data[0]=r,this._down(0)),e}peek(){return this.data[0]}_up(e){const{data:r,compare:s}=this,c=r[e];for(;e>0;){const f=e-1>>1,_=r[f];if(s(c,_)>=0)break;r[e]=_,e=f}r[e]=c}_down(e){const{data:r,compare:s}=this,c=this.length>>1,f=r[e];for(;e<c;){let _=1+(e<<1),x=r[_];const E=_+1;if(E<this.length&&s(r[E],x)<0&&(_=E,x=r[E]),s(x,f)>=0)break;r[e]=x,e=_}r[e]=f}}function Fv(i,e){return i<e?-1:i>e?1:0}function Uv(i,e=1,r=!1){let s=1/0,c=1/0,f=-1/0,_=-1/0;const x=i[0];for(let U=0;U<x.length;U++){const N=x[U];(!U||N.x<s)&&(s=N.x),(!U||N.y<c)&&(c=N.y),(!U||N.x>f)&&(f=N.x),(!U||N.y>_)&&(_=N.y)}const E=Math.min(f-s,_-c);let A=E/2;const C=new Ov([],Vv);if(E===0)return new I(s,c);for(let U=s;U<f;U+=E)for(let N=c;N<_;N+=E)C.push(new Kl(U+A,N+A,A,i));let L=function(U){let N=0,$=0,te=0;const ue=U[0];for(let ve=0,ye=ue.length,xe=ye-1;ve<ye;xe=ve++){const Ee=ue[ve],Se=ue[xe],qe=Ee.x*Se.y-Se.x*Ee.y;$+=(Ee.x+Se.x)*qe,te+=(Ee.y+Se.y)*qe,N+=3*qe}return new Kl($/N,te/N,0,U)}(i),B=C.length;for(;C.length;){const U=C.pop();(U.d>L.d||!L.d)&&(L=U,r&&console.log("found best %d after %d probes",Math.round(1e4*U.d)/1e4,B)),U.max-L.d<=e||(A=U.h/2,C.push(new Kl(U.p.x-A,U.p.y-A,A,i)),C.push(new Kl(U.p.x+A,U.p.y-A,A,i)),C.push(new Kl(U.p.x-A,U.p.y+A,A,i)),C.push(new Kl(U.p.x+A,U.p.y+A,A,i)),B+=4)}return r&&(console.log(`num probes: ${B}`),console.log(`best distance: ${L.d}`)),L.p}function Vv(i,e){return e.max-i.max}function Kl(i,e,r,s){this.p=new I(i,e),this.h=r,this.d=function(c,f){let _=!1,x=1/0;for(let E=0;E<f.length;E++){const A=f[E];for(let C=0,L=A.length,B=L-1;C<L;B=C++){const U=A[C],N=A[B];U.y>c.y!=N.y>c.y&&c.x<(N.x-U.x)*(c.y-U.y)/(N.y-U.y)+U.x&&(_=!_),x=Math.min(x,$1(c,U,N))}}return(_?1:-1)*Math.sqrt(x)}(this.p,s),this.max=this.d+this.h*Math.SQRT2}const Kf=Number.POSITIVE_INFINITY,Nv=Math.sqrt(2);function e_(i,e){return e[1]!==Kf?function(r,s,c){let f=0,_=0;switch(s=Math.abs(s),c=Math.abs(c),r){case"top-right":case"top-left":case"top":_=c-7;break;case"bottom-right":case"bottom-left":case"bottom":_=7-c}switch(r){case"top-right":case"bottom-right":case"right":f=-s;break;case"top-left":case"bottom-left":case"left":f=s}return[f,_]}(i,e[0],e[1]):function(r,s){let c=0,f=0;s<0&&(s=0);const _=s/Nv;switch(r){case"top-right":case"top-left":f=_-7;break;case"bottom-right":case"bottom-left":f=7-_;break;case"bottom":f=7-s;break;case"top":f=s-7}switch(r){case"top-right":case"bottom-right":c=-_;break;case"top-left":case"bottom-left":c=_;break;case"left":c=s;break;case"right":c=-s}return[c,f]}(i,e[0])}function jv(i,e,r,s,c,f,_,x,E,A){i.createArrays(),i.tilePixelRatio=qt/(512*i.overscaling),i.compareText={},i.iconsNeedLinear=!1;const C=i.layers[0].layout,L=i.layers[0]._unevaluatedLayout._values,B={};if(i.textSizeData.kind==="composite"){const{minZoom:$,maxZoom:te}=i.textSizeData;B.compositeTextSizes=[L["text-size"].possiblyEvaluate(new ne($),x),L["text-size"].possiblyEvaluate(new ne(te),x)]}if(i.iconSizeData.kind==="composite"){const{minZoom:$,maxZoom:te}=i.iconSizeData;B.compositeIconSizes=[L["icon-size"].possiblyEvaluate(new ne($),x),L["icon-size"].possiblyEvaluate(new ne(te),x)]}B.layoutTextSize=L["text-size"].possiblyEvaluate(new ne(E+1),x),B.layoutIconSize=L["icon-size"].possiblyEvaluate(new ne(E+1),x),B.textMaxSize=L["text-size"].possiblyEvaluate(new ne(18),x);const U=C.get("text-rotation-alignment")==="map"&&C.get("symbol-placement")!=="point",N=C.get("text-size");for(const $ of i.features){const te=C.get("text-font").evaluate($,{},x).join(","),ue=N.evaluate($,{},x),ve=B.layoutTextSize.evaluate($,{},x),ye=(B.layoutIconSize.evaluate($,{},x),{horizontal:{},vertical:void 0}),xe=$.text;let Ee,Se=[0,0];if(xe){const tt=xe.toString(),at=C.get("text-letter-spacing").evaluate($,{},x)*Pr,Be=C.get("text-line-height").evaluate($,{},x)*Pr,et=Ul(tt)?at:0,lt=C.get("text-anchor").evaluate($,{},x),ct=C.get("text-variable-anchor");if(!ct){const Ut=C.get("text-radial-offset").evaluate($,{},x);Se=Ut?e_(lt,[Ut*Pr,Kf]):C.get("text-offset").evaluate($,{},x).map(Pt=>Pt*Pr)}let Mt=U?"center":C.get("text-justify").evaluate($,{},x);const ot=C.get("symbol-placement"),Tt=ot==="point",ri=ot==="point"?C.get("text-max-width").evaluate($,{},x)*Pr:0,ci=Ut=>{i.allowVerticalPlacement&&Fl(tt)&&(ye.vertical=Wf(xe,e,r,c,te,ri,Be,lt,Ut,et,Se,Sn.vertical,!0,ot,ve,ue))};if(!U&&ct){const Ut=Mt==="auto"?ct.map(hi=>Jf(hi)):[Mt];let Pt=!1;for(let hi=0;hi<Ut.length;hi++){const si=Ut[hi];if(!ye.horizontal[si])if(Pt)ye.horizontal[si]=ye.horizontal[0];else{const Bt=Wf(xe,e,r,c,te,ri,Be,"center",si,et,Se,Sn.horizontal,!1,ot,ve,ue);Bt&&(ye.horizontal[si]=Bt,Pt=Bt.positionedLines.length===1)}}ci("left")}else{if(Mt==="auto"&&(Mt=Jf(lt)),Tt||C.get("text-writing-mode").indexOf("horizontal")>=0||!Fl(tt)){const Ut=Wf(xe,e,r,c,te,ri,Be,lt,Mt,et,Se,Sn.horizontal,!1,ot,ve,ue);Ut&&(ye.horizontal[Mt]=Ut)}ci(ot==="point"?"left":Mt)}}let qe=!1;if($.icon&&$.icon.name){const tt=s[$.icon.name];tt&&(Ee=Dv(c[$.icon.name],C.get("icon-offset").evaluate($,{},x),C.get("icon-anchor").evaluate($,{},x)),qe=tt.sdf,i.sdfIcons===void 0?i.sdfIcons=tt.sdf:i.sdfIcons!==tt.sdf&&Kt("Style sheet warning: Cannot mix SDF and non-SDF icons in one buffer"),(tt.pixelRatio!==i.pixelRatio||C.get("icon-rotate").constantOr(1)!==0)&&(i.iconsNeedLinear=!0))}const We=i_(ye.horizontal)||ye.vertical;i.iconsInText||(i.iconsInText=!!We&&We.iconsInText),(We||Ee)&&Gv(i,$,ye,Ee,s,B,ve,0,Se,qe,_,x,A)}f&&i.generateCollisionDebugBuffers(E,i.collisionBoxArray)}function Jf(i){switch(i){case"right":case"top-right":case"bottom-right":return"right";case"left":case"top-left":case"bottom-left":return"left"}return"center"}function Gv(i,e,r,s,c,f,_,x,E,A,C,L,B){let U=f.textMaxSize.evaluate(e,{},L);U===void 0&&(U=_);const N=i.layers[0].layout,$=N.get("icon-offset").evaluate(e,{},L),te=i_(r.horizontal)||r.vertical,ue=B.name==="globe",ve=_/24,ye=i.tilePixelRatio*U/24,xe=(et=i.overscaling,i.zoom>18&&et>2&&(et>>=1),Math.max(qt/(512*et),1)*N.get("symbol-spacing")),Ee=N.get("text-padding")*i.tilePixelRatio,Se=N.get("icon-padding")*i.tilePixelRatio,qe=F(N.get("text-max-angle")),We=N.get("text-rotation-alignment")==="map"&&N.get("symbol-placement")!=="point",tt=N.get("icon-rotation-alignment")==="map"&&N.get("symbol-placement")!=="point",at=N.get("symbol-placement"),Be=xe/2;var et;const lt=N.get("icon-text-fit");let ct;s&&lt!=="none"&&(i.allowVerticalPlacement&&r.vertical&&(ct=Gm(s,r.vertical,lt,N.get("icon-text-fit-padding"),$,ve)),te&&(s=Gm(s,te,lt,N.get("icon-text-fit-padding"),$,ve)));const Mt=(ot,Tt,ri)=>{if(Tt.x<0||Tt.x>=qt||Tt.y<0||Tt.y>=qt)return;let ci=null;if(ue){const{x:Ut,y:Pt,z:hi}=B.projectTilePoint(Tt.x,Tt.y,ri);ci={anchor:new ts(Ut,Pt,hi,0,void 0),up:B.upVector(ri,Tt.x,Tt.y)}}(function(Ut,Pt,hi,si,Bt,yr,sr,ir,pi,Ei,Ni,Bi,Li,Zi,Ki,Sr,tn,_i,rr,Fr,Ii,Ji,Wr,Wi,ar){const Mr=Ut.addToLineVertexArray(Pt,si);let Er,Dr,Xr,Ir,is,tc,bu,wu=0,U_=0,V_=0,N_=0,md=-1,_d=-1;const Io={};let j_=Yc("");const Fa=hi?hi.anchor:Pt;let gd=0,yd=0;if(pi._unevaluatedLayout.getValue("text-radial-offset")===void 0?[gd,yd]=pi.layout.get("text-offset").evaluate(Ii,{},ar).map(_n=>_n*Pr):(gd=pi.layout.get("text-radial-offset").evaluate(Ii,{},ar)*Pr,yd=Kf),Ut.allowVerticalPlacement&&Bt.vertical){const _n=Bt.vertical;if(Ki)tc=Qf(_n),ir&&(bu=Qf(ir));else{const gn=pi.layout.get("text-rotate").evaluate(Ii,{},ar)+90;Xr=hp(Ei,Fa,Pt,Ni,Bi,Li,_n,Zi,gn,Sr),ir&&(Ir=hp(Ei,Fa,Pt,Ni,Bi,Li,ir,_i,gn))}}if(yr){const _n=pi.layout.get("icon-rotate").evaluate(Ii,{},ar),gn=pi.layout.get("icon-text-fit")!=="none",Eu=Jm(yr,_n,Wr,gn),xd=ir?Jm(ir,_n,Wr,gn):void 0;Dr=hp(Ei,Fa,Pt,Ni,Bi,Li,yr,_i,_n),wu=4*Eu.length;const G_=Ut.iconSizeData;let Ua=null;G_.kind==="source"?(Ua=[Eo*pi.layout.get("icon-size").evaluate(Ii,{},ar)],Ua[0]>Ls&&Kt(`${Ut.layerIds[0]}: Value for "icon-size" is >= 255. Reduce your "icon-size".`)):G_.kind==="composite"&&(Ua=[Eo*Ji.compositeIconSizes[0].evaluate(Ii,{},ar),Eo*Ji.compositeIconSizes[1].evaluate(Ii,{},ar)],(Ua[0]>Ls||Ua[1]>Ls)&&Kt(`${Ut.layerIds[0]}: Value for "icon-size" is >= 255. Reduce your "icon-size".`)),Ut.addSymbols(Ut.icon,Eu,Ua,Fr,rr,Ii,!1,hi,Pt,Mr.lineStartIndex,Mr.lineLength,-1,Wi,ar),md=Ut.icon.placedSymbolArray.length-1,xd&&(U_=4*xd.length,Ut.addSymbols(Ut.icon,xd,Ua,Fr,rr,Ii,Sn.vertical,hi,Pt,Mr.lineStartIndex,Mr.lineLength,-1,Wi,ar),_d=Ut.icon.placedSymbolArray.length-1)}for(const _n in Bt.horizontal){const gn=Bt.horizontal[_n];Er||(j_=Yc(gn.text),Ki?is=Qf(gn):Er=hp(Ei,Fa,Pt,Ni,Bi,Li,gn,Zi,pi.layout.get("text-rotate").evaluate(Ii,{},ar),Sr));const Eu=gn.positionedLines.length===1;if(V_+=t_(Ut,hi,Pt,gn,sr,pi,Ki,Ii,Sr,Mr,Bt.vertical?Sn.horizontal:Sn.horizontalOnly,Eu?Object.keys(Bt.horizontal):[_n],Io,md,Ji,Wi,ar),Eu)break}Bt.vertical&&(N_+=t_(Ut,hi,Pt,Bt.vertical,sr,pi,Ki,Ii,Sr,Mr,Sn.vertical,["vertical"],Io,_d,Ji,Wi,ar));let Vs=-1;const vd=(_n,gn)=>_n?Math.max(_n,gn):gn;Vs=vd(is,Vs),Vs=vd(tc,Vs),Vs=vd(bu,Vs);const bx=Vs>-1?1:0;Ut.glyphOffsetArray.length>=Bs.MAX_GLYPHS&&Kt("Too many glyphs being rendered in a tile. See https://github.com/mapbox/mapbox-gl-js/issues/2907"),Ii.sortKey!==void 0&&Ut.addToSortKeyRanges(Ut.symbolInstances.length,Ii.sortKey),Ut.symbolInstances.emplaceBack(Fa.x,Fa.y,Fa.z,Pt.x,Pt.y,Io.right>=0?Io.right:-1,Io.center>=0?Io.center:-1,Io.left>=0?Io.left:-1,Io.vertical>=0?Io.vertical:-1,md,_d,j_,Er!==void 0?Er:Ut.collisionBoxArray.length,Er!==void 0?Er+1:Ut.collisionBoxArray.length,Xr!==void 0?Xr:Ut.collisionBoxArray.length,Xr!==void 0?Xr+1:Ut.collisionBoxArray.length,Dr!==void 0?Dr:Ut.collisionBoxArray.length,Dr!==void 0?Dr+1:Ut.collisionBoxArray.length,Ir||Ut.collisionBoxArray.length,Ir?Ir+1:Ut.collisionBoxArray.length,Ni,V_,N_,wu,U_,bx,0,gd,yd,Vs)})(i,Tt,ci,ot,r,s,c,ct,i.layers[0],i.collisionBoxArray,e.index,e.sourceLayerIndex,i.index,Ee,We,E,0,Se,tt,$,e,f,A,C,L)};if(at==="line")for(const ot of Hm(e.geometry,0,0,qt,qt)){const Tt=Rv(ot,xe,qe,r.vertical||te,s,24,ye,i.overscaling,qt);for(const ri of Tt){const ci=te;ci&&qv(i,ci.text,Be,ri)||Mt(ot,ri,L)}}else if(at==="line-center"){for(const ot of e.geometry)if(ot.length>1){const Tt=Lv(ot,qe,r.vertical||te,s,24,ye);Tt&&Mt(ot,Tt,L)}}else if(e.type==="Polygon")for(const ot of Vf(e.geometry,0)){const Tt=Uv(ot,16);Mt(ot[0],new ts(Tt.x,Tt.y,0,0,void 0),L)}else if(e.type==="LineString")for(const ot of e.geometry)Mt(ot,new ts(ot[0].x,ot[0].y,0,0,void 0),L);else if(e.type==="Point")for(const ot of e.geometry)for(const Tt of ot)Mt([Tt],new ts(Tt.x,Tt.y,0,0,void 0),L)}const Ls=32640;function t_(i,e,r,s,c,f,_,x,E,A,C,L,B,U,N,$,te){const ue=function(xe,Ee,Se,qe,We,tt,at,Be){const et=[];if(Ee.positionedLines.length===0)return et;const lt=qe.layout.get("text-rotate").evaluate(tt,{})*Math.PI/180,ct=function(ci){const Ut=ci[0],Pt=ci[1],hi=Ut*Pt;return hi>0?[Ut,-Pt]:hi<0?[-Ut,Pt]:Ut===0?[Pt,Ut]:[Pt,-Ut]}(Se);let Mt=Math.abs(Ee.top-Ee.bottom);for(const ci of Ee.positionedLines)Mt-=ci.lineOffset;const ot=Ee.positionedLines.length,Tt=Mt/ot;let ri=Ee.top-Se[1];for(let ci=0;ci<ot;++ci){const Ut=Ee.positionedLines[ci];ri=Bv(Ee,Tt,ri,ci);for(const Pt of Ut.positionedGlyphs){if(!Pt.rect)continue;const hi=Pt.rect||{};let si=4,Bt=!0,yr=1,sr=0;if(Pt.imageName){const Wi=at[Pt.imageName];if(!Wi)continue;if(Wi.sdf){Kt("SDF images are not supported in formatted text and will be ignored.");continue}Bt=!1,yr=Wi.pixelRatio,si=1/yr}const ir=(We||Be)&&Pt.vertical,pi=Pt.metrics.advance*Pt.scale/2,Ei=Pt.metrics,Ni=Pt.rect;if(Ni===null)continue;Be&&Ee.verticalizable&&(sr=Pt.imageName?pi-Pt.metrics.width*Pt.scale/2:0);const Bi=We?[Pt.x+pi,Pt.y]:[0,0];let Li=[0,0],Zi=[0,0],Ki=!1;We||(ir?(Zi=[Pt.x+pi+ct[0],Pt.y+ct[1]-sr],Ki=!0):Li=[Pt.x+pi+Se[0],Pt.y+Se[1]-sr]);const Sr=Ni.w*Pt.scale/(yr*(Pt.localGlyph?2:1)),tn=Ni.h*Pt.scale/(yr*(Pt.localGlyph?2:1));let _i,rr,Fr,Ii;if(ir){const Wi=Pt.y-ri,ar=new I(-pi,pi-Wi),Mr=-Math.PI/2,Er=new I(...Zi);_i=new I(-pi+Li[0],Li[1]),_i._rotateAround(Mr,ar)._add(Er),_i.x+=-Wi+pi,_i.y-=(Ei.left-si)*Pt.scale;const Dr=Pt.imageName?Ei.advance*Pt.scale:Pr*Pt.scale,Xr=String.fromCharCode(Pt.glyph);gv(Xr)?_i.x+=(1-si)*Pt.scale:yv(Xr)?_i.x+=Dr-Ei.height*Pt.scale+(-si-1)*Pt.scale:_i.x+=Pt.imageName||Ei.width+2*si===Ni.w&&Ei.height+2*si===Ni.h?(Dr-tn)/2:(Dr-(Ei.height+2*si)*Pt.scale)/2,rr=new I(_i.x,_i.y-Sr),Fr=new I(_i.x+tn,_i.y),Ii=new I(_i.x+tn,_i.y-Sr)}else{const Wi=(Ei.left-si)*Pt.scale-pi+Li[0],ar=(-Ei.top-si)*Pt.scale+Li[1],Mr=Wi+Sr,Er=ar+tn;_i=new I(Wi,ar),rr=new I(Mr,ar),Fr=new I(Wi,Er),Ii=new I(Mr,Er)}if(lt){let Wi;Wi=We?new I(0,0):Ki?new I(ct[0],ct[1]):new I(Se[0],Se[1]),_i._rotateAround(lt,Wi),rr._rotateAround(lt,Wi),Fr._rotateAround(lt,Wi),Ii._rotateAround(lt,Wi)}const Ji=new I(0,0),Wr=new I(0,0);et.push({tl:_i,tr:rr,bl:Fr,br:Ii,tex:hi,writingMode:Ee.writingMode,glyphOffset:Bi,sectionIndex:Pt.sectionIndex,isSDF:Bt,pixelOffsetTL:Ji,pixelOffsetBR:Wr,minFontScaleX:0,minFontScaleY:0})}}return et}(0,s,E,f,_,x,c,i.allowVerticalPlacement),ve=i.textSizeData;let ye=null;ve.kind==="source"?(ye=[Eo*f.layout.get("text-size").evaluate(x,{},te)],ye[0]>Ls&&Kt(`${i.layerIds[0]}: Value for "text-size" is >= 255. Reduce your "text-size".`)):ve.kind==="composite"&&(ye=[Eo*N.compositeTextSizes[0].evaluate(x,{},te),Eo*N.compositeTextSizes[1].evaluate(x,{},te)],(ye[0]>Ls||ye[1]>Ls)&&Kt(`${i.layerIds[0]}: Value for "text-size" is >= 255. Reduce your "text-size".`)),i.addSymbols(i.text,ue,ye,E,_,x,C,e,r,A.lineStartIndex,A.lineLength,U,$,te);for(const xe of L)B[xe]=i.text.placedSymbolArray.length-1;return 4*ue.length}function i_(i){for(const e in i)return i[e];return null}function hp(i,e,r,s,c,f,_,x,E,A){let C=_.top,L=_.bottom,B=_.left,U=_.right;const N=_.collisionPadding;if(N&&(B-=N[0],C-=N[1],U+=N[2],L+=N[3]),E){const $=new I(B,C),te=new I(U,C),ue=new I(B,L),ve=new I(U,L),ye=F(E);let xe=new I(0,0);A&&(xe=new I(A[0],A[1])),$._rotateAround(ye,xe),te._rotateAround(ye,xe),ue._rotateAround(ye,xe),ve._rotateAround(ye,xe),B=Math.min($.x,te.x,ue.x,ve.x),U=Math.max($.x,te.x,ue.x,ve.x),C=Math.min($.y,te.y,ue.y,ve.y),L=Math.max($.y,te.y,ue.y,ve.y)}return i.emplaceBack(e.x,e.y,e.z,r.x,r.y,B,C,U,L,x,s,c,f),i.length-1}function Qf(i){i.collisionPadding&&(i.top-=i.collisionPadding[1],i.bottom+=i.collisionPadding[3]);const e=i.bottom-i.top;return e>0?Math.max(10,e):null}function qv(i,e,r,s){const c=i.compareText;if(e in c){const f=c[e];for(let _=f.length-1;_>=0;_--)if(s.dist(f[_])<r)return!0}else c[e]=[];return c[e].push(s),!1}const Zv=gt([{type:"Float32",name:"a_globe_pos",components:3},{type:"Float32",name:"a_merc_pos",components:2},{type:"Float32",name:"a_uv",components:2}]),{members:r_}=Zv,n_=gt([{name:"a_pos_3",components:3,type:"Int16"}]);var fu=gt([{name:"a_pos",type:"Int16",components:2}]);const Ra=qt/Math.PI/2,ed=2*Fn(1,0)*Ra*Math.PI,Jl=[64,32,16],dn=-Ra,mn=Ra,$v=[new An([dn,dn,dn],[mn,mn,mn]),new An([dn,dn,dn],[0,0,mn]),new An([0,dn,dn],[mn,0,mn]),new An([dn,0,dn],[0,mn,mn]),new An([0,0,dn],[mn,mn,mn])];function o_(i,e,r,s=!0){const c=wo([],i._camera.position,i.worldSize),f=[e,r,1,1];Da(f,f,i.pixelMatrixInverse),im(f,f,1/f[3]);const _=qr([],Vn([],f,c)),x=i.globeMatrix,E=[x[12],x[13],x[14]],A=Vn([],E,c),C=Jc(A),L=qr([],A),B=i.worldSize/(2*Math.PI),U=Un(L,_),N=Math.asin(B/C);if(N<Math.acos(U)){if(!s)return null;const at=[],Be=[];wo(at,_,C/U),qr(Be,Vn(Be,at,A)),qr(_,Ps(_,A,wo(_,Be,Math.tan(N)*C)))}const $=[];new Pf(c,_).closestPointOnSphere(E,B,$);const te=qr([],xn(x,0)),ue=qr([],xn(x,1)),ve=qr([],xn(x,2)),ye=Un(te,$),xe=Un(ue,$),Ee=Un(ve,$),Se=q(Math.asin(-xe/B));let qe=q(Math.atan2(ye,Ee));qe=i.center.lng+function(at,Be){const et=(Be-at+180)%360-180;return et<-180?et+360:et}(i.center.lng,qe);const We=Ia(qe),tt=re(ka(Se),0,1);return new Nl(We,tt)}class Wv{constructor(e,r,s){this.a=Vn([],e,s),this.b=Vn([],r,s),this.center=s;const c=qr([],this.a),f=qr([],this.b);this.angle=Math.acos(Un(c,f))}}function td(i,e){if(i.angle===0)return null;let r;return r=i.a[e]===0?1/i.angle*.5*Math.PI:1/i.angle*Math.atan(i.b[e]/i.a[e]/Math.sin(i.angle)-1/Math.tan(i.angle)),r<0||r>1?null:function(s,c,f,_){const x=Math.sin(f);return s*(Math.sin((1-_)*f)/x)+c*(Math.sin(_*f)/x)}(i.a[e],i.b[e],i.angle,re(r,0,1))+i.center[e]}function To(i){if(i.z<=1)return $v[i.z+2*i.y+i.x];const[e,r]=id(i),s=[$r(e[0],e[1]),$r(e[0],r[1]),$r(r[0],e[1]),$r(r[0],r[1])],c=[mn,mn,mn],f=[dn,dn,dn];for(const _ of s)c[0]=Math.min(c[0],_[0]),c[1]=Math.min(c[1],_[1]),c[2]=Math.min(c[2],_[2]),f[0]=Math.max(f[0],_[0]),f[1]=Math.max(f[1],_[1]),f[2]=Math.max(f[2],_[2]);return new An(c,f)}function Xv(i,e,r){const s=e/i.worldSize,c=Number.MAX_VALUE,f=[-c,-c,-c],_=[c,c,c],x=pn(new Float64Array(16));if(bo(x,x,[s,s,s]),zs(x,x,i.globeMatrix),r.z<=1){const Be=To(r).getCorners();for(let et=0;et<Be.length;et++)zr(Be[et],Be[et],x),$h(_,_,Be[et]),Wh(f,f,Be[et]);return new An(_,f)}const[E,A]=id(r),C=new Cs;C.setSouthWest([E[1],A[0]]),C.setNorthEast([A[1],E[0]]);const L=[$r(C.getSouth(),C.getWest()),$r(C.getSouth(),C.getEast()),$r(C.getNorth(),C.getEast()),$r(C.getNorth(),C.getWest())];for(let Be=0;Be<L.length;Be++)zr(L[Be],L[Be],x),$h(_,_,L[Be]),Wh(f,f,L[Be]);if(C.contains(i.center)){f[2]=0;const Be=i.point,et=[Be.x*s,Be.y*s,0];return $h(_,_,et),Wh(f,f,et),new An(_,f)}const B=[x[12],x[13],x[14]],U=i.center.lng,N=re(i.center.lat,-85.051129,xo),$=[Ia(U),ka(N)],te=C.getCenter().lng,ue=re(C.getCenter().lat,-85.051129,xo),ve=[Ia(te),ka(ue)];let ye=new Array(3),xe=0,Ee=$[0]-ve[0];const Se=$[1]-ve[1];if(Ee>.5?Ee-=1:Ee<-.5&&(Ee+=1),Math.abs(Ee)>Math.abs(Se))xe=Ee>=0?1:3,ye=B;else{xe=Se>=0?0:2;const Be=[x[4],x[5],x[6]];let et;et=Se>=0?-Math.sin(F(C.getSouth()))*Ra:-Math.sin(F(C.getNorth()))*Ra,ye=Xh(ye,B,Be,et)}const qe=L[xe],We=L[(xe+1)%4],tt=new Wv(qe,We,ye),at=[td(tt,0)||qe[0],td(tt,1)||qe[1],td(tt,2)||qe[2]];return _[2]=Math.min(qe[2],We[2]),$h(_,_,at),Wh(f,f,at),new An(_,f)}function id(i){const e=1<<i.z,r=i.x/e,s=(i.x+1)/e,c=(i.y+1)/e;return[[gr(i.y/e),Gr(r)],[gr(c),Gr(s)]]}function s_(i,e,r,s=Ra){return r=F(r),[i*Math.sin(r)*s,-e*s,i*Math.cos(r)*s]}function $r(i,e,r){return s_(Math.cos(F(i)),Math.sin(F(i)),e,r)}function a_(i,e,r){const s=Math.pow(2,r.z),c=(i/qt+r.x)/s;return $r(gr((e/qt+r.y)/s),Gr(c))}function pp(i){return 16383/Math.max(...Vn([],i.max,i.min))}function du(i){const e=pn(new Float64Array(16)),r=pp(i);var s,c;return bo(e,e,[r,r,r]),Pa(e,e,((s=[])[0]=-(c=i.min)[0],s[1]=-c[1],s[2]=-c[2],s)),e}function l_(i){const e=pn(new Float64Array(16)),r=1/pp(i);return Pa(e,e,i.min),bo(e,e,[r,r,r]),e}function c_(i,e,r,s,c){const f=function(E){const A=qt/(2*Math.PI);return E/(2*Math.PI)/A}(r),_=[i,e,-r/(2*Math.PI)],x=pn(new Float64Array(16));return Pa(x,x,_),bo(x,x,[f,f,f]),qh(x,x,F(-c)),Zh(x,x,F(-s)),x}function rd(i){return Ae(5,6,i)}function u_(i,e){const r=$r(e.lat,e.lng);return f=(s=Cf([],function(U){const N=$r(U._center.lat,U._center.lng);let $=zf([],Gl(0,1,0),N);const te=J1([],-U.angle,N);$=zr($,$,te),J1(te,-U._pitch,$);const ue=qr([],N);return wo(ue,ue,U.cameraToCenterDistance/U.pixelsPerMeter*ed),zr(ue,ue,te),Ps([],N,ue)}(i),r))[0],_=s[1],x=s[2],E=(c=r)[0],A=c[1],C=c[2],B=(L=Math.sqrt(f*f+_*_+x*x)*Math.sqrt(E*E+A*A+C*C))&&Un(s,c)/L,Math.acos(Math.min(Math.max(B,-1),1));var s,c,f,_,x,E,A,C,L,B}const h_=F(85),Hv=Math.cos(h_),Yv=Math.sin(h_);function p_(i,e){const r=i.fovAboveCenter,s=i.elevation?i.elevation.getMinElevationBelowMSL()*e:0,c=(i._camera.position[2]*i.worldSize-s)/Math.cos(i._pitch),f=Math.sin(r)*c/Math.sin(Math.max(Math.PI/2-i._pitch-r,.01)),_=Math.sin(i._pitch)*f+c;return Math.min(1.01*_,c*(1/i._horizonShift))}function Ba(i,e){if(!e.isReprojectedInTileSpace)return{scale:1<<i.z,x:i.x,y:i.y,x2:i.x+1,y2:i.y+1,projection:e};const r=Math.pow(2,-i.z),s=i.x*r,c=(i.x+1)*r,f=i.y*r,_=(i.y+1)*r,x=Gr(s),E=Gr(c),A=gr(f),C=gr(_),L=e.project(x,A),B=e.project(E,A),U=e.project(E,C),N=e.project(x,C);let $=Math.min(L.x,B.x,U.x,N.x),te=Math.min(L.y,B.y,U.y,N.y),ue=Math.max(L.x,B.x,U.x,N.x),ve=Math.max(L.y,B.y,U.y,N.y);const ye=r/16;function xe(Se,qe,We,tt,at,Be){const et=(We+at)/2,lt=(tt+Be)/2,ct=e.project(Gr(et),gr(lt)),Mt=Math.max(0,$-ct.x,te-ct.y,ct.x-ue,ct.y-ve);$=Math.min($,ct.x),ue=Math.max(ue,ct.x),te=Math.min(te,ct.y),ve=Math.max(ve,ct.y),Mt>ye&&(xe(Se,ct,We,tt,et,lt),xe(ct,qe,et,lt,at,Be))}xe(L,B,s,f,c,f),xe(B,U,c,f,c,_),xe(U,N,c,_,s,_),xe(N,L,s,_,s,f),$-=ye,te-=ye,ue+=ye,ve+=ye;const Ee=1/Math.max(ue-$,ve-te);return{scale:Ee,x:$*Ee,y:te*Ee,x2:ue*Ee,y2:ve*Ee,projection:e}}const Kv=pn(new Float32Array(16));class Rs{constructor(e){this.spec=e,this.name=e.name,this.wrap=!1,this.requiresDraping=!1,this.supportsWorldCopies=!1,this.supportsTerrain=!1,this.supportsFog=!1,this.supportsFreeCamera=!1,this.zAxisUnit="meters",this.isReprojectedInTileSpace=!0,this.unsupportedLayers=["custom"],this.center=[0,0],this.range=[3.5,7]}project(e,r){return{x:0,y:0,z:0}}unproject(e,r){return new Di(0,0)}projectTilePoint(e,r,s){return{x:e,y:r,z:0}}locationPoint(e,r,s=!0){return e._coordinatePoint(e.locationCoordinate(r),s)}pixelsPerMeter(e,r){return Fn(1,e)*r}pixelSpaceConversion(e,r,s){return 1}farthestPixelDistance(e){return p_(e,e.pixelsPerMeter)}pointCoordinate(e,r,s,c){const f=e.horizonLineFromTop(!1),_=new I(r,Math.max(f,s));return e.rayIntersectionCoordinate(e.pointRayIntersection(_,c))}pointCoordinate3D(e,r,s){const c=new I(r,s);if(e.elevation)return e.elevation.pointCoordinate(c);{const f=this.pointCoordinate(e,c.x,c.y,0);return[f.x,f.y,f.z]}}isPointAboveHorizon(e,r){if(e.elevation)return!this.pointCoordinate3D(e,r.x,r.y);const s=e.horizonLineFromTop();return r.y<s}createInversionMatrix(e,r){return Kv}createTileMatrix(e,r,s){let c,f,_;const x=s.canonical,E=pn(new Float64Array(16));if(this.isReprojectedInTileSpace){const A=Ba(x,this);c=1,f=A.x+s.wrap*A.scale,_=A.y,bo(E,E,[c/A.scale,c/A.scale,e.pixelsPerMeter/r])}else c=r/e.zoomScale(x.z),f=(x.x+Math.pow(2,x.z)*s.wrap)*c,_=x.y*c;return Pa(E,E,[f,_,0]),bo(E,E,[c/qt,c/qt,1]),E}upVector(e,r,s){return[0,0,1]}upVectorScale(e,r,s){return{metersToTile:1}}}class Jv extends Rs{constructor(e){super(e),this.range=[4,7],this.center=e.center||[-96,37.5];const[r,s]=this.parallels=e.parallels||[29.5,45.5],c=Math.sin(F(r));this.n=(c+Math.sin(F(s)))/2,this.c=1+c*(2*this.n-c),this.r0=Math.sqrt(this.c)/this.n}project(e,r){const{n:s,c,r0:f}=this,_=F(e-this.center[0]),x=F(r),E=Math.sqrt(c-2*s*Math.sin(x))/s;return{x:E*Math.sin(_*s),y:E*Math.cos(_*s)-f,z:0}}unproject(e,r){const{n:s,c,r0:f}=this,_=f+r;let x=Math.atan2(e,Math.abs(_))*Math.sign(_);_*s<0&&(x-=Math.PI*Math.sign(e)*Math.sign(_));const E=F(this.center[0])*s;x=$e(x,-Math.PI-E,Math.PI-E);const A=q(x/s)+this.center[0],C=Math.asin(re((c-(e*e+_*_)*s*s)/(2*s),-1,1)),L=re(q(C),-85.051129,xo);return new Di(A,L)}}const mu=1.340264,_u=-.081106,gu=893e-6,yu=.003796,fp=Math.sqrt(3)/2;class Qv extends Rs{project(e,r){r=r/180*Math.PI,e=e/180*Math.PI;const s=Math.asin(fp*Math.sin(r)),c=s*s,f=c*c*c;return{x:.5*(e*Math.cos(s)/(fp*(mu+3*_u*c+f*(7*gu+9*yu*c)))/Math.PI+.5),y:1-.5*(s*(mu+_u*c+f*(gu+yu*c))/Math.PI+1),z:0}}unproject(e,r){e=(2*e-.5)*Math.PI;let s=r=(2*(1-r)-1)*Math.PI,c=s*s,f=c*c*c;for(let C,L,B,U=0;U<12&&(L=s*(mu+_u*c+f*(gu+yu*c))-r,B=mu+3*_u*c+f*(7*gu+9*yu*c),C=L/B,s=re(s-C,-Math.PI/3,Math.PI/3),c=s*s,f=c*c*c,!(Math.abs(C)<1e-12));++U);const _=fp*e*(mu+3*_u*c+f*(7*gu+9*yu*c))/Math.cos(s),x=Math.asin(Math.sin(s)/fp),E=re(180*_/Math.PI,-180,180),A=re(180*x/Math.PI,-85.051129,xo);return new Di(E,A)}}class ex extends Rs{constructor(e){super(e),this.wrap=!0,this.supportsWorldCopies=!0}project(e,r){return{x:.5+e/360,y:.5-r/360,z:0}}unproject(e,r){const s=360*(e-.5),c=re(360*(.5-r),-85.051129,xo);return new Di(s,c)}}const Ql=Math.PI/2;function dp(i){return Math.tan((Ql+i)/2)}class tx extends Rs{constructor(e){super(e),this.center=e.center||[0,30];const[r,s]=this.parallels=e.parallels||[30,30],c=F(r),f=F(s),_=Math.cos(c);this.n=c===f?Math.sin(c):Math.log(_/Math.cos(f))/Math.log(dp(f)/dp(c)),this.f=_*Math.pow(dp(c),this.n)/this.n}project(e,r){r=F(r),e=F(e-this.center[0]);const s=1e-6,{n:c,f}=this;f>0?r<-Ql+s&&(r=-Ql+s):r>Ql-s&&(r=Ql-s);const _=f/Math.pow(dp(r),c),x=_*Math.sin(c*e),E=f-_*Math.cos(c*e);return{x:.5*(x/Math.PI+.5),y:1-.5*(E/Math.PI+.5),z:0}}unproject(e,r){e=(2*e-.5)*Math.PI,r=(2*(1-r)-.5)*Math.PI;const{n:s,f:c}=this,f=c-r,_=Math.sign(f),x=Math.sign(s)*Math.sqrt(e*e+f*f);let E=Math.atan2(e,Math.abs(f))*_;f*s<0&&(E-=Math.PI*Math.sign(e)*_);const A=re(q(E/s)+this.center[0],-180,180),C=re(q(2*Math.atan(Math.pow(c/x,1/s))-Ql),-85.051129,xo);return new Di(A,C)}}class f_ extends Rs{constructor(e){super(e),this.wrap=!0,this.supportsWorldCopies=!0,this.supportsTerrain=!0,this.supportsFog=!0,this.supportsFreeCamera=!0,this.isReprojectedInTileSpace=!1,this.unsupportedLayers=[],this.range=null}project(e,r){return{x:Ia(e),y:ka(r),z:0}}unproject(e,r){const s=Gr(e),c=gr(r);return new Di(s,c)}}const d_=F(xo);class ix extends Rs{project(e,r){const s=(r=F(r))*r,c=s*s;return{x:.5*((e=F(e))*(.8707-.131979*s+c*(c*(.003971*s-.001529*c)-.013791))/Math.PI+.5),y:1-.5*(r*(1.007226+s*(.015085+c*(.028874*s-.044475-.005916*c)))/Math.PI+1),z:0}}unproject(e,r){e=(2*e-.5)*Math.PI;let s=r=(2*(1-r)-1)*Math.PI,c=25,f=0,_=s*s;do{_=s*s;const A=_*_;f=(s*(1.007226+_*(.015085+A*(.028874*_-.044475-.005916*A)))-r)/(1.007226+_*(.045255+A*(.259866*_-.311325-.005916*11*A))),s=re(s-f,-d_,d_)}while(Math.abs(f)>1e-6&&--c>0);_=s*s;const x=re(q(e/(.8707+_*(_*(_*_*_*(.003971-.001529*_)-.013791)-.131979))),-180,180),E=q(s);return new Di(x,E)}}const m_=F(xo);class rx extends Rs{project(e,r){r=F(r),e=F(e);const s=Math.cos(r),c=2/Math.PI,f=Math.acos(s*Math.cos(e/2)),_=Math.sin(f)/f,x=.5*(e*c+2*s*Math.sin(e/2)/_)||0,E=.5*(r+Math.sin(r)/_)||0;return{x:.5*(x/Math.PI+.5),y:1-.5*(E/Math.PI+1),z:0}}unproject(e,r){let s=e=(2*e-.5)*Math.PI,c=r=(2*(1-r)-1)*Math.PI,f=25;const _=1e-6;let x=0,E=0;do{const A=Math.cos(c),C=Math.sin(c),L=2*C*A,B=C*C,U=A*A,N=Math.cos(s/2),$=Math.sin(s/2),te=2*N*$,ue=$*$,ve=1-U*N*N,ye=ve?1/ve:0,xe=ve?Math.acos(A*N)*Math.sqrt(1/ve):0,Ee=.5*(2*xe*A*$+2*s/Math.PI)-e,Se=.5*(xe*C+c)-r,qe=.5*ye*(U*ue+xe*A*N*B)+1/Math.PI,We=ye*(te*L/4-xe*C*$),tt=.125*ye*(L*$-xe*C*U*te),at=.5*ye*(B*N+xe*ue*A)+.5,Be=We*tt-at*qe;x=(Se*We-Ee*at)/Be,E=(Ee*tt-Se*qe)/Be,s=re(s-x,-Math.PI,Math.PI),c=re(c-E,-m_,m_)}while((Math.abs(x)>_||Math.abs(E)>_)&&--f>0);return new Di(q(s),q(c))}}class __ extends Rs{constructor(e){super(e),this.center=e.center||[0,0],this.parallels=e.parallels||[0,0],this.cosPhi=Math.max(.01,Math.cos(F(this.parallels[0]))),this.scale=1/(2*Math.max(Math.PI*this.cosPhi,1/this.cosPhi)),this.wrap=!0,this.supportsWorldCopies=!0}project(e,r){const{scale:s,cosPhi:c}=this;return{x:F(e)*c*s+.5,y:-Math.sin(F(r))/c*s+.5,z:0}}unproject(e,r){const{scale:s,cosPhi:c}=this,f=-(r-.5)/s,_=re(q((e-.5)/s)/c,-180,180),x=Math.asin(re(f*c,-1,1)),E=re(q(x),-85.051129,xo);return new Di(_,E)}}class nx extends f_{constructor(e){super(e),this.requiresDraping=!0,this.supportsWorldCopies=!1,this.supportsFog=!0,this.zAxisUnit="pixels",this.unsupportedLayers=["debug","custom"],this.range=[3,5]}projectTilePoint(e,r,s){const c=Math.pow(2,s.z),f=(e/qt+s.x)/c,_=$r(gr((r/qt+s.y)/c),Gr(f));return zr(_,_,du(To(s))),{x:_[0],y:_[1],z:_[2]}}locationPoint(e,r){const s=$r(r.lat,r.lng),c=qr([],s),f=e.elevation?e.elevation.getAtPointOrZero(e.locationCoordinate(r),e._centerAltitude):e._centerAltitude;Xh(s,s,c,Fn(1,0)*qt*f);const _=pn(new Float64Array(16));return zs(_,e.pixelMatrix,e.globeMatrix),zr(s,s,_),new I(s[0],s[1])}pixelsPerMeter(e,r){return Fn(1,0)*r}pixelSpaceConversion(e,r,s){const c=bi(Fn(1,45)*r,Fn(1,e)*r,s);return this.pixelsPerMeter(e,r)/c}createTileMatrix(e,r,s){const c=l_(To(s.canonical));return zs(new Float64Array(16),e.globeMatrix,c)}createInversionMatrix(e,r){const{center:s}=e,c=pn(new Float64Array(16));return zs(c,c,du(To(r))),Zh(c,c,F(s.lng)),qh(c,c,F(s.lat)),bo(c,c,[e._projectionScaler,e._projectionScaler,1]),Float32Array.from(c)}pointCoordinate(e,r,s,c){return o_(e,r,s,!0)||new Nl(0,0)}pointCoordinate3D(e,r,s){const c=this.pointCoordinate(e,r,s,0);return[c.x,c.y,c.z]}isPointAboveHorizon(e,r){return!o_(e,r.x,r.y,!1)}farthestPixelDistance(e){const r=function(c,f){const _=c.cameraToCenterDistance,x=c._centerAltitude*f,E=c._camera,A=c._camera.forward(),C=Ps([],wo([],A,-_),[0,0,x]),L=c.worldSize/(2*Math.PI),B=[0,0,-L],U=c.width/c.height,N=Math.tan(c.fovAboveCenter),$=wo([],E.up(),N),te=wo([],E.right(),N*U),ue=qr([],Ps([],Ps([],A,$),te)),ve=[];let ye;if(new Pf(C,ue).closestPointOnSphere(B,L,ve)){const xe=Ps([],ve,B),Ee=Vn([],xe,C);ye=Math.cos(c.fovAboveCenter)*Jc(Ee)}else{const xe=Vn([],C,B),Ee=Vn([],B,C);qr(Ee,Ee);const Se=Jc(xe)-L;ye=Math.sqrt(Se*(Se+2*L));const qe=Math.acos(ye/(L+Se))-Math.acos(Un(A,Ee));ye*=Math.cos(qe)}return 1.01*ye}(e,this.pixelsPerMeter(e.center.lat,e.worldSize)),s=rd(e.zoom);if(s>0){const c=p_(e,Fn(1,e.center.lat)*e.worldSize),f=e.worldSize/(2*Math.PI),_=Math.max(e.width,e.height)/e.worldSize*Math.PI;return bi(r,c+f*(1-Math.cos(_)),Math.pow(s,10))}return r}upVector(e,r,s){const c=1<<e.z,f=(r/qt+e.x)/c;return $r(gr((s/qt+e.y)/c),Gr(f),1)}upVectorScale(e){return{metersToTile:ed*pp(To(e))}}}function g_(i){const e=i.parallels,r=!!e&&Math.abs(e[0]+e[1])<.01;switch(i.name){case"mercator":return new f_(i);case"equirectangular":return new ex(i);case"naturalEarth":return new ix(i);case"equalEarth":return new Qv(i);case"winkelTripel":return new rx(i);case"albers":return r?new __(i):new Jv(i);case"lambertConformalConic":return r?new __(i):new tx(i);case"globe":return new nx(i)}throw new Error(`Invalid projection name: ${i.name}`)}const ox=La.VectorTileFeature.types,sx=[{name:"a_fade_opacity",components:1,type:"Uint8",offset:0}];function mp(i,e,r,s,c,f,_,x,E,A,C,L,B){const U=x?Math.min(Ls,Math.round(x[0])):0,N=x?Math.min(Ls,Math.round(x[1])):0;i.emplaceBack(e,r,Math.round(32*s),Math.round(32*c),f,_,(U<<1)+(E?1:0),N,16*A,16*C,256*L,256*B)}function _p(i,e,r,s,c,f,_){i.emplaceBack(e,r,s,c,f,_)}function gp(i,e,r,s,c){i.emplaceBack(e,r,s,c),i.emplaceBack(e,r,s,c),i.emplaceBack(e,r,s,c),i.emplaceBack(e,r,s,c)}function ax(i){for(const e of i.sections)if(b(e.text))return!0;return!1}class nd{constructor(e){this.layoutVertexArray=new en,this.indexArray=new yi,this.programConfigurations=e,this.segments=new or,this.dynamicLayoutVertexArray=new Si,this.opacityVertexArray=new to,this.placedSymbolArray=new T1,this.globeExtVertexArray=new Bn}isEmpty(){return this.layoutVertexArray.length===0&&this.indexArray.length===0&&this.dynamicLayoutVertexArray.length===0&&this.opacityVertexArray.length===0}upload(e,r,s,c){this.isEmpty()||(s&&(this.layoutVertexBuffer=e.createVertexBuffer(this.layoutVertexArray,cv.members),this.indexBuffer=e.createIndexBuffer(this.indexArray,r),this.dynamicLayoutVertexBuffer=e.createVertexBuffer(this.dynamicLayoutVertexArray,hv.members,!0),this.opacityVertexBuffer=e.createVertexBuffer(this.opacityVertexArray,sx,!0),this.globeExtVertexArray.length>0&&(this.globeExtVertexBuffer=e.createVertexBuffer(this.globeExtVertexArray,uv.members,!0)),this.opacityVertexBuffer.itemSize=1),(s||c)&&this.programConfigurations.upload(e))}destroy(){this.layoutVertexBuffer&&(this.layoutVertexBuffer.destroy(),this.indexBuffer.destroy(),this.programConfigurations.destroy(),this.segments.destroy(),this.dynamicLayoutVertexBuffer.destroy(),this.opacityVertexBuffer.destroy(),this.globeExtVertexBuffer&&this.globeExtVertexBuffer.destroy())}}Ct(nd,"SymbolBuffers");class od{constructor(e,r,s){this.layoutVertexArray=new e,this.layoutAttributes=r,this.indexArray=new s,this.segments=new or,this.collisionVertexArray=new ur,this.collisionVertexArrayExt=new Ar}upload(e){this.layoutVertexBuffer=e.createVertexBuffer(this.layoutVertexArray,this.layoutAttributes),this.indexBuffer=e.createIndexBuffer(this.indexArray),this.collisionVertexBuffer=e.createVertexBuffer(this.collisionVertexArray,pv.members,!0),this.collisionVertexBufferExt=e.createVertexBuffer(this.collisionVertexArrayExt,fv.members,!0)}destroy(){this.layoutVertexBuffer&&(this.layoutVertexBuffer.destroy(),this.indexBuffer.destroy(),this.segments.destroy(),this.collisionVertexBuffer.destroy(),this.collisionVertexBufferExt.destroy())}}Ct(od,"CollisionBuffers");class Bs{constructor(e){this.collisionBoxArray=e.collisionBoxArray,this.zoom=e.zoom,this.overscaling=e.overscaling,this.layers=e.layers,this.layerIds=this.layers.map(_=>_.id),this.index=e.index,this.pixelRatio=e.pixelRatio,this.sourceLayerIndex=e.sourceLayerIndex,this.hasPattern=!1,this.hasRTLText=!1,this.fullyClipped=!1,this.sortKeyRanges=[],this.collisionCircleArray=[],this.placementInvProjMatrix=pn([]),this.placementViewportMatrix=pn([]);const r=this.layers[0]._unevaluatedLayout._values;this.textSizeData=Gf(this.zoom,r["text-size"]),this.iconSizeData=Gf(this.zoom,r["icon-size"]);const s=this.layers[0].layout,c=s.get("symbol-sort-key"),f=s.get("symbol-z-order");this.canOverlap=s.get("text-allow-overlap")||s.get("icon-allow-overlap")||s.get("text-ignore-placement")||s.get("icon-ignore-placement"),this.sortFeaturesByKey=f!=="viewport-y"&&c.constantOr(1)!==void 0,this.sortFeaturesByY=(f==="viewport-y"||f==="auto"&&!this.sortFeaturesByKey)&&this.canOverlap,this.writingModes=s.get("text-writing-mode").map(_=>Sn[_]),this.stateDependentLayerIds=this.layers.filter(_=>_.isStateDependent()).map(_=>_.id),this.sourceID=e.sourceID,this.projection=e.projection}createArrays(){this.text=new nd(new Ma(this.layers,this.zoom,e=>/^text/.test(e))),this.icon=new nd(new Ma(this.layers,this.zoom,e=>/^icon/.test(e))),this.glyphOffsetArray=new M1,this.lineVertexArray=new I1,this.symbolInstances=new S1}calculateGlyphDependencies(e,r,s,c,f){for(let _=0;_<e.length;_++)if(r[e.charCodeAt(_)]=!0,c&&f){const x=cu[e.charAt(_)];x&&(r[x.charCodeAt(0)]=!0)}}populate(e,r,s,c){const f=this.layers[0],_=f.layout,x=this.projection.name==="globe",E=_.get("text-font"),A=_.get("text-field"),C=_.get("icon-image"),L=(A.value.kind!=="constant"||A.value.value instanceof Cr&&!A.value.value.isEmpty()||A.value.value.toString().length>0)&&(E.value.kind!=="constant"||E.value.value.length>0),B=C.value.kind!=="constant"||!!C.value.value||Object.keys(C.parameters).length>0,U=_.get("symbol-sort-key");if(this.features=[],!L&&!B)return;const N=r.iconDependencies,$=r.glyphDependencies,te=r.availableImages,ue=new ne(this.zoom);for(const{feature:ve,id:ye,index:xe,sourceLayerIndex:Ee}of e){const Se=f._featureFilter.needGeometry,qe=Ca(ve,Se);if(!f._featureFilter.filter(ue,qe,s))continue;if(Se||(qe.geometry=Jo(ve,s,c)),x&&ve.type!==1&&s.z<=5){const Be=qe.geometry,et=1<<s.z,lt=s.x,ct=s.y,Mt=.98078528056;for(let ot=0;ot<Be.length;ot++)Be[ot]=h2(Be[ot],Tt=>Tt,(Tt,ri)=>Un($r(gr((Tt.y/qt+ct)/et),Gr((Tt.x/qt+lt)/et),1),$r(gr((ri.y/qt+ct)/et),Gr((ri.x/qt+lt)/et),1))<Mt)}let We,tt;if(L){const Be=f.getValueAndResolveTokens("text-field",qe,s,te),et=Cr.factory(Be);ax(et)&&(this.hasRTLText=!0),(!this.hasRTLText||Y()==="unavailable"||this.hasRTLText&&K.isParsed())&&(We=_v(et,f,qe))}if(B){const Be=f.getValueAndResolveTokens("icon-image",qe,s,te);tt=Be instanceof ln?Be:ln.fromString(Be)}if(!We&&!tt)continue;const at=this.sortFeaturesByKey?U.evaluate(qe,{},s):void 0;if(this.features.push({id:ye,text:We,icon:tt,index:xe,sourceLayerIndex:Ee,geometry:qe.geometry,properties:ve.properties,type:ox[ve.type],sortKey:at}),tt&&(N[tt.name]=!0),We){const Be=E.evaluate(qe,{},s).join(","),et=_.get("text-rotation-alignment")==="map"&&_.get("symbol-placement")!=="point";this.allowVerticalPlacement=this.writingModes&&this.writingModes.indexOf(Sn.vertical)>=0;for(const lt of We.sections)if(lt.image)N[lt.image.name]=!0;else{const ct=Fl(We.toString()),Mt=lt.fontStack||Be,ot=$[Mt]=$[Mt]||{};this.calculateGlyphDependencies(lt.text,ot,et,this.allowVerticalPlacement,ct)}}}_.get("symbol-placement")==="line"&&(this.features=function(ve){const ye={},xe={},Ee=[];let Se=0;function qe(Be){Ee.push(ve[Be]),Se++}function We(Be,et,lt){const ct=xe[Be];return delete xe[Be],xe[et]=ct,Ee[ct].geometry[0].pop(),Ee[ct].geometry[0]=Ee[ct].geometry[0].concat(lt[0]),ct}function tt(Be,et,lt){const ct=ye[et];return delete ye[et],ye[Be]=ct,Ee[ct].geometry[0].shift(),Ee[ct].geometry[0]=lt[0].concat(Ee[ct].geometry[0]),ct}function at(Be,et,lt){const ct=lt?et[0][et[0].length-1]:et[0][0];return`${Be}:${ct.x}:${ct.y}`}for(let Be=0;Be<ve.length;Be++){const et=ve[Be],lt=et.geometry,ct=et.text?et.text.toString():null;if(!ct){qe(Be);continue}const Mt=at(ct,lt),ot=at(ct,lt,!0);if(Mt in xe&&ot in ye&&xe[Mt]!==ye[ot]){const Tt=tt(Mt,ot,lt),ri=We(Mt,ot,Ee[Tt].geometry);delete ye[Mt],delete xe[ot],xe[at(ct,Ee[ri].geometry,!0)]=ri,Ee[Tt].geometry=null}else Mt in xe?We(Mt,ot,lt):ot in ye?tt(Mt,ot,lt):(qe(Be),ye[Mt]=Se-1,xe[ot]=Se-1)}return Ee.filter(Be=>Be.geometry)}(this.features)),this.sortFeaturesByKey&&this.features.sort((ve,ye)=>ve.sortKey-ye.sortKey)}update(e,r,s,c){this.stateDependentLayers.length&&(this.text.programConfigurations.updatePaintArrays(e,r,this.layers,s,c),this.icon.programConfigurations.updatePaintArrays(e,r,this.layers,s,c))}isEmpty(){return this.symbolInstances.length===0&&!this.hasRTLText}uploadPending(){return!this.uploaded||this.text.programConfigurations.needsUpload||this.icon.programConfigurations.needsUpload}upload(e){!this.uploaded&&this.hasDebugData()&&(this.textCollisionBox.upload(e),this.iconCollisionBox.upload(e)),this.text.upload(e,this.sortFeaturesByY,!this.uploaded,this.text.programConfigurations.needsUpload),this.icon.upload(e,this.sortFeaturesByY,!this.uploaded,this.icon.programConfigurations.needsUpload),this.uploaded=!0}destroyDebugData(){this.textCollisionBox.destroy(),this.iconCollisionBox.destroy()}getProjection(){return this.projectionInstance||(this.projectionInstance=g_(this.projection)),this.projectionInstance}destroy(){this.text.destroy(),this.icon.destroy(),this.hasDebugData()&&this.destroyDebugData()}addToLineVertexArray(e,r){const s=this.lineVertexArray.length,c=e.segment;if(c!==void 0){let f=e.dist(r[c+1]),_=e.dist(r[c]);const x={};for(let E=c+1;E<r.length;E++)x[E]={x:r[E].x,y:r[E].y,tileUnitDistanceFromAnchor:f},E<r.length-1&&(f+=r[E+1].dist(r[E]));for(let E=c||0;E>=0;E--)x[E]={x:r[E].x,y:r[E].y,tileUnitDistanceFromAnchor:_},E>0&&(_+=r[E-1].dist(r[E]));for(let E=0;E<r.length;E++){const A=x[E];this.lineVertexArray.emplaceBack(A.x,A.y,A.tileUnitDistanceFromAnchor)}}return{lineStartIndex:s,lineLength:this.lineVertexArray.length-s}}addSymbols(e,r,s,c,f,_,x,E,A,C,L,B,U,N){const $=e.indexArray,te=e.layoutVertexArray,ue=e.globeExtVertexArray,ve=e.segments.prepareSegment(4*r.length,te,$,this.canOverlap?_.sortKey:void 0),ye=this.glyphOffsetArray.length,xe=ve.vertexLength,Ee=this.allowVerticalPlacement&&x===Sn.vertical?Math.PI/2:0,Se=_.text&&_.text.sections;for(let We=0;We<r.length;We++){const{tl:tt,tr:at,bl:Be,br:et,tex:lt,pixelOffsetTL:ct,pixelOffsetBR:Mt,minFontScaleX:ot,minFontScaleY:Tt,glyphOffset:ri,isSDF:ci,sectionIndex:Ut}=r[We],Pt=ve.vertexLength,hi=ri[1];if(mp(te,A.x,A.y,tt.x,hi+tt.y,lt.x,lt.y,s,ci,ct.x,ct.y,ot,Tt),mp(te,A.x,A.y,at.x,hi+at.y,lt.x+lt.w,lt.y,s,ci,Mt.x,ct.y,ot,Tt),mp(te,A.x,A.y,Be.x,hi+Be.y,lt.x,lt.y+lt.h,s,ci,ct.x,Mt.y,ot,Tt),mp(te,A.x,A.y,et.x,hi+et.y,lt.x+lt.w,lt.y+lt.h,s,ci,Mt.x,Mt.y,ot,Tt),E){const si=E.anchor,Bt=E.up;_p(ue,si.x,si.y,si.z,Bt[0],Bt[1],Bt[2]),_p(ue,si.x,si.y,si.z,Bt[0],Bt[1],Bt[2]),_p(ue,si.x,si.y,si.z,Bt[0],Bt[1],Bt[2]),_p(ue,si.x,si.y,si.z,Bt[0],Bt[1],Bt[2]),gp(e.dynamicLayoutVertexArray,si.x,si.y,si.z,Ee)}else gp(e.dynamicLayoutVertexArray,A.x,A.y,A.z,Ee);$.emplaceBack(Pt,Pt+1,Pt+2),$.emplaceBack(Pt+1,Pt+2,Pt+3),ve.vertexLength+=4,ve.primitiveLength+=2,this.glyphOffsetArray.emplaceBack(ri[0]),We!==r.length-1&&Ut===r[We+1].sectionIndex||e.programConfigurations.populatePaintArrays(te.length,_,_.index,{},U,N,Se&&Se[Ut])}const qe=E?E.anchor:A;e.placedSymbolArray.emplaceBack(qe.x,qe.y,qe.z,A.x,A.y,ye,this.glyphOffsetArray.length-ye,xe,C,L,A.segment,s?s[0]:0,s?s[1]:0,c[0],c[1],x,0,!1,0,B,0)}_commitLayoutVertex(e,r,s,c,f,_,x){e.emplaceBack(r,s,c,f,_,Math.round(x.x),Math.round(x.y))}_addCollisionDebugVertices(e,r,s,c,f,_,x){const E=s.segments.prepareSegment(4,s.layoutVertexArray,s.indexArray),A=E.vertexLength,C=x.tileAnchorX,L=x.tileAnchorY;for(let U=0;U<4;U++)s.collisionVertexArray.emplaceBack(0,0,0,0);s.collisionVertexArrayExt.emplaceBack(r,-e.padding,-e.padding),s.collisionVertexArrayExt.emplaceBack(r,e.padding,-e.padding),s.collisionVertexArrayExt.emplaceBack(r,e.padding,e.padding),s.collisionVertexArrayExt.emplaceBack(r,-e.padding,e.padding),this._commitLayoutVertex(s.layoutVertexArray,c,f,_,C,L,new I(e.x1,e.y1)),this._commitLayoutVertex(s.layoutVertexArray,c,f,_,C,L,new I(e.x2,e.y1)),this._commitLayoutVertex(s.layoutVertexArray,c,f,_,C,L,new I(e.x2,e.y2)),this._commitLayoutVertex(s.layoutVertexArray,c,f,_,C,L,new I(e.x1,e.y2)),E.vertexLength+=4;const B=s.indexArray;B.emplaceBack(A,A+1),B.emplaceBack(A+1,A+2),B.emplaceBack(A+2,A+3),B.emplaceBack(A+3,A),E.primitiveLength+=4}_addTextDebugCollisionBoxes(e,r,s,c,f,_){for(let x=c;x<f;x++){const E=s.get(x),A=this.getSymbolInstanceTextSize(e,_,r,x);this._addCollisionDebugVertices(E,A,this.textCollisionBox,E.projectedAnchorX,E.projectedAnchorY,E.projectedAnchorZ,_)}}_addIconDebugCollisionBoxes(e,r,s,c,f,_){for(let x=c;x<f;x++){const E=s.get(x),A=this.getSymbolInstanceIconSize(e,r,x);this._addCollisionDebugVertices(E,A,this.iconCollisionBox,E.projectedAnchorX,E.projectedAnchorY,E.projectedAnchorZ,_)}}generateCollisionDebugBuffers(e,r){this.hasDebugData()&&this.destroyDebugData(),this.textCollisionBox=new od($i,Cm.members,hr),this.iconCollisionBox=new od($i,Cm.members,hr);const s=$l(this.iconSizeData,e),c=$l(this.textSizeData,e);for(let f=0;f<this.symbolInstances.length;f++){const _=this.symbolInstances.get(f);this._addTextDebugCollisionBoxes(c,e,r,_.textBoxStartIndex,_.textBoxEndIndex,_),this._addTextDebugCollisionBoxes(c,e,r,_.verticalTextBoxStartIndex,_.verticalTextBoxEndIndex,_),this._addIconDebugCollisionBoxes(s,e,r,_.iconBoxStartIndex,_.iconBoxEndIndex,_),this._addIconDebugCollisionBoxes(s,e,r,_.verticalIconBoxStartIndex,_.verticalIconBoxEndIndex,_)}}getSymbolInstanceTextSize(e,r,s,c){const f=this.text.placedSymbolArray.get(r.rightJustifiedTextSymbolIndex>=0?r.rightJustifiedTextSymbolIndex:r.centerJustifiedTextSymbolIndex>=0?r.centerJustifiedTextSymbolIndex:r.leftJustifiedTextSymbolIndex>=0?r.leftJustifiedTextSymbolIndex:r.verticalPlacedTextSymbolIndex>=0?r.verticalPlacedTextSymbolIndex:c),_=op(this.textSizeData,e,f)/Pr;return this.tilePixelRatio*_}getSymbolInstanceIconSize(e,r,s){const c=this.icon.placedSymbolArray.get(s),f=op(this.iconSizeData,e,c);return this.tilePixelRatio*f}_commitDebugCollisionVertexUpdate(e,r,s){e.emplaceBack(r,-s,-s),e.emplaceBack(r,s,-s),e.emplaceBack(r,s,s),e.emplaceBack(r,-s,s)}_updateTextDebugCollisionBoxes(e,r,s,c,f,_){for(let x=c;x<f;x++){const E=s.get(x),A=this.getSymbolInstanceTextSize(e,_,r,x);this._commitDebugCollisionVertexUpdate(this.textCollisionBox.collisionVertexArrayExt,A,E.padding)}}_updateIconDebugCollisionBoxes(e,r,s,c,f){for(let _=c;_<f;_++){const x=s.get(_),E=this.getSymbolInstanceIconSize(e,r,_);this._commitDebugCollisionVertexUpdate(this.iconCollisionBox.collisionVertexArrayExt,E,x.padding)}}updateCollisionDebugBuffers(e,r){if(!this.hasDebugData())return;this.hasTextCollisionBoxData()&&this.textCollisionBox.collisionVertexArrayExt.clear(),this.hasIconCollisionBoxData()&&this.iconCollisionBox.collisionVertexArrayExt.clear();const s=$l(this.iconSizeData,e),c=$l(this.textSizeData,e);for(let f=0;f<this.symbolInstances.length;f++){const _=this.symbolInstances.get(f);this._updateTextDebugCollisionBoxes(c,e,r,_.textBoxStartIndex,_.textBoxEndIndex,_),this._updateTextDebugCollisionBoxes(c,e,r,_.verticalTextBoxStartIndex,_.verticalTextBoxEndIndex,_),this._updateIconDebugCollisionBoxes(s,e,r,_.iconBoxStartIndex,_.iconBoxEndIndex),this._updateIconDebugCollisionBoxes(s,e,r,_.verticalIconBoxStartIndex,_.verticalIconBoxEndIndex)}this.hasTextCollisionBoxData()&&this.textCollisionBox.collisionVertexBufferExt&&this.textCollisionBox.collisionVertexBufferExt.updateData(this.textCollisionBox.collisionVertexArrayExt),this.hasIconCollisionBoxData()&&this.iconCollisionBox.collisionVertexBufferExt&&this.iconCollisionBox.collisionVertexBufferExt.updateData(this.iconCollisionBox.collisionVertexArrayExt)}_deserializeCollisionBoxesForSymbol(e,r,s,c,f,_,x,E,A){const C={};for(let L=r;L<s;L++){const B=e.get(L);C.textBox={x1:B.x1,y1:B.y1,x2:B.x2,y2:B.y2,padding:B.padding,projectedAnchorX:B.projectedAnchorX,projectedAnchorY:B.projectedAnchorY,projectedAnchorZ:B.projectedAnchorZ,tileAnchorX:B.tileAnchorX,tileAnchorY:B.tileAnchorY},C.textFeatureIndex=B.featureIndex;break}for(let L=c;L<f;L++){const B=e.get(L);C.verticalTextBox={x1:B.x1,y1:B.y1,x2:B.x2,y2:B.y2,padding:B.padding,projectedAnchorX:B.projectedAnchorX,projectedAnchorY:B.projectedAnchorY,projectedAnchorZ:B.projectedAnchorZ,tileAnchorX:B.tileAnchorX,tileAnchorY:B.tileAnchorY},C.verticalTextFeatureIndex=B.featureIndex;break}for(let L=_;L<x;L++){const B=e.get(L);C.iconBox={x1:B.x1,y1:B.y1,x2:B.x2,y2:B.y2,padding:B.padding,projectedAnchorX:B.projectedAnchorX,projectedAnchorY:B.projectedAnchorY,projectedAnchorZ:B.projectedAnchorZ,tileAnchorX:B.tileAnchorX,tileAnchorY:B.tileAnchorY},C.iconFeatureIndex=B.featureIndex;break}for(let L=E;L<A;L++){const B=e.get(L);C.verticalIconBox={x1:B.x1,y1:B.y1,x2:B.x2,y2:B.y2,padding:B.padding,projectedAnchorX:B.projectedAnchorX,projectedAnchorY:B.projectedAnchorY,projectedAnchorZ:B.projectedAnchorZ,tileAnchorX:B.tileAnchorX,tileAnchorY:B.tileAnchorY},C.verticalIconFeatureIndex=B.featureIndex;break}return C}deserializeCollisionBoxes(e){this.collisionArrays=[];for(let r=0;r<this.symbolInstances.length;r++){const s=this.symbolInstances.get(r);this.collisionArrays.push(this._deserializeCollisionBoxesForSymbol(e,s.textBoxStartIndex,s.textBoxEndIndex,s.verticalTextBoxStartIndex,s.verticalTextBoxEndIndex,s.iconBoxStartIndex,s.iconBoxEndIndex,s.verticalIconBoxStartIndex,s.verticalIconBoxEndIndex))}}hasTextData(){return this.text.segments.get().length>0}hasIconData(){return this.icon.segments.get().length>0}hasDebugData(){return this.textCollisionBox&&this.iconCollisionBox}hasTextCollisionBoxData(){return this.hasDebugData()&&this.textCollisionBox.segments.get().length>0}hasIconCollisionBoxData(){return this.hasDebugData()&&this.iconCollisionBox.segments.get().length>0}addIndicesForPlacedSymbol(e,r){const s=e.placedSymbolArray.get(r),c=s.vertexStartIndex+4*s.numGlyphs;for(let f=s.vertexStartIndex;f<c;f+=4)e.indexArray.emplaceBack(f,f+1,f+2),e.indexArray.emplaceBack(f+1,f+2,f+3)}getSortedSymbolIndexes(e){if(this.sortedAngle===e&&this.symbolInstanceIndexes!==void 0)return this.symbolInstanceIndexes;const r=Math.sin(e),s=Math.cos(e),c=[],f=[],_=[];for(let x=0;x<this.symbolInstances.length;++x){_.push(x);const E=this.symbolInstances.get(x);c.push(0|Math.round(r*E.tileAnchorX+s*E.tileAnchorY)),f.push(E.featureIndex)}return _.sort((x,E)=>c[x]-c[E]||f[E]-f[x]),_}addToSortKeyRanges(e,r){const s=this.sortKeyRanges[this.sortKeyRanges.length-1];s&&s.sortKey===r?s.symbolInstanceEnd=e+1:this.sortKeyRanges.push({sortKey:r,symbolInstanceStart:e,symbolInstanceEnd:e+1})}sortFeatures(e){if(this.sortFeaturesByY&&this.sortedAngle!==e&&!(this.text.segments.get().length>1||this.icon.segments.get().length>1)){this.symbolInstanceIndexes=this.getSortedSymbolIndexes(e),this.sortedAngle=e,this.text.indexArray.clear(),this.icon.indexArray.clear(),this.featureSortOrder=[];for(const r of this.symbolInstanceIndexes){const s=this.symbolInstances.get(r);this.featureSortOrder.push(s.featureIndex),[s.rightJustifiedTextSymbolIndex,s.centerJustifiedTextSymbolIndex,s.leftJustifiedTextSymbolIndex].forEach((c,f,_)=>{c>=0&&_.indexOf(c)===f&&this.addIndicesForPlacedSymbol(this.text,c)}),s.verticalPlacedTextSymbolIndex>=0&&this.addIndicesForPlacedSymbol(this.text,s.verticalPlacedTextSymbolIndex),s.placedIconSymbolIndex>=0&&this.addIndicesForPlacedSymbol(this.icon,s.placedIconSymbolIndex),s.verticalPlacedIconSymbolIndex>=0&&this.addIndicesForPlacedSymbol(this.icon,s.verticalPlacedIconSymbolIndex)}this.text.indexBuffer&&this.text.indexBuffer.updateData(this.text.indexArray),this.icon.indexBuffer&&this.icon.indexBuffer.updateData(this.icon.indexArray)}}}Ct(Bs,"SymbolBucket",{omit:["layers","collisionBoxArray","features","compareText"]}),Bs.MAX_GLYPHS=65535,Bs.addDynamicAttributes=gp;const lx=new Ke({"symbol-placement":new Ue(ke.layout_symbol["symbol-placement"]),"symbol-spacing":new Ue(ke.layout_symbol["symbol-spacing"]),"symbol-avoid-edges":new Ue(ke.layout_symbol["symbol-avoid-edges"]),"symbol-sort-key":new _e(ke.layout_symbol["symbol-sort-key"]),"symbol-z-order":new Ue(ke.layout_symbol["symbol-z-order"]),"icon-allow-overlap":new Ue(ke.layout_symbol["icon-allow-overlap"]),"icon-ignore-placement":new Ue(ke.layout_symbol["icon-ignore-placement"]),"icon-optional":new Ue(ke.layout_symbol["icon-optional"]),"icon-rotation-alignment":new Ue(ke.layout_symbol["icon-rotation-alignment"]),"icon-size":new _e(ke.layout_symbol["icon-size"]),"icon-text-fit":new Ue(ke.layout_symbol["icon-text-fit"]),"icon-text-fit-padding":new Ue(ke.layout_symbol["icon-text-fit-padding"]),"icon-image":new _e(ke.layout_symbol["icon-image"]),"icon-rotate":new _e(ke.layout_symbol["icon-rotate"]),"icon-padding":new Ue(ke.layout_symbol["icon-padding"]),"icon-keep-upright":new Ue(ke.layout_symbol["icon-keep-upright"]),"icon-offset":new _e(ke.layout_symbol["icon-offset"]),"icon-anchor":new _e(ke.layout_symbol["icon-anchor"]),"icon-pitch-alignment":new Ue(ke.layout_symbol["icon-pitch-alignment"]),"text-pitch-alignment":new Ue(ke.layout_symbol["text-pitch-alignment"]),"text-rotation-alignment":new Ue(ke.layout_symbol["text-rotation-alignment"]),"text-field":new _e(ke.layout_symbol["text-field"]),"text-font":new _e(ke.layout_symbol["text-font"]),"text-size":new _e(ke.layout_symbol["text-size"]),"text-max-width":new _e(ke.layout_symbol["text-max-width"]),"text-line-height":new _e(ke.layout_symbol["text-line-height"]),"text-letter-spacing":new _e(ke.layout_symbol["text-letter-spacing"]),"text-justify":new _e(ke.layout_symbol["text-justify"]),"text-radial-offset":new _e(ke.layout_symbol["text-radial-offset"]),"text-variable-anchor":new Ue(ke.layout_symbol["text-variable-anchor"]),"text-anchor":new _e(ke.layout_symbol["text-anchor"]),"text-max-angle":new Ue(ke.layout_symbol["text-max-angle"]),"text-writing-mode":new Ue(ke.layout_symbol["text-writing-mode"]),"text-rotate":new _e(ke.layout_symbol["text-rotate"]),"text-padding":new Ue(ke.layout_symbol["text-padding"]),"text-keep-upright":new Ue(ke.layout_symbol["text-keep-upright"]),"text-transform":new _e(ke.layout_symbol["text-transform"]),"text-offset":new _e(ke.layout_symbol["text-offset"]),"text-allow-overlap":new Ue(ke.layout_symbol["text-allow-overlap"]),"text-ignore-placement":new Ue(ke.layout_symbol["text-ignore-placement"]),"text-optional":new Ue(ke.layout_symbol["text-optional"])});var sd={paint:new Ke({"icon-opacity":new _e(ke.paint_symbol["icon-opacity"]),"icon-color":new _e(ke.paint_symbol["icon-color"]),"icon-halo-color":new _e(ke.paint_symbol["icon-halo-color"]),"icon-halo-width":new _e(ke.paint_symbol["icon-halo-width"]),"icon-halo-blur":new _e(ke.paint_symbol["icon-halo-blur"]),"icon-translate":new Ue(ke.paint_symbol["icon-translate"]),"icon-translate-anchor":new Ue(ke.paint_symbol["icon-translate-anchor"]),"text-opacity":new _e(ke.paint_symbol["text-opacity"]),"text-color":new _e(ke.paint_symbol["text-color"],{runtimeType:bn,getOverride:i=>i.textColor,hasOverride:i=>!!i.textColor}),"text-halo-color":new _e(ke.paint_symbol["text-halo-color"]),"text-halo-width":new _e(ke.paint_symbol["text-halo-width"]),"text-halo-blur":new _e(ke.paint_symbol["text-halo-blur"]),"text-translate":new Ue(ke.paint_symbol["text-translate"]),"text-translate-anchor":new Ue(ke.paint_symbol["text-translate-anchor"])}),layout:lx};class y_{constructor(e){this.type=e.property.overrides?e.property.overrides.runtimeType:ia,this.defaultValue=e}evaluate(e){if(e.formattedSection){const r=this.defaultValue.property.overrides;if(r&&r.hasOverride(e.formattedSection))return r.getOverride(e.formattedSection)}return e.feature&&e.featureState?this.defaultValue.evaluate(e.feature,e.featureState):this.defaultValue.property.specification.default}eachChild(e){this.defaultValue.isConstant()||e(this.defaultValue.value._styleExpression.expression)}outputDefined(){return!1}serialize(){return null}}Ct(y_,"FormatSectionOverride",{omit:["defaultValue"]});class yp extends no{constructor(e){super(e,sd)}recalculate(e,r){super.recalculate(e,r),this.layout.get("icon-rotation-alignment")==="auto"&&(this.layout._values["icon-rotation-alignment"]=this.layout.get("symbol-placement")!=="point"?"map":"viewport"),this.layout.get("text-rotation-alignment")==="auto"&&(this.layout._values["text-rotation-alignment"]=this.layout.get("symbol-placement")!=="point"?"map":"viewport"),this.layout.get("text-pitch-alignment")==="auto"&&(this.layout._values["text-pitch-alignment"]=this.layout.get("text-rotation-alignment")),this.layout.get("icon-pitch-alignment")==="auto"&&(this.layout._values["icon-pitch-alignment"]=this.layout.get("icon-rotation-alignment"));const s=this.layout.get("text-writing-mode");if(s){const c=[];for(const f of s)c.indexOf(f)<0&&c.push(f);this.layout._values["text-writing-mode"]=c}else this.layout._values["text-writing-mode"]=this.layout.get("symbol-placement")==="point"?["horizontal"]:["horizontal","vertical"];this._setPaintOverrides()}getValueAndResolveTokens(e,r,s,c){const f=this.layout.get(e).evaluate(r,{},s,c),_=this._unevaluatedLayout._values[e];return _.isDataDriven()||wl(_.value)||!f?f:function(x,E){return E.replace(/{([^{}]+)}/g,(A,C)=>C in x?String(x[C]):"")}(r.properties,f)}createBucket(e){return new Bs(e)}queryRadius(){return 0}queryIntersectsFeature(){return!1}_setPaintOverrides(){for(const e of sd.paint.overridableProperties){if(!yp.hasPaintOverride(this.layout,e))continue;const r=this.paint.get(e),s=new y_(r),c=new bl(s,r.property.specification);let f=null;f=r.value.kind==="constant"||r.value.kind==="source"?new El("source",c):new _a("composite",c,r.value.zoomStops,r.value._interpolationType),this.paint._values[e]=new Ze(r.property,f,r.parameters)}}_handleOverridablePaintPropertyUpdate(e,r,s){return!(!this.layout||r.isDataDriven()||s.isDataDriven())&&yp.hasPaintOverride(this.layout,e)}static hasPaintOverride(e,r){const s=e.get("text-field"),c=sd.paint.properties[r];let f=!1;const _=x=>{for(const E of x)if(c.overrides&&c.overrides.hasOverride(E))return void(f=!0)};if(s.value.kind==="constant"&&s.value.value instanceof Cr)_(s.value.value.sections);else if(s.value.kind==="source"){const x=A=>{f||(A instanceof oa&&Qi(A.value)===cs?_(A.value.sections):A instanceof go?_(A.sections):A.eachChild(x))},E=s.value;E._styleExpression&&x(E._styleExpression.expression)}return f}getProgramConfiguration(e){return new ks(this,e)}}var cx={paint:new Ke({"background-color":new Ue(ke.paint_background["background-color"]),"background-pattern":new it(ke.paint_background["background-pattern"]),"background-opacity":new Ue(ke.paint_background["background-opacity"])})},ux={paint:new Ke({"raster-opacity":new Ue(ke.paint_raster["raster-opacity"]),"raster-hue-rotate":new Ue(ke.paint_raster["raster-hue-rotate"]),"raster-brightness-min":new Ue(ke.paint_raster["raster-brightness-min"]),"raster-brightness-max":new Ue(ke.paint_raster["raster-brightness-max"]),"raster-saturation":new Ue(ke.paint_raster["raster-saturation"]),"raster-contrast":new Ue(ke.paint_raster["raster-contrast"]),"raster-resampling":new Ue(ke.paint_raster["raster-resampling"]),"raster-fade-duration":new Ue(ke.paint_raster["raster-fade-duration"])})};class hx extends no{constructor(e){super(e,{}),this.implementation=e}is3D(){return this.implementation.renderingMode==="3d"}hasOffscreenPass(){return this.implementation.prerender!==void 0}recalculate(){}updateTransitions(){}hasTransition(){return!1}serialize(){}onAdd(e){this.implementation.onAdd&&this.implementation.onAdd(e,e.painter.context.gl)}onRemove(e){this.implementation.onRemove&&this.implementation.onRemove(e,e.painter.context.gl)}}var px={paint:new Ke({"sky-type":new Ue(ke.paint_sky["sky-type"]),"sky-atmosphere-sun":new Ue(ke.paint_sky["sky-atmosphere-sun"]),"sky-atmosphere-sun-intensity":new Ue(ke.paint_sky["sky-atmosphere-sun-intensity"]),"sky-gradient-center":new Ue(ke.paint_sky["sky-gradient-center"]),"sky-gradient-radius":new Ue(ke.paint_sky["sky-gradient-radius"]),"sky-gradient":new Et(ke.paint_sky["sky-gradient"]),"sky-atmosphere-halo-color":new Ue(ke.paint_sky["sky-atmosphere-halo-color"]),"sky-atmosphere-color":new Ue(ke.paint_sky["sky-atmosphere-color"]),"sky-opacity":new Ue(ke.paint_sky["sky-opacity"])})};function ad(i,e,r){const s=[0,0,1],c=nm([]);return sm(c,c,r?-F(i)+Math.PI:F(i)),om(c,c,-F(e)),tm(s,s,c),qr(s,s)}const fx={circle:class extends no{constructor(i){super(i,y2)}createBucket(i){return new Sf(i)}queryRadius(i){const e=i;return jl("circle-radius",this,e)+jl("circle-stroke-width",this,e)+jh(this.paint.get("circle-translate"))}queryIntersectsFeature(i,e,r,s,c,f,_,x){const E=Y1(this.paint.get("circle-translate"),this.paint.get("circle-translate-anchor"),f.angle,i.pixelToTileUnitsFactor),A=this.paint.get("circle-radius").evaluate(e,r)+this.paint.get("circle-stroke-width").evaluate(e,r);return am(i,s,f,_,x,this.paint.get("circle-pitch-alignment")==="map",this.paint.get("circle-pitch-scale")==="map",E,A)}getProgramIds(){return["circle"]}getProgramConfiguration(i){return new ks(this,i)}},heatmap:class extends no{createBucket(i){return new cm(i)}constructor(i){super(i,A2),this._updateColorRamp()}_handleSpecialPaintPropertyUpdate(i){i==="heatmap-color"&&this._updateColorRamp()}_updateColorRamp(){this.colorRamp=Bf({expression:this._transitionablePaint._values["heatmap-color"].value.expression,evaluationKey:"heatmapDensity",image:this.colorRamp}),this.colorRampTexture=null}resize(){this.heatmapFbo&&(this.heatmapFbo.destroy(),this.heatmapFbo=null)}queryRadius(i){return jl("heatmap-radius",this,i)}queryIntersectsFeature(i,e,r,s,c,f,_,x){const E=this.paint.get("heatmap-radius").evaluate(e,r);return am(i,s,f,_,x,!0,!0,new I(0,0),E)}hasOffscreenPass(){return this.paint.get("heatmap-opacity")!==0&&this.visibility!=="none"}getProgramIds(){return["heatmap","heatmapTexture"]}getProgramConfiguration(i){return new ks(this,i)}},hillshade:class extends no{constructor(i){super(i,S2)}hasOffscreenPass(){return this.paint.get("hillshade-exaggeration")!==0&&this.visibility!=="none"}getProgramIds(){return["hillshade","hillshadePrepare"]}},fill:class extends no{constructor(i){super(i,G2)}getProgramIds(){const i=this.paint.get("fill-pattern"),e=i&&i.constantOr(1),r=[e?"fillPattern":"fill"];return this.paint.get("fill-antialias")&&r.push(e&&!this.getPaintProperty("fill-outline-color")?"fillOutlinePattern":"fillOutline"),r}getProgramConfiguration(i){return new ks(this,i)}recalculate(i,e){super.recalculate(i,e);const r=this.paint._values["fill-outline-color"];r.value.kind==="constant"&&r.value.value===void 0&&(this.paint._values["fill-outline-color"]=this.paint._values["fill-color"])}createBucket(i){return new ep(i)}queryRadius(){return jh(this.paint.get("fill-translate"))}queryIntersectsFeature(i,e,r,s,c,f){return!i.queryGeometry.isAboveHorizon&&Z1(H1(i.tilespaceGeometry,this.paint.get("fill-translate"),this.paint.get("fill-translate-anchor"),f.angle,i.pixelToTileUnitsFactor),s)}isTileClipped(){return!0}},"fill-extrusion":class extends no{constructor(i){super(i,tv)}createBucket(i){return new su(i)}queryRadius(){return jh(this.paint.get("fill-extrusion-translate"))}is3D(){return!0}getProgramIds(){return[this.paint.get("fill-extrusion-pattern").constantOr(1)?"fillExtrusionPattern":"fillExtrusion"]}getProgramConfiguration(i){return new ks(this,i)}queryIntersectsFeature(i,e,r,s,c,f,_,x,E){const A=Y1(this.paint.get("fill-extrusion-translate"),this.paint.get("fill-extrusion-translate-anchor"),f.angle,i.pixelToTileUnitsFactor),C=this.paint.get("fill-extrusion-height").evaluate(e,r),L=this.paint.get("fill-extrusion-base").evaluate(e,r),B=[0,0],U=x&&f.elevation,N=f.elevation?f.elevation.exaggeration():1,$=i.tile.getBucket(this);if(U&&$ instanceof su){const ve=$.centroidVertexArray,ye=E+1;if(ye<ve.length){const xe=ve.get(ye);B[0]=xe.a_centroid_pos0,B[1]=xe.a_centroid_pos1}}if(B[0]===0&&B[1]===1)return!1;f.projection.name==="globe"&&(s=wm([s],[new I(0,0),new I(qt,qt)],i.tileID.canonical).map(ve=>ve.polygon).flat());const te=function(ve,ye,xe,Ee,Se,qe,We,tt,at,Be,et){return ve.projection.name==="globe"?function(lt,ct,Mt,ot,Tt,ri,ci,Ut,Pt,hi,si){const Bt=[],yr=[],sr=lt.projection.upVectorScale(si,lt.center.lat,lt.worldSize).metersToTile,ir=[0,0,0,1],pi=[0,0,0,1],Ei=(Bi,Li,Zi,Ki)=>{Bi[0]=Li,Bi[1]=Zi,Bi[2]=Ki,Bi[3]=1},Ni=bm();Mt>0&&(Mt+=Ni),ot+=Ni;for(const Bi of ct){const Li=[],Zi=[];for(const Ki of Bi){const Sr=Ki.x+Tt.x,tn=Ki.y+Tt.y,_i=lt.projection.projectTilePoint(Sr,tn,si),rr=lt.projection.upVector(si,Ki.x,Ki.y);let Fr=Mt,Ii=ot;if(ci){const Ji=Sm(Sr,tn,Mt,ot,ci,Ut,Pt,hi);Fr+=Ji.base,Ii+=Ji.top}Mt!==0?Ei(ir,_i.x+rr[0]*sr*Fr,_i.y+rr[1]*sr*Fr,_i.z+rr[2]*sr*Fr):Ei(ir,_i.x,_i.y,_i.z),Ei(pi,_i.x+rr[0]*sr*Ii,_i.y+rr[1]*sr*Ii,_i.z+rr[2]*sr*Ii),zr(ir,ir,ri),zr(pi,pi,ri),Li.push(rp(ir)),Zi.push(rp(pi))}Bt.push(Li),yr.push(Zi)}return[Bt,yr]}(ve,ye,xe,Ee,Se,qe,We,tt,at,Be,et):We?function(lt,ct,Mt,ot,Tt,ri,ci,Ut,Pt){const hi=[],si=[],Bt=[0,0,0,1];for(const yr of lt){const sr=[],ir=[];for(const pi of yr){const Ei=pi.x+ot.x,Ni=pi.y+ot.y,Bi=Sm(Ei,Ni,ct,Mt,ri,ci,Ut,Pt);Bt[0]=Ei,Bt[1]=Ni,Bt[2]=Bi.base,Bt[3]=1,Da(Bt,Bt,Tt),Bt[3]=Math.max(Bt[3],1e-5);const Li=rp([Bt[0]/Bt[3],Bt[1]/Bt[3],Bt[2]/Bt[3]]);Bt[0]=Ei,Bt[1]=Ni,Bt[2]=Bi.top,Bt[3]=1,Da(Bt,Bt,Tt),Bt[3]=Math.max(Bt[3],1e-5);const Zi=rp([Bt[0]/Bt[3],Bt[1]/Bt[3],Bt[2]/Bt[3]]);sr.push(Li),ir.push(Zi)}hi.push(sr),si.push(ir)}return[hi,si]}(ye,xe,Ee,Se,qe,We,tt,at,Be):function(lt,ct,Mt,ot,Tt){const ri=[],ci=[],Ut=Tt[8]*ct,Pt=Tt[9]*ct,hi=Tt[10]*ct,si=Tt[11]*ct,Bt=Tt[8]*Mt,yr=Tt[9]*Mt,sr=Tt[10]*Mt,ir=Tt[11]*Mt;for(const pi of lt){const Ei=[],Ni=[];for(const Bi of pi){const Li=Bi.x+ot.x,Zi=Bi.y+ot.y,Ki=Tt[0]*Li+Tt[4]*Zi+Tt[12],Sr=Tt[1]*Li+Tt[5]*Zi+Tt[13],tn=Tt[2]*Li+Tt[6]*Zi+Tt[14],_i=Tt[3]*Li+Tt[7]*Zi+Tt[15],rr=Ki+Ut,Fr=Sr+Pt,Ii=tn+hi,Ji=Math.max(_i+si,1e-5),Wr=Ki+Bt,Wi=Sr+yr,ar=tn+sr,Mr=Math.max(_i+ir,1e-5),Er=new I(rr/Ji,Fr/Ji);Er.z=Ii/Ji,Ei.push(Er);const Dr=new I(Wr/Mr,Wi/Mr);Dr.z=ar/Mr,Ni.push(Dr)}ri.push(Ei),ci.push(Ni)}return[ri,ci]}(ye,xe,Ee,Se,qe)}(f,s,L,C,A,_,U?x:null,B,N,f.center.lat,i.tileID.canonical),ue=i.queryGeometry;return function(ve,ye,xe){let Ee=1/0;Z1(xe,ye)&&(Ee=Am(xe,ye[0]));for(let Se=0;Se<ye.length;Se++){const qe=ye[Se],We=ve[Se];for(let tt=0;tt<qe.length-1;tt++){const at=qe[tt],Be=[at,qe[tt+1],We[tt+1],We[tt],at];q1(xe,Be)&&(Ee=Math.min(Ee,Am(xe,Be)))}}return Ee!==1/0&&Ee}(te[0],te[1],ue.isPointQuery()?ue.screenBounds:ue.screenGeometry)}},line:class extends no{constructor(i){super(i,Mm),this.gradientVersion=0}_handleSpecialPaintPropertyUpdate(i){if(i==="line-gradient"){const e=this._transitionablePaint._values["line-gradient"].value.expression;this.stepInterpolant=e._styleExpression&&e._styleExpression.expression instanceof ul,this.gradientVersion=(this.gradientVersion+1)%Number.MAX_SAFE_INTEGER}}gradientExpression(){return this._transitionablePaint._values["line-gradient"].value.expression}recalculate(i,e){super.recalculate(i,e),this.paint._values["line-floorwidth"]=Im.possiblyEvaluate(this._transitioningPaint._values["line-width"].value,i)}createBucket(i){return new np(i)}getProgramIds(){return[this.paint.get("line-pattern").constantOr(1)?"linePattern":"line"]}getProgramConfiguration(i){return new ks(this,i)}queryRadius(i){const e=i,r=km(jl("line-width",this,e),jl("line-gap-width",this,e)),s=jl("line-offset",this,e);return r/2+Math.abs(s)+jh(this.paint.get("line-translate"))}queryIntersectsFeature(i,e,r,s,c,f){if(i.queryGeometry.isAboveHorizon)return!1;const _=H1(i.tilespaceGeometry,this.paint.get("line-translate"),this.paint.get("line-translate-anchor"),f.angle,i.pixelToTileUnitsFactor),x=i.pixelToTileUnitsFactor/2*km(this.paint.get("line-width").evaluate(e,r),this.paint.get("line-gap-width").evaluate(e,r)),E=this.paint.get("line-offset").evaluate(e,r);return E&&(s=function(A,C){const L=[],B=new I(0,0);for(let U=0;U<A.length;U++){const N=A[U],$=[];for(let te=0;te<N.length;te++){const ue=N[te-1],ve=N[te],ye=N[te+1],xe=te===0?B:ve.sub(ue)._unit()._perp(),Ee=te===N.length-1?B:ye.sub(ve)._unit()._perp(),Se=xe._add(Ee)._unit();Se._mult(1/(Se.x*Ee.x+Se.y*Ee.y)),$.push(Se._mult(C)._add(ve))}L.push($)}return L}(s,E*i.pixelToTileUnitsFactor)),function(A,C,L){for(let B=0;B<C.length;B++){const U=C[B];if(A.length>=3){for(let N=0;N<U.length;N++)if(za(A,U[N]))return!0}if(d2(A,U,L))return!0}return!1}(_,s,x)}isTileClipped(){return!0}},symbol:yp,background:class extends no{constructor(i){super(i,cx)}getProgramIds(){return[this.paint.get("background-pattern")?"backgroundPattern":"background"]}},raster:class extends no{constructor(i){super(i,ux)}getProgramIds(){return["raster"]}},sky:class extends no{constructor(i){super(i,px),this._updateColorRamp()}_handleSpecialPaintPropertyUpdate(i){i==="sky-gradient"?this._updateColorRamp():i!=="sky-atmosphere-sun"&&i!=="sky-atmosphere-halo-color"&&i!=="sky-atmosphere-color"&&i!=="sky-atmosphere-sun-intensity"||(this._skyboxInvalidated=!0)}_updateColorRamp(){this.colorRamp=Bf({expression:this._transitionablePaint._values["sky-gradient"].value.expression,evaluationKey:"skyRadialProgress"}),this.colorRampTexture&&(this.colorRampTexture.destroy(),this.colorRampTexture=null)}needsSkyboxCapture(i){if(this._skyboxInvalidated||!this.skyboxTexture||!this.skyboxGeometry)return!0;if(!this.paint.get("sky-atmosphere-sun")){const e=i.style.light.properties.get("position");return this._lightPosition.azimuthal!==e.azimuthal||this._lightPosition.polar!==e.polar}return!1}getCenter(i,e){if(this.paint.get("sky-type")==="atmosphere"){const s=this.paint.get("sky-atmosphere-sun"),c=!s,f=i.style.light,_=f.properties.get("position");return c&&f.properties.get("anchor")==="viewport"&&Kt("The sun direction is attached to a light with viewport anchor, lighting may behave unexpectedly."),c?ad(_.azimuthal,90-_.polar,e):ad(s[0],90-s[1],e)}const r=this.paint.get("sky-gradient-center");return ad(r[0],90-r[1],e)}is3D(){return!1}isSky(){return!0}markSkyboxValid(i){this._skyboxInvalidated=!1,this._lightPosition=i.style.light.properties.get("position")}hasOffscreenPass(){return!0}getProgramIds(){const i=this.paint.get("sky-type");return i==="atmosphere"?["skyboxCapture","skybox"]:i==="gradient"?["skyboxGradient"]:null}}};class vu{constructor(e,r,s,c){this.context=e,this.format=s,this.texture=e.gl.createTexture(),this.update(r,c)}update(e,r,s){const{width:c,height:f}=e,{context:_}=this,{gl:x}=_,{HTMLImageElement:E,HTMLCanvasElement:A,HTMLVideoElement:C,ImageData:L,ImageBitmap:B}=w;if(x.bindTexture(x.TEXTURE_2D,this.texture),_.pixelStoreUnpackFlipY.set(!1),_.pixelStoreUnpack.set(1),_.pixelStoreUnpackPremultiplyAlpha.set(this.format===x.RGBA&&(!r||r.premultiply!==!1)),s||this.size&&this.size[0]===c&&this.size[1]===f){const{x:U,y:N}=s||{x:0,y:0};e instanceof E||e instanceof A||e instanceof C||e instanceof L||B&&e instanceof B?x.texSubImage2D(x.TEXTURE_2D,0,U,N,x.RGBA,x.UNSIGNED_BYTE,e):x.texSubImage2D(x.TEXTURE_2D,0,U,N,c,f,x.RGBA,x.UNSIGNED_BYTE,e.data)}else this.size=[c,f],e instanceof E||e instanceof A||e instanceof C||e instanceof L||B&&e instanceof B?x.texImage2D(x.TEXTURE_2D,0,this.format,this.format,x.UNSIGNED_BYTE,e):x.texImage2D(x.TEXTURE_2D,0,this.format,c,f,0,this.format,x.UNSIGNED_BYTE,e.data);this.useMipmap=Boolean(r&&r.useMipmap&&this.isSizePowerOfTwo()),this.useMipmap&&x.generateMipmap(x.TEXTURE_2D)}bind(e,r){const{context:s}=this,{gl:c}=s;c.bindTexture(c.TEXTURE_2D,this.texture),e!==this.filter&&(c.texParameteri(c.TEXTURE_2D,c.TEXTURE_MAG_FILTER,e),c.texParameteri(c.TEXTURE_2D,c.TEXTURE_MIN_FILTER,this.useMipmap?e===c.NEAREST?c.NEAREST_MIPMAP_NEAREST:c.LINEAR_MIPMAP_NEAREST:e),this.filter=e),r!==this.wrap&&(c.texParameteri(c.TEXTURE_2D,c.TEXTURE_WRAP_S,r),c.texParameteri(c.TEXTURE_2D,c.TEXTURE_WRAP_T,r),this.wrap=r)}isSizePowerOfTwo(){return this.size[0]===this.size[1]&&Math.log(this.size[0])/Math.LN2%1==0}destroy(){const{gl:e}=this.context;e.deleteTexture(this.texture),this.texture=null}}class ld{constructor(e,r){this.width=e,this.height=r,this.nextRow=0,this.image=new Qo({width:e,height:r}),this.positions={},this.uploaded=!1}getDash(e,r){const s=this.getKey(e,r);return this.positions[s]}trim(){const e=this.width,r=this.height=mt(this.nextRow);this.image.resize({width:e,height:r})}getKey(e,r){return e.join(",")+r}getDashRanges(e,r,s){const c=[];let f=e.length%2==1?-e[e.length-1]*s:0,_=e[0]*s,x=!0;c.push({left:f,right:_,isDash:x,zeroLength:e[0]===0});let E=e[0];for(let A=1;A<e.length;A++){x=!x;const C=e[A];f=E*s,E+=C,_=E*s,c.push({left:f,right:_,isDash:x,zeroLength:C===0})}return c}addRoundDash(e,r,s){const c=r/2;for(let f=-s;f<=s;f++){const _=this.width*(this.nextRow+s+f);let x=0,E=e[x];for(let A=0;A<this.width;A++){A/E.right>1&&(E=e[++x]);const C=Math.abs(A-E.left),L=Math.abs(A-E.right),B=Math.min(C,L);let U;const N=f/s*(c+1);if(E.isDash){const $=c-Math.abs(N);U=Math.sqrt(B*B+$*$)}else U=c-Math.sqrt(B*B+N*N);this.image.data[_+A]=Math.max(0,Math.min(255,U+128))}}}addRegularDash(e,r){for(let E=e.length-1;E>=0;--E){const A=e[E],C=e[E+1];A.zeroLength?e.splice(E,1):C&&C.isDash===A.isDash&&(C.left=A.left,e.splice(E,1))}const s=e[0],c=e[e.length-1];s.isDash===c.isDash&&(s.left=c.left-this.width,c.right=s.right+this.width);const f=this.width*this.nextRow;let _=0,x=e[_];for(let E=0;E<this.width;E++){E/x.right>1&&(x=e[++_]);const A=Math.abs(E-x.left),C=Math.abs(E-x.right),L=Math.min(A,C);this.image.data[f+E]=Math.max(0,Math.min(255,(x.isDash?L:-L)+r+128))}}addDash(e,r){const s=this.getKey(e,r);if(this.positions[s])return this.positions[s];const c=r==="round",f=c?7:0,_=2*f+1;if(this.nextRow+_>this.height)return Kt("LineAtlas out of space"),null;e.length===0&&e.push(1);let x=0;for(let C=0;C<e.length;C++)e[C]<0&&(Kt("Negative value is found in line dasharray, replacing values with 0"),e[C]=0),x+=e[C];if(x!==0){const C=this.width/x,L=this.getDashRanges(e,this.width,C);c?this.addRoundDash(L,C,f):this.addRegularDash(L,r==="square"?.5*C:0)}const E=this.nextRow+f;this.nextRow+=_;const A={tl:[E,f],br:[x,0]};return this.positions[s]=A,A}}Ct(ld,"LineAtlas");class dx{constructor(e){this._callback=e,this._triggered=!1,typeof MessageChannel!="undefined"&&(this._channel=new MessageChannel,this._channel.port2.onmessage=()=>{this._triggered=!1,this._callback()})}trigger(){this._triggered||(this._triggered=!0,this._channel?this._channel.port1.postMessage(!0):setTimeout(()=>{this._triggered=!1,this._callback()},0))}remove(){this._channel=void 0,this._callback=()=>{}}}class mx{constructor(){this.tasks={},this.taskQueue=[],At(["process"],this),this.invoker=new dx(this.process),this.nextId=0}add(e,r){const s=this.nextId++,c=function({type:f,isSymbolTile:_,zoom:x}){return x=x||0,f==="message"?0:f!=="maybePrepare"||_?f!=="parseTile"||_?f==="parseTile"&&_?300-x:f==="maybePrepare"&&_?400-x:500:200-x:100-x}(r);if(c===0){Zt();try{e()}finally{}return{cancel:()=>{}}}return this.tasks[s]={fn:e,metadata:r,priority:c,id:s},this.taskQueue.push(s),this.invoker.trigger(),{cancel:()=>{delete this.tasks[s]}}}process(){Zt();try{if(this.taskQueue=this.taskQueue.filter(s=>!!this.tasks[s]),!this.taskQueue.length)return;const e=this.pick();if(e===null)return;const r=this.tasks[e];if(delete this.tasks[e],this.taskQueue.length&&this.invoker.trigger(),!r)return;r.fn()}finally{}}pick(){let e=null,r=1/0;for(let c=0;c<this.taskQueue.length;c++){const f=this.tasks[this.taskQueue[c]];f.priority<r&&(r=f.priority,e=c)}if(e===null)return null;const s=this.taskQueue[e];return this.taskQueue.splice(e,1),s}remove(){this.invoker.remove()}}class v_{constructor(e){this._stringToNumber={},this._numberToString=[];for(let r=0;r<e.length;r++){const s=e[r];this._stringToNumber[s]=r,this._numberToString[r]=s}}encode(e){return this._stringToNumber[e]}decode(e){return this._numberToString[e]}}const _x=["tile","layer","source","sourceLayer","state"];class x_{constructor(e,r,s,c,f){this.type="Feature",this._vectorTileFeature=e,this._z=r,this._x=s,this._y=c,this.properties=e.properties,this.id=f}get geometry(){return this._geometry===void 0&&(this._geometry=this._vectorTileFeature.toGeoJSON(this._x,this._y,this._z).geometry),this._geometry}set geometry(e){this._geometry=e}toJSON(){const e={type:"Feature",geometry:this.geometry,properties:this.properties};this.id!==void 0&&(e.id=this.id);for(const r of _x)this[r]!==void 0&&(e[r]=this[r]);return e}}const Nn=32,Ao=33,Os=new Uint16Array(8184);for(let i=0;i<2046;i++){let e=i+2,r=0,s=0,c=0,f=0,_=0,x=0;for(1&e?c=f=_=Nn:r=s=x=Nn;(e>>=1)>1;){const A=r+c>>1,C=s+f>>1;1&e?(c=r,f=s,r=_,s=x):(r=c,s=f,c=_,f=x),_=A,x=C}const E=4*i;Os[E+0]=r,Os[E+1]=s,Os[E+2]=c,Os[E+3]=f}const So=new Uint16Array(2178),Fs=new Uint8Array(1089),vp=new Uint16Array(1089);function b_(i){return i===0?-.03125:i===32?.03125:0}var w_=gt([{name:"a_pos",type:"Int16",components:2},{name:"a_texture_pos",type:"Int16",components:2}]);const E_={type:2,extent:qt,loadGeometry:()=>[[new I(0,0),new I(8193,0),new I(8193,8193),new I(0,8193),new I(0,0)]]};class cd{constructor(e,r,s,c,f){this.tileID=e,this.uid=Qe(),this.uses=0,this.tileSize=r,this.tileZoom=s,this.buckets={},this.expirationTime=null,this.queryPadding=0,this.hasSymbolBuckets=!1,this.hasRTLText=!1,this.dependencies={},this.isRaster=f,this.expiredRequestCount=0,this.state="loading",c&&c.transform&&(this.projection=c.transform.projection)}registerFadeDuration(e){const r=e+this.timeAdded;r<nn.now()||this.fadeEndTime&&r<this.fadeEndTime||(this.fadeEndTime=r)}wasRequested(){return this.state==="errored"||this.state==="loaded"||this.state==="reloading"}get tileTransform(){return this._tileTransform||(this._tileTransform=Ba(this.tileID.canonical,this.projection)),this._tileTransform}loadVectorData(e,r,s){if(this.unloadVectorData(),this.state="loaded",e){e.featureIndex&&(this.latestFeatureIndex=e.featureIndex,e.rawTileData?(this.latestRawTileData=e.rawTileData,this.latestFeatureIndex.rawTileData=e.rawTileData):this.latestRawTileData&&(this.latestFeatureIndex.rawTileData=this.latestRawTileData)),this.collisionBoxArray=e.collisionBoxArray,this.buckets=function(c,f){const _={};if(!f)return _;for(const x of c){const E=x.layerIds.map(A=>f.getLayer(A)).filter(Boolean);if(E.length!==0){x.layers=E,x.stateDependentLayerIds&&(x.stateDependentLayers=x.stateDependentLayerIds.map(A=>E.filter(C=>C.id===A)[0]));for(const A of E)_[A.id]=x}}return _}(e.buckets,r.style),this.hasSymbolBuckets=!1;for(const c in this.buckets){const f=this.buckets[c];if(f instanceof Bs){if(this.hasSymbolBuckets=!0,!s)break;f.justReloaded=!0}}if(this.hasRTLText=!1,this.hasSymbolBuckets)for(const c in this.buckets){const f=this.buckets[c];if(f instanceof Bs&&f.hasRTLText){this.hasRTLText=!0,K.isLoading()||K.isLoaded()||Y()!=="deferred"||pe();break}}this.queryPadding=0;for(const c in this.buckets){const f=this.buckets[c];this.queryPadding=Math.max(this.queryPadding,r.style.getLayer(c).queryRadius(f))}e.imageAtlas&&(this.imageAtlas=e.imageAtlas),e.glyphAtlasImage&&(this.glyphAtlasImage=e.glyphAtlasImage),e.lineAtlas&&(this.lineAtlas=e.lineAtlas)}else this.collisionBoxArray=new yf}unloadVectorData(){if(this.hasData()){for(const e in this.buckets)this.buckets[e].destroy();this.buckets={},this.imageAtlas&&(this.imageAtlas=null),this.lineAtlas&&(this.lineAtlas=null),this.imageAtlasTexture&&this.imageAtlasTexture.destroy(),this.glyphAtlasTexture&&this.glyphAtlasTexture.destroy(),this.lineAtlasTexture&&this.lineAtlasTexture.destroy(),this._tileBoundsBuffer&&(this._tileBoundsBuffer.destroy(),this._tileBoundsIndexBuffer.destroy(),this._tileBoundsSegments.destroy(),this._tileBoundsBuffer=null),this._tileDebugBuffer&&(this._tileDebugBuffer.destroy(),this._tileDebugIndexBuffer.destroy(),this._tileDebugSegments.destroy(),this._tileDebugBuffer=null),this._globeTileDebugBorderBuffer&&(this._globeTileDebugBorderBuffer.destroy(),this._globeTileDebugBorderBuffer=null),this._tileDebugTextBuffer&&(this._tileDebugTextBuffer.destroy(),this._tileDebugTextSegments.destroy(),this._tileDebugTextIndexBuffer.destroy(),this._tileDebugTextBuffer=null),this._globeTileDebugTextBuffer&&(this._globeTileDebugTextBuffer.destroy(),this._globeTileDebugTextBuffer=null),this.latestFeatureIndex=null,this.state="unloaded"}}getBucket(e){return this.buckets[e.id]}upload(e){for(const s in this.buckets){const c=this.buckets[s];c.uploadPending()&&c.upload(e)}const r=e.gl;this.imageAtlas&&!this.imageAtlas.uploaded&&(this.imageAtlasTexture=new vu(e,this.imageAtlas.image,r.RGBA),this.imageAtlas.uploaded=!0),this.glyphAtlasImage&&(this.glyphAtlasTexture=new vu(e,this.glyphAtlasImage,r.ALPHA),this.glyphAtlasImage=null),this.lineAtlas&&!this.lineAtlas.uploaded&&(this.lineAtlasTexture=new vu(e,this.lineAtlas.image,r.ALPHA),this.lineAtlas.uploaded=!0)}prepare(e){this.imageAtlas&&this.imageAtlas.patchUpdatedImages(e,this.imageAtlasTexture)}queryRenderedFeatures(e,r,s,c,f,_,x,E){return this.latestFeatureIndex&&this.latestFeatureIndex.rawTileData?this.latestFeatureIndex.query({tileResult:c,pixelPosMatrix:x,transform:_,params:f,tileTransform:this.tileTransform},e,r,s):{}}querySourceFeatures(e,r){const s=this.latestFeatureIndex;if(!s||!s.rawTileData)return;const c=s.loadVTLayers(),f=r?r.sourceLayer:"",_=c._geojsonTileLayer||c[f];if(!_)return;const x=Wo(r&&r.filter),{z:E,x:A,y:C}=this.tileID.canonical,L={z:E,x:A,y:C};for(let B=0;B<_.length;B++){const U=_.feature(B);if(x.needGeometry){const te=Ca(U,!0);if(!x.filter(new ne(this.tileID.overscaledZ),te,this.tileID.canonical))continue}else if(!x.filter(new ne(this.tileID.overscaledZ),U))continue;const N=s.getId(U,f),$=new x_(U,E,A,C,N);$.tile=L,e.push($)}}hasData(){return this.state==="loaded"||this.state==="reloading"||this.state==="expired"}patternsLoaded(){return!!this.imageAtlas&&!!Object.keys(this.imageAtlas.patternPositions).length}setExpiryData(e){const r=this.expirationTime;if(e.cacheControl){const s=vr(e.cacheControl);s["max-age"]&&(this.expirationTime=Date.now()+1e3*s["max-age"])}else e.expires&&(this.expirationTime=new Date(e.expires).getTime());if(this.expirationTime){const s=Date.now();let c=!1;if(this.expirationTime>s)c=!1;else if(r)if(this.expirationTime<r)c=!0;else{const f=this.expirationTime-r;f?this.expirationTime=s+Math.max(f,3e4):c=!0}else c=!0;c?(this.expiredRequestCount++,this.state="expired"):this.expiredRequestCount=0}}getExpiryTimeout(){if(this.expirationTime)return this.expiredRequestCount?1e3*(1<<Math.min(this.expiredRequestCount-1,31)):Math.min(this.expirationTime-new Date().getTime(),Math.pow(2,31)-1)}setFeatureState(e,r){if(!this.latestFeatureIndex||!this.latestFeatureIndex.rawTileData||Object.keys(e).length===0||!r)return;const s=this.latestFeatureIndex.loadVTLayers(),c=r.style.listImages();for(const f in this.buckets){if(!r.style.hasLayer(f))continue;const _=this.buckets[f],x=_.layers[0].sourceLayer||"_geojsonTileLayer",E=s[x],A=e[x];if(!E||!A||Object.keys(A).length===0)continue;if(_.update(A,E,c,this.imageAtlas&&this.imageAtlas.patternPositions||{}),_ instanceof np||_ instanceof ep){const L=r.style._getSourceCache(_.layers[0].source);r._terrain&&r._terrain.enabled&&L&&_.programConfigurations.needsUpload&&r._terrain._clearRenderCacheForTile(L.id,this.tileID)}const C=r&&r.style&&r.style.getLayer(f);C&&(this.queryPadding=Math.max(this.queryPadding,C.queryRadius(_)))}}holdingForFade(){return this.symbolFadeHoldUntil!==void 0}symbolFadeFinished(){return!this.symbolFadeHoldUntil||this.symbolFadeHoldUntil<nn.now()}clearFadeHold(){this.symbolFadeHoldUntil=void 0}setHoldDuration(e){this.symbolFadeHoldUntil=nn.now()+e}setTexture(e,r){const s=r.context,c=s.gl;this.texture=r.getTileTexture(e.width),this.texture?this.texture.update(e,{useMipmap:!0}):(this.texture=new vu(s,e,c.RGBA,{useMipmap:!0}),this.texture.bind(c.LINEAR,c.CLAMP_TO_EDGE),s.extTextureFilterAnisotropic&&c.texParameterf(c.TEXTURE_2D,s.extTextureFilterAnisotropic.TEXTURE_MAX_ANISOTROPY_EXT,s.extTextureFilterAnisotropicMax))}setDependencies(e,r){const s={};for(const c of r)s[c]=!0;this.dependencies[e]=s}hasDependency(e,r){for(const s of e){const c=this.dependencies[s];if(c){for(const f of r)if(c[f])return!0}}return!1}clearQueryDebugViz(){}_makeDebugTileBoundsBuffers(e,r){if(!r||r.name==="mercator"||this._tileDebugBuffer)return;const s=Jo(E_,this.tileID.canonical,this.tileTransform)[0],c=new Vt,f=new On;for(let _=0;_<s.length;_++){const{x,y:E}=s[_];c.emplaceBack(x,E),f.emplaceBack(_)}f.emplaceBack(0),this._tileDebugIndexBuffer=e.createIndexBuffer(f),this._tileDebugBuffer=e.createVertexBuffer(c,fu.members),this._tileDebugSegments=or.simpleSegment(0,0,c.length,f.length)}_makeTileBoundsBuffers(e,r){if(this._tileBoundsBuffer||!r||r.name==="mercator")return;const s=Jo(E_,this.tileID.canonical,this.tileTransform)[0];let c,f;if(this.isRaster){const _=function(x,E){const A=Ba(x,E),C=Math.pow(2,x.z);for(let te=0;te<Ao;te++)for(let ue=0;ue<Ao;ue++){const ve=Gr((x.x+(ue+b_(ue))/Nn)/C),ye=gr((x.y+(te+b_(te))/Nn)/C),xe=E.project(ve,ye),Ee=te*Ao+ue;So[2*Ee+0]=Math.round((xe.x*A.scale-A.x)*qt),So[2*Ee+1]=Math.round((xe.y*A.scale-A.y)*qt)}Fs.fill(0),vp.fill(0);for(let te=2045;te>=0;te--){const ue=4*te,ve=Os[ue+0],ye=Os[ue+1],xe=Os[ue+2],Ee=Os[ue+3],Se=ve+xe>>1,qe=ye+Ee>>1,We=Se+qe-ye,tt=qe+ve-Se,at=ye*Ao+ve,Be=Ee*Ao+xe,et=qe*Ao+Se,lt=Math.hypot((So[2*at+0]+So[2*Be+0])/2-So[2*et+0],(So[2*at+1]+So[2*Be+1])/2-So[2*et+1])>=16;if(Fs[et]=Fs[et]||(lt?1:0),te<1022){const ct=(ye+tt>>1)*Ao+(ve+We>>1),Mt=(Ee+tt>>1)*Ao+(xe+We>>1);Fs[et]=Fs[et]||Fs[ct]||Fs[Mt]}}const L=new Ot,B=new yi;let U=0;function N(te,ue){const ve=ue*Ao+te;return vp[ve]===0&&(L.emplaceBack(So[2*ve+0],So[2*ve+1],te*qt/Nn,ue*qt/Nn),vp[ve]=++U),vp[ve]-1}function $(te,ue,ve,ye,xe,Ee){const Se=te+ve>>1,qe=ue+ye>>1;if(Math.abs(te-xe)+Math.abs(ue-Ee)>1&&Fs[qe*Ao+Se])$(xe,Ee,te,ue,Se,qe),$(ve,ye,xe,Ee,Se,qe);else{const We=N(te,ue),tt=N(ve,ye),at=N(xe,Ee);B.emplaceBack(We,tt,at)}}return $(0,0,Nn,Nn,Nn,0),$(Nn,Nn,0,0,0,Nn),{vertices:L,indices:B}}(this.tileID.canonical,r);c=_.vertices,f=_.indices}else{c=new Ot,f=new yi;for(const{x,y:E}of s)c.emplaceBack(x,E,0,0);const _=Hh(c.int16,void 0,4);for(let x=0;x<_.length;x+=3)f.emplaceBack(_[x],_[x+1],_[x+2])}this._tileBoundsBuffer=e.createVertexBuffer(c,w_.members),this._tileBoundsIndexBuffer=e.createIndexBuffer(f),this._tileBoundsSegments=or.simpleSegment(0,0,c.length,f.length)}_makeGlobeTileDebugBuffers(e,r){if(this._globeTileDebugBorderBuffer||this._globeTileDebugTextBuffer||!r||r.name!=="globe")return;const s=this.tileID.canonical,c=du(To(s));this._makeGlobeTileDebugBorderBuffer(e,s,c),this._makeGlobeTileDebugTextBuffer(e,s,c)}_makeGlobeTileDebugBorderBuffer(e,r,s){const c=new Vt,f=new On,_=new oi,x=(A,C,L,B,U)=>{const N=(L-A)/(U-1),$=(B-C)/(U-1),te=c.length;for(let ue=0;ue<U;ue++){const ve=A+ue*N,ye=C+ue*$;c.emplaceBack(ve,ye);const xe=a_(ve,ye,r),Ee=zr(xe,xe,s);_.emplaceBack(Ee[0],Ee[1],Ee[2]),f.emplaceBack(te+ue)}},E=qt;x(0,0,E,0,16),x(E,0,E,E,16),x(E,E,0,E,16),x(0,E,0,0,16),this._tileDebugIndexBuffer=e.createIndexBuffer(f),this._tileDebugBuffer=e.createVertexBuffer(c,fu.members),this._globeTileDebugBorderBuffer=e.createVertexBuffer(_,n_.members),this._tileDebugSegments=or.simpleSegment(0,0,c.length,f.length)}_makeGlobeTileDebugTextBuffer(e,r,s){const c=new Vt,f=new yi,_=new oi,x=25;f.reserve(32),c.reserve(x),_.reserve(x);const E=(A,C)=>x*A+C;for(let A=0;A<x;A++){const C=2048*A;for(let L=0;L<x;L++){const B=2048*L;c.emplaceBack(B,C);const U=a_(B,C,r),N=zr(U,U,s);_.emplaceBack(N[0],N[1],N[2])}}for(let A=0;A<4;A++)for(let C=0;C<4;C++){const L=E(A,C),B=E(A,C+1),U=E(A+1,C),N=E(A+1,C+1);f.emplaceBack(L,B,U),f.emplaceBack(U,B,N)}this._tileDebugTextIndexBuffer=e.createIndexBuffer(f),this._tileDebugTextBuffer=e.createVertexBuffer(c,fu.members),this._globeTileDebugTextBuffer=e.createVertexBuffer(_,n_.members),this._tileDebugTextSegments=or.simpleSegment(0,0,x,32)}}class gx{constructor(){this.state={},this.stateChanges={},this.deletedStates={}}updateState(e,r,s){const c=String(r);if(this.stateChanges[e]=this.stateChanges[e]||{},this.stateChanges[e][c]=this.stateChanges[e][c]||{},Pe(this.stateChanges[e][c],s),this.deletedStates[e]===null){this.deletedStates[e]={};for(const f in this.state[e])f!==c&&(this.deletedStates[e][f]=null)}else if(this.deletedStates[e]&&this.deletedStates[e][c]===null){this.deletedStates[e][c]={};for(const f in this.state[e][c])s[f]||(this.deletedStates[e][c][f]=null)}else for(const f in s)this.deletedStates[e]&&this.deletedStates[e][c]&&this.deletedStates[e][c][f]===null&&delete this.deletedStates[e][c][f]}removeFeatureState(e,r,s){if(this.deletedStates[e]===null)return;const c=String(r);if(this.deletedStates[e]=this.deletedStates[e]||{},s&&r!==void 0)this.deletedStates[e][c]!==null&&(this.deletedStates[e][c]=this.deletedStates[e][c]||{},this.deletedStates[e][c][s]=null);else if(r!==void 0)if(this.stateChanges[e]&&this.stateChanges[e][c])for(s in this.deletedStates[e][c]={},this.stateChanges[e][c])this.deletedStates[e][c][s]=null;else this.deletedStates[e][c]=null;else this.deletedStates[e]=null}getState(e,r){const s=String(r),c=Pe({},(this.state[e]||{})[s],(this.stateChanges[e]||{})[s]);if(this.deletedStates[e]===null)return{};if(this.deletedStates[e]){const f=this.deletedStates[e][r];if(f===null)return{};for(const _ in f)delete c[_]}return c}initializeTileState(e,r){e.setFeatureState(this.state,r)}coalesceChanges(e,r){const s={};for(const c in this.stateChanges){this.state[c]=this.state[c]||{};const f={};for(const _ in this.stateChanges[c])this.state[c][_]||(this.state[c][_]={}),Pe(this.state[c][_],this.stateChanges[c][_]),f[_]=this.state[c][_];s[c]=f}for(const c in this.deletedStates){this.state[c]=this.state[c]||{};const f={};if(this.deletedStates[c]===null)for(const _ in this.state[c])f[_]={},this.state[c][_]={};else for(const _ in this.deletedStates[c]){if(this.deletedStates[c][_]===null)this.state[c][_]={};else for(const x of Object.keys(this.deletedStates[c][_]))delete this.state[c][_][x];f[_]=this.state[c][_]}s[c]=s[c]||{},Pe(s[c],f)}if(this.stateChanges={},this.deletedStates={},Object.keys(s).length!==0)for(const c in e)e[c].setFeatureState(s,r)}}class T_{constructor(e){this.size=e,this.minimums=[],this.maximums=[],this.leaves=[]}getElevation(e,r){const s=this.toIdx(e,r);return{min:this.minimums[s],max:this.maximums[s]}}isLeaf(e,r){return this.leaves[this.toIdx(e,r)]}toIdx(e,r){return r*this.size+e}}function A_(i,e,r,s){let c=0,f=Number.MAX_VALUE;for(let _=0;_<3;_++)if(Math.abs(s[_])<1e-15){if(r[_]<i[_]||r[_]>e[_])return null}else{const x=1/s[_];let E=(i[_]-r[_])*x,A=(e[_]-r[_])*x;if(E>A){const C=E;E=A,A=C}if(E>c&&(c=E),A<f&&(f=A),c>f)return null}return c}function S_(i,e,r,s,c,f,_,x,E,A,C){const L=s-i,B=c-e,U=f-r,N=_-i,$=x-e,te=E-r,ue=C[1]*te-C[2]*$,ve=C[2]*N-C[0]*te,ye=C[0]*$-C[1]*N,xe=L*ue+B*ve+U*ye;if(Math.abs(xe)<1e-15)return null;const Ee=1/xe,Se=A[0]-i,qe=A[1]-e,We=A[2]-r,tt=(Se*ue+qe*ve+We*ye)*Ee;if(tt<0||tt>1)return null;const at=qe*U-We*B,Be=We*L-Se*U,et=Se*B-qe*L,lt=(C[0]*at+C[1]*Be+C[2]*et)*Ee;return lt<0||tt+lt>1?null:(N*at+$*Be+te*et)*Ee}function M_(i,e,r){return(i-e)/(r-e)}function I_(i,e,r,s,c,f,_,x,E){const A=1<<r,C=f-s,L=_-c,B=(i+1)/A*C+s,U=(e+0)/A*L+c,N=(e+1)/A*L+c;x[0]=(i+0)/A*C+s,x[1]=U,E[0]=B,E[1]=N}class k_{constructor(e){if(this.maximums=[],this.minimums=[],this.leaves=[],this.childOffsets=[],this.nodeCount=0,this.dem=e,this._siblingOffset=[[0,0],[1,0],[0,1],[1,1]],!this.dem)return;const r=function(f){const _=Math.ceil(Math.log2(f.dim/8)),x=[];let E=Math.ceil(Math.pow(2,_));const A=1/E,C=(U,N,$,te,ue)=>{const ve=te?1:0,ye=(U+1)*$-ve,xe=N*$,Ee=(N+1)*$-ve;ue[0]=U*$,ue[1]=xe,ue[2]=ye,ue[3]=Ee};let L=new T_(E);const B=[];for(let U=0;U<E*E;U++){C(U%E,Math.floor(U/E),A,!1,B);const N=Us(B[0],B[1],f),$=Us(B[2],B[1],f),te=Us(B[2],B[3],f),ue=Us(B[0],B[3],f);L.minimums.push(Math.min(N,$,te,ue)),L.maximums.push(Math.max(N,$,te,ue)),L.leaves.push(1)}for(x.push(L),E/=2;E>=1;E/=2){const U=x[x.length-1];L=new T_(E);for(let N=0;N<E*E;N++){C(N%E,Math.floor(N/E),2,!0,B);const $=U.getElevation(B[0],B[1]),te=U.getElevation(B[2],B[1]),ue=U.getElevation(B[2],B[3]),ve=U.getElevation(B[0],B[3]),ye=U.isLeaf(B[0],B[1]),xe=U.isLeaf(B[2],B[1]),Ee=U.isLeaf(B[2],B[3]),Se=U.isLeaf(B[0],B[3]),qe=Math.min($.min,te.min,ue.min,ve.min),We=Math.max($.max,te.max,ue.max,ve.max),tt=ye&&xe&&Ee&&Se;L.maximums.push(We),L.minimums.push(qe),L.leaves.push(We-qe<=5&&tt?1:0)}x.push(L)}return x}(this.dem),s=r.length-1,c=r[s];this._addNode(c.minimums[0],c.maximums[0],c.leaves[0]),this._construct(r,0,0,s,0)}raycastRoot(e,r,s,c,f,_,x=1){return A_([e,r,-100],[s,c,this.maximums[0]*x],f,_)}raycast(e,r,s,c,f,_,x=1){if(!this.nodeCount)return null;const E=this.raycastRoot(e,r,s,c,f,_,x);if(E==null)return null;const A=[],C=[],L=[],B=[],U=[{idx:0,t:E,nodex:0,nodey:0,depth:0}];for(;U.length>0;){const{idx:N,t:$,nodex:te,nodey:ue,depth:ve}=U.pop();if(this.leaves[N]){I_(te,ue,ve,e,r,s,c,L,B);const xe=1<<ve,Ee=(te+0)/xe,Se=(te+1)/xe,qe=(ue+0)/xe,We=(ue+1)/xe,tt=Us(Ee,qe,this.dem)*x,at=Us(Se,qe,this.dem)*x,Be=Us(Se,We,this.dem)*x,et=Us(Ee,We,this.dem)*x,lt=S_(L[0],L[1],tt,B[0],L[1],at,B[0],B[1],Be,f,_),ct=S_(B[0],B[1],Be,L[0],B[1],et,L[0],L[1],tt,f,_),Mt=Math.min(lt!==null?lt:Number.MAX_VALUE,ct!==null?ct:Number.MAX_VALUE);if(Mt!==Number.MAX_VALUE)return Mt;{const ot=Xh([],f,_,$);if(C_(tt,at,et,Be,M_(ot[0],L[0],B[0]),M_(ot[1],L[1],B[1]))>=ot[2])return $}continue}let ye=0;for(let xe=0;xe<this._siblingOffset.length;xe++){I_((te<<1)+this._siblingOffset[xe][0],(ue<<1)+this._siblingOffset[xe][1],ve+1,e,r,s,c,L,B),L[2]=-100,B[2]=this.maximums[this.childOffsets[N]+xe]*x;const Ee=A_(L,B,f,_);if(Ee!=null){const Se=Ee;A[xe]=Se;let qe=!1;for(let We=0;We<ye&&!qe;We++)Se>=A[C[We]]&&(C.splice(We,0,xe),qe=!0);qe||(C[ye]=xe),ye++}}for(let xe=0;xe<ye;xe++){const Ee=C[xe];U.push({idx:this.childOffsets[N]+Ee,t:A[Ee],nodex:(te<<1)+this._siblingOffset[Ee][0],nodey:(ue<<1)+this._siblingOffset[Ee][1],depth:ve+1})}}return null}_addNode(e,r,s){return this.minimums.push(e),this.maximums.push(r),this.leaves.push(s),this.childOffsets.push(0),this.nodeCount++}_construct(e,r,s,c,f){if(e[c].isLeaf(r,s)===1)return;this.childOffsets[f]||(this.childOffsets[f]=this.nodeCount);const _=c-1,x=e[_];let E=0,A=0;for(let C=0;C<this._siblingOffset.length;C++){const L=2*r+this._siblingOffset[C][0],B=2*s+this._siblingOffset[C][1],U=x.getElevation(L,B),N=x.isLeaf(L,B),$=this._addNode(U.min,U.max,N);N&&(E|=1<<C),A||(A=$)}for(let C=0;C<this._siblingOffset.length;C++)E&1<<C||this._construct(e,2*r+this._siblingOffset[C][0],2*s+this._siblingOffset[C][1],_,A+C)}}function C_(i,e,r,s,c,f){return bi(bi(i,r,f),bi(e,s,f),c)}function Us(i,e,r){const s=r.dim,c=re(i*s-.5,0,s-1),f=re(e*s-.5,0,s-1),_=Math.floor(c),x=Math.floor(f),E=Math.min(_+1,s-1),A=Math.min(x+1,s-1);return C_(r.get(_,x),r.get(E,x),r.get(_,A),r.get(E,A),c-_,f-x)}const z_={mapbox:[6553.6,25.6,.1,1e4],terrarium:[256,1,1/256,32768]};class xp{get tree(){return this._tree||this._buildQuadTree(),this._tree}constructor(e,r,s,c=!1,f=!1){if(this.uid=e,r.height!==r.width)throw new RangeError("DEM tiles must be square");if(s&&s!=="mapbox"&&s!=="terrarium")return Kt(`"${s}" is not a valid encoding type. Valid types include "mapbox" and "terrarium".`);this.stride=r.height;const _=this.dim=r.height-2,x=new Uint32Array(r.data.buffer);if(this.pixels=new Uint8Array(r.data.buffer),this.encoding=s||"mapbox",this.borderReady=c,!c){for(let E=0;E<_;E++)x[this._idx(-1,E)]=x[this._idx(0,E)],x[this._idx(_,E)]=x[this._idx(_-1,E)],x[this._idx(E,-1)]=x[this._idx(E,0)],x[this._idx(E,_)]=x[this._idx(E,_-1)];x[this._idx(-1,-1)]=x[this._idx(0,0)],x[this._idx(_,-1)]=x[this._idx(_-1,0)],x[this._idx(-1,_)]=x[this._idx(0,_-1)],x[this._idx(_,_)]=x[this._idx(_-1,_-1)],f&&this._buildQuadTree()}}_buildQuadTree(){this._tree=new k_(this)}get(e,r,s=!1){s&&(e=re(e,-1,this.dim),r=re(r,-1,this.dim));const c=4*this._idx(e,r);return(this.encoding==="terrarium"?this._unpackTerrarium:this._unpackMapbox)(this.pixels[c],this.pixels[c+1],this.pixels[c+2])}static getUnpackVector(e){return z_[e]}get unpackVector(){return z_[this.encoding]}_idx(e,r){if(e<-1||e>=this.dim+1||r<-1||r>=this.dim+1)throw new RangeError("out of range source coordinates for DEM data");return(r+1)*this.stride+(e+1)}_unpackMapbox(e,r,s){return(256*e*256+256*r+s)/10-1e4}_unpackTerrarium(e,r,s){return 256*e+r+s/256-32768}static pack(e,r){const s=[0,0,0,0],c=xp.getUnpackVector(r);let f=Math.floor((e+c[3])/c[2]);return s[2]=f%256,f=Math.floor(f/256),s[1]=f%256,f=Math.floor(f/256),s[0]=f,s}getPixels(){return new fn({width:this.stride,height:this.stride},this.pixels)}backfillBorder(e,r,s){if(this.dim!==e.dim)throw new Error("dem dimension mismatch");let c=r*this.dim,f=r*this.dim+this.dim,_=s*this.dim,x=s*this.dim+this.dim;switch(r){case-1:c=f-1;break;case 1:f=c+1}switch(s){case-1:_=x-1;break;case 1:x=_+1}const E=-r*this.dim,A=-s*this.dim;for(let C=_;C<x;C++)for(let L=c;L<f;L++){const B=4*this._idx(L,C),U=4*this._idx(L+E,C+A);this.pixels[B+0]=e.pixels[U+0],this.pixels[B+1]=e.pixels[U+1],this.pixels[B+2]=e.pixels[U+2],this.pixels[B+3]=e.pixels[U+3]}}onDeserialize(){this._tree&&(this._tree.dem=this)}}Ct(xp,"DEMData"),Ct(k_,"DemMinMaxQuadTree",{omit:["dem"]});class yx{constructor(e,r){this.max=e,this.onRemove=r,this.reset()}reset(){for(const e in this.data)for(const r of this.data[e])r.timeout&&clearTimeout(r.timeout),this.onRemove(r.value);return this.data={},this.order=[],this}add(e,r,s){const c=e.wrapped().key;this.data[c]===void 0&&(this.data[c]=[]);const f={value:r,timeout:void 0};if(s!==void 0&&(f.timeout=setTimeout(()=>{this.remove(e,f)},s)),this.data[c].push(f),this.order.push(c),this.order.length>this.max){const _=this._getAndRemoveByKey(this.order[0]);_&&this.onRemove(_)}return this}has(e){return e.wrapped().key in this.data}getAndRemove(e){return this.has(e)?this._getAndRemoveByKey(e.wrapped().key):null}_getAndRemoveByKey(e){const r=this.data[e].shift();return r.timeout&&clearTimeout(r.timeout),this.data[e].length===0&&delete this.data[e],this.order.splice(this.order.indexOf(e),1),r.value}getByKey(e){const r=this.data[e];return r?r[0].value:null}get(e){return this.has(e)?this.data[e.wrapped().key][0].value:null}remove(e,r){if(!this.has(e))return this;const s=e.wrapped().key,c=r===void 0?0:this.data[s].indexOf(r),f=this.data[s][c];return this.data[s].splice(c,1),f.timeout&&clearTimeout(f.timeout),this.data[s].length===0&&delete this.data[s],this.onRemove(f.value),this.order.splice(this.order.indexOf(s),1),this}setMaxSize(e){for(this.max=e;this.order.length>this.max;){const r=this._getAndRemoveByKey(this.order[0]);r&&this.onRemove(r)}return this}filter(e){const r=[];for(const s in this.data)for(const c of this.data[s])e(c.value)||r.push(c);for(const s of r)this.remove(s.value.tileID,s)}}class ec{constructor(e,r,s){this.func=e,this.mask=r,this.range=s}}ec.ReadOnly=!1,ec.ReadWrite=!0,ec.disabled=new ec(519,ec.ReadOnly,[0,1]);const ud=7680;class hd{constructor(e,r,s,c,f,_){this.test=e,this.ref=r,this.mask=s,this.fail=c,this.depthFail=f,this.pass=_}}hd.disabled=new hd({func:519,mask:0},0,0,ud,ud,ud);class Mo{constructor(e,r,s){this.blendFunction=e,this.blendColor=r,this.mask=s}}Mo.Replace=[1,0],Mo.disabled=new Mo(Mo.Replace,tr.transparent,[!1,!1,!1,!1]),Mo.unblended=new Mo(Mo.Replace,tr.transparent,[!0,!0,!0,!0]),Mo.alphaBlended=new Mo([1,771],tr.transparent,[!0,!0,!0,!0]);const pd=1029,fd=2305;class oo{constructor(e,r,s){this.enable=e,this.mode=r,this.frontFace=s}}oo.disabled=new oo(!1,pd,fd),oo.backCCW=new oo(!0,pd,fd),oo.backCW=new oo(!0,pd,2304),oo.frontCW=new oo(!0,1028,2304),oo.frontCCW=new oo(!0,1028,fd);class Oa extends ki{constructor(e,r,s){super(),this.id=e,this._onlySymbols=s,r.on("data",c=>{c.dataType==="source"&&c.sourceDataType==="metadata"&&(this._sourceLoaded=!0),this._sourceLoaded&&!this._paused&&c.dataType==="source"&&c.sourceDataType==="content"&&(this.reload(),this.transform&&this.update(this.transform))}),r.on("error",()=>{this._sourceErrored=!0}),this._source=r,this._tiles={},this._cache=new yx(0,this._unloadTile.bind(this)),this._timers={},this._cacheTimers={},this._minTileCacheSize=r.minTileCacheSize,this._maxTileCacheSize=r.maxTileCacheSize,this._loadedParentTiles={},this._coveredTiles={},this._state=new gx,this._isRaster=this._source.type==="raster"||this._source.type==="raster-dem"||this._source.type==="custom"&&this._source._dataType==="raster"}onAdd(e){this.map=e,this._minTileCacheSize=this._minTileCacheSize===void 0&&e?e._minTileCacheSize:this._minTileCacheSize,this._maxTileCacheSize=this._maxTileCacheSize===void 0&&e?e._maxTileCacheSize:this._maxTileCacheSize}loaded(){if(this._sourceErrored)return!0;if(!this._sourceLoaded||!this._source.loaded())return!1;for(const e in this._tiles){const r=this._tiles[e];if(r.state!=="loaded"&&r.state!=="errored")return!1}return!0}getSource(){return this._source}pause(){this._paused=!0}resume(){if(!this._paused)return;const e=this._shouldReloadOnResume;this._paused=!1,this._shouldReloadOnResume=!1,e&&this.reload(),this.transform&&this.update(this.transform)}_loadTile(e,r){return e.isSymbolTile=this._onlySymbols,this._source.loadTile(e,r)}_unloadTile(e){if(this._source.unloadTile)return this._source.unloadTile(e,()=>{})}_abortTile(e){if(this._source.abortTile)return this._source.abortTile(e,()=>{})}serialize(){return this._source.serialize()}prepare(e){if(this._source.prepare&&this._source.prepare(),this._state.coalesceChanges(this._tiles,this.map?this.map.painter:null),this._source.prepareTile)for(const r in this._tiles){const s=this._tiles[r];this._source.prepareTile(s)&&this.map.painter.terrain&&this.map.painter.terrain._clearRenderCacheForTile(this.id,s.tileID),s.upload(e),s.prepare(this.map.style.imageManager)}else for(const r in this._tiles){const s=this._tiles[r];s.upload(e),s.prepare(this.map.style.imageManager)}}getIds(){return ze(this._tiles).map(e=>e.tileID).sort(P_).map(e=>e.key)}getRenderableIds(e){const r=[];for(const s in this._tiles)this._isIdRenderable(+s,e)&&r.push(this._tiles[s]);return e?r.sort((s,c)=>{const f=s.tileID,_=c.tileID,x=new I(f.canonical.x,f.canonical.y)._rotate(this.transform.angle),E=new I(_.canonical.x,_.canonical.y)._rotate(this.transform.angle);return f.overscaledZ-_.overscaledZ||E.y-x.y||E.x-x.x}).map(s=>s.tileID.key):r.map(s=>s.tileID).sort(P_).map(s=>s.key)}hasRenderableParent(e){const r=this.findLoadedParent(e,0);return!!r&&this._isIdRenderable(r.tileID.key)}_isIdRenderable(e,r){return this._tiles[e]&&this._tiles[e].hasData()&&!this._coveredTiles[e]&&(r||!this._tiles[e].holdingForFade())}reload(){if(this._paused)this._shouldReloadOnResume=!0;else{this._cache.reset();for(const e in this._tiles)this._tiles[e].state!=="errored"&&this._reloadTile(+e,"reloading")}}_reloadTile(e,r){const s=this._tiles[e];s&&(s.state!=="loading"&&(s.state=r),this._loadTile(s,this._tileLoaded.bind(this,s,e,r)))}_tileLoaded(e,r,s,c){if(c)if(e.state="errored",c.status!==404)this._source.fire(new ji(c,{tile:e}));else if(this._source.type==="raster-dem"&&this.usedForTerrain&&this.map.painter.terrain){const f=this.map.painter.terrain;this.update(this.transform,f.getScaledDemTileSize(),!0),f.resetTileLookupCache(this.id)}else this.update(this.transform);else e.timeAdded=nn.now(),s==="expired"&&(e.refreshedUponExpiration=!0),this._setTileReloadTimer(r,e),this._source.type==="raster-dem"&&e.dem&&this._backfillDEM(e),this._state.initializeTileState(e,this.map?this.map.painter:null),this._source.fire(new Ti("data",{dataType:"source",tile:e,coord:e.tileID,sourceCacheId:this.id}))}_backfillDEM(e){const r=this.getRenderableIds();for(let c=0;c<r.length;c++){const f=r[c];if(e.neighboringTiles&&e.neighboringTiles[f]){const _=this.getTileByID(f);s(e,_),s(_,e)}}function s(c,f){if(!c.dem||c.dem.borderReady)return;c.needsHillshadePrepare=!0,c.needsDEMTextureUpload=!0;let _=f.tileID.canonical.x-c.tileID.canonical.x;const x=f.tileID.canonical.y-c.tileID.canonical.y,E=Math.pow(2,c.tileID.canonical.z),A=f.tileID.key;_===0&&x===0||Math.abs(x)>1||(Math.abs(_)>1&&(Math.abs(_+E)===1?_+=E:Math.abs(_-E)===1&&(_-=E)),f.dem&&c.dem&&(c.dem.backfillBorder(f.dem,_,x),c.neighboringTiles&&c.neighboringTiles[A]&&(c.neighboringTiles[A].backfilled=!0)))}}getTile(e){return this.getTileByID(e.key)}getTileByID(e){return this._tiles[e]}_retainLoadedChildren(e,r,s,c){for(const f in this._tiles){let _=this._tiles[f];if(c[f]||!_.hasData()||_.tileID.overscaledZ<=r||_.tileID.overscaledZ>s)continue;let x=_.tileID;for(;_&&_.tileID.overscaledZ>r+1;){const A=_.tileID.scaledTo(_.tileID.overscaledZ-1);_=this._tiles[A.key],_&&_.hasData()&&(x=A)}let E=x;for(;E.overscaledZ>r;)if(E=E.scaledTo(E.overscaledZ-1),e[E.key]){c[x.key]=x;break}}}findLoadedParent(e,r){if(e.key in this._loadedParentTiles){const s=this._loadedParentTiles[e.key];return s&&s.tileID.overscaledZ>=r?s:null}for(let s=e.overscaledZ-1;s>=r;s--){const c=e.scaledTo(s),f=this._getLoadedTile(c);if(f)return f}}_getLoadedTile(e){const r=this._tiles[e.key];return r&&r.hasData()?r:this._cache.getByKey(this._source.reparseOverscaled?e.wrapped().key:e.canonical.key)}updateCacheSize(e,r){r=r||this._source.tileSize;const s=Math.ceil(e.width/r)+1,c=Math.ceil(e.height/r)+1,f=Math.floor(s*c*5),_=typeof this._minTileCacheSize=="number"?Math.max(this._minTileCacheSize,f):f,x=typeof this._maxTileCacheSize=="number"?Math.min(this._maxTileCacheSize,_):_;this._cache.setMaxSize(x)}handleWrapJump(e){const r=Math.round((e-(this._prevLng===void 0?e:this._prevLng))/360);if(this._prevLng=e,r){const s={};for(const c in this._tiles){const f=this._tiles[c];f.tileID=f.tileID.unwrapTo(f.tileID.wrap+r),s[f.tileID.key]=f}this._tiles=s;for(const c in this._timers)clearTimeout(this._timers[c]),delete this._timers[c];for(const c in this._tiles)this._setTileReloadTimer(+c,this._tiles[c])}}update(e,r,s){if(this.transform=e,!this._sourceLoaded||this._paused||this.transform.freezeTileCoverage||this.usedForTerrain&&!s)return;let c;this.updateCacheSize(e,r),this.transform.projection.name!=="globe"&&this.handleWrapJump(this.transform.center.lng),this._coveredTiles={},this.used||this.usedForTerrain?this._source.tileID?c=e.getVisibleUnwrappedCoordinates(this._source.tileID).map(x=>new Zr(x.canonical.z,x.wrap,x.canonical.z,x.canonical.x,x.canonical.y)):(c=e.coveringTiles({tileSize:r||this._source.tileSize,minzoom:this._source.minzoom,maxzoom:this._source.maxzoom,roundZoom:this._source.roundZoom&&!s,reparseOverscaled:this._source.reparseOverscaled,isTerrainDEM:this.usedForTerrain}),this._source.hasTile&&(c=c.filter(x=>this._source.hasTile(x)))):c=[];const f=this._updateRetainedTiles(c);if(D_(this._source.type)&&c.length!==0){const x={},E={},A=Object.keys(f);for(const L of A){const B=f[L],U=this._tiles[L];if(!U||U.fadeEndTime&&U.fadeEndTime<=nn.now())continue;const N=this.findLoadedParent(B,Math.max(B.overscaledZ-Oa.maxOverzooming,this._source.minzoom));N&&(this._addTile(N.tileID),x[N.tileID.key]=N.tileID),E[L]=B}const C=c[c.length-1].overscaledZ;for(const L in this._tiles){const B=this._tiles[L];if(f[L]||!B.hasData())continue;let U=B.tileID;for(;U.overscaledZ>C;){U=U.scaledTo(U.overscaledZ-1);const N=this._tiles[U.key];if(N&&N.hasData()&&E[U.key]){f[L]=B.tileID;break}}}for(const L in x)f[L]||(this._coveredTiles[L]=!0,f[L]=x[L])}for(const x in f)this._tiles[x].clearFadeHold();const _=function(x,E){const A=[];for(const C in x)C in E||A.push(C);return A}(this._tiles,f);for(const x of _){const E=this._tiles[x];E.hasSymbolBuckets&&!E.holdingForFade()?E.setHoldDuration(this.map._fadeDuration):E.hasSymbolBuckets&&!E.symbolFadeFinished()||this._removeTile(+x)}this._updateLoadedParentTileCache(),this._onlySymbols&&this._source.afterUpdate&&this._source.afterUpdate()}releaseSymbolFadeTiles(){for(const e in this._tiles)this._tiles[e].holdingForFade()&&this._removeTile(+e)}_updateRetainedTiles(e){const r={};if(e.length===0)return r;const s={},c=e.reduce((A,C)=>Math.min(A,C.overscaledZ),1/0),f=e[0].overscaledZ,_=Math.max(f-Oa.maxOverzooming,this._source.minzoom),x=Math.max(f+Oa.maxUnderzooming,this._source.minzoom),E={};for(const A of e){const C=this._addTile(A);r[A.key]=A,C.hasData()||c<this._source.maxzoom&&(E[A.key]=A)}this._retainLoadedChildren(E,c,x,r);for(const A of e){let C=this._tiles[A.key];if(C.hasData())continue;if(A.canonical.z>=this._source.maxzoom){const B=A.children(this._source.maxzoom)[0],U=this.getTile(B);if(U&&U.hasData()){r[B.key]=B;continue}}else{const B=A.children(this._source.maxzoom);if(r[B[0].key]&&r[B[1].key]&&r[B[2].key]&&r[B[3].key])continue}let L=C.wasRequested();for(let B=A.overscaledZ-1;B>=_;--B){const U=A.scaledTo(B);if(s[U.key]||(s[U.key]=!0,C=this.getTile(U),!C&&L&&(C=this._addTile(U)),C&&(r[U.key]=U,L=C.wasRequested(),C.hasData())))break}}return r}_updateLoadedParentTileCache(){this._loadedParentTiles={};for(const e in this._tiles){const r=[];let s,c=this._tiles[e].tileID;for(;c.overscaledZ>0;){if(c.key in this._loadedParentTiles){s=this._loadedParentTiles[c.key];break}r.push(c.key);const f=c.scaledTo(c.overscaledZ-1);if(s=this._getLoadedTile(f),s)break;c=f}for(const f of r)this._loadedParentTiles[f]=s}}_addTile(e){let r=this._tiles[e.key];if(r)return this._source.prepareTile&&this._source.prepareTile(r),r;r=this._cache.getAndRemove(e),r&&(this._setTileReloadTimer(e.key,r),r.tileID=e,this._state.initializeTileState(r,this.map?this.map.painter:null),this._cacheTimers[e.key]&&(clearTimeout(this._cacheTimers[e.key]),delete this._cacheTimers[e.key],this._setTileReloadTimer(e.key,r)));const s=Boolean(r);if(!s){const c=this.map?this.map.painter:null;r=new cd(e,this._source.tileSize*e.overscaleFactor(),this.transform.tileZoom,c,this._isRaster),this._source.prepareTile&&this._source.prepareTile(r)||this._loadTile(r,this._tileLoaded.bind(this,r,e.key,r.state))}return r?(r.uses++,this._tiles[e.key]=r,s||this._source.fire(new Ti("dataloading",{tile:r,coord:r.tileID,dataType:"source"})),r):null}_setTileReloadTimer(e,r){e in this._timers&&(clearTimeout(this._timers[e]),delete this._timers[e]);const s=r.getExpiryTimeout();s&&(this._timers[e]=setTimeout(()=>{this._reloadTile(e,"expired"),delete this._timers[e]},s))}_removeTile(e){const r=this._tiles[e];r&&(r.uses--,delete this._tiles[e],this._timers[e]&&(clearTimeout(this._timers[e]),delete this._timers[e]),r.uses>0||(r.hasData()&&r.state!=="reloading"?this._cache.add(r.tileID,r,r.getExpiryTimeout()):(r.aborted=!0,this._abortTile(r),this._unloadTile(r))))}clearTiles(){this._shouldReloadOnResume=!1,this._paused=!1;for(const e in this._tiles)this._removeTile(+e);this._source._clear&&this._source._clear(),this._cache.reset(),this.map&&this.usedForTerrain&&this.map.painter.terrain&&this.map.painter.terrain.resetTileLookupCache(this.id)}tilesIn(e,r,s){const c=[],f=this.transform;if(!f)return c;const _=f.projection.name==="globe",x=Ia(f.center.lng);for(const E in this._tiles){const A=this._tiles[E];if(s&&A.clearQueryDebugViz(),A.holdingForFade())continue;let C;if(_){const L=A.tileID.canonical;if(L.z===0){const B=[Math.abs(re(x,...xu(L,-1))-x),Math.abs(re(x,...xu(L,1))-x)];C=[0,2*B.indexOf(Math.min(...B))-1]}else{const B=[Math.abs(re(x,...xu(L,-1))-x),Math.abs(re(x,...xu(L,0))-x),Math.abs(re(x,...xu(L,1))-x)];C=[B.indexOf(Math.min(...B))-1]}}else C=[0];for(const L of C){const B=e.containsTile(A,f,r,L);B&&c.push(B)}}return c}getVisibleCoordinates(e){const r=this.getRenderableIds(e).map(s=>this._tiles[s].tileID);for(const s of r)s.projMatrix=this.transform.calculateProjMatrix(s.toUnwrapped());return r}hasTransition(){if(this._source.hasTransition())return!0;if(D_(this._source.type))for(const e in this._tiles){const r=this._tiles[e];if(r.fadeEndTime!==void 0&&r.fadeEndTime>=nn.now())return!0}return!1}setFeatureState(e,r,s){this._state.updateState(e=e||"_geojsonTileLayer",r,s)}removeFeatureState(e,r,s){this._state.removeFeatureState(e=e||"_geojsonTileLayer",r,s)}getFeatureState(e,r){return this._state.getState(e=e||"_geojsonTileLayer",r)}setDependencies(e,r,s){const c=this._tiles[e];c&&c.setDependencies(r,s)}reloadTilesForDependencies(e,r){for(const s in this._tiles)this._tiles[s].hasDependency(e,r)&&this._reloadTile(+s,"reloading");this._cache.filter(s=>!s.hasDependency(e,r))}_preloadTiles(e,r){const s=new Map,c=Array.isArray(e)?e:[e],f=this.map.painter.terrain,_=this.usedForTerrain&&f?f.getScaledDemTileSize():this._source.tileSize;for(const x of c){const E=x.coveringTiles({tileSize:_,minzoom:this._source.minzoom,maxzoom:this._source.maxzoom,roundZoom:this._source.roundZoom&&!this.usedForTerrain,reparseOverscaled:this._source.reparseOverscaled,isTerrainDEM:this.usedForTerrain});for(const A of E)s.set(A.key,A);this.usedForTerrain&&x.updateElevation(!1)}Je(Array.from(s.values()),(x,E)=>{const A=new cd(x,this._source.tileSize*x.overscaleFactor(),this.transform.tileZoom,this.map.painter,this._isRaster);this._loadTile(A,C=>{this._source.type==="raster-dem"&&A.dem&&this._backfillDEM(A),E(C,A)})},r)}}function P_(i,e){const r=Math.abs(2*i.wrap)-+(i.wrap<0),s=Math.abs(2*e.wrap)-+(e.wrap<0);return i.overscaledZ-e.overscaledZ||s-r||e.canonical.y-i.canonical.y||e.canonical.x-i.canonical.x}function D_(i){return i==="raster"||i==="image"||i==="video"}function xu(i,e){const r=1<<i.z;return[i.x/r+e,(i.x+1)/r+e]}Oa.maxOverzooming=10,Oa.maxUnderzooming=3;class bp{constructor(e,r,s){this._demTile=e,this._dem=this._demTile.dem,this._scale=r,this._offset=s}static create(e,r,s){const c=s||e.findDEMTileFor(r);if(!c||!c.dem)return;const f=c.dem,_=c.tileID,x=1<<r.canonical.z-_.canonical.z;return new bp(c,c.tileSize/qt/x,[(r.canonical.x/x-_.canonical.x)*f.dim,(r.canonical.y/x-_.canonical.y)*f.dim])}tileCoordToPixel(e,r){const s=r*this._scale+this._offset[1],c=Math.floor(e*this._scale+this._offset[0]),f=Math.floor(s);return new I(c,f)}getElevationAt(e,r,s,c){const f=e*this._scale+this._offset[0],_=r*this._scale+this._offset[1],x=Math.floor(f),E=Math.floor(_),A=this._dem;return c=!!c,s?bi(bi(A.get(x,E,c),A.get(x,E+1,c),_-E),bi(A.get(x+1,E,c),A.get(x+1,E+1,c),_-E),f-x):A.get(x,E,c)}getElevationAtPixel(e,r,s){return this._dem.get(e,r,!!s)}getMeterToDEM(e){return(1<<this._demTile.tileID.canonical.z)*Fn(1,e)*this._dem.stride}}class L_{constructor(e,r){this.tileID=e,this.x=e.canonical.x,this.y=e.canonical.y,this.z=e.canonical.z,this.grid=new As(qt,16,0),this.featureIndexArray=new C1,this.promoteId=r}insert(e,r,s,c,f,_=0){const x=this.featureIndexArray.length;this.featureIndexArray.emplaceBack(s,c,f,_);const E=this.grid;for(let A=0;A<r.length;A++){const C=r[A],L=[1/0,1/0,-1/0,-1/0];for(let B=0;B<C.length;B++){const U=C[B];L[0]=Math.min(L[0],U.x),L[1]=Math.min(L[1],U.y),L[2]=Math.max(L[2],U.x),L[3]=Math.max(L[3],U.y)}L[0]<qt&&L[1]<qt&&L[2]>=0&&L[3]>=0&&E.insert(x,L[0],L[1],L[2],L[3])}}loadVTLayers(){if(!this.vtLayers){this.vtLayers=new La.VectorTile(new uu(this.rawTileData)).layers,this.sourceLayerCoder=new v_(this.vtLayers?Object.keys(this.vtLayers).sort():["_geojsonTileLayer"]),this.vtFeatures={};for(const e in this.vtLayers)this.vtFeatures[e]=[]}return this.vtLayers}query(e,r,s,c){this.loadVTLayers();const f=e.params||{},_=Wo(f.filter),x=e.tileResult,E=e.transform,A=x.bufferedTilespaceBounds,C=this.grid.query(A.min.x,A.min.y,A.max.x,A.max.y,(N,$,te,ue)=>X1(x.bufferedTilespaceGeometry,N,$,te,ue));C.sort(vx);let L=null;E.elevation&&C.length>0&&(L=bp.create(E.elevation,this.tileID));const B={};let U;for(let N=0;N<C.length;N++){const $=C[N];if($===U)continue;U=$;const te=this.featureIndexArray.get($);let ue=null;this.loadMatchingFeature(B,te,_,f.layers,f.availableImages,r,s,c,(ve,ye,xe,Ee=0)=>(ue||(ue=Jo(ve,this.tileID.canonical,e.tileTransform)),ye.queryIntersectsFeature(x,ve,xe,ue,this.z,e.transform,e.pixelPosMatrix,L,Ee)))}return B}loadMatchingFeature(e,r,s,c,f,_,x,E,A){const{featureIndex:C,bucketIndex:L,sourceLayerIndex:B,layoutVertexArrayOffset:U}=r,N=this.bucketLayerIDs[L];if(c&&!function(ve,ye){for(let xe=0;xe<ve.length;xe++)if(ye.indexOf(ve[xe])>=0)return!0;return!1}(c,N))return;const $=this.sourceLayerCoder.decode(B),te=this.vtLayers[$].feature(C);if(s.needGeometry){const ve=Ca(te,!0);if(!s.filter(new ne(this.tileID.overscaledZ),ve,this.tileID.canonical))return}else if(!s.filter(new ne(this.tileID.overscaledZ),te))return;const ue=this.getId(te,$);for(let ve=0;ve<N.length;ve++){const ye=N[ve];if(c&&c.indexOf(ye)<0)continue;const xe=_[ye];if(!xe)continue;let Ee={};ue!==void 0&&E&&(Ee=E.getState(xe.sourceLayer||"_geojsonTileLayer",ue));const Se=Pe({},x[ye]);Se.paint=R_(Se.paint,xe.paint,te,Ee,f),Se.layout=R_(Se.layout,xe.layout,te,Ee,f);const qe=!A||A(te,xe,Ee,U);if(!qe)continue;const We=new x_(te,this.z,this.x,this.y,ue);We.layer=Se;let tt=e[ye];tt===void 0&&(tt=e[ye]=[]),tt.push({featureIndex:C,feature:We,intersectionZ:qe})}}lookupSymbolFeatures(e,r,s,c,f,_,x,E){const A={};this.loadVTLayers();const C=Wo(f);for(const L of e)this.loadMatchingFeature(A,{bucketIndex:s,sourceLayerIndex:c,featureIndex:L,layoutVertexArrayOffset:0},C,_,x,E,r);return A}loadFeature(e){const{featureIndex:r,sourceLayerIndex:s}=e;this.loadVTLayers();const c=this.sourceLayerCoder.decode(s),f=this.vtFeatures[c];if(f[r])return f[r];const _=this.vtLayers[c].feature(r);return f[r]=_,_}hasLayer(e){for(const r of this.bucketLayerIDs)for(const s of r)if(e===s)return!0;return!1}getId(e,r){let s=e.id;return this.promoteId&&(s=e.properties[typeof this.promoteId=="string"?this.promoteId:this.promoteId[r]],typeof s=="boolean"&&(s=Number(s))),s}}function R_(i,e,r,s,c){return _t(i,(f,_)=>{const x=e instanceof je?e.get(_):null;return x&&x.evaluate?x.evaluate(r,s,c):x})}function vx(i,e){return e-i}Ct(L_,"FeatureIndex",{omit:["rawTileData","sourceLayerCoder"]});class B_{constructor(e){const r={},s=[];for(const x in e){const E=e[x],A=r[x]={};for(const C in E.glyphs){const L=E.glyphs[+C];if(!L||L.bitmap.width===0||L.bitmap.height===0)continue;const B=L.metrics.localGlyph?2:1,U={x:0,y:0,w:L.bitmap.width+2*B,h:L.bitmap.height+2*B};s.push(U),A[C]=U}}const{w:c,h:f}=Zf(s),_=new Qo({width:c||1,height:f||1});for(const x in e){const E=e[x];for(const A in E.glyphs){const C=E.glyphs[+A];if(!C||C.bitmap.width===0||C.bitmap.height===0)continue;const L=r[x][A],B=C.metrics.localGlyph?2:1;Qo.copy(C.bitmap,_,{x:0,y:0},{x:L.x+B,y:L.y+B},C.bitmap)}}this.image=_,this.positions=r}}Ct(B_,"GlyphAtlas");class xx{constructor(e){this.tileID=new Zr(e.tileID.overscaledZ,e.tileID.wrap,e.tileID.canonical.z,e.tileID.canonical.x,e.tileID.canonical.y),this.tileZoom=e.tileZoom,this.uid=e.uid,this.zoom=e.zoom,this.canonical=e.tileID.canonical,this.pixelRatio=e.pixelRatio,this.tileSize=e.tileSize,this.source=e.source,this.overscaling=this.tileID.overscaleFactor(),this.showCollisionBoxes=e.showCollisionBoxes,this.collectResourceTiming=!!e.collectResourceTiming,this.returnDependencies=!!e.returnDependencies,this.promoteId=e.promoteId,this.enableTerrain=!!e.enableTerrain,this.isSymbolTile=e.isSymbolTile,this.tileTransform=Ba(e.tileID.canonical,e.projection),this.projection=e.projection}parse(e,r,s,c,f){this.status="parsing",this.data=e,this.collisionBoxArray=new yf;const _=new v_(Object.keys(e.layers).sort()),x=new L_(this.tileID,this.promoteId);x.bucketLayerIDs=[];const E={},A=new ld(256,256),C={featureIndex:x,iconDependencies:{},patternDependencies:{},glyphDependencies:{},lineAtlas:A,availableImages:s},L=r.familiesBySource[this.source];for(const Ee in L){const Se=e.layers[Ee];if(!Se)continue;let qe=!1,We=!1;for(const Be of L[Ee])Be[0].type==="symbol"?qe=!0:We=!0;if(this.isSymbolTile===!0&&!qe||this.isSymbolTile===!1&&!We)continue;Se.version===1&&Kt(`Vector tile source "${this.source}" layer "${Ee}" does not use vector tile spec v2 and therefore may have some rendering errors.`);const tt=_.encode(Ee),at=[];for(let Be=0;Be<Se.length;Be++){const et=Se.feature(Be),lt=x.getId(et,Ee);at.push({feature:et,id:lt,index:Be,sourceLayerIndex:tt})}for(const Be of L[Ee]){const et=Be[0];this.isSymbolTile!==void 0&&et.type==="symbol"!==this.isSymbolTile||et.minzoom&&this.zoom<Math.floor(et.minzoom)||et.maxzoom&&this.zoom>=et.maxzoom||et.visibility!=="none"&&(dd(Be,this.zoom,s),(E[et.id]=et.createBucket({index:x.bucketLayerIDs.length,layers:Be,zoom:this.zoom,canonical:this.canonical,pixelRatio:this.pixelRatio,overscaling:this.overscaling,collisionBoxArray:this.collisionBoxArray,sourceLayerIndex:tt,sourceID:this.source,enableTerrain:this.enableTerrain,projection:this.projection.spec,availableImages:s})).populate(at,C,this.tileID.canonical,this.tileTransform),x.bucketLayerIDs.push(Be.map(lt=>lt.id)))}}let B,U,N,$;A.trim();const te={type:"maybePrepare",isSymbolTile:this.isSymbolTile,zoom:this.zoom},ue=_t(C.glyphDependencies,Ee=>Object.keys(Ee).map(Number));Object.keys(ue).length?c.send("getGlyphs",{uid:this.uid,stacks:ue},(Ee,Se)=>{B||(B=Ee,U=Se,xe.call(this))},void 0,!1,te):U={};const ve=Object.keys(C.iconDependencies);ve.length?c.send("getImages",{icons:ve,source:this.source,tileID:this.tileID,type:"icons"},(Ee,Se)=>{B||(B=Ee,N=Se,xe.call(this))},void 0,!1,te):N={};const ye=Object.keys(C.patternDependencies);function xe(){if(B)return f(B);if(U&&N&&$){const Ee=new B_(U),Se=new Om(N,$);for(const qe in E){const We=E[qe];We instanceof Bs?(dd(We.layers,this.zoom,s),jv(We,U,Ee.positions,N,Se.iconPositions,this.showCollisionBoxes,s,this.tileID.canonical,this.tileZoom,this.projection)):We.hasPattern&&(We instanceof np||We instanceof ep||We instanceof su)&&(dd(We.layers,this.zoom,s),We.addFeatures(C,this.tileID.canonical,Se.patternPositions,s,this.tileTransform))}this.status="done",f(null,{buckets:ze(E).filter(qe=>!qe.isEmpty()),featureIndex:x,collisionBoxArray:this.collisionBoxArray,glyphAtlasImage:Ee.image,lineAtlas:A,imageAtlas:Se,glyphMap:this.returnDependencies?U:null,iconMap:this.returnDependencies?N:null,glyphPositions:this.returnDependencies?Ee.positions:null})}}ye.length?c.send("getImages",{icons:ye,source:this.source,tileID:this.tileID,type:"patterns"},(Ee,Se)=>{B||(B=Ee,$=Se,xe.call(this))},void 0,!1,te):$={},xe.call(this)}}function dd(i,e,r){const s=new ne(e);for(const c of i)c.recalculate(s,r)}class O_{constructor(e){this.entries={},this.scheduler=e}request(e,r,s,c){const f=this.entries[e]=this.entries[e]||{callbacks:[]};if(f.result){const[_,x]=f.result;return this.scheduler?this.scheduler.add(()=>{c(_,x)},r):c(_,x),()=>{}}return f.callbacks.push(c),f.cancel||(f.cancel=s((_,x)=>{f.result=[_,x];for(const E of f.callbacks)this.scheduler?this.scheduler.add(()=>{E(_,x)},r):E(_,x);setTimeout(()=>delete this.entries[e],3e3)})),()=>{f.result||(f.callbacks=f.callbacks.filter(_=>_!==c),f.callbacks.length||(f.cancel(),delete this.entries[e]))}}}function F_(i,e,r){const s=JSON.stringify(i.request);return i.data&&(this.deduped.entries[s]={result:[null,i.data]}),this.deduped.request(s,{type:"parseTile",isSymbolTile:i.isSymbolTile,zoom:i.tileZoom},c=>{const f=Te(i.request,(_,x,E,A)=>{_?c(_):x&&c(null,{vectorTile:r?void 0:new La.VectorTile(new uu(x)),rawData:x,cacheControl:E,expires:A})});return()=>{f.cancel(),c()}},e)}n.ARRAY_TYPE=hn,n.AUTH_ERR_MSG=Yr,n.Aabb=An,n.Actor=class{constructor(i,e,r){this.target=i,this.parent=e,this.mapId=r,this.callbacks={},this.cancelCallbacks={},At(["receive"],this),this.target.addEventListener("message",this.receive,!1),this.globalScope=Zt()?i:w,this.scheduler=new mx}send(i,e,r,s,c=!1,f){const _=Math.round(1e18*Math.random()).toString(36).substring(0,10);r&&(r.metadata=f,this.callbacks[_]=r);const x=vn(this.globalScope)?void 0:[];return this.target.postMessage({id:_,type:i,hasCallback:!!r,targetMapId:s,mustQueue:c,sourceMapId:this.mapId,data:wa(e,x)},x),{cancel:()=>{r&&delete this.callbacks[_],this.target.postMessage({id:_,type:"<cancel>",targetMapId:s,sourceMapId:this.mapId})}}}receive(i){const e=i.data,r=e.id;if(r&&(!e.targetMapId||this.mapId===e.targetMapId))if(e.type==="<cancel>"){const s=this.cancelCallbacks[r];delete this.cancelCallbacks[r],s&&s.cancel()}else if(e.mustQueue||Zt()){const s=this.callbacks[r];this.cancelCallbacks[r]=this.scheduler.add(()=>this.processTask(r,e),s&&s.metadata||{type:"message"})}else this.processTask(r,e)}processTask(i,e){if(e.type==="<response>"){const r=this.callbacks[i];delete this.callbacks[i],r&&(e.error?r(Ea(e.error)):r(null,Ea(e.data)))}else{const r=vn(this.globalScope)?void 0:[],s=e.hasCallback?(f,_)=>{delete this.cancelCallbacks[i],this.target.postMessage({id:i,type:"<response>",sourceMapId:this.mapId,error:f?wa(f):null,data:wa(_,r)},r)}:f=>{},c=Ea(e.data);if(this.parent[e.type])this.parent[e.type](e.sourceMapId,c,s);else if(this.parent.getWorkerSource){const f=e.type.split(".");this.parent.getWorkerSource(e.sourceMapId,f[0],c.source)[f[1]](c,s)}else s(new Error(`Could not find function ${e.type}`))}}remove(){this.scheduler.remove(),this.target.removeEventListener("message",this.receive,!1)}},n.CanonicalTileID=ip,n.Color=tr,n.ColorMode=Mo,n.CullFaceMode=oo,n.DEMData=xp,n.DataConstantProperty=Ue,n.DedupedRequest=O_,n.DepthMode=ec,n.EXTENT=qt,n.Elevation=class{isDataAvailableAtPoint(i){const e=this._source();if(!e||i.y<0||i.y>1)return!1;const r=e.getSource().maxzoom,s=1<<r,c=Math.floor(i.x),f=Math.floor((i.x-c)*s),_=Math.floor(i.y*s),x=this.findDEMTileFor(new Zr(r,c,r,f,_));return!(!x||!x.dem)}getAtPointOrZero(i,e=0){return this.getAtPoint(i,e)||0}getAtPoint(i,e,r=!0){e==null&&(e=null);const s=this._source();if(!s||i.y<0||i.y>1)return e;const c=s.getSource().maxzoom,f=1<<c,_=Math.floor(i.x),x=i.x-_,E=new Zr(c,_,c,Math.floor(x*f),Math.floor(i.y*f)),A=this.findDEMTileFor(E);if(!A||!A.dem)return e;const C=A.dem,L=1<<A.tileID.canonical.z,B=(x*L-A.tileID.canonical.x)*C.dim,U=(i.y*L-A.tileID.canonical.y)*C.dim,N=Math.floor(B),$=Math.floor(U);return(r?this.exaggeration():1)*bi(bi(C.get(N,$),C.get(N,$+1),U-$),bi(C.get(N+1,$),C.get(N+1,$+1),U-$),B-N)}getAtTileOffset(i,e,r){const s=1<<i.canonical.z;return this.getAtPointOrZero(new Nl(i.wrap+(i.canonical.x+e/qt)/s,(i.canonical.y+r/qt)/s))}getAtTileOffsetFunc(i,e,r,s){return c=>{const f=this.getAtTileOffset(i,c.x,c.y),_=s.upVector(i.canonical,c.x,c.y);return wo(_,_,f*s.upVectorScale(i.canonical,e,r).metersToTile),_}}getForTilePoints(i,e,r,s){const c=bp.create(this,i,s);return!!c&&(e.forEach(f=>{f[2]=this.exaggeration()*c.getElevationAt(f[0],f[1],r)}),!0)}getMinMaxForTile(i){const e=this.findDEMTileFor(i);if(!e||!e.dem)return null;const r=e.dem.tree,s=e.tileID,c=1<<i.canonical.z-s.canonical.z;let f=i.canonical.x/c-s.canonical.x,_=i.canonical.y/c-s.canonical.y,x=0;for(let E=0;E<i.canonical.z-s.canonical.z&&!r.leaves[x];E++){f*=2,_*=2;const A=2*Math.floor(_)+Math.floor(f);x=r.childOffsets[x]+A,f%=1,_%=1}return{min:this.exaggeration()*r.minimums[x],max:this.exaggeration()*r.maximums[x]}}getMinElevationBelowMSL(){throw new Error("Pure virtual method called.")}raycast(i,e,r){throw new Error("Pure virtual method called.")}pointCoordinate(i){throw new Error("Pure virtual method called.")}_source(){throw new Error("Pure virtual method called.")}exaggeration(){throw new Error("Pure virtual method called.")}findDEMTileFor(i){throw new Error("Pure virtual method called.")}get visibleDemTiles(){throw new Error("Getter must be implemented in subclass.")}},n.ErrorEvent=ji,n.EvaluationParameters=ne,n.Event=Ti,n.Evented=ki,n.FillExtrusionBucket=su,n.Frustum=Lf,n.FrustumCorners=Df,n.GLOBE_METERS_TO_ECEF=ed,n.GLOBE_RADIUS=Ra,n.GLOBE_SCALE_MATCH_LATITUDE=45,n.GLOBE_ZOOM_THRESHOLD_MAX=6,n.GLOBE_ZOOM_THRESHOLD_MIN=5,n.GlobeSharedBuffers=class{constructor(i){this._createGrid(i),this._createPoles(i)}destroy(){this._poleIndexBuffer.destroy(),this._gridBuffer.destroy(),this._gridIndexBuffer.destroy(),this._poleNorthVertexBuffer.destroy(),this._poleSouthVertexBuffer.destroy();for(const i of this._poleSegments)i.destroy();for(const i of this._gridSegments)i.destroy();if(this._wireframeIndexBuffer){this._wireframeIndexBuffer.destroy();for(const i of this._wireframeSegments)i.destroy()}}_createGrid(i){const e=new Vt,r=new yi,s=65;for(let c=0;c<s;c++)for(let f=0;f<s;f++)e.emplaceBack(f,c);this._gridSegments=[];for(let c=0,f=0;c<Jl.length;c++){const _=Jl[c];for(let E=0;E<_;E++)for(let A=0;A<64;A++){const C=E*s+A;r.emplaceBack(C+1,C,C+s),r.emplaceBack(C+s,C+s+1,C+1)}const x=64*_*2;this._gridSegments.push(or.simpleSegment(0,f,(_+1)*s,x)),f+=x}this._gridBuffer=i.createVertexBuffer(e,fu.members),this._gridIndexBuffer=i.createIndexBuffer(r,!0)}_createPoles(i){const e=new yi;for(let c=0;c<=64;c++)e.emplaceBack(0,c+1,c+2);this._poleIndexBuffer=i.createIndexBuffer(e,!0);const r=new Ss,s=new Ss;this._poleSegments=[];for(let c=0,f=0;c<5;c++){const _=1<<c,x=512*_/Math.PI/2,E=360/_;r.emplaceBack(0,-x,0,0,0,.5,0),s.emplaceBack(0,-x,0,0,0,.5,1);for(let A=0;A<=64;A++){const C=A/64,L=bi(0,E,C),[B,U,N]=s_(Hv,Yv,L,x);r.emplaceBack(B,U,N,0,0,C,0),s.emplaceBack(B,U,N,0,0,C,1)}this._poleSegments.push(or.simpleSegment(f,0,66,64)),f+=66}this._poleNorthVertexBuffer=i.createVertexBuffer(r,r_,!1),this._poleSouthVertexBuffer=i.createVertexBuffer(s,r_,!1)}getGridBuffers(i){return[this._gridBuffer,this._gridIndexBuffer,this._gridSegments[i]]}getPoleBuffers(i){return[this._poleNorthVertexBuffer,this._poleSouthVertexBuffer,this._poleIndexBuffer,this._poleSegments[i]]}getWirefameBuffers(i,e){if(!this._wireframeSegments){const r=new hr,s=64,c=s+1;this._wireframeSegments=[];for(let f=0,_=0;f<Jl.length;f++){const x=Jl[f];for(let A=0;A<x;A++)for(let C=0;C<s;C++){const L=A*c+C;r.emplaceBack(L,L+1),r.emplaceBack(L,L+c),r.emplaceBack(L,L+c+1)}const E=x*s*3;this._wireframeSegments.push(or.simpleSegment(0,_,(x+1)*c,E)),_+=E}this._wireframeIndexBuffer=i.createIndexBuffer(r)}return[this._gridBuffer,this._wireframeIndexBuffer,this._wireframeSegments[e]]}},n.GlyphManager=Yl,n.ImagePosition=$f,n.LineAtlas=ld,n.LngLat=Di,n.LngLatBounds=Cs,n.LocalGlyphMode=Yf,n.MAX_MERCATOR_LATITUDE=xo,n.MercatorCoordinate=Nl,n.ONE_EM=Pr,n.OverscaledTileID=Zr,n.Properties=Ke,n.RGBAImage=fn,n.Ray=Pf,n.RequestManager=class{constructor(i,e,r){this._transformRequestFn=i,this._customAccessToken=e,this._silenceAuthErrors=!!r,this._createSkuToken()}_createSkuToken(){const i=function(){let e="";for(let r=0;r<10;r++)e+="0123456789abcdefghijklmnopqrstuvwxyzABCDEFGHIJKLMNOPQRSTUVWXYZ"[Math.floor(62*Math.random())];return{token:["1",Ys,e].join(""),tokenExpiresAt:Date.now()+432e5}}();this._skuToken=i.token,this._skuTokenExpiresAt=i.tokenExpiresAt}_isSkuTokenExpired(){return Date.now()>this._skuTokenExpiresAt}transformRequest(i,e){return this._transformRequestFn&&this._transformRequestFn(i,e)||{url:i}}normalizeStyleURL(i,e){if(!Dn(i))return i;const r=Kr(i);return r.path=`/styles/v1${r.path}`,this._makeAPIURL(r,this._customAccessToken||e)}normalizeGlyphsURL(i,e){if(!Dn(i))return i;const r=Kr(i);return r.path=`/fonts/v1${r.path}`,this._makeAPIURL(r,this._customAccessToken||e)}normalizeSourceURL(i,e,r,s){if(!Dn(i))return i;const c=Kr(i);return c.path=`/v4/${c.authority}.json`,c.params.push("secure"),r&&c.params.push(`language=${r}`),s&&c.params.push(`worldview=${s}`),this._makeAPIURL(c,this._customAccessToken||e)}normalizeSpriteURL(i,e,r,s){const c=Kr(i);return Dn(i)?(c.path=`/styles/v1${c.path}/sprite${e}${r}`,this._makeAPIURL(c,this._customAccessToken||s)):(c.path+=`${e}${r}`,Hn(c))}normalizeTileURL(i,e,r){if(this._isSkuTokenExpired()&&this._createSkuToken(),i&&!Dn(i))return i;const s=Kr(i);s.path=s.path.replace(/(\.(png|jpg)\d*)(?=$)/,`${e||r&&s.authority!=="raster"&&r===512?"@2x":""}${mo.supported?".webp":"$1"}`),s.authority==="raster"?s.path=`/${gi.RASTER_URL_PREFIX}${s.path}`:(s.path=s.path.replace(/^.+\/v4\//,"/"),s.path=`/${gi.TILE_URL_VERSION}${s.path}`);const c=this._customAccessToken||function(f){for(const _ of f){const x=_.match(/^access_token=(.*)$/);if(x)return x[1]}return null}(s.params)||gi.ACCESS_TOKEN;return gi.REQUIRE_ACCESS_TOKEN&&c&&this._skuToken&&s.params.push(`sku=${this._skuToken}`),this._makeAPIURL(s,c)}canonicalizeTileURL(i,e){const r=Kr(i);if(!r.path.match(/^(\/v4\/|\/raster\/v1\/)/)||!r.path.match(/\.[\w]+$/))return i;let s="mapbox://";r.path.match(/^\/raster\/v1\//)?s+=`raster/${r.path.replace(`/${gi.RASTER_URL_PREFIX}/`,"")}`:s+=`tiles/${r.path.replace(`/${gi.TILE_URL_VERSION}/`,"")}`;let c=r.params;return e&&(c=c.filter(f=>!f.match(/^access_token=/))),c.length&&(s+=`?${c.join("&")}`),s}canonicalizeTileset(i,e){const r=!!e&&Dn(e),s=[];for(const c of i.tiles||[])Fo(c)?s.push(this.canonicalizeTileURL(c,r)):s.push(c);return s}_makeAPIURL(i,e){const r="See https://www.mapbox.com/api-documentation/#access-tokens-and-token-scopes",s=Kr(gi.API_URL);if(i.protocol=s.protocol,i.authority=s.authority,i.protocol==="http"){const c=i.params.indexOf("secure");c>=0&&i.params.splice(c,1)}if(s.path!=="/"&&(i.path=`${s.path}${i.path}`),!gi.REQUIRE_ACCESS_TOKEN)return Hn(i);if(e=e||gi.ACCESS_TOKEN,!this._silenceAuthErrors){if(!e)throw new Error(`An API access token is required to use Mapbox GL. ${r}`);if(e[0]==="s")throw new Error(`Use a public access token (pk.*) with Mapbox GL, not a secret access token (sk.*). ${r}`)}return i.params=i.params.filter(c=>c.indexOf("access_token")===-1),i.params.push(`access_token=${e||""}`),Hn(i)}},n.ResourceType=me,n.SegmentVector=or,n.SourceCache=Oa,n.StencilMode=hd,n.StructArrayLayout1ui2=On,n.StructArrayLayout2f1f2i16=Mi,n.StructArrayLayout2i4=Vt,n.StructArrayLayout2ui4=hr,n.StructArrayLayout3f12=Ar,n.StructArrayLayout3ui6=yi,n.StructArrayLayout4i8=Ot,n.StructArrayLayout5f20=Ms,n.Texture=vu,n.Tile=cd,n.Transitionable=he,n.Uniform1f=Fh,n.Uniform1i=class extends Yo{constructor(i,e){super(i,e),this.current=0}set(i){this.current!==i&&(this.current=i,this.gl.uniform1i(this.location,i))}},n.Uniform2f=class extends Yo{constructor(i,e){super(i,e),this.current=[0,0]}set(i){i[0]===this.current[0]&&i[1]===this.current[1]||(this.current=i,this.gl.uniform2f(this.location,i[0],i[1]))}},n.Uniform3f=class extends Yo{constructor(i,e){super(i,e),this.current=[0,0,0]}set(i){i[0]===this.current[0]&&i[1]===this.current[1]&&i[2]===this.current[2]||(this.current=i,this.gl.uniform3f(this.location,i[0],i[1],i[2]))}},n.Uniform4f=O1,n.UniformColor=F1,n.UniformMatrix2f=class extends Yo{constructor(i,e){super(i,e),this.current=n2}set(i){for(let e=0;e<4;e++)if(i[e]!==this.current[e]){this.current=i,this.gl.uniformMatrix2fv(this.location,!1,i);break}}},n.UniformMatrix3f=class extends Yo{constructor(i,e){super(i,e),this.current=r2}set(i){for(let e=0;e<9;e++)if(i[e]!==this.current[e]){this.current=i,this.gl.uniformMatrix3fv(this.location,!1,i);break}}},n.UniformMatrix4f=class extends Yo{constructor(i,e){super(i,e),this.current=i2}set(i){if(i[12]!==this.current[12]||i[0]!==this.current[0])return this.current=i,void this.gl.uniformMatrix4fv(this.location,!1,i);for(let e=1;e<16;e++)if(i[e]!==this.current[e]){this.current=i,this.gl.uniformMatrix4fv(this.location,!1,i);break}}},n.UnwrappedTileID=Tm,n.ValidationError=kt,n.VectorTileWorkerSource=class extends ki{constructor(i,e,r,s,c){super(),this.actor=i,this.layerIndex=e,this.availableImages=r,this.loadVectorData=c||F_,this.loading={},this.loaded={},this.deduped=new O_(i.scheduler),this.isSpriteLoaded=s,this.scheduler=i.scheduler}loadTile(i,e){const r=i.uid,s=i&&i.request,c=s&&s.collectResourceTiming,f=this.loading[r]=new xx(i);f.abort=this.loadVectorData(i,(_,x)=>{const E=!this.loading[r];if(delete this.loading[r],E||_||!x)return f.status="done",E||(this.loaded[r]=f),e(_);const A=x.rawData,C={};x.expires&&(C.expires=x.expires),x.cacheControl&&(C.cacheControl=x.cacheControl),f.vectorTile=x.vectorTile||new La.VectorTile(new uu(A));const L=()=>{f.parse(f.vectorTile,this.layerIndex,this.availableImages,this.actor,(B,U)=>{if(B||!U)return e(B);const N={};if(c){const $=Lo(s);$.length>0&&(N.resourceTiming=JSON.parse(JSON.stringify($)))}e(null,Pe({rawTileData:A.slice(0)},U,C,N))})};this.isSpriteLoaded?L():this.once("isSpriteLoaded",()=>{this.scheduler?this.scheduler.add(L,{type:"parseTile",isSymbolTile:i.isSymbolTile,zoom:i.tileZoom}):L()}),this.loaded=this.loaded||{},this.loaded[r]=f})}reloadTile(i,e){const r=this.loaded,s=i.uid,c=this;if(r&&r[s]){const f=r[s];f.showCollisionBoxes=i.showCollisionBoxes,f.enableTerrain=!!i.enableTerrain,f.projection=i.projection,f.tileTransform=Ba(i.tileID.canonical,i.projection);const _=(x,E)=>{const A=f.reloadCallback;A&&(delete f.reloadCallback,f.parse(f.vectorTile,c.layerIndex,this.availableImages,c.actor,A)),e(x,E)};f.status==="parsing"?f.reloadCallback=_:f.status==="done"&&(f.vectorTile?f.parse(f.vectorTile,this.layerIndex,this.availableImages,this.actor,_):_())}}abortTile(i,e){const r=i.uid,s=this.loading[r];s&&(s.abort&&s.abort(),delete this.loading[r]),e()}removeTile(i,e){const r=this.loaded,s=i.uid;r&&r[s]&&delete r[s],e()}},n.WritingMode=Sn,n.ZoomHistory=Sh,n.add=Ps,n.addDynamicAttributes=gp,n.adjoint=function(i,e){var r=e[0],s=e[1],c=e[2],f=e[3],_=e[4],x=e[5],E=e[6],A=e[7],C=e[8];return i[0]=_*C-x*A,i[1]=c*A-s*C,i[2]=s*x-c*_,i[3]=x*E-f*C,i[4]=r*C-c*E,i[5]=c*f-r*x,i[6]=f*A-_*E,i[7]=s*E-r*A,i[8]=r*_-s*f,i},n.asyncAll=Je,n.bezier=ie,n.bindAll=At,n.boundsAttributes=w_,n.bufferConvexPolygon=function(i,e){const r=[];for(let s=0;s<i.length;s++){const c=$e(s-1,-1,i.length-1),f=$e(s+1,-1,i.length-1),_=i[s],x=i[f],E=i[c].sub(_).unit(),A=x.sub(_).unit(),C=A.angleWithSep(E.x,E.y),L=E.add(A).unit().mult(-1*e/Math.sin(C/2));r.push(_.add(L))}return r},n.cacheEntryPossiblyAdded=function(i){le++,le>Ja&&(i.getActor().send("enforceCacheSizeLimit",ls),le=0)},n.calculateGlobeLabelMatrix=function(i,e){const{x:r,y:s}=i.point,c=c_(r,s,i.worldSize/i._projectionScaler,0,0);return zs(c,c,l_(To(e)))},n.calculateGlobeMatrix=function(i){const{x:e,y:r}=i.point,{lng:s,lat:c}=i._center;return c_(e,r,i.worldSize,s,c)},n.calculateGlobeMercatorMatrix=function(i){const e=i.worldSize,r=i.point,s=Fn(1,i.center.lat)*e,c=i.pixelsPerMeter,f=e/(s/i.pixelsPerMeter),_=pn(new Float64Array(16));return Pa(_,_,[r.x,r.y,0]),bo(_,_,[f,f,c]),Float32Array.from(_)},n.circumferenceAtLatitude=wf,n.clamp=re,n.clearTileCache=function(i){const e=[];for(const r in Nr)e.push(w.caches.delete(r)),delete Nr[r];i&&Promise.all(e).catch(i).then(()=>i())},n.clipLine=Hm,n.clone=function(i){var e=new hn(16);return e[0]=i[0],e[1]=i[1],e[2]=i[2],e[3]=i[3],e[4]=i[4],e[5]=i[5],e[6]=i[6],e[7]=i[7],e[8]=i[8],e[9]=i[9],e[10]=i[10],e[11]=i[11],e[12]=i[12],e[13]=i[13],e[14]=i[14],e[15]=i[15],e},n.clone$1=Ci,n.collisionCircleLayout=dv,n.config=gi,n.conjugate=function(i,e){return i[0]=-e[0],i[1]=-e[1],i[2]=-e[2],i[3]=e[3],i},n.create=function(){var i=new hn(16);return hn!=Float32Array&&(i[1]=0,i[2]=0,i[3]=0,i[4]=0,i[6]=0,i[7]=0,i[8]=0,i[9]=0,i[11]=0,i[12]=0,i[13]=0,i[14]=0),i[0]=1,i[5]=1,i[10]=1,i[15]=1,i},n.create$1=K1,n.createExpression=qo,n.createLayout=gt,n.createStyleLayer=function(i){return i.type==="custom"?new hx(i):new fx[i.type](i)},n.cross=zf,n.degToRad=F,n.distance=function(i,e){return Math.hypot(e[0]-i[0],e[1]-i[1],e[2]-i[2])},n.div=function(i,e,r){return i[0]=e[0]/r[0],i[1]=e[1]/r[1],i[2]=e[2]/r[2],i},n.dot=Un,n.ease=Q,n.easeCubicInOut=se,n.emitValidationErrors=Eh,n.endsWith=$t,n.enforceCacheSizeLimit=function(i){for(const e in Nr)ce(e),Nr[e].then(r=>{r.keys().then(s=>{for(let c=0;c<s.length-i;c++)r.delete(s[c])})})},n.evaluateSizeForFeature=op,n.evaluateSizeForZoom=$l,n.evaluateVariableOffset=e_,n.evented=ee,n.exactEquals=function(i,e){return i[0]===e[0]&&i[1]===e[1]&&i[2]===e[2]&&i[3]===e[3]},n.exactEquals$1=function(i,e){return i[0]===e[0]&&i[1]===e[1]&&i[2]===e[2]},n.exported=nn,n.exported$1=mo,n.extend=Pe,n.extend$1=Jr,n.fillExtrusionHeightLift=bm,n.filterObject=Ht,n.fromMat4=function(i,e){return i[0]=e[0],i[1]=e[1],i[2]=e[2],i[3]=e[4],i[4]=e[5],i[5]=e[6],i[6]=e[8],i[7]=e[9],i[8]=e[10],i},n.fromQuat=function(i,e){var r=e[0],s=e[1],c=e[2],f=e[3],_=r+r,x=s+s,E=c+c,A=r*_,C=s*_,L=s*x,B=c*_,U=c*x,N=c*E,$=f*_,te=f*x,ue=f*E;return i[0]=1-L-N,i[1]=C+ue,i[2]=B-te,i[3]=0,i[4]=C-ue,i[5]=1-A-N,i[6]=U+$,i[7]=0,i[8]=B+te,i[9]=U-$,i[10]=1-A-L,i[11]=0,i[12]=0,i[13]=0,i[14]=0,i[15]=1,i},n.fromRotation=function(i,e){var r=Math.sin(e),s=Math.cos(e);return i[0]=s,i[1]=r,i[2]=0,i[3]=-r,i[4]=s,i[5]=0,i[6]=0,i[7]=0,i[8]=1,i},n.fromScaling=function(i,e){return i[0]=e[0],i[1]=0,i[2]=0,i[3]=0,i[4]=0,i[5]=e[1],i[6]=0,i[7]=0,i[8]=0,i[9]=0,i[10]=e[2],i[11]=0,i[12]=0,i[13]=0,i[14]=0,i[15]=1,i},n.furthestTileCorner=function(i){const e=Math.round((i+45+360)%360/90)%4;return ae[e]},n.getAABBPointSquareDist=function(i,e,r){let s=0;for(let c=0;c<2;++c){const f=r?r[c]:0;i[c]>f&&(s+=(i[c]-f)*(i[c]-f)),e[c]<f&&(s+=(f-e[c])*(f-e[c]))}return s},n.getAnchorAlignment=Hf,n.getAnchorJustification=Jf,n.getBounds=function(i){let e=1/0,r=1/0,s=-1/0,c=-1/0;for(const f of i)e=Math.min(e,f.x),r=Math.min(r,f.y),s=Math.max(s,f.x),c=Math.max(c,f.y);return{min:new I(e,r),max:new I(s,c)}},n.getColumn=xn,n.getGridMatrix=function(i,e,r){const[s,c]=e,f=.015625;return[0,(c[1]-s[1])*f,1<<i.z,(c[0]-s[0])/Jl[r],0,i.y,s[0],s[1],f]},n.getImage=jt,n.getJSON=function(i,e){return Ie(Pe(i,{type:"json"}),e)},n.getLatitudinalLod=function(i){const e=80.051129;i=re(i,-80.051129,e)/e*90;const r=Math.pow(Math.abs(Math.sin(F(i))),3);return Math.round(r*(Jl.length-1))},n.getMapSessionAPI=cc,n.getPerformanceMeasurement=Lo,n.getProjection=g_,n.getRTLTextPluginStatus=Y,n.getReferrer=De,n.getTilePoint=function(i,{x:e,y:r},s=0){return new I(((e-s)*i.scale-i.x)*qt,(r*i.scale-i.y)*qt)},n.getTileVec3=function(i,e,r=0){return Gl(((e.x-r)*i.scale-i.x)*qt,(e.y*i.scale-i.y)*qt,N1(e.z,e.y))},n.getVideo=function(i,e){const r=w.document.createElement("video");r.muted=!0,r.onloadstart=function(){e(null,r)};for(let s=0;s<i.length;s++){const c=w.document.createElement("source");It(i[s])||(r.crossOrigin="Anonymous"),c.src=i[s],r.appendChild(c)}return{cancel:()=>{}}},n.globeCenterToScreenPoint=function(i){const e=[0,0,0],r=pn(new Float64Array(16));return zs(r,i.pixelMatrix,i.globeMatrix),zr(e,e,r),new I(e[0],e[1])},n.globeECEFOrigin=function(i,e){const r=[0,0,0];return zr(r,r,du(To(e.canonical))),zr(r,r,i),r},n.globeNormalizeECEF=du,n.globePixelsToTileUnits=function(i,e){return qt/(512*Math.pow(2,i))*pp(To(e))},n.globePoleMatrixForTile=function(i,e,r){const s=pn(new Float64Array(16)),c=1<<i,f=360*(e/c-.5),_=r.point,x=r.worldSize/(r.tileSize*c);return Pa(s,s,[_.x,_.y,-r.worldSize/Math.PI/2]),bo(s,s,[x,x,x]),qh(s,s,F(-r._center.lat)),Zh(s,s,F(-r._center.lng+f)),Float32Array.from(s)},n.globeTileBounds=To,n.globeTileLatLngCorners=id,n.globeTiltAtLngLat=u_,n.globeToMercatorTransition=rd,n.globeUseCustomAntiAliasing=function(i,e,r){const s=rd(r.zoom),c=i.style.map._antialias,f=!!e.extStandardDerivatives,_=e.extStandardDerivativesForceOff||i.terrain&&i.terrain.exaggeration()>0;return s===0&&!c&&!_&&f},n.identity=pn,n.identity$1=nm,n.invert=function(i,e){var r=e[0],s=e[1],c=e[2],f=e[3],_=e[4],x=e[5],E=e[6],A=e[7],C=e[8],L=e[9],B=e[10],U=e[11],N=e[12],$=e[13],te=e[14],ue=e[15],ve=r*x-s*_,ye=r*E-c*_,xe=r*A-f*_,Ee=s*E-c*x,Se=s*A-f*x,qe=c*A-f*E,We=C*$-L*N,tt=C*te-B*N,at=C*ue-U*N,Be=L*te-B*$,et=L*ue-U*$,lt=B*ue-U*te,ct=ve*lt-ye*et+xe*Be+Ee*at-Se*tt+qe*We;return ct?(i[0]=(x*lt-E*et+A*Be)*(ct=1/ct),i[1]=(c*et-s*lt-f*Be)*ct,i[2]=($*qe-te*Se+ue*Ee)*ct,i[3]=(B*Se-L*qe-U*Ee)*ct,i[4]=(E*at-_*lt-A*tt)*ct,i[5]=(r*lt-c*at+f*tt)*ct,i[6]=(te*xe-N*qe-ue*ye)*ct,i[7]=(C*qe-B*xe+U*ye)*ct,i[8]=(_*et-x*at+A*We)*ct,i[9]=(s*at-r*et-f*We)*ct,i[10]=(N*Se-$*xe+ue*ve)*ct,i[11]=(L*xe-C*Se-U*ve)*ct,i[12]=(x*tt-_*Be-E*We)*ct,i[13]=(r*Be-s*tt+c*We)*ct,i[14]=($*ye-N*Ee-te*ve)*ct,i[15]=(C*Ee-L*ye+B*ve)*ct,i):null},n.isLngLatBehindGlobe=function(i,e){return u_(i,e)>Math.PI/2*1.01},n.isMapAuthenticated=function(i){return _o.has(i)},n.isMapboxURL=Dn,n.isSafariWithAntialiasingBug=function(i){const e=i.navigator?i.navigator.userAgent:null;return!!vn(i)&&e&&(e.match("Version/15.4")||e.match("Version/15.5")||e.match(/CPU (OS|iPhone OS) (15_4|15_5) like Mac OS X/))},n.latFromMercatorY=gr,n.len=b2,n.length=Jc,n.length$1=function(i){return Math.hypot(i[0],i[1],i[2],i[3])},n.loadVectorTile=F_,n.makeRequest=Ie,n.mapValue=function(i,e,r,s,c){return re((i-e)/(r-e)*(c-s)+s,s,c)},n.mercatorXfromLng=Ia,n.mercatorYfromLat=ka,n.mercatorZfromAltitude=Fn,n.mul=v2,n.mul$1=x2,n.multiply=zs,n.multiply$1=function(i,e,r){var s=e[0],c=e[1],f=e[2],_=e[3],x=e[4],E=e[5],A=e[6],C=e[7],L=e[8],B=r[0],U=r[1],N=r[2],$=r[3],te=r[4],ue=r[5],ve=r[6],ye=r[7],xe=r[8];return i[0]=B*s+U*_+N*A,i[1]=B*c+U*x+N*C,i[2]=B*f+U*E+N*L,i[3]=$*s+te*_+ue*A,i[4]=$*c+te*x+ue*C,i[5]=$*f+te*E+ue*L,i[6]=ve*s+ye*_+xe*A,i[7]=ve*c+ye*x+xe*C,i[8]=ve*f+ye*E+xe*L,i},n.multiply$2=em,n.nextPowerOfTwo=mt,n.normalize=qr,n.normalize$1=function(i,e){var r=e[0],s=e[1],c=e[2],f=e[3],_=r*r+s*s+c*c+f*f;return _>0&&(_=1/Math.sqrt(_)),i[0]=r*_,i[1]=s*_,i[2]=c*_,i[3]=f*_,i},n.number=bi,n.ortho=function(i,e,r,s,c,f,_){var x=1/(e-r),E=1/(s-c),A=1/(f-_);return i[0]=-2*x,i[1]=0,i[2]=0,i[3]=0,i[4]=0,i[5]=-2*E,i[6]=0,i[7]=0,i[8]=0,i[9]=0,i[10]=2*A,i[11]=0,i[12]=(e+r)*x,i[13]=(c+s)*E,i[14]=(_+f)*A,i[15]=1,i},n.pbf=uu,n.perspective=function(i,e,r,s,c){var f,_=1/Math.tan(e/2);return i[0]=_/r,i[1]=0,i[2]=0,i[3]=0,i[4]=0,i[5]=_,i[6]=0,i[7]=0,i[8]=0,i[9]=0,i[11]=-1,i[12]=0,i[13]=0,i[15]=0,c!=null&&c!==1/0?(i[10]=(c+s)*(f=1/(s-c)),i[14]=2*c*s*f):(i[10]=-1,i[14]=-2*s),i},n.pick=function(i,e){const r={};for(let s=0;s<e.length;s++){const c=e[s];c in i&&(r[c]=i[c])}return r},n.plugin=K,n.pointGeometry=I,n.polygonContainsPoint=za,n.polygonIntersectsBox=X1,n.polygonIntersectsPolygon=q1,n.polygonizeBounds=function(i,e,r=0,s=!0){const c=new I(r,r),f=i.sub(c),_=e.add(c),x=[f,new I(_.x,f.y),_,new I(f.x,_.y)];return s&&x.push(f.clone()),x},n.posAttributes=fu,n.postMapLoadEvent=Ya,n.postTurnstileEvent=Qs,n.potpack=Zf,n.prevPowerOfTwo=function(i){return i<=1?1:Math.pow(2,Math.floor(Math.log(i)/Math.LN2))},n.radToDeg=q,n.refProperties=["type","source","source-layer","minzoom","maxzoom","filter","layout"],n.registerForPluginStateChange=function(i){return i({pluginStatus:V,pluginURL:G}),ee.on("pluginStateChange",i),i},n.removeAuthState=function(i){_o.delete(i)},n.renderColorRamp=Bf,n.resample=j1,n.rotateX=qh,n.rotateX$1=om,n.rotateY=Zh,n.rotateY$1=sm,n.rotateZ=function(i,e,r){var s=Math.sin(r),c=Math.cos(r),f=e[0],_=e[1],x=e[2],E=e[3],A=e[4],C=e[5],L=e[6],B=e[7];return e!==i&&(i[8]=e[8],i[9]=e[9],i[10]=e[10],i[11]=e[11],i[12]=e[12],i[13]=e[13],i[14]=e[14],i[15]=e[15]),i[0]=f*c+A*s,i[1]=_*c+C*s,i[2]=x*c+L*s,i[3]=E*c+B*s,i[4]=A*c-f*s,i[5]=C*c-_*s,i[6]=L*c-x*s,i[7]=B*c-E*s,i},n.rotateZ$1=function(i,e,r){r*=.5;var s=e[0],c=e[1],f=e[2],_=e[3],x=Math.sin(r),E=Math.cos(r);return i[0]=s*E+c*x,i[1]=c*E-s*x,i[2]=f*E+_*x,i[3]=_*E-f*x,i},n.scale=bo,n.scale$1=im,n.scale$2=wo,n.scaleAndAdd=Xh,n.setCacheLimits=function(i,e){ls=i,Ja=e},n.setColumn=function(i,e,r){i[4*e+0]=r[0],i[4*e+1]=r[1],i[4*e+2]=r[2],i[4*e+3]=r[3]},n.setRTLTextPlugin=function(i,e,r=!1){if(V===S||V===k||V===D)throw new Error("setRTLTextPlugin cannot be called multiple times.");G=nn.resolveURL(i),V=S,O=e,J(),r||pe()},n.smoothstep=Ae,n.spec=ke,n.storeAuthState=function(i,e){e?_o.add(i):_o.delete(i)},n.sub=Vn,n.subtract=Cf,n.symbolSize=mv,n.tileAABB=function(i,e,r,s,c,f,_,x,E){if(E.name==="globe")return Xv(i,e,new ip(r,s,c));const A=Ba({z:r,x:s,y:c},E);return new An([(f+A.x/A.scale)*e,e*(A.y/A.scale),_],[(f+A.x2/A.scale)*e,e*(A.y2/A.scale),x])},n.tileTransform=Ba,n.transformMat3=function(i,e,r){var s=e[0],c=e[1],f=e[2];return i[0]=s*r[0]+c*r[3]+f*r[6],i[1]=s*r[1]+c*r[4]+f*r[7],i[2]=s*r[2]+c*r[5]+f*r[8],i},n.transformMat4=zr,n.transformMat4$1=Da,n.transformQuat=tm,n.translate=Pa,n.transpose=function(i,e){if(i===e){var r=e[1],s=e[2],c=e[5];i[1]=e[3],i[2]=e[6],i[3]=r,i[5]=e[7],i[6]=s,i[7]=c}else i[0]=e[0],i[1]=e[3],i[2]=e[6],i[3]=e[1],i[4]=e[4],i[5]=e[7],i[6]=e[2],i[7]=e[5],i[8]=e[8];return i},n.triggerPluginCompletionEvent=X,n.uniqueId=Qe,n.updateGlobeVertexNormal=function(i,e,r,s,c){const f=5*e+2;i.float32[f+0]=r,i.float32[f+1]=s,i.float32[f+2]=c},n.validateCustomStyleLayer=function(i){const e=[],r=i.id;return r===void 0&&e.push({message:`layers.${r}: missing required property "id"`}),i.render===void 0&&e.push({message:`layers.${r}: missing required method "render"`}),i.renderingMode&&i.renderingMode!=="2d"&&i.renderingMode!=="3d"&&e.push({message:`layers.${r}: property "renderingMode" must be either "2d" or "3d"`}),e},n.validateFilter=i=>En(Oc(i)),n.validateFog=i=>En(vh(i)),n.validateLayer=i=>En(gh(i)),n.validateLight=i=>En(Fc(i)),n.validateSource=i=>En(yh(i)),n.validateStyle=bh,n.validateTerrain=i=>En(Uc(i)),n.values=ze,n.vectorTile=La,n.version=Ro,n.warnOnce=Kt,n.window=w,n.wrap=$e}),g(["./shared"],function(n){function w(ce){if(typeof ce=="number"||typeof ce=="boolean"||typeof ce=="string"||ce==null)return JSON.stringify(ce);if(Array.isArray(ce)){let Z="[";for(const le of ce)Z+=`${w(le)},`;return`${Z}]`}let j="{";for(const Z of Object.keys(ce).sort())j+=`${Z}:${w(ce[Z])},`;return`${j}}`}function T(ce){let j="";for(const Z of n.refProperties)j+=`/${w(ce[Z])}`;return j}class M{constructor(j){this.keyCache={},j&&this.replace(j)}replace(j){this._layerConfigs={},this._layers={},this.update(j,[])}update(j,Z){for(const me of j)this._layerConfigs[me.id]=me,(this._layers[me.id]=n.createStyleLayer(me)).compileFilter(),this.keyCache[me.id]&&delete this.keyCache[me.id];for(const me of Z)delete this.keyCache[me],delete this._layerConfigs[me],delete this._layers[me];this.familiesBySource={};const le=function(me,we){const De={};for(let Te=0;Te<me.length;Te++){const Re=we&&we[me[Te].id]||T(me[Te]);we&&(we[me[Te].id]=Re);let nt=De[Re];nt||(nt=De[Re]=[]),nt.push(me[Te])}const Ie=[];for(const Te in De)Ie.push(De[Te]);return Ie}(n.values(this._layerConfigs),this.keyCache);for(const me of le){const we=me.map(It=>this._layers[It.id]),De=we[0];if(De.visibility==="none")continue;const Ie=De.source||"";let Te=this.familiesBySource[Ie];Te||(Te=this.familiesBySource[Ie]={});const Re=De.sourceLayer||"_geojsonTileLayer";let nt=Te[Re];nt||(nt=Te[Re]=[]),nt.push(we)}}}class I{loadTile(j,Z){const{uid:le,encoding:me,rawImageData:we,padding:De,buildQuadTree:Ie}=j,Te=n.window.ImageBitmap&&we instanceof n.window.ImageBitmap?this.getImageData(we,De):we;Z(null,new n.DEMData(le,Te,me,De<1,Ie))}getImageData(j,Z){this.offscreenCanvas&&this.offscreenCanvasContext||(this.offscreenCanvas=new OffscreenCanvas(j.width,j.height),this.offscreenCanvasContext=this.offscreenCanvas.getContext("2d")),this.offscreenCanvas.width=j.width,this.offscreenCanvas.height=j.height,this.offscreenCanvasContext.drawImage(j,0,0,j.width,j.height);const le=this.offscreenCanvasContext.getImageData(-Z,-Z,j.width+2*Z,j.height+2*Z);return this.offscreenCanvasContext.clearRect(0,0,this.offscreenCanvas.width,this.offscreenCanvas.height),le}}var P=function ce(j,Z){var le,me=j&&j.type;if(me==="FeatureCollection")for(le=0;le<j.features.length;le++)ce(j.features[le],Z);else if(me==="GeometryCollection")for(le=0;le<j.geometries.length;le++)ce(j.geometries[le],Z);else if(me==="Feature")ce(j.geometry,Z);else if(me==="Polygon")z(j.coordinates,Z);else if(me==="MultiPolygon")for(le=0;le<j.coordinates.length;le++)z(j.coordinates[le],Z);return j};function z(ce,j){if(ce.length!==0){R(ce[0],j);for(var Z=1;Z<ce.length;Z++)R(ce[Z],!j)}}function R(ce,j){for(var Z=0,le=0,me=0,we=ce.length,De=we-1;me<we;De=me++){var Ie=(ce[me][0]-ce[De][0])*(ce[De][1]+ce[me][1]),Te=Z+Ie;le+=Math.abs(Z)>=Math.abs(Ie)?Z-Te+Ie:Ie-Te+Z,Z=Te}Z+le>=0!=!!j&&ce.reverse()}const F=n.vectorTile.VectorTileFeature.prototype.toGeoJSON;class q{constructor(j){this._feature=j,this.extent=n.EXTENT,this.type=j.type,this.properties=j.tags,"id"in j&&!isNaN(j.id)&&(this.id=parseInt(j.id,10))}loadGeometry(){if(this._feature.type===1){const j=[];for(const Z of this._feature.geometry)j.push([new n.pointGeometry(Z[0],Z[1])]);return j}{const j=[];for(const Z of this._feature.geometry){const le=[];for(const me of Z)le.push(new n.pointGeometry(me[0],me[1]));j.push(le)}return j}}toGeoJSON(j,Z,le){return F.call(this,j,Z,le)}}class ae{constructor(j){this.layers={_geojsonTileLayer:this},this.name="_geojsonTileLayer",this.extent=n.EXTENT,this.length=j.length,this._features=j}feature(j){return new q(this._features[j])}}var se=n.vectorTile.VectorTileFeature,ie=Q;function Q(ce,j){this.options=j||{},this.features=ce,this.length=ce.length}function re(ce,j){this.id=typeof ce.id=="number"?ce.id:void 0,this.type=ce.type,this.rawGeometry=ce.type===1?[ce.geometry]:ce.geometry,this.properties=ce.tags,this.extent=j||4096}Q.prototype.feature=function(ce){return new re(this.features[ce],this.options.extent)},re.prototype.loadGeometry=function(){var ce=this.rawGeometry;this.geometry=[];for(var j=0;j<ce.length;j++){for(var Z=ce[j],le=[],me=0;me<Z.length;me++)le.push(new n.pointGeometry(Z[me][0],Z[me][1]));this.geometry.push(le)}return this.geometry},re.prototype.bbox=function(){this.geometry||this.loadGeometry();for(var ce=this.geometry,j=1/0,Z=-1/0,le=1/0,me=-1/0,we=0;we<ce.length;we++)for(var De=ce[we],Ie=0;Ie<De.length;Ie++){var Te=De[Ie];j=Math.min(j,Te.x),Z=Math.max(Z,Te.x),le=Math.min(le,Te.y),me=Math.max(me,Te.y)}return[j,le,Z,me]},re.prototype.toGeoJSON=se.prototype.toGeoJSON;var Ae=Je,$e=ie;function Je(ce){var j=new n.pbf;return function(Z,le){for(var me in Z.layers)le.writeMessage(3,ze,Z.layers[me])}(ce,j),j.finish()}function ze(ce,j){var Z;j.writeVarintField(15,ce.version||1),j.writeStringField(1,ce.name||""),j.writeVarintField(5,ce.extent||4096);var le={keys:[],values:[],keycache:{},valuecache:{}};for(Z=0;Z<ce.length;Z++)le.feature=ce.feature(Z),j.writeMessage(2,Pe,le);var me=le.keys;for(Z=0;Z<me.length;Z++)j.writeStringField(3,me[Z]);var we=le.values;for(Z=0;Z<we.length;Z++)j.writeMessage(4,Ne,we[Z])}function Pe(ce,j){var Z=ce.feature;Z.id!==void 0&&j.writeVarintField(1,Z.id),j.writeMessage(2,Ge,ce),j.writeVarintField(3,Z.type),j.writeMessage(4,mt,Z)}function Ge(ce,j){var Z=ce.feature,le=ce.keys,me=ce.values,we=ce.keycache,De=ce.valuecache;for(var Ie in Z.properties){var Te=Z.properties[Ie],Re=we[Ie];if(Te!==null){Re===void 0&&(le.push(Ie),we[Ie]=Re=le.length-1),j.writeVarint(Re);var nt=typeof Te;nt!=="string"&&nt!=="boolean"&&nt!=="number"&&(Te=JSON.stringify(Te));var It=nt+":"+Te,st=De[It];st===void 0&&(me.push(Te),De[It]=st=me.length-1),j.writeVarint(st)}}}function Qe(ce,j){return(j<<3)+(7&ce)}function Rt(ce){return ce<<1^ce>>31}function mt(ce,j){for(var Z=ce.loadGeometry(),le=ce.type,me=0,we=0,De=Z.length,Ie=0;Ie<De;Ie++){var Te=Z[Ie],Re=1;le===1&&(Re=Te.length),j.writeVarint(Qe(1,Re));for(var nt=le===3?Te.length-1:Te.length,It=0;It<nt;It++){It===1&&le!==1&&j.writeVarint(Qe(2,nt-1));var st=Te[It].x-me,Nt=Te[It].y-we;j.writeVarint(Rt(st)),j.writeVarint(Rt(Nt)),me+=st,we+=Nt}le===3&&j.writeVarint(Qe(7,1))}}function Ne(ce,j){var Z=typeof ce;Z==="string"?j.writeStringField(1,ce):Z==="boolean"?j.writeBooleanField(7,ce):Z==="number"&&(ce%1!=0?j.writeDoubleField(3,ce):ce<0?j.writeSVarintField(6,ce):j.writeVarintField(5,ce))}function At(ce,j,Z,le,me,we){if(me-le<=Z)return;const De=le+me>>1;$t(ce,j,De,le,me,we%2),At(ce,j,Z,le,De-1,we+1),At(ce,j,Z,De+1,me,we+1)}function $t(ce,j,Z,le,me,we){for(;me>le;){if(me-le>600){const Re=me-le+1,nt=Z-le+1,It=Math.log(Re),st=.5*Math.exp(2*It/3),Nt=.5*Math.sqrt(It*st*(Re-st)/Re)*(nt-Re/2<0?-1:1);$t(ce,j,Z,Math.max(le,Math.floor(Z-nt*st/Re+Nt)),Math.min(me,Math.floor(Z+(Re-nt)*st/Re+Nt)),we)}const De=j[2*Z+we];let Ie=le,Te=me;for(_t(ce,j,le,Z),j[2*me+we]>De&&_t(ce,j,le,me);Ie<Te;){for(_t(ce,j,Ie,Te),Ie++,Te--;j[2*Ie+we]<De;)Ie++;for(;j[2*Te+we]>De;)Te--}j[2*le+we]===De?_t(ce,j,le,Te):(Te++,_t(ce,j,Te,me)),Te<=Z&&(le=Te+1),Z<=Te&&(me=Te-1)}}function _t(ce,j,Z,le){Ht(ce,Z,le),Ht(j,2*Z,2*le),Ht(j,2*Z+1,2*le+1)}function Ht(ce,j,Z){const le=ce[j];ce[j]=ce[Z],ce[Z]=le}function Ci(ce,j,Z,le){const me=ce-Z,we=j-le;return me*me+we*we}Ae.fromVectorTileJs=Je,Ae.fromGeojsonVt=function(ce,j){j=j||{};var Z={};for(var le in ce)Z[le]=new ie(ce[le].features,j),Z[le].name=le,Z[le].version=j.version,Z[le].extent=j.extent;return Je({layers:Z})},Ae.GeoJSONWrapper=$e;const Ui=ce=>ce[0],Kt=ce=>ce[1];class Yt{constructor(j,Z=Ui,le=Kt,me=64,we=Float64Array){this.nodeSize=me,this.points=j;const De=j.length<65536?Uint16Array:Uint32Array,Ie=this.ids=new De(j.length),Te=this.coords=new we(2*j.length);for(let Re=0;Re<j.length;Re++)Ie[Re]=Re,Te[2*Re]=Z(j[Re]),Te[2*Re+1]=le(j[Re]);At(Ie,Te,me,0,Ie.length-1,0)}range(j,Z,le,me){return function(we,De,Ie,Te,Re,nt,It){const st=[0,we.length-1,0],Nt=[];let Gt,jt;for(;st.length;){const Wt=st.pop(),ai=st.pop(),Ti=st.pop();if(ai-Ti<=It){for(let ke=Ti;ke<=ai;ke++)Gt=De[2*ke],jt=De[2*ke+1],Gt>=Ie&&Gt<=Re&&jt>=Te&&jt<=nt&&Nt.push(we[ke]);continue}const ji=Math.floor((Ti+ai)/2);Gt=De[2*ji],jt=De[2*ji+1],Gt>=Ie&&Gt<=Re&&jt>=Te&&jt<=nt&&Nt.push(we[ji]);const ki=(Wt+1)%2;(Wt===0?Ie<=Gt:Te<=jt)&&(st.push(Ti),st.push(ji-1),st.push(ki)),(Wt===0?Re>=Gt:nt>=jt)&&(st.push(ji+1),st.push(ai),st.push(ki))}return Nt}(this.ids,this.coords,j,Z,le,me,this.nodeSize)}within(j,Z,le){return function(me,we,De,Ie,Te,Re){const nt=[0,me.length-1,0],It=[],st=Te*Te;for(;nt.length;){const Nt=nt.pop(),Gt=nt.pop(),jt=nt.pop();if(Gt-jt<=Re){for(let ki=jt;ki<=Gt;ki++)Ci(we[2*ki],we[2*ki+1],De,Ie)<=st&&It.push(me[ki]);continue}const Wt=Math.floor((jt+Gt)/2),ai=we[2*Wt],Ti=we[2*Wt+1];Ci(ai,Ti,De,Ie)<=st&&It.push(me[Wt]);const ji=(Nt+1)%2;(Nt===0?De-Te<=ai:Ie-Te<=Ti)&&(nt.push(jt),nt.push(Wt-1),nt.push(ji)),(Nt===0?De+Te>=ai:Ie+Te>=Ti)&&(nt.push(Wt+1),nt.push(Gt),nt.push(ji))}return It}(this.ids,this.coords,j,Z,le,this.nodeSize)}}const Lt={minZoom:0,maxZoom:16,minPoints:2,radius:40,extent:512,nodeSize:64,log:!1,generateId:!1,reduce:null,map:ce=>ce},Zt=Math.fround||(vr=new Float32Array(1),ce=>(vr[0]=+ce,vr[0]));var vr;class vi{constructor(j){this.options=$n(Object.create(Lt),j),this.trees=new Array(this.options.maxZoom+1)}load(j){const{log:Z,minZoom:le,maxZoom:me,nodeSize:we}=this.options;Z&&console.time("total time");const De=`prepare ${j.length} points`;Z&&console.time(De),this.points=j;let Ie=[];for(let Te=0;Te<j.length;Te++)j[Te].geometry&&Ie.push(fo(j[Te],Te));this.trees[me+1]=new Yt(Ie,Bo,Pn,we,Float32Array),Z&&console.timeEnd(De);for(let Te=me;Te>=le;Te--){const Re=+Date.now();Ie=this._cluster(Ie,Te),this.trees[Te]=new Yt(Ie,Bo,Pn,we,Float32Array),Z&&console.log("z%d: %d clusters in %dms",Te,Ie.length,+Date.now()-Re)}return Z&&console.timeEnd("total time"),this}getClusters(j,Z){let le=((j[0]+180)%360+360)%360-180;const me=Math.max(-90,Math.min(90,j[1]));let we=j[2]===180?180:((j[2]+180)%360+360)%360-180;const De=Math.max(-90,Math.min(90,j[3]));if(j[2]-j[0]>=360)le=-180,we=180;else if(le>we){const nt=this.getClusters([le,me,180,De],Z),It=this.getClusters([-180,me,we,De],Z);return nt.concat(It)}const Ie=this.trees[this._limitZoom(Z)],Te=Ie.range(Lo(le),Ro(De),Lo(we),Ro(me)),Re=[];for(const nt of Te){const It=Ie.points[nt];Re.push(It.numPoints?xn(It):this.points[It.index])}return Re}getChildren(j){const Z=this._getOriginId(j),le=this._getOriginZoom(j),me="No cluster with the specified id.",we=this.trees[le];if(!we)throw new Error(me);const De=we.points[Z];if(!De)throw new Error(me);const Ie=this.options.radius/(this.options.extent*Math.pow(2,le-1)),Te=we.within(De.x,De.y,Ie),Re=[];for(const nt of Te){const It=we.points[nt];It.parentId===j&&Re.push(It.numPoints?xn(It):this.points[It.index])}if(Re.length===0)throw new Error(me);return Re}getLeaves(j,Z,le){const me=[];return this._appendLeaves(me,j,Z=Z||10,le=le||0,0),me}getTile(j,Z,le){const me=this.trees[this._limitZoom(j)],we=Math.pow(2,j),{extent:De,radius:Ie}=this.options,Te=Ie/De,Re=(le-Te)/we,nt=(le+1+Te)/we,It={features:[]};return this._addTileFeatures(me.range((Z-Te)/we,Re,(Z+1+Te)/we,nt),me.points,Z,le,we,It),Z===0&&this._addTileFeatures(me.range(1-Te/we,Re,1,nt),me.points,we,le,we,It),Z===we-1&&this._addTileFeatures(me.range(0,Re,Te/we,nt),me.points,-1,le,we,It),It.features.length?It:null}getClusterExpansionZoom(j){let Z=this._getOriginZoom(j)-1;for(;Z<=this.options.maxZoom;){const le=this.getChildren(j);if(Z++,le.length!==1)break;j=le[0].properties.cluster_id}return Z}_appendLeaves(j,Z,le,me,we){const De=this.getChildren(Z);for(const Ie of De){const Te=Ie.properties;if(Te&&Te.cluster?we+Te.point_count<=me?we+=Te.point_count:we=this._appendLeaves(j,Te.cluster_id,le,me,we):we<me?we++:j.push(Ie),j.length===le)break}return we}_addTileFeatures(j,Z,le,me,we,De){for(const Ie of j){const Te=Z[Ie],Re=Te.numPoints;let nt,It,st;if(Re)nt=Do(Te),It=Te.x,st=Te.y;else{const jt=this.points[Te.index];nt=jt.properties,It=Lo(jt.geometry.coordinates[0]),st=Ro(jt.geometry.coordinates[1])}const Nt={type:1,geometry:[[Math.round(this.options.extent*(It*we-le)),Math.round(this.options.extent*(st*we-me))]],tags:nt};let Gt;Re?Gt=Te.id:this.options.generateId?Gt=Te.index:this.points[Te.index].id&&(Gt=this.points[Te.index].id),Gt!==void 0&&(Nt.id=Gt),De.features.push(Nt)}}_limitZoom(j){return Math.max(this.options.minZoom,Math.min(+j,this.options.maxZoom+1))}_cluster(j,Z){const le=[],{radius:me,extent:we,reduce:De,minPoints:Ie}=this.options,Te=me/(we*Math.pow(2,Z));for(let Re=0;Re<j.length;Re++){const nt=j[Re];if(nt.zoom<=Z)continue;nt.zoom=Z;const It=this.trees[Z+1],st=It.within(nt.x,nt.y,Te),Nt=nt.numPoints||1;let Gt=Nt;for(const jt of st){const Wt=It.points[jt];Wt.zoom>Z&&(Gt+=Wt.numPoints||1)}if(Gt>Nt&&Gt>=Ie){let jt=nt.x*Nt,Wt=nt.y*Nt,ai=De&&Nt>1?this._map(nt,!0):null;const Ti=(Re<<5)+(Z+1)+this.points.length;for(const ji of st){const ki=It.points[ji];if(ki.zoom<=Z)continue;ki.zoom=Z;const ke=ki.numPoints||1;jt+=ki.x*ke,Wt+=ki.y*ke,ki.parentId=Ti,De&&(ai||(ai=this._map(nt,!0)),De(ai,this._map(ki)))}nt.parentId=Ti,le.push(vn(jt/Gt,Wt/Gt,Ti,Gt,ai))}else if(le.push(nt),Gt>1)for(const jt of st){const Wt=It.points[jt];Wt.zoom<=Z||(Wt.zoom=Z,le.push(Wt))}}return le}_getOriginId(j){return j-this.points.length>>5}_getOriginZoom(j){return(j-this.points.length)%32}_map(j,Z){if(j.numPoints)return Z?$n({},j.properties):j.properties;const le=this.points[j.index].properties,me=this.options.map(le);return Z&&me===le?$n({},me):me}}function vn(ce,j,Z,le,me){return{x:Zt(ce),y:Zt(j),zoom:1/0,id:Z,parentId:-1,numPoints:le,properties:me}}function fo(ce,j){const[Z,le]=ce.geometry.coordinates;return{x:Zt(Lo(Z)),y:Zt(Ro(le)),zoom:1/0,index:j,parentId:-1}}function xn(ce){return{type:"Feature",id:ce.id,properties:Do(ce),geometry:{type:"Point",coordinates:[(j=ce.x,360*(j-.5)),xi(ce.y)]}};var j}function Do(ce){const j=ce.numPoints,Z=j>=1e4?`${Math.round(j/1e3)}k`:j>=1e3?Math.round(j/100)/10+"k":j;return $n($n({},ce.properties),{cluster:!0,cluster_id:ce.id,point_count:j,point_count_abbreviated:Z})}function Lo(ce){return ce/360+.5}function Ro(ce){const j=Math.sin(ce*Math.PI/180),Z=.5-.25*Math.log((1+j)/(1-j))/Math.PI;return Z<0?0:Z>1?1:Z}function xi(ce){const j=(180-360*ce)*Math.PI/180;return 360*Math.atan(Math.exp(j))/Math.PI-90}function $n(ce,j){for(const Z in j)ce[Z]=j[Z];return ce}function Bo(ce){return ce.x}function Pn(ce){return ce.y}function nn(ce,j,Z,le){for(var me,we=le,De=Z-j>>1,Ie=Z-j,Te=ce[j],Re=ce[j+1],nt=ce[Z],It=ce[Z+1],st=j+3;st<Z;st+=3){var Nt=ss(ce[st],ce[st+1],Te,Re,nt,It);if(Nt>we)me=st,we=Nt;else if(Nt===we){var Gt=Math.abs(st-De);Gt<Ie&&(me=st,Ie=Gt)}}we>le&&(me-j>3&&nn(ce,j,me,le),ce[me+2]=we,Z-me>3&&nn(ce,me,Z,le))}function ss(ce,j,Z,le,me,we){var De=me-Z,Ie=we-le;if(De!==0||Ie!==0){var Te=((ce-Z)*De+(j-le)*Ie)/(De*De+Ie*Ie);Te>1?(Z=me,le=we):Te>0&&(Z+=De*Te,le+=Ie*Te)}return(De=ce-Z)*De+(Ie=j-le)*Ie}function gi(ce,j,Z,le){var me={id:ce===void 0?null:ce,type:j,geometry:Z,tags:le,minX:1/0,minY:1/0,maxX:-1/0,maxY:-1/0};return function(we){var De=we.geometry,Ie=we.type;if(Ie==="Point"||Ie==="MultiPoint"||Ie==="LineString")mo(we,De);else if(Ie==="Polygon"||Ie==="MultiLineString")for(var Te=0;Te<De.length;Te++)mo(we,De[Te]);else if(Ie==="MultiPolygon")for(Te=0;Te<De.length;Te++)for(var Re=0;Re<De[Te].length;Re++)mo(we,De[Te][Re])}(me),me}function mo(ce,j){for(var Z=0;Z<j.length;Z+=3)ce.minX=Math.min(ce.minX,j[Z]),ce.minY=Math.min(ce.minY,j[Z+1]),ce.maxX=Math.max(ce.maxX,j[Z]),ce.maxY=Math.max(ce.maxY,j[Z+1])}function Wn(ce,j,Z,le){if(j.geometry){var me=j.geometry.coordinates,we=j.geometry.type,De=Math.pow(Z.tolerance/((1<<Z.maxZoom)*Z.extent),2),Ie=[],Te=j.id;if(Z.promoteId?Te=j.properties[Z.promoteId]:Z.generateId&&(Te=le||0),we==="Point")Xn(me,Ie);else if(we==="MultiPoint")for(var Re=0;Re<me.length;Re++)Xn(me[Re],Ie);else if(we==="LineString")Oo(me,Ie,De,!1);else if(we==="MultiLineString"){if(Z.lineMetrics){for(Re=0;Re<me.length;Re++)Oo(me[Re],Ie=[],De,!1),ce.push(gi(Te,"LineString",Ie,j.properties));return}as(me,Ie,De,!1)}else if(we==="Polygon")as(me,Ie,De,!0);else{if(we!=="MultiPolygon"){if(we==="GeometryCollection"){for(Re=0;Re<j.geometry.geometries.length;Re++)Wn(ce,{id:Te,geometry:j.geometry.geometries[Re],properties:j.properties},Z,le);return}throw new Error("Input data is not a valid GeoJSON object.")}for(Re=0;Re<me.length;Re++){var nt=[];as(me[Re],nt,De,!0),Ie.push(nt)}}ce.push(gi(Te,we,Ie,j.properties))}}function Xn(ce,j){j.push(Hs(ce[0])),j.push(Ys(ce[1])),j.push(0)}function Oo(ce,j,Z,le){for(var me,we,De=0,Ie=0;Ie<ce.length;Ie++){var Te=Hs(ce[Ie][0]),Re=Ys(ce[Ie][1]);j.push(Te),j.push(Re),j.push(0),Ie>0&&(De+=le?(me*Re-Te*we)/2:Math.sqrt(Math.pow(Te-me,2)+Math.pow(Re-we,2))),me=Te,we=Re}var nt=j.length-3;j[2]=1,nn(j,0,nt,Z),j[nt+2]=1,j.size=Math.abs(De),j.start=0,j.end=j.size}function as(ce,j,Z,le){for(var me=0;me<ce.length;me++){var we=[];Oo(ce[me],we,Z,le),j.push(we)}}function Hs(ce){return ce/360+.5}function Ys(ce){var j=Math.sin(ce*Math.PI/180),Z=.5-.25*Math.log((1+j)/(1-j))/Math.PI;return Z<0?0:Z>1?1:Z}function Yr(ce,j,Z,le,me,we,De,Ie){if(le/=j,we>=(Z/=j)&&De<le)return ce;if(De<Z||we>=le)return null;for(var Te=[],Re=0;Re<ce.length;Re++){var nt=ce[Re],It=nt.geometry,st=nt.type,Nt=me===0?nt.minX:nt.minY,Gt=me===0?nt.maxX:nt.maxY;if(Nt>=Z&&Gt<le)Te.push(nt);else if(!(Gt<Z||Nt>=le)){var jt=[];if(st==="Point"||st==="MultiPoint")Dn(It,jt,Z,le,me);else if(st==="LineString")Fo(It,jt,Z,le,me,!1,Ie.lineMetrics);else if(st==="MultiLineString")Kr(It,jt,Z,le,me,!1);else if(st==="Polygon")Kr(It,jt,Z,le,me,!0);else if(st==="MultiPolygon")for(var Wt=0;Wt<It.length;Wt++){var ai=[];Kr(It[Wt],ai,Z,le,me,!0),ai.length&&jt.push(ai)}if(jt.length){if(Ie.lineMetrics&&st==="LineString"){for(Wt=0;Wt<jt.length;Wt++)Te.push(gi(nt.id,st,jt[Wt],nt.tags));continue}st!=="LineString"&&st!=="MultiLineString"||(jt.length===1?(st="LineString",jt=jt[0]):st="MultiLineString"),st!=="Point"&&st!=="MultiPoint"||(st=jt.length===3?"Point":"MultiPoint"),Te.push(gi(nt.id,st,jt,nt.tags))}}}return Te.length?Te:null}function Dn(ce,j,Z,le,me){for(var we=0;we<ce.length;we+=3){var De=ce[we+me];De>=Z&&De<=le&&(j.push(ce[we]),j.push(ce[we+1]),j.push(ce[we+2]))}}function Fo(ce,j,Z,le,me,we,De){for(var Ie,Te,Re=Xa(ce),nt=me===0?Ha:Ks,It=ce.start,st=0;st<ce.length-3;st+=3){var Nt=ce[st],Gt=ce[st+1],jt=ce[st+2],Wt=ce[st+3],ai=ce[st+4],Ti=me===0?Nt:Gt,ji=me===0?Wt:ai,ki=!1;De&&(Ie=Math.sqrt(Math.pow(Nt-Wt,2)+Math.pow(Gt-ai,2))),Ti<Z?ji>Z&&(Te=nt(Re,Nt,Gt,Wt,ai,Z),De&&(Re.start=It+Ie*Te)):Ti>le?ji<le&&(Te=nt(Re,Nt,Gt,Wt,ai,le),De&&(Re.start=It+Ie*Te)):Hn(Re,Nt,Gt,jt),ji<Z&&Ti>=Z&&(Te=nt(Re,Nt,Gt,Wt,ai,Z),ki=!0),ji>le&&Ti<=le&&(Te=nt(Re,Nt,Gt,Wt,ai,le),ki=!0),!we&&ki&&(De&&(Re.end=It+Ie*Te),j.push(Re),Re=Xa(ce)),De&&(It+=Ie)}var ke=ce.length-3;Nt=ce[ke],Gt=ce[ke+1],jt=ce[ke+2],(Ti=me===0?Nt:Gt)>=Z&&Ti<=le&&Hn(Re,Nt,Gt,jt),ke=Re.length-3,we&&ke>=3&&(Re[ke]!==Re[0]||Re[ke+1]!==Re[1])&&Hn(Re,Re[0],Re[1],Re[2]),Re.length&&j.push(Re)}function Xa(ce){var j=[];return j.size=ce.size,j.start=ce.start,j.end=ce.end,j}function Kr(ce,j,Z,le,me,we){for(var De=0;De<ce.length;De++)Fo(ce[De],j,Z,le,me,we,!1)}function Hn(ce,j,Z,le){ce.push(j),ce.push(Z),ce.push(le)}function Ha(ce,j,Z,le,me,we){var De=(we-j)/(le-j);return ce.push(we),ce.push(Z+(me-Z)*De),ce.push(1),De}function Ks(ce,j,Z,le,me,we){var De=(we-Z)/(me-Z);return ce.push(j+(le-j)*De),ce.push(we),ce.push(1),De}function Js(ce,j){for(var Z=[],le=0;le<ce.length;le++){var me,we=ce[le],De=we.type;if(De==="Point"||De==="MultiPoint"||De==="LineString")me=Qs(we.geometry,j);else if(De==="MultiLineString"||De==="Polygon"){me=[];for(var Ie=0;Ie<we.geometry.length;Ie++)me.push(Qs(we.geometry[Ie],j))}else if(De==="MultiPolygon")for(me=[],Ie=0;Ie<we.geometry.length;Ie++){for(var Te=[],Re=0;Re<we.geometry[Ie].length;Re++)Te.push(Qs(we.geometry[Ie][Re],j));me.push(Te)}Z.push(gi(we.id,De,me,we.tags))}return Z}function Qs(ce,j){var Z=[];Z.size=ce.size,ce.start!==void 0&&(Z.start=ce.start,Z.end=ce.end);for(var le=0;le<ce.length;le+=3)Z.push(ce[le]+j,ce[le+1],ce[le+2]);return Z}function ea(ce,j){if(ce.transformed)return ce;var Z,le,me,we=1<<ce.z,De=ce.x,Ie=ce.y;for(Z=0;Z<ce.features.length;Z++){var Te=ce.features[Z],Re=Te.geometry,nt=Te.type;if(Te.geometry=[],nt===1)for(le=0;le<Re.length;le+=2)Te.geometry.push(Ya(Re[le],Re[le+1],j,we,De,Ie));else for(le=0;le<Re.length;le++){var It=[];for(me=0;me<Re[le].length;me+=2)It.push(Ya(Re[le][me],Re[le][me+1],j,we,De,Ie));Te.geometry.push(It)}}return ce.transformed=!0,ce}function Ya(ce,j,Z,le,me,we){return[Math.round(Z*(ce*le-me)),Math.round(Z*(j*le-we))]}function Ka(ce,j,Z,le,me){for(var we=j===me.maxZoom?0:me.tolerance/((1<<j)*me.extent),De={features:[],numPoints:0,numSimplified:0,numFeatures:0,source:null,x:Z,y:le,z:j,transformed:!1,minX:2,minY:1,maxX:-1,maxY:0},Ie=0;Ie<ce.length;Ie++){De.numFeatures++,cc(De,ce[Ie],we,me);var Te=ce[Ie].minX,Re=ce[Ie].minY,nt=ce[Ie].maxX,It=ce[Ie].maxY;Te<De.minX&&(De.minX=Te),Re<De.minY&&(De.minY=Re),nt>De.maxX&&(De.maxX=nt),It>De.maxY&&(De.maxY=It)}return De}function cc(ce,j,Z,le){var me=j.geometry,we=j.type,De=[];if(we==="Point"||we==="MultiPoint")for(var Ie=0;Ie<me.length;Ie+=3)De.push(me[Ie]),De.push(me[Ie+1]),ce.numPoints++,ce.numSimplified++;else if(we==="LineString")_o(De,me,ce,Z,!1,!1);else if(we==="MultiLineString"||we==="Polygon")for(Ie=0;Ie<me.length;Ie++)_o(De,me[Ie],ce,Z,we==="Polygon",Ie===0);else if(we==="MultiPolygon")for(var Te=0;Te<me.length;Te++){var Re=me[Te];for(Ie=0;Ie<Re.length;Ie++)_o(De,Re[Ie],ce,Z,!0,Ie===0)}if(De.length){var nt=j.tags||null;if(we==="LineString"&&le.lineMetrics){for(var It in nt={},j.tags)nt[It]=j.tags[It];nt.mapbox_clip_start=me.start/me.size,nt.mapbox_clip_end=me.end/me.size}var st={geometry:De,type:we==="Polygon"||we==="MultiPolygon"?3:we==="LineString"||we==="MultiLineString"?2:1,tags:nt};j.id!==null&&(st.id=j.id),ce.features.push(st)}}function _o(ce,j,Z,le,me,we){var De=le*le;if(le>0&&j.size<(me?De:le))Z.numPoints+=j.length/3;else{for(var Ie=[],Te=0;Te<j.length;Te+=3)(le===0||j[Te+2]>De)&&(Z.numSimplified++,Ie.push(j[Te]),Ie.push(j[Te+1])),Z.numPoints++;me&&function(Re,nt){for(var It=0,st=0,Nt=Re.length,Gt=Nt-2;st<Nt;Gt=st,st+=2)It+=(Re[st]-Re[Gt])*(Re[st+1]+Re[Gt+1]);if(It>0===nt)for(st=0,Nt=Re.length;st<Nt/2;st+=2){var jt=Re[st],Wt=Re[st+1];Re[st]=Re[Nt-2-st],Re[st+1]=Re[Nt-1-st],Re[Nt-2-st]=jt,Re[Nt-1-st]=Wt}}(Ie,we),ce.push(Ie)}}function Yn(ce,j){var Z=(j=this.options=function(me,we){for(var De in we)me[De]=we[De];return me}(Object.create(this.options),j)).debug;if(Z&&console.time("preprocess data"),j.maxZoom<0||j.maxZoom>24)throw new Error("maxZoom should be in the 0-24 range");if(j.promoteId&&j.generateId)throw new Error("promoteId and generateId cannot be used together.");var le=function(me,we){var De=[];if(me.type==="FeatureCollection")for(var Ie=0;Ie<me.features.length;Ie++)Wn(De,me.features[Ie],we,Ie);else Wn(De,me.type==="Feature"?me:{geometry:me},we);return De}(ce,j);this.tiles={},this.tileCoords=[],Z&&(console.timeEnd("preprocess data"),console.log("index: maxZoom: %d, maxPoints: %d",j.indexMaxZoom,j.indexMaxPoints),console.time("generate tiles"),this.stats={},this.total=0),(le=function(me,we){var De=we.buffer/we.extent,Ie=me,Te=Yr(me,1,-1-De,De,0,-1,2,we),Re=Yr(me,1,1-De,2+De,0,-1,2,we);return(Te||Re)&&(Ie=Yr(me,1,-De,1+De,0,-1,2,we)||[],Te&&(Ie=Js(Te,1).concat(Ie)),Re&&(Ie=Ie.concat(Js(Re,-1)))),Ie}(le,j)).length&&this.splitTile(le,0,0,0),Z&&(le.length&&console.log("features: %d, points: %d",this.tiles[0].numFeatures,this.tiles[0].numPoints),console.timeEnd("generate tiles"),console.log("tiles generated:",this.total,JSON.stringify(this.stats)))}function ls(ce,j,Z){return 32*((1<<ce)*Z+j)+ce}function Ja(ce,j){const Z=ce.tileID.canonical;if(!this._geoJSONIndex)return j(null,null);const le=this._geoJSONIndex.getTile(Z.z,Z.x,Z.y);if(!le)return j(null,null);const me=new ae(le.features);let we=Ae(me);we.byteOffset===0&&we.byteLength===we.buffer.byteLength||(we=new Uint8Array(we)),j(null,{vectorTile:me,rawData:we.buffer})}Yn.prototype.options={maxZoom:14,indexMaxZoom:5,indexMaxPoints:1e5,tolerance:3,extent:4096,buffer:64,lineMetrics:!1,promoteId:null,generateId:!1,debug:0},Yn.prototype.splitTile=function(ce,j,Z,le,me,we,De){for(var Ie=[ce,j,Z,le],Te=this.options,Re=Te.debug;Ie.length;){le=Ie.pop(),Z=Ie.pop(),j=Ie.pop(),ce=Ie.pop();var nt=1<<j,It=ls(j,Z,le),st=this.tiles[It];if(!st&&(Re>1&&console.time("creation"),st=this.tiles[It]=Ka(ce,j,Z,le,Te),this.tileCoords.push({z:j,x:Z,y:le}),Re)){Re>1&&(console.log("tile z%d-%d-%d (features: %d, points: %d, simplified: %d)",j,Z,le,st.numFeatures,st.numPoints,st.numSimplified),console.timeEnd("creation"));var Nt="z"+j;this.stats[Nt]=(this.stats[Nt]||0)+1,this.total++}if(st.source=ce,me){if(j===Te.maxZoom||j===me)continue;var Gt=1<<me-j;if(Z!==Math.floor(we/Gt)||le!==Math.floor(De/Gt))continue}else if(j===Te.indexMaxZoom||st.numPoints<=Te.indexMaxPoints)continue;if(st.source=null,ce.length!==0){Re>1&&console.time("clipping");var jt,Wt,ai,Ti,ji,ki,ke=.5*Te.buffer/Te.extent,Jr=.5-ke,Hi=.5+ke,on=1+ke;jt=Wt=ai=Ti=null,ji=Yr(ce,nt,Z-ke,Z+Hi,0,st.minX,st.maxX,Te),ki=Yr(ce,nt,Z+Jr,Z+on,0,st.minX,st.maxX,Te),ce=null,ji&&(jt=Yr(ji,nt,le-ke,le+Hi,1,st.minY,st.maxY,Te),Wt=Yr(ji,nt,le+Jr,le+on,1,st.minY,st.maxY,Te),ji=null),ki&&(ai=Yr(ki,nt,le-ke,le+Hi,1,st.minY,st.maxY,Te),Ti=Yr(ki,nt,le+Jr,le+on,1,st.minY,st.maxY,Te),ki=null),Re>1&&console.timeEnd("clipping"),Ie.push(jt||[],j+1,2*Z,2*le),Ie.push(Wt||[],j+1,2*Z,2*le+1),Ie.push(ai||[],j+1,2*Z+1,2*le),Ie.push(Ti||[],j+1,2*Z+1,2*le+1)}}},Yn.prototype.getTile=function(ce,j,Z){var le=this.options,me=le.extent,we=le.debug;if(ce<0||ce>24)return null;var De=1<<ce,Ie=ls(ce,j=(j%De+De)%De,Z);if(this.tiles[Ie])return ea(this.tiles[Ie],me);we>1&&console.log("drilling down to z%d-%d-%d",ce,j,Z);for(var Te,Re=ce,nt=j,It=Z;!Te&&Re>0;)Re--,nt=Math.floor(nt/2),It=Math.floor(It/2),Te=this.tiles[ls(Re,nt,It)];return Te&&Te.source?(we>1&&console.log("found parent tile z%d-%d-%d",Re,nt,It),we>1&&console.time("drilling down"),this.splitTile(Te.source,Re,nt,It,ce,j,Z),we>1&&console.timeEnd("drilling down"),this.tiles[Ie]?ea(this.tiles[Ie],me):null):null};class Nr extends n.VectorTileWorkerSource{constructor(j,Z,le,me,we){super(j,Z,le,me,Ja),we&&(this.loadGeoJSON=we)}loadData(j,Z){const le=j&&j.request,me=le&&le.collectResourceTiming;this.loadGeoJSON(j,(we,De)=>{if(we||!De)return Z(we);if(typeof De!="object")return Z(new Error(`Input data given to '${j.source}' is not a valid GeoJSON object.`));{P(De,!0);try{if(j.filter){const Te=n.createExpression(j.filter,{type:"boolean","property-type":"data-driven",overridable:!1,transition:!1});if(Te.result==="error")throw new Error(Te.value.map(nt=>`${nt.key}: ${nt.message}`).join(", "));const Re=De.features.filter(nt=>Te.value.evaluate({zoom:0},nt));De={type:"FeatureCollection",features:Re}}this._geoJSONIndex=j.cluster?new vi(function({superclusterOptions:Te,clusterProperties:Re}){if(!Re||!Te)return Te;const nt={},It={},st={accumulated:null,zoom:0},Nt={properties:null},Gt=Object.keys(Re);for(const jt of Gt){const[Wt,ai]=Re[jt],Ti=n.createExpression(ai),ji=n.createExpression(typeof Wt=="string"?[Wt,["accumulated"],["get",jt]]:Wt);nt[jt]=Ti.value,It[jt]=ji.value}return Te.map=jt=>{Nt.properties=jt;const Wt={};for(const ai of Gt)Wt[ai]=nt[ai].evaluate(st,Nt);return Wt},Te.reduce=(jt,Wt)=>{Nt.properties=Wt;for(const ai of Gt)st.accumulated=jt[ai],jt[ai]=It[ai].evaluate(st,Nt)},Te}(j)).load(De.features):function(Te,Re){return new Yn(Te,Re)}(De,j.geojsonVtOptions)}catch(Te){return Z(Te)}this.loaded={};const Ie={};if(me){const Te=n.getPerformanceMeasurement(le);Te&&(Ie.resourceTiming={},Ie.resourceTiming[j.source]=JSON.parse(JSON.stringify(Te)))}Z(null,Ie)}})}reloadTile(j,Z){const le=this.loaded;return le&&le[j.uid]?super.reloadTile(j,Z):this.loadTile(j,Z)}loadGeoJSON(j,Z){if(j.request)n.getJSON(j.request,Z);else{if(typeof j.data!="string")return Z(new Error(`Input data given to '${j.source}' is not a valid GeoJSON object.`));try{return Z(null,JSON.parse(j.data))}catch{return Z(new Error(`Input data given to '${j.source}' is not a valid GeoJSON object.`))}}}getClusterExpansionZoom(j,Z){try{Z(null,this._geoJSONIndex.getClusterExpansionZoom(j.clusterId))}catch(le){Z(le)}}getClusterChildren(j,Z){try{Z(null,this._geoJSONIndex.getChildren(j.clusterId))}catch(le){Z(le)}}getClusterLeaves(j,Z){try{Z(null,this._geoJSONIndex.getLeaves(j.clusterId,j.limit,j.offset))}catch(le){Z(le)}}}class ta{constructor(j){this.self=j,this.actor=new n.Actor(j,this),this.layerIndexes={},this.availableImages={},this.isSpriteLoaded={},this.projections={},this.defaultProjection=n.getProjection({name:"mercator"}),this.workerSourceTypes={vector:n.VectorTileWorkerSource,geojson:Nr},this.workerSources={},this.demWorkerSources={},this.self.registerWorkerSource=(Z,le)=>{if(this.workerSourceTypes[Z])throw new Error(`Worker source with name "${Z}" already registered.`);this.workerSourceTypes[Z]=le},this.self.registerRTLTextPlugin=Z=>{if(n.plugin.isParsed())throw new Error("RTL text plugin already registered.");n.plugin.applyArabicShaping=Z.applyArabicShaping,n.plugin.processBidirectionalText=Z.processBidirectionalText,n.plugin.processStyledBidirectionalText=Z.processStyledBidirectionalText}}clearCaches(j,Z,le){delete this.layerIndexes[j],delete this.availableImages[j],delete this.workerSources[j],delete this.demWorkerSources[j],le()}checkIfReady(j,Z,le){le()}setReferrer(j,Z){this.referrer=Z}spriteLoaded(j,Z){this.isSpriteLoaded[j]=Z;for(const le in this.workerSources[j]){const me=this.workerSources[j][le];for(const we in me)me[we]instanceof n.VectorTileWorkerSource&&(me[we].isSpriteLoaded=Z,me[we].fire(new n.Event("isSpriteLoaded")))}}setImages(j,Z,le){this.availableImages[j]=Z;for(const me in this.workerSources[j]){const we=this.workerSources[j][me];for(const De in we)we[De].availableImages=Z}le()}enableTerrain(j,Z,le){this.terrain=Z,le()}setProjection(j,Z){this.projections[j]=n.getProjection(Z)}setLayers(j,Z,le){this.getLayerIndex(j).replace(Z),le()}updateLayers(j,Z,le){this.getLayerIndex(j).update(Z.layers,Z.removedIds),le()}loadTile(j,Z,le){const me=this.enableTerrain?n.extend({enableTerrain:this.terrain},Z):Z;me.projection=this.projections[j]||this.defaultProjection,this.getWorkerSource(j,Z.type,Z.source).loadTile(me,le)}loadDEMTile(j,Z,le){const me=this.enableTerrain?n.extend({buildQuadTree:this.terrain},Z):Z;this.getDEMWorkerSource(j,Z.source).loadTile(me,le)}reloadTile(j,Z,le){const me=this.enableTerrain?n.extend({enableTerrain:this.terrain},Z):Z;me.projection=this.projections[j]||this.defaultProjection,this.getWorkerSource(j,Z.type,Z.source).reloadTile(me,le)}abortTile(j,Z,le){this.getWorkerSource(j,Z.type,Z.source).abortTile(Z,le)}removeTile(j,Z,le){this.getWorkerSource(j,Z.type,Z.source).removeTile(Z,le)}removeSource(j,Z,le){if(!this.workerSources[j]||!this.workerSources[j][Z.type]||!this.workerSources[j][Z.type][Z.source])return;const me=this.workerSources[j][Z.type][Z.source];delete this.workerSources[j][Z.type][Z.source],me.removeSource!==void 0?me.removeSource(Z,le):le()}loadWorkerSource(j,Z,le){try{this.self.importScripts(Z.url),le()}catch(me){le(me.toString())}}syncRTLPluginState(j,Z,le){try{n.plugin.setState(Z);const me=n.plugin.getPluginURL();if(n.plugin.isLoaded()&&!n.plugin.isParsed()&&me!=null){this.self.importScripts(me);const we=n.plugin.isParsed();le(we?void 0:new Error(`RTL Text Plugin failed to import scripts from ${me}`),we)}}catch(me){le(me.toString())}}getAvailableImages(j){let Z=this.availableImages[j];return Z||(Z=[]),Z}getLayerIndex(j){let Z=this.layerIndexes[j];return Z||(Z=this.layerIndexes[j]=new M),Z}getWorkerSource(j,Z,le){return this.workerSources[j]||(this.workerSources[j]={}),this.workerSources[j][Z]||(this.workerSources[j][Z]={}),this.workerSources[j][Z][le]||(this.workerSources[j][Z][le]=new this.workerSourceTypes[Z]({send:(me,we,De,Ie,Te,Re)=>{this.actor.send(me,we,De,j,Te,Re)},scheduler:this.actor.scheduler},this.getLayerIndex(j),this.getAvailableImages(j),this.isSpriteLoaded[j])),this.workerSources[j][Z][le]}getDEMWorkerSource(j,Z){return this.demWorkerSources[j]||(this.demWorkerSources[j]={}),this.demWorkerSources[j][Z]||(this.demWorkerSources[j][Z]=new I),this.demWorkerSources[j][Z]}enforceCacheSizeLimit(j,Z){n.enforceCacheSizeLimit(Z)}getWorkerPerformanceMetrics(j,Z,le){le(void 0,void 0)}}return typeof WorkerGlobalScope!="undefined"&&typeof self!="undefined"&&self instanceof WorkerGlobalScope&&(self.worker=new ta(self)),ta}),g(["./shared"],function(n){function w(p,t){if(Array.isArray(p)){if(!Array.isArray(t)||p.length!==t.length)return!1;for(let a=0;a<p.length;a++)if(!w(p[a],t[a]))return!1;return!0}if(typeof p=="object"&&p!==null&&t!==null){if(typeof t!="object"||Object.keys(p).length!==Object.keys(t).length)return!1;for(const a in p)if(!w(p[a],t[a]))return!1;return!0}return p===t}var T=M;function M(p){return!function(t){return typeof window=="undefined"||typeof document=="undefined"?"not a browser":Array.prototype&&Array.prototype.every&&Array.prototype.filter&&Array.prototype.forEach&&Array.prototype.indexOf&&Array.prototype.lastIndexOf&&Array.prototype.map&&Array.prototype.some&&Array.prototype.reduce&&Array.prototype.reduceRight&&Array.isArray?Function.prototype&&Function.prototype.bind?Object.keys&&Object.create&&Object.getPrototypeOf&&Object.getOwnPropertyNames&&Object.isSealed&&Object.isFrozen&&Object.isExtensible&&Object.getOwnPropertyDescriptor&&Object.defineProperty&&Object.defineProperties&&Object.seal&&Object.freeze&&Object.preventExtensions?"JSON"in window&&"parse"in JSON&&"stringify"in JSON?function(){if(!("Worker"in window&&"Blob"in window&&"URL"in window))return!1;var m,v,b=new Blob([""],{type:"text/javascript"}),S=URL.createObjectURL(b);try{v=new Worker(S),m=!0}catch{m=!1}return v&&v.terminate(),URL.revokeObjectURL(S),m}()?"Uint8ClampedArray"in window?ArrayBuffer.isView?function(){var m=document.createElement("canvas");m.width=m.height=1;var v=m.getContext("2d");if(!v)return!1;var b=v.getImageData(0,0,1,1);return b&&b.width===m.width}()?(I[a=t&&t.failIfMajorPerformanceCaveat]===void 0&&(I[a]=function(m){var v,b=function(S){var k=document.createElement("canvas"),D=Object.create(M.webGLContextAttributes);return D.failIfMajorPerformanceCaveat=S,k.getContext("webgl",D)||k.getContext("experimental-webgl",D)}(m);if(!b)return!1;try{v=b.createShader(b.VERTEX_SHADER)}catch{return!1}return!(!v||b.isContextLost())&&(b.shaderSource(v,"void main() {}"),b.compileShader(v),b.getShaderParameter(v,b.COMPILE_STATUS)===!0)}(a)),I[a]?document.documentMode?"insufficient ECMAScript 6 support":void 0:"insufficient WebGL support"):"insufficient Canvas/getImageData support":"insufficient ArrayBuffer support":"insufficient Uint8ClampedArray support":"insufficient worker support":"insufficient JSON support":"insufficient Object support":"insufficient Function support":"insufficent Array support";var a}(p)}var I={};function P(p,t,a){const m=n.window.document.createElement(p);return t!==void 0&&(m.className=t),a&&a.appendChild(m),m}function z(p,t,a){const m=n.window.document.createElementNS("http://www.w3.org/2000/svg",p);for(const v of Object.keys(t))m.setAttributeNS(null,v,t[v]);return a&&a.appendChild(m),m}M.webGLContextAttributes={antialias:!1,alpha:!0,stencil:!0,depth:!0};const R=n.window.document&&n.window.document.documentElement.style,F=R&&R.userSelect!==void 0?"userSelect":"WebkitUserSelect";let q;function ae(){R&&F&&(q=R[F],R[F]="none")}function se(){R&&F&&(R[F]=q)}function ie(p){p.preventDefault(),p.stopPropagation(),n.window.removeEventListener("click",ie,!0)}function Q(){n.window.addEventListener("click",ie,!0),n.window.setTimeout(()=>{n.window.removeEventListener("click",ie,!0)},0)}function re(p,t){const a=p.getBoundingClientRect();return Je(p,a,t)}function Ae(p,t){const a=p.getBoundingClientRect(),m=[];for(let v=0;v<t.length;v++)m.push(Je(p,a,t[v]));return m}function $e(p){return n.window.InstallTrigger!==void 0&&p.button===2&&p.ctrlKey&&n.window.navigator.platform.toUpperCase().indexOf("MAC")>=0?0:p.button}function Je(p,t,a){const m=p.offsetWidth===t.width?1:p.offsetWidth/t.width;return new n.pointGeometry((a.clientX-t.left)*m,(a.clientY-t.top)*m)}function ze(p,t){var a=t[0],m=t[1],v=t[2],b=t[3],S=a*b-v*m;return S?(p[0]=b*(S=1/S),p[1]=-m*S,p[2]=-v*S,p[3]=a*S,p):null}function Pe(p){const{userImage:t}=p;return!!(t&&t.render&&t.render())&&(p.data.replace(new Uint8Array(t.data.buffer)),!0)}class Ge extends n.Evented{constructor(){super(),this.images={},this.updatedImages={},this.callbackDispatchedThisFrame={},this.loaded=!1,this.requestors=[],this.patterns={},this.atlasImage=new n.RGBAImage({width:1,height:1}),this.dirty=!0}isLoaded(){return this.loaded}setLoaded(t){if(this.loaded!==t&&(this.loaded=t,t)){for(const{ids:a,callback:m}of this.requestors)this._notify(a,m);this.requestors=[]}}hasImage(t){return!!this.getImage(t)}getImage(t){return this.images[t]}addImage(t,a){this._validate(t,a)&&(this.images[t]=a)}_validate(t,a){let m=!0;return this._validateStretch(a.stretchX,a.data&&a.data.width)||(this.fire(new n.ErrorEvent(new Error(`Image "${t}" has invalid "stretchX" value`))),m=!1),this._validateStretch(a.stretchY,a.data&&a.data.height)||(this.fire(new n.ErrorEvent(new Error(`Image "${t}" has invalid "stretchY" value`))),m=!1),this._validateContent(a.content,a)||(this.fire(new n.ErrorEvent(new Error(`Image "${t}" has invalid "content" value`))),m=!1),m}_validateStretch(t,a){if(!t)return!0;let m=0;for(const v of t){if(v[0]<m||v[1]<v[0]||a<v[1])return!1;m=v[1]}return!0}_validateContent(t,a){return!(t&&(t.length!==4||t[0]<0||a.data.width<t[0]||t[1]<0||a.data.height<t[1]||t[2]<0||a.data.width<t[2]||t[3]<0||a.data.height<t[3]||t[2]<t[0]||t[3]<t[1]))}updateImage(t,a){a.version=this.images[t].version+1,this.images[t]=a,this.updatedImages[t]=!0}removeImage(t){const a=this.images[t];delete this.images[t],delete this.patterns[t],a.userImage&&a.userImage.onRemove&&a.userImage.onRemove()}listImages(){return Object.keys(this.images)}getImages(t,a){let m=!0;if(!this.isLoaded())for(const v of t)this.images[v]||(m=!1);this.isLoaded()||m?this._notify(t,a):this.requestors.push({ids:t,callback:a})}_notify(t,a){const m={};for(const v of t){this.images[v]||this.fire(new n.Event("styleimagemissing",{id:v}));const b=this.images[v];b?m[v]={data:b.data.clone(),pixelRatio:b.pixelRatio,sdf:b.sdf,version:b.version,stretchX:b.stretchX,stretchY:b.stretchY,content:b.content,hasRenderCallback:Boolean(b.userImage&&b.userImage.render)}:n.warnOnce(`Image "${v}" could not be loaded. Please make sure you have added the image with map.addImage() or a "sprite" property in your style. You can provide missing images by listening for the "styleimagemissing" map event.`)}a(null,m)}getPixelSize(){const{width:t,height:a}=this.atlasImage;return{width:t,height:a}}getPattern(t){const a=this.patterns[t],m=this.getImage(t);if(!m)return null;if(a&&a.position.version===m.version)return a.position;if(a)a.position.version=m.version;else{const v={w:m.data.width+2,h:m.data.height+2,x:0,y:0},b=new n.ImagePosition(v,m);this.patterns[t]={bin:v,position:b}}return this._updatePatternAtlas(),this.patterns[t].position}bind(t){const a=t.gl;this.atlasTexture?this.dirty&&(this.atlasTexture.update(this.atlasImage),this.dirty=!1):this.atlasTexture=new n.Texture(t,this.atlasImage,a.RGBA),this.atlasTexture.bind(a.LINEAR,a.CLAMP_TO_EDGE)}_updatePatternAtlas(){const t=[];for(const b in this.patterns)t.push(this.patterns[b].bin);const{w:a,h:m}=n.potpack(t),v=this.atlasImage;v.resize({width:a||1,height:m||1});for(const b in this.patterns){const{bin:S}=this.patterns[b],k=S.x+1,D=S.y+1,O=this.images[b].data,V=O.width,G=O.height;n.RGBAImage.copy(O,v,{x:0,y:0},{x:k,y:D},{width:V,height:G}),n.RGBAImage.copy(O,v,{x:0,y:G-1},{x:k,y:D-1},{width:V,height:1}),n.RGBAImage.copy(O,v,{x:0,y:0},{x:k,y:D+G},{width:V,height:1}),n.RGBAImage.copy(O,v,{x:V-1,y:0},{x:k-1,y:D},{width:1,height:G}),n.RGBAImage.copy(O,v,{x:0,y:0},{x:k+V,y:D},{width:1,height:G})}this.dirty=!0}beginFrame(){this.callbackDispatchedThisFrame={}}dispatchRenderCallbacks(t){for(const a of t){if(this.callbackDispatchedThisFrame[a])continue;this.callbackDispatchedThisFrame[a]=!0;const m=this.images[a];Pe(m)&&this.updateImage(a,m)}}}const Qe=new n.Properties({anchor:new n.DataConstantProperty(n.spec.light.anchor),position:new class{constructor(){this.specification=n.spec.light.position}possiblyEvaluate(p,t){return function([a,m,v]){const b=n.degToRad(m+90),S=n.degToRad(v);return{x:a*Math.cos(b)*Math.sin(S),y:a*Math.sin(b)*Math.sin(S),z:a*Math.cos(S),azimuthal:m,polar:v}}(p.expression.evaluate(t))}interpolate(p,t,a){return{x:n.number(p.x,t.x,a),y:n.number(p.y,t.y,a),z:n.number(p.z,t.z,a),azimuthal:n.number(p.azimuthal,t.azimuthal,a),polar:n.number(p.polar,t.polar,a)}}},color:new n.DataConstantProperty(n.spec.light.color),intensity:new n.DataConstantProperty(n.spec.light.intensity)}),Rt="-transition";class mt extends n.Evented{constructor(t){super(),this._transitionable=new n.Transitionable(Qe),this.setLight(t),this._transitioning=this._transitionable.untransitioned()}getLight(){return this._transitionable.serialize()}setLight(t,a={}){if(!this._validate(n.validateLight,t,a))for(const m in t){const v=t[m];n.endsWith(m,Rt)?this._transitionable.setTransition(m.slice(0,-Rt.length),v):this._transitionable.setValue(m,v)}}updateTransitions(t){this._transitioning=this._transitionable.transitioned(t,this._transitioning)}hasTransition(){return this._transitioning.hasTransition()}recalculate(t){this.properties=this._transitioning.possiblyEvaluate(t)}_validate(t,a,m){return(!m||m.validate!==!1)&&n.emitValidationErrors(this,t.call(n.validateStyle,n.extend({value:a,style:{glyphs:!0,sprite:!0},styleSpec:n.spec})))}}const Ne=new n.Properties({source:new n.DataConstantProperty(n.spec.terrain.source),exaggeration:new n.DataConstantProperty(n.spec.terrain.exaggeration)}),At="-transition";class $t extends n.Evented{constructor(t,a){super(),this._transitionable=new n.Transitionable(Ne),this.set(t),this._transitioning=this._transitionable.untransitioned(),this.drapeRenderMode=a}get(){return this._transitionable.serialize()}set(t){for(const a in t){const m=t[a];n.endsWith(a,At)?this._transitionable.setTransition(a.slice(0,-At.length),m):this._transitionable.setValue(a,m)}}updateTransitions(t){this._transitioning=this._transitionable.transitioned(t,this._transitioning)}hasTransition(){return this._transitioning.hasTransition()}recalculate(t){this.properties=this._transitioning.possiblyEvaluate(t)}}function _t(p,t,a,m){const v=n.smoothstep(45,65,a),[b,S]=Ht(p,m),k=n.length(t);let D=1-Math.min(1,Math.exp((k-b)/(S-b)*-6));return D*=D*D,D=Math.min(1,1.00747*D),D*v*p.alpha}function Ht(p,t){const a=.5/Math.tan(.5*t);return[p.range[0]+a,p.range[1]+a]}const Ci=new n.Properties({range:new n.DataConstantProperty(n.spec.fog.range),color:new n.DataConstantProperty(n.spec.fog.color),"high-color":new n.DataConstantProperty(n.spec.fog["high-color"]),"space-color":new n.DataConstantProperty(n.spec.fog["space-color"]),"horizon-blend":new n.DataConstantProperty(n.spec.fog["horizon-blend"]),"star-intensity":new n.DataConstantProperty(n.spec.fog["star-intensity"])}),Ui="-transition";class Kt extends n.Evented{constructor(t,a){super(),this._transitionable=new n.Transitionable(Ci),this.set(t),this._transitioning=this._transitionable.untransitioned(),this._transform=a}get state(){const t=this._transform,a=t.projection.name==="globe",m=n.globeToMercatorTransition(t.zoom),v=this.properties.get("range"),b=[.5,3];return{range:a?[n.number(b[0],v[0],m),n.number(b[1],v[1],m)]:v,horizonBlend:this.properties.get("horizon-blend"),alpha:this.properties.get("color").a}}get(){return this._transitionable.serialize()}set(t,a={}){if(!this._validate(n.validateFog,t,a)){for(const m of Object.keys(n.spec.fog))t&&t[m]===void 0&&(t[m]=n.spec.fog[m].default);for(const m in t){const v=t[m];n.endsWith(m,Ui)?this._transitionable.setTransition(m.slice(0,-Ui.length),v):this._transitionable.setValue(m,v)}}}getOpacity(t){if(!this._transform.projection.supportsFog)return 0;const a=this.properties&&this.properties.get("color")||1;return(this._transform.projection.name==="globe"?1:n.smoothstep(45,65,t))*a.a}getOpacityAtLatLng(t,a){return this._transform.projection.supportsFog?function(m,v,b){const S=n.MercatorCoordinate.fromLngLat(v),k=b.elevation?b.elevation.getAtPointOrZero(S):0,D=[S.x,S.y,k];return n.transformMat4(D,D,b.mercatorFogMatrix),_t(m,D,b.pitch,b._fov)}(this.state,t,a):0}getFovAdjustedRange(t){return this._transform.projection.supportsFog?Ht(this.state,t):[0,1]}updateTransitions(t){this._transitioning=this._transitionable.transitioned(t,this._transitioning)}hasTransition(){return this._transitioning.hasTransition()}recalculate(t){this.properties=this._transitioning.possiblyEvaluate(t)}_validate(t,a,m){return(!m||m.validate!==!1)&&n.emitValidationErrors(this,t.call(n.validateStyle,n.extend({value:a,style:{glyphs:!0,sprite:!0},styleSpec:n.spec})))}}class Yt{constructor(t,a){this.workerPool=t,this.actors=[],this.currentActor=0,this.id=n.uniqueId();const m=this.workerPool.acquire(this.id);for(let v=0;v<m.length;v++){const b=new Yt.Actor(m[v],a,this.id);b.name=`Worker ${v}`,this.actors.push(b)}this.ready=!1,this.broadcast("checkIfReady",null,()=>{this.ready=!0})}broadcast(t,a,m){n.asyncAll(this.actors,(v,b)=>{v.send(t,a,b)},m=m||function(){})}getActor(){return this.currentActor=(this.currentActor+1)%this.actors.length,this.actors[this.currentActor]}remove(){this.actors.forEach(t=>{t.remove()}),this.actors=[],this.workerPool.release(this.id)}}function Lt(p,t,a){return t*(n.EXTENT/(p.tileSize*Math.pow(2,a-p.tileID.overscaledZ)))}Yt.Actor=n.Actor;class Zt{constructor(t,a,m,v){this.screenBounds=t,this.cameraPoint=a,this._screenRaycastCache={},this._cameraRaycastCache={},this.isAboveHorizon=m,this.screenGeometry=this.bufferedScreenGeometry(0),this.screenGeometryMercator=this._bufferedScreenMercator(0,v)}static createFromScreenPoints(t,a){let m,v;if(t instanceof n.pointGeometry||typeof t[0]=="number"){const b=n.pointGeometry.convert(t);m=[n.pointGeometry.convert(t)],v=a.isPointAboveHorizon(b)}else{const b=n.pointGeometry.convert(t[0]),S=n.pointGeometry.convert(t[1]);m=[b,S],v=n.polygonizeBounds(b,S).every(k=>a.isPointAboveHorizon(k))}return new Zt(m,a.getCameraPoint(),v,a)}isPointQuery(){return this.screenBounds.length===1}bufferedScreenGeometry(t){return n.polygonizeBounds(this.screenBounds[0],this.screenBounds.length===1?this.screenBounds[0]:this.screenBounds[1],t)}bufferedCameraGeometry(t){const a=this.screenBounds[0],m=this.screenBounds.length===1?this.screenBounds[0].add(new n.pointGeometry(1,1)):this.screenBounds[1],v=n.polygonizeBounds(a,m,0,!1);return this.cameraPoint.y>m.y&&(this.cameraPoint.x>a.x&&this.cameraPoint.x<m.x?v.splice(3,0,this.cameraPoint):this.cameraPoint.x>=m.x?v[2]=this.cameraPoint:this.cameraPoint.x<=a.x&&(v[3]=this.cameraPoint)),n.bufferConvexPolygon(v,t)}bufferedCameraGeometryGlobe(t){const a=this.screenBounds[0],m=this.screenBounds.length===1?this.screenBounds[0].add(new n.pointGeometry(1,1)):this.screenBounds[1],v=n.polygonizeBounds(a,m,t),b=this.cameraPoint.clone();switch(3*((b.y>a.y)+(b.y>m.y))+((b.x>a.x)+(b.x>m.x))){case 0:v[0]=b,v[4]=b.clone();break;case 1:v.splice(1,0,b);break;case 2:v[1]=b;break;case 3:v.splice(4,0,b);break;case 5:v.splice(2,0,b);break;case 6:v[3]=b;break;case 7:v.splice(3,0,b);break;case 8:v[2]=b}return v}containsTile(t,a,m,v=0){const b=t.queryPadding/a._projectionScaler+1,S=m?this._bufferedCameraMercator(b,a):this._bufferedScreenMercator(b,a);let k=t.tileID.wrap+(S.unwrapped?v:0);const D=S.polygon.map(pe=>n.getTilePoint(t.tileTransform,pe,k));if(!n.polygonIntersectsBox(D,0,0,n.EXTENT,n.EXTENT))return;k=t.tileID.wrap+(this.screenGeometryMercator.unwrapped?v:0);const O=this.screenGeometryMercator.polygon.map(pe=>n.getTileVec3(t.tileTransform,pe,k)),V=O.map(pe=>new n.pointGeometry(pe[0],pe[1])),G=a.getFreeCameraOptions().position||new n.MercatorCoordinate(0,0,0),X=n.getTileVec3(t.tileTransform,G,k),J=O.map(pe=>{const K=n.sub(pe,pe,X);return n.normalize(K,K),new n.Ray(X,K)}),ee=Lt(t,1,a.zoom)*a._projectionScaler;return{queryGeometry:this,tilespaceGeometry:V,tilespaceRays:J,bufferedTilespaceGeometry:D,bufferedTilespaceBounds:(Y=n.getBounds(D),Y.min.x=n.clamp(Y.min.x,0,n.EXTENT),Y.min.y=n.clamp(Y.min.y,0,n.EXTENT),Y.max.x=n.clamp(Y.max.x,0,n.EXTENT),Y.max.y=n.clamp(Y.max.y,0,n.EXTENT),Y),tile:t,tileID:t.tileID,pixelToTileUnitsFactor:ee};var Y}_bufferedScreenMercator(t,a){const m=vn(t);if(this._screenRaycastCache[m])return this._screenRaycastCache[m];{let v;return v=a.projection.name==="globe"?this._projectAndResample(this.bufferedScreenGeometry(t),a):{polygon:this.bufferedScreenGeometry(t).map(b=>a.pointCoordinate3D(b)),unwrapped:!0},this._screenRaycastCache[m]=v,v}}_bufferedCameraMercator(t,a){const m=vn(t);if(this._cameraRaycastCache[m])return this._cameraRaycastCache[m];{let v;return v=a.projection.name==="globe"?this._projectAndResample(this.bufferedCameraGeometryGlobe(t),a):{polygon:this.bufferedCameraGeometry(t).map(b=>a.pointCoordinate3D(b)),unwrapped:!0},this._cameraRaycastCache[m]=v,v}}_projectAndResample(t,a){const m=function(b,S){const k=n.multiply([],S.pixelMatrix,S.globeMatrix),D=[0,-n.GLOBE_RADIUS,0,1],O=[0,n.GLOBE_RADIUS,0,1],V=[0,0,0,1];n.transformMat4$1(D,D,k),n.transformMat4$1(O,O,k),n.transformMat4$1(V,V,k);const G=new n.pointGeometry(D[0]/D[3],D[1]/D[3]),X=new n.pointGeometry(O[0]/O[3],O[1]/O[3]),J=n.polygonContainsPoint(b,G)&&D[3]<V[3],ee=n.polygonContainsPoint(b,X)&&O[3]<V[3];if(!J&&!ee)return null;const Y=function(be,Ve,Ze){for(let je=1;je<be.length;je++){const Ue=vi(Ve.pointCoordinate3D(be[je-1]).x),_e=vi(Ve.pointCoordinate3D(be[je]).x);if(Ze<0){if(Ue<_e)return{idx:je,t:-Ue/(_e-1-Ue)}}else if(_e<Ue)return{idx:je,t:(1-Ue)/(_e+1-Ue)}}return null}(b,S,J?-1:1);if(!Y)return null;const{idx:pe,t:K}=Y;let ne=pe>1?vr(b.slice(0,pe),S):[],oe=pe<b.length?vr(b.slice(pe),S):[];ne=ne.map(be=>new n.pointGeometry(vi(be.x),be.y)),oe=oe.map(be=>new n.pointGeometry(vi(be.x),be.y));const ge=[...ne];ge.length===0&&ge.push(oe[oe.length-1]);const he=n.number(ge[ge.length-1].y,(oe.length===0?ne[0]:oe[0]).y,K);let fe;return fe=J?[new n.pointGeometry(0,he),new n.pointGeometry(0,0),new n.pointGeometry(1,0),new n.pointGeometry(1,he)]:[new n.pointGeometry(1,he),new n.pointGeometry(1,1),new n.pointGeometry(0,1),new n.pointGeometry(0,he)],ge.push(...fe),oe.length===0?ge.push(ne[0]):ge.push(...oe),{polygon:ge.map(be=>new n.MercatorCoordinate(be.x,be.y)),unwrapped:!1}}(t,a);if(m)return m;const v=function(b,S){let k=!1,D=-1/0,O=0;for(let G=0;G<b.length-1;G++)b[G].x>D&&(D=b[G].x,O=G);for(let G=0;G<b.length-1;G++){const X=(O+G)%(b.length-1),J=b[X],ee=b[X+1];Math.abs(J.x-ee.x)>.5&&(J.x<ee.x?(J.x+=1,X===0&&(b[b.length-1].x+=1)):(ee.x+=1,X+1===b.length-1&&(b[0].x+=1)),k=!0)}const V=n.mercatorXfromLng(S.center.lng);return k&&V<Math.abs(V-1)&&b.forEach(G=>{G.x-=1}),{polygon:b,unwrapped:k}}(vr(t,a).map(b=>new n.pointGeometry(vi(b.x),b.y)),a);return{polygon:v.polygon.map(b=>new n.MercatorCoordinate(b.x,b.y)),unwrapped:v.unwrapped}}}function vr(p,t){return n.resample(p,a=>{const m=t.pointCoordinate3D(a);a.x=m.x,a.y=m.y},1/256)}function vi(p){return p<0?1+p%1:p%1}function vn(p){return 100*p|0}function fo(p,t,a,m,v){const b=function(S,k){if(S)return v(S);if(k){const D=n.pick(n.extend(k,p),["tiles","minzoom","maxzoom","attribution","mapbox_logo","bounds","scheme","tileSize","encoding"]);k.vector_layers&&(D.vectorLayers=k.vector_layers,D.vectorLayerIds=D.vectorLayers.map(O=>O.id)),k.language_options&&(D.languageOptions=k.language_options),k.language&&k.language[k.id]&&(D.language=k.language[k.id]),k.worldview_options&&(D.worldviewOptions=k.worldview_options),k.worldview?D.worldview=k.worldview[k.id]:k.worldview_default&&(D.worldview=k.worldview_default),D.tiles=t.canonicalizeTileset(D,p.url),v(null,D)}};return p.url?n.getJSON(t.transformRequest(t.normalizeSourceURL(p.url,null,a,m),n.ResourceType.Source),b):n.exported.frame(()=>b(null,p))}class xn{constructor(t,a,m){this.bounds=n.LngLatBounds.convert(this.validateBounds(t)),this.minzoom=a||0,this.maxzoom=m||24}validateBounds(t){return Array.isArray(t)&&t.length===4?[Math.max(-180,t[0]),Math.max(-90,t[1]),Math.min(180,t[2]),Math.min(90,t[3])]:[-180,-90,180,90]}contains(t){const a=Math.pow(2,t.z),m=Math.floor(n.mercatorXfromLng(this.bounds.getWest())*a),v=Math.floor(n.mercatorYfromLat(this.bounds.getNorth())*a),b=Math.ceil(n.mercatorXfromLng(this.bounds.getEast())*a),S=Math.ceil(n.mercatorYfromLat(this.bounds.getSouth())*a);return t.x>=m&&t.x<b&&t.y>=v&&t.y<S}}class Do{constructor(t,a,m){this.context=t;const v=t.gl;this.buffer=v.createBuffer(),this.dynamicDraw=Boolean(m),this.context.unbindVAO(),t.bindElementBuffer.set(this.buffer),v.bufferData(v.ELEMENT_ARRAY_BUFFER,a.arrayBuffer,this.dynamicDraw?v.DYNAMIC_DRAW:v.STATIC_DRAW),this.dynamicDraw||a.destroy()}bind(){this.context.bindElementBuffer.set(this.buffer)}updateData(t){const a=this.context.gl;this.context.unbindVAO(),this.bind(),a.bufferSubData(a.ELEMENT_ARRAY_BUFFER,0,t.arrayBuffer)}destroy(){this.buffer&&(this.context.gl.deleteBuffer(this.buffer),delete this.buffer)}}const Lo={Int8:"BYTE",Uint8:"UNSIGNED_BYTE",Int16:"SHORT",Uint16:"UNSIGNED_SHORT",Int32:"INT",Uint32:"UNSIGNED_INT",Float32:"FLOAT"};class Ro{constructor(t,a,m,v){this.length=a.length,this.attributes=m,this.itemSize=a.bytesPerElement,this.dynamicDraw=v,this.context=t;const b=t.gl;this.buffer=b.createBuffer(),t.bindVertexBuffer.set(this.buffer),b.bufferData(b.ARRAY_BUFFER,a.arrayBuffer,this.dynamicDraw?b.DYNAMIC_DRAW:b.STATIC_DRAW),this.dynamicDraw||a.destroy()}bind(){this.context.bindVertexBuffer.set(this.buffer)}updateData(t){const a=this.context.gl;this.bind(),a.bufferSubData(a.ARRAY_BUFFER,0,t.arrayBuffer)}enableAttributes(t,a){for(let m=0;m<this.attributes.length;m++){const v=a.attributes[this.attributes[m].name];v!==void 0&&t.enableVertexAttribArray(v)}}setVertexAttribPointers(t,a,m){for(let v=0;v<this.attributes.length;v++){const b=this.attributes[v],S=a.attributes[b.name];S!==void 0&&t.vertexAttribPointer(S,b.components,t[Lo[b.type]],!1,this.itemSize,b.offset+this.itemSize*(m||0))}}destroy(){this.buffer&&(this.context.gl.deleteBuffer(this.buffer),delete this.buffer)}}class xi{constructor(t){this.gl=t.gl,this.default=this.getDefault(),this.current=this.default,this.dirty=!1}get(){return this.current}set(t){}getDefault(){return this.default}setDefault(){this.set(this.default)}}class $n extends xi{getDefault(){return n.Color.transparent}set(t){const a=this.current;(t.r!==a.r||t.g!==a.g||t.b!==a.b||t.a!==a.a||this.dirty)&&(this.gl.clearColor(t.r,t.g,t.b,t.a),this.current=t,this.dirty=!1)}}class Bo extends xi{getDefault(){return 1}set(t){(t!==this.current||this.dirty)&&(this.gl.clearDepth(t),this.current=t,this.dirty=!1)}}class Pn extends xi{getDefault(){return 0}set(t){(t!==this.current||this.dirty)&&(this.gl.clearStencil(t),this.current=t,this.dirty=!1)}}class nn extends xi{getDefault(){return[!0,!0,!0,!0]}set(t){const a=this.current;(t[0]!==a[0]||t[1]!==a[1]||t[2]!==a[2]||t[3]!==a[3]||this.dirty)&&(this.gl.colorMask(t[0],t[1],t[2],t[3]),this.current=t,this.dirty=!1)}}class ss extends xi{getDefault(){return!0}set(t){(t!==this.current||this.dirty)&&(this.gl.depthMask(t),this.current=t,this.dirty=!1)}}class gi extends xi{getDefault(){return 255}set(t){(t!==this.current||this.dirty)&&(this.gl.stencilMask(t),this.current=t,this.dirty=!1)}}class mo extends xi{getDefault(){return{func:this.gl.ALWAYS,ref:0,mask:255}}set(t){const a=this.current;(t.func!==a.func||t.ref!==a.ref||t.mask!==a.mask||this.dirty)&&(this.gl.stencilFunc(t.func,t.ref,t.mask),this.current=t,this.dirty=!1)}}class Wn extends xi{getDefault(){const t=this.gl;return[t.KEEP,t.KEEP,t.KEEP]}set(t){const a=this.current;(t[0]!==a[0]||t[1]!==a[1]||t[2]!==a[2]||this.dirty)&&(this.gl.stencilOp(t[0],t[1],t[2]),this.current=t,this.dirty=!1)}}class Xn extends xi{getDefault(){return!1}set(t){if(t===this.current&&!this.dirty)return;const a=this.gl;t?a.enable(a.STENCIL_TEST):a.disable(a.STENCIL_TEST),this.current=t,this.dirty=!1}}class Oo extends xi{getDefault(){return[0,1]}set(t){const a=this.current;(t[0]!==a[0]||t[1]!==a[1]||this.dirty)&&(this.gl.depthRange(t[0],t[1]),this.current=t,this.dirty=!1)}}class as extends xi{getDefault(){return!1}set(t){if(t===this.current&&!this.dirty)return;const a=this.gl;t?a.enable(a.DEPTH_TEST):a.disable(a.DEPTH_TEST),this.current=t,this.dirty=!1}}class Hs extends xi{getDefault(){return this.gl.LESS}set(t){(t!==this.current||this.dirty)&&(this.gl.depthFunc(t),this.current=t,this.dirty=!1)}}class Ys extends xi{getDefault(){return!1}set(t){if(t===this.current&&!this.dirty)return;const a=this.gl;t?a.enable(a.BLEND):a.disable(a.BLEND),this.current=t,this.dirty=!1}}class Yr extends xi{getDefault(){const t=this.gl;return[t.ONE,t.ZERO]}set(t){const a=this.current;(t[0]!==a[0]||t[1]!==a[1]||this.dirty)&&(this.gl.blendFunc(t[0],t[1]),this.current=t,this.dirty=!1)}}class Dn extends xi{getDefault(){return n.Color.transparent}set(t){const a=this.current;(t.r!==a.r||t.g!==a.g||t.b!==a.b||t.a!==a.a||this.dirty)&&(this.gl.blendColor(t.r,t.g,t.b,t.a),this.current=t,this.dirty=!1)}}class Fo extends xi{getDefault(){return this.gl.FUNC_ADD}set(t){(t!==this.current||this.dirty)&&(this.gl.blendEquation(t),this.current=t,this.dirty=!1)}}class Xa extends xi{getDefault(){return!1}set(t){if(t===this.current&&!this.dirty)return;const a=this.gl;t?a.enable(a.CULL_FACE):a.disable(a.CULL_FACE),this.current=t,this.dirty=!1}}class Kr extends xi{getDefault(){return this.gl.BACK}set(t){(t!==this.current||this.dirty)&&(this.gl.cullFace(t),this.current=t,this.dirty=!1)}}class Hn extends xi{getDefault(){return this.gl.CCW}set(t){(t!==this.current||this.dirty)&&(this.gl.frontFace(t),this.current=t,this.dirty=!1)}}class Ha extends xi{getDefault(){return null}set(t){(t!==this.current||this.dirty)&&(this.gl.useProgram(t),this.current=t,this.dirty=!1)}}class Ks extends xi{getDefault(){return this.gl.TEXTURE0}set(t){(t!==this.current||this.dirty)&&(this.gl.activeTexture(t),this.current=t,this.dirty=!1)}}class Js extends xi{getDefault(){const t=this.gl;return[0,0,t.drawingBufferWidth,t.drawingBufferHeight]}set(t){const a=this.current;(t[0]!==a[0]||t[1]!==a[1]||t[2]!==a[2]||t[3]!==a[3]||this.dirty)&&(this.gl.viewport(t[0],t[1],t[2],t[3]),this.current=t,this.dirty=!1)}}class Qs extends xi{getDefault(){return null}set(t){if(t===this.current&&!this.dirty)return;const a=this.gl;a.bindFramebuffer(a.FRAMEBUFFER,t),this.current=t,this.dirty=!1}}class ea extends xi{getDefault(){return null}set(t){if(t===this.current&&!this.dirty)return;const a=this.gl;a.bindRenderbuffer(a.RENDERBUFFER,t),this.current=t,this.dirty=!1}}class Ya extends xi{getDefault(){return null}set(t){if(t===this.current&&!this.dirty)return;const a=this.gl;a.bindTexture(a.TEXTURE_2D,t),this.current=t,this.dirty=!1}}class Ka extends xi{getDefault(){return null}set(t){if(t===this.current&&!this.dirty)return;const a=this.gl;a.bindBuffer(a.ARRAY_BUFFER,t),this.current=t,this.dirty=!1}}class cc extends xi{getDefault(){return null}set(t){const a=this.gl;a.bindBuffer(a.ELEMENT_ARRAY_BUFFER,t),this.current=t,this.dirty=!1}}class _o extends xi{constructor(t){super(t),this.vao=t.extVertexArrayObject}getDefault(){return null}set(t){this.vao&&(t!==this.current||this.dirty)&&(this.vao.bindVertexArrayOES(t),this.current=t,this.dirty=!1)}}class Yn extends xi{getDefault(){return 4}set(t){if(t===this.current&&!this.dirty)return;const a=this.gl;a.pixelStorei(a.UNPACK_ALIGNMENT,t),this.current=t,this.dirty=!1}}class ls extends xi{getDefault(){return!1}set(t){if(t===this.current&&!this.dirty)return;const a=this.gl;a.pixelStorei(a.UNPACK_PREMULTIPLY_ALPHA_WEBGL,t),this.current=t,this.dirty=!1}}class Ja extends xi{getDefault(){return!1}set(t){if(t===this.current&&!this.dirty)return;const a=this.gl;a.pixelStorei(a.UNPACK_FLIP_Y_WEBGL,t),this.current=t,this.dirty=!1}}class Nr extends xi{constructor(t,a){super(t),this.context=t,this.parent=a}getDefault(){return null}}class ta extends Nr{setDirty(){this.dirty=!0}set(t){if(t===this.current&&!this.dirty)return;this.context.bindFramebuffer.set(this.parent);const a=this.gl;a.framebufferTexture2D(a.FRAMEBUFFER,a.COLOR_ATTACHMENT0,a.TEXTURE_2D,t,0),this.current=t,this.dirty=!1}}class ce extends Nr{attachment(){return this.gl.DEPTH_ATTACHMENT}set(t){if(t===this.current&&!this.dirty)return;this.context.bindFramebuffer.set(this.parent);const a=this.gl;a.framebufferRenderbuffer(a.FRAMEBUFFER,this.attachment(),a.RENDERBUFFER,t),this.current=t,this.dirty=!1}}class j extends ce{attachment(){return this.gl.DEPTH_STENCIL_ATTACHMENT}}class Z{constructor(t,a,m,v){this.context=t,this.width=a,this.height=m;const b=this.framebuffer=t.gl.createFramebuffer();this.colorAttachment=new ta(t,b),v&&(this.depthAttachment=new ce(t,b))}destroy(){const t=this.context.gl,a=this.colorAttachment.get();if(a&&t.deleteTexture(a),this.depthAttachment){const m=this.depthAttachment.get();m&&t.deleteRenderbuffer(m)}t.deleteFramebuffer(this.framebuffer)}}class le{constructor(t){this.gl=t,this.extVertexArrayObject=this.gl.getExtension("OES_vertex_array_object"),this.clearColor=new $n(this),this.clearDepth=new Bo(this),this.clearStencil=new Pn(this),this.colorMask=new nn(this),this.depthMask=new ss(this),this.stencilMask=new gi(this),this.stencilFunc=new mo(this),this.stencilOp=new Wn(this),this.stencilTest=new Xn(this),this.depthRange=new Oo(this),this.depthTest=new as(this),this.depthFunc=new Hs(this),this.blend=new Ys(this),this.blendFunc=new Yr(this),this.blendColor=new Dn(this),this.blendEquation=new Fo(this),this.cullFace=new Xa(this),this.cullFaceSide=new Kr(this),this.frontFace=new Hn(this),this.program=new Ha(this),this.activeTexture=new Ks(this),this.viewport=new Js(this),this.bindFramebuffer=new Qs(this),this.bindRenderbuffer=new ea(this),this.bindTexture=new Ya(this),this.bindVertexBuffer=new Ka(this),this.bindElementBuffer=new cc(this),this.bindVertexArrayOES=this.extVertexArrayObject&&new _o(this),this.pixelStoreUnpack=new Yn(this),this.pixelStoreUnpackPremultiplyAlpha=new ls(this),this.pixelStoreUnpackFlipY=new Ja(this),this.extTextureFilterAnisotropic=t.getExtension("EXT_texture_filter_anisotropic")||t.getExtension("MOZ_EXT_texture_filter_anisotropic")||t.getExtension("WEBKIT_EXT_texture_filter_anisotropic"),this.extTextureFilterAnisotropic&&(this.extTextureFilterAnisotropicMax=t.getParameter(this.extTextureFilterAnisotropic.MAX_TEXTURE_MAX_ANISOTROPY_EXT)),this.extTextureFilterAnisotropicForceOff=!1,this.extStandardDerivativesForceOff=!1,this.extTextureHalfFloat=t.getExtension("OES_texture_half_float"),this.extTextureHalfFloat&&(t.getExtension("OES_texture_half_float_linear"),this.extRenderToTextureHalfFloat=t.getExtension("EXT_color_buffer_half_float")),this.extStandardDerivatives=t.getExtension("OES_standard_derivatives"),this.extTimerQuery=t.getExtension("EXT_disjoint_timer_query"),this.maxTextureSize=t.getParameter(t.MAX_TEXTURE_SIZE)}setDefault(){this.unbindVAO(),this.clearColor.setDefault(),this.clearDepth.setDefault(),this.clearStencil.setDefault(),this.colorMask.setDefault(),this.depthMask.setDefault(),this.stencilMask.setDefault(),this.stencilFunc.setDefault(),this.stencilOp.setDefault(),this.stencilTest.setDefault(),this.depthRange.setDefault(),this.depthTest.setDefault(),this.depthFunc.setDefault(),this.blend.setDefault(),this.blendFunc.setDefault(),this.blendColor.setDefault(),this.blendEquation.setDefault(),this.cullFace.setDefault(),this.cullFaceSide.setDefault(),this.frontFace.setDefault(),this.program.setDefault(),this.activeTexture.setDefault(),this.bindFramebuffer.setDefault(),this.pixelStoreUnpack.setDefault(),this.pixelStoreUnpackPremultiplyAlpha.setDefault(),this.pixelStoreUnpackFlipY.setDefault()}setDirty(){this.clearColor.dirty=!0,this.clearDepth.dirty=!0,this.clearStencil.dirty=!0,this.colorMask.dirty=!0,this.depthMask.dirty=!0,this.stencilMask.dirty=!0,this.stencilFunc.dirty=!0,this.stencilOp.dirty=!0,this.stencilTest.dirty=!0,this.depthRange.dirty=!0,this.depthTest.dirty=!0,this.depthFunc.dirty=!0,this.blend.dirty=!0,this.blendFunc.dirty=!0,this.blendColor.dirty=!0,this.blendEquation.dirty=!0,this.cullFace.dirty=!0,this.cullFaceSide.dirty=!0,this.frontFace.dirty=!0,this.program.dirty=!0,this.activeTexture.dirty=!0,this.viewport.dirty=!0,this.bindFramebuffer.dirty=!0,this.bindRenderbuffer.dirty=!0,this.bindTexture.dirty=!0,this.bindVertexBuffer.dirty=!0,this.bindElementBuffer.dirty=!0,this.extVertexArrayObject&&(this.bindVertexArrayOES.dirty=!0),this.pixelStoreUnpack.dirty=!0,this.pixelStoreUnpackPremultiplyAlpha.dirty=!0,this.pixelStoreUnpackFlipY.dirty=!0}createIndexBuffer(t,a){return new Do(this,t,a)}createVertexBuffer(t,a,m){return new Ro(this,t,a,m)}createRenderbuffer(t,a,m){const v=this.gl,b=v.createRenderbuffer();return this.bindRenderbuffer.set(b),v.renderbufferStorage(v.RENDERBUFFER,t,a,m),this.bindRenderbuffer.set(null),b}createFramebuffer(t,a,m){return new Z(this,t,a,m)}clear({color:t,depth:a,stencil:m}){const v=this.gl;let b=0;t&&(b|=v.COLOR_BUFFER_BIT,this.clearColor.set(t),this.colorMask.set([!0,!0,!0,!0])),a!==void 0&&(b|=v.DEPTH_BUFFER_BIT,this.depthRange.set([0,1]),this.clearDepth.set(a),this.depthMask.set(!0)),m!==void 0&&(b|=v.STENCIL_BUFFER_BIT,this.clearStencil.set(m),this.stencilMask.set(255)),v.clear(b)}setCullFace(t){t.enable===!1?this.cullFace.set(!1):(this.cullFace.set(!0),this.cullFaceSide.set(t.mode),this.frontFace.set(t.frontFace))}setDepthMode(t){t.func!==this.gl.ALWAYS||t.mask?(this.depthTest.set(!0),this.depthFunc.set(t.func),this.depthMask.set(t.mask),this.depthRange.set(t.range)):this.depthTest.set(!1)}setStencilMode(t){t.test.func!==this.gl.ALWAYS||t.mask?(this.stencilTest.set(!0),this.stencilMask.set(t.mask),this.stencilOp.set([t.fail,t.depthFail,t.pass]),this.stencilFunc.set({func:t.test.func,ref:t.ref,mask:t.test.mask})):this.stencilTest.set(!1)}setColorMode(t){w(t.blendFunction,n.ColorMode.Replace)?this.blend.set(!1):(this.blend.set(!0),this.blendFunc.set(t.blendFunction),this.blendColor.set(t.blendColor)),this.colorMask.set(t.mask)}unbindVAO(){this.extVertexArrayObject&&this.bindVertexArrayOES.set(null)}}class me extends n.Evented{constructor(t,a,m,v){super(),this.id=t,this.dispatcher=m,this.setEventedParent(v),this.type="raster",this.minzoom=0,this.maxzoom=22,this.roundZoom=!0,this.scheme="xyz",this.tileSize=512,this._loaded=!1,this._options=n.extend({type:"raster"},a),n.extend(this,n.pick(a,["url","scheme","tileSize"]))}load(){this._loaded=!1,this.fire(new n.Event("dataloading",{dataType:"source"})),this._tileJSONRequest=fo(this._options,this.map._requestManager,null,null,(t,a)=>{this._tileJSONRequest=null,this._loaded=!0,t?this.fire(new n.ErrorEvent(t)):a&&(n.extend(this,a),a.bounds&&(this.tileBounds=new xn(a.bounds,this.minzoom,this.maxzoom)),n.postTurnstileEvent(a.tiles),this.fire(new n.Event("data",{dataType:"source",sourceDataType:"metadata"})),this.fire(new n.Event("data",{dataType:"source",sourceDataType:"content"})))})}loaded(){return this._loaded}onAdd(t){this.map=t,this.load()}onRemove(){this._tileJSONRequest&&(this._tileJSONRequest.cancel(),this._tileJSONRequest=null)}serialize(){return n.extend({},this._options)}hasTile(t){return!this.tileBounds||this.tileBounds.contains(t.canonical)}loadTile(t,a){const m=n.exported.devicePixelRatio>=2,v=this.map._requestManager.normalizeTileURL(t.tileID.canonical.url(this.tiles,this.scheme),m,this.tileSize);t.request=n.getImage(this.map._requestManager.transformRequest(v,n.ResourceType.Tile),(b,S,k,D)=>(delete t.request,t.aborted?(t.state="unloaded",a(null)):b?(t.state="errored",a(b)):S?(this.map._refreshExpiredTiles&&t.setExpiryData({cacheControl:k,expires:D}),t.setTexture(S,this.map.painter),t.state="loaded",n.cacheEntryPossiblyAdded(this.dispatcher),void a(null)):a(null)))}static loadTileData(t,a,m){t.setTexture(a,m)}static unloadTileData(t,a){t.texture&&a.saveTileTexture(t.texture)}abortTile(t,a){t.request&&(t.request.cancel(),delete t.request),a()}unloadTile(t,a){t.texture&&this.map.painter.saveTileTexture(t.texture),a()}hasTransition(){return!1}}let we;function De(p,t,a,m,v,b,S,k){const D=[p,a,v,t,m,b,1,1,1],O=[S,k,1],V=n.adjoint([],D),[G,X,J]=n.transformMat3(O,O,n.transpose(V,V));return n.multiply$1(D,[G,0,0,0,X,0,0,0,J],D)}class Ie extends n.Evented{constructor(t,a,m,v){super(),this.id=t,this.dispatcher=m,this.coordinates=a.coordinates,this.type="image",this.minzoom=0,this.maxzoom=22,this.tileSize=512,this.tiles={},this._loaded=!1,this.setEventedParent(v),this.options=a}load(t,a){this._loaded=a||!1,this.fire(new n.Event("dataloading",{dataType:"source"})),this.url=this.options.url,n.getImage(this.map._requestManager.transformRequest(this.url,n.ResourceType.Image),(m,v)=>{if(this._loaded=!0,m)this.fire(new n.ErrorEvent(m));else if(v){const{HTMLImageElement:b}=n.window;this.image=v instanceof b?n.exported.getImageData(v):v,this.width=this.image.width,this.height=this.image.height,t&&(this.coordinates=t),this._finishLoading()}})}loaded(){return this._loaded}updateImage(t){return this.image&&t.url?(this.options.url=t.url,this.load(t.coordinates,this._loaded),this):this}_finishLoading(){this.map&&(this.setCoordinates(this.coordinates),this.fire(new n.Event("data",{dataType:"source",sourceDataType:"metadata"})))}onAdd(t){this.map=t,this.load()}onRemove(){this.texture&&this.texture.destroy()}setCoordinates(t){this.coordinates=t,this._boundsArray=void 0;const a=t.map(n.MercatorCoordinate.fromLngLat);return this.tileID=function(m){let v=1/0,b=1/0,S=-1/0,k=-1/0;for(const G of m)v=Math.min(v,G.x),b=Math.min(b,G.y),S=Math.max(S,G.x),k=Math.max(k,G.y);const D=Math.max(S-v,k-b),O=Math.max(0,Math.floor(-Math.log(D)/Math.LN2)),V=Math.pow(2,O);return new n.CanonicalTileID(O,Math.floor((v+S)/2*V),Math.floor((b+k)/2*V))}(a),this.minzoom=this.maxzoom=this.tileID.z,this.fire(new n.Event("data",{dataType:"source",sourceDataType:"content"})),this}_clear(){this._boundsArray=void 0}_prepareData(t){for(const D in this.tiles){const O=this.tiles[D];O.state!=="loaded"&&(O.state="loaded",O.texture=this.texture)}if(this._boundsArray)return;const a=n.tileTransform(this.tileID,this.map.transform.projection),[m,v,b,S]=this.coordinates.map(D=>{const O=a.projection.project(D[0],D[1]);return n.getTilePoint(a,O)._round()});this.perspectiveTransform=function(D,O,V,G,X,J,ee,Y,pe,K){const ne=De(0,0,D,0,0,O,D,O),oe=De(V,G,X,J,ee,Y,pe,K);return n.multiply$1(oe,n.adjoint(ne,ne),oe),[oe[6]/oe[8]*D/n.EXTENT,oe[7]/oe[8]*O/n.EXTENT]}(this.width,this.height,m.x,m.y,v.x,v.y,S.x,S.y,b.x,b.y);const k=this._boundsArray=new n.StructArrayLayout4i8;k.emplaceBack(m.x,m.y,0,0),k.emplaceBack(v.x,v.y,n.EXTENT,0),k.emplaceBack(S.x,S.y,0,n.EXTENT),k.emplaceBack(b.x,b.y,n.EXTENT,n.EXTENT),this.boundsBuffer&&this.boundsBuffer.destroy(),this.boundsBuffer=t.createVertexBuffer(k,n.boundsAttributes.members),this.boundsSegments=n.SegmentVector.simpleSegment(0,0,4,2)}prepare(){if(Object.keys(this.tiles).length===0||!this.image)return;const t=this.map.painter.context,a=t.gl;this.texture?this.texture.update(this.image):(this.texture=new n.Texture(t,this.image,a.RGBA),this.texture.bind(a.LINEAR,a.CLAMP_TO_EDGE)),this._prepareData(t)}loadTile(t,a){this.tileID&&this.tileID.equals(t.tileID.canonical)?(this.tiles[String(t.tileID.wrap)]=t,t.buckets={},a(null)):(t.state="errored",a(null))}serialize(){return{type:"image",url:this.options.url,coordinates:this.coordinates}}hasTransition(){return!1}}const Te={vector:class extends n.Evented{constructor(p,t,a,m){if(super(),this.id=p,this.dispatcher=a,this.type="vector",this.minzoom=0,this.maxzoom=22,this.scheme="xyz",this.tileSize=512,this.reparseOverscaled=!0,this.isTileClipped=!0,this._loaded=!1,n.extend(this,n.pick(t,["url","scheme","tileSize","promoteId"])),this._options=n.extend({type:"vector"},t),this._collectResourceTiming=t.collectResourceTiming,this.tileSize!==512)throw new Error("vector tile sources must have a tileSize of 512");this.setEventedParent(m),this._tileWorkers={},this._deduped=new n.DedupedRequest}load(p){this._loaded=!1,this.fire(new n.Event("dataloading",{dataType:"source"}));const t=this.language||this.map._language,a=this.worldview||this.map._worldview;this._tileJSONRequest=fo(this._options,this.map._requestManager,t,a,(m,v)=>{this._tileJSONRequest=null,this._loaded=!0,m?(t&&console.warn(`Ensure that your requested language string is a valid BCP-47 code. Found: ${t}`),a&&a.length!==2&&console.warn(`Requested worldview strings must be a valid ISO alpha-2 code. Found: ${a}`),this.fire(new n.ErrorEvent(m))):v&&(n.extend(this,v),v.bounds&&(this.tileBounds=new xn(v.bounds,this.minzoom,this.maxzoom)),n.postTurnstileEvent(v.tiles,this.map._requestManager._customAccessToken),this.fire(new n.Event("data",{dataType:"source",sourceDataType:"metadata"})),this.fire(new n.Event("data",{dataType:"source",sourceDataType:"content"}))),p&&p(m)})}loaded(){return this._loaded}hasTile(p){return!this.tileBounds||this.tileBounds.contains(p.canonical)}onAdd(p){this.map=p,this.load()}setSourceProperty(p){this._tileJSONRequest&&this._tileJSONRequest.cancel(),p(),this.load(()=>{const t=this.map.style._getSourceCaches(this.id);for(const a of t)a.clearTiles()})}setTiles(p){return this.setSourceProperty(()=>{this._options.tiles=p}),this}setUrl(p){return this.setSourceProperty(()=>{this.url=p,this._options.url=p}),this}_setLanguage(p){return p===this.language||this.setSourceProperty(()=>{this.language=p}),this}_setWorldview(p){return p===this.worldview?this:this.worldviewOptions&&p&&!this.worldviewOptions[p]?(console.warn(`Vector tile source "${this.id}" does not support worldview "${p}".`),this):(this.setSourceProperty(()=>{this.worldview=p}),this)}onRemove(){this._tileJSONRequest&&(this._tileJSONRequest.cancel(),this._tileJSONRequest=null)}serialize(){return n.extend({},this._options)}loadTile(p,t){const a=this.map._requestManager.normalizeTileURL(p.tileID.canonical.url(this.tiles,this.scheme)),m={request:this.map._requestManager.transformRequest(a,n.ResourceType.Tile),data:void 0,uid:p.uid,tileID:p.tileID,tileZoom:p.tileZoom,zoom:p.tileID.overscaledZ,tileSize:this.tileSize*p.tileID.overscaleFactor(),type:this.type,source:this.id,pixelRatio:n.exported.devicePixelRatio,showCollisionBoxes:this.map.showCollisionBoxes,promoteId:this.promoteId,isSymbolTile:p.isSymbolTile};if(m.request.collectResourceTiming=this._collectResourceTiming,p.actor&&p.state!=="expired")p.state==="loading"?p.reloadCallback=t:p.request=p.actor.send("reloadTile",m,v.bind(this));else if(p.actor=this._tileWorkers[a]=this._tileWorkers[a]||this.dispatcher.getActor(),this.dispatcher.ready)p.request=p.actor.send("loadTile",m,v.bind(this),void 0,!0);else{const b=n.loadVectorTile.call({deduped:this._deduped},m,(S,k)=>{S||!k?v.call(this,S):(m.data={cacheControl:k.cacheControl,expires:k.expires,rawData:k.rawData.slice(0)},p.actor&&p.actor.send("loadTile",m,v.bind(this),void 0,!0))},!0);p.request={cancel:b}}function v(b,S){return delete p.request,p.aborted?t(null):b&&b.status!==404?t(b):(S&&S.resourceTiming&&(p.resourceTiming=S.resourceTiming),this.map._refreshExpiredTiles&&S&&p.setExpiryData(S),p.loadVectorData(S,this.map.painter),n.cacheEntryPossiblyAdded(this.dispatcher),t(null),void(p.reloadCallback&&(this.loadTile(p,p.reloadCallback),p.reloadCallback=null)))}}abortTile(p){p.request&&(p.request.cancel(),delete p.request),p.actor&&p.actor.send("abortTile",{uid:p.uid,type:this.type,source:this.id})}unloadTile(p){p.unloadVectorData(),p.actor&&p.actor.send("removeTile",{uid:p.uid,type:this.type,source:this.id})}hasTransition(){return!1}afterUpdate(){this._tileWorkers={}}},raster:me,"raster-dem":class extends me{constructor(p,t,a,m){super(p,t,a,m),this.type="raster-dem",this.maxzoom=22,this._options=n.extend({type:"raster-dem"},t),this.encoding=t.encoding||"mapbox"}loadTile(p,t){const a=this.map._requestManager.normalizeTileURL(p.tileID.canonical.url(this.tiles,this.scheme),!1,this.tileSize);function m(v,b){v&&(p.state="errored",t(v)),b&&(p.dem=b,p.dem.onDeserialize(),p.needsHillshadePrepare=!0,p.needsDEMTextureUpload=!0,p.state="loaded",t(null))}p.request=n.getImage(this.map._requestManager.transformRequest(a,n.ResourceType.Tile),function(v,b,S,k){if(delete p.request,p.aborted)p.state="unloaded",t(null);else if(v)p.state="errored",t(v);else if(b){this.map._refreshExpiredTiles&&p.setExpiryData({cacheControl:S,expires:k});const D=n.window.ImageBitmap&&b instanceof n.window.ImageBitmap&&(we==null&&(we=n.window.OffscreenCanvas&&new n.window.OffscreenCanvas(1,1).getContext("2d")&&typeof n.window.createImageBitmap=="function"),we),O=1-(b.width-n.prevPowerOfTwo(b.width))/2;O<1||p.neighboringTiles||(p.neighboringTiles=this._getNeighboringTiles(p.tileID));const V=D?b:n.exported.getImageData(b,O),G={uid:p.uid,coord:p.tileID,source:this.id,rawImageData:V,encoding:this.encoding,padding:O};p.actor&&p.state!=="expired"||(p.actor=this.dispatcher.getActor(),p.actor.send("loadDEMTile",G,m.bind(this),void 0,!0))}}.bind(this))}_getNeighboringTiles(p){const t=p.canonical,a=Math.pow(2,t.z),m=(t.x-1+a)%a,v=t.x===0?p.wrap-1:p.wrap,b=(t.x+1+a)%a,S=t.x+1===a?p.wrap+1:p.wrap,k={};return k[new n.OverscaledTileID(p.overscaledZ,v,t.z,m,t.y).key]={backfilled:!1},k[new n.OverscaledTileID(p.overscaledZ,S,t.z,b,t.y).key]={backfilled:!1},t.y>0&&(k[new n.OverscaledTileID(p.overscaledZ,v,t.z,m,t.y-1).key]={backfilled:!1},k[new n.OverscaledTileID(p.overscaledZ,p.wrap,t.z,t.x,t.y-1).key]={backfilled:!1},k[new n.OverscaledTileID(p.overscaledZ,S,t.z,b,t.y-1).key]={backfilled:!1}),t.y+1<a&&(k[new n.OverscaledTileID(p.overscaledZ,v,t.z,m,t.y+1).key]={backfilled:!1},k[new n.OverscaledTileID(p.overscaledZ,p.wrap,t.z,t.x,t.y+1).key]={backfilled:!1},k[new n.OverscaledTileID(p.overscaledZ,S,t.z,b,t.y+1).key]={backfilled:!1}),k}unloadTile(p){p.demTexture&&this.map.painter.saveTileTexture(p.demTexture),p.fbo&&(p.fbo.destroy(),delete p.fbo),p.dem&&delete p.dem,delete p.neighboringTiles,p.state="unloaded"}},geojson:class extends n.Evented{constructor(p,t,a,m){super(),this.id=p,this.type="geojson",this.minzoom=0,this.maxzoom=18,this.tileSize=512,this.isTileClipped=!0,this.reparseOverscaled=!0,this._loaded=!1,this.actor=a.getActor(),this.setEventedParent(m),this._data=t.data,this._options=n.extend({},t),this._collectResourceTiming=t.collectResourceTiming,t.maxzoom!==void 0&&(this.maxzoom=t.maxzoom),t.type&&(this.type=t.type),t.attribution&&(this.attribution=t.attribution),this.promoteId=t.promoteId;const v=n.EXTENT/this.tileSize;this.workerOptions=n.extend({source:this.id,cluster:t.cluster||!1,geojsonVtOptions:{buffer:(t.buffer!==void 0?t.buffer:128)*v,tolerance:(t.tolerance!==void 0?t.tolerance:.375)*v,extent:n.EXTENT,maxZoom:this.maxzoom,lineMetrics:t.lineMetrics||!1,generateId:t.generateId||!1},superclusterOptions:{maxZoom:t.clusterMaxZoom!==void 0?t.clusterMaxZoom:this.maxzoom-1,minPoints:Math.max(2,t.clusterMinPoints||2),extent:n.EXTENT,radius:(t.clusterRadius!==void 0?t.clusterRadius:50)*v,log:!1,generateId:t.generateId||!1},clusterProperties:t.clusterProperties,filter:t.filter},t.workerOptions)}onAdd(p){this.map=p,this.setData(this._data)}setData(p){return this._data=p,this._updateWorkerData(),this}getClusterExpansionZoom(p,t){return this.actor.send("geojson.getClusterExpansionZoom",{clusterId:p,source:this.id},t),this}getClusterChildren(p,t){return this.actor.send("geojson.getClusterChildren",{clusterId:p,source:this.id},t),this}getClusterLeaves(p,t,a,m){return this.actor.send("geojson.getClusterLeaves",{source:this.id,clusterId:p,limit:t,offset:a},m),this}_updateWorkerData(){if(this._pendingLoad)return void(this._coalesce=!0);this.fire(new n.Event("dataloading",{dataType:"source"})),this._loaded=!1;const p=n.extend({},this.workerOptions),t=this._data;typeof t=="string"?(p.request=this.map._requestManager.transformRequest(n.exported.resolveURL(t),n.ResourceType.Source),p.request.collectResourceTiming=this._collectResourceTiming):p.data=JSON.stringify(t),this._pendingLoad=this.actor.send(`${this.type}.loadData`,p,(a,m)=>{if(this._loaded=!0,this._pendingLoad=null,a)this.fire(new n.ErrorEvent(a));else{const v={dataType:"source",sourceDataType:this._metadataFired?"content":"metadata"};this._collectResourceTiming&&m&&m.resourceTiming&&m.resourceTiming[this.id]&&(v.resourceTiming=m.resourceTiming[this.id]),this.fire(new n.Event("data",v)),this._metadataFired=!0}this._coalesce&&(this._updateWorkerData(),this._coalesce=!1)})}loaded(){return this._loaded}loadTile(p,t){const a=p.actor?"reloadTile":"loadTile";p.actor=this.actor,p.request=this.actor.send(a,{type:this.type,uid:p.uid,tileID:p.tileID,tileZoom:p.tileZoom,zoom:p.tileID.overscaledZ,maxZoom:this.maxzoom,tileSize:this.tileSize,source:this.id,pixelRatio:n.exported.devicePixelRatio,showCollisionBoxes:this.map.showCollisionBoxes,promoteId:this.promoteId},(m,v)=>(delete p.request,p.unloadVectorData(),p.aborted?t(null):m?t(m):(p.loadVectorData(v,this.map.painter,a==="reloadTile"),t(null))),void 0,a==="loadTile")}abortTile(p){p.request&&(p.request.cancel(),delete p.request),p.aborted=!0}unloadTile(p){p.unloadVectorData(),this.actor.send("removeTile",{uid:p.uid,type:this.type,source:this.id})}onRemove(){this._pendingLoad&&this._pendingLoad.cancel()}serialize(){return n.extend({},this._options,{type:this.type,data:this._data})}hasTransition(){return!1}},video:class extends Ie{constructor(p,t,a,m){super(p,t,a,m),this.roundZoom=!0,this.type="video",this.options=t}load(){this._loaded=!1;const p=this.options;this.urls=[];for(const t of p.urls)this.urls.push(this.map._requestManager.transformRequest(t,n.ResourceType.Source).url);n.getVideo(this.urls,(t,a)=>{this._loaded=!0,t?this.fire(new n.ErrorEvent(t)):a&&(this.video=a,this.video.loop=!0,this.video.setAttribute("playsinline",""),this.video.addEventListener("playing",()=>{this.map.triggerRepaint()}),this.map&&this.video.play(),this._finishLoading())})}pause(){this.video&&this.video.pause()}play(){this.video&&this.video.play()}seek(p){if(this.video){const t=this.video.seekable;p<t.start(0)||p>t.end(0)?this.fire(new n.ErrorEvent(new n.ValidationError(`sources.${this.id}`,null,`Playback for this video can be set only between the ${t.start(0)} and ${t.end(0)}-second mark.`))):this.video.currentTime=p}}getVideo(){return this.video}onAdd(p){this.map||(this.map=p,this.load(),this.video&&(this.video.play(),this.setCoordinates(this.coordinates)))}prepare(){if(Object.keys(this.tiles).length===0||this.video.readyState<2)return;const p=this.map.painter.context,t=p.gl;this.texture?this.video.paused||(this.texture.bind(t.LINEAR,t.CLAMP_TO_EDGE),t.texSubImage2D(t.TEXTURE_2D,0,0,0,t.RGBA,t.UNSIGNED_BYTE,this.video)):(this.texture=new n.Texture(p,this.video,t.RGBA),this.texture.bind(t.LINEAR,t.CLAMP_TO_EDGE),this.width=this.video.videoWidth,this.height=this.video.videoHeight),this._prepareData(p)}serialize(){return{type:"video",urls:this.urls,coordinates:this.coordinates}}hasTransition(){return this.video&&!this.video.paused}},image:Ie,canvas:class extends Ie{constructor(p,t,a,m){super(p,t,a,m),t.coordinates?Array.isArray(t.coordinates)&&t.coordinates.length===4&&!t.coordinates.some(v=>!Array.isArray(v)||v.length!==2||v.some(b=>typeof b!="number"))||this.fire(new n.ErrorEvent(new n.ValidationError(`sources.${p}`,null,'"coordinates" property must be an array of 4 longitude/latitude array pairs'))):this.fire(new n.ErrorEvent(new n.ValidationError(`sources.${p}`,null,'missing required property "coordinates"'))),t.animate&&typeof t.animate!="boolean"&&this.fire(new n.ErrorEvent(new n.ValidationError(`sources.${p}`,null,'optional "animate" property must be a boolean value'))),t.canvas?typeof t.canvas=="string"||t.canvas instanceof n.window.HTMLCanvasElement||this.fire(new n.ErrorEvent(new n.ValidationError(`sources.${p}`,null,'"canvas" must be either a string representing the ID of the canvas element from which to read, or an HTMLCanvasElement instance'))):this.fire(new n.ErrorEvent(new n.ValidationError(`sources.${p}`,null,'missing required property "canvas"'))),this.options=t,this.animate=t.animate===void 0||t.animate}load(){this._loaded=!0,this.canvas||(this.canvas=this.options.canvas instanceof n.window.HTMLCanvasElement?this.options.canvas:n.window.document.getElementById(this.options.canvas)),this.width=this.canvas.width,this.height=this.canvas.height,this._hasInvalidDimensions()?this.fire(new n.ErrorEvent(new Error("Canvas dimensions cannot be less than or equal to zero."))):(this.play=function(){this._playing=!0,this.map.triggerRepaint()},this.pause=function(){this._playing&&(this.prepare(),this._playing=!1)},this._finishLoading())}getCanvas(){return this.canvas}onAdd(p){this.map=p,this.load(),this.canvas&&this.animate&&this.play()}onRemove(){this.pause()}prepare(){let p=!1;if(this.canvas.width!==this.width&&(this.width=this.canvas.width,p=!0),this.canvas.height!==this.height&&(this.height=this.canvas.height,p=!0),this._hasInvalidDimensions()||Object.keys(this.tiles).length===0)return;const t=this.map.painter.context;this.texture?(p||this._playing)&&this.texture.update(this.canvas,{premultiply:!0}):this.texture=new n.Texture(t,this.canvas,t.gl.RGBA,{premultiply:!0}),this._prepareData(t)}serialize(){return{type:"canvas",coordinates:this.coordinates}}hasTransition(){return this._playing}_hasInvalidDimensions(){for(const p of[this.canvas.width,this.canvas.height])if(isNaN(p)||p<=0)return!0;return!1}},custom:class extends n.Evented{constructor(p,t,a,m){super(),this.id=p,this.type="custom",this._dataType="raster",this._dispatcher=a,this._implementation=t,this.setEventedParent(m),this.scheme="xyz",this.minzoom=0,this.maxzoom=22,this.tileSize=512,this._loaded=!1,this.roundZoom=!0,this._implementation||this.fire(new n.ErrorEvent(new Error(`Missing implementation for ${this.id} custom source`))),this._implementation.loadTile||this.fire(new n.ErrorEvent(new Error(`Missing loadTile implementation for ${this.id} custom source`))),this._implementation.bounds&&(this.tileBounds=new xn(this._implementation.bounds,this.minzoom,this.maxzoom)),t.update=this._update.bind(this),t.coveringTiles=this._coveringTiles.bind(this),n.extend(this,n.pick(t,["dataType","scheme","minzoom","maxzoom","tileSize","attribution","minTileCacheSize","maxTileCacheSize"]))}serialize(){return n.pick(this,["type","scheme","minzoom","maxzoom","tileSize","attribution"])}load(){this._loaded=!0,this.fire(new n.Event("data",{dataType:"source",sourceDataType:"metadata"})),this.fire(new n.Event("data",{dataType:"source",sourceDataType:"content"}))}loaded(){return this._loaded}onAdd(p){this._map=p,this._loaded=!1,this.fire(new n.Event("dataloading",{dataType:"source"})),this._implementation.onAdd&&this._implementation.onAdd(p),this.load()}onRemove(p){this._implementation.onRemove&&this._implementation.onRemove(p)}hasTile(p){if(this._implementation.hasTile){const{x:t,y:a,z:m}=p.canonical;return this._implementation.hasTile({x:t,y:a,z:m})}return!this.tileBounds||this.tileBounds.contains(p.canonical)}loadTile(p,t){const{x:a,y:m,z:v}=p.tileID.canonical,b=new n.window.AbortController,S=this._implementation.loadTile({x:a,y:m,z:v},{signal:b.signal});if(!S)return this.loadTileData(p,{width:this.tileSize,height:this.tileSize,data:null}),p.state="loaded",t(null);S.cancel=()=>b.abort(),p.request=S.then(function(k){return delete p.request,p.aborted?(p.state="unloaded",t(null)):k?function(D){return D instanceof n.window.ImageData||D instanceof n.window.ImageBitmap||D instanceof n.window.HTMLCanvasElement}(k)?(this.loadTileData(p,k),p.state="loaded",void t(null)):(p.state="errored",t(new Error(`Can't infer data type for ${this.id}, only raster data supported at the moment`))):(this.loadTileData(p,{width:this.tileSize,height:this.tileSize,data:null}),p.state="loaded",t(null))}.bind(this)).catch(k=>{k.code!==20&&(p.state="errored",t(k))})}loadTileData(p,t){me.loadTileData(p,t,this._map.painter)}unloadTileData(p){me.unloadTileData(p,this._map.painter)}prepareTile(p){if(!this._implementation.prepareTile)return null;const{x:t,y:a,z:m}=p.tileID.canonical,v=this._implementation.prepareTile({x:t,y:a,z:m});return v?(this.loadTileData(p,v),p.state="loaded",v):null}unloadTile(p,t){if(this.unloadTileData(p),this._implementation.unloadTile){const{x:a,y:m,z:v}=p.tileID.canonical;this._implementation.unloadTile({x:a,y:m,z:v})}t()}abortTile(p,t){p.request&&p.request.cancel&&(p.request.cancel(),delete p.request),t()}hasTransition(){return!1}_coveringTiles(){return this._map.transform.coveringTiles({tileSize:this.tileSize,minzoom:this.minzoom,maxzoom:this.maxzoom,roundZoom:this.roundZoom}).map(p=>({x:p.canonical.x,y:p.canonical.y,z:p.canonical.z}))}_update(){this.fire(new n.Event("data",{dataType:"source",sourceDataType:"content"}))}}},Re=function(p,t,a,m){const v=new Te[t.type](p,t,a,m);if(v.id!==p)throw new Error(`Expected Source id to be ${p} instead of ${v.id}`);return n.bindAll(["load","abort","unload","serialize","prepare"],v),v};function nt(p,t){const a=n.identity([]);return n.scale(a,a,[.5*p.width,.5*-p.height,1]),n.translate(a,a,[1,-1,0]),n.multiply(a,a,p.calculateProjMatrix(t.toUnwrapped())),Float32Array.from(a)}function It(p,t,a,m,v,b,S,k=!1){const D=p.tilesIn(m,S,k);D.sort(Nt);const O=[];for(const G of D)O.push({wrappedTileID:G.tile.tileID.wrapped().key,queryResults:G.tile.queryRenderedFeatures(t,a,p._state,G,v,b,nt(p.transform,G.tile.tileID),k)});const V=function(G){const X={},J={};for(const ee of G){const Y=ee.queryResults,pe=ee.wrappedTileID,K=J[pe]=J[pe]||{};for(const ne in Y){const oe=Y[ne],ge=K[ne]=K[ne]||{},he=X[ne]=X[ne]||[];for(const fe of oe)ge[fe.featureIndex]||(ge[fe.featureIndex]=!0,he.push(fe))}}return X}(O);for(const G in V)V[G].forEach(X=>{const J=X.feature,ee=J.layer;ee&&ee.type!=="background"&&ee.type!=="sky"&&(J.source=ee.source,ee["source-layer"]&&(J.sourceLayer=ee["source-layer"]),J.state=J.id!==void 0?p.getFeatureState(ee["source-layer"],J.id):{})});return V}function st(p,t){const a=p.getRenderableIds().map(b=>p.getTileByID(b)),m=[],v={};for(let b=0;b<a.length;b++){const S=a[b],k=S.tileID.canonical.key;v[k]||(v[k]=!0,S.querySourceFeatures(m,t))}return m}function Nt(p,t){const a=p.tileID,m=t.tileID;return a.overscaledZ-m.overscaledZ||a.canonical.y-m.canonical.y||a.wrap-m.wrap||a.canonical.x-m.canonical.x}function Gt(){return Ul.workerClass!=null?new Ul.workerClass:new n.window.Worker(Ul.workerUrl)}const jt="mapboxgl_preloaded_worker_pool";class Wt{constructor(){this.active={}}acquire(t){if(!this.workers)for(this.workers=[];this.workers.length<Wt.workerCount;)this.workers.push(new Gt);return this.active[t]=!0,this.workers.slice()}release(t){delete this.active[t],this.numActive()===0&&(this.workers.forEach(a=>{a.terminate()}),this.workers=null)}isPreloaded(){return!!this.active[jt]}numActive(){return Object.keys(this.active).length}}let ai;function Ti(){return ai||(ai=new Wt),ai}function ji(p,t){const a={};for(const m in p)m!=="ref"&&(a[m]=p[m]);return n.refProperties.forEach(m=>{m in t&&(a[m]=t[m])}),a}function ki(p){p=p.slice();const t=Object.create(null);for(let a=0;a<p.length;a++)t[p[a].id]=p[a];for(let a=0;a<p.length;a++)"ref"in p[a]&&(p[a]=ji(p[a],t[p[a].ref]));return p}Wt.workerCount=2;const ke={setStyle:"setStyle",addLayer:"addLayer",removeLayer:"removeLayer",setPaintProperty:"setPaintProperty",setLayoutProperty:"setLayoutProperty",setFilter:"setFilter",addSource:"addSource",removeSource:"removeSource",setGeoJSONSourceData:"setGeoJSONSourceData",setLayerZoomRange:"setLayerZoomRange",setLayerProperty:"setLayerProperty",setCenter:"setCenter",setZoom:"setZoom",setBearing:"setBearing",setPitch:"setPitch",setSprite:"setSprite",setGlyphs:"setGlyphs",setTransition:"setTransition",setLight:"setLight",setTerrain:"setTerrain",setFog:"setFog",setProjection:"setProjection"};function Jr(p,t,a){a.push({command:ke.addSource,args:[p,t[p]]})}function Hi(p,t,a){t.push({command:ke.removeSource,args:[p]}),a[p]=!0}function on(p,t,a,m){Hi(p,a,m),Jr(p,t,a)}function Kp(p,t,a){let m;for(m in p[a])if(p[a].hasOwnProperty(m)&&m!=="data"&&!w(p[a][m],t[a][m]))return!1;for(m in t[a])if(t[a].hasOwnProperty(m)&&m!=="data"&&!w(p[a][m],t[a][m]))return!1;return!0}function Qr(p,t,a,m,v,b){let S;for(S in t=t||{},p=p||{})p.hasOwnProperty(S)&&(w(p[S],t[S])||a.push({command:b,args:[m,S,t[S],v]}));for(S in t)t.hasOwnProperty(S)&&!p.hasOwnProperty(S)&&(w(p[S],t[S])||a.push({command:b,args:[m,S,t[S],v]}))}function Qa(p){return p.id}function Gu(p,t){return p[t.id]=t,p}class ia{constructor(t,a){this.reset(t,a)}reset(t,a){this.points=t||[],this._distances=[0];for(let m=1;m<this.points.length;m++)this._distances[m]=this._distances[m-1]+this.points[m].dist(this.points[m-1]);this.length=this._distances[this._distances.length-1],this.padding=Math.min(a||0,.5*this.length),this.paddedLength=this.length-2*this.padding}lerp(t){if(this.points.length===1)return this.points[0];t=n.clamp(t,0,1);let a=1,m=this._distances[a];const v=t*this.paddedLength+this.padding;for(;m<v&&a<this._distances.length;)m=this._distances[++a];const b=a-1,S=this._distances[b],k=m-S,D=k>0?(v-S)/k:0;return this.points[b].mult(1-D).add(this.points[a].mult(D))}}class St{constructor(t,a,m){const v=this.boxCells=[],b=this.circleCells=[];this.xCellCount=Math.ceil(t/m),this.yCellCount=Math.ceil(a/m);for(let S=0;S<this.xCellCount*this.yCellCount;S++)v.push([]),b.push([]);this.circleKeys=[],this.boxKeys=[],this.bboxes=[],this.circles=[],this.width=t,this.height=a,this.xScale=this.xCellCount/t,this.yScale=this.yCellCount/a,this.boxUid=0,this.circleUid=0}keysLength(){return this.boxKeys.length+this.circleKeys.length}insert(t,a,m,v,b){this._forEachCell(a,m,v,b,this._insertBoxCell,this.boxUid++),this.boxKeys.push(t),this.bboxes.push(a),this.bboxes.push(m),this.bboxes.push(v),this.bboxes.push(b)}insertCircle(t,a,m,v){this._forEachCell(a-v,m-v,a+v,m+v,this._insertCircleCell,this.circleUid++),this.circleKeys.push(t),this.circles.push(a),this.circles.push(m),this.circles.push(v)}_insertBoxCell(t,a,m,v,b,S){this.boxCells[b].push(S)}_insertCircleCell(t,a,m,v,b,S){this.circleCells[b].push(S)}_query(t,a,m,v,b,S){if(m<0||t>this.width||v<0||a>this.height)return!b&&[];const k=[];if(t<=0&&a<=0&&this.width<=m&&this.height<=v){if(b)return!0;for(let D=0;D<this.boxKeys.length;D++)k.push({key:this.boxKeys[D],x1:this.bboxes[4*D],y1:this.bboxes[4*D+1],x2:this.bboxes[4*D+2],y2:this.bboxes[4*D+3]});for(let D=0;D<this.circleKeys.length;D++){const O=this.circles[3*D],V=this.circles[3*D+1],G=this.circles[3*D+2];k.push({key:this.circleKeys[D],x1:O-G,y1:V-G,x2:O+G,y2:V+G})}return S?k.filter(S):k}return this._forEachCell(t,a,m,v,this._queryCell,k,{hitTest:b,seenUids:{box:{},circle:{}}},S),b?k.length>0:k}_queryCircle(t,a,m,v,b){const S=t-m,k=t+m,D=a-m,O=a+m;if(k<0||S>this.width||O<0||D>this.height)return!v&&[];const V=[];return this._forEachCell(S,D,k,O,this._queryCellCircle,V,{hitTest:v,circle:{x:t,y:a,radius:m},seenUids:{box:{},circle:{}}},b),v?V.length>0:V}query(t,a,m,v,b){return this._query(t,a,m,v,!1,b)}hitTest(t,a,m,v,b){return this._query(t,a,m,v,!0,b)}hitTestCircle(t,a,m,v){return this._queryCircle(t,a,m,!0,v)}_queryCell(t,a,m,v,b,S,k,D){const O=k.seenUids,V=this.boxCells[b];if(V!==null){const X=this.bboxes;for(const J of V)if(!O.box[J]){O.box[J]=!0;const ee=4*J;if(t<=X[ee+2]&&a<=X[ee+3]&&m>=X[ee+0]&&v>=X[ee+1]&&(!D||D(this.boxKeys[J]))){if(k.hitTest)return S.push(!0),!0;S.push({key:this.boxKeys[J],x1:X[ee],y1:X[ee+1],x2:X[ee+2],y2:X[ee+3]})}}}const G=this.circleCells[b];if(G!==null){const X=this.circles;for(const J of G)if(!O.circle[J]){O.circle[J]=!0;const ee=3*J;if(this._circleAndRectCollide(X[ee],X[ee+1],X[ee+2],t,a,m,v)&&(!D||D(this.circleKeys[J]))){if(k.hitTest)return S.push(!0),!0;{const Y=X[ee],pe=X[ee+1],K=X[ee+2];S.push({key:this.circleKeys[J],x1:Y-K,y1:pe-K,x2:Y+K,y2:pe+K})}}}}}_queryCellCircle(t,a,m,v,b,S,k,D){const O=k.circle,V=k.seenUids,G=this.boxCells[b];if(G!==null){const J=this.bboxes;for(const ee of G)if(!V.box[ee]){V.box[ee]=!0;const Y=4*ee;if(this._circleAndRectCollide(O.x,O.y,O.radius,J[Y+0],J[Y+1],J[Y+2],J[Y+3])&&(!D||D(this.boxKeys[ee])))return S.push(!0),!0}}const X=this.circleCells[b];if(X!==null){const J=this.circles;for(const ee of X)if(!V.circle[ee]){V.circle[ee]=!0;const Y=3*ee;if(this._circlesCollide(J[Y],J[Y+1],J[Y+2],O.x,O.y,O.radius)&&(!D||D(this.circleKeys[ee])))return S.push(!0),!0}}}_forEachCell(t,a,m,v,b,S,k,D){const O=this._convertToXCellCoord(t),V=this._convertToYCellCoord(a),G=this._convertToXCellCoord(m),X=this._convertToYCellCoord(v);for(let J=O;J<=G;J++)for(let ee=V;ee<=X;ee++)if(b.call(this,t,a,m,v,this.xCellCount*ee+J,S,k,D))return}_convertToXCellCoord(t){return Math.max(0,Math.min(this.xCellCount-1,Math.floor(t*this.xScale)))}_convertToYCellCoord(t){return Math.max(0,Math.min(this.yCellCount-1,Math.floor(t*this.yScale)))}_circlesCollide(t,a,m,v,b,S){const k=v-t,D=b-a,O=m+S;return O*O>k*k+D*D}_circleAndRectCollide(t,a,m,v,b,S,k){const D=(S-v)/2,O=Math.abs(t-(v+D));if(O>D+m)return!1;const V=(k-b)/2,G=Math.abs(a-(b+V));if(G>V+m)return!1;if(O<=D||G<=V)return!0;const X=O-D,J=G-V;return X*X+J*J<=m*m}}const mi=Math.tan(85*Math.PI/180);function li(p,t,a,m,v,b,S){const k=n.create();if(a)if(b.name==="globe"){const D=n.calculateGlobeLabelMatrix(v,t);n.multiply(k,k,D)}else{const D=ze([],S);k[0]=D[0],k[1]=D[1],k[4]=D[2],k[5]=D[3],m||n.rotateZ(k,k,v.angle)}else n.multiply(k,v.labelPlaneMatrix,p);return k}function bn(p,t,a,m,v,b,S){const k=li(p,t,a,m,v,b,S);return b.name==="globe"&&a||(k[2]=k[6]=k[10]=k[14]=0),k}function Uo(p,t,a,m,v,b,S){if(a){if(b.name==="globe"){const k=li(p,t,a,m,v,b,S);return n.invert(k,k),n.multiply(k,p,k),k}{const k=n.clone(p),D=n.identity([]);return D[0]=S[0],D[1]=S[1],D[4]=S[2],D[5]=S[3],n.multiply(k,k,D),m||n.rotateZ(k,k,-v.angle),k}}return v.glCoordMatrix}function ni(p,t,a=0){const m=[p.x,p.y,a,1];a?n.transformMat4$1(m,m,t):tr(m,m,t);const v=m[3];return{point:[m[0]/v,m[1]/v,m[2]/v],signedDistanceFromCamera:v}}function Kn(p,t){const a=[p[0],p[1],p[2],1];n.transformMat4$1(a,a,t);const m=a[3];return{point:[a[0]/m,a[1]/m,a[2]/m],signedDistanceFromCamera:m}}function cs(p,t){return Math.min(.5+p/t*.5,1.5)}function ra(p,t){const a=p[0]/p[3],m=p[1]/p[3];return a>=-t[0]&&a<=t[0]&&m>=-t[1]&&m<=t[1]}function sn(p,t,a,m,v,b,S,k,D,O){const V=a.transform,G=m?p.textSizeData:p.iconSizeData,X=n.evaluateSizeForZoom(G,a.transform.zoom),J=V.projection.name==="globe",ee=[256/a.width*2+1,256/a.height*2+1],Y=m?p.text.dynamicLayoutVertexArray:p.icon.dynamicLayoutVertexArray;Y.clear();let pe=null;J&&(pe=m?p.text.globeExtVertexArray:p.icon.globeExtVertexArray);const K=p.lineVertexArray,ne=m?p.text.placedSymbolArray:p.icon.placedSymbolArray,oe=a.transform.width/a.transform.height;let ge=!1;for(let he=0;he<ne.length;he++){const fe=ne.get(he);if(fe.writingMode!==n.WritingMode.vertical||ge||he!==0&&ne.get(he-1).writingMode===n.WritingMode.horizontal||(ge=!0),(fe.hidden||fe.writingMode===n.WritingMode.vertical)&&!ge){_r(fe.numGlyphs,Y);continue}ge=!1;const be=new n.pointGeometry(fe.tileAnchorX,fe.tileAnchorY),Ve=D?D(be):[0,0,0],Ze=V.projection.projectTilePoint(be.x,be.y,O.canonical),je=[Ze.x+Ve[0],Ze.y+Ve[1],Ze.z+Ve[2]],Ue=[...je,1];if(n.transformMat4$1(Ue,Ue,t),!ra(Ue,ee)){_r(fe.numGlyphs,Y);continue}const _e=cs(a.transform.cameraToCenterDistance,Ue[3]),rt=n.evaluateSizeForFeature(G,X,fe),it=S?rt/_e:rt*_e,Et=ni(new n.pointGeometry(je[0],je[1]),v,je[2]);if(Et.signedDistanceFromCamera<=0){_r(fe.numGlyphs,Y);continue}let Ke={};const Ft=S?null:D,vt=us(fe,it,!1,k,t,v,b,p.glyphOffsetArray,K,Y,pe,Et.point,be,Ke,oe,Ft,V.projection,O,S);ge=vt.useVertical,Ft&&vt.needsFlipping&&(Ke={}),(vt.notEnoughRoom||ge||vt.needsFlipping&&us(fe,it,!0,k,t,v,b,p.glyphOffsetArray,K,Y,pe,Et.point,be,Ke,oe,Ft,V.projection,O,S).notEnoughRoom)&&_r(fe.numGlyphs,Y)}m?(p.text.dynamicLayoutVertexBuffer.updateData(Y),pe&&p.text.globeExtVertexBuffer.updateData(pe)):(p.icon.dynamicLayoutVertexBuffer.updateData(Y),pe&&p.icon.globeExtVertexBuffer.updateData(pe))}function Yi(p,t,a,m,v,b,S,k,D,O,V,G,X,J,ee,Y){const pe=k.glyphStartIndex+k.numGlyphs,K=k.lineStartIndex,ne=k.lineStartIndex+k.lineLength,oe=t.getoffsetX(k.glyphStartIndex),ge=t.getoffsetX(pe-1),he=ps(p*oe,a,m,v,b,S,k.segment,K,ne,D,O,V,G,X,!0,J,ee,Y);if(!he)return null;const fe=ps(p*ge,a,m,v,b,S,k.segment,K,ne,D,O,V,G,X,!0,J,ee,Y);return fe?{first:he,last:fe}:null}function qu(p,t,a,m){return p.writingMode===n.WritingMode.horizontal&&Math.abs(a.y-t.y)>Math.abs(a.x-t.x)*m?{useVertical:!0}:p.writingMode===n.WritingMode.vertical?t.y<a.y?{needsFlipping:!0}:null:p.flipState!==0&&function(v,b,S){const k=(b.x-v.x)*S;return k===0||Math.abs((b.y-v.y)/k)>mi}(t,a,m)?p.flipState===1?{needsFlipping:!0}:null:t.x>a.x?{needsFlipping:!0}:null}function us(p,t,a,m,v,b,S,k,D,O,V,G,X,J,ee,Y,pe,K,ne){const oe=t/24,ge=p.lineOffsetX*oe,he=p.lineOffsetY*oe;let fe;if(p.numGlyphs>1){const be=p.glyphStartIndex+p.numGlyphs,Ve=p.lineStartIndex,Ze=p.lineStartIndex+p.lineLength,je=Yi(oe,k,ge,he,a,G,X,p,D,b,J,Y,!1,pe,K,ne);if(!je)return{notEnoughRoom:!0};const Ue=Kn(je.first.point,S).point,_e=Kn(je.last.point,S).point,rt=new n.pointGeometry(Ue[0],Ue[1]),it=new n.pointGeometry(_e[0],_e[1]);if(m&&!a){const Et=qu(p,rt,it,ee);if(p.flipState=Et&&Et.needsFlipping?1:2,Et)return Et}fe=[je.first];for(let Et=p.glyphStartIndex+1;Et<be-1;Et++)fe.push(ps(oe*k.getoffsetX(Et),ge,he,a,G,X,p.segment,Ve,Ze,D,b,J,Y,!1,!1,pe,K,ne));fe.push(je.last)}else{if(m&&!a){const Ve=ni(X,v).point,Ze=p.lineStartIndex+p.segment+1,je=new n.pointGeometry(D.getx(Ze),D.gety(Ze)),Ue=ni(je,v),_e=Ue.signedDistanceFromCamera>0?Ue.point:hs(X,je,Ve,1,v,void 0,pe,K.canonical),rt=qu(p,new n.pointGeometry(Ve[0],Ve[1]),new n.pointGeometry(_e[0],_e[1]),ee);if(p.flipState=rt&&rt.needsFlipping?1:2,rt)return rt}const be=ps(oe*k.getoffsetX(p.glyphStartIndex),ge,he,a,G,X,p.segment,p.lineStartIndex,p.lineStartIndex+p.lineLength,D,b,J,Y,!1,!1,pe,K,ne);if(!be)return{notEnoughRoom:!0};fe=[be]}if(V)for(const be of fe)n.updateGlobeVertexNormal(V,O.length+0,be.up[0],be.up[1],be.up[2]),n.updateGlobeVertexNormal(V,O.length+1,be.up[0],be.up[1],be.up[2]),n.updateGlobeVertexNormal(V,O.length+2,be.up[0],be.up[1],be.up[2]),n.updateGlobeVertexNormal(V,O.length+3,be.up[0],be.up[1],be.up[2]),n.addDynamicAttributes(O,be.point[0],be.point[1],be.point[2],be.angle);else for(const be of fe)n.addDynamicAttributes(O,be.point[0],be.point[1],be.point[2],be.angle);return{}}function el(p,t,a,m,v){const b=m.projectTilePoint(p.x,p.y,t);if(!v)return ni(b,a,b.z);const S=v(p);return ni(new n.pointGeometry(b.x+S[0],b.y+S[1]),a,b.z+S[2])}function hs(p,t,a,m,v,b,S,k){const D=el(p.add(p.sub(t)._unit()),k,v,S,b).point,O=n.sub([],a,D);return n.scaleAndAdd([],a,O,m/n.length(O))}function ps(p,t,a,m,v,b,S,k,D,O,V,G,X,J,ee,Y,pe,K){const ne=m?p-t:p+t;let oe=ne>0?1:-1,ge=0;m&&(oe*=-1,ge=Math.PI),oe<0&&(ge+=Math.PI);let he=oe>0?k+S:k+S+1,fe=v,be=v,Ve=0,Ze=0;const je=Math.abs(ne),Ue=[],_e=[];let rt=b;const it=()=>{const Ot=he-oe;return Ve===0?b:new n.pointGeometry(O.getx(Ot),O.gety(Ot))},Et=()=>hs(it(),rt,be,je-Ve+1,V,X,Y,pe.canonical);for(;Ve+Ze<=je;){if(he+=oe,he<k||he>=D)return null;if(be=fe,Ue.push(fe),J&&_e.push(rt||it()),fe=G[he],fe===void 0){rt=new n.pointGeometry(O.getx(he),O.gety(he));const Ot=el(rt,pe.canonical,V,Y,X);fe=Ot.signedDistanceFromCamera>0?G[he]=Ot.point:Et()}else rt=null;Ve+=Ze,Ze=n.distance(be,fe)}rt=rt||new n.pointGeometry(O.getx(he),O.gety(he));const Ke=it();ee&&X&&(G[he]=fe=G[he]===void 0?fe:Et(),Ze=n.distance(be,fe));const Ft=(je-Ve)/Ze,vt=rt.sub(Ke).mult(Ft)._add(Ke),yt=n.sub([],fe,be),ut=n.scaleAndAdd([],be,yt,Ft);let gt=[0,0,1],Xt=yt[0],Vt=yt[1];if(K&&(gt=Y.upVector(pe.canonical,vt.x,vt.y),gt[0]!==0||gt[1]!==0||gt[2]!==1)){const Ot=[1,0,0],ii=[0,1,0];Ot[0]=gt[2],Ot[1]=0,Ot[2]=-gt[0],n.cross(ii,gt,Ot),n.normalize(Ot,Ot),n.normalize(ii,ii),Xt=n.dot(yt,Ot),Vt=n.dot(yt,ii)}if(a){const Ot=n.cross([],gt,yt);n.normalize(Ot,Ot),n.scaleAndAdd(ut,ut,Ot,a*oe)}const oi=ge+Math.atan2(Vt,Xt);return Ue.push(ut),J&&_e.push(vt),{point:ut,angle:oi,path:Ue,tilePath:_e,up:gt}}const Zu=new Float32Array([-1/0,-1/0,0,-1/0,-1/0,0,-1/0,-1/0,0,-1/0,-1/0,0,-1/0,-1/0,0]);function _r(p,t){for(let a=0;a<p;a++){const m=t.length;t.resize(m+4),t.float32.set(Zu,4*m)}}function tr(p,t,a){const m=t[0],v=t[1];return p[0]=a[0]*m+a[4]*v+a[12],p[1]=a[1]*m+a[5]*v+a[13],p[3]=a[3]*m+a[7]*v+a[15],p}const an=100;class uc{constructor(t,a,m=new St(t.width+200,t.height+200,25),v=new St(t.width+200,t.height+200,25)){this.transform=t,this.grid=m,this.ignoredGrid=v,this.pitchfactor=Math.cos(t._pitch)*t.cameraToCenterDistance,this.screenRightBoundary=t.width+an,this.screenBottomBoundary=t.height+an,this.gridRightBoundary=t.width+200,this.gridBottomBoundary=t.height+200,this.fogState=a}placeCollisionBox(t,a,m,v,b,S,k,D){let O=m.projectedAnchorX,V=m.projectedAnchorY,G=m.projectedAnchorZ;const X=m.elevation,J=m.tileID;if(X&&J){const he=t.getProjection().upVector(J.canonical,m.tileAnchorX,m.tileAnchorY),fe=t.getProjection().upVectorScale(J.canonical,this.transform.center.lat,this.transform.worldSize).metersToTile;O+=he[0]*X*fe,V+=he[1]*X*fe,G+=he[2]*X*fe}const ee=this.projectAndGetPerspectiveRatio(k,[O,V,G],m.tileID,t.projection.name==="globe"||!!X||this.transform.pitch>0,t.getProjection()),Y=S*ee.perspectiveRatio,pe=(m.x1*a+v.x-m.padding)*Y+ee.point.x,K=(m.y1*a+v.y-m.padding)*Y+ee.point.y,ne=(m.x2*a+v.x+m.padding)*Y+ee.point.x,oe=(m.y2*a+v.y+m.padding)*Y+ee.point.y,ge=ee.perspectiveRatio<=.55||ee.occluded;return!this.isInsideGrid(pe,K,ne,oe)||!b&&this.grid.hitTest(pe,K,ne,oe,D)||ge?{box:[],offscreen:!1,occluded:ee.occluded}:{box:[pe,K,ne,oe],offscreen:this.isOffscreen(pe,K,ne,oe),occluded:!1}}placeCollisionCircles(t,a,m,v,b,S,k,D,O,V,G,X,J,ee,Y){const pe=[],K=this.transform.elevation,ne=K?K.getAtTileOffsetFunc(Y,this.transform.center.lat,this.transform.worldSize,t.getProjection()):Ke=>[0,0,0],oe=new n.pointGeometry(m.tileAnchorX,m.tileAnchorY),ge=t.getProjection().projectTilePoint(m.tileAnchorX,m.tileAnchorY,Y.canonical),he=ne(oe),fe=[ge.x+he[0],ge.y+he[1],ge.z+he[2]],be=t.projection.name==="globe",Ve=this.projectAndGetPerspectiveRatio(k,[fe[0],fe[1],fe[2]],Y,be||!!K||this.transform.pitch>0,t.getProjection()),{perspectiveRatio:Ze}=Ve,je=(G?S/Ze:S*Ze)/n.ONE_EM,Ue=ni(new n.pointGeometry(fe[0],fe[1]),D,fe[2]).point,_e=Ve.signedDistanceFromCamera>0?Yi(je,b,m.lineOffsetX*je,m.lineOffsetY*je,!1,Ue,oe,m,v,D,{},K&&!G?ne:null,G&&!!K,t.getProjection(),Y,G):null;let rt=!1,it=!1,Et=!0;if(_e&&!Ve.occluded){const Ke=.5*J*Ze+ee,Ft=new n.pointGeometry(-100,-100),vt=new n.pointGeometry(this.screenRightBoundary,this.screenBottomBoundary),yt=new ia,ut=_e.first,gt=_e.last;let Xt=[];for(let Ot=ut.path.length-1;Ot>=1;Ot--)Xt.push(ut.path[Ot]);for(let Ot=1;Ot<gt.path.length;Ot++)Xt.push(gt.path[Ot]);const Vt=2.5*Ke;if(O){const Ot=Xt.map(K&&!be?(ii,Si)=>{const zi=ne(Si<ut.path.length-1?ut.tilePath[ut.path.length-1-Si]:gt.tilePath[Si-ut.path.length+2]);return ii[2]=zi[2],Kn(ii,O)}:ii=>Kn(ii,O));Xt=Ot.some(ii=>ii.signedDistanceFromCamera<=0)?[]:Ot.map(ii=>ii.point)}let oi=[];if(Xt.length>0){const Ot=Xt.map(Ri=>new n.pointGeometry(Ri[0],Ri[1]));let ii=1/0,Si=-1/0,zi=1/0,nr=-1/0;for(let Ri=0;Ri<Ot.length;Ri++)ii=Math.min(ii,Ot[Ri].x),zi=Math.min(zi,Ot[Ri].y),Si=Math.max(Si,Ot[Ri].x),nr=Math.max(nr,Ot[Ri].y);oi=ii>=Ft.x&&Si<=vt.x&&zi>=Ft.y&&nr<=vt.y?[Ot]:Si<Ft.x||ii>vt.x||nr<Ft.y||zi>vt.y?[]:n.clipLine([Ot],Ft.x,Ft.y,vt.x,vt.y)}for(const Ot of oi){yt.reset(Ot,.25*Ke);let ii=0;ii=yt.length<=.5*Ke?1:Math.ceil(yt.paddedLength/Vt)+1;for(let Si=0;Si<ii;Si++){const zi=Si/Math.max(ii-1,1),nr=yt.lerp(zi),Ri=nr.x+an,en=nr.y+an;pe.push(Ri,en,Ke,0);const Bn=Ri-Ke,to=en-Ke,qi=Ri+Ke,$i=en+Ke;if(Et=Et&&this.isOffscreen(Bn,to,qi,$i),it=it||this.isInsideGrid(Bn,to,qi,$i),!a&&this.grid.hitTestCircle(Ri,en,Ke,X)&&(rt=!0,!V))return{circles:[],offscreen:!1,collisionDetected:rt,occluded:!1}}}}return{circles:!V&&rt||!it?[]:pe,offscreen:Et,collisionDetected:rt,occluded:Ve.occluded}}queryRenderedSymbols(t){if(t.length===0||this.grid.keysLength()===0&&this.ignoredGrid.keysLength()===0)return{};const a=[];let m=1/0,v=1/0,b=-1/0,S=-1/0;for(const V of t){const G=new n.pointGeometry(V.x+an,V.y+an);m=Math.min(m,G.x),v=Math.min(v,G.y),b=Math.max(b,G.x),S=Math.max(S,G.y),a.push(G)}const k=this.grid.query(m,v,b,S).concat(this.ignoredGrid.query(m,v,b,S)),D={},O={};for(const V of k){const G=V.key;if(D[G.bucketInstanceId]===void 0&&(D[G.bucketInstanceId]={}),D[G.bucketInstanceId][G.featureIndex])continue;const X=[new n.pointGeometry(V.x1,V.y1),new n.pointGeometry(V.x2,V.y1),new n.pointGeometry(V.x2,V.y2),new n.pointGeometry(V.x1,V.y2)];n.polygonIntersectsPolygon(a,X)&&(D[G.bucketInstanceId][G.featureIndex]=!0,O[G.bucketInstanceId]===void 0&&(O[G.bucketInstanceId]=[]),O[G.bucketInstanceId].push(G.featureIndex))}return O}insertCollisionBox(t,a,m,v,b){(a?this.ignoredGrid:this.grid).insert({bucketInstanceId:m,featureIndex:v,collisionGroupID:b},t[0],t[1],t[2],t[3])}insertCollisionCircles(t,a,m,v,b){const S=a?this.ignoredGrid:this.grid,k={bucketInstanceId:m,featureIndex:v,collisionGroupID:b};for(let D=0;D<t.length;D+=4)S.insertCircle(k,t[D],t[D+1],t[D+2])}projectAndGetPerspectiveRatio(t,a,m,v,b){const S=[a[0],a[1],a[2],1];let k=!1;if(a[2]||this.transform.pitch>0){n.transformMat4$1(S,S,t);const D=b.name==="globe";this.fogState&&m&&!D&&(k=function(O,V,G,X,J,ee){const Y=ee.calculateFogTileMatrix(J),pe=[V,G,X];return n.transformMat4(pe,pe,Y),_t(O,pe,ee.pitch,ee._fov)}(this.fogState,a[0],a[1],a[2],m.toUnwrapped(),this.transform)>.9)}else tr(S,S,t);return{point:new n.pointGeometry((S[0]/S[3]+1)/2*this.transform.width+an,(-S[1]/S[3]+1)/2*this.transform.height+an),perspectiveRatio:Math.min(.5+this.transform.getCameraToCenterDistance(b)/S[3]*.5,1.5),signedDistanceFromCamera:S[3],occluded:v&&S[2]>S[3]||k}}isOffscreen(t,a,m,v){return m<an||t>=this.screenRightBoundary||v<an||a>this.screenBottomBoundary}isInsideGrid(t,a,m,v){return m>=0&&t<this.gridRightBoundary&&v>=0&&a<this.gridBottomBoundary}getViewportMatrix(){const t=n.identity([]);return n.translate(t,t,[-100,-100,0]),t}}function Cr(p,t,a){const m=t.createTileMatrix(p,p.worldSize,a.toUnwrapped());return n.multiply(new Float32Array(16),p.projMatrix,m)}function ln(p,t,a){if(t.projection.name===a.projection.name)return p.projMatrix;const m=a.clone();return m.setProjection(t.projection),Cr(m,t.getProjection(),p)}function tl(p,t,a){return t.name===a.projection.name?p.projMatrix:Cr(a,t,p)}class na{constructor(t,a,m,v){this.opacity=t?Math.max(0,Math.min(1,t.opacity+(t.placed?a:-a))):v&&m?1:0,this.placed=m}isHidden(){return this.opacity===0&&!this.placed}}class Qi{constructor(t,a,m,v,b,S=!1){this.text=new na(t?t.text:null,a,m,b),this.icon=new na(t?t.icon:null,a,v,b),this.clipped=S}isHidden(){return this.text.isHidden()&&this.icon.isHidden()}}class Vo{constructor(t,a,m,v=!1){this.text=t,this.icon=a,this.skipFade=m,this.clipped=v}}class hc{constructor(){this.invProjMatrix=n.create(),this.viewportMatrix=n.create(),this.circles=[]}}class oa{constructor(t,a,m,v,b){this.bucketInstanceId=t,this.featureIndex=a,this.sourceLayerIndex=m,this.bucketIndex=v,this.tileID=b}}class Tr{constructor(t){this.crossSourceCollisions=t,this.maxGroupID=0,this.collisionGroups={}}get(t){if(this.crossSourceCollisions)return{ID:0,predicate:null};if(!this.collisionGroups[t]){const a=++this.maxGroupID;this.collisionGroups[t]={ID:a,predicate:m=>m.collisionGroupID===a}}return this.collisionGroups[t]}}function il(p,t,a,m,v){const{horizontalAlign:b,verticalAlign:S}=n.getAnchorAlignment(p),k=-(b-.5)*t,D=-(S-.5)*a,O=n.evaluateVariableOffset(p,m);return new n.pointGeometry(k+O[0]*v,D+O[1]*v)}function sa(p,t,a,m,v){const b=new n.pointGeometry(p,t);return a&&b._rotate(m?v:-v),b}class Jn{constructor(t,a,m,v,b){this.transform=t.clone(),this.projection=t.projection.name,this.collisionIndex=new uc(this.transform,b),this.placements={},this.opacities={},this.variableOffsets={},this.stale=!1,this.commitTime=0,this.fadeDuration=a,this.retainedQueryData={},this.collisionGroups=new Tr(m),this.collisionCircleArrays={},this.prevPlacement=v,v&&(v.prevPlacement=void 0),this.placedOrientations={}}getBucketParts(t,a,m,v){const b=m.getBucket(a),S=m.latestFeatureIndex;if(!b||!S||a.id!==b.layerIds[0])return;const k=b.layers[0].layout,D=m.collisionBoxArray,O=Math.pow(2,this.transform.zoom-m.tileID.overscaledZ),V=m.tileSize/n.EXTENT,G=m.tileID.toUnwrapped();this.transform.setProjection(b.projection);const X=(J=m.tileID,ee=b.getProjection(),Y=this.transform,ee.name===this.projection?Y.calculateProjMatrix(J.toUnwrapped()):Cr(Y,ee,J));var J,ee,Y;const pe=k.get("text-pitch-alignment")==="map",K=k.get("text-rotation-alignment")==="map";a.compileFilter();const ne=a.dynamicFilter(),oe=a.dynamicFilterNeedsFeature(),ge=this.transform.calculatePixelsToTileUnitsMatrix(m),he=bn(X,m.tileID.canonical,pe,K,this.transform,b.getProjection(),ge);let fe=null;if(pe){const Ze=Uo(X,m.tileID.canonical,pe,K,this.transform,b.getProjection(),ge);fe=n.multiply([],this.transform.labelPlaneMatrix,Ze)}let be=null;ne&&m.latestFeatureIndex&&(be={unwrappedTileID:G,dynamicFilter:ne,dynamicFilterNeedsFeature:oe,featureIndex:m.latestFeatureIndex}),this.retainedQueryData[b.bucketInstanceId]=new oa(b.bucketInstanceId,S,b.sourceLayerIndex,b.index,m.tileID);const Ve={bucket:b,layout:k,posMatrix:X,textLabelPlaneMatrix:he,labelToScreenMatrix:fe,clippingData:be,scale:O,textPixelRatio:V,holdingForFade:m.holdingForFade(),collisionBoxArray:D,partiallyEvaluatedTextSize:n.evaluateSizeForZoom(b.textSizeData,this.transform.zoom),partiallyEvaluatedIconSize:n.evaluateSizeForZoom(b.iconSizeData,this.transform.zoom),collisionGroup:this.collisionGroups.get(b.sourceID)};if(v)for(const Ze of b.sortKeyRanges){const{sortKey:je,symbolInstanceStart:Ue,symbolInstanceEnd:_e}=Ze;t.push({sortKey:je,symbolInstanceStart:Ue,symbolInstanceEnd:_e,parameters:Ve})}else t.push({symbolInstanceStart:0,symbolInstanceEnd:b.symbolInstances.length,parameters:Ve})}attemptAnchorPlacement(t,a,m,v,b,S,k,D,O,V,G,X,J,ee,Y,pe,K,ne){const oe=[X.textOffset0,X.textOffset1],ge=il(t,m,v,oe,b),he=this.collisionIndex.placeCollisionBox(ee,b,a,sa(ge.x,ge.y,S,k,this.transform.angle),G,D,O,V.predicate);if((!pe||this.collisionIndex.placeCollisionBox(ee,ee.getSymbolInstanceIconSize(ne,this.transform.zoom,J),pe,sa(ge.x,ge.y,S,k,this.transform.angle),G,D,O,V.predicate).box.length!==0)&&he.box.length>0){let fe;return this.prevPlacement&&this.prevPlacement.variableOffsets[X.crossTileID]&&this.prevPlacement.placements[X.crossTileID]&&this.prevPlacement.placements[X.crossTileID].text&&(fe=this.prevPlacement.variableOffsets[X.crossTileID].anchor),this.variableOffsets[X.crossTileID]={textOffset:oe,width:m,height:v,anchor:t,textScale:b,prevAnchor:fe},this.markUsedJustification(ee,t,X,Y),ee.allowVerticalPlacement&&(this.markUsedOrientation(ee,Y,X),this.placedOrientations[X.crossTileID]=Y),{shift:ge,placedGlyphBoxes:he}}}placeLayerBucketPart(t,a,m,v){const{bucket:b,layout:S,posMatrix:k,textLabelPlaneMatrix:D,labelToScreenMatrix:O,clippingData:V,textPixelRatio:G,holdingForFade:X,collisionBoxArray:J,partiallyEvaluatedTextSize:ee,partiallyEvaluatedIconSize:Y,collisionGroup:pe}=t.parameters,K=S.get("text-optional"),ne=S.get("icon-optional"),oe=S.get("text-allow-overlap"),ge=S.get("icon-allow-overlap"),he=S.get("text-rotation-alignment")==="map",fe=S.get("text-pitch-alignment")==="map",be=S.get("icon-text-fit")!=="none",Ve=S.get("symbol-z-order")==="viewport-y";this.transform.setProjection(b.projection);let Ze=oe&&(ge||!b.hasIconData()||ne),je=ge&&(oe||!b.hasTextData()||K);!b.collisionArrays&&J&&b.deserializeCollisionBoxes(J),m&&v&&b.updateCollisionDebugBuffers(this.transform.zoom,J);const Ue=(_e,rt,it)=>{if(V){const qi={zoom:this.transform.zoom,pitch:this.transform.pitch};let $i=null;if(V.dynamicFilterNeedsFeature){const Mi=this.retainedQueryData[b.bucketInstanceId];$i=V.featureIndex.loadFeature({featureIndex:_e.featureIndex,bucketIndex:Mi.bucketIndex,sourceLayerIndex:Mi.sourceLayerIndex,layoutVertexArrayOffset:0})}if(!(0,V.dynamicFilter)(qi,$i,this.retainedQueryData[b.bucketInstanceId].tileID.canonical,new n.pointGeometry(_e.tileAnchorX,_e.tileAnchorY),this.transform.calculateDistanceTileData(V.unwrappedTileID)))return this.placements[_e.crossTileID]=new Vo(!1,!1,!1,!0),void(a[_e.crossTileID]=!0)}if(a[_e.crossTileID])return;if(X)return void(this.placements[_e.crossTileID]=new Vo(!1,!1,!1));let Et=!1,Ke=!1,Ft=!0,vt=!1,yt=!1,ut=null,gt={box:null,offscreen:null,occluded:null},Xt={box:null,offscreen:null,occluded:null},Vt=null,oi=null,Ot=null,ii=0,Si=0,zi=0;it.textFeatureIndex?ii=it.textFeatureIndex:_e.useRuntimeCollisionCircles&&(ii=_e.featureIndex),it.verticalTextFeatureIndex&&(Si=it.verticalTextFeatureIndex);const nr=qi=>{qi.tileID=this.retainedQueryData[b.bucketInstanceId].tileID,(this.transform.elevation||qi.elevation)&&(qi.elevation=this.transform.elevation?this.transform.elevation.getAtTileOffset(this.retainedQueryData[b.bucketInstanceId].tileID,qi.tileAnchorX,qi.tileAnchorY):0)},Ri=it.textBox;if(Ri){nr(Ri);const qi=Mi=>{let ur=n.WritingMode.horizontal;if(b.allowVerticalPlacement&&!Mi&&this.prevPlacement){const Ar=this.prevPlacement.placedOrientations[_e.crossTileID];Ar&&(this.placedOrientations[_e.crossTileID]=Ar,ur=Ar,this.markUsedOrientation(b,ur,_e))}return ur},$i=(Mi,ur)=>{if(b.allowVerticalPlacement&&_e.numVerticalGlyphVertices>0&&it.verticalTextBox){for(const Ar of b.writingModes)if(Ar===n.WritingMode.vertical?(gt=ur(),Xt=gt):gt=Mi(),gt&&gt.box&&gt.box.length)break}else gt=Mi()};if(S.get("text-variable-anchor")){let Mi=S.get("text-variable-anchor");if(this.prevPlacement&&this.prevPlacement.variableOffsets[_e.crossTileID]){const yi=this.prevPlacement.variableOffsets[_e.crossTileID];Mi.indexOf(yi.anchor)>0&&(Mi=Mi.filter(jr=>jr!==yi.anchor),Mi.unshift(yi.anchor))}const ur=(yi,jr,Ho)=>{const Tn=b.getSymbolInstanceTextSize(ee,_e,this.transform.zoom,rt),Ss=(yi.x2-yi.x1)*Tn+2*yi.padding,Ms=(yi.y2-yi.y1)*Tn+2*yi.padding,vo=be&&!ge?jr:null;vo&&nr(vo);let hr={box:[],offscreen:!1,occluded:!1};const On=oe?2*Mi.length:Mi.length;for(let io=0;io<On;++io){const Sa=this.attemptAnchorPlacement(Mi[io%Mi.length],yi,Ss,Ms,Tn,he,fe,G,k,pe,io>=Mi.length,_e,rt,b,Ho,vo,ee,Y);if(Sa&&(hr=Sa.placedGlyphBoxes,hr&&hr.box&&hr.box.length)){Et=!0,ut=Sa.shift;break}}return hr};$i(()=>ur(Ri,it.iconBox,n.WritingMode.horizontal),()=>{const yi=it.verticalTextBox;return yi&&nr(yi),b.allowVerticalPlacement&&!(gt&&gt.box&&gt.box.length)&&_e.numVerticalGlyphVertices>0&&yi?ur(yi,it.verticalIconBox,n.WritingMode.vertical):{box:null,offscreen:null,occluded:null}}),gt&&(Et=gt.box,Ft=gt.offscreen,vt=gt.occluded);const Ar=qi(gt&&gt.box);if(!Et&&this.prevPlacement){const yi=this.prevPlacement.variableOffsets[_e.crossTileID];yi&&(this.variableOffsets[_e.crossTileID]=yi,this.markUsedJustification(b,yi.anchor,_e,Ar))}}else{const Mi=(ur,Ar)=>{const yi=b.getSymbolInstanceTextSize(ee,_e,this.transform.zoom,rt),jr=this.collisionIndex.placeCollisionBox(b,yi,ur,new n.pointGeometry(0,0),oe,G,k,pe.predicate);return jr&&jr.box&&jr.box.length&&(this.markUsedOrientation(b,Ar,_e),this.placedOrientations[_e.crossTileID]=Ar),jr};$i(()=>Mi(Ri,n.WritingMode.horizontal),()=>{const ur=it.verticalTextBox;return b.allowVerticalPlacement&&_e.numVerticalGlyphVertices>0&&ur?(nr(ur),Mi(ur,n.WritingMode.vertical)):{box:null,offscreen:null,occluded:null}}),qi(gt&&gt.box&&gt.box.length)}}if(Vt=gt,Et=Vt&&Vt.box&&Vt.box.length>0,Ft=Vt&&Vt.offscreen,vt=Vt&&Vt.occluded,_e.useRuntimeCollisionCircles){const qi=b.text.placedSymbolArray.get(_e.centerJustifiedTextSymbolIndex>=0?_e.centerJustifiedTextSymbolIndex:_e.verticalPlacedTextSymbolIndex),$i=n.evaluateSizeForFeature(b.textSizeData,ee,qi),Mi=S.get("text-padding");oi=this.collisionIndex.placeCollisionCircles(b,oe,qi,b.lineVertexArray,b.glyphOffsetArray,$i,k,D,O,m,fe,pe.predicate,_e.collisionCircleDiameter*$i/n.ONE_EM,Mi,this.retainedQueryData[b.bucketInstanceId].tileID),Et=oe||oi.circles.length>0&&!oi.collisionDetected,Ft=Ft&&oi.offscreen,vt=oi.occluded}if(it.iconFeatureIndex&&(zi=it.iconFeatureIndex),it.iconBox){const qi=$i=>{nr($i);const Mi=be&&ut?sa(ut.x,ut.y,he,fe,this.transform.angle):new n.pointGeometry(0,0),ur=b.getSymbolInstanceIconSize(Y,this.transform.zoom,rt);return this.collisionIndex.placeCollisionBox(b,ur,$i,Mi,ge,G,k,pe.predicate)};Xt&&Xt.box&&Xt.box.length&&it.verticalIconBox?(Ot=qi(it.verticalIconBox),Ke=Ot.box.length>0):(Ot=qi(it.iconBox),Ke=Ot.box.length>0),Ft=Ft&&Ot.offscreen,yt=Ot.occluded}const en=K||_e.numHorizontalGlyphVertices===0&&_e.numVerticalGlyphVertices===0,Bn=ne||_e.numIconVertices===0;if(en||Bn?Bn?en||(Ke=Ke&&Et):Et=Ke&&Et:Ke=Et=Ke&&Et,Et&&Vt&&Vt.box&&this.collisionIndex.insertCollisionBox(Vt.box,S.get("text-ignore-placement"),b.bucketInstanceId,Xt&&Xt.box&&Si?Si:ii,pe.ID),Ke&&Ot&&this.collisionIndex.insertCollisionBox(Ot.box,S.get("icon-ignore-placement"),b.bucketInstanceId,zi,pe.ID),oi&&(Et&&this.collisionIndex.insertCollisionCircles(oi.circles,S.get("text-ignore-placement"),b.bucketInstanceId,ii,pe.ID),m)){const qi=b.bucketInstanceId;let $i=this.collisionCircleArrays[qi];$i===void 0&&($i=this.collisionCircleArrays[qi]=new hc);for(let Mi=0;Mi<oi.circles.length;Mi+=4)$i.circles.push(oi.circles[Mi+0]),$i.circles.push(oi.circles[Mi+1]),$i.circles.push(oi.circles[Mi+2]),$i.circles.push(oi.collisionDetected?1:0)}const to=b.projection.name!=="globe";Ze=Ze&&(to||!vt),je=je&&(to||!yt),this.placements[_e.crossTileID]=new Vo(Et||Ze,Ke||je,Ft||b.justReloaded),a[_e.crossTileID]=!0};if(Ve){const _e=b.getSortedSymbolIndexes(this.transform.angle);for(let rt=_e.length-1;rt>=0;--rt){const it=_e[rt];Ue(b.symbolInstances.get(it),it,b.collisionArrays[it])}}else for(let _e=t.symbolInstanceStart;_e<t.symbolInstanceEnd;_e++)Ue(b.symbolInstances.get(_e),_e,b.collisionArrays[_e]);if(m&&b.bucketInstanceId in this.collisionCircleArrays){const _e=this.collisionCircleArrays[b.bucketInstanceId];n.invert(_e.invProjMatrix,k),_e.viewportMatrix=this.collisionIndex.getViewportMatrix()}b.justReloaded=!1}markUsedJustification(t,a,m,v){let b;b=v===n.WritingMode.vertical?m.verticalPlacedTextSymbolIndex:{left:m.leftJustifiedTextSymbolIndex,center:m.centerJustifiedTextSymbolIndex,right:m.rightJustifiedTextSymbolIndex}[n.getAnchorJustification(a)];const S=[m.leftJustifiedTextSymbolIndex,m.centerJustifiedTextSymbolIndex,m.rightJustifiedTextSymbolIndex,m.verticalPlacedTextSymbolIndex];for(const k of S)k>=0&&(t.text.placedSymbolArray.get(k).crossTileID=b>=0&&k!==b?0:m.crossTileID)}markUsedOrientation(t,a,m){const v=a===n.WritingMode.horizontal||a===n.WritingMode.horizontalOnly?a:0,b=a===n.WritingMode.vertical?a:0,S=[m.leftJustifiedTextSymbolIndex,m.centerJustifiedTextSymbolIndex,m.rightJustifiedTextSymbolIndex];for(const k of S)t.text.placedSymbolArray.get(k).placedOrientation=v;m.verticalPlacedTextSymbolIndex&&(t.text.placedSymbolArray.get(m.verticalPlacedTextSymbolIndex).placedOrientation=b)}commit(t){this.commitTime=t,this.zoomAtLastRecencyCheck=this.transform.zoom;const a=this.prevPlacement;let m=!1;this.prevZoomAdjustment=a?a.zoomAdjustment(this.transform.zoom):0;const v=a?a.symbolFadeChange(t):1,b=a?a.opacities:{},S=a?a.variableOffsets:{},k=a?a.placedOrientations:{};for(const D in this.placements){const O=this.placements[D],V=b[D];V?(this.opacities[D]=new Qi(V,v,O.text,O.icon,null,O.clipped),m=m||O.text!==V.text.placed||O.icon!==V.icon.placed):(this.opacities[D]=new Qi(null,v,O.text,O.icon,O.skipFade,O.clipped),m=m||O.text||O.icon)}for(const D in b){const O=b[D];if(!this.opacities[D]){const V=new Qi(O,v,!1,!1);V.isHidden()||(this.opacities[D]=V,m=m||O.text.placed||O.icon.placed)}}for(const D in S)this.variableOffsets[D]||!this.opacities[D]||this.opacities[D].isHidden()||(this.variableOffsets[D]=S[D]);for(const D in k)this.placedOrientations[D]||!this.opacities[D]||this.opacities[D].isHidden()||(this.placedOrientations[D]=k[D]);m?this.lastPlacementChangeTime=t:typeof this.lastPlacementChangeTime!="number"&&(this.lastPlacementChangeTime=a?a.lastPlacementChangeTime:t)}updateLayerOpacities(t,a){const m={};for(const v of a){const b=v.getBucket(t);b&&v.latestFeatureIndex&&t.id===b.layerIds[0]&&this.updateBucketOpacities(b,m,v.collisionBoxArray)}}updateBucketOpacities(t,a,m){t.hasTextData()&&t.text.opacityVertexArray.clear(),t.hasIconData()&&t.icon.opacityVertexArray.clear(),t.hasIconCollisionBoxData()&&t.iconCollisionBox.collisionVertexArray.clear(),t.hasTextCollisionBoxData()&&t.textCollisionBox.collisionVertexArray.clear();const v=t.layers[0].layout,b=!!t.layers[0].dynamicFilter(),S=new Qi(null,0,!1,!1,!0),k=v.get("text-allow-overlap"),D=v.get("icon-allow-overlap"),O=v.get("text-variable-anchor"),V=v.get("text-rotation-alignment")==="map",G=v.get("text-pitch-alignment")==="map",X=v.get("icon-text-fit")!=="none",J=new Qi(null,0,k&&(D||!t.hasIconData()||v.get("icon-optional")),D&&(k||!t.hasTextData()||v.get("text-optional")),!0);!t.collisionArrays&&m&&(t.hasIconCollisionBoxData()||t.hasTextCollisionBoxData())&&t.deserializeCollisionBoxes(m);const ee=(pe,K,ne)=>{for(let oe=0;oe<K/4;oe++)pe.opacityVertexArray.emplaceBack(ne)};let Y=0;for(let pe=0;pe<t.symbolInstances.length;pe++){const K=t.symbolInstances.get(pe),{numHorizontalGlyphVertices:ne,numVerticalGlyphVertices:oe,crossTileID:ge}=K;let he=this.opacities[ge];a[ge]?he=S:he||(he=J,this.opacities[ge]=he),a[ge]=!0;const fe=ne>0||oe>0,be=K.numIconVertices>0,Ve=this.placedOrientations[K.crossTileID],Ze=Ve===n.WritingMode.vertical,je=Ve===n.WritingMode.horizontal||Ve===n.WritingMode.horizontalOnly;if(!fe&&!be||he.isHidden()||Y++,fe){const Ue=Qn(he.text);ee(t.text,ne,Ze?No:Ue),ee(t.text,oe,je?No:Ue);const _e=he.text.isHidden();[K.rightJustifiedTextSymbolIndex,K.centerJustifiedTextSymbolIndex,K.leftJustifiedTextSymbolIndex].forEach(Et=>{Et>=0&&(t.text.placedSymbolArray.get(Et).hidden=_e||Ze?1:0)}),K.verticalPlacedTextSymbolIndex>=0&&(t.text.placedSymbolArray.get(K.verticalPlacedTextSymbolIndex).hidden=_e||je?1:0);const rt=this.variableOffsets[K.crossTileID];rt&&this.markUsedJustification(t,rt.anchor,K,Ve);const it=this.placedOrientations[K.crossTileID];it&&(this.markUsedJustification(t,"left",K,it),this.markUsedOrientation(t,it,K))}if(be){const Ue=Qn(he.icon);K.placedIconSymbolIndex>=0&&(ee(t.icon,K.numIconVertices,Ze?No:Ue),t.icon.placedSymbolArray.get(K.placedIconSymbolIndex).hidden=he.icon.isHidden()),K.verticalPlacedIconSymbolIndex>=0&&(ee(t.icon,K.numVerticalIconVertices,je?No:Ue),t.icon.placedSymbolArray.get(K.verticalPlacedIconSymbolIndex).hidden=he.icon.isHidden())}if(t.hasIconCollisionBoxData()||t.hasTextCollisionBoxData()){const Ue=t.collisionArrays[pe];if(Ue){let _e=new n.pointGeometry(0,0),rt=!0;if(Ue.textBox||Ue.verticalTextBox){if(O){const Et=this.variableOffsets[ge];Et?(_e=il(Et.anchor,Et.width,Et.height,Et.textOffset,Et.textScale),V&&_e._rotate(G?this.transform.angle:-this.transform.angle)):rt=!1}b&&(rt=!he.clipped),Ue.textBox&&go(t.textCollisionBox.collisionVertexArray,he.text.placed,!rt||Ze,_e.x,_e.y),Ue.verticalTextBox&&go(t.textCollisionBox.collisionVertexArray,he.text.placed,!rt||je,_e.x,_e.y)}const it=rt&&Boolean(!je&&Ue.verticalIconBox);Ue.iconBox&&go(t.iconCollisionBox.collisionVertexArray,he.icon.placed,it,X?_e.x:0,X?_e.y:0),Ue.verticalIconBox&&go(t.iconCollisionBox.collisionVertexArray,he.icon.placed,!it,X?_e.x:0,X?_e.y:0)}}}if(t.fullyClipped=Y===0,t.sortFeatures(this.transform.angle),this.retainedQueryData[t.bucketInstanceId]&&(this.retainedQueryData[t.bucketInstanceId].featureSortOrder=t.featureSortOrder),t.hasTextData()&&t.text.opacityVertexBuffer&&t.text.opacityVertexBuffer.updateData(t.text.opacityVertexArray),t.hasIconData()&&t.icon.opacityVertexBuffer&&t.icon.opacityVertexBuffer.updateData(t.icon.opacityVertexArray),t.hasIconCollisionBoxData()&&t.iconCollisionBox.collisionVertexBuffer&&t.iconCollisionBox.collisionVertexBuffer.updateData(t.iconCollisionBox.collisionVertexArray),t.hasTextCollisionBoxData()&&t.textCollisionBox.collisionVertexBuffer&&t.textCollisionBox.collisionVertexBuffer.updateData(t.textCollisionBox.collisionVertexArray),t.bucketInstanceId in this.collisionCircleArrays){const pe=this.collisionCircleArrays[t.bucketInstanceId];t.placementInvProjMatrix=pe.invProjMatrix,t.placementViewportMatrix=pe.viewportMatrix,t.collisionCircleArray=pe.circles,delete this.collisionCircleArrays[t.bucketInstanceId]}}symbolFadeChange(t){return this.fadeDuration===0?1:(t-this.commitTime)/this.fadeDuration+this.prevZoomAdjustment}zoomAdjustment(t){return Math.max(0,(this.transform.zoom-t)/1.5)}hasTransitions(t){return this.stale||t-this.lastPlacementChangeTime<this.fadeDuration}stillRecent(t,a){const m=this.zoomAtLastRecencyCheck===a?1-this.zoomAdjustment(a):1;return this.zoomAtLastRecencyCheck=a,this.commitTime+this.fadeDuration*m>t}setStale(){this.stale=!0}}function go(p,t,a,m,v){p.emplaceBack(t?1:0,a?1:0,m||0,v||0),p.emplaceBack(t?1:0,a?1:0,m||0,v||0),p.emplaceBack(t?1:0,a?1:0,m||0,v||0),p.emplaceBack(t?1:0,a?1:0,m||0,v||0)}const rl=Math.pow(2,25),Jp=Math.pow(2,24),pc=Math.pow(2,17),fs=Math.pow(2,16),Qp=Math.pow(2,9),$u=Math.pow(2,8),ds=Math.pow(2,1);function Qn(p){if(p.opacity===0&&!p.placed)return 0;if(p.opacity===1&&p.placed)return 4294967295;const t=p.placed?1:0,a=Math.floor(127*p.opacity);return a*rl+t*Jp+a*pc+t*fs+a*Qp+t*$u+a*ds+t}const No=0;class yo{constructor(t){this._sortAcrossTiles=t.layout.get("symbol-z-order")!=="viewport-y"&&t.layout.get("symbol-sort-key").constantOr(1)!==void 0,this._currentTileIndex=0,this._currentPartIndex=0,this._seenCrossTileIDs={},this._bucketParts=[]}continuePlacement(t,a,m,v,b){const S=this._bucketParts;for(;this._currentTileIndex<t.length;)if(a.getBucketParts(S,v,t[this._currentTileIndex],this._sortAcrossTiles),this._currentTileIndex++,b())return!0;for(this._sortAcrossTiles&&(this._sortAcrossTiles=!1,S.sort((k,D)=>k.sortKey-D.sortKey));this._currentPartIndex<S.length;){const k=S[this._currentPartIndex];if(a.placeLayerBucketPart(k,this._seenCrossTileIDs,m,k.symbolInstanceStart===0),this._currentPartIndex++,b())return!0}return!1}}class fc{constructor(t,a,m,v,b,S,k,D){this.placement=new Jn(t,b,S,k,D),this._currentPlacementIndex=a.length-1,this._forceFullPlacement=m,this._showCollisionBoxes=v,this._done=!1}isDone(){return this._done}continuePlacement(t,a,m){const v=n.exported.now(),b=()=>{const S=n.exported.now()-v;return!this._forceFullPlacement&&S>2};for(;this._currentPlacementIndex>=0;){const S=a[t[this._currentPlacementIndex]],k=this.placement.collisionIndex.transform.zoom;if(S.type==="symbol"&&(!S.minzoom||S.minzoom<=k)&&(!S.maxzoom||S.maxzoom>k)){if(this._inProgressLayer||(this._inProgressLayer=new yo(S)),this._inProgressLayer.continuePlacement(m[S.source],this.placement,this._showCollisionBoxes,S,b))return;delete this._inProgressLayer}this._currentPlacementIndex--}this._done=!0}commit(t){return this.placement.commit(t),this.placement}}const nl=512/n.EXTENT/2;class ef{constructor(t,a,m){this.tileID=t,this.indexedSymbolInstances={},this.bucketInstanceId=m;for(let v=0;v<a.length;v++){const b=a.get(v),S=b.key;this.indexedSymbolInstances[S]||(this.indexedSymbolInstances[S]=[]),this.indexedSymbolInstances[S].push({crossTileID:b.crossTileID,coord:this.getScaledCoordinates(b,t)})}}getScaledCoordinates(t,a){const m=nl/Math.pow(2,a.canonical.z-this.tileID.canonical.z);return{x:Math.floor((a.canonical.x*n.EXTENT+t.tileAnchorX)*m),y:Math.floor((a.canonical.y*n.EXTENT+t.tileAnchorY)*m)}}findMatches(t,a,m){const v=this.tileID.canonical.z<a.canonical.z?1:Math.pow(2,this.tileID.canonical.z-a.canonical.z);for(let b=0;b<t.length;b++){const S=t.get(b);if(S.crossTileID)continue;const k=this.indexedSymbolInstances[S.key];if(!k)continue;const D=this.getScaledCoordinates(S,a);for(const O of k)if(Math.abs(O.coord.x-D.x)<=v&&Math.abs(O.coord.y-D.y)<=v&&!m[O.crossTileID]){m[O.crossTileID]=!0,S.crossTileID=O.crossTileID;break}}}}class tf{constructor(){this.maxCrossTileID=0}generate(){return++this.maxCrossTileID}}class dc{constructor(){this.indexes={},this.usedCrossTileIDs={},this.lng=0}handleWrapJump(t){const a=Math.round((t-this.lng)/360);if(a!==0)for(const m in this.indexes){const v=this.indexes[m],b={};for(const S in v){const k=v[S];k.tileID=k.tileID.unwrapTo(k.tileID.wrap+a),b[k.tileID.key]=k}this.indexes[m]=b}this.lng=t}addBucket(t,a,m){if(this.indexes[t.overscaledZ]&&this.indexes[t.overscaledZ][t.key]){if(this.indexes[t.overscaledZ][t.key].bucketInstanceId===a.bucketInstanceId)return!1;this.removeBucketCrossTileIDs(t.overscaledZ,this.indexes[t.overscaledZ][t.key])}for(let b=0;b<a.symbolInstances.length;b++)a.symbolInstances.get(b).crossTileID=0;this.usedCrossTileIDs[t.overscaledZ]||(this.usedCrossTileIDs[t.overscaledZ]={});const v=this.usedCrossTileIDs[t.overscaledZ];for(const b in this.indexes){const S=this.indexes[b];if(Number(b)>t.overscaledZ)for(const k in S){const D=S[k];D.tileID.isChildOf(t)&&D.findMatches(a.symbolInstances,t,v)}else{const k=S[t.scaledTo(Number(b)).key];k&&k.findMatches(a.symbolInstances,t,v)}}for(let b=0;b<a.symbolInstances.length;b++){const S=a.symbolInstances.get(b);S.crossTileID||(S.crossTileID=m.generate(),v[S.crossTileID]=!0)}return this.indexes[t.overscaledZ]===void 0&&(this.indexes[t.overscaledZ]={}),this.indexes[t.overscaledZ][t.key]=new ef(t,a.symbolInstances,a.bucketInstanceId),!0}removeBucketCrossTileIDs(t,a){for(const m in a.indexedSymbolInstances)for(const v of a.indexedSymbolInstances[m])delete this.usedCrossTileIDs[t][v.crossTileID]}removeStaleBuckets(t){let a=!1;for(const m in this.indexes){const v=this.indexes[m];for(const b in v)t[v[b].bucketInstanceId]||(this.removeBucketCrossTileIDs(m,v[b]),delete v[b],a=!0)}return a}}class Wu{constructor(){this.layerIndexes={},this.crossTileIDs=new tf,this.maxBucketInstanceId=0,this.bucketsInCurrentPlacement={}}addLayer(t,a,m,v){let b=this.layerIndexes[t.id];b===void 0&&(b=this.layerIndexes[t.id]=new dc);let S=!1;const k={};v.name!=="globe"&&b.handleWrapJump(m);for(const D of a){const O=D.getBucket(t);O&&t.id===O.layerIds[0]&&(O.bucketInstanceId||(O.bucketInstanceId=++this.maxBucketInstanceId),b.addBucket(D.tileID,O,this.crossTileIDs)&&(S=!0),k[O.bucketInstanceId]=!0)}return b.removeStaleBuckets(k)&&(S=!0),S}pruneUnusedLayers(t){const a={};t.forEach(m=>{a[m]=!0});for(const m in this.layerIndexes)a[m]||delete this.layerIndexes[m]}}const aa=(p,t)=>n.emitValidationErrors(p,t&&t.filter(a=>a.identifier!=="source.canvas")),rf=n.pick(ke,["addLayer","removeLayer","setPaintProperty","setLayoutProperty","setFilter","addSource","removeSource","setLayerZoomRange","setLight","setTransition","setGeoJSONSourceData","setTerrain","setFog","setProjection"]),Xu=n.pick(ke,["setCenter","setZoom","setBearing","setPitch"]),nf={version:8,layers:[],sources:{}},mc={fill:!0,line:!0,background:!0,hillshade:!0,raster:!0};class wn extends n.Evented{constructor(t,a={}){super(),this.map=t,this.dispatcher=new Yt(Ti(),this),this.imageManager=new Ge,this.imageManager.setEventedParent(this),this.glyphManager=new n.GlyphManager(t._requestManager,a.localFontFamily?n.LocalGlyphMode.all:a.localIdeographFontFamily?n.LocalGlyphMode.ideographs:n.LocalGlyphMode.none,a.localFontFamily||a.localIdeographFontFamily),this.lineAtlas=new n.LineAtlas(256,512),this.crossTileSymbolIndex=new Wu,this._layers={},this._num3DLayers=0,this._numSymbolLayers=0,this._numCircleLayers=0,this._serializedLayers={},this._sourceCaches={},this._otherSourceCaches={},this._symbolSourceCaches={},this.zoomHistory=new n.ZoomHistory,this._loaded=!1,this._availableImages=[],this._order=[],this._drapedFirstOrder=[],this._markersNeedUpdate=!1,this._resetUpdates(),this.dispatcher.broadcast("setReferrer",n.getReferrer());const m=this;this._rtlTextPluginCallback=wn.registerForPluginStateChange(v=>{m.dispatcher.broadcast("syncRTLPluginState",{pluginStatus:v.pluginStatus,pluginURL:v.pluginURL},(b,S)=>{if(n.triggerPluginCompletionEvent(b),S&&S.every(k=>k))for(const k in m._sourceCaches){const D=m._sourceCaches[k],O=D.getSource().type;O!=="vector"&&O!=="geojson"||D.reload()}})}),this.on("data",v=>{if(v.dataType!=="source"||v.sourceDataType!=="metadata")return;const b=this.getSource(v.sourceId);if(b&&b.vectorLayerIds)for(const S in this._layers){const k=this._layers[S];k.source===b.id&&this._validateLayer(k)}})}loadURL(t,a={}){this.fire(new n.Event("dataloading",{dataType:"style"}));const m=typeof a.validate=="boolean"?a.validate:!n.isMapboxURL(t);t=this.map._requestManager.normalizeStyleURL(t,a.accessToken);const v=this.map._requestManager.transformRequest(t,n.ResourceType.Style);this._request=n.getJSON(v,(b,S)=>{this._request=null,b?this.fire(new n.ErrorEvent(b)):S&&this._load(S,m)})}loadJSON(t,a={}){this.fire(new n.Event("dataloading",{dataType:"style"})),this._request=n.exported.frame(()=>{this._request=null,this._load(t,a.validate!==!1)})}loadEmpty(){this.fire(new n.Event("dataloading",{dataType:"style"})),this._load(nf,!1)}_updateLayerCount(t,a){const m=a?1:-1;t.is3D()&&(this._num3DLayers+=m),t.type==="circle"&&(this._numCircleLayers+=m),t.type==="symbol"&&(this._numSymbolLayers+=m)}_load(t,a){if(a&&aa(this,n.validateStyle(t)))return;this._loaded=!0,this.stylesheet=n.clone$1(t),this._updateMapProjection();for(const v in t.sources)this.addSource(v,t.sources[v],{validate:!1});this._changed=!1,t.sprite?this._loadSprite(t.sprite):(this.imageManager.setLoaded(!0),this.dispatcher.broadcast("spriteLoaded",!0)),this.glyphManager.setURL(t.glyphs);const m=ki(this.stylesheet.layers);this._order=m.map(v=>v.id),this._layers={},this._serializedLayers={};for(let v of m)v=n.createStyleLayer(v),v.setEventedParent(this,{layer:{id:v.id}}),this._layers[v.id]=v,this._serializedLayers[v.id]=v.serialize(),this._updateLayerCount(v,!0);this.dispatcher.broadcast("setLayers",this._serializeLayers(this._order)),this.light=new mt(this.stylesheet.light),this.stylesheet.terrain&&!this.terrainSetForDrapingOnly()&&this._createTerrain(this.stylesheet.terrain,1),this.stylesheet.fog&&this._createFog(this.stylesheet.fog),this._updateDrapeFirstLayers(),this.fire(new n.Event("data",{dataType:"style"})),this.fire(new n.Event("style.load"))}terrainSetForDrapingOnly(){return!!this.terrain&&this.terrain.drapeRenderMode===0}setProjection(t){t?this.stylesheet.projection=t:delete this.stylesheet.projection,this.map._explicitProjection||this.map._updateProjection()}_updateMapProjection(){this.map._explicitProjection?this.applyProjectionUpdate():this.map._updateProjection()}applyProjectionUpdate(){this._loaded&&(this.dispatcher.broadcast("setProjection",this.map.transform.projectionOptions),this.map.transform.projection.requiresDraping?this.getTerrain()||this.stylesheet.terrain||this.setTerrainForDraping():this.terrainSetForDrapingOnly()&&this.setTerrain(null))}_loadSprite(t){this._spriteRequest=function(a,m,v){let b,S,k;const D=n.exported.devicePixelRatio>1?"@2x":"";let O=n.getJSON(m.transformRequest(m.normalizeSpriteURL(a,D,".json"),n.ResourceType.SpriteJSON),(X,J)=>{O=null,k||(k=X,b=J,G())}),V=n.getImage(m.transformRequest(m.normalizeSpriteURL(a,D,".png"),n.ResourceType.SpriteImage),(X,J)=>{V=null,k||(k=X,S=J,G())});function G(){if(k)v(k);else if(b&&S){const X=n.exported.getImageData(S),J={};for(const ee in b){const{width:Y,height:pe,x:K,y:ne,sdf:oe,pixelRatio:ge,stretchX:he,stretchY:fe,content:be}=b[ee],Ve=new n.RGBAImage({width:Y,height:pe});n.RGBAImage.copy(X,Ve,{x:K,y:ne},{x:0,y:0},{width:Y,height:pe}),J[ee]={data:Ve,pixelRatio:ge,sdf:oe,stretchX:he,stretchY:fe,content:be}}v(null,J)}}return{cancel(){O&&(O.cancel(),O=null),V&&(V.cancel(),V=null)}}}(t,this.map._requestManager,(a,m)=>{if(this._spriteRequest=null,a)this.fire(new n.ErrorEvent(a));else if(m)for(const v in m)this.imageManager.addImage(v,m[v]);this.imageManager.setLoaded(!0),this._availableImages=this.imageManager.listImages(),this.dispatcher.broadcast("setImages",this._availableImages),this.dispatcher.broadcast("spriteLoaded",!0),this.fire(new n.Event("data",{dataType:"style"}))})}_validateLayer(t){const a=this.getSource(t.source);if(!a)return;const m=t.sourceLayer;m&&(a.type==="geojson"||a.vectorLayerIds&&a.vectorLayerIds.indexOf(m)===-1)&&this.fire(new n.ErrorEvent(new Error(`Source layer "${m}" does not exist on source "${a.id}" as specified by style layer "${t.id}"`)))}loaded(){if(!this._loaded||Object.keys(this._updatedSources).length)return!1;for(const t in this._sourceCaches)if(!this._sourceCaches[t].loaded())return!1;return!!this.imageManager.isLoaded()}_serializeLayers(t){const a=[];for(const m of t){const v=this._layers[m];v.type!=="custom"&&a.push(v.serialize())}return a}hasTransitions(){if(this.light&&this.light.hasTransition()||this.fog&&this.fog.hasTransition())return!0;for(const t in this._sourceCaches)if(this._sourceCaches[t].hasTransition())return!0;for(const t in this._layers)if(this._layers[t].hasTransition())return!0;return!1}get order(){return this.map._optimizeForTerrain&&this.terrain?this._drapedFirstOrder:this._order}isLayerDraped(t){return!!this.terrain&&mc[t.type]}_checkLoaded(){if(!this._loaded)throw new Error("Style is not done loading")}update(t){if(!this._loaded)return;const a=this._changed;if(this._changed){const v=Object.keys(this._updatedLayers),b=Object.keys(this._removedLayers);(v.length||b.length)&&this._updateWorkerLayers(v,b);for(const S in this._updatedSources){const k=this._updatedSources[S];k==="reload"?this._reloadSource(S):k==="clear"&&this._clearSource(S)}this._updateTilesForChangedImages();for(const S in this._updatedPaintProps)this._layers[S].updateTransitions(t);this.light.updateTransitions(t),this.fog&&this.fog.updateTransitions(t),this._resetUpdates()}const m={};for(const v in this._sourceCaches){const b=this._sourceCaches[v];m[v]=b.used,b.used=!1}for(const v of this._order){const b=this._layers[v];if(b.recalculate(t,this._availableImages),!b.isHidden(t.zoom)){const k=this._getLayerSourceCache(b);k&&(k.used=!0)}const S=this.map.painter;if(S){const k=b.getProgramIds();if(!k)continue;const D=b.getProgramConfiguration(t.zoom);for(const O of k)S.useProgram(O,D)}}for(const v in m){const b=this._sourceCaches[v];m[v]!==b.used&&b.getSource().fire(new n.Event("data",{sourceDataType:"visibility",dataType:"source",sourceId:b.getSource().id}))}this.light.recalculate(t),this.terrain&&this.terrain.recalculate(t),this.fog&&this.fog.recalculate(t),this.z=t.zoom,this._markersNeedUpdate&&(this._updateMarkersOpacity(),this._markersNeedUpdate=!1),a&&this.fire(new n.Event("data",{dataType:"style"}))}_updateTilesForChangedImages(){const t=Object.keys(this._changedImages);if(t.length){for(const a in this._sourceCaches)this._sourceCaches[a].reloadTilesForDependencies(["icons","patterns"],t);this._changedImages={}}}_updateWorkerLayers(t,a){this.dispatcher.broadcast("updateLayers",{layers:this._serializeLayers(t),removedIds:a})}_resetUpdates(){this._changed=!1,this._updatedLayers={},this._removedLayers={},this._updatedSources={},this._updatedPaintProps={},this._changedImages={}}setState(t){if(this._checkLoaded(),aa(this,n.validateStyle(t)))return!1;(t=n.clone$1(t)).layers=ki(t.layers);const a=function(v,b){if(!v)return[{command:ke.setStyle,args:[b]}];let S=[];try{if(!w(v.version,b.version))return[{command:ke.setStyle,args:[b]}];w(v.center,b.center)||S.push({command:ke.setCenter,args:[b.center]}),w(v.zoom,b.zoom)||S.push({command:ke.setZoom,args:[b.zoom]}),w(v.bearing,b.bearing)||S.push({command:ke.setBearing,args:[b.bearing]}),w(v.pitch,b.pitch)||S.push({command:ke.setPitch,args:[b.pitch]}),w(v.sprite,b.sprite)||S.push({command:ke.setSprite,args:[b.sprite]}),w(v.glyphs,b.glyphs)||S.push({command:ke.setGlyphs,args:[b.glyphs]}),w(v.transition,b.transition)||S.push({command:ke.setTransition,args:[b.transition]}),w(v.light,b.light)||S.push({command:ke.setLight,args:[b.light]}),w(v.fog,b.fog)||S.push({command:ke.setFog,args:[b.fog]}),w(v.projection,b.projection)||S.push({command:ke.setProjection,args:[b.projection]});const k={},D=[];(function(G,X,J,ee){let Y;for(Y in X=X||{},G=G||{})G.hasOwnProperty(Y)&&(X.hasOwnProperty(Y)||Hi(Y,J,ee));for(Y in X)X.hasOwnProperty(Y)&&(G.hasOwnProperty(Y)?w(G[Y],X[Y])||(G[Y].type==="geojson"&&X[Y].type==="geojson"&&Kp(G,X,Y)?J.push({command:ke.setGeoJSONSourceData,args:[Y,X[Y].data]}):on(Y,X,J,ee)):Jr(Y,X,J))})(v.sources,b.sources,D,k);const O=[];v.layers&&v.layers.forEach(G=>{G.source&&k[G.source]?S.push({command:ke.removeLayer,args:[G.id]}):O.push(G)});let V=v.terrain;V&&k[V.source]&&(S.push({command:ke.setTerrain,args:[void 0]}),V=void 0),S=S.concat(D),w(V,b.terrain)||S.push({command:ke.setTerrain,args:[b.terrain]}),function(G,X,J){X=X||[];const ee=(G=G||[]).map(Qa),Y=X.map(Qa),pe=G.reduce(Gu,{}),K=X.reduce(Gu,{}),ne=ee.slice(),oe=Object.create(null);let ge,he,fe,be,Ve,Ze,je;for(ge=0,he=0;ge<ee.length;ge++)fe=ee[ge],K.hasOwnProperty(fe)?he++:(J.push({command:ke.removeLayer,args:[fe]}),ne.splice(ne.indexOf(fe,he),1));for(ge=0,he=0;ge<Y.length;ge++)fe=Y[Y.length-1-ge],ne[ne.length-1-ge]!==fe&&(pe.hasOwnProperty(fe)?(J.push({command:ke.removeLayer,args:[fe]}),ne.splice(ne.lastIndexOf(fe,ne.length-he),1)):he++,Ze=ne[ne.length-ge],J.push({command:ke.addLayer,args:[K[fe],Ze]}),ne.splice(ne.length-ge,0,fe),oe[fe]=!0);for(ge=0;ge<Y.length;ge++)if(fe=Y[ge],be=pe[fe],Ve=K[fe],!oe[fe]&&!w(be,Ve))if(w(be.source,Ve.source)&&w(be["source-layer"],Ve["source-layer"])&&w(be.type,Ve.type)){for(je in Qr(be.layout,Ve.layout,J,fe,null,ke.setLayoutProperty),Qr(be.paint,Ve.paint,J,fe,null,ke.setPaintProperty),w(be.filter,Ve.filter)||J.push({command:ke.setFilter,args:[fe,Ve.filter]}),w(be.minzoom,Ve.minzoom)&&w(be.maxzoom,Ve.maxzoom)||J.push({command:ke.setLayerZoomRange,args:[fe,Ve.minzoom,Ve.maxzoom]}),be)be.hasOwnProperty(je)&&je!=="layout"&&je!=="paint"&&je!=="filter"&&je!=="metadata"&&je!=="minzoom"&&je!=="maxzoom"&&(je.indexOf("paint.")===0?Qr(be[je],Ve[je],J,fe,je.slice(6),ke.setPaintProperty):w(be[je],Ve[je])||J.push({command:ke.setLayerProperty,args:[fe,je,Ve[je]]}));for(je in Ve)Ve.hasOwnProperty(je)&&!be.hasOwnProperty(je)&&je!=="layout"&&je!=="paint"&&je!=="filter"&&je!=="metadata"&&je!=="minzoom"&&je!=="maxzoom"&&(je.indexOf("paint.")===0?Qr(be[je],Ve[je],J,fe,je.slice(6),ke.setPaintProperty):w(be[je],Ve[je])||J.push({command:ke.setLayerProperty,args:[fe,je,Ve[je]]}))}else J.push({command:ke.removeLayer,args:[fe]}),Ze=ne[ne.lastIndexOf(fe)+1],J.push({command:ke.addLayer,args:[Ve,Ze]})}(O,b.layers,S)}catch(k){console.warn("Unable to compute style diff:",k),S=[{command:ke.setStyle,args:[b]}]}return S}(this.serialize(),t).filter(v=>!(v.command in Xu));if(a.length===0)return!1;const m=a.filter(v=>!(v.command in rf));if(m.length>0)throw new Error(`Unimplemented: ${m.map(v=>v.command).join(", ")}.`);return a.forEach(v=>{v.command!=="setTransition"&&this[v.command].apply(this,v.args)}),this.stylesheet=t,this._updateMapProjection(),!0}addImage(t,a){return this.getImage(t)?this.fire(new n.ErrorEvent(new Error("An image with this name already exists."))):(this.imageManager.addImage(t,a),this._afterImageUpdated(t),this)}updateImage(t,a){this.imageManager.updateImage(t,a)}getImage(t){return this.imageManager.getImage(t)}removeImage(t){return this.getImage(t)?(this.imageManager.removeImage(t),this._afterImageUpdated(t),this):this.fire(new n.ErrorEvent(new Error("No image with this name exists.")))}_afterImageUpdated(t){this._availableImages=this.imageManager.listImages(),this._changedImages[t]=!0,this._changed=!0,this.dispatcher.broadcast("setImages",this._availableImages),this.fire(new n.Event("data",{dataType:"style"}))}listImages(){return this._checkLoaded(),this._availableImages.slice()}addSource(t,a,m={}){if(this._checkLoaded(),this.getSource(t)!==void 0)throw new Error("There is already a source with this ID");if(!a.type)throw new Error(`The type property must be defined, but only the following properties were given: ${Object.keys(a).join(", ")}.`);if(["vector","raster","geojson","video","image"].indexOf(a.type)>=0&&this._validate(n.validateSource,`sources.${t}`,a,null,m))return;this.map&&this.map._collectResourceTiming&&(a.collectResourceTiming=!0);const v=Re(t,a,this.dispatcher,this);v.setEventedParent(this,()=>({isSourceLoaded:this._isSourceCacheLoaded(t),source:v.serialize(),sourceId:t}));const b=S=>{const k=(S?"symbol:":"other:")+t,D=this._sourceCaches[k]=new n.SourceCache(k,v,S);(S?this._symbolSourceCaches:this._otherSourceCaches)[t]=D,D.style=this,D.onAdd(this.map)};b(!1),a.type!=="vector"&&a.type!=="geojson"||b(!0),v.onAdd&&v.onAdd(this.map),this._changed=!0}removeSource(t){this._checkLoaded();const a=this.getSource(t);if(!a)throw new Error("There is no source with this ID");for(const v in this._layers)if(this._layers[v].source===t)return this.fire(new n.ErrorEvent(new Error(`Source "${t}" cannot be removed while layer "${v}" is using it.`)));if(this.terrain&&this.terrain.get().source===t)return this.fire(new n.ErrorEvent(new Error(`Source "${t}" cannot be removed while terrain is using it.`)));const m=this._getSourceCaches(t);for(const v of m)delete this._sourceCaches[v.id],delete this._updatedSources[v.id],v.fire(new n.Event("data",{sourceDataType:"metadata",dataType:"source",sourceId:v.getSource().id})),v.setEventedParent(null),v.clearTiles();return delete this._otherSourceCaches[t],delete this._symbolSourceCaches[t],a.setEventedParent(null),a.onRemove&&a.onRemove(this.map),this._changed=!0,this}setGeoJSONSourceData(t,a){this._checkLoaded(),this.getSource(t).setData(a),this._changed=!0}getSource(t){const a=this._getSourceCache(t);return a&&a.getSource()}addLayer(t,a,m={}){this._checkLoaded();const v=t.id;if(this.getLayer(v))return void this.fire(new n.ErrorEvent(new Error(`Layer with id "${v}" already exists on this map`)));let b;if(t.type==="custom"){if(aa(this,n.validateCustomStyleLayer(t)))return;b=n.createStyleLayer(t)}else{if(typeof t.source=="object"&&(this.addSource(v,t.source),t=n.clone$1(t),t=n.extend(t,{source:v})),this._validate(n.validateLayer,`layers.${v}`,t,{arrayIndex:-1},m))return;b=n.createStyleLayer(t),this._validateLayer(b),b.setEventedParent(this,{layer:{id:v}}),this._serializedLayers[b.id]=b.serialize(),this._updateLayerCount(b,!0)}const S=a?this._order.indexOf(a):this._order.length;if(a&&S===-1)return void this.fire(new n.ErrorEvent(new Error(`Layer with id "${a}" does not exist on this map.`)));this._order.splice(S,0,v),this._layerOrderChanged=!0,this._layers[v]=b;const k=this._getLayerSourceCache(b);if(this._removedLayers[v]&&b.source&&k&&b.type!=="custom"){const D=this._removedLayers[v];delete this._removedLayers[v],D.type!==b.type?this._updatedSources[b.source]="clear":(this._updatedSources[b.source]="reload",k.pause())}this._updateLayer(b),b.onAdd&&b.onAdd(this.map),this._updateDrapeFirstLayers()}moveLayer(t,a){if(this._checkLoaded(),this._changed=!0,!this._layers[t])return void this.fire(new n.ErrorEvent(new Error(`The layer '${t}' does not exist in the map's style and cannot be moved.`)));if(t===a)return;const m=this._order.indexOf(t);this._order.splice(m,1);const v=a?this._order.indexOf(a):this._order.length;a&&v===-1?this.fire(new n.ErrorEvent(new Error(`Layer with id "${a}" does not exist on this map.`))):(this._order.splice(v,0,t),this._layerOrderChanged=!0,this._updateDrapeFirstLayers())}removeLayer(t){this._checkLoaded();const a=this._layers[t];if(!a)return void this.fire(new n.ErrorEvent(new Error(`The layer '${t}' does not exist in the map's style and cannot be removed.`)));a.setEventedParent(null),this._updateLayerCount(a,!1);const m=this._order.indexOf(t);this._order.splice(m,1),this._layerOrderChanged=!0,this._changed=!0,this._removedLayers[t]=a,delete this._layers[t],delete this._serializedLayers[t],delete this._updatedLayers[t],delete this._updatedPaintProps[t],a.onRemove&&a.onRemove(this.map),this._updateDrapeFirstLayers()}getLayer(t){return this._layers[t]}hasLayer(t){return t in this._layers}hasLayerType(t){for(const a in this._layers)if(this._layers[a].type===t)return!0;return!1}setLayerZoomRange(t,a,m){this._checkLoaded();const v=this.getLayer(t);v?v.minzoom===a&&v.maxzoom===m||(a!=null&&(v.minzoom=a),m!=null&&(v.maxzoom=m),this._updateLayer(v)):this.fire(new n.ErrorEvent(new Error(`The layer '${t}' does not exist in the map's style and cannot have zoom extent.`)))}setFilter(t,a,m={}){this._checkLoaded();const v=this.getLayer(t);if(v){if(!w(v.filter,a))return a==null?(v.filter=void 0,void this._updateLayer(v)):void(this._validate(n.validateFilter,`layers.${v.id}.filter`,a,{layerType:v.type},m)||(v.filter=n.clone$1(a),this._updateLayer(v)))}else this.fire(new n.ErrorEvent(new Error(`The layer '${t}' does not exist in the map's style and cannot be filtered.`)))}getFilter(t){const a=this.getLayer(t);return a&&n.clone$1(a.filter)}setLayoutProperty(t,a,m,v={}){this._checkLoaded();const b=this.getLayer(t);b?w(b.getLayoutProperty(a),m)||(b.setLayoutProperty(a,m,v),this._updateLayer(b)):this.fire(new n.ErrorEvent(new Error(`The layer '${t}' does not exist in the map's style and cannot be styled.`)))}getLayoutProperty(t,a){const m=this.getLayer(t);if(m)return m.getLayoutProperty(a);this.fire(new n.ErrorEvent(new Error(`The layer '${t}' does not exist in the map's style.`)))}setPaintProperty(t,a,m,v={}){this._checkLoaded();const b=this.getLayer(t);b?w(b.getPaintProperty(a),m)||(b.setPaintProperty(a,m,v)&&this._updateLayer(b),this._changed=!0,this._updatedPaintProps[t]=!0):this.fire(new n.ErrorEvent(new Error(`The layer '${t}' does not exist in the map's style and cannot be styled.`)))}getPaintProperty(t,a){const m=this.getLayer(t);return m&&m.getPaintProperty(a)}setFeatureState(t,a){this._checkLoaded();const m=t.source,v=t.sourceLayer,b=this.getSource(m);if(!b)return void this.fire(new n.ErrorEvent(new Error(`The source '${m}' does not exist in the map's style.`)));const S=b.type;if(S==="geojson"&&v)return void this.fire(new n.ErrorEvent(new Error("GeoJSON sources cannot have a sourceLayer parameter.")));if(S==="vector"&&!v)return void this.fire(new n.ErrorEvent(new Error("The sourceLayer parameter must be provided for vector source types.")));t.id===void 0&&this.fire(new n.ErrorEvent(new Error("The feature id parameter must be provided.")));const k=this._getSourceCaches(m);for(const D of k)D.setFeatureState(v,t.id,a)}removeFeatureState(t,a){this._checkLoaded();const m=t.source,v=this.getSource(m);if(!v)return void this.fire(new n.ErrorEvent(new Error(`The source '${m}' does not exist in the map's style.`)));const b=v.type,S=b==="vector"?t.sourceLayer:void 0;if(b==="vector"&&!S)return void this.fire(new n.ErrorEvent(new Error("The sourceLayer parameter must be provided for vector source types.")));if(a&&typeof t.id!="string"&&typeof t.id!="number")return void this.fire(new n.ErrorEvent(new Error("A feature id is required to remove its specific state property.")));const k=this._getSourceCaches(m);for(const D of k)D.removeFeatureState(S,t.id,a)}getFeatureState(t){this._checkLoaded();const a=t.source,m=t.sourceLayer,v=this.getSource(a);if(v){if(v.type!=="vector"||m)return t.id===void 0&&this.fire(new n.ErrorEvent(new Error("The feature id parameter must be provided."))),this._getSourceCaches(a)[0].getFeatureState(m,t.id);this.fire(new n.ErrorEvent(new Error("The sourceLayer parameter must be provided for vector source types.")))}else this.fire(new n.ErrorEvent(new Error(`The source '${a}' does not exist in the map's style.`)))}getTransition(){return n.extend({duration:300,delay:0},this.stylesheet&&this.stylesheet.transition)}serialize(){const t={};for(const a in this._sourceCaches){const m=this._sourceCaches[a].getSource();t[m.id]||(t[m.id]=m.serialize())}return n.filterObject({version:this.stylesheet.version,name:this.stylesheet.name,metadata:this.stylesheet.metadata,light:this.stylesheet.light,terrain:this.stylesheet.terrain,fog:this.stylesheet.fog,center:this.stylesheet.center,zoom:this.stylesheet.zoom,bearing:this.stylesheet.bearing,pitch:this.stylesheet.pitch,sprite:this.stylesheet.sprite,glyphs:this.stylesheet.glyphs,transition:this.stylesheet.transition,projection:this.stylesheet.projection,sources:t,layers:this._serializeLayers(this._order)},a=>a!==void 0)}_updateLayer(t){this._updatedLayers[t.id]=!0;const a=this._getLayerSourceCache(t);t.source&&!this._updatedSources[t.source]&&a&&a.getSource().type!=="raster"&&(this._updatedSources[t.source]="reload",a.pause()),this._changed=!0,t.invalidateCompiledFilter()}_flattenAndSortRenderedFeatures(t){const a=S=>this._layers[S].type==="fill-extrusion",m={},v=[];for(let S=this._order.length-1;S>=0;S--){const k=this._order[S];if(a(k)){m[k]=S;for(const D of t){const O=D[k];if(O)for(const V of O)v.push(V)}}}v.sort((S,k)=>k.intersectionZ-S.intersectionZ);const b=[];for(let S=this._order.length-1;S>=0;S--){const k=this._order[S];if(a(k))for(let D=v.length-1;D>=0;D--){const O=v[D].feature;if(m[O.layer.id]<S)break;b.push(O),v.pop()}else for(const D of t){const O=D[k];if(O)for(const V of O)b.push(V.feature)}}return b}queryRenderedFeatures(t,a,m){a&&a.filter&&this._validate(n.validateFilter,"queryRenderedFeatures.filter",a.filter,null,a);const v={};if(a&&a.layers){if(!Array.isArray(a.layers))return this.fire(new n.ErrorEvent(new Error("parameters.layers must be an Array."))),[];for(const D of a.layers){const O=this._layers[D];if(!O)return this.fire(new n.ErrorEvent(new Error(`The layer '${D}' does not exist in the map's style and cannot be queried for features.`))),[];v[O.source]=!0}}const b=[];a.availableImages=this._availableImages;const S=a&&a.layers?a.layers.some(D=>{const O=this.getLayer(D);return O&&O.is3D()}):this.has3DLayers(),k=Zt.createFromScreenPoints(t,m);for(const D in this._sourceCaches){const O=this._sourceCaches[D].getSource().id;a.layers&&!v[O]||b.push(It(this._sourceCaches[D],this._layers,this._serializedLayers,k,a,m,S,!!this.map._showQueryGeometry))}return this.placement&&b.push(function(D,O,V,G,X,J,ee){const Y={},pe=J.queryRenderedSymbols(G),K=[];for(const ne of Object.keys(pe).map(Number))K.push(ee[ne]);K.sort(Nt);for(const ne of K){const oe=ne.featureIndex.lookupSymbolFeatures(pe[ne.bucketInstanceId],O,ne.bucketIndex,ne.sourceLayerIndex,X.filter,X.layers,X.availableImages,D);for(const ge in oe){const he=Y[ge]=Y[ge]||[],fe=oe[ge];fe.sort((be,Ve)=>{const Ze=ne.featureSortOrder;if(Ze){const je=Ze.indexOf(be.featureIndex);return Ze.indexOf(Ve.featureIndex)-je}return Ve.featureIndex-be.featureIndex});for(const be of fe)he.push(be)}}for(const ne in Y)Y[ne].forEach(oe=>{const ge=oe.feature,he=V(D[ne]).getFeatureState(ge.layer["source-layer"],ge.id);ge.source=ge.layer.source,ge.layer["source-layer"]&&(ge.sourceLayer=ge.layer["source-layer"]),ge.state=he});return Y}(this._layers,this._serializedLayers,this._getLayerSourceCache.bind(this),k.screenGeometry,a,this.placement.collisionIndex,this.placement.retainedQueryData)),this._flattenAndSortRenderedFeatures(b)}querySourceFeatures(t,a){a&&a.filter&&this._validate(n.validateFilter,"querySourceFeatures.filter",a.filter,null,a);const m=this._getSourceCaches(t);let v=[];for(const b of m)v=v.concat(st(b,a));return v}addSourceType(t,a,m){return wn.getSourceType(t)?m(new Error(`A source type called "${t}" already exists.`)):(wn.setSourceType(t,a),a.workerSourceURL?void this.dispatcher.broadcast("loadWorkerSource",{name:t,url:a.workerSourceURL},m):m(null,null))}getLight(){return this.light.getLight()}setLight(t,a={}){this._checkLoaded();const m=this.light.getLight();let v=!1;for(const S in t)if(!w(t[S],m[S])){v=!0;break}if(!v)return;const b=this._setTransitionParameters({duration:300,delay:0});this.light.setLight(t,a),this.light.updateTransitions(b)}getTerrain(){return this.terrain&&this.terrain.drapeRenderMode===1?this.terrain.get():null}setTerrainForDraping(){this.setTerrain({source:"",exaggeration:0},0)}setTerrain(t,a=1){if(this._checkLoaded(),!t)return delete this.terrain,delete this.stylesheet.terrain,this.dispatcher.broadcast("enableTerrain",!1),this._force3DLayerUpdate(),void(this._markersNeedUpdate=!0);if(a===1){if(typeof t.source=="object"){const m="terrain-dem-src";this.addSource(m,t.source),t=n.clone$1(t),t=n.extend(t,{source:m})}if(this._validate(n.validateTerrain,"terrain",t))return}if(!this.terrain||this.terrain&&a!==this.terrain.drapeRenderMode)this._createTerrain(t,a);else{const m=this.terrain,v=m.get();for(const b of Object.keys(n.spec.terrain))!t.hasOwnProperty(b)&&n.spec.terrain[b].default&&(t[b]=n.spec.terrain[b].default);for(const b in t)if(!w(t[b],v[b])){m.set(t),this.stylesheet.terrain=t;const S=this._setTransitionParameters({duration:0});m.updateTransitions(S);break}}this._updateDrapeFirstLayers(),this._markersNeedUpdate=!0}_createFog(t){const a=this.fog=new Kt(t,this.map.transform);this.stylesheet.fog=t;const m=this._setTransitionParameters({duration:0});a.updateTransitions(m)}_updateMarkersOpacity(){this.map._markers.length!==0&&this.map._requestDomTask(()=>{for(const t of this.map._markers)t._evaluateOpacity()})}getFog(){return this.fog?this.fog.get():null}setFog(t){if(this._checkLoaded(),!t)return delete this.fog,delete this.stylesheet.fog,void(this._markersNeedUpdate=!0);if(this.fog){const a=this.fog,m=a.get();Object.keys(t).length===0&&a.set(t);for(const v in t)if(!w(t[v],m[v])){a.set(t),this.stylesheet.fog=t;const b=this._setTransitionParameters({duration:0});a.updateTransitions(b);break}}else this._createFog(t);this._markersNeedUpdate=!0}_setTransitionParameters(t){return{now:n.exported.now(),transition:n.extend(t,this.stylesheet.transition)}}_updateDrapeFirstLayers(){if(!this.map._optimizeForTerrain||!this.terrain)return;const t=this._order.filter(m=>this.isLayerDraped(this._layers[m])),a=this._order.filter(m=>!this.isLayerDraped(this._layers[m]));this._drapedFirstOrder=[],this._drapedFirstOrder.push(...t),this._drapedFirstOrder.push(...a)}_createTerrain(t,a){const m=this.terrain=new $t(t,a);this.stylesheet.terrain=t,this.dispatcher.broadcast("enableTerrain",!this.terrainSetForDrapingOnly()),this._force3DLayerUpdate();const v=this._setTransitionParameters({duration:0});m.updateTransitions(v)}_force3DLayerUpdate(){for(const t in this._layers){const a=this._layers[t];a.type==="fill-extrusion"&&this._updateLayer(a)}}_forceSymbolLayerUpdate(){for(const t in this._layers){const a=this._layers[t];a.type==="symbol"&&this._updateLayer(a)}}_validate(t,a,m,v,b={}){return(!b||b.validate!==!1)&&aa(this,t.call(n.validateStyle,n.extend({key:a,style:this.serialize(),value:m,styleSpec:n.spec},v)))}_remove(){this._request&&(this._request.cancel(),this._request=null),this._spriteRequest&&(this._spriteRequest.cancel(),this._spriteRequest=null),n.evented.off("pluginStateChange",this._rtlTextPluginCallback);for(const t in this._layers)this._layers[t].setEventedParent(null);for(const t in this._sourceCaches)this._sourceCaches[t].clearTiles(),this._sourceCaches[t].setEventedParent(null);this.imageManager.setEventedParent(null),this.setEventedParent(null),this.dispatcher.remove()}_clearSource(t){const a=this._getSourceCaches(t);for(const m of a)m.clearTiles()}_reloadSource(t){const a=this._getSourceCaches(t);for(const m of a)m.resume(),m.reload()}_updateSources(t){for(const a in this._sourceCaches)this._sourceCaches[a].update(t)}_generateCollisionBoxes(){for(const t in this._sourceCaches){const a=this._sourceCaches[t];a.resume(),a.reload()}}_updatePlacement(t,a,m,v,b=!1){let S=!1,k=!1;const D={};for(const O of this._order){const V=this._layers[O];if(V.type!=="symbol")continue;if(!D[V.source]){const X=this._getLayerSourceCache(V);if(!X)continue;D[V.source]=X.getRenderableIds(!0).map(J=>X.getTileByID(J)).sort((J,ee)=>ee.tileID.overscaledZ-J.tileID.overscaledZ||(J.tileID.isLessThan(ee.tileID)?-1:1))}const G=this.crossTileSymbolIndex.addLayer(V,D[V.source],t.center.lng,t.projection);S=S||G}if(this.crossTileSymbolIndex.pruneUnusedLayers(this._order),b=b||this._layerOrderChanged||m===0,this._layerOrderChanged&&this.fire(new n.Event("neworder")),(b||!this.pauseablePlacement||this.pauseablePlacement.isDone()&&!this.placement.stillRecent(n.exported.now(),t.zoom))&&(this.pauseablePlacement=new fc(t,this._order,b,a,m,v,this.placement,this.fog&&t.projection.supportsFog?this.fog.state:null),this._layerOrderChanged=!1),this.pauseablePlacement.isDone()?this.placement.setStale():(this.pauseablePlacement.continuePlacement(this._order,this._layers,D),this.pauseablePlacement.isDone()&&(this.placement=this.pauseablePlacement.commit(n.exported.now()),k=!0),S&&this.pauseablePlacement.placement.setStale()),k||S)for(const O of this._order){const V=this._layers[O];V.type==="symbol"&&this.placement.updateLayerOpacities(V,D[V.source])}return!this.pauseablePlacement.isDone()||this.placement.hasTransitions(n.exported.now())}_releaseSymbolFadeTiles(){for(const t in this._sourceCaches)this._sourceCaches[t].releaseSymbolFadeTiles()}getImages(t,a,m){this.imageManager.getImages(a.icons,m),this._updateTilesForChangedImages();const v=b=>{b&&b.setDependencies(a.tileID.key,a.type,a.icons)};v(this._otherSourceCaches[a.source]),v(this._symbolSourceCaches[a.source])}getGlyphs(t,a,m){this.glyphManager.getGlyphs(a.stacks,m)}getResource(t,a,m){return n.makeRequest(a,m)}_getSourceCache(t){return this._otherSourceCaches[t]}_getLayerSourceCache(t){return t.type==="symbol"?this._symbolSourceCaches[t.source]:this._otherSourceCaches[t.source]}_getSourceCaches(t){const a=[];return this._otherSourceCaches[t]&&a.push(this._otherSourceCaches[t]),this._symbolSourceCaches[t]&&a.push(this._symbolSourceCaches[t]),a}_isSourceCacheLoaded(t){const a=this._getSourceCaches(t);return a.length===0?(this.fire(new n.ErrorEvent(new Error(`There is no source with ID '${t}'`))),!1):a.every(m=>m.loaded())}has3DLayers(){return this._num3DLayers>0}hasSymbolLayers(){return this._numSymbolLayers>0}hasCircleLayers(){return this._numCircleLayers>0}_clearWorkerCaches(){this.dispatcher.broadcast("clearCaches")}destroy(){this._clearWorkerCaches(),this.terrainSetForDrapingOnly()&&(delete this.terrain,delete this.stylesheet.terrain)}}wn.getSourceType=function(p){return Te[p]},wn.setSourceType=function(p,t){Te[p]=t},wn.registerForPluginStateChange=n.registerForPluginStateChange;var _c=`
#define EPSILON 0.0000001
#define PI 3.141592653589793
#define EXTENT 8192.0
#define HALF_PI PI/2.0
#define QUARTER_PI PI/4.0
#define RAD_TO_DEG 180.0/PI
#define DEG_TO_RAD PI/180.0
#define GLOBE_RADIUS EXTENT/PI/2.0`,gc="attribute highp vec3 a_pos_3f;uniform lowp mat4 u_matrix;varying highp vec3 v_uv;void main() {const mat3 half_neg_pi_around_x=mat3(1.0,0.0, 0.0,0.0,0.0,-1.0,0.0,1.0, 0.0);v_uv=half_neg_pi_around_x*a_pos_3f;vec4 pos=u_matrix*vec4(a_pos_3f,1.0);gl_Position=pos.xyww;}";let la={},eo={};la=Ai("",`
#define ELEVATION_SCALE 7.0
#define ELEVATION_OFFSET 450.0
#ifdef PROJECTION_GLOBE_VIEW
uniform vec3 u_tile_tl_up;uniform vec3 u_tile_tr_up;uniform vec3 u_tile_br_up;uniform vec3 u_tile_bl_up;uniform float u_tile_up_scale;vec3 elevationVector(vec2 pos) {vec2 uv=pos/EXTENT;vec3 up=normalize(mix(
mix(u_tile_tl_up,u_tile_tr_up,uv.xxx),mix(u_tile_bl_up,u_tile_br_up,uv.xxx),uv.yyy));return up*u_tile_up_scale;}
#else
vec3 elevationVector(vec2 pos) { return vec3(0,0,1); }
#endif
#ifdef TERRAIN
#ifdef TERRAIN_DEM_FLOAT_FORMAT
uniform highp sampler2D u_dem;uniform highp sampler2D u_dem_prev;
#else
uniform sampler2D u_dem;uniform sampler2D u_dem_prev;
#endif
uniform vec4 u_dem_unpack;uniform vec2 u_dem_tl;uniform vec2 u_dem_tl_prev;uniform float u_dem_scale;uniform float u_dem_scale_prev;uniform float u_dem_size;uniform float u_dem_lerp;uniform float u_exaggeration;uniform float u_meter_to_dem;uniform mat4 u_label_plane_matrix_inv;uniform sampler2D u_depth;uniform vec2 u_depth_size_inv;vec4 tileUvToDemSample(vec2 uv,float dem_size,float dem_scale,vec2 dem_tl) {vec2 pos=dem_size*(uv*dem_scale+dem_tl)+1.0;vec2 f=fract(pos);return vec4((pos-f+0.5)/(dem_size+2.0),f);}float decodeElevation(vec4 v) {return dot(vec4(v.xyz*255.0,-1.0),u_dem_unpack);}float currentElevation(vec2 apos) {
#ifdef TERRAIN_DEM_FLOAT_FORMAT
vec2 pos=(u_dem_size*(apos/8192.0*u_dem_scale+u_dem_tl)+1.5)/(u_dem_size+2.0);return u_exaggeration*texture2D(u_dem,pos).a;
#else
float dd=1.0/(u_dem_size+2.0);vec4 r=tileUvToDemSample(apos/8192.0,u_dem_size,u_dem_scale,u_dem_tl);vec2 pos=r.xy;vec2 f=r.zw;float tl=decodeElevation(texture2D(u_dem,pos));
#ifdef TERRAIN_DEM_NEAREST_FILTER
return u_exaggeration*tl;
#endif
float tr=decodeElevation(texture2D(u_dem,pos+vec2(dd,0.0)));float bl=decodeElevation(texture2D(u_dem,pos+vec2(0.0,dd)));float br=decodeElevation(texture2D(u_dem,pos+vec2(dd,dd)));return u_exaggeration*mix(mix(tl,tr,f.x),mix(bl,br,f.x),f.y);
#endif
}float prevElevation(vec2 apos) {
#ifdef TERRAIN_DEM_FLOAT_FORMAT
vec2 pos=(u_dem_size*(apos/8192.0*u_dem_scale_prev+u_dem_tl_prev)+1.5)/(u_dem_size+2.0);return u_exaggeration*texture2D(u_dem_prev,pos).a;
#else
float dd=1.0/(u_dem_size+2.0);vec4 r=tileUvToDemSample(apos/8192.0,u_dem_size,u_dem_scale_prev,u_dem_tl_prev);vec2 pos=r.xy;vec2 f=r.zw;float tl=decodeElevation(texture2D(u_dem_prev,pos));float tr=decodeElevation(texture2D(u_dem_prev,pos+vec2(dd,0.0)));float bl=decodeElevation(texture2D(u_dem_prev,pos+vec2(0.0,dd)));float br=decodeElevation(texture2D(u_dem_prev,pos+vec2(dd,dd)));return u_exaggeration*mix(mix(tl,tr,f.x),mix(bl,br,f.x),f.y);
#endif
}
#ifdef TERRAIN_VERTEX_MORPHING
float elevation(vec2 apos) {float nextElevation=currentElevation(apos);float prevElevation=prevElevation(apos);return mix(prevElevation,nextElevation,u_dem_lerp);}
#else
float elevation(vec2 apos) {return currentElevation(apos);}
#endif
float unpack_depth(vec4 rgba_depth)
{const vec4 bit_shift=vec4(1.0/(256.0*256.0*256.0),1.0/(256.0*256.0),1.0/256.0,1.0);return dot(rgba_depth,bit_shift)*2.0-1.0;}bool isOccluded(vec4 frag) {vec3 coord=frag.xyz/frag.w;float depth=unpack_depth(texture2D(u_depth,(coord.xy+1.0)*0.5));return coord.z > depth+0.0005;}float occlusionFade(vec4 frag) {vec3 coord=frag.xyz/frag.w;vec3 df=vec3(5.0*u_depth_size_inv,0.0);vec2 uv=0.5*coord.xy+0.5;vec4 depth=vec4(
unpack_depth(texture2D(u_depth,uv-df.xz)),unpack_depth(texture2D(u_depth,uv+df.xz)),unpack_depth(texture2D(u_depth,uv-df.zy)),unpack_depth(texture2D(u_depth,uv+df.zy))
);return dot(vec4(0.25),vec4(1.0)-clamp(300.0*(vec4(coord.z-0.001)-depth),0.0,1.0));}vec4 fourSample(vec2 pos,vec2 off) {
#ifdef TERRAIN_DEM_FLOAT_FORMAT
float tl=texture2D(u_dem,pos).a;float tr=texture2D(u_dem,pos+vec2(off.x,0.0)).a;float bl=texture2D(u_dem,pos+vec2(0.0,off.y)).a;float br=texture2D(u_dem,pos+off).a;
#else
vec4 demtl=vec4(texture2D(u_dem,pos).xyz*255.0,-1.0);float tl=dot(demtl,u_dem_unpack);vec4 demtr=vec4(texture2D(u_dem,pos+vec2(off.x,0.0)).xyz*255.0,-1.0);float tr=dot(demtr,u_dem_unpack);vec4 dembl=vec4(texture2D(u_dem,pos+vec2(0.0,off.y)).xyz*255.0,-1.0);float bl=dot(dembl,u_dem_unpack);vec4 dembr=vec4(texture2D(u_dem,pos+off).xyz*255.0,-1.0);float br=dot(dembr,u_dem_unpack);
#endif
return vec4(tl,tr,bl,br);}float flatElevation(vec2 pack) {vec2 apos=floor(pack/8.0);vec2 span=10.0*(pack-apos*8.0);vec2 uvTex=(apos-vec2(1.0,1.0))/8190.0;float size=u_dem_size+2.0;float dd=1.0/size;vec2 pos=u_dem_size*(uvTex*u_dem_scale+u_dem_tl)+1.0;vec2 f=fract(pos);pos=(pos-f+0.5)*dd;vec4 h=fourSample(pos,vec2(dd));float z=mix(mix(h.x,h.y,f.x),mix(h.z,h.w,f.x),f.y);vec2 w=floor(0.5*(span*u_meter_to_dem-1.0));vec2 d=dd*w;vec4 bounds=vec4(d,vec2(1.0)-d);h=fourSample(pos-d,2.0*d+vec2(dd));vec4 diff=abs(h.xzxy-h.ywzw);vec2 slope=min(vec2(0.25),u_meter_to_dem*0.5*(diff.xz+diff.yw)/(2.0*w+vec2(1.0)));vec2 fix=slope*span;float base=z+max(fix.x,fix.y);return u_exaggeration*base;}float elevationFromUint16(float word) {return u_exaggeration*(word/ELEVATION_SCALE-ELEVATION_OFFSET);}
#else
float elevation(vec2 pos) { return 0.0; }bool isOccluded(vec4 frag) { return false; }float occlusionFade(vec4 frag) { return 1.0; }
#endif`,!0),eo=Ai(`#ifdef FOG
uniform mediump vec4 u_fog_color;uniform mediump vec2 u_fog_range;uniform mediump float u_fog_horizon_blend;uniform mediump float u_fog_temporal_offset;varying vec3 v_fog_pos;uniform highp vec3 u_frustum_tl;uniform highp vec3 u_frustum_tr;uniform highp vec3 u_frustum_br;uniform highp vec3 u_frustum_bl;uniform highp vec3 u_globe_pos;uniform highp float u_globe_radius;uniform highp vec2 u_viewport;uniform float u_globe_transition;uniform int u_is_globe;float fog_range(float depth) {return (depth-u_fog_range[0])/(u_fog_range[1]-u_fog_range[0]);}float fog_horizon_blending(vec3 camera_dir) {float t=max(0.0,camera_dir.z/u_fog_horizon_blend);return u_fog_color.a*exp(-3.0*t*t);}float fog_opacity(float t) {const float decay=6.0;float falloff=1.0-min(1.0,exp(-decay*t));falloff*=falloff*falloff;return u_fog_color.a*min(1.0,1.00747*falloff);}float globe_glow_progress() {highp vec2 uv=gl_FragCoord.xy/u_viewport;highp vec3 ray_dir=mix(
mix(u_frustum_tl,u_frustum_tr,uv.x),mix(u_frustum_bl,u_frustum_br,uv.x),1.0-uv.y);highp vec3 dir=normalize(ray_dir);highp vec3 closest_point=dot(u_globe_pos,dir)*dir;highp float sdf=length(closest_point-u_globe_pos)/u_globe_radius;return sdf+PI*0.5;}float fog_opacity(vec3 pos) {float depth=length(pos);return fog_opacity(fog_range(depth));}vec3 fog_apply(vec3 color,vec3 pos) {float depth=length(pos);float opacity;if (u_is_globe==1) {float glow_progress=globe_glow_progress();float t=mix(glow_progress,depth,u_globe_transition);opacity=fog_opacity(fog_range(t));} else {opacity=fog_opacity(fog_range(depth));opacity*=fog_horizon_blending(pos/depth);}return mix(color,u_fog_color.rgb,opacity);}vec4 fog_apply_from_vert(vec4 color,float fog_opac) {float alpha=EPSILON+color.a;color.rgb=mix(color.rgb/alpha,u_fog_color.rgb,fog_opac)*alpha;return color;}vec3 fog_apply_sky_gradient(vec3 camera_ray,vec3 sky_color) {float horizon_blend=fog_horizon_blending(normalize(camera_ray));return mix(sky_color,u_fog_color.rgb,horizon_blend);}vec4 fog_apply_premultiplied(vec4 color,vec3 pos) {float alpha=EPSILON+color.a;color.rgb=fog_apply(color.rgb/alpha,pos)*alpha;return color;}vec3 fog_dither(vec3 color) {vec2 dither_seed=gl_FragCoord.xy+u_fog_temporal_offset;return dither(color,dither_seed);}vec4 fog_dither(vec4 color) {return vec4(fog_dither(color.rgb),color.a);}
#endif`,`#ifdef FOG
uniform mediump vec4 u_fog_color;uniform mediump vec2 u_fog_range;uniform mediump float u_fog_horizon_blend;uniform mediump mat4 u_fog_matrix;varying vec3 v_fog_pos;float fog_range(float depth) {return (depth-u_fog_range[0])/(u_fog_range[1]-u_fog_range[0]);}float fog_horizon_blending(vec3 camera_dir) {float t=max(0.0,camera_dir.z/u_fog_horizon_blend);return u_fog_color.a*exp(-3.0*t*t);}float fog_opacity(float t) {const float decay=6.0;float falloff=1.0-min(1.0,exp(-decay*t));falloff*=falloff*falloff;return u_fog_color.a*min(1.0,1.00747*falloff);}vec3 fog_position(vec3 pos) {return (u_fog_matrix*vec4(pos,1.0)).xyz;}vec3 fog_position(vec2 pos) {return fog_position(vec3(pos,0.0));}float fog(vec3 pos) {float depth=length(pos);float opacity=fog_opacity(fog_range(depth));return opacity*fog_horizon_blending(pos/depth);}
#endif`,!0);const ol=Ai(`
highp vec3 hash(highp vec2 p) {highp vec3 p3=fract(p.xyx*vec3(443.8975,397.2973,491.1871));p3+=dot(p3,p3.yxz+19.19);return fract((p3.xxy+p3.yzz)*p3.zyx);}vec3 dither(vec3 color,highp vec2 seed) {vec3 rnd=hash(seed)+hash(seed+0.59374)-0.5;return color+rnd/255.0;}
#ifdef TERRAIN
highp vec4 pack_depth(highp float ndc_z) {highp float depth=ndc_z*0.5+0.5;const highp vec4 bit_shift=vec4(256.0*256.0*256.0,256.0*256.0,256.0,1.0);const highp vec4 bit_mask =vec4(0.0,1.0/256.0,1.0/256.0,1.0/256.0);highp vec4 res=fract(depth*bit_shift);res-=res.xxyz*bit_mask;return res;}
#endif`,`
float wrap(float n,float min,float max) {float d=max-min;float w=mod(mod(n-min,d)+d,d)+min;return (w==min) ? max : w;}
#ifdef PROJECTION_GLOBE_VIEW
vec3 mercator_tile_position(mat4 matrix,vec2 tile_anchor,vec3 tile_id,vec2 mercator_center) {
#ifndef PROJECTED_POS_ON_VIEWPORT
float tiles=tile_id.z;vec2 mercator=(tile_anchor/EXTENT+tile_id.xy)/tiles;mercator-=mercator_center;mercator.x=wrap(mercator.x,-0.5,0.5);vec4 mercator_tile=vec4(mercator.xy*EXTENT,EXTENT/(2.0*PI),1.0);mercator_tile=matrix*mercator_tile;return mercator_tile.xyz;
#else
return vec3(0.0);
#endif
}vec3 mix_globe_mercator(vec3 globe,vec3 mercator,float t) {return mix(globe,mercator,t);}mat3 globe_mercator_surface_vectors(vec3 pos_normal,vec3 up_dir,float zoom_transition) {vec3 normal=zoom_transition==0.0 ? pos_normal : normalize(mix(pos_normal,up_dir,zoom_transition));vec3 xAxis=normalize(vec3(normal.z,0.0,-normal.x));vec3 yAxis=normalize(cross(normal,xAxis));return mat3(xAxis,yAxis,normal);}
#endif
vec2 unpack_float(const float packedValue) {int packedIntValue=int(packedValue);int v0=packedIntValue/256;return vec2(v0,packedIntValue-v0*256);}vec2 unpack_opacity(const float packedOpacity) {int intOpacity=int(packedOpacity)/2;return vec2(float(intOpacity)/127.0,mod(packedOpacity,2.0));}vec4 decode_color(const vec2 encodedColor) {return vec4(
unpack_float(encodedColor[0])/255.0,unpack_float(encodedColor[1])/255.0
);}float unpack_mix_vec2(const vec2 packedValue,const float t) {return mix(packedValue[0],packedValue[1],t);}vec4 unpack_mix_color(const vec4 packedColors,const float t) {vec4 minColor=decode_color(vec2(packedColors[0],packedColors[1]));vec4 maxColor=decode_color(vec2(packedColors[2],packedColors[3]));return mix(minColor,maxColor,t);}vec2 get_pattern_pos(const vec2 pixel_coord_upper,const vec2 pixel_coord_lower,const vec2 pattern_size,const float tile_units_to_pixels,const vec2 pos) {vec2 offset=mod(mod(mod(pixel_coord_upper,pattern_size)*256.0,pattern_size)*256.0+pixel_coord_lower,pattern_size);return (tile_units_to_pixels*pos+offset)/pattern_size;}const vec4 AWAY=vec4(-1000.0,-1000.0,-1000.0,1);//Normalized device coordinate that is not rendered.`),ms=_c,_s=`
#ifdef GL_ES
precision mediump float;
#else

#if !defined(lowp)
#define lowp
#endif

#if !defined(mediump)
#define mediump
#endif

#if !defined(highp)
#define highp
#endif

#endif`;var sl={background:Ai(`uniform vec4 u_color;uniform float u_opacity;void main() {vec4 out_color=u_color;
#ifdef FOG
out_color=fog_dither(fog_apply_premultiplied(out_color,v_fog_pos));
#endif
gl_FragColor=out_color*u_opacity;
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,`attribute vec2 a_pos;uniform mat4 u_matrix;void main() {gl_Position=u_matrix*vec4(a_pos,0,1);
#ifdef FOG
v_fog_pos=fog_position(a_pos);
#endif
}`),backgroundPattern:Ai(`uniform vec2 u_pattern_tl_a;uniform vec2 u_pattern_br_a;uniform vec2 u_pattern_tl_b;uniform vec2 u_pattern_br_b;uniform vec2 u_texsize;uniform float u_mix;uniform float u_opacity;uniform sampler2D u_image;varying vec2 v_pos_a;varying vec2 v_pos_b;void main() {vec2 imagecoord=mod(v_pos_a,1.0);vec2 pos=mix(u_pattern_tl_a/u_texsize,u_pattern_br_a/u_texsize,imagecoord);vec4 color1=texture2D(u_image,pos);vec2 imagecoord_b=mod(v_pos_b,1.0);vec2 pos2=mix(u_pattern_tl_b/u_texsize,u_pattern_br_b/u_texsize,imagecoord_b);vec4 color2=texture2D(u_image,pos2);vec4 out_color=mix(color1,color2,u_mix);
#ifdef FOG
out_color=fog_dither(fog_apply_premultiplied(out_color,v_fog_pos));
#endif
gl_FragColor=out_color*u_opacity;
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,`uniform mat4 u_matrix;uniform vec2 u_pattern_size_a;uniform vec2 u_pattern_size_b;uniform vec2 u_pixel_coord_upper;uniform vec2 u_pixel_coord_lower;uniform float u_scale_a;uniform float u_scale_b;uniform float u_tile_units_to_pixels;attribute vec2 a_pos;varying vec2 v_pos_a;varying vec2 v_pos_b;void main() {gl_Position=u_matrix*vec4(a_pos,0,1);v_pos_a=get_pattern_pos(u_pixel_coord_upper,u_pixel_coord_lower,u_scale_a*u_pattern_size_a,u_tile_units_to_pixels,a_pos);v_pos_b=get_pattern_pos(u_pixel_coord_upper,u_pixel_coord_lower,u_scale_b*u_pattern_size_b,u_tile_units_to_pixels,a_pos);
#ifdef FOG
v_fog_pos=fog_position(a_pos);
#endif
}`),circle:Ai(`varying vec3 v_data;varying float v_visibility;
#pragma mapbox: define highp vec4 color
#pragma mapbox: define mediump float radius
#pragma mapbox: define lowp float blur
#pragma mapbox: define lowp float opacity
#pragma mapbox: define highp vec4 stroke_color
#pragma mapbox: define mediump float stroke_width
#pragma mapbox: define lowp float stroke_opacity
void main() {
#pragma mapbox: initialize highp vec4 color
#pragma mapbox: initialize mediump float radius
#pragma mapbox: initialize lowp float blur
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize highp vec4 stroke_color
#pragma mapbox: initialize mediump float stroke_width
#pragma mapbox: initialize lowp float stroke_opacity
vec2 extrude=v_data.xy;float extrude_length=length(extrude);lowp float antialiasblur=v_data.z;float antialiased_blur=-max(blur,antialiasblur);float opacity_t=smoothstep(0.0,antialiased_blur,extrude_length-1.0);float color_t=stroke_width < 0.01 ? 0.0 : smoothstep(
antialiased_blur,0.0,extrude_length-radius/(radius+stroke_width)
);vec4 out_color=mix(color*opacity,stroke_color*stroke_opacity,color_t);
#ifdef FOG
out_color=fog_apply_premultiplied(out_color,v_fog_pos);
#endif
gl_FragColor=out_color*(v_visibility*opacity_t);
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,`#define NUM_VISIBILITY_RINGS 2
#define INV_SQRT2 0.70710678
#define ELEVATION_BIAS 0.0001
#define NUM_SAMPLES_PER_RING 16
uniform mat4 u_matrix;uniform mat2 u_extrude_scale;uniform lowp float u_device_pixel_ratio;uniform highp float u_camera_to_center_distance;attribute vec2 a_pos;
#ifdef PROJECTION_GLOBE_VIEW
attribute vec3 a_pos_3;attribute vec3 a_pos_normal_3;attribute float a_scale;uniform mat4 u_inv_rot_matrix;uniform vec2 u_merc_center;uniform vec3 u_tile_id;uniform float u_zoom_transition;uniform vec3 u_up_dir;
#endif
varying vec3 v_data;varying float v_visibility;
#pragma mapbox: define highp vec4 color
#pragma mapbox: define mediump float radius
#pragma mapbox: define lowp float blur
#pragma mapbox: define lowp float opacity
#pragma mapbox: define highp vec4 stroke_color
#pragma mapbox: define mediump float stroke_width
#pragma mapbox: define lowp float stroke_opacity
vec2 calc_offset(vec2 extrusion,float radius,float stroke_width, float view_scale) {return extrusion*(radius+stroke_width)*u_extrude_scale*view_scale;}float cantilevered_elevation(vec2 pos,float radius,float stroke_width,float view_scale) {vec2 c1=pos+calc_offset(vec2(-1,-1),radius,stroke_width,view_scale);vec2 c2=pos+calc_offset(vec2(1,-1),radius,stroke_width,view_scale);vec2 c3=pos+calc_offset(vec2(1,1),radius,stroke_width,view_scale);vec2 c4=pos+calc_offset(vec2(-1,1),radius,stroke_width,view_scale);float h1=elevation(c1)+ELEVATION_BIAS;float h2=elevation(c2)+ELEVATION_BIAS;float h3=elevation(c3)+ELEVATION_BIAS;float h4=elevation(c4)+ELEVATION_BIAS;return max(h4,max(h3,max(h1,h2)));}float circle_elevation(vec2 pos) {
#if defined(TERRAIN)
return elevation(pos)+ELEVATION_BIAS;
#else
return 0.0;
#endif
}vec4 project_vertex(vec2 extrusion,vec4 world_center,vec4 projected_center,float radius,float stroke_width, float view_scale,mat3 surface_vectors) {vec2 sample_offset=calc_offset(extrusion,radius,stroke_width,view_scale);
#ifdef PITCH_WITH_MAP
#ifdef PROJECTION_GLOBE_VIEW
return u_matrix*( world_center+vec4(sample_offset.x*surface_vectors[0]+sample_offset.y*surface_vectors[1],0) );
#else
return u_matrix*( world_center+vec4(sample_offset,0,0) );
#endif
#else
return projected_center+vec4(sample_offset,0,0);
#endif
}float get_sample_step() {
#ifdef PITCH_WITH_MAP
return 2.0*PI/float(NUM_SAMPLES_PER_RING);
#else
return PI/float(NUM_SAMPLES_PER_RING);
#endif
}void main(void) {
#pragma mapbox: initialize highp vec4 color
#pragma mapbox: initialize mediump float radius
#pragma mapbox: initialize lowp float blur
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize highp vec4 stroke_color
#pragma mapbox: initialize mediump float stroke_width
#pragma mapbox: initialize lowp float stroke_opacity
vec2 extrude=vec2(mod(a_pos,2.0)*2.0-1.0);vec2 circle_center=floor(a_pos*0.5);
#ifdef PROJECTION_GLOBE_VIEW
vec3 pos_normal_3=a_pos_normal_3/16384.0;mat3 surface_vectors=globe_mercator_surface_vectors(pos_normal_3,u_up_dir,u_zoom_transition);vec3 surface_extrusion=extrude.x*surface_vectors[0]+extrude.y*surface_vectors[1];vec3 globe_elevation=elevationVector(circle_center)*circle_elevation(circle_center);vec3 globe_pos=a_pos_3+surface_extrusion+globe_elevation;vec3 mercator_elevation=u_up_dir*u_tile_up_scale*circle_elevation(circle_center);vec3 merc_pos=mercator_tile_position(u_inv_rot_matrix,circle_center,u_tile_id,u_merc_center)+surface_extrusion+mercator_elevation;vec3 pos=mix_globe_mercator(globe_pos,merc_pos,u_zoom_transition);vec4 world_center=vec4(pos,1);
#else 
mat3 surface_vectors=mat3(1.0);float height=circle_elevation(circle_center);vec4 world_center=vec4(circle_center,height,1);
#endif
vec4 projected_center=u_matrix*world_center;float view_scale=0.0;
#ifdef PITCH_WITH_MAP
#ifdef SCALE_WITH_MAP
view_scale=1.0;
#else
view_scale=projected_center.w/u_camera_to_center_distance;
#endif
#else
#ifdef SCALE_WITH_MAP
view_scale=u_camera_to_center_distance;
#else
view_scale=projected_center.w;
#endif
#endif
gl_Position=project_vertex(extrude,world_center,projected_center,radius,stroke_width,view_scale,surface_vectors);float visibility=0.0;
#ifdef TERRAIN
float step=get_sample_step();
#ifdef PITCH_WITH_MAP
float cantilevered_height=cantilevered_elevation(circle_center,radius,stroke_width,view_scale);vec4 occlusion_world_center=vec4(circle_center,cantilevered_height,1);vec4 occlusion_projected_center=u_matrix*occlusion_world_center;
#else
vec4 occlusion_world_center=world_center;vec4 occlusion_projected_center=projected_center;
#endif
for(int ring=0; ring < NUM_VISIBILITY_RINGS; ring++) {float scale=(float(ring)+1.0)/float(NUM_VISIBILITY_RINGS);for(int i=0; i < NUM_SAMPLES_PER_RING; i++) {vec2 extrusion=vec2(cos(step*float(i)),-sin(step*float(i)))*scale;vec4 frag_pos=project_vertex(extrusion,occlusion_world_center,occlusion_projected_center,radius,stroke_width,view_scale,surface_vectors);visibility+=float(!isOccluded(frag_pos));}}visibility/=float(NUM_VISIBILITY_RINGS)*float(NUM_SAMPLES_PER_RING);
#else
visibility=1.0;
#endif
#ifdef PROJECTION_GLOBE_VIEW
visibility=1.0;
#endif
v_visibility=visibility;lowp float antialiasblur=1.0/u_device_pixel_ratio/(radius+stroke_width);v_data=vec3(extrude.x,extrude.y,antialiasblur);
#ifdef FOG
v_fog_pos=fog_position(world_center.xyz);
#endif
}`),clippingMask:Ai("void main() {gl_FragColor=vec4(1.0);}","attribute vec2 a_pos;uniform mat4 u_matrix;void main() {gl_Position=u_matrix*vec4(a_pos,0,1);}"),heatmap:Ai(`uniform highp float u_intensity;varying vec2 v_extrude;
#pragma mapbox: define highp float weight
#define GAUSS_COEF 0.3989422804014327
void main() {
#pragma mapbox: initialize highp float weight
float d=-0.5*3.0*3.0*dot(v_extrude,v_extrude);float val=weight*u_intensity*GAUSS_COEF*exp(d);gl_FragColor=vec4(val,1.0,1.0,1.0);
#ifdef FOG
if (u_is_globe==0) {gl_FragColor.r*=pow(1.0-fog_opacity(v_fog_pos),2.0);}
#endif
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,`uniform mat4 u_matrix;uniform float u_extrude_scale;uniform float u_opacity;uniform float u_intensity;attribute vec2 a_pos;
#ifdef PROJECTION_GLOBE_VIEW
attribute vec3 a_pos_3;attribute vec3 a_pos_normal_3;uniform mat4 u_inv_rot_matrix;uniform vec2 u_merc_center;uniform vec3 u_tile_id;uniform float u_zoom_transition;uniform vec3 u_up_dir;
#endif
varying vec2 v_extrude;
#pragma mapbox: define highp float weight
#pragma mapbox: define mediump float radius
const highp float ZERO=1.0/255.0/16.0;
#define GAUSS_COEF 0.3989422804014327
void main(void) {
#pragma mapbox: initialize highp float weight
#pragma mapbox: initialize mediump float radius
vec2 unscaled_extrude=vec2(mod(a_pos,2.0)*2.0-1.0);float S=sqrt(-2.0*log(ZERO/weight/u_intensity/GAUSS_COEF))/3.0;v_extrude=S*unscaled_extrude;vec2 extrude=v_extrude*radius*u_extrude_scale;vec2 tilePos=floor(a_pos*0.5);
#ifdef PROJECTION_GLOBE_VIEW
vec3 pos_normal_3=a_pos_normal_3/16384.0;mat3 surface_vectors=globe_mercator_surface_vectors(pos_normal_3,u_up_dir,u_zoom_transition);vec3 surface_extrusion=extrude.x*surface_vectors[0]+extrude.y*surface_vectors[1];vec3 globe_elevation=elevationVector(tilePos)*elevation(tilePos);vec3 globe_pos=a_pos_3+surface_extrusion+globe_elevation;vec3 mercator_elevation=u_up_dir*u_tile_up_scale*elevation(tilePos);vec3 merc_pos=mercator_tile_position(u_inv_rot_matrix,tilePos,u_tile_id,u_merc_center)+surface_extrusion+mercator_elevation;vec3 pos=mix_globe_mercator(globe_pos,merc_pos,u_zoom_transition);
#else
vec3 pos=vec3(tilePos+extrude,elevation(tilePos));
#endif
gl_Position=u_matrix*vec4(pos,1);
#ifdef FOG
v_fog_pos=fog_position(pos);
#endif
}`),heatmapTexture:Ai(`uniform sampler2D u_image;uniform sampler2D u_color_ramp;uniform float u_opacity;varying vec2 v_pos;void main() {float t=texture2D(u_image,v_pos).r;vec4 color=texture2D(u_color_ramp,vec2(t,0.5));gl_FragColor=color*u_opacity;
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(0.0);
#endif
}`,"attribute vec2 a_pos;varying vec2 v_pos;void main() {gl_Position=vec4(a_pos,0,1);v_pos=a_pos*0.5+0.5;}"),collisionBox:Ai("varying float v_placed;varying float v_notUsed;void main() {vec4 red =vec4(1.0,0.0,0.0,1.0);vec4 blue=vec4(0.0,0.0,1.0,0.5);gl_FragColor =mix(red,blue,step(0.5,v_placed))*0.5;gl_FragColor*=mix(1.0,0.1,step(0.5,v_notUsed));}",`attribute vec3 a_pos;attribute vec2 a_anchor_pos;attribute vec2 a_extrude;attribute vec2 a_placed;attribute vec2 a_shift;attribute float a_size_scale;attribute vec2 a_padding;uniform mat4 u_matrix;uniform vec2 u_extrude_scale;uniform float u_camera_to_center_distance;varying float v_placed;varying float v_notUsed;void main() {vec4 projectedPoint=u_matrix*vec4(a_pos+elevationVector(a_anchor_pos)*elevation(a_anchor_pos),1);highp float camera_to_anchor_distance=projectedPoint.w;highp float collision_perspective_ratio=clamp(
0.5+0.5*(u_camera_to_center_distance/camera_to_anchor_distance),0.0,1.5);gl_Position=projectedPoint;gl_Position.xy+=(a_extrude*a_size_scale+a_shift+a_padding)*u_extrude_scale*gl_Position.w*collision_perspective_ratio;v_placed=a_placed.x;v_notUsed=a_placed.y;}`),collisionCircle:Ai("varying float v_radius;varying vec2 v_extrude;varying float v_perspective_ratio;varying float v_collision;void main() {float alpha=0.5*min(v_perspective_ratio,1.0);float stroke_radius=0.9*max(v_perspective_ratio,1.0);float distance_to_center=length(v_extrude);float distance_to_edge=abs(distance_to_center-v_radius);float opacity_t=smoothstep(-stroke_radius,0.0,-distance_to_edge);vec4 color=mix(vec4(0.0,0.0,1.0,0.5),vec4(1.0,0.0,0.0,1.0),v_collision);gl_FragColor=color*alpha*opacity_t;}",`attribute vec2 a_pos_2f;attribute float a_radius;attribute vec2 a_flags;uniform mat4 u_matrix;uniform mat4 u_inv_matrix;uniform vec2 u_viewport_size;uniform float u_camera_to_center_distance;varying float v_radius;varying vec2 v_extrude;varying float v_perspective_ratio;varying float v_collision;vec3 toTilePosition(vec2 screenPos) {vec4 rayStart=u_inv_matrix*vec4(screenPos,-1.0,1.0);vec4 rayEnd  =u_inv_matrix*vec4(screenPos, 1.0,1.0);rayStart.xyz/=rayStart.w;rayEnd.xyz  /=rayEnd.w;highp float t=(0.0-rayStart.z)/(rayEnd.z-rayStart.z);return mix(rayStart.xyz,rayEnd.xyz,t);}void main() {vec2 quadCenterPos=a_pos_2f;float radius=a_radius;float collision=a_flags.x;float vertexIdx=a_flags.y;vec2 quadVertexOffset=vec2(
mix(-1.0,1.0,float(vertexIdx >=2.0)),mix(-1.0,1.0,float(vertexIdx >=1.0 && vertexIdx <=2.0)));vec2 quadVertexExtent=quadVertexOffset*radius;vec3 tilePos=toTilePosition(quadCenterPos);vec4 clipPos=u_matrix*vec4(tilePos,1.0);highp float camera_to_anchor_distance=clipPos.w;highp float collision_perspective_ratio=clamp(
0.5+0.5*(u_camera_to_center_distance/camera_to_anchor_distance),0.0,4.0);float padding_factor=1.2;v_radius=radius;v_extrude=quadVertexExtent*padding_factor;v_perspective_ratio=collision_perspective_ratio;v_collision=collision;gl_Position=vec4(clipPos.xyz/clipPos.w,1.0)+vec4(quadVertexExtent*padding_factor/u_viewport_size*2.0,0.0,0.0);}`),debug:Ai("uniform highp vec4 u_color;uniform sampler2D u_overlay;varying vec2 v_uv;void main() {vec4 overlay_color=texture2D(u_overlay,v_uv);gl_FragColor=mix(u_color,overlay_color,overlay_color.a);}",`attribute vec2 a_pos;
#ifdef PROJECTION_GLOBE_VIEW
attribute vec3 a_pos_3;
#endif
varying vec2 v_uv;uniform mat4 u_matrix;uniform float u_overlay_scale;void main() {float h=elevation(a_pos);v_uv=a_pos/8192.0;
#ifdef PROJECTION_GLOBE_VIEW
gl_Position=u_matrix*vec4(a_pos_3+elevationVector(a_pos)*h,1);
#else
gl_Position=u_matrix*vec4(a_pos*u_overlay_scale,h,1);
#endif
}`),fill:Ai(`#pragma mapbox: define highp vec4 color
#pragma mapbox: define lowp float opacity
void main() {
#pragma mapbox: initialize highp vec4 color
#pragma mapbox: initialize lowp float opacity
vec4 out_color=color;
#ifdef FOG
out_color=fog_dither(fog_apply_premultiplied(out_color,v_fog_pos));
#endif
gl_FragColor=out_color*opacity;
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,`attribute vec2 a_pos;uniform mat4 u_matrix;
#pragma mapbox: define highp vec4 color
#pragma mapbox: define lowp float opacity
void main() {
#pragma mapbox: initialize highp vec4 color
#pragma mapbox: initialize lowp float opacity
gl_Position=u_matrix*vec4(a_pos,0,1);
#ifdef FOG
v_fog_pos=fog_position(a_pos);
#endif
}`),fillOutline:Ai(`varying vec2 v_pos;
#pragma mapbox: define highp vec4 outline_color
#pragma mapbox: define lowp float opacity
void main() {
#pragma mapbox: initialize highp vec4 outline_color
#pragma mapbox: initialize lowp float opacity
float dist=length(v_pos-gl_FragCoord.xy);float alpha=1.0-smoothstep(0.0,1.0,dist);vec4 out_color=outline_color;
#ifdef FOG
out_color=fog_dither(fog_apply_premultiplied(out_color,v_fog_pos));
#endif
gl_FragColor=out_color*(alpha*opacity);
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,`attribute vec2 a_pos;uniform mat4 u_matrix;uniform vec2 u_world;varying vec2 v_pos;
#pragma mapbox: define highp vec4 outline_color
#pragma mapbox: define lowp float opacity
void main() {
#pragma mapbox: initialize highp vec4 outline_color
#pragma mapbox: initialize lowp float opacity
gl_Position=u_matrix*vec4(a_pos,0,1);v_pos=(gl_Position.xy/gl_Position.w+1.0)/2.0*u_world;
#ifdef FOG
v_fog_pos=fog_position(a_pos);
#endif
}`),fillOutlinePattern:Ai(`uniform vec2 u_texsize;uniform sampler2D u_image;uniform float u_fade;varying vec2 v_pos_a;varying vec2 v_pos_b;varying vec2 v_pos;
#pragma mapbox: define lowp float opacity
#pragma mapbox: define lowp vec4 pattern_from
#pragma mapbox: define lowp vec4 pattern_to
void main() {
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize mediump vec4 pattern_from
#pragma mapbox: initialize mediump vec4 pattern_to
vec2 pattern_tl_a=pattern_from.xy;vec2 pattern_br_a=pattern_from.zw;vec2 pattern_tl_b=pattern_to.xy;vec2 pattern_br_b=pattern_to.zw;vec2 imagecoord=mod(v_pos_a,1.0);vec2 pos=mix(pattern_tl_a/u_texsize,pattern_br_a/u_texsize,imagecoord);vec4 color1=texture2D(u_image,pos);vec2 imagecoord_b=mod(v_pos_b,1.0);vec2 pos2=mix(pattern_tl_b/u_texsize,pattern_br_b/u_texsize,imagecoord_b);vec4 color2=texture2D(u_image,pos2);float dist=length(v_pos-gl_FragCoord.xy);float alpha=1.0-smoothstep(0.0,1.0,dist);vec4 out_color=mix(color1,color2,u_fade);
#ifdef FOG
out_color=fog_dither(fog_apply_premultiplied(out_color,v_fog_pos));
#endif
gl_FragColor=out_color*(alpha*opacity);
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,`uniform mat4 u_matrix;uniform vec2 u_world;uniform vec2 u_pixel_coord_upper;uniform vec2 u_pixel_coord_lower;uniform vec3 u_scale;attribute vec2 a_pos;varying vec2 v_pos_a;varying vec2 v_pos_b;varying vec2 v_pos;
#pragma mapbox: define lowp float opacity
#pragma mapbox: define lowp vec4 pattern_from
#pragma mapbox: define lowp vec4 pattern_to
#pragma mapbox: define lowp float pixel_ratio_from
#pragma mapbox: define lowp float pixel_ratio_to
void main() {
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize mediump vec4 pattern_from
#pragma mapbox: initialize mediump vec4 pattern_to
#pragma mapbox: initialize lowp float pixel_ratio_from
#pragma mapbox: initialize lowp float pixel_ratio_to
vec2 pattern_tl_a=pattern_from.xy;vec2 pattern_br_a=pattern_from.zw;vec2 pattern_tl_b=pattern_to.xy;vec2 pattern_br_b=pattern_to.zw;float tileRatio=u_scale.x;float fromScale=u_scale.y;float toScale=u_scale.z;gl_Position=u_matrix*vec4(a_pos,0,1);vec2 display_size_a=(pattern_br_a-pattern_tl_a)/pixel_ratio_from;vec2 display_size_b=(pattern_br_b-pattern_tl_b)/pixel_ratio_to;v_pos_a=get_pattern_pos(u_pixel_coord_upper,u_pixel_coord_lower,fromScale*display_size_a,tileRatio,a_pos);v_pos_b=get_pattern_pos(u_pixel_coord_upper,u_pixel_coord_lower,toScale*display_size_b,tileRatio,a_pos);v_pos=(gl_Position.xy/gl_Position.w+1.0)/2.0*u_world;
#ifdef FOG
v_fog_pos=fog_position(a_pos);
#endif
}`),fillPattern:Ai(`uniform vec2 u_texsize;uniform float u_fade;uniform sampler2D u_image;varying vec2 v_pos_a;varying vec2 v_pos_b;
#pragma mapbox: define lowp float opacity
#pragma mapbox: define lowp vec4 pattern_from
#pragma mapbox: define lowp vec4 pattern_to
void main() {
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize mediump vec4 pattern_from
#pragma mapbox: initialize mediump vec4 pattern_to
vec2 pattern_tl_a=pattern_from.xy;vec2 pattern_br_a=pattern_from.zw;vec2 pattern_tl_b=pattern_to.xy;vec2 pattern_br_b=pattern_to.zw;vec2 imagecoord=mod(v_pos_a,1.0);vec2 pos=mix(pattern_tl_a/u_texsize,pattern_br_a/u_texsize,imagecoord);vec4 color1=texture2D(u_image,pos);vec2 imagecoord_b=mod(v_pos_b,1.0);vec2 pos2=mix(pattern_tl_b/u_texsize,pattern_br_b/u_texsize,imagecoord_b);vec4 color2=texture2D(u_image,pos2);vec4 out_color=mix(color1,color2,u_fade);
#ifdef FOG
out_color=fog_dither(fog_apply_premultiplied(out_color,v_fog_pos));
#endif
gl_FragColor=out_color*opacity;
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,`uniform mat4 u_matrix;uniform vec2 u_pixel_coord_upper;uniform vec2 u_pixel_coord_lower;uniform vec3 u_scale;attribute vec2 a_pos;varying vec2 v_pos_a;varying vec2 v_pos_b;
#pragma mapbox: define lowp float opacity
#pragma mapbox: define lowp vec4 pattern_from
#pragma mapbox: define lowp vec4 pattern_to
#pragma mapbox: define lowp float pixel_ratio_from
#pragma mapbox: define lowp float pixel_ratio_to
void main() {
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize mediump vec4 pattern_from
#pragma mapbox: initialize mediump vec4 pattern_to
#pragma mapbox: initialize lowp float pixel_ratio_from
#pragma mapbox: initialize lowp float pixel_ratio_to
vec2 pattern_tl_a=pattern_from.xy;vec2 pattern_br_a=pattern_from.zw;vec2 pattern_tl_b=pattern_to.xy;vec2 pattern_br_b=pattern_to.zw;float tileZoomRatio=u_scale.x;float fromScale=u_scale.y;float toScale=u_scale.z;vec2 display_size_a=(pattern_br_a-pattern_tl_a)/pixel_ratio_from;vec2 display_size_b=(pattern_br_b-pattern_tl_b)/pixel_ratio_to;gl_Position=u_matrix*vec4(a_pos,0,1);v_pos_a=get_pattern_pos(u_pixel_coord_upper,u_pixel_coord_lower,fromScale*display_size_a,tileZoomRatio,a_pos);v_pos_b=get_pattern_pos(u_pixel_coord_upper,u_pixel_coord_lower,toScale*display_size_b,tileZoomRatio,a_pos);
#ifdef FOG
v_fog_pos=fog_position(a_pos);
#endif
}`),fillExtrusion:Ai(`varying vec4 v_color;void main() {vec4 color=v_color;
#ifdef FOG
color=fog_dither(fog_apply_premultiplied(color,v_fog_pos));
#endif
gl_FragColor=color;
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,`uniform mat4 u_matrix;uniform vec3 u_lightcolor;uniform lowp vec3 u_lightpos;uniform lowp float u_lightintensity;uniform float u_vertical_gradient;uniform lowp float u_opacity;attribute vec4 a_pos_normal_ed;attribute vec2 a_centroid_pos;
#ifdef PROJECTION_GLOBE_VIEW
attribute vec3 a_pos_3;attribute vec3 a_pos_normal_3;uniform mat4 u_inv_rot_matrix;uniform vec2 u_merc_center;uniform vec3 u_tile_id;uniform float u_zoom_transition;uniform vec3 u_up_dir;uniform float u_height_lift;
#endif
varying vec4 v_color;
#pragma mapbox: define highp float base
#pragma mapbox: define highp float height
#pragma mapbox: define highp vec4 color
void main() {
#pragma mapbox: initialize highp float base
#pragma mapbox: initialize highp float height
#pragma mapbox: initialize highp vec4 color
vec3 pos_nx=floor(a_pos_normal_ed.xyz*0.5);mediump vec3 top_up_ny=a_pos_normal_ed.xyz-2.0*pos_nx;float x_normal=pos_nx.z/8192.0;vec3 normal=top_up_ny.y==1.0 ? vec3(0.0,0.0,1.0) : normalize(vec3(x_normal,(2.0*top_up_ny.z-1.0)*(1.0-abs(x_normal)),0.0));base=max(0.0,base);height=max(0.0,height);float t=top_up_ny.x;vec2 centroid_pos=vec2(0.0);
#if defined(HAS_CENTROID) || defined(TERRAIN)
centroid_pos=a_centroid_pos;
#endif
#ifdef TERRAIN
bool flat_roof=centroid_pos.x !=0.0 && t > 0.0;float ele=elevation(pos_nx.xy);float c_ele=flat_roof ? centroid_pos.y==0.0 ? elevationFromUint16(centroid_pos.x) : flatElevation(centroid_pos) : ele;float h=flat_roof ? max(c_ele+height,ele+base+2.0) : ele+(t > 0.0 ? height : base==0.0 ?-5.0 : base);vec3 pos=vec3(pos_nx.xy,h);
#else
vec3 pos=vec3(pos_nx.xy,t > 0.0 ? height : base);
#endif
#ifdef PROJECTION_GLOBE_VIEW
float lift=float((t+base) > 0.0)*u_height_lift;vec3 globe_normal=normalize(mix(a_pos_normal_3/16384.0,u_up_dir,u_zoom_transition));vec3 globe_pos=a_pos_3+globe_normal*(u_tile_up_scale*(pos.z+lift));vec3 merc_pos=mercator_tile_position(u_inv_rot_matrix,pos.xy,u_tile_id,u_merc_center)+u_up_dir*u_tile_up_scale*pos.z;pos=mix_globe_mercator(globe_pos,merc_pos,u_zoom_transition);
#endif
float hidden=float(centroid_pos.x==0.0 && centroid_pos.y==1.0);gl_Position=mix(u_matrix*vec4(pos,1),AWAY,hidden);float colorvalue=color.r*0.2126+color.g*0.7152+color.b*0.0722;v_color=vec4(0.0,0.0,0.0,1.0);vec4 ambientlight=vec4(0.03,0.03,0.03,1.0);color+=ambientlight;float directional=clamp(dot(normal,u_lightpos),0.0,1.0);directional=mix((1.0-u_lightintensity),max((1.0-colorvalue+u_lightintensity),1.0),directional);if (normal.y !=0.0) {directional*=(
(1.0-u_vertical_gradient)+(u_vertical_gradient*clamp((t+base)*pow(height/150.0,0.5),mix(0.7,0.98,1.0-u_lightintensity),1.0)));}v_color.rgb+=clamp(color.rgb*directional*u_lightcolor,mix(vec3(0.0),vec3(0.3),1.0-u_lightcolor),vec3(1.0));v_color*=u_opacity;
#ifdef FOG
v_fog_pos=fog_position(pos);
#endif
}`),fillExtrusionPattern:Ai(`uniform vec2 u_texsize;uniform float u_fade;uniform sampler2D u_image;varying vec2 v_pos_a;varying vec2 v_pos_b;varying vec4 v_lighting;
#pragma mapbox: define lowp float base
#pragma mapbox: define lowp float height
#pragma mapbox: define lowp vec4 pattern_from
#pragma mapbox: define lowp vec4 pattern_to
#pragma mapbox: define lowp float pixel_ratio_from
#pragma mapbox: define lowp float pixel_ratio_to
void main() {
#pragma mapbox: initialize lowp float base
#pragma mapbox: initialize lowp float height
#pragma mapbox: initialize mediump vec4 pattern_from
#pragma mapbox: initialize mediump vec4 pattern_to
#pragma mapbox: initialize lowp float pixel_ratio_from
#pragma mapbox: initialize lowp float pixel_ratio_to
vec2 pattern_tl_a=pattern_from.xy;vec2 pattern_br_a=pattern_from.zw;vec2 pattern_tl_b=pattern_to.xy;vec2 pattern_br_b=pattern_to.zw;vec2 imagecoord=mod(v_pos_a,1.0);vec2 pos=mix(pattern_tl_a/u_texsize,pattern_br_a/u_texsize,imagecoord);vec4 color1=texture2D(u_image,pos);vec2 imagecoord_b=mod(v_pos_b,1.0);vec2 pos2=mix(pattern_tl_b/u_texsize,pattern_br_b/u_texsize,imagecoord_b);vec4 color2=texture2D(u_image,pos2);vec4 out_color=mix(color1,color2,u_fade);out_color=out_color*v_lighting;
#ifdef FOG
out_color=fog_dither(fog_apply_premultiplied(out_color,v_fog_pos));
#endif
gl_FragColor=out_color;
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,`uniform mat4 u_matrix;uniform vec2 u_pixel_coord_upper;uniform vec2 u_pixel_coord_lower;uniform float u_height_factor;uniform vec3 u_scale;uniform float u_vertical_gradient;uniform lowp float u_opacity;uniform vec3 u_lightcolor;uniform lowp vec3 u_lightpos;uniform lowp float u_lightintensity;attribute vec4 a_pos_normal_ed;attribute vec2 a_centroid_pos;
#ifdef PROJECTION_GLOBE_VIEW
attribute vec3 a_pos_3;attribute vec3 a_pos_normal_3;uniform mat4 u_inv_rot_matrix;uniform vec2 u_merc_center;uniform vec3 u_tile_id;uniform float u_zoom_transition;uniform vec3 u_up_dir;uniform float u_height_lift;
#endif
varying vec2 v_pos_a;varying vec2 v_pos_b;varying vec4 v_lighting;
#pragma mapbox: define lowp float base
#pragma mapbox: define lowp float height
#pragma mapbox: define lowp vec4 pattern_from
#pragma mapbox: define lowp vec4 pattern_to
#pragma mapbox: define lowp float pixel_ratio_from
#pragma mapbox: define lowp float pixel_ratio_to
void main() {
#pragma mapbox: initialize lowp float base
#pragma mapbox: initialize lowp float height
#pragma mapbox: initialize mediump vec4 pattern_from
#pragma mapbox: initialize mediump vec4 pattern_to
#pragma mapbox: initialize lowp float pixel_ratio_from
#pragma mapbox: initialize lowp float pixel_ratio_to
vec2 pattern_tl_a=pattern_from.xy;vec2 pattern_br_a=pattern_from.zw;vec2 pattern_tl_b=pattern_to.xy;vec2 pattern_br_b=pattern_to.zw;float tileRatio=u_scale.x;float fromScale=u_scale.y;float toScale=u_scale.z;vec3 pos_nx=floor(a_pos_normal_ed.xyz*0.5);mediump vec3 top_up_ny=a_pos_normal_ed.xyz-2.0*pos_nx;float x_normal=pos_nx.z/8192.0;vec3 normal=top_up_ny.y==1.0 ? vec3(0.0,0.0,1.0) : normalize(vec3(x_normal,(2.0*top_up_ny.z-1.0)*(1.0-abs(x_normal)),0.0));float edgedistance=a_pos_normal_ed.w;vec2 display_size_a=(pattern_br_a-pattern_tl_a)/pixel_ratio_from;vec2 display_size_b=(pattern_br_b-pattern_tl_b)/pixel_ratio_to;base=max(0.0,base);height=max(0.0,height);float t=top_up_ny.x;float z=t > 0.0 ? height : base;vec2 centroid_pos=vec2(0.0);
#if defined(HAS_CENTROID) || defined(TERRAIN)
centroid_pos=a_centroid_pos;
#endif
#ifdef TERRAIN
bool flat_roof=centroid_pos.x !=0.0 && t > 0.0;float ele=elevation(pos_nx.xy);float c_ele=flat_roof ? centroid_pos.y==0.0 ? elevationFromUint16(centroid_pos.x) : flatElevation(centroid_pos) : ele;float h=flat_roof ? max(c_ele+height,ele+base+2.0) : ele+(t > 0.0 ? height : base==0.0 ?-5.0 : base);vec3 p=vec3(pos_nx.xy,h);
#else
vec3 p=vec3(pos_nx.xy,z);
#endif
#ifdef PROJECTION_GLOBE_VIEW
float lift=float((t+base) > 0.0)*u_height_lift;vec3 globe_normal=normalize(mix(a_pos_normal_3/16384.0,u_up_dir,u_zoom_transition));vec3 globe_pos=a_pos_3+globe_normal*(u_tile_up_scale*(p.z+lift));vec3 merc_pos=mercator_tile_position(u_inv_rot_matrix,p.xy,u_tile_id,u_merc_center)+u_up_dir*u_tile_up_scale*p.z;p=mix_globe_mercator(globe_pos,merc_pos,u_zoom_transition);
#endif
float hidden=float(centroid_pos.x==0.0 && centroid_pos.y==1.0);gl_Position=mix(u_matrix*vec4(p,1),AWAY,hidden);vec2 pos=normal.z==1.0
? pos_nx.xy
: vec2(edgedistance,z*u_height_factor);v_pos_a=get_pattern_pos(u_pixel_coord_upper,u_pixel_coord_lower,fromScale*display_size_a,tileRatio,pos);v_pos_b=get_pattern_pos(u_pixel_coord_upper,u_pixel_coord_lower,toScale*display_size_b,tileRatio,pos);v_lighting=vec4(0.0,0.0,0.0,1.0);float directional=clamp(dot(normal,u_lightpos),0.0,1.0);directional=mix((1.0-u_lightintensity),max((0.5+u_lightintensity),1.0),directional);if (normal.y !=0.0) {directional*=(
(1.0-u_vertical_gradient)+(u_vertical_gradient*clamp((t+base)*pow(height/150.0,0.5),mix(0.7,0.98,1.0-u_lightintensity),1.0)));}v_lighting.rgb+=clamp(directional*u_lightcolor,mix(vec3(0.0),vec3(0.3),1.0-u_lightcolor),vec3(1.0));v_lighting*=u_opacity;
#ifdef FOG
v_fog_pos=fog_position(p);
#endif
}`),hillshadePrepare:Ai(`#ifdef GL_ES
precision highp float;
#endif
uniform sampler2D u_image;varying vec2 v_pos;uniform vec2 u_dimension;uniform float u_zoom;uniform vec4 u_unpack;float getElevation(vec2 coord) {
#ifdef TERRAIN_DEM_FLOAT_FORMAT
return texture2D(u_image,coord).a/4.0;
#else
vec4 data=texture2D(u_image,coord)*255.0;data.a=-1.0;return dot(data,u_unpack)/4.0;
#endif
}void main() {vec2 epsilon=1.0/u_dimension;float a=getElevation(v_pos+vec2(-epsilon.x,-epsilon.y));float b=getElevation(v_pos+vec2(0,-epsilon.y));float c=getElevation(v_pos+vec2(epsilon.x,-epsilon.y));float d=getElevation(v_pos+vec2(-epsilon.x,0));float e=getElevation(v_pos);float f=getElevation(v_pos+vec2(epsilon.x,0));float g=getElevation(v_pos+vec2(-epsilon.x,epsilon.y));float h=getElevation(v_pos+vec2(0,epsilon.y));float i=getElevation(v_pos+vec2(epsilon.x,epsilon.y));float exaggerationFactor=u_zoom < 2.0 ? 0.4 : u_zoom < 4.5 ? 0.35 : 0.3;float exaggeration=u_zoom < 15.0 ? (u_zoom-15.0)*exaggerationFactor : 0.0;vec2 deriv=vec2(
(c+f+f+i)-(a+d+d+g),(g+h+h+i)-(a+b+b+c)
)/pow(2.0,exaggeration+(19.2562-u_zoom));gl_FragColor=clamp(vec4(
deriv.x/2.0+0.5,deriv.y/2.0+0.5,1.0,1.0),0.0,1.0);
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,"uniform mat4 u_matrix;uniform vec2 u_dimension;attribute vec2 a_pos;attribute vec2 a_texture_pos;varying vec2 v_pos;void main() {gl_Position=u_matrix*vec4(a_pos,0,1);highp vec2 epsilon=1.0/u_dimension;float scale=(u_dimension.x-2.0)/u_dimension.x;v_pos=(a_texture_pos/8192.0)*scale+epsilon;}"),hillshade:Ai(`uniform sampler2D u_image;varying vec2 v_pos;uniform vec2 u_latrange;uniform vec2 u_light;uniform vec4 u_shadow;uniform vec4 u_highlight;uniform vec4 u_accent;void main() {vec4 pixel=texture2D(u_image,v_pos);vec2 deriv=((pixel.rg*2.0)-1.0);float scaleFactor=cos(radians((u_latrange[0]-u_latrange[1])*(1.0-v_pos.y)+u_latrange[1]));float slope=atan(1.25*length(deriv)/scaleFactor);float aspect=deriv.x !=0.0 ? atan(deriv.y,-deriv.x) : PI/2.0*(deriv.y > 0.0 ? 1.0 :-1.0);float intensity=u_light.x;float azimuth=u_light.y+PI;float base=1.875-intensity*1.75;float maxValue=0.5*PI;float scaledSlope=intensity !=0.5 ? ((pow(base,slope)-1.0)/(pow(base,maxValue)-1.0))*maxValue : slope;float accent=cos(scaledSlope);vec4 accent_color=(1.0-accent)*u_accent*clamp(intensity*2.0,0.0,1.0);float shade=abs(mod((aspect+azimuth)/PI+0.5,2.0)-1.0);vec4 shade_color=mix(u_shadow,u_highlight,shade)*sin(scaledSlope)*clamp(intensity*2.0,0.0,1.0);gl_FragColor=accent_color*(1.0-shade_color.a)+shade_color;
#ifdef FOG
gl_FragColor=fog_dither(fog_apply_premultiplied(gl_FragColor,v_fog_pos));
#endif
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,`uniform mat4 u_matrix;attribute vec2 a_pos;attribute vec2 a_texture_pos;varying vec2 v_pos;void main() {gl_Position=u_matrix*vec4(a_pos,0,1);v_pos=a_texture_pos/8192.0;
#ifdef FOG
v_fog_pos=fog_position(a_pos);
#endif
}`),line:Ai(`uniform lowp float u_device_pixel_ratio;uniform float u_alpha_discard_threshold;uniform highp vec2 u_trim_offset;varying vec2 v_width2;varying vec2 v_normal;varying float v_gamma_scale;varying highp vec4 v_uv;
#ifdef RENDER_LINE_DASH
uniform sampler2D u_dash_image;uniform float u_mix;uniform vec3 u_scale;varying vec2 v_tex_a;varying vec2 v_tex_b;
#endif
#ifdef RENDER_LINE_GRADIENT
uniform sampler2D u_gradient_image;
#endif
#pragma mapbox: define highp vec4 color
#pragma mapbox: define lowp float floorwidth
#pragma mapbox: define lowp vec4 dash_from
#pragma mapbox: define lowp vec4 dash_to
#pragma mapbox: define lowp float blur
#pragma mapbox: define lowp float opacity
void main() {
#pragma mapbox: initialize highp vec4 color
#pragma mapbox: initialize lowp float floorwidth
#pragma mapbox: initialize lowp vec4 dash_from
#pragma mapbox: initialize lowp vec4 dash_to
#pragma mapbox: initialize lowp float blur
#pragma mapbox: initialize lowp float opacity
float dist=length(v_normal)*v_width2.s;float blur2=(blur+1.0/u_device_pixel_ratio)*v_gamma_scale;float alpha=clamp(min(dist-(v_width2.t-blur2),v_width2.s-dist)/blur2,0.0,1.0);
#ifdef RENDER_LINE_DASH
float sdfdist_a=texture2D(u_dash_image,v_tex_a).a;float sdfdist_b=texture2D(u_dash_image,v_tex_b).a;float sdfdist=mix(sdfdist_a,sdfdist_b,u_mix);float sdfwidth=min(dash_from.z*u_scale.y,dash_to.z*u_scale.z);float sdfgamma=1.0/(2.0*u_device_pixel_ratio)/sdfwidth;alpha*=smoothstep(0.5-sdfgamma/floorwidth,0.5+sdfgamma/floorwidth,sdfdist);
#endif
#ifdef RENDER_LINE_GRADIENT
highp vec4 out_color=texture2D(u_gradient_image,v_uv.xy);
#else
vec4 out_color=color;
#endif
#ifdef RENDER_LINE_TRIM_OFFSET
highp float start=v_uv[2];highp float end=v_uv[3];highp float trim_start=u_trim_offset[0];highp float trim_end=u_trim_offset[1];highp float line_progress=(start+(v_uv.x)*(end-start));if (trim_end > trim_start) {if (line_progress <=trim_end && line_progress >=trim_start) {out_color=vec4(0,0,0,0);}}
#endif
#ifdef FOG
out_color=fog_dither(fog_apply_premultiplied(out_color,v_fog_pos));
#endif
#ifdef RENDER_LINE_ALPHA_DISCARD
if (alpha < u_alpha_discard_threshold) {discard;}
#endif
gl_FragColor=out_color*(alpha*opacity);
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,`
#define EXTRUDE_SCALE 0.015873016
attribute vec2 a_pos_normal;attribute vec4 a_data;
#if defined(RENDER_LINE_GRADIENT) || defined(RENDER_LINE_TRIM_OFFSET)
attribute highp vec4 a_packed;
#endif
#ifdef RENDER_LINE_DASH
attribute float a_linesofar;
#endif
uniform mat4 u_matrix;uniform mat2 u_pixels_to_tile_units;uniform vec2 u_units_to_pixels;uniform lowp float u_device_pixel_ratio;varying vec2 v_normal;varying vec2 v_width2;varying float v_gamma_scale;varying highp vec4 v_uv;
#ifdef RENDER_LINE_DASH
uniform vec2 u_texsize;uniform mediump vec3 u_scale;varying vec2 v_tex_a;varying vec2 v_tex_b;
#endif
#ifdef RENDER_LINE_GRADIENT
uniform float u_image_height;
#endif
#pragma mapbox: define highp vec4 color
#pragma mapbox: define lowp float floorwidth
#pragma mapbox: define lowp vec4 dash_from
#pragma mapbox: define lowp vec4 dash_to
#pragma mapbox: define lowp float blur
#pragma mapbox: define lowp float opacity
#pragma mapbox: define mediump float gapwidth
#pragma mapbox: define lowp float offset
#pragma mapbox: define mediump float width
void main() {
#pragma mapbox: initialize highp vec4 color
#pragma mapbox: initialize lowp float floorwidth
#pragma mapbox: initialize lowp vec4 dash_from
#pragma mapbox: initialize lowp vec4 dash_to
#pragma mapbox: initialize lowp float blur
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize mediump float gapwidth
#pragma mapbox: initialize lowp float offset
#pragma mapbox: initialize mediump float width
float ANTIALIASING=1.0/u_device_pixel_ratio/2.0;vec2 a_extrude=a_data.xy-128.0;float a_direction=mod(a_data.z,4.0)-1.0;vec2 pos=floor(a_pos_normal*0.5);mediump vec2 normal=a_pos_normal-2.0*pos;normal.y=normal.y*2.0-1.0;v_normal=normal;gapwidth=gapwidth/2.0;float halfwidth=width/2.0;offset=-1.0*offset;float inset=gapwidth+(gapwidth > 0.0 ? ANTIALIASING : 0.0);float outset=gapwidth+halfwidth*(gapwidth > 0.0 ? 2.0 : 1.0)+(halfwidth==0.0 ? 0.0 : ANTIALIASING);mediump vec2 dist=outset*a_extrude*EXTRUDE_SCALE;mediump float u=0.5*a_direction;mediump float t=1.0-abs(u);mediump vec2 offset2=offset*a_extrude*EXTRUDE_SCALE*normal.y*mat2(t,-u,u,t);vec4 projected_extrude=u_matrix*vec4(dist*u_pixels_to_tile_units,0.0,0.0);gl_Position=u_matrix*vec4(pos+offset2*u_pixels_to_tile_units,0.0,1.0)+projected_extrude;
#ifndef RENDER_TO_TEXTURE
float extrude_length_without_perspective=length(dist);float extrude_length_with_perspective=length(projected_extrude.xy/gl_Position.w*u_units_to_pixels);v_gamma_scale=extrude_length_without_perspective/extrude_length_with_perspective;
#else
v_gamma_scale=1.0;
#endif
#if defined(RENDER_LINE_GRADIENT) || defined(RENDER_LINE_TRIM_OFFSET)
float a_uv_x=a_packed[0];float a_split_index=a_packed[1];highp float a_clip_start=a_packed[2];highp float a_clip_end=a_packed[3];
#ifdef RENDER_LINE_GRADIENT
highp float texel_height=1.0/u_image_height;highp float half_texel_height=0.5*texel_height;v_uv=vec4(a_uv_x,a_split_index*texel_height-half_texel_height,a_clip_start,a_clip_end);
#else
v_uv=vec4(a_uv_x,0.0,a_clip_start,a_clip_end);
#endif
#endif
#ifdef RENDER_LINE_DASH
float tileZoomRatio=u_scale.x;float fromScale=u_scale.y;float toScale=u_scale.z;float scaleA=dash_from.z==0.0 ? 0.0 : tileZoomRatio/(dash_from.z*fromScale);float scaleB=dash_to.z==0.0 ? 0.0 : tileZoomRatio/(dash_to.z*toScale);float heightA=dash_from.y;float heightB=dash_to.y;v_tex_a=vec2(a_linesofar*scaleA/floorwidth,(-normal.y*heightA+dash_from.x+0.5)/u_texsize.y);v_tex_b=vec2(a_linesofar*scaleB/floorwidth,(-normal.y*heightB+dash_to.x+0.5)/u_texsize.y);
#endif
v_width2=vec2(outset,inset);
#ifdef FOG
v_fog_pos=fog_position(pos);
#endif
}`),linePattern:Ai(`uniform lowp float u_device_pixel_ratio;uniform vec2 u_texsize;uniform float u_fade;uniform mediump vec3 u_scale;uniform sampler2D u_image;varying vec2 v_normal;varying vec2 v_width2;varying float v_linesofar;varying float v_gamma_scale;varying float v_width;
#pragma mapbox: define lowp vec4 pattern_from
#pragma mapbox: define lowp vec4 pattern_to
#pragma mapbox: define lowp float pixel_ratio_from
#pragma mapbox: define lowp float pixel_ratio_to
#pragma mapbox: define lowp float blur
#pragma mapbox: define lowp float opacity
void main() {
#pragma mapbox: initialize mediump vec4 pattern_from
#pragma mapbox: initialize mediump vec4 pattern_to
#pragma mapbox: initialize lowp float pixel_ratio_from
#pragma mapbox: initialize lowp float pixel_ratio_to
#pragma mapbox: initialize lowp float blur
#pragma mapbox: initialize lowp float opacity
vec2 pattern_tl_a=pattern_from.xy;vec2 pattern_br_a=pattern_from.zw;vec2 pattern_tl_b=pattern_to.xy;vec2 pattern_br_b=pattern_to.zw;float tileZoomRatio=u_scale.x;float fromScale=u_scale.y;float toScale=u_scale.z;vec2 display_size_a=(pattern_br_a-pattern_tl_a)/pixel_ratio_from;vec2 display_size_b=(pattern_br_b-pattern_tl_b)/pixel_ratio_to;vec2 pattern_size_a=vec2(display_size_a.x*fromScale/tileZoomRatio,display_size_a.y);vec2 pattern_size_b=vec2(display_size_b.x*toScale/tileZoomRatio,display_size_b.y);float aspect_a=display_size_a.y/v_width;float aspect_b=display_size_b.y/v_width;float dist=length(v_normal)*v_width2.s;float blur2=(blur+1.0/u_device_pixel_ratio)*v_gamma_scale;float alpha=clamp(min(dist-(v_width2.t-blur2),v_width2.s-dist)/blur2,0.0,1.0);float x_a=mod(v_linesofar/pattern_size_a.x*aspect_a,1.0);float x_b=mod(v_linesofar/pattern_size_b.x*aspect_b,1.0);float y=0.5*v_normal.y+0.5;vec2 texel_size=1.0/u_texsize;vec2 pos_a=mix(pattern_tl_a*texel_size-texel_size,pattern_br_a*texel_size+texel_size,vec2(x_a,y));vec2 pos_b=mix(pattern_tl_b*texel_size-texel_size,pattern_br_b*texel_size+texel_size,vec2(x_b,y));vec4 color=mix(texture2D(u_image,pos_a),texture2D(u_image,pos_b),u_fade);
#ifdef FOG
color=fog_dither(fog_apply_premultiplied(color,v_fog_pos));
#endif
gl_FragColor=color*(alpha*opacity);
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,`
#define scale 0.015873016
attribute vec2 a_pos_normal;attribute vec4 a_data;attribute float a_linesofar;uniform mat4 u_matrix;uniform vec2 u_units_to_pixels;uniform mat2 u_pixels_to_tile_units;uniform lowp float u_device_pixel_ratio;varying vec2 v_normal;varying vec2 v_width2;varying float v_linesofar;varying float v_gamma_scale;varying float v_width;
#pragma mapbox: define lowp float blur
#pragma mapbox: define lowp float opacity
#pragma mapbox: define lowp float offset
#pragma mapbox: define mediump float gapwidth
#pragma mapbox: define mediump float width
#pragma mapbox: define lowp float floorwidth
#pragma mapbox: define lowp vec4 pattern_from
#pragma mapbox: define lowp vec4 pattern_to
#pragma mapbox: define lowp float pixel_ratio_from
#pragma mapbox: define lowp float pixel_ratio_to
void main() {
#pragma mapbox: initialize lowp float blur
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize lowp float offset
#pragma mapbox: initialize mediump float gapwidth
#pragma mapbox: initialize mediump float width
#pragma mapbox: initialize lowp float floorwidth
#pragma mapbox: initialize mediump vec4 pattern_from
#pragma mapbox: initialize mediump vec4 pattern_to
#pragma mapbox: initialize lowp float pixel_ratio_from
#pragma mapbox: initialize lowp float pixel_ratio_to
float ANTIALIASING=1.0/u_device_pixel_ratio/2.0;vec2 a_extrude=a_data.xy-128.0;float a_direction=mod(a_data.z,4.0)-1.0;vec2 pos=floor(a_pos_normal*0.5);mediump vec2 normal=a_pos_normal-2.0*pos;normal.y=normal.y*2.0-1.0;v_normal=normal;gapwidth=gapwidth/2.0;float halfwidth=width/2.0;offset=-1.0*offset;float inset=gapwidth+(gapwidth > 0.0 ? ANTIALIASING : 0.0);float outset=gapwidth+halfwidth*(gapwidth > 0.0 ? 2.0 : 1.0)+(halfwidth==0.0 ? 0.0 : ANTIALIASING);mediump vec2 dist=outset*a_extrude*scale;mediump float u=0.5*a_direction;mediump float t=1.0-abs(u);mediump vec2 offset2=offset*a_extrude*scale*normal.y*mat2(t,-u,u,t);vec4 projected_extrude=u_matrix*vec4(dist*u_pixels_to_tile_units,0.0,0.0);gl_Position=u_matrix*vec4(pos+offset2*u_pixels_to_tile_units,0.0,1.0)+projected_extrude;
#ifndef RENDER_TO_TEXTURE
float extrude_length_without_perspective=length(dist);float extrude_length_with_perspective=length(projected_extrude.xy/gl_Position.w*u_units_to_pixels);v_gamma_scale=extrude_length_without_perspective/extrude_length_with_perspective;
#else
v_gamma_scale=1.0;
#endif
v_linesofar=a_linesofar;v_width2=vec2(outset,inset);v_width=floorwidth;
#ifdef FOG
v_fog_pos=fog_position(pos);
#endif
}`),raster:Ai(`uniform float u_fade_t;uniform float u_opacity;uniform sampler2D u_image0;uniform sampler2D u_image1;varying vec2 v_pos0;varying vec2 v_pos1;uniform float u_brightness_low;uniform float u_brightness_high;uniform float u_saturation_factor;uniform float u_contrast_factor;uniform vec3 u_spin_weights;void main() {vec4 color0=texture2D(u_image0,v_pos0);vec4 color1=texture2D(u_image1,v_pos1);if (color0.a > 0.0) {color0.rgb=color0.rgb/color0.a;}if (color1.a > 0.0) {color1.rgb=color1.rgb/color1.a;}vec4 color=mix(color0,color1,u_fade_t);color.a*=u_opacity;vec3 rgb=color.rgb;rgb=vec3(
dot(rgb,u_spin_weights.xyz),dot(rgb,u_spin_weights.zxy),dot(rgb,u_spin_weights.yzx));float average=(color.r+color.g+color.b)/3.0;rgb+=(average-rgb)*u_saturation_factor;rgb=(rgb-0.5)*u_contrast_factor+0.5;vec3 u_high_vec=vec3(u_brightness_low,u_brightness_low,u_brightness_low);vec3 u_low_vec=vec3(u_brightness_high,u_brightness_high,u_brightness_high);vec3 out_color=mix(u_high_vec,u_low_vec,rgb);
#ifdef FOG
out_color=fog_dither(fog_apply(out_color,v_fog_pos));
#endif
gl_FragColor=vec4(out_color*color.a,color.a);
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,`uniform mat4 u_matrix;uniform vec2 u_tl_parent;uniform float u_scale_parent;uniform vec2 u_perspective_transform;attribute vec2 a_pos;attribute vec2 a_texture_pos;varying vec2 v_pos0;varying vec2 v_pos1;void main() {float w=1.0+dot(a_texture_pos,u_perspective_transform);gl_Position=u_matrix*vec4(a_pos*w,0,w);v_pos0=a_texture_pos/8192.0;v_pos1=(v_pos0*u_scale_parent)+u_tl_parent;
#ifdef FOG
v_fog_pos=fog_position(a_pos);
#endif
}`),symbolIcon:Ai(`uniform sampler2D u_texture;varying vec2 v_tex;varying float v_fade_opacity;
#pragma mapbox: define lowp float opacity
void main() {
#pragma mapbox: initialize lowp float opacity
lowp float alpha=opacity*v_fade_opacity;gl_FragColor=texture2D(u_texture,v_tex)*alpha;
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,`attribute vec4 a_pos_offset;attribute vec4 a_tex_size;attribute vec4 a_pixeloffset;attribute vec4 a_projected_pos;attribute float a_fade_opacity;
#ifdef PROJECTION_GLOBE_VIEW
attribute vec3 a_globe_anchor;attribute vec3 a_globe_normal;
#endif
uniform bool u_is_size_zoom_constant;uniform bool u_is_size_feature_constant;uniform highp float u_size_t;uniform highp float u_size;uniform highp float u_camera_to_center_distance;uniform bool u_rotate_symbol;uniform highp float u_aspect_ratio;uniform float u_fade_change;uniform mat4 u_matrix;uniform mat4 u_label_plane_matrix;uniform mat4 u_coord_matrix;uniform bool u_is_text;uniform bool u_pitch_with_map;uniform vec2 u_texsize;uniform vec3 u_up_vector;
#ifdef PROJECTION_GLOBE_VIEW
uniform vec3 u_tile_id;uniform mat4 u_inv_rot_matrix;uniform vec2 u_merc_center;uniform vec3 u_camera_forward;uniform float u_zoom_transition;uniform vec3 u_ecef_origin;uniform mat4 u_tile_matrix;
#endif
varying vec2 v_tex;varying float v_fade_opacity;
#pragma mapbox: define lowp float opacity
void main() {
#pragma mapbox: initialize lowp float opacity
vec2 a_pos=a_pos_offset.xy;vec2 a_offset=a_pos_offset.zw;vec2 a_tex=a_tex_size.xy;vec2 a_size=a_tex_size.zw;float a_size_min=floor(a_size[0]*0.5);vec2 a_pxoffset=a_pixeloffset.xy;vec2 a_min_font_scale=a_pixeloffset.zw/256.0;highp float segment_angle=-a_projected_pos[3];float size;if (!u_is_size_zoom_constant && !u_is_size_feature_constant) {size=mix(a_size_min,a_size[1],u_size_t)/128.0;} else if (u_is_size_zoom_constant && !u_is_size_feature_constant) {size=a_size_min/128.0;} else {size=u_size;}vec2 tile_anchor=a_pos;vec3 h=elevationVector(tile_anchor)*elevation(tile_anchor);
#ifdef PROJECTION_GLOBE_VIEW
vec3 mercator_pos=mercator_tile_position(u_inv_rot_matrix,tile_anchor,u_tile_id,u_merc_center);vec3 world_pos=mix_globe_mercator(a_globe_anchor+h,mercator_pos,u_zoom_transition);vec4 ecef_point=u_tile_matrix*vec4(world_pos,1.0);vec3 origin_to_point=ecef_point.xyz-u_ecef_origin;float globe_occlusion_fade=dot(origin_to_point,u_camera_forward) >=0.0 ? 0.0 : 1.0;
#else
vec3 world_pos=vec3(tile_anchor,0)+h;float globe_occlusion_fade=1.0;
#endif
vec4 projected_point=u_matrix*vec4(world_pos,1);highp float camera_to_anchor_distance=projected_point.w;highp float distance_ratio=u_pitch_with_map ?
camera_to_anchor_distance/u_camera_to_center_distance :
u_camera_to_center_distance/camera_to_anchor_distance;highp float perspective_ratio=clamp(
0.5+0.5*distance_ratio,0.0,1.5);size*=perspective_ratio;float font_scale=u_is_text ? size/24.0 : size;highp float symbol_rotation=0.0;if (u_rotate_symbol) {
#ifdef PROJECTION_GLOBE_VIEW
vec3 displacement=vec3(a_globe_normal.z,0,-a_globe_normal.x);vec4 offsetProjected_point=u_matrix*vec4(a_globe_anchor+displacement,1);
#else
vec4 offsetProjected_point=u_matrix*vec4(tile_anchor+vec2(1,0),0,1);
#endif
vec2 a=projected_point.xy/projected_point.w;vec2 b=offsetProjected_point.xy/offsetProjected_point.w;symbol_rotation=atan((b.y-a.y)/u_aspect_ratio,b.x-a.x);}
#ifdef PROJECTION_GLOBE_VIEW
vec3 proj_pos=mix_globe_mercator(a_projected_pos.xyz+h,mercator_pos,u_zoom_transition);vec4 projected_pos=u_label_plane_matrix*vec4(proj_pos,1.0);
#else
vec4 projected_pos=u_label_plane_matrix*vec4(a_projected_pos.xy,h.z,1.0);
#endif
highp float angle_sin=sin(segment_angle+symbol_rotation);highp float angle_cos=cos(segment_angle+symbol_rotation);mat2 rotation_matrix=mat2(angle_cos,-1.0*angle_sin,angle_sin,angle_cos);float z=0.0;vec2 offset=rotation_matrix*(a_offset/32.0*max(a_min_font_scale,font_scale)+a_pxoffset/16.0);
#ifdef PITCH_WITH_MAP_TERRAIN
vec4 tile_pos=u_label_plane_matrix_inv*vec4(a_projected_pos.xy+offset,0.0,1.0);z=elevation(tile_pos.xy);
#endif
float occlusion_fade=occlusionFade(projected_point)*globe_occlusion_fade;
#ifdef PROJECTION_GLOBE_VIEW
vec3 xAxis=u_pitch_with_map ? normalize(cross(a_globe_normal,u_up_vector)) : vec3(1,0,0);vec3 yAxis=u_pitch_with_map ? normalize(cross(a_globe_normal,xAxis)) : vec3(0,1,0);gl_Position=mix(u_coord_matrix*vec4(projected_pos.xyz/projected_pos.w+xAxis*offset.x+yAxis*offset.y,1.0),AWAY,float(projected_point.w <=0.0 || occlusion_fade==0.0));
#else
gl_Position=mix(u_coord_matrix*vec4(projected_pos.xy/projected_pos.w+offset,z,1.0),AWAY,float(projected_point.w <=0.0 || occlusion_fade==0.0));
#endif
float projection_transition_fade=1.0;
#if defined(PROJECTED_POS_ON_VIEWPORT) && defined(PROJECTION_GLOBE_VIEW)
projection_transition_fade=1.0-step(EPSILON,u_zoom_transition);
#endif
v_tex=a_tex/u_texsize;vec2 fade_opacity=unpack_opacity(a_fade_opacity);float fade_change=fade_opacity[1] > 0.5 ? u_fade_change :-u_fade_change;v_fade_opacity=max(0.0,min(occlusion_fade,fade_opacity[0]+fade_change))*projection_transition_fade;}`),symbolSDF:Ai(`#define SDF_PX 8.0
uniform bool u_is_halo;uniform sampler2D u_texture;uniform highp float u_gamma_scale;uniform lowp float u_device_pixel_ratio;uniform bool u_is_text;varying vec2 v_data0;varying vec3 v_data1;
#pragma mapbox: define highp vec4 fill_color
#pragma mapbox: define highp vec4 halo_color
#pragma mapbox: define lowp float opacity
#pragma mapbox: define lowp float halo_width
#pragma mapbox: define lowp float halo_blur
void main() {
#pragma mapbox: initialize highp vec4 fill_color
#pragma mapbox: initialize highp vec4 halo_color
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize lowp float halo_width
#pragma mapbox: initialize lowp float halo_blur
float EDGE_GAMMA=0.105/u_device_pixel_ratio;vec2 tex=v_data0.xy;float gamma_scale=v_data1.x;float size=v_data1.y;float fade_opacity=v_data1[2];float fontScale=u_is_text ? size/24.0 : size;lowp vec4 color=fill_color;highp float gamma=EDGE_GAMMA/(fontScale*u_gamma_scale);lowp float buff=(256.0-64.0)/256.0;if (u_is_halo) {color=halo_color;gamma=(halo_blur*1.19/SDF_PX+EDGE_GAMMA)/(fontScale*u_gamma_scale);buff=(6.0-halo_width/fontScale)/SDF_PX;}lowp float dist=texture2D(u_texture,tex).a;highp float gamma_scaled=gamma*gamma_scale;highp float alpha=smoothstep(buff-gamma_scaled,buff+gamma_scaled,dist);gl_FragColor=color*(alpha*opacity*fade_opacity);
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,`attribute vec4 a_pos_offset;attribute vec4 a_tex_size;attribute vec4 a_pixeloffset;attribute vec4 a_projected_pos;attribute float a_fade_opacity;
#ifdef PROJECTION_GLOBE_VIEW
attribute vec3 a_globe_anchor;attribute vec3 a_globe_normal;
#endif
uniform bool u_is_size_zoom_constant;uniform bool u_is_size_feature_constant;uniform highp float u_size_t;uniform highp float u_size;uniform mat4 u_matrix;uniform mat4 u_label_plane_matrix;uniform mat4 u_coord_matrix;uniform bool u_is_text;uniform bool u_pitch_with_map;uniform bool u_rotate_symbol;uniform highp float u_aspect_ratio;uniform highp float u_camera_to_center_distance;uniform float u_fade_change;uniform vec2 u_texsize;uniform vec3 u_up_vector;
#ifdef PROJECTION_GLOBE_VIEW
uniform vec3 u_tile_id;uniform mat4 u_inv_rot_matrix;uniform vec2 u_merc_center;uniform vec3 u_camera_forward;uniform float u_zoom_transition;uniform vec3 u_ecef_origin;uniform mat4 u_tile_matrix;
#endif
varying vec2 v_data0;varying vec3 v_data1;
#pragma mapbox: define highp vec4 fill_color
#pragma mapbox: define highp vec4 halo_color
#pragma mapbox: define lowp float opacity
#pragma mapbox: define lowp float halo_width
#pragma mapbox: define lowp float halo_blur
void main() {
#pragma mapbox: initialize highp vec4 fill_color
#pragma mapbox: initialize highp vec4 halo_color
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize lowp float halo_width
#pragma mapbox: initialize lowp float halo_blur
vec2 a_pos=a_pos_offset.xy;vec2 a_offset=a_pos_offset.zw;vec2 a_tex=a_tex_size.xy;vec2 a_size=a_tex_size.zw;float a_size_min=floor(a_size[0]*0.5);vec2 a_pxoffset=a_pixeloffset.xy;highp float segment_angle=-a_projected_pos[3];float size;if (!u_is_size_zoom_constant && !u_is_size_feature_constant) {size=mix(a_size_min,a_size[1],u_size_t)/128.0;} else if (u_is_size_zoom_constant && !u_is_size_feature_constant) {size=a_size_min/128.0;} else {size=u_size;}vec2 tile_anchor=a_pos;vec3 h=elevationVector(tile_anchor)*elevation(tile_anchor);
#ifdef PROJECTION_GLOBE_VIEW
vec3 mercator_pos=mercator_tile_position(u_inv_rot_matrix,tile_anchor,u_tile_id,u_merc_center);vec3 world_pos=mix_globe_mercator(a_globe_anchor+h,mercator_pos,u_zoom_transition);vec4 ecef_point=u_tile_matrix*vec4(world_pos,1.0);vec3 origin_to_point=ecef_point.xyz-u_ecef_origin;float globe_occlusion_fade=dot(origin_to_point,u_camera_forward) >=0.0 ? 0.0 : 1.0;
#else
vec3 world_pos=vec3(tile_anchor,0)+h;float globe_occlusion_fade=1.0;
#endif
vec4 projected_point=u_matrix*vec4(world_pos,1);highp float camera_to_anchor_distance=projected_point.w;highp float distance_ratio=u_pitch_with_map ?
camera_to_anchor_distance/u_camera_to_center_distance :
u_camera_to_center_distance/camera_to_anchor_distance;highp float perspective_ratio=clamp(
0.5+0.5*distance_ratio,0.0,1.5);size*=perspective_ratio;float fontScale=u_is_text ? size/24.0 : size;highp float symbol_rotation=0.0;if (u_rotate_symbol) {
#ifdef PROJECTION_GLOBE_VIEW
vec3 displacement=vec3(a_globe_normal.z,0,-a_globe_normal.x);vec4 offsetprojected_point=u_matrix*vec4(a_globe_anchor+displacement,1);
#else
vec4 offsetprojected_point=u_matrix*vec4(tile_anchor+vec2(1,0),0,1);
#endif
vec2 a=projected_point.xy/projected_point.w;vec2 b=offsetprojected_point.xy/offsetprojected_point.w;symbol_rotation=atan((b.y-a.y)/u_aspect_ratio,b.x-a.x);}
#ifdef PROJECTION_GLOBE_VIEW
vec3 proj_pos=mix_globe_mercator(a_projected_pos.xyz+h,mercator_pos,u_zoom_transition);vec4 projected_pos=u_label_plane_matrix*vec4(proj_pos,1.0);
#else
vec4 projected_pos=u_label_plane_matrix*vec4(a_projected_pos.xy,h.z,1.0);
#endif
highp float angle_sin=sin(segment_angle+symbol_rotation);highp float angle_cos=cos(segment_angle+symbol_rotation);mat2 rotation_matrix=mat2(angle_cos,-1.0*angle_sin,angle_sin,angle_cos);float z=0.0;vec2 offset=rotation_matrix*(a_offset/32.0*fontScale+a_pxoffset);
#ifdef PITCH_WITH_MAP_TERRAIN
vec4 tile_pos=u_label_plane_matrix_inv*vec4(a_projected_pos.xy+offset,0.0,1.0);z=elevation(tile_pos.xy);
#endif
float occlusion_fade=occlusionFade(projected_point)*globe_occlusion_fade;
#ifdef PROJECTION_GLOBE_VIEW
vec3 xAxis=u_pitch_with_map ? normalize(cross(a_globe_normal,u_up_vector)) : vec3(1,0,0);vec3 yAxis=u_pitch_with_map ? normalize(cross(a_globe_normal,xAxis)) : vec3(0,1,0);gl_Position=mix(u_coord_matrix*vec4(projected_pos.xyz/projected_pos.w+xAxis*offset.x+yAxis*offset.y,1.0),AWAY,float(projected_point.w <=0.0 || occlusion_fade==0.0));
#else
gl_Position=mix(u_coord_matrix*vec4(projected_pos.xy/projected_pos.w+offset,z,1.0),AWAY,float(projected_point.w <=0.0 || occlusion_fade==0.0));
#endif
float gamma_scale=gl_Position.w;float projection_transition_fade=1.0;
#if defined(PROJECTED_POS_ON_VIEWPORT) && defined(PROJECTION_GLOBE_VIEW)
projection_transition_fade=1.0-step(EPSILON,u_zoom_transition);
#endif
vec2 fade_opacity=unpack_opacity(a_fade_opacity);float fade_change=fade_opacity[1] > 0.5 ? u_fade_change :-u_fade_change;float interpolated_fade_opacity=max(0.0,min(occlusion_fade,fade_opacity[0]+fade_change));v_data0=a_tex/u_texsize;v_data1=vec3(gamma_scale,size,interpolated_fade_opacity*projection_transition_fade);}`),symbolTextAndIcon:Ai(`#define SDF_PX 8.0
#define SDF 1.0
#define ICON 0.0
uniform bool u_is_halo;uniform sampler2D u_texture;uniform sampler2D u_texture_icon;uniform highp float u_gamma_scale;uniform lowp float u_device_pixel_ratio;varying vec4 v_data0;varying vec4 v_data1;
#pragma mapbox: define highp vec4 fill_color
#pragma mapbox: define highp vec4 halo_color
#pragma mapbox: define lowp float opacity
#pragma mapbox: define lowp float halo_width
#pragma mapbox: define lowp float halo_blur
void main() {
#pragma mapbox: initialize highp vec4 fill_color
#pragma mapbox: initialize highp vec4 halo_color
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize lowp float halo_width
#pragma mapbox: initialize lowp float halo_blur
float fade_opacity=v_data1[2];if (v_data1.w==ICON) {vec2 tex_icon=v_data0.zw;lowp float alpha=opacity*fade_opacity;gl_FragColor=texture2D(u_texture_icon,tex_icon)*alpha;
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
return;}vec2 tex=v_data0.xy;float EDGE_GAMMA=0.105/u_device_pixel_ratio;float gamma_scale=v_data1.x;float size=v_data1.y;float fontScale=size/24.0;lowp vec4 color=fill_color;highp float gamma=EDGE_GAMMA/(fontScale*u_gamma_scale);lowp float buff=(256.0-64.0)/256.0;if (u_is_halo) {color=halo_color;gamma=(halo_blur*1.19/SDF_PX+EDGE_GAMMA)/(fontScale*u_gamma_scale);buff=(6.0-halo_width/fontScale)/SDF_PX;}lowp float dist=texture2D(u_texture,tex).a;highp float gamma_scaled=gamma*gamma_scale;highp float alpha=smoothstep(buff-gamma_scaled,buff+gamma_scaled,dist);gl_FragColor=color*(alpha*opacity*fade_opacity);
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,`attribute vec4 a_pos_offset;attribute vec4 a_tex_size;attribute vec4 a_projected_pos;attribute float a_fade_opacity;
#ifdef PROJECTION_GLOBE_VIEW
attribute vec3 a_globe_anchor;attribute vec3 a_globe_normal;
#endif
uniform bool u_is_size_zoom_constant;uniform bool u_is_size_feature_constant;uniform highp float u_size_t;uniform highp float u_size;uniform mat4 u_matrix;uniform mat4 u_label_plane_matrix;uniform mat4 u_coord_matrix;uniform bool u_is_text;uniform bool u_pitch_with_map;uniform bool u_rotate_symbol;uniform highp float u_aspect_ratio;uniform highp float u_camera_to_center_distance;uniform float u_fade_change;uniform vec2 u_texsize;uniform vec3 u_up_vector;uniform vec2 u_texsize_icon;
#ifdef PROJECTION_GLOBE_VIEW
uniform vec3 u_tile_id;uniform mat4 u_inv_rot_matrix;uniform vec2 u_merc_center;uniform vec3 u_camera_forward;uniform float u_zoom_transition;uniform vec3 u_ecef_origin;uniform mat4 u_tile_matrix;
#endif
varying vec4 v_data0;varying vec4 v_data1;
#pragma mapbox: define highp vec4 fill_color
#pragma mapbox: define highp vec4 halo_color
#pragma mapbox: define lowp float opacity
#pragma mapbox: define lowp float halo_width
#pragma mapbox: define lowp float halo_blur
void main() {
#pragma mapbox: initialize highp vec4 fill_color
#pragma mapbox: initialize highp vec4 halo_color
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize lowp float halo_width
#pragma mapbox: initialize lowp float halo_blur
vec2 a_pos=a_pos_offset.xy;vec2 a_offset=a_pos_offset.zw;vec2 a_tex=a_tex_size.xy;vec2 a_size=a_tex_size.zw;float a_size_min=floor(a_size[0]*0.5);float is_sdf=a_size[0]-2.0*a_size_min;highp float segment_angle=-a_projected_pos[3];float size;if (!u_is_size_zoom_constant && !u_is_size_feature_constant) {size=mix(a_size_min,a_size[1],u_size_t)/128.0;} else if (u_is_size_zoom_constant && !u_is_size_feature_constant) {size=a_size_min/128.0;} else {size=u_size;}vec2 tile_anchor=a_pos;vec3 h=elevationVector(tile_anchor)*elevation(tile_anchor);
#ifdef PROJECTION_GLOBE_VIEW
vec3 mercator_pos=mercator_tile_position(u_inv_rot_matrix,tile_anchor,u_tile_id,u_merc_center);vec3 world_pos=mix_globe_mercator(a_globe_anchor+h,mercator_pos,u_zoom_transition);vec4 ecef_point=u_tile_matrix*vec4(world_pos,1.0);vec3 origin_to_point=ecef_point.xyz-u_ecef_origin;float globe_occlusion_fade=dot(origin_to_point,u_camera_forward) >=0.0 ? 0.0 : 1.0;
#else
vec3 world_pos=vec3(tile_anchor,0)+h;float globe_occlusion_fade=1.0;
#endif
vec4 projected_point=u_matrix*vec4(world_pos,1);highp float camera_to_anchor_distance=projected_point.w;highp float distance_ratio=u_pitch_with_map ?
camera_to_anchor_distance/u_camera_to_center_distance :
u_camera_to_center_distance/camera_to_anchor_distance;highp float perspective_ratio=clamp(
0.5+0.5*distance_ratio,0.0,1.5);size*=perspective_ratio;float font_scale=size/24.0;highp float symbol_rotation=0.0;if (u_rotate_symbol) {vec4 offset_projected_point=u_matrix*vec4(a_pos+vec2(1,0),0,1);vec2 a=projected_point.xy/projected_point.w;vec2 b=offset_projected_point.xy/offset_projected_point.w;symbol_rotation=atan((b.y-a.y)/u_aspect_ratio,b.x-a.x);}
#ifdef PROJECTION_GLOBE_VIEW
vec3 proj_pos=mix_globe_mercator(a_projected_pos.xyz+h,mercator_pos,u_zoom_transition);vec4 projected_pos=u_label_plane_matrix*vec4(proj_pos,1.0);
#else
vec4 projected_pos=u_label_plane_matrix*vec4(a_projected_pos.xy,h.z,1.0);
#endif
highp float angle_sin=sin(segment_angle+symbol_rotation);highp float angle_cos=cos(segment_angle+symbol_rotation);mat2 rotation_matrix=mat2(angle_cos,-1.0*angle_sin,angle_sin,angle_cos);float z=0.0;vec2 offset=rotation_matrix*(a_offset/32.0*font_scale);
#ifdef PITCH_WITH_MAP_TERRAIN
vec4 tile_pos=u_label_plane_matrix_inv*vec4(a_projected_pos.xy+offset,0.0,1.0);z=elevation(tile_pos.xy);
#endif
float occlusion_fade=occlusionFade(projected_point)*globe_occlusion_fade;
#ifdef PROJECTION_GLOBE_VIEW
vec3 xAxis=u_pitch_with_map ? normalize(cross(a_globe_normal,u_up_vector)) : vec3(1,0,0);vec3 yAxis=u_pitch_with_map ? normalize(cross(a_globe_normal,xAxis)) : vec3(0,1,0);gl_Position=mix(u_coord_matrix*vec4(projected_pos.xyz/projected_pos.w+xAxis*offset.x+yAxis*offset.y,1.0),AWAY,float(projected_point.w <=0.0 || occlusion_fade==0.0));
#else
gl_Position=mix(u_coord_matrix*vec4(projected_pos.xy/projected_pos.w+offset,z,1.0),AWAY,float(projected_point.w <=0.0 || occlusion_fade==0.0));
#endif
float gamma_scale=gl_Position.w;vec2 fade_opacity=unpack_opacity(a_fade_opacity);float fade_change=fade_opacity[1] > 0.5 ? u_fade_change :-u_fade_change;float interpolated_fade_opacity=max(0.0,min(occlusion_fade,fade_opacity[0]+fade_change));float projection_transition_fade=1.0;
#if defined(PROJECTED_POS_ON_VIEWPORT) && defined(PROJECTION_GLOBE_VIEW)
projection_transition_fade=1.0-step(EPSILON,u_zoom_transition);
#endif
v_data0.xy=a_tex/u_texsize;v_data0.zw=a_tex/u_texsize_icon;v_data1=vec4(gamma_scale,size,interpolated_fade_opacity*projection_transition_fade,is_sdf);}`),terrainRaster:Ai(`uniform sampler2D u_image0;varying vec2 v_pos0;
#ifdef FOG
varying float v_fog_opacity;
#endif
void main() {vec4 color=texture2D(u_image0,v_pos0);
#ifdef FOG
color=fog_dither(fog_apply_from_vert(color,v_fog_opacity));
#endif
gl_FragColor=color;
#ifdef TERRAIN_WIREFRAME
gl_FragColor=vec4(1.0,0.0,0.0,0.8);
#endif
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,`uniform mat4 u_matrix;uniform float u_skirt_height;attribute vec2 a_pos;attribute vec2 a_texture_pos;varying vec2 v_pos0;
#ifdef FOG
varying float v_fog_opacity;
#endif
const float skirtOffset=24575.0;const float wireframeOffset=0.00015;void main() {v_pos0=a_texture_pos/8192.0;float skirt=float(a_pos.x >=skirtOffset);float elevation=elevation(a_texture_pos)-skirt*u_skirt_height;
#ifdef TERRAIN_WIREFRAME
elevation+=u_skirt_height*u_skirt_height*wireframeOffset;
#endif
vec2 decodedPos=a_pos-vec2(skirt*skirtOffset,0.0);gl_Position=u_matrix*vec4(decodedPos,elevation,1.0);
#ifdef FOG
v_fog_opacity=fog(fog_position(vec3(decodedPos,elevation)));
#endif
}`),terrainDepth:Ai(`#ifdef GL_ES
precision highp float;
#endif
varying float v_depth;void main() {gl_FragColor=pack_depth(v_depth);}`,"uniform mat4 u_matrix;attribute vec2 a_pos;attribute vec2 a_texture_pos;varying float v_depth;void main() {float elevation=elevation(a_texture_pos);gl_Position=u_matrix*vec4(a_pos,elevation,1.0);v_depth=gl_Position.z/gl_Position.w;}"),skybox:Ai(`
varying lowp vec3 v_uv;uniform lowp samplerCube u_cubemap;uniform lowp float u_opacity;uniform highp float u_temporal_offset;uniform highp vec3 u_sun_direction;float sun_disk(highp vec3 ray_direction,highp vec3 sun_direction) {highp float cos_angle=dot(normalize(ray_direction),sun_direction);const highp float cos_sun_angular_diameter=0.99996192306;const highp float smoothstep_delta=1e-5;return smoothstep(
cos_sun_angular_diameter-smoothstep_delta,cos_sun_angular_diameter+smoothstep_delta,cos_angle);}float map(float value,float start,float end,float new_start,float new_end) {return ((value-start)*(new_end-new_start))/(end-start)+new_start;}void main() {vec3 uv=v_uv;const float y_bias=0.015;uv.y+=y_bias;uv.y=pow(abs(uv.y),1.0/5.0);uv.y=map(uv.y,0.0,1.0,-1.0,1.0);vec3 sky_color=textureCube(u_cubemap,uv).rgb;
#ifdef FOG
sky_color=fog_apply_sky_gradient(v_uv.xzy,sky_color);
#endif
sky_color.rgb=dither(sky_color.rgb,gl_FragCoord.xy+u_temporal_offset);sky_color+=0.1*sun_disk(v_uv,u_sun_direction);gl_FragColor=vec4(sky_color*u_opacity,u_opacity);
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,gc),skyboxGradient:Ai(`varying highp vec3 v_uv;uniform lowp sampler2D u_color_ramp;uniform highp vec3 u_center_direction;uniform lowp float u_radius;uniform lowp float u_opacity;uniform highp float u_temporal_offset;void main() {float progress=acos(dot(normalize(v_uv),u_center_direction))/u_radius;vec4 color=texture2D(u_color_ramp,vec2(progress,0.5));
#ifdef FOG
color.rgb=fog_apply_sky_gradient(v_uv.xzy,color.rgb/color.a)*color.a;
#endif
color*=u_opacity;color.rgb=dither(color.rgb,gl_FragCoord.xy+u_temporal_offset);gl_FragColor=color;
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,gc),skyboxCapture:Ai(`
varying highp vec3 v_position;uniform highp float u_sun_intensity;uniform highp float u_luminance;uniform lowp vec3 u_sun_direction;uniform highp vec4 u_color_tint_r;uniform highp vec4 u_color_tint_m;
#ifdef GL_ES
precision highp float;
#endif
#define BETA_R                  vec3(5.5e-6,13.0e-6,22.4e-6)
#define BETA_M                  vec3(21e-6,21e-6,21e-6)
#define MIE_G                   0.76
#define DENSITY_HEIGHT_SCALE_R  8000.0
#define DENSITY_HEIGHT_SCALE_M  1200.0
#define PLANET_RADIUS           6360e3
#define ATMOSPHERE_RADIUS       6420e3
#define SAMPLE_STEPS            10
#define DENSITY_STEPS           4
float ray_sphere_exit(vec3 orig,vec3 dir,float radius) {float a=dot(dir,dir);float b=2.0*dot(dir,orig);float c=dot(orig,orig)-radius*radius;float d=sqrt(b*b-4.0*a*c);return (-b+d)/(2.0*a);}vec3 extinction(vec2 density) {return exp(-vec3(BETA_R*u_color_tint_r.a*density.x+BETA_M*u_color_tint_m.a*density.y));}vec2 local_density(vec3 point) {float height=max(length(point)-PLANET_RADIUS,0.0);float exp_r=exp(-height/DENSITY_HEIGHT_SCALE_R);float exp_m=exp(-height/DENSITY_HEIGHT_SCALE_M);return vec2(exp_r,exp_m);}float phase_ray(float cos_angle) {return (3.0/(16.0*PI))*(1.0+cos_angle*cos_angle);}float phase_mie(float cos_angle) {return (3.0/(8.0*PI))*((1.0-MIE_G*MIE_G)*(1.0+cos_angle*cos_angle))/((2.0+MIE_G*MIE_G)*pow(1.0+MIE_G*MIE_G-2.0*MIE_G*cos_angle,1.5));}vec2 density_to_atmosphere(vec3 point,vec3 light_dir) {float ray_len=ray_sphere_exit(point,light_dir,ATMOSPHERE_RADIUS);float step_len=ray_len/float(DENSITY_STEPS);vec2 density_point_to_atmosphere=vec2(0.0);for (int i=0; i < DENSITY_STEPS;++i) {vec3 point_on_ray=point+light_dir*((float(i)+0.5)*step_len);density_point_to_atmosphere+=local_density(point_on_ray)*step_len;;}return density_point_to_atmosphere;}vec3 atmosphere(vec3 ray_dir,vec3 sun_direction,float sun_intensity) {vec2 density_orig_to_point=vec2(0.0);vec3 scatter_r=vec3(0.0);vec3 scatter_m=vec3(0.0);vec3 origin=vec3(0.0,PLANET_RADIUS,0.0);float ray_len=ray_sphere_exit(origin,ray_dir,ATMOSPHERE_RADIUS);float step_len=ray_len/float(SAMPLE_STEPS);for (int i=0; i < SAMPLE_STEPS;++i) {vec3 point_on_ray=origin+ray_dir*((float(i)+0.5)*step_len);vec2 density=local_density(point_on_ray)*step_len;density_orig_to_point+=density;vec2 density_point_to_atmosphere=density_to_atmosphere(point_on_ray,sun_direction);vec2 density_orig_to_atmosphere=density_orig_to_point+density_point_to_atmosphere;vec3 extinction=extinction(density_orig_to_atmosphere);scatter_r+=density.x*extinction;scatter_m+=density.y*extinction;}float cos_angle=dot(ray_dir,sun_direction);float phase_r=phase_ray(cos_angle);float phase_m=phase_mie(cos_angle);vec3 beta_r=BETA_R*u_color_tint_r.rgb*u_color_tint_r.a;vec3 beta_m=BETA_M*u_color_tint_m.rgb*u_color_tint_m.a;return (scatter_r*phase_r*beta_r+scatter_m*phase_m*beta_m)*sun_intensity;}const float A=0.15;const float B=0.50;const float C=0.10;const float D=0.20;const float E=0.02;const float F=0.30;vec3 uncharted2_tonemap(vec3 x) {return ((x*(A*x+C*B)+D*E)/(x*(A*x+B)+D*F))-E/F;}void main() {vec3 ray_direction=v_position;ray_direction.y=pow(ray_direction.y,5.0);const float y_bias=0.015;ray_direction.y+=y_bias;vec3 color=atmosphere(normalize(ray_direction),u_sun_direction,u_sun_intensity);float white_scale=1.0748724675633854;color=uncharted2_tonemap((log2(2.0/pow(u_luminance,4.0)))*color)*white_scale;gl_FragColor=vec4(color,1.0);}`,"attribute highp vec3 a_pos_3f;uniform mat3 u_matrix_3f;varying highp vec3 v_position;float map(float value,float start,float end,float new_start,float new_end) {return ((value-start)*(new_end-new_start))/(end-start)+new_start;}void main() {vec4 pos=vec4(u_matrix_3f*a_pos_3f,1.0);v_position=pos.xyz;v_position.y*=-1.0;v_position.y=map(v_position.y,-1.0,1.0,0.0,1.0);gl_Position=vec4(a_pos_3f.xy,0.0,1.0);}"),globeRaster:Ai(`uniform sampler2D u_image0;varying vec2 v_pos0;
#ifndef FOG
uniform highp vec3 u_frustum_tl;uniform highp vec3 u_frustum_tr;uniform highp vec3 u_frustum_br;uniform highp vec3 u_frustum_bl;uniform highp vec3 u_globe_pos;uniform highp float u_globe_radius;uniform vec2 u_viewport;
#endif
void main() {
#ifdef CUSTOM_ANTIALIASING
vec2 uv=gl_FragCoord.xy/u_viewport;highp vec3 ray_dir=mix(
mix(u_frustum_tl,u_frustum_tr,uv.x),mix(u_frustum_bl,u_frustum_br,uv.x),1.0-uv.y);vec3 dir=normalize(ray_dir);vec3 closest_point=dot(u_globe_pos,dir)*dir;float norm_dist_from_center=1.0-length(closest_point-u_globe_pos)/u_globe_radius;const float antialias_pixel=2.0;float antialias_factor=antialias_pixel*fwidth(norm_dist_from_center);float antialias=smoothstep(0.0,antialias_factor,norm_dist_from_center);vec4 raster=texture2D(u_image0,v_pos0);vec4 color=vec4(raster.rgb*antialias,raster.a*antialias);
#else
vec4 color=texture2D(u_image0,v_pos0);
#endif
#ifdef FOG
color=fog_dither(fog_apply_premultiplied(color,v_fog_pos));
#endif
gl_FragColor=color;
#ifdef TERRAIN_WIREFRAME
gl_FragColor=vec4(1.0,0.0,0.0,0.8);
#endif
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,`uniform mat4 u_proj_matrix;uniform mat4 u_normalize_matrix;uniform mat4 u_globe_matrix;uniform mat4 u_merc_matrix;uniform float u_zoom_transition;uniform vec2 u_merc_center;uniform mat3 u_grid_matrix;
#ifdef GLOBE_POLES
attribute vec3 a_globe_pos;attribute vec2 a_merc_pos;attribute vec2 a_uv;
#else
attribute vec2 a_pos;
#endif
varying vec2 v_pos0;const float wireframeOffset=1e3;float mercatorXfromLng(float lng) {return (180.0+lng)/360.0;}float mercatorYfromLat(float lat) {return (180.0-(RAD_TO_DEG*log(tan(QUARTER_PI+lat/2.0*DEG_TO_RAD))))/360.0;}vec3 latLngToECEF(vec2 latLng) {latLng=DEG_TO_RAD*latLng;float cosLat=cos(latLng[0]);float sinLat=sin(latLng[0]);float cosLng=cos(latLng[1]);float sinLng=sin(latLng[1]);float sx=cosLat*sinLng*GLOBE_RADIUS;float sy=-sinLat*GLOBE_RADIUS;float sz=cosLat*cosLng*GLOBE_RADIUS;return vec3(sx,sy,sz);}void main() {
#ifdef GLOBE_POLES
vec3 globe_pos=a_globe_pos;vec2 merc_pos=a_merc_pos;vec2 uv=a_uv;
#else
float tiles=u_grid_matrix[0][2];float idy=u_grid_matrix[1][2];float S=u_grid_matrix[2][2];vec3 latLng=u_grid_matrix*vec3(a_pos,1.0);float mercatorY=mercatorYfromLat(latLng[0]);float uvY=mercatorY*tiles-idy;float mercatorX=mercatorXfromLng(latLng[1]);float uvX=a_pos[0]*S;vec3 globe_pos=latLngToECEF(latLng.xy);vec2 merc_pos=vec2(mercatorX,mercatorY);vec2 uv=vec2(uvX,uvY);
#endif
v_pos0=uv;uv=uv*EXTENT;vec4 up_vector=vec4(elevationVector(uv),1.0);float height=elevation(uv);
#ifdef TERRAIN_WIREFRAME
height+=wireframeOffset;
#endif
globe_pos+=up_vector.xyz*height;vec4 globe=u_globe_matrix*vec4(globe_pos,1.0);vec4 mercator=vec4(0.0);if (u_zoom_transition > 0.0) {mercator=vec4(merc_pos,height,1.0);mercator.xy-=u_merc_center;mercator.x=wrap(mercator.x,-0.5,0.5);mercator=u_merc_matrix*mercator;}vec3 position=mix(globe.xyz,mercator.xyz,u_zoom_transition);gl_Position=u_proj_matrix*vec4(position,1.0);
#ifdef FOG
v_fog_pos=fog_position((u_normalize_matrix*vec4(globe_pos,1.0)).xyz);
#endif
}`),globeAtmosphere:Ai(`uniform float u_transition;uniform highp float u_fadeout_range;uniform highp float u_temporal_offset;uniform vec3 u_start_color;uniform vec4 u_color;uniform vec4 u_space_color;uniform vec4 u_high_color;uniform float u_star_intensity;uniform float u_star_size;uniform float u_star_density;uniform float u_horizon_angle;uniform mat4 u_rotation_matrix;varying highp vec3 v_ray_dir;varying highp vec3 v_horizon_dir;highp float random(highp vec3 p) {p=fract(p*vec3(23.2342,97.1231,91.2342));p+=dot(p.zxy,p.yxz+123.1234);return fract(p.x*p.y);}float stars(vec3 p,float scale,vec2 offset) {vec2 uv_scale=(u_viewport/u_star_size)*scale;vec3 position=vec3(p.xy*uv_scale+offset*u_viewport,p.z);vec3 q=fract(position)-0.5;vec3 id=floor(position);float random_visibility=step(random(id),u_star_density);float circle=smoothstep(0.5+u_star_intensity,0.5,length(q));return circle*random_visibility;}void main() {highp vec3 dir=normalize(v_ray_dir);
#ifdef PROJECTION_GLOBE_VIEW
float globe_pos_dot_dir=dot(u_globe_pos,dir);highp vec3 closest_point_forward=abs(globe_pos_dot_dir)*dir;float norm_dist_from_center=length(closest_point_forward-u_globe_pos)/u_globe_radius;if (norm_dist_from_center < 0.98) {discard;return;}
#endif
highp vec3 horizon_dir=normalize(v_horizon_dir);float horizon_angle_mercator=dir.y < horizon_dir.y ?
0.0 : max(acos(dot(dir,horizon_dir)),0.0);
#ifdef PROJECTION_GLOBE_VIEW
highp vec3 closest_point=globe_pos_dot_dir*dir;float closest_point_to_center=length(closest_point-u_globe_pos);float theta=asin(clamp(closest_point_to_center/length(u_globe_pos),-1.0,1.0));float horizon_angle=globe_pos_dot_dir < 0.0 ?
PI-theta-u_horizon_angle : theta-u_horizon_angle;float angle_t=pow(u_transition,10.0);horizon_angle=mix(horizon_angle,horizon_angle_mercator,angle_t);
#else
float horizon_angle=horizon_angle_mercator;
#endif
horizon_angle/=PI;float t=exp(-horizon_angle/u_fadeout_range);float alpha_0=u_color.a;float alpha_1=u_high_color.a;float alpha_2=u_space_color.a;vec3 color_stop_0=u_color.rgb;vec3 color_stop_1=u_high_color.rgb;vec3 color_stop_2=u_space_color.rgb;vec3 c0=mix(color_stop_2,color_stop_1,alpha_1);vec3 c1=mix(c0,color_stop_0,alpha_0);vec3 c2=mix(c0,c1,t);vec3 c =mix(color_stop_2,c2,t);float a0=mix(alpha_2,1.0,alpha_1);float a1=mix(a0,1.0,alpha_0);float a2=mix(a0,a1,t);float a =mix(alpha_2,a2,t);vec2 uv=gl_FragCoord.xy/u_viewport-0.5;float aspect_ratio=u_viewport.x/u_viewport.y;vec4 uv_dir=vec4(normalize(vec3(uv.x*aspect_ratio,uv.y,1.0)),1.0);uv_dir=u_rotation_matrix*uv_dir;vec3 n=abs(uv_dir.xyz);vec2 uv_remap=(n.x > n.y && n.x > n.z) ? uv_dir.yz/uv_dir.x:
(n.y > n.x && n.y > n.z) ? uv_dir.zx/uv_dir.y:
uv_dir.xy/uv_dir.z;uv_remap.x/=aspect_ratio;vec3 D=vec3(uv_remap,1.0);highp float star_field=0.0;if (u_star_intensity > 0.0) {star_field+=stars(D,1.2,vec2(0.0,0.0));star_field+=stars(D,1.0,vec2(1.0,0.0));star_field+=stars(D,0.8,vec2(0.0,1.0));star_field+=stars(D,0.6,vec2(1.0,1.0));star_field*=(1.0-pow(t,0.25+(1.0-u_high_color.a)*0.75));c+=star_field*alpha_2;}c=dither(c,gl_FragCoord.xy+u_temporal_offset);gl_FragColor=vec4(c,a);}`,`attribute vec3 a_pos;attribute vec2 a_uv;uniform vec3 u_frustum_tl;uniform vec3 u_frustum_tr;uniform vec3 u_frustum_br;uniform vec3 u_frustum_bl;uniform float u_horizon;varying highp vec3 v_ray_dir;varying highp vec3 v_horizon_dir;void main() {v_ray_dir=mix(
mix(u_frustum_tl,u_frustum_tr,a_uv.x),mix(u_frustum_bl,u_frustum_br,a_uv.x),a_uv.y);v_horizon_dir=mix(
mix(u_frustum_tl,u_frustum_bl,u_horizon),mix(u_frustum_tr,u_frustum_br,u_horizon),a_uv.x);gl_Position=vec4(a_pos,1.0);}`)};function Ai(p,t,a){const m=/#pragma mapbox: ([\w]+) ([\w]+) ([\w]+) ([\w]+)/g,v=/uniform (highp |mediump |lowp )?([\w]+) ([\w]+)([\s]*)([\w]*)/g,b=t.match(/attribute (highp |mediump |lowp )?([\w]+) ([\w]+)/g),S=p.match(v),k=t.match(v),D=_c.match(v);let O=k?k.concat(S):S;a||(la.staticUniforms&&(O=la.staticUniforms.concat(O)),eo.staticUniforms&&(O=eo.staticUniforms.concat(O))),O&&(O=O.concat(D));const V={};return{fragmentSource:p=p.replace(m,(G,X,J,ee,Y)=>(V[Y]=!0,X==="define"?`
#ifndef HAS_UNIFORM_u_${Y}
varying ${J} ${ee} ${Y};
#else
uniform ${J} ${ee} u_${Y};
#endif
`:`
#ifdef HAS_UNIFORM_u_${Y}
    ${J} ${ee} ${Y} = u_${Y};
#endif
`)),vertexSource:t=t.replace(m,(G,X,J,ee,Y)=>{const pe=ee==="float"?"vec2":"vec4",K=Y.match(/color/)?"color":pe;return V[Y]?X==="define"?`
#ifndef HAS_UNIFORM_u_${Y}
uniform lowp float u_${Y}_t;
attribute ${J} ${pe} a_${Y};
varying ${J} ${ee} ${Y};
#else
uniform ${J} ${ee} u_${Y};
#endif
`:K==="vec4"?`
#ifndef HAS_UNIFORM_u_${Y}
    ${Y} = a_${Y};
#else
    ${J} ${ee} ${Y} = u_${Y};
#endif
`:`
#ifndef HAS_UNIFORM_u_${Y}
    ${Y} = unpack_mix_${K}(a_${Y}, u_${Y}_t);
#else
    ${J} ${ee} ${Y} = u_${Y};
#endif
`:X==="define"?`
#ifndef HAS_UNIFORM_u_${Y}
uniform lowp float u_${Y}_t;
attribute ${J} ${pe} a_${Y};
#else
uniform ${J} ${ee} u_${Y};
#endif
`:K==="vec4"?`
#ifndef HAS_UNIFORM_u_${Y}
    ${J} ${ee} ${Y} = a_${Y};
#else
    ${J} ${ee} ${Y} = u_${Y};
#endif
`:`
#ifndef HAS_UNIFORM_u_${Y}
    ${J} ${ee} ${Y} = unpack_mix_${K}(a_${Y}, u_${Y}_t);
#else
    ${J} ${ee} ${Y} = u_${Y};
#endif
`}),staticAttributes:b,staticUniforms:O}}class Hu{constructor(){this.boundProgram=null,this.boundLayoutVertexBuffer=null,this.boundPaintVertexBuffers=[],this.boundIndexBuffer=null,this.boundVertexOffset=null,this.boundDynamicVertexBuffer=null,this.vao=null}bind(t,a,m,v,b,S,k,D,O){this.context=t;let V=this.boundPaintVertexBuffers.length!==v.length;for(let G=0;!V&&G<v.length;G++)this.boundPaintVertexBuffers[G]!==v[G]&&(V=!0);t.extVertexArrayObject&&this.vao&&this.boundProgram===a&&this.boundLayoutVertexBuffer===m&&!V&&this.boundIndexBuffer===b&&this.boundVertexOffset===S&&this.boundDynamicVertexBuffer===k&&this.boundDynamicVertexBuffer2===D&&this.boundDynamicVertexBuffer3===O?(t.bindVertexArrayOES.set(this.vao),k&&k.bind(),b&&b.dynamicDraw&&b.bind(),D&&D.bind(),O&&O.bind()):this.freshBind(a,m,v,b,S,k,D,O)}freshBind(t,a,m,v,b,S,k,D){let O;const V=t.numAttributes,G=this.context,X=G.gl;if(G.extVertexArrayObject)this.vao&&this.destroy(),this.vao=G.extVertexArrayObject.createVertexArrayOES(),G.bindVertexArrayOES.set(this.vao),O=0,this.boundProgram=t,this.boundLayoutVertexBuffer=a,this.boundPaintVertexBuffers=m,this.boundIndexBuffer=v,this.boundVertexOffset=b,this.boundDynamicVertexBuffer=S,this.boundDynamicVertexBuffer2=k,this.boundDynamicVertexBuffer3=D;else{O=G.currentNumAttributes||0;for(let J=V;J<O;J++)X.disableVertexAttribArray(J)}a.enableAttributes(X,t);for(const J of m)J.enableAttributes(X,t);S&&S.enableAttributes(X,t),k&&k.enableAttributes(X,t),D&&D.enableAttributes(X,t),a.bind(),a.setVertexAttribPointers(X,t,b);for(const J of m)J.bind(),J.setVertexAttribPointers(X,t,b);S&&(S.bind(),S.setVertexAttribPointers(X,t,b)),v&&v.bind(),k&&(k.bind(),k.setVertexAttribPointers(X,t,b)),D&&(D.bind(),D.setVertexAttribPointers(X,t,b)),G.currentNumAttributes=V}destroy(){this.vao&&(this.context.extVertexArrayObject.deleteVertexArrayOES(this.vao),this.vao=null)}}function yc(p,t){const a=Math.pow(2,t.canonical.z),m=t.canonical.y;return[new n.MercatorCoordinate(0,m/a).toLngLat().lat,new n.MercatorCoordinate(0,(m+1)/a).toLngLat().lat]}function Yu(p,t,a,m,v,b,S){const k=p.context,D=k.gl,O=a.fbo;if(!O)return;p.prepareDrawTile();const V=p.useProgram("hillshade");k.activeTexture.set(D.TEXTURE0),D.bindTexture(D.TEXTURE_2D,O.colorAttachment.get());const G=((Y,pe,K,ne)=>{const oe=K.paint.get("hillshade-shadow-color"),ge=K.paint.get("hillshade-highlight-color"),he=K.paint.get("hillshade-accent-color");let fe=K.paint.get("hillshade-illumination-direction")*(Math.PI/180);K.paint.get("hillshade-illumination-anchor")==="viewport"&&(fe-=Y.transform.angle);const be=!Y.options.moving;return{u_matrix:ne||Y.transform.calculateProjMatrix(pe.tileID.toUnwrapped(),be),u_image:0,u_latrange:yc(0,pe.tileID),u_light:[K.paint.get("hillshade-exaggeration"),fe],u_shadow:oe,u_highlight:ge,u_accent:he}})(p,a,m,p.terrain?t.projMatrix:null);p.prepareDrawProgram(k,V,t.toUnwrapped());const{tileBoundsBuffer:X,tileBoundsIndexBuffer:J,tileBoundsSegments:ee}=p.getTileBoundsBuffers(a);V.draw(k,D.TRIANGLES,v,b,S,n.CullFaceMode.disabled,G,m.id,X,J,ee)}function al(p,t,a){if(!t.needsDEMTextureUpload)return;const m=p.context,v=m.gl;m.pixelStoreUnpackPremultiplyAlpha.set(!1),t.demTexture=t.demTexture||p.getTileTexture(a.stride);const b=a.getPixels();t.demTexture?t.demTexture.update(b,{premultiply:!1}):t.demTexture=new n.Texture(m,b,v.RGBA,{premultiply:!1}),t.needsDEMTextureUpload=!1}function ll(p,t,a,m,v,b){const S=p.context,k=S.gl;if(!t.dem)return;const D=t.dem;if(S.activeTexture.set(k.TEXTURE1),al(p,t,D),!t.demTexture)return;t.demTexture.bind(k.NEAREST,k.CLAMP_TO_EDGE);const O=D.dim;S.activeTexture.set(k.TEXTURE0);let V=t.fbo;if(!V){const ee=new n.Texture(S,{width:O,height:O,data:null},k.RGBA);ee.bind(k.LINEAR,k.CLAMP_TO_EDGE),V=t.fbo=S.createFramebuffer(O,O,!0),V.colorAttachment.set(ee.texture)}S.bindFramebuffer.set(V.framebuffer),S.viewport.set([0,0,O,O]);const{tileBoundsBuffer:G,tileBoundsIndexBuffer:X,tileBoundsSegments:J}=p.getMercatorTileBoundsBuffers();p.useProgram("hillshadePrepare").draw(S,k.TRIANGLES,m,v,b,n.CullFaceMode.disabled,((ee,Y)=>{const pe=Y.stride,K=n.create();return n.ortho(K,0,n.EXTENT,-n.EXTENT,0,0,1),n.translate(K,K,[0,-n.EXTENT,0]),{u_matrix:K,u_image:1,u_dimension:[pe,pe],u_zoom:ee.overscaledZ,u_unpack:Y.unpackVector}})(t.tileID,D),a.id,G,X,J),t.needsHillshadePrepare=!1}const cl=(p,t)=>({u_matrix:new n.UniformMatrix4f(p,t.u_matrix),u_image0:new n.Uniform1i(p,t.u_image0),u_skirt_height:new n.Uniform1f(p,t.u_skirt_height)}),ul=(p,t)=>({u_matrix:p,u_image0:0,u_skirt_height:t}),bi=(p,t,a,m,v,b,S,k,D,O,V,G,X,J)=>({u_proj_matrix:Float32Array.from(p),u_globe_matrix:t,u_normalize_matrix:Float32Array.from(m),u_merc_matrix:a,u_zoom_transition:v,u_merc_center:b,u_image0:0,u_frustum_tl:S,u_frustum_tr:k,u_frustum_br:D,u_frustum_bl:O,u_globe_pos:V,u_globe_radius:G,u_viewport:X,u_grid_matrix:J?Float32Array.from(J):new Float32Array(9)});function ca(p,t){return p!=null&&t!=null&&!(!p.hasData()||!t.hasData())&&p.demTexture!=null&&t.demTexture!=null&&p.tileID.key!==t.tileID.key}const jo=new class{constructor(){this.operations={}}newMorphing(p,t,a,m,v){if(p in this.operations){const b=this.operations[p];b.to.tileID.key!==a.tileID.key&&(b.queued=a)}else this.operations[p]={startTime:m,phase:0,duration:v,from:t,to:a,queued:null}}getMorphValuesForProxy(p){if(!(p in this.operations))return null;const t=this.operations[p];return{from:t.from,to:t.to,phase:t.phase}}update(p){for(const t in this.operations){const a=this.operations[t];for(a.phase=(p-a.startTime)/a.duration;a.phase>=1||!this._validOp(a);)if(!this._nextOp(a,p)){delete this.operations[t];break}}}_nextOp(p,t){return!!p.queued&&(p.from=p.to,p.to=p.queued,p.queued=null,p.phase=0,p.startTime=t,!0)}_validOp(p){return p.from.hasData()&&p.to.hasData()}},ua={0:null,1:"TERRAIN_VERTEX_MORPHING",2:"TERRAIN_WIREFRAME"};function Ku(p,t){const a=1<<p.z;return!t&&(p.x===0||p.x===a-1)||p.y===0||p.y===a-1}const ha=p=>({u_matrix:p});function vc(p,t,a,m,v){if(v>0){const b=n.exported.now(),S=(b-p.timeAdded)/v,k=t?(b-t.timeAdded)/v:-1,D=a.getSource(),O=m.coveringZoomLevel({tileSize:D.tileSize,roundZoom:D.roundZoom}),V=!t||Math.abs(t.tileID.overscaledZ-O)>Math.abs(p.tileID.overscaledZ-O),G=V&&p.refreshedUponExpiration?1:n.clamp(V?S:1-k,0,1);return p.refreshedUponExpiration&&S>=1&&(p.refreshedUponExpiration=!1),t?{opacity:1,mix:1-G}:{opacity:G,mix:0}}return{opacity:1,mix:0}}class of extends n.SourceCache{constructor(t){const a={type:"raster-dem",maxzoom:t.transform.maxZoom},m=new Yt(Ti(),null),v=Re("mock-dem",a,m,t.style);super("mock-dem",v,!1),v.setEventedParent(this),this._sourceLoaded=!0}_loadTile(t,a){t.state="loaded",a(null)}}class sf extends n.SourceCache{constructor(t){const a=Re("proxy",{type:"geojson",maxzoom:t.transform.maxZoom},new Yt(Ti(),null),t.style);super("proxy",a,!1),a.setEventedParent(this),this.map=this.getSource().map=t,this.used=this._sourceLoaded=!0,this.renderCache=[],this.renderCachePool=[],this.proxyCachedFBO={}}update(t,a,m){if(t.freezeTileCoverage)return;this.transform=t;const v=t.coveringTiles({tileSize:this._source.tileSize,minzoom:this._source.minzoom,maxzoom:this._source.maxzoom,roundZoom:this._source.roundZoom,reparseOverscaled:this._source.reparseOverscaled}).reduce((b,S)=>{if(b[S.key]="",!this._tiles[S.key]){const k=new n.Tile(S,this._source.tileSize*S.overscaleFactor(),t.tileZoom);k.state="loaded",this._tiles[S.key]=k}return b},{});for(const b in this._tiles)b in v||(this.freeFBO(b),this._tiles[b].unloadVectorData(),delete this._tiles[b])}freeFBO(t){const a=this.proxyCachedFBO[t];if(a!==void 0){const m=Object.values(a);this.renderCachePool.push(...m),delete this.proxyCachedFBO[t]}}deallocRenderCache(){this.renderCache.forEach(t=>t.fb.destroy()),this.renderCache=[],this.renderCachePool=[],this.proxyCachedFBO={}}}class hl extends n.OverscaledTileID{constructor(t,a,m){super(t.overscaledZ,t.wrap,t.canonical.z,t.canonical.x,t.canonical.y),this.proxyTileKey=a,this.projMatrix=m}}class xc extends n.Elevation{constructor(t,a){super(),this.painter=t,this.terrainTileForTile={},this.prevTerrainTileForTile={};const[m,v,b]=function(D){const O=new n.StructArrayLayout4i8,V=new n.StructArrayLayout3ui6,G=131;O.reserve(17161),V.reserve(33800);const X=n.EXTENT/128,J=n.EXTENT+X/2,ee=J+X;for(let pe=-X;pe<ee;pe+=X)for(let K=-X;K<ee;K+=X){const ne=K<0||K>J||pe<0||pe>J?24575:0,oe=n.clamp(Math.round(K),0,n.EXTENT),ge=n.clamp(Math.round(pe),0,n.EXTENT);O.emplaceBack(oe+ne,ge,oe,ge)}const Y=(pe,K)=>{const ne=K*G+pe;V.emplaceBack(ne+1,ne,ne+G),V.emplaceBack(ne+G,ne+G+1,ne+1)};for(let pe=1;pe<129;pe++)for(let K=1;K<129;K++)Y(K,pe);return[0,129].forEach(pe=>{for(let K=0;K<130;K++)Y(K,pe),Y(pe,K)}),[O,V,32768]}(),S=t.context;this.gridBuffer=S.createVertexBuffer(m,n.boundsAttributes.members),this.gridIndexBuffer=S.createIndexBuffer(v),this.gridSegments=n.SegmentVector.simpleSegment(0,0,m.length,v.length),this.gridNoSkirtSegments=n.SegmentVector.simpleSegment(0,0,m.length,b),this.proxyCoords=[],this.proxiedCoords={},this._visibleDemTiles=[],this._drapedRenderBatches=[],this._sourceTilesOverlap={},this.proxySourceCache=new sf(a.map),this.orthoMatrix=n.create(),n.ortho(this.orthoMatrix,0,n.EXTENT,0,n.EXTENT,0,1);const k=S.gl;this._overlapStencilMode=new n.StencilMode({func:k.GEQUAL,mask:255},0,255,k.KEEP,k.KEEP,k.REPLACE),this._previousZoom=t.transform.zoom,this.pool=[],this._findCoveringTileCache={},this._tilesDirty={},this.style=a,this._useVertexMorphing=!0,this._exaggeration=1,this._mockSourceCache=new of(a.map)}set style(t){t.on("data",this._onStyleDataEvent.bind(this)),t.on("neworder",this._checkRenderCacheEfficiency.bind(this)),this._style=t,this._checkRenderCacheEfficiency()}update(t,a,m){if(t&&t.terrain){this._style!==t&&(this.style=t),this.enabled=!0;const v=t.terrain.properties;this.sourceCache=t.terrain.drapeRenderMode===0?this._mockSourceCache:t._getSourceCache(v.get("source")),this._exaggeration=v.get("exaggeration");const b=()=>{this.sourceCache.used&&n.warnOnce(`Raster DEM source '${this.sourceCache.id}' is used both for terrain and as layer source.
This leads to lower resolution of hillshade. For full hillshade resolution but higher memory consumption, define another raster DEM source.`);const S=this.getScaledDemTileSize();this.sourceCache.update(a,S,!0),this.resetTileLookupCache(this.sourceCache.id)};this.sourceCache.usedForTerrain||(this.resetTileLookupCache(this.sourceCache.id),this.sourceCache.usedForTerrain=!0,b(),this._initializing=!0),b(),a.updateElevation(!m),this.resetTileLookupCache(this.proxySourceCache.id),this.proxySourceCache.update(a),this._emptyDEMTextureDirty=!0}else this._disable()}resetTileLookupCache(t){this._findCoveringTileCache[t]={}}getScaledDemTileSize(){return this.sourceCache.getSource().tileSize/128*this.proxySourceCache.getSource().tileSize}_checkRenderCacheEfficiency(){const t=this.renderCacheEfficiency(this._style);this._style.map._optimizeForTerrain||t.efficiency!==100&&n.warnOnce(`Terrain render cache efficiency is not optimal (${t.efficiency}%) and performance
                may be affected negatively, consider placing all background, fill and line layers before layer
                with id '${t.firstUndrapedLayer}' or create a map using optimizeForTerrain: true option.`)}_onStyleDataEvent(t){t.coord&&t.dataType==="source"?this._clearRenderCacheForTile(t.sourceCacheId,t.coord):t.dataType==="style"&&(this._invalidateRenderCache=!0)}_disable(){if(this.enabled&&(this.enabled=!1,this._sharedDepthStencil=void 0,this.proxySourceCache.deallocRenderCache(),this._style))for(const t in this._style._sourceCaches)this._style._sourceCaches[t].usedForTerrain=!1}destroy(){this._disable(),this._emptyDEMTexture&&this._emptyDEMTexture.destroy(),this._emptyDepthBufferTexture&&this._emptyDepthBufferTexture.destroy(),this.pool.forEach(t=>t.fb.destroy()),this.pool=[],this._depthFBO&&(this._depthFBO.destroy(),this._depthFBO=void 0,this._depthTexture=void 0)}_source(){return this.enabled?this.sourceCache:null}exaggeration(){return this._exaggeration}get visibleDemTiles(){return this._visibleDemTiles}get drapeBufferSize(){const t=2*this.proxySourceCache.getSource().tileSize;return[t,t]}set useVertexMorphing(t){this._useVertexMorphing=t}updateTileBinding(t){if(!this.enabled)return;this.prevTerrainTileForTile=this.terrainTileForTile;const a=this.proxySourceCache,m=this.painter.transform;this._initializing&&(this._initializing=m._centerAltitude===0&&this.getAtPointOrZero(n.MercatorCoordinate.fromLngLat(m.center),-1)===-1,this._emptyDEMTextureDirty=!this._initializing);const v=this.proxyCoords=a.getIds().map(D=>{const O=a.getTileByID(D).tileID;return O.projMatrix=m.calculateProjMatrix(O.toUnwrapped()),O});(function(D,O){const V=O.transform.pointCoordinate(O.transform.getCameraPoint()),G=new n.pointGeometry(V.x,V.y);D.sort((X,J)=>{if(J.overscaledZ-X.overscaledZ)return J.overscaledZ-X.overscaledZ;const ee=new n.pointGeometry(X.canonical.x+(1<<X.canonical.z)*X.wrap,X.canonical.y),Y=new n.pointGeometry(J.canonical.x+(1<<J.canonical.z)*J.wrap,J.canonical.y),pe=G.mult(1<<X.canonical.z);return pe.x-=.5,pe.y-=.5,pe.distSqr(ee)-pe.distSqr(Y)})})(v,this.painter),this._previousZoom=m.zoom;const b=this.proxyToSource||{};this.proxyToSource={},v.forEach(D=>{this.proxyToSource[D.key]={}}),this.terrainTileForTile={};const S=this._style._sourceCaches;for(const D in S){const O=S[D];if(!O.used||(O!==this.sourceCache&&this.resetTileLookupCache(O.id),this._setupProxiedCoordsForOrtho(O,t[D],b),O.usedForTerrain))continue;const V=t[D];O.getSource().reparseOverscaled&&this._assignTerrainTiles(V)}this.proxiedCoords[a.id]=v.map(D=>new hl(D,D.key,this.orthoMatrix)),this._assignTerrainTiles(v),this._prepareDEMTextures(),this._setupDrapedRenderBatches(),this._initFBOPool(),this._setupRenderCache(b),this.renderingToTexture=!1,this._updateTimestamp=n.exported.now();const k={};this._visibleDemTiles=[];for(const D of this.proxyCoords){const O=this.terrainTileForTile[D.key];if(!O)continue;const V=O.tileID.key;V in k||(this._visibleDemTiles.push(O),k[V]=V)}}_assignTerrainTiles(t){this._initializing||t.forEach(a=>{if(this.terrainTileForTile[a.key])return;const m=this._findTileCoveringTileID(a,this.sourceCache);m&&(this.terrainTileForTile[a.key]=m)})}_prepareDEMTextures(){const t=this.painter.context,a=t.gl;for(const m in this.terrainTileForTile){const v=this.terrainTileForTile[m],b=v.dem;!b||v.demTexture&&!v.needsDEMTextureUpload||(t.activeTexture.set(a.TEXTURE1),al(this.painter,v,b))}}_prepareDemTileUniforms(t,a,m,v){if(!a||a.demTexture==null)return!1;const b=t.tileID.canonical,S=Math.pow(2,a.tileID.canonical.z-b.z),k=v||"";return m[`u_dem_tl${k}`]=[b.x*S%1,b.y*S%1],m[`u_dem_scale${k}`]=S,!0}get emptyDEMTexture(){return!this._emptyDEMTextureDirty&&this._emptyDEMTexture?this._emptyDEMTexture:this._updateEmptyDEMTexture()}get emptyDepthBufferTexture(){const t=this.painter.context,a=t.gl;if(!this._emptyDepthBufferTexture){const m=new n.RGBAImage({width:1,height:1},Uint8Array.of(255,255,255,255));this._emptyDepthBufferTexture=new n.Texture(t,m,a.RGBA,{premultiply:!1})}return this._emptyDepthBufferTexture}_getLoadedAreaMinimum(){let t=0;const a=this._visibleDemTiles.reduce((m,v)=>{if(!v.dem)return m;const b=v.dem.tree.minimums[0];return b>0&&t++,m+b},0);return t?a/t:0}_updateEmptyDEMTexture(){const t=this.painter.context,a=t.gl;t.activeTexture.set(a.TEXTURE2);const m=this._getLoadedAreaMinimum(),v=new n.RGBAImage({width:1,height:1},new Uint8Array(n.DEMData.pack(m,this.sourceCache.getSource().encoding)));this._emptyDEMTextureDirty=!1;let b=this._emptyDEMTexture;return b?b.update(v,{premultiply:!1}):b=this._emptyDEMTexture=new n.Texture(t,v,a.RGBA,{premultiply:!1}),b}setupElevationDraw(t,a,m){const v=this.painter.context,b=v.gl,S=(k=this.sourceCache.getSource().encoding,{u_dem:2,u_dem_prev:4,u_dem_unpack:n.DEMData.getUnpackVector(k),u_dem_tl:[0,0],u_dem_tl_prev:[0,0],u_dem_scale:0,u_dem_scale_prev:0,u_dem_size:0,u_dem_lerp:1,u_depth:3,u_depth_size_inv:[0,0],u_exaggeration:0,u_tile_tl_up:[0,0,1],u_tile_tr_up:[0,0,1],u_tile_br_up:[0,0,1],u_tile_bl_up:[0,0,1],u_tile_up_scale:1});var k;S.u_dem_size=this.sourceCache.getSource().tileSize,S.u_exaggeration=this.exaggeration();const D=this.painter.transform,O=D.projection,V=t.tileID.canonical;S.u_tile_tl_up=O.upVector(V,0,0),S.u_tile_tr_up=O.upVector(V,n.EXTENT,0),S.u_tile_br_up=O.upVector(V,n.EXTENT,n.EXTENT),S.u_tile_bl_up=O.upVector(V,0,n.EXTENT),S.u_tile_up_scale=m&&m.useDenormalizedUpVectorScale?n.GLOBE_METERS_TO_ECEF:O.upVectorScale(V,D.center.lat,D.worldSize).metersToTile;let G=null,X=null,J=1;if(m&&m.morphing&&this._useVertexMorphing){const ee=m.morphing.srcDemTile,Y=m.morphing.dstDemTile;J=m.morphing.phase,ee&&Y&&(this._prepareDemTileUniforms(t,ee,S,"_prev")&&(X=ee),this._prepareDemTileUniforms(t,Y,S)&&(G=Y))}if(X&&G?(v.activeTexture.set(b.TEXTURE2),G.demTexture.bind(b.NEAREST,b.CLAMP_TO_EDGE,b.NEAREST),v.activeTexture.set(b.TEXTURE4),X.demTexture.bind(b.NEAREST,b.CLAMP_TO_EDGE,b.NEAREST),S.u_dem_lerp=J):(G=this.terrainTileForTile[t.tileID.key],v.activeTexture.set(b.TEXTURE2),(this._prepareDemTileUniforms(t,G,S)?G.demTexture:this.emptyDEMTexture).bind(b.NEAREST,b.CLAMP_TO_EDGE)),v.activeTexture.set(b.TEXTURE3),m&&m.useDepthForOcclusion?(this._depthTexture&&this._depthTexture.bind(b.NEAREST,b.CLAMP_TO_EDGE),this._depthFBO&&(S.u_depth_size_inv=[1/this._depthFBO.width,1/this._depthFBO.height])):(this.emptyDepthBufferTexture.bind(b.NEAREST,b.CLAMP_TO_EDGE),S.u_depth_size_inv=[1,1]),m&&m.useMeterToDem&&G){const ee=(1<<G.tileID.canonical.z)*n.mercatorZfromAltitude(1,this.painter.transform.center.lat)*this.sourceCache.getSource().tileSize;S.u_meter_to_dem=ee}m&&m.labelPlaneMatrixInv&&(S.u_label_plane_matrix_inv=m.labelPlaneMatrixInv),a.setTerrainUniformValues(v,S)}renderToBackBuffer(t){const a=this.painter,m=this.painter.context;t.length!==0&&(m.bindFramebuffer.set(null),m.viewport.set([0,0,a.width,a.height]),a.gpuTimingDeferredRenderStart(),this.renderingToTexture=!1,function(v,b,S,k,D){if(v.transform.projection.name==="globe")(function(O,V,G,X,J){const ee=O.context,Y=ee.gl;let pe,K;const ne=O.options.showTerrainWireframe?2:0,oe=O.transform,ge=n.globeUseCustomAntiAliasing(O,ee,oe),he=(_e,rt)=>{if(K===_e)return;const it=[ua[_e],"PROJECTION_GLOBE_VIEW"];ge&&it.push("CUSTOM_ANTIALIASING"),rt&&it.push(ua[ne]),pe=O.useProgram("globeRaster",null,it),K=_e},fe=O.colorModeForRenderPass(),be=new n.DepthMode(Y.LEQUAL,n.DepthMode.ReadWrite,O.depthRangeFor3D);jo.update(J);const Ve=n.calculateGlobeMercatorMatrix(oe),Ze=[n.mercatorXfromLng(oe.center.lng),n.mercatorYfromLat(oe.center.lat)],je=O.globeSharedBuffers,Ue=[oe.width*n.exported.devicePixelRatio,oe.height*n.exported.devicePixelRatio];if((ne?[!1,!0]:[!1]).forEach(_e=>{K=-1;const rt=_e?Y.LINES:Y.TRIANGLES;for(const it of X){const Et=G.getTile(it),Ke=n.StencilMode.disabled,Ft=V.prevTerrainTileForTile[it.key],vt=V.terrainTileForTile[it.key];ca(Ft,vt)&&jo.newMorphing(it.key,Ft,vt,J,250),ee.activeTexture.set(Y.TEXTURE0),Et.texture.bind(Y.LINEAR,Y.CLAMP_TO_EDGE);const yt=jo.getMorphValuesForProxy(it.key),ut=yt?1:0,gt={useDenormalizedUpVectorScale:!0};yt&&n.extend$1(gt,{morphing:{srcDemTile:yt.from,dstDemTile:yt.to,phase:n.easeCubicInOut(yt.phase)}});const Xt=Float32Array.from(oe.globeMatrix),Vt=n.globeTileLatLngCorners(it.canonical),oi=n.getLatitudinalLod((Vt[0][0]+Vt[1][0])/2),Ot=n.getGridMatrix(it.canonical,Vt,oi),ii=n.globeNormalizeECEF(n.globeTileBounds(it.canonical)),Si=bi(oe.projMatrix,Xt,Ve,ii,n.globeToMercatorTransition(oe.zoom),Ze,oe.frustumCorners.TL,oe.frustumCorners.TR,oe.frustumCorners.BR,oe.frustumCorners.BL,oe.globeCenterInViewSpace,oe.globeRadius,Ue,Ot);if(he(ut,_e),V.setupElevationDraw(Et,pe,gt),O.prepareDrawProgram(ee,pe,it.toUnwrapped()),je){const[zi,nr,Ri]=_e?je.getWirefameBuffers(O.context,oi):je.getGridBuffers(oi);pe.draw(ee,rt,be,Ke,fe,n.CullFaceMode.backCCW,Si,"globe_raster",zi,nr,Ri)}}}),je){const _e=["GLOBE_POLES","PROJECTION_GLOBE_VIEW"];ge&&_e.push("CUSTOM_ANTIALIASING"),pe=O.useProgram("globeRaster",null,_e);for(const rt of X){const{x:it,y:Et,z:Ke}=rt.canonical,Ft=Et===0,vt=Et===(1<<Ke)-1,[yt,ut,gt,Xt]=je.getPoleBuffers(Ke);if(Xt&&(Ft||vt)){const Vt=G.getTile(rt);ee.activeTexture.set(Y.TEXTURE0),Vt.texture.bind(Y.LINEAR,Y.CLAMP_TO_EDGE);let oi=n.globePoleMatrixForTile(Ke,it,oe);const Ot=n.globeNormalizeECEF(n.globeTileBounds(rt.canonical)),ii=(Si,zi)=>Si.draw(ee,Y.TRIANGLES,be,n.StencilMode.disabled,fe,n.CullFaceMode.disabled,bi(oe.projMatrix,oi,oi,Ot,0,Ze,oe.frustumCorners.TL,oe.frustumCorners.TR,oe.frustumCorners.BR,oe.frustumCorners.BL,oe.globeCenterInViewSpace,oe.globeRadius,Ue),"globe_pole_raster",zi,gt,Xt);V.setupElevationDraw(Vt,pe,{}),O.prepareDrawProgram(ee,pe,rt.toUnwrapped()),Ft&&ii(pe,yt),vt&&(oi=n.scale(n.create(),oi,[1,-1,1]),ii(pe,ut))}}}})(v,b,S,k,D);else{const O=v.context,V=O.gl;let G,X;const J=v.options.showTerrainWireframe?2:0,ee=(oe,ge)=>{if(X===oe)return;const he=[ua[oe]];ge&&he.push(ua[J]),G=v.useProgram("terrainRaster",null,he),X=oe},Y=v.colorModeForRenderPass(),pe=new n.DepthMode(V.LEQUAL,n.DepthMode.ReadWrite,v.depthRangeFor3D);jo.update(D);const K=v.transform,ne=6*Math.pow(1.5,22-K.zoom)*b.exaggeration();(J?[!1,!0]:[!1]).forEach(oe=>{X=-1;const ge=oe?V.LINES:V.TRIANGLES,[he,fe]=oe?b.getWirefameBuffer():[b.gridIndexBuffer,b.gridSegments];for(const be of k){const Ve=S.getTile(be),Ze=n.StencilMode.disabled,je=b.prevTerrainTileForTile[be.key],Ue=b.terrainTileForTile[be.key];ca(je,Ue)&&jo.newMorphing(be.key,je,Ue,D,250),O.activeTexture.set(V.TEXTURE0),Ve.texture.bind(V.LINEAR,V.CLAMP_TO_EDGE,V.LINEAR_MIPMAP_NEAREST);const _e=jo.getMorphValuesForProxy(be.key),rt=_e?1:0;let it;_e&&(it={morphing:{srcDemTile:_e.from,dstDemTile:_e.to,phase:n.easeCubicInOut(_e.phase)}});const Et=ul(be.projMatrix,Ku(be.canonical,K.renderWorldCopies)?ne/10:ne);ee(rt,oe),b.setupElevationDraw(Ve,G,it),v.prepareDrawProgram(O,G,be.toUnwrapped()),G.draw(O,ge,pe,Ze,Y,n.CullFaceMode.backCCW,Et,"terrain_raster",b.gridBuffer,he,fe)}})}}(a,this,this.proxySourceCache,t,this._updateTimestamp),this.renderingToTexture=!0,a.gpuTimingDeferredRenderEnd(),t.splice(0,t.length))}renderBatch(t){if(this._drapedRenderBatches.length===0)return t+1;this.renderingToTexture=!0;const a=this.painter,m=this.painter.context,v=this.proxySourceCache,b=this.proxiedCoords[v.id],S=this._drapedRenderBatches.shift(),k=[],D=a.style.order;let O=0;for(const V of b){const G=v.getTileByID(V.proxyTileKey),X=v.proxyCachedFBO[V.key]?v.proxyCachedFBO[V.key][t]:void 0,J=X!==void 0?v.renderCache[X]:this.pool[O++],ee=X!==void 0;if(G.texture=J.tex,ee&&!J.dirty){k.push(G.tileID);continue}let Y;m.bindFramebuffer.set(J.fb.framebuffer),this.renderedToTile=!1,J.dirty&&(m.clear({color:n.Color.transparent,stencil:0}),J.dirty=!1);for(let pe=S.start;pe<=S.end;++pe){const K=a.style._layers[D[pe]];if(K.isHidden(a.transform.zoom))continue;const ne=a.style._getLayerSourceCache(K),oe=ne?this.proxyToSource[V.key][ne.id]:[V];if(!oe)continue;const ge=oe;m.viewport.set([0,0,J.fb.width,J.fb.height]),Y!==(ne?ne.id:null)&&(this._setupStencil(J,oe,K,ne),Y=ne?ne.id:null),a.renderLayer(a,ne,K,ge)}this.renderedToTile?(J.dirty=!0,k.push(G.tileID)):ee||--O,O===5&&(O=0,this.renderToBackBuffer(k))}return this.renderToBackBuffer(k),this.renderingToTexture=!1,m.bindFramebuffer.set(null),m.viewport.set([0,0,a.width,a.height]),S.end+1}postRender(){}renderCacheEfficiency(t){const a=t.order.length;if(a===0)return{efficiency:100};let m,v=0,b=0,S=!1;for(let k=0;k<a;++k){const D=t._layers[t.order[k]];this._style.isLayerDraped(D)?(S&&++v,++b):S||(S=!0,m=D.id)}return b===0?{efficiency:100}:{efficiency:100*(1-v/b),firstUndrapedLayer:m}}getMinElevationBelowMSL(){let t=0;return this._visibleDemTiles.filter(a=>a.dem).forEach(a=>{t=Math.min(t,a.dem.tree.minimums[0])}),t===0?t:(t-30)*this._exaggeration}raycast(t,a,m){if(!this._visibleDemTiles)return null;const v=this._visibleDemTiles.filter(b=>b.dem).map(b=>{const S=b.tileID,k=Math.pow(2,S.overscaledZ),{x:D,y:O}=S.canonical,V=D/k,G=(D+1)/k,X=O/k,J=(O+1)/k;return{minx:V,miny:X,maxx:G,maxy:J,t:b.dem.tree.raycastRoot(V,X,G,J,t,a,m),tile:b}});v.sort((b,S)=>(b.t!==null?b.t:Number.MAX_VALUE)-(S.t!==null?S.t:Number.MAX_VALUE));for(const b of v){if(b.t==null)return null;const S=b.tile.dem.tree.raycast(b.minx,b.miny,b.maxx,b.maxy,t,a,m);if(S!=null)return S}return null}_createFBO(){const t=this.painter.context,a=t.gl,m=this.drapeBufferSize;t.activeTexture.set(a.TEXTURE0);const v=new n.Texture(t,{width:m[0],height:m[1],data:null},a.RGBA);v.bind(a.LINEAR,a.CLAMP_TO_EDGE);const b=t.createFramebuffer(m[0],m[1],!1);return b.colorAttachment.set(v.texture),b.depthAttachment=new j(t,b.framebuffer),this._sharedDepthStencil===void 0?(this._sharedDepthStencil=t.createRenderbuffer(t.gl.DEPTH_STENCIL,m[0],m[1]),this._stencilRef=0,b.depthAttachment.set(this._sharedDepthStencil),t.clear({stencil:0})):b.depthAttachment.set(this._sharedDepthStencil),t.extTextureFilterAnisotropic&&!t.extTextureFilterAnisotropicForceOff&&a.texParameterf(a.TEXTURE_2D,t.extTextureFilterAnisotropic.TEXTURE_MAX_ANISOTROPY_EXT,t.extTextureFilterAnisotropicMax),{fb:b,tex:v,dirty:!1}}_initFBOPool(){for(;this.pool.length<Math.min(5,this.proxyCoords.length);)this.pool.push(this._createFBO())}_shouldDisableRenderCache(){if(this._style.light&&this._style.light.hasTransition())return!0;for(const t in this._style._sourceCaches)if(this._style._sourceCaches[t].hasTransition())return!0;return this._style.order.some(t=>{const a=this._style._layers[t],m=a.isHidden(this.painter.transform.zoom),v=a.getCrossfadeParameters(),b=!!v&&v.t!==1,S=a.hasTransition();return a.type!=="custom"&&!m&&(b||S)})}_clearRasterFadeFromRenderCache(){let t=!1;for(const a in this._style._sourceCaches)if(this._style._sourceCaches[a]._source instanceof me){t=!0;break}if(t)for(let a=0;a<this._style.order.length;++a){const m=this._style._layers[this._style.order[a]],v=m.isHidden(this.painter.transform.zoom),b=this._style._getLayerSourceCache(m);if(m.type!=="raster"||v||!b)continue;const S=m.paint.get("raster-fade-duration");for(const k of this.proxyCoords){const D=this.proxyToSource[k.key][b.id];if(D)for(const O of D){const V=vc(b.getTile(O),b.findLoadedParent(O,0),b,this.painter.transform,S);(V.opacity!==1||V.mix!==0)&&this._clearRenderCacheForTile(b.id,O)}}}}_setupDrapedRenderBatches(){const t=this._style.order,a=t.length;if(a===0)return;const m=[];let v,b=0,S=this._style._layers[t[b]];for(;!this._style.isLayerDraped(S)&&S.isHidden(this.painter.transform.zoom)&&++b<a;)S=this._style._layers[t[b]];for(;b<a;++b){const k=this._style._layers[t[b]];k.isHidden(this.painter.transform.zoom)||(this._style.isLayerDraped(k)?v===void 0&&(v=b):v!==void 0&&(m.push({start:v,end:b-1}),v=void 0))}v!==void 0&&m.push({start:v,end:b-1}),this._drapedRenderBatches=m}_setupRenderCache(t){const a=this.proxySourceCache;if(this._shouldDisableRenderCache()||this._invalidateRenderCache){if(this._invalidateRenderCache=!1,a.renderCache.length>a.renderCachePool.length){const S=Object.values(a.proxyCachedFBO);a.proxyCachedFBO={};for(let k=0;k<S.length;++k){const D=Object.values(S[k]);a.renderCachePool.push(...D)}}return}this._clearRasterFadeFromRenderCache();const m=this.proxyCoords,v=this._tilesDirty;for(let S=m.length-1;S>=0;S--){const k=m[S];if(a.getTileByID(k.key),a.proxyCachedFBO[k.key]!==void 0){const D=t[k.key],O=this.proxyToSource[k.key];let V=0;for(const G in O){const X=O[G],J=D[G];if(!J||J.length!==X.length||X.some((ee,Y)=>ee!==J[Y]||v[G]&&v[G].hasOwnProperty(ee.key))){V=-1;break}++V}for(const G in a.proxyCachedFBO[k.key])a.renderCache[a.proxyCachedFBO[k.key][G]].dirty=V<0||V!==Object.values(D).length}}const b=[...this._drapedRenderBatches];b.sort((S,k)=>k.end-k.start-(S.end-S.start));for(const S of b)for(const k of m){if(a.proxyCachedFBO[k.key])continue;let D=a.renderCachePool.pop();D===void 0&&a.renderCache.length<50&&(D=a.renderCache.length,a.renderCache.push(this._createFBO())),D!==void 0&&(a.proxyCachedFBO[k.key]={},a.proxyCachedFBO[k.key][S.start]=D,a.renderCache[D].dirty=!0)}this._tilesDirty={}}_setupStencil(t,a,m,v){if(!v||!this._sourceTilesOverlap[v.id])return void(this._overlapStencilType&&(this._overlapStencilType=!1));const b=this.painter.context,S=b.gl;if(a.length<=1)return void(this._overlapStencilType=!1);let k;if(m.isTileClipped())k=a.length,this._overlapStencilMode.test={func:S.EQUAL,mask:255},this._overlapStencilType="Clip";else{if(!(a[0].overscaledZ>a[a.length-1].overscaledZ))return void(this._overlapStencilType=!1);k=1,this._overlapStencilMode.test={func:S.GREATER,mask:255},this._overlapStencilType="Mask"}this._stencilRef+k>255&&(b.clear({stencil:0}),this._stencilRef=0),this._stencilRef+=k,this._overlapStencilMode.ref=this._stencilRef,m.isTileClipped()&&this._renderTileClippingMasks(a,this._overlapStencilMode.ref)}clipOrMaskOverlapStencilType(){return this._overlapStencilType==="Clip"||this._overlapStencilType==="Mask"}stencilModeForRTTOverlap(t){return this.renderingToTexture&&this._overlapStencilType?(this._overlapStencilType==="Clip"&&(this._overlapStencilMode.ref=this.painter._tileClippingMaskIDs[t.key]),this._overlapStencilMode):n.StencilMode.disabled}_renderTileClippingMasks(t,a){const m=this.painter,v=this.painter.context,b=v.gl;m._tileClippingMaskIDs={},v.setColorMode(n.ColorMode.disabled),v.setDepthMode(n.DepthMode.disabled);const S=m.useProgram("clippingMask");for(const k of t){const D=m._tileClippingMaskIDs[k.key]=--a;S.draw(v,b.TRIANGLES,n.DepthMode.disabled,new n.StencilMode({func:b.ALWAYS,mask:0},D,255,b.KEEP,b.KEEP,b.REPLACE),n.ColorMode.disabled,n.CullFaceMode.disabled,ha(k.projMatrix),"$clipping",m.tileExtentBuffer,m.quadTriangleIndexBuffer,m.tileExtentSegments)}}pointCoordinate(t){const a=this.painter.transform;if(t.x<0||t.x>a.width||t.y<0||t.y>a.height)return null;const m=[t.x,t.y,1,1];n.transformMat4$1(m,m,a.pixelMatrixInverse),n.scale$1(m,m,1/m[3]),m[0]/=a.worldSize,m[1]/=a.worldSize;const v=a._camera.position,b=n.mercatorZfromAltitude(1,a.center.lat),S=[v[0],v[1],v[2]/b,0],k=n.subtract([],m.slice(0,3),S);n.normalize(k,k);const D=this.raycast(S,k,this._exaggeration);return D!==null&&D?(n.scaleAndAdd(S,S,k,D),S[3]=S[2],S[2]*=b,S):null}drawDepth(){const t=this.painter,a=t.context,m=this.proxySourceCache,v=Math.ceil(t.width),b=Math.ceil(t.height);if(!this._depthFBO||this._depthFBO.width===v&&this._depthFBO.height===b||(this._depthFBO.destroy(),this._depthFBO=void 0,this._depthTexture=void 0),!this._depthFBO){const S=a.gl,k=a.createFramebuffer(v,b,!0);a.activeTexture.set(S.TEXTURE0);const D=new n.Texture(a,{width:v,height:b,data:null},S.RGBA);D.bind(S.NEAREST,S.CLAMP_TO_EDGE),k.colorAttachment.set(D.texture);const O=a.createRenderbuffer(a.gl.DEPTH_COMPONENT16,v,b);k.depthAttachment.set(O),this._depthFBO=k,this._depthTexture=D}a.bindFramebuffer.set(this._depthFBO.framebuffer),a.viewport.set([0,0,v,b]),function(S,k,D,O){if(S.transform.projection.name==="globe")return;const V=S.context,G=V.gl;V.clear({depth:1});const X=S.useProgram("terrainDepth"),J=new n.DepthMode(G.LESS,n.DepthMode.ReadWrite,S.depthRangeFor3D);for(const ee of O){const Y=D.getTile(ee),pe=ul(ee.projMatrix,0);k.setupElevationDraw(Y,X),X.draw(V,G.TRIANGLES,J,n.StencilMode.disabled,n.ColorMode.unblended,n.CullFaceMode.backCCW,pe,"terrain_depth",k.gridBuffer,k.gridIndexBuffer,k.gridNoSkirtSegments)}}(t,this,m,this.proxyCoords)}_setupProxiedCoordsForOrtho(t,a,m){if(t.getSource()instanceof Ie)return this._setupProxiedCoordsForImageSource(t,a,m);this._findCoveringTileCache[t.id]=this._findCoveringTileCache[t.id]||{};const v=this.proxiedCoords[t.id]=[],b=this.proxyCoords;for(let k=0;k<b.length;k++){const D=b[k],O=this._findTileCoveringTileID(D,t);if(O){const V=this._createProxiedId(D,O,m[D.key]&&m[D.key][t.id]);v.push(V),this.proxyToSource[D.key][t.id]=[V]}}let S=!1;for(let k=0;k<a.length;k++){const D=t.getTile(a[k]);if(!D||!D.hasData())continue;const O=this._findTileCoveringTileID(D.tileID,this.proxySourceCache);if(O&&O.tileID.canonical.z!==D.tileID.canonical.z){const V=this.proxyToSource[O.tileID.key][t.id],G=this._createProxiedId(O.tileID,D,m[O.tileID.key]&&m[O.tileID.key][t.id]);V?V.splice(V.length-1,0,G):this.proxyToSource[O.tileID.key][t.id]=[G],v.push(G),S=!0}}this._sourceTilesOverlap[t.id]=S}_setupProxiedCoordsForImageSource(t,a,m){if(!t.getSource().loaded())return;const v=this.proxiedCoords[t.id]=[],b=this.proxyCoords,S=t.getSource(),k=new n.pointGeometry(S.tileID.x,S.tileID.y)._div(1<<S.tileID.z),D=S.coordinates.map(n.MercatorCoordinate.fromLngLat).reduce((V,G)=>(V.min.x=Math.min(V.min.x,G.x-k.x),V.min.y=Math.min(V.min.y,G.y-k.y),V.max.x=Math.max(V.max.x,G.x-k.x),V.max.y=Math.max(V.max.y,G.y-k.y),V),{min:new n.pointGeometry(Number.MAX_VALUE,Number.MAX_VALUE),max:new n.pointGeometry(-Number.MAX_VALUE,-Number.MAX_VALUE)}),O=(V,G)=>{const X=V.wrap+V.canonical.x/(1<<V.canonical.z),J=V.canonical.y/(1<<V.canonical.z),ee=n.EXTENT/(1<<V.canonical.z),Y=G.wrap+G.canonical.x/(1<<G.canonical.z),pe=G.canonical.y/(1<<G.canonical.z);return X+ee<Y+D.min.x||X>Y+D.max.x||J+ee<pe+D.min.y||J>pe+D.max.y};for(let V=0;V<b.length;V++){const G=b[V];for(let X=0;X<a.length;X++){const J=t.getTile(a[X]);if(!J||!J.hasData()||O(G,J.tileID))continue;const ee=this._createProxiedId(G,J,m[G.key]&&m[G.key][t.id]),Y=this.proxyToSource[G.key][t.id];Y?Y.push(ee):this.proxyToSource[G.key][t.id]=[ee],v.push(ee)}}}_createProxiedId(t,a,m){let v=this.orthoMatrix;if(m){const b=m.find(S=>S.key===a.tileID.key);if(b)return b}if(a.tileID.key!==t.key){const b=t.canonical.z-a.tileID.canonical.z;let S,k,D;v=n.create();const O=a.tileID.wrap-t.wrap<<t.overscaledZ;b>0?(S=n.EXTENT>>b,k=S*((a.tileID.canonical.x<<b)-t.canonical.x+O),D=S*((a.tileID.canonical.y<<b)-t.canonical.y)):(S=n.EXTENT<<-b,k=n.EXTENT*(a.tileID.canonical.x-(t.canonical.x+O<<-b)),D=n.EXTENT*(a.tileID.canonical.y-(t.canonical.y<<-b))),n.ortho(v,0,S,0,S,0,1),n.translate(v,v,[k,D,0])}return new hl(a.tileID,t.key,v)}_findTileCoveringTileID(t,a){let m=a.getTile(t);if(m&&m.hasData())return m;const v=this._findCoveringTileCache[a.id],b=v[t.key];if(m=b?a.getTileByID(b):null,m&&m.hasData()||b===null)return m;let S=m?m.tileID:t,k=S.overscaledZ;const D=a.getSource().minzoom,O=[];if(!b){const G=a.getSource().maxzoom;if(t.canonical.z>=G){const X=t.canonical.z-G;a.getSource().reparseOverscaled?(k=Math.max(t.canonical.z+2,a.transform.tileZoom),S=new n.OverscaledTileID(k,t.wrap,G,t.canonical.x>>X,t.canonical.y>>X)):X!==0&&(k=G,S=new n.OverscaledTileID(k,t.wrap,G,t.canonical.x>>X,t.canonical.y>>X))}S.key!==t.key&&(O.push(S.key),m=a.getTile(S))}const V=G=>{O.forEach(X=>{v[X]=G}),O.length=0};for(k-=1;k>=D&&(!m||!m.hasData());k--){m&&V(m.tileID.key);const G=S.calculateScaledKey(k);if(m=a.getTileByID(G),m&&m.hasData())break;const X=v[G];if(X===null)break;X===void 0?O.push(G):m=a.getTileByID(X)}return V(m?m.tileID.key:null),m&&m.hasData()?m:null}findDEMTileFor(t){return this.enabled?this._findTileCoveringTileID(t,this.sourceCache):null}prepareDrawTile(){this.renderedToTile=!0}_clearRenderCacheForTile(t,a){let m=this._tilesDirty[t];m||(m=this._tilesDirty[t]={}),m[a.key]=!0}getWirefameBuffer(){if(!this.wireframeSegments){const t=function(a){let m=0;const v=new n.StructArrayLayout2ui4,b=131;for(let S=1;S<129;S++){for(let k=1;k<129;k++)m=S*b+k,v.emplaceBack(m,m+1),v.emplaceBack(m,m+b),v.emplaceBack(m+1,m+b),S===128&&v.emplaceBack(m+b,m+b+1);v.emplaceBack(m+1,m+1+b)}return v}();this.wireframeIndexBuffer=this.painter.context.createIndexBuffer(t),this.wireframeSegments=n.SegmentVector.simpleSegment(0,0,this.gridBuffer.length,t.length)}return[this.wireframeIndexBuffer,this.wireframeSegments]}}function pl(p){const t=[];for(let a=0;a<p.length;a++){if(p[a]===null)continue;const m=p[a].split(" ");t.push(m.pop())}return t}class fl{static cacheKey(t,a,m){let v=`${t}${m?m.cacheKey:""}`;for(const b of a)v+=`/${b}`;return v}constructor(t,a,m,v,b,S){const k=t.gl;this.program=k.createProgram();const D=pl(m.staticAttributes),O=v?v.getBinderAttributes():[],V=D.concat(O),G=m.staticUniforms?pl(m.staticUniforms):[],X=v?v.getBinderUniforms():[],J=G.concat(X),ee=[];for(const he of J)ee.indexOf(he)<0&&ee.push(he);let Y=v?v.defines():[];Y=Y.concat(S.map(he=>`#define ${he}`));const pe=Y.concat(t.extStandardDerivatives?`#extension GL_OES_standard_derivatives : enable
`.concat(_s):_s,_s,ms,ol.fragmentSource,eo.fragmentSource,m.fragmentSource).join(`
`),K=Y.concat(`
#ifdef GL_ES
precision highp float;
#else

#if !defined(lowp)
#define lowp
#endif

#if !defined(mediump)
#define mediump
#endif

#if !defined(highp)
#define highp
#endif

#endif`,ms,ol.vertexSource,eo.vertexSource,la.vertexSource,m.vertexSource).join(`
`),ne=k.createShader(k.FRAGMENT_SHADER);if(k.isContextLost())return void(this.failedToCreate=!0);k.shaderSource(ne,pe),k.compileShader(ne),k.attachShader(this.program,ne);const oe=k.createShader(k.VERTEX_SHADER);if(k.isContextLost())return void(this.failedToCreate=!0);k.shaderSource(oe,K),k.compileShader(oe),k.attachShader(this.program,oe),this.attributes={};const ge={};this.numAttributes=V.length;for(let he=0;he<this.numAttributes;he++)V[he]&&(k.bindAttribLocation(this.program,he,V[he]),this.attributes[V[he]]=he);k.linkProgram(this.program),k.deleteShader(oe),k.deleteShader(ne);for(let he=0;he<ee.length;he++){const fe=ee[he];if(fe&&!ge[fe]){const be=k.getUniformLocation(this.program,fe);be&&(ge[fe]=be)}}this.fixedUniforms=b(t,ge),this.binderUniforms=v?v.getUniforms(t,ge):[],S.indexOf("TERRAIN")!==-1&&(this.terrainUniforms=((he,fe)=>({u_dem:new n.Uniform1i(he,fe.u_dem),u_dem_prev:new n.Uniform1i(he,fe.u_dem_prev),u_dem_unpack:new n.Uniform4f(he,fe.u_dem_unpack),u_dem_tl:new n.Uniform2f(he,fe.u_dem_tl),u_dem_scale:new n.Uniform1f(he,fe.u_dem_scale),u_dem_tl_prev:new n.Uniform2f(he,fe.u_dem_tl_prev),u_dem_scale_prev:new n.Uniform1f(he,fe.u_dem_scale_prev),u_dem_size:new n.Uniform1f(he,fe.u_dem_size),u_dem_lerp:new n.Uniform1f(he,fe.u_dem_lerp),u_exaggeration:new n.Uniform1f(he,fe.u_exaggeration),u_depth:new n.Uniform1i(he,fe.u_depth),u_depth_size_inv:new n.Uniform2f(he,fe.u_depth_size_inv),u_meter_to_dem:new n.Uniform1f(he,fe.u_meter_to_dem),u_label_plane_matrix_inv:new n.UniformMatrix4f(he,fe.u_label_plane_matrix_inv),u_tile_tl_up:new n.Uniform3f(he,fe.u_tile_tl_up),u_tile_tr_up:new n.Uniform3f(he,fe.u_tile_tr_up),u_tile_br_up:new n.Uniform3f(he,fe.u_tile_br_up),u_tile_bl_up:new n.Uniform3f(he,fe.u_tile_bl_up),u_tile_up_scale:new n.Uniform1f(he,fe.u_tile_up_scale)}))(t,ge)),S.indexOf("FOG")!==-1&&(this.fogUniforms=((he,fe)=>({u_fog_matrix:new n.UniformMatrix4f(he,fe.u_fog_matrix),u_fog_range:new n.Uniform2f(he,fe.u_fog_range),u_fog_color:new n.Uniform4f(he,fe.u_fog_color),u_fog_horizon_blend:new n.Uniform1f(he,fe.u_fog_horizon_blend),u_fog_temporal_offset:new n.Uniform1f(he,fe.u_fog_temporal_offset),u_frustum_tl:new n.Uniform3f(he,fe.u_frustum_tl),u_frustum_tr:new n.Uniform3f(he,fe.u_frustum_tr),u_frustum_br:new n.Uniform3f(he,fe.u_frustum_br),u_frustum_bl:new n.Uniform3f(he,fe.u_frustum_bl),u_globe_pos:new n.Uniform3f(he,fe.u_globe_pos),u_globe_radius:new n.Uniform1f(he,fe.u_globe_radius),u_globe_transition:new n.Uniform1f(he,fe.u_globe_transition),u_is_globe:new n.Uniform1i(he,fe.u_is_globe),u_viewport:new n.Uniform2f(he,fe.u_viewport)}))(t,ge))}setTerrainUniformValues(t,a){if(!this.terrainUniforms)return;const m=this.terrainUniforms;if(!this.failedToCreate){t.program.set(this.program);for(const v in a)m[v].set(a[v])}}setFogUniformValues(t,a){if(!this.fogUniforms)return;const m=this.fogUniforms;if(!this.failedToCreate){t.program.set(this.program);for(const v in a)m[v].location&&m[v].set(a[v])}}draw(t,a,m,v,b,S,k,D,O,V,G,X,J,ee,Y,pe,K){const ne=t.gl;if(this.failedToCreate)return;t.program.set(this.program),t.setDepthMode(m),t.setStencilMode(v),t.setColorMode(b),t.setCullFace(S);for(const ge of Object.keys(this.fixedUniforms))this.fixedUniforms[ge].set(k[ge]);ee&&ee.setUniforms(t,this.binderUniforms,X,{zoom:J});const oe={[ne.LINES]:2,[ne.TRIANGLES]:3,[ne.LINE_STRIP]:1}[a];for(const ge of G.get()){const he=ge.vaos||(ge.vaos={});(he[D]||(he[D]=new Hu)).bind(t,this,O,ee?ee.getPaintVertexBuffers():[],V,ge.vertexOffset,Y,pe,K),ne.drawElements(a,ge.primitiveLength*oe,ne.UNSIGNED_SHORT,ge.primitiveOffset*oe*2)}}}function bc(p,t,a){const m=1/Lt(a,1,t.transform.tileZoom),v=Math.pow(2,a.tileID.overscaledZ),b=a.tileSize*Math.pow(2,t.transform.tileZoom)/v,S=b*(a.tileID.canonical.x+a.tileID.wrap*v),k=b*a.tileID.canonical.y;return{u_image:0,u_texsize:a.imageAtlasTexture.size,u_scale:[m,p.fromScale,p.toScale],u_fade:p.t,u_pixel_coord_upper:[S>>16,k>>16],u_pixel_coord_lower:[65535&S,65535&k]}}const Ju=n.create(),Qu=(p,t,a,m,v,b,S,k,D)=>{const O=t.style.light,V=O.properties.get("position"),G=[V.x,V.y,V.z],X=n.create$1();O.properties.get("anchor")==="viewport"&&(n.fromRotation(X,-t.transform.angle),n.transformMat3(G,G,X));const J=O.properties.get("color"),ee=t.transform,Y={u_matrix:p,u_lightpos:G,u_lightintensity:O.properties.get("intensity"),u_lightcolor:[J.r,J.g,J.b],u_vertical_gradient:+a,u_opacity:m,u_tile_id:[0,0,0],u_zoom_transition:0,u_inv_rot_matrix:Ju,u_merc_center:[0,0],u_up_dir:[0,0,0],u_height_lift:0};return ee.projection.name==="globe"&&(Y.u_tile_id=[v.canonical.x,v.canonical.y,1<<v.canonical.z],Y.u_zoom_transition=S,Y.u_inv_rot_matrix=D,Y.u_merc_center=k,Y.u_up_dir=ee.projection.upVector(new n.CanonicalTileID(0,0,0),k[0]*n.EXTENT,k[1]*n.EXTENT),Y.u_height_lift=b),Y},pa=(p,t,a,m,v,b,S,k,D,O,V)=>{const G=Qu(p,t,a,m,v,k,D,O,V),X={u_height_factor:-Math.pow(2,v.overscaledZ)/S.tileSize/8};return n.extend(G,bc(b,t,S),X)},gs=p=>({u_matrix:p}),wc=(p,t,a,m)=>n.extend(gs(p),bc(a,t,m)),dl=(p,t)=>({u_matrix:p,u_world:t}),Ec=(p,t,a,m,v)=>n.extend(wc(p,t,a,m),{u_world:v}),Ln=n.create(),Tc=(p,t,a,m,v,b)=>{const S=p.transform,k=S.projection.name==="globe";let D;if(b.paint.get("circle-pitch-alignment")==="map")if(k){const V=n.globePixelsToTileUnits(S.zoom,t.canonical)*S._projectionScaler;D=Float32Array.from([V,0,0,V])}else D=S.calculatePixelsToTileUnitsMatrix(a);else D=new Float32Array([S.pixelsToGLUnits[0],0,0,S.pixelsToGLUnits[1]]);const O={u_camera_to_center_distance:S.cameraToCenterDistance,u_matrix:p.translatePosMatrix(t.projMatrix,a,b.paint.get("circle-translate"),b.paint.get("circle-translate-anchor")),u_device_pixel_ratio:n.exported.devicePixelRatio,u_extrude_scale:D,u_inv_rot_matrix:Ln,u_merc_center:[0,0],u_tile_id:[0,0,0],u_zoom_transition:0,u_up_dir:[0,0,0]};if(k){O.u_inv_rot_matrix=m,O.u_merc_center=v,O.u_tile_id=[t.canonical.x,t.canonical.y,1<<t.canonical.z],O.u_zoom_transition=n.globeToMercatorTransition(S.zoom);const V=v[0]*n.EXTENT,G=v[1]*n.EXTENT;O.u_up_dir=S.projection.upVector(new n.CanonicalTileID(0,0,0),V,G)}return O},eh=p=>{const t=[];return p.paint.get("circle-pitch-alignment")==="map"&&t.push("PITCH_WITH_MAP"),p.paint.get("circle-pitch-scale")==="map"&&t.push("SCALE_WITH_MAP"),t},Ac=(p,t,a,m)=>{const v=n.EXTENT/a.tileSize;return{u_matrix:p,u_camera_to_center_distance:t.getCameraToCenterDistance(m),u_extrude_scale:[t.pixelsToGLUnits[0]/v,t.pixelsToGLUnits[1]/v]}},Sc=(p,t,a=1)=>({u_matrix:p,u_color:t,u_overlay:0,u_overlay_scale:a}),Mc=n.create(),af=(p,t,a,m,v,b,S)=>{const k=p.transform,D=k.projection.name==="globe",O=D?n.globePixelsToTileUnits(k.zoom,t.canonical)*k._projectionScaler:Lt(a,1,b),V={u_matrix:t.projMatrix,u_extrude_scale:O,u_intensity:S,u_inv_rot_matrix:Mc,u_merc_center:[0,0],u_tile_id:[0,0,0],u_zoom_transition:0,u_up_dir:[0,0,0]};if(D){V.u_inv_rot_matrix=m,V.u_merc_center=v,V.u_tile_id=[t.canonical.x,t.canonical.y,1<<t.canonical.z],V.u_zoom_transition=n.globeToMercatorTransition(k.zoom);const G=v[0]*n.EXTENT,X=v[1]*n.EXTENT;V.u_up_dir=k.projection.upVector(new n.CanonicalTileID(0,0,0),G,X)}return V},Ic=(p,t,a,m,v,b,S,k)=>{const D=p.transform,O=D.calculatePixelsToTileUnitsMatrix(t),V={u_matrix:th(p,t,a,v),u_pixels_to_tile_units:O,u_device_pixel_ratio:S,u_units_to_pixels:[1/D.pixelsToGLUnits[0],1/D.pixelsToGLUnits[1]],u_dash_image:0,u_gradient_image:1,u_image_height:b,u_texsize:[0,0],u_scale:[0,0,0],u_mix:0,u_alpha_discard_threshold:0,u_trim_offset:k};if(ml(a)){const G=fa(t,p.transform);V.u_texsize=t.lineAtlasTexture.size,V.u_scale=[G,m.fromScale,m.toScale],V.u_mix=m.t}return V},lf=(p,t,a,m,v,b)=>{const S=p.transform,k=fa(t,S);return{u_matrix:th(p,t,a,v),u_texsize:t.imageAtlasTexture.size,u_pixels_to_tile_units:S.calculatePixelsToTileUnitsMatrix(t),u_device_pixel_ratio:b,u_image:0,u_scale:[k,m.fromScale,m.toScale],u_fade:m.t,u_units_to_pixels:[1/S.pixelsToGLUnits[0],1/S.pixelsToGLUnits[1]],u_alpha_discard_threshold:0}};function fa(p,t){return 1/Lt(p,1,t.tileZoom)}function th(p,t,a,m){return p.translatePosMatrix(m||t.tileID.projMatrix,t,a.paint.get("line-translate"),a.paint.get("line-translate-anchor"))}function ml(p){const t=p.paint.get("line-dasharray").value;return t.value||t.kind!=="constant"}const cf=(p,t,a,m,v,b)=>{return{u_matrix:p,u_tl_parent:t,u_scale_parent:a,u_fade_t:m.mix,u_opacity:m.opacity*v.paint.get("raster-opacity"),u_image0:0,u_image1:1,u_brightness_low:v.paint.get("raster-brightness-min"),u_brightness_high:v.paint.get("raster-brightness-max"),u_saturation_factor:(k=v.paint.get("raster-saturation"),k>0?1-1/(1.001-k):-k),u_contrast_factor:(S=v.paint.get("raster-contrast"),S>0?1/(1-S):1+S),u_spin_weights:kc(v.paint.get("raster-hue-rotate")),u_perspective_transform:b};var S,k};function kc(p){p*=Math.PI/180;const t=Math.sin(p),a=Math.cos(p);return[(2*a+1)/3,(-Math.sqrt(3)*t-a+1)/3,(Math.sqrt(3)*t-a+1)/3]}const ih=n.create(),da=(p,t,a,m,v,b,S,k,D,O,V,G,X,J,ee,Y)=>{const pe=v.transform,K={u_is_size_zoom_constant:+(p==="constant"||p==="source"),u_is_size_feature_constant:+(p==="constant"||p==="camera"),u_size_t:t?t.uSizeT:0,u_size:t?t.uSize:0,u_camera_to_center_distance:pe.cameraToCenterDistance,u_rotate_symbol:+a,u_aspect_ratio:pe.width/pe.height,u_fade_change:v.options.fadeDuration?v.symbolFadeChange:1,u_matrix:b,u_label_plane_matrix:S,u_coord_matrix:k,u_is_text:+D,u_pitch_with_map:+m,u_texsize:O,u_texture:0,u_tile_id:[0,0,0],u_zoom_transition:0,u_inv_rot_matrix:ih,u_merc_center:[0,0],u_camera_forward:[0,0,0],u_ecef_origin:[0,0,0],u_tile_matrix:ih,u_up_vector:[0,-1,0]};return Y.name==="globe"&&(K.u_tile_id=[V.canonical.x,V.canonical.y,1<<V.canonical.z],K.u_zoom_transition=G,K.u_inv_rot_matrix=J,K.u_merc_center=X,K.u_camera_forward=pe._camera.forward(),K.u_ecef_origin=n.globeECEFOrigin(pe.globeMatrix,V.toUnwrapped()),K.u_tile_matrix=Float32Array.from(pe.globeMatrix),K.u_up_vector=ee),K},rh=(p,t,a,m,v,b,S,k,D,O,V,G,X,J,ee,Y,pe)=>n.extend(da(p,t,a,m,v,b,S,k,D,O,G,X,J,ee,Y,pe),{u_gamma_scale:m?v.transform.cameraToCenterDistance*Math.cos(v.terrain?0:v.transform._pitch):1,u_device_pixel_ratio:n.exported.devicePixelRatio,u_is_halo:+V}),nh=(p,t,a,m,v,b,S,k,D,O,V,G,X,J,ee,Y)=>n.extend(rh(p,t,a,m,v,b,S,k,!0,D,!0,V,G,X,J,ee,Y),{u_texsize_icon:O,u_texture_icon:1}),oh=(p,t,a)=>({u_matrix:p,u_opacity:t,u_color:a}),ys=(p,t,a,m,v,b)=>n.extend(function(S,k,D,O){const V=D.imageManager.getPattern(S.from.toString()),G=D.imageManager.getPattern(S.to.toString()),{width:X,height:J}=D.imageManager.getPixelSize(),ee=Math.pow(2,O.tileID.overscaledZ),Y=O.tileSize*Math.pow(2,D.transform.tileZoom)/ee,pe=Y*(O.tileID.canonical.x+O.tileID.wrap*ee),K=Y*O.tileID.canonical.y;return{u_image:0,u_pattern_tl_a:V.tl,u_pattern_br_a:V.br,u_pattern_tl_b:G.tl,u_pattern_br_b:G.br,u_texsize:[X,J],u_mix:k.t,u_pattern_size_a:V.displaySize,u_pattern_size_b:G.displaySize,u_scale_a:k.fromScale,u_scale_b:k.toScale,u_tile_units_to_pixels:1/Lt(O,1,D.transform.tileZoom),u_pixel_coord_upper:[pe>>16,K>>16],u_pixel_coord_lower:[65535&pe,65535&K]}}(m,b,a,v),{u_matrix:p,u_opacity:t}),uf={fillExtrusion:(p,t)=>({u_matrix:new n.UniformMatrix4f(p,t.u_matrix),u_lightpos:new n.Uniform3f(p,t.u_lightpos),u_lightintensity:new n.Uniform1f(p,t.u_lightintensity),u_lightcolor:new n.Uniform3f(p,t.u_lightcolor),u_vertical_gradient:new n.Uniform1f(p,t.u_vertical_gradient),u_opacity:new n.Uniform1f(p,t.u_opacity),u_tile_id:new n.Uniform3f(p,t.u_tile_id),u_zoom_transition:new n.Uniform1f(p,t.u_zoom_transition),u_inv_rot_matrix:new n.UniformMatrix4f(p,t.u_inv_rot_matrix),u_merc_center:new n.Uniform2f(p,t.u_merc_center),u_up_dir:new n.Uniform3f(p,t.u_up_dir),u_height_lift:new n.Uniform1f(p,t.u_height_lift)}),fillExtrusionPattern:(p,t)=>({u_matrix:new n.UniformMatrix4f(p,t.u_matrix),u_lightpos:new n.Uniform3f(p,t.u_lightpos),u_lightintensity:new n.Uniform1f(p,t.u_lightintensity),u_lightcolor:new n.Uniform3f(p,t.u_lightcolor),u_vertical_gradient:new n.Uniform1f(p,t.u_vertical_gradient),u_height_factor:new n.Uniform1f(p,t.u_height_factor),u_tile_id:new n.Uniform3f(p,t.u_tile_id),u_zoom_transition:new n.Uniform1f(p,t.u_zoom_transition),u_inv_rot_matrix:new n.UniformMatrix4f(p,t.u_inv_rot_matrix),u_merc_center:new n.Uniform2f(p,t.u_merc_center),u_up_dir:new n.Uniform3f(p,t.u_up_dir),u_height_lift:new n.Uniform1f(p,t.u_height_lift),u_image:new n.Uniform1i(p,t.u_image),u_texsize:new n.Uniform2f(p,t.u_texsize),u_pixel_coord_upper:new n.Uniform2f(p,t.u_pixel_coord_upper),u_pixel_coord_lower:new n.Uniform2f(p,t.u_pixel_coord_lower),u_scale:new n.Uniform3f(p,t.u_scale),u_fade:new n.Uniform1f(p,t.u_fade),u_opacity:new n.Uniform1f(p,t.u_opacity)}),fill:(p,t)=>({u_matrix:new n.UniformMatrix4f(p,t.u_matrix)}),fillPattern:(p,t)=>({u_matrix:new n.UniformMatrix4f(p,t.u_matrix),u_image:new n.Uniform1i(p,t.u_image),u_texsize:new n.Uniform2f(p,t.u_texsize),u_pixel_coord_upper:new n.Uniform2f(p,t.u_pixel_coord_upper),u_pixel_coord_lower:new n.Uniform2f(p,t.u_pixel_coord_lower),u_scale:new n.Uniform3f(p,t.u_scale),u_fade:new n.Uniform1f(p,t.u_fade)}),fillOutline:(p,t)=>({u_matrix:new n.UniformMatrix4f(p,t.u_matrix),u_world:new n.Uniform2f(p,t.u_world)}),fillOutlinePattern:(p,t)=>({u_matrix:new n.UniformMatrix4f(p,t.u_matrix),u_world:new n.Uniform2f(p,t.u_world),u_image:new n.Uniform1i(p,t.u_image),u_texsize:new n.Uniform2f(p,t.u_texsize),u_pixel_coord_upper:new n.Uniform2f(p,t.u_pixel_coord_upper),u_pixel_coord_lower:new n.Uniform2f(p,t.u_pixel_coord_lower),u_scale:new n.Uniform3f(p,t.u_scale),u_fade:new n.Uniform1f(p,t.u_fade)}),circle:(p,t)=>({u_camera_to_center_distance:new n.Uniform1f(p,t.u_camera_to_center_distance),u_extrude_scale:new n.UniformMatrix2f(p,t.u_extrude_scale),u_device_pixel_ratio:new n.Uniform1f(p,t.u_device_pixel_ratio),u_matrix:new n.UniformMatrix4f(p,t.u_matrix),u_inv_rot_matrix:new n.UniformMatrix4f(p,t.u_inv_rot_matrix),u_merc_center:new n.Uniform2f(p,t.u_merc_center),u_tile_id:new n.Uniform3f(p,t.u_tile_id),u_zoom_transition:new n.Uniform1f(p,t.u_zoom_transition),u_up_dir:new n.Uniform3f(p,t.u_up_dir)}),collisionBox:(p,t)=>({u_matrix:new n.UniformMatrix4f(p,t.u_matrix),u_camera_to_center_distance:new n.Uniform1f(p,t.u_camera_to_center_distance),u_extrude_scale:new n.Uniform2f(p,t.u_extrude_scale)}),collisionCircle:(p,t)=>({u_matrix:new n.UniformMatrix4f(p,t.u_matrix),u_inv_matrix:new n.UniformMatrix4f(p,t.u_inv_matrix),u_camera_to_center_distance:new n.Uniform1f(p,t.u_camera_to_center_distance),u_viewport_size:new n.Uniform2f(p,t.u_viewport_size)}),debug:(p,t)=>({u_color:new n.UniformColor(p,t.u_color),u_matrix:new n.UniformMatrix4f(p,t.u_matrix),u_overlay:new n.Uniform1i(p,t.u_overlay),u_overlay_scale:new n.Uniform1f(p,t.u_overlay_scale)}),clippingMask:(p,t)=>({u_matrix:new n.UniformMatrix4f(p,t.u_matrix)}),heatmap:(p,t)=>({u_extrude_scale:new n.Uniform1f(p,t.u_extrude_scale),u_intensity:new n.Uniform1f(p,t.u_intensity),u_matrix:new n.UniformMatrix4f(p,t.u_matrix),u_inv_rot_matrix:new n.UniformMatrix4f(p,t.u_inv_rot_matrix),u_merc_center:new n.Uniform2f(p,t.u_merc_center),u_tile_id:new n.Uniform3f(p,t.u_tile_id),u_zoom_transition:new n.Uniform1f(p,t.u_zoom_transition),u_up_dir:new n.Uniform3f(p,t.u_up_dir)}),heatmapTexture:(p,t)=>({u_image:new n.Uniform1i(p,t.u_image),u_color_ramp:new n.Uniform1i(p,t.u_color_ramp),u_opacity:new n.Uniform1f(p,t.u_opacity)}),hillshade:(p,t)=>({u_matrix:new n.UniformMatrix4f(p,t.u_matrix),u_image:new n.Uniform1i(p,t.u_image),u_latrange:new n.Uniform2f(p,t.u_latrange),u_light:new n.Uniform2f(p,t.u_light),u_shadow:new n.UniformColor(p,t.u_shadow),u_highlight:new n.UniformColor(p,t.u_highlight),u_accent:new n.UniformColor(p,t.u_accent)}),hillshadePrepare:(p,t)=>({u_matrix:new n.UniformMatrix4f(p,t.u_matrix),u_image:new n.Uniform1i(p,t.u_image),u_dimension:new n.Uniform2f(p,t.u_dimension),u_zoom:new n.Uniform1f(p,t.u_zoom),u_unpack:new n.Uniform4f(p,t.u_unpack)}),line:(p,t)=>({u_matrix:new n.UniformMatrix4f(p,t.u_matrix),u_pixels_to_tile_units:new n.UniformMatrix2f(p,t.u_pixels_to_tile_units),u_device_pixel_ratio:new n.Uniform1f(p,t.u_device_pixel_ratio),u_units_to_pixels:new n.Uniform2f(p,t.u_units_to_pixels),u_dash_image:new n.Uniform1i(p,t.u_dash_image),u_gradient_image:new n.Uniform1i(p,t.u_gradient_image),u_image_height:new n.Uniform1f(p,t.u_image_height),u_texsize:new n.Uniform2f(p,t.u_texsize),u_scale:new n.Uniform3f(p,t.u_scale),u_mix:new n.Uniform1f(p,t.u_mix),u_alpha_discard_threshold:new n.Uniform1f(p,t.u_alpha_discard_threshold),u_trim_offset:new n.Uniform2f(p,t.u_trim_offset)}),linePattern:(p,t)=>({u_matrix:new n.UniformMatrix4f(p,t.u_matrix),u_texsize:new n.Uniform2f(p,t.u_texsize),u_pixels_to_tile_units:new n.UniformMatrix2f(p,t.u_pixels_to_tile_units),u_device_pixel_ratio:new n.Uniform1f(p,t.u_device_pixel_ratio),u_image:new n.Uniform1i(p,t.u_image),u_units_to_pixels:new n.Uniform2f(p,t.u_units_to_pixels),u_scale:new n.Uniform3f(p,t.u_scale),u_fade:new n.Uniform1f(p,t.u_fade),u_alpha_discard_threshold:new n.Uniform1f(p,t.u_alpha_discard_threshold)}),raster:(p,t)=>({u_matrix:new n.UniformMatrix4f(p,t.u_matrix),u_tl_parent:new n.Uniform2f(p,t.u_tl_parent),u_scale_parent:new n.Uniform1f(p,t.u_scale_parent),u_fade_t:new n.Uniform1f(p,t.u_fade_t),u_opacity:new n.Uniform1f(p,t.u_opacity),u_image0:new n.Uniform1i(p,t.u_image0),u_image1:new n.Uniform1i(p,t.u_image1),u_brightness_low:new n.Uniform1f(p,t.u_brightness_low),u_brightness_high:new n.Uniform1f(p,t.u_brightness_high),u_saturation_factor:new n.Uniform1f(p,t.u_saturation_factor),u_contrast_factor:new n.Uniform1f(p,t.u_contrast_factor),u_spin_weights:new n.Uniform3f(p,t.u_spin_weights),u_perspective_transform:new n.Uniform2f(p,t.u_perspective_transform)}),symbolIcon:(p,t)=>({u_is_size_zoom_constant:new n.Uniform1i(p,t.u_is_size_zoom_constant),u_is_size_feature_constant:new n.Uniform1i(p,t.u_is_size_feature_constant),u_size_t:new n.Uniform1f(p,t.u_size_t),u_size:new n.Uniform1f(p,t.u_size),u_camera_to_center_distance:new n.Uniform1f(p,t.u_camera_to_center_distance),u_rotate_symbol:new n.Uniform1i(p,t.u_rotate_symbol),u_aspect_ratio:new n.Uniform1f(p,t.u_aspect_ratio),u_fade_change:new n.Uniform1f(p,t.u_fade_change),u_matrix:new n.UniformMatrix4f(p,t.u_matrix),u_label_plane_matrix:new n.UniformMatrix4f(p,t.u_label_plane_matrix),u_coord_matrix:new n.UniformMatrix4f(p,t.u_coord_matrix),u_is_text:new n.Uniform1i(p,t.u_is_text),u_pitch_with_map:new n.Uniform1i(p,t.u_pitch_with_map),u_texsize:new n.Uniform2f(p,t.u_texsize),u_tile_id:new n.Uniform3f(p,t.u_tile_id),u_zoom_transition:new n.Uniform1f(p,t.u_zoom_transition),u_inv_rot_matrix:new n.UniformMatrix4f(p,t.u_inv_rot_matrix),u_merc_center:new n.Uniform2f(p,t.u_merc_center),u_camera_forward:new n.Uniform3f(p,t.u_camera_forward),u_tile_matrix:new n.UniformMatrix4f(p,t.u_tile_matrix),u_up_vector:new n.Uniform3f(p,t.u_up_vector),u_ecef_origin:new n.Uniform3f(p,t.u_ecef_origin),u_texture:new n.Uniform1i(p,t.u_texture)}),symbolSDF:(p,t)=>({u_is_size_zoom_constant:new n.Uniform1i(p,t.u_is_size_zoom_constant),u_is_size_feature_constant:new n.Uniform1i(p,t.u_is_size_feature_constant),u_size_t:new n.Uniform1f(p,t.u_size_t),u_size:new n.Uniform1f(p,t.u_size),u_camera_to_center_distance:new n.Uniform1f(p,t.u_camera_to_center_distance),u_rotate_symbol:new n.Uniform1i(p,t.u_rotate_symbol),u_aspect_ratio:new n.Uniform1f(p,t.u_aspect_ratio),u_fade_change:new n.Uniform1f(p,t.u_fade_change),u_matrix:new n.UniformMatrix4f(p,t.u_matrix),u_label_plane_matrix:new n.UniformMatrix4f(p,t.u_label_plane_matrix),u_coord_matrix:new n.UniformMatrix4f(p,t.u_coord_matrix),u_is_text:new n.Uniform1i(p,t.u_is_text),u_pitch_with_map:new n.Uniform1i(p,t.u_pitch_with_map),u_texsize:new n.Uniform2f(p,t.u_texsize),u_texture:new n.Uniform1i(p,t.u_texture),u_gamma_scale:new n.Uniform1f(p,t.u_gamma_scale),u_device_pixel_ratio:new n.Uniform1f(p,t.u_device_pixel_ratio),u_tile_id:new n.Uniform3f(p,t.u_tile_id),u_zoom_transition:new n.Uniform1f(p,t.u_zoom_transition),u_inv_rot_matrix:new n.UniformMatrix4f(p,t.u_inv_rot_matrix),u_merc_center:new n.Uniform2f(p,t.u_merc_center),u_camera_forward:new n.Uniform3f(p,t.u_camera_forward),u_tile_matrix:new n.UniformMatrix4f(p,t.u_tile_matrix),u_up_vector:new n.Uniform3f(p,t.u_up_vector),u_ecef_origin:new n.Uniform3f(p,t.u_ecef_origin),u_is_halo:new n.Uniform1i(p,t.u_is_halo)}),symbolTextAndIcon:(p,t)=>({u_is_size_zoom_constant:new n.Uniform1i(p,t.u_is_size_zoom_constant),u_is_size_feature_constant:new n.Uniform1i(p,t.u_is_size_feature_constant),u_size_t:new n.Uniform1f(p,t.u_size_t),u_size:new n.Uniform1f(p,t.u_size),u_camera_to_center_distance:new n.Uniform1f(p,t.u_camera_to_center_distance),u_rotate_symbol:new n.Uniform1i(p,t.u_rotate_symbol),u_aspect_ratio:new n.Uniform1f(p,t.u_aspect_ratio),u_fade_change:new n.Uniform1f(p,t.u_fade_change),u_matrix:new n.UniformMatrix4f(p,t.u_matrix),u_label_plane_matrix:new n.UniformMatrix4f(p,t.u_label_plane_matrix),u_coord_matrix:new n.UniformMatrix4f(p,t.u_coord_matrix),u_is_text:new n.Uniform1i(p,t.u_is_text),u_pitch_with_map:new n.Uniform1i(p,t.u_pitch_with_map),u_texsize:new n.Uniform2f(p,t.u_texsize),u_texsize_icon:new n.Uniform2f(p,t.u_texsize_icon),u_texture:new n.Uniform1i(p,t.u_texture),u_texture_icon:new n.Uniform1i(p,t.u_texture_icon),u_gamma_scale:new n.Uniform1f(p,t.u_gamma_scale),u_device_pixel_ratio:new n.Uniform1f(p,t.u_device_pixel_ratio),u_is_halo:new n.Uniform1i(p,t.u_is_halo)}),background:(p,t)=>({u_matrix:new n.UniformMatrix4f(p,t.u_matrix),u_opacity:new n.Uniform1f(p,t.u_opacity),u_color:new n.UniformColor(p,t.u_color)}),backgroundPattern:(p,t)=>({u_matrix:new n.UniformMatrix4f(p,t.u_matrix),u_opacity:new n.Uniform1f(p,t.u_opacity),u_image:new n.Uniform1i(p,t.u_image),u_pattern_tl_a:new n.Uniform2f(p,t.u_pattern_tl_a),u_pattern_br_a:new n.Uniform2f(p,t.u_pattern_br_a),u_pattern_tl_b:new n.Uniform2f(p,t.u_pattern_tl_b),u_pattern_br_b:new n.Uniform2f(p,t.u_pattern_br_b),u_texsize:new n.Uniform2f(p,t.u_texsize),u_mix:new n.Uniform1f(p,t.u_mix),u_pattern_size_a:new n.Uniform2f(p,t.u_pattern_size_a),u_pattern_size_b:new n.Uniform2f(p,t.u_pattern_size_b),u_scale_a:new n.Uniform1f(p,t.u_scale_a),u_scale_b:new n.Uniform1f(p,t.u_scale_b),u_pixel_coord_upper:new n.Uniform2f(p,t.u_pixel_coord_upper),u_pixel_coord_lower:new n.Uniform2f(p,t.u_pixel_coord_lower),u_tile_units_to_pixels:new n.Uniform1f(p,t.u_tile_units_to_pixels)}),terrainRaster:cl,terrainDepth:cl,skybox:(p,t)=>({u_matrix:new n.UniformMatrix4f(p,t.u_matrix),u_sun_direction:new n.Uniform3f(p,t.u_sun_direction),u_cubemap:new n.Uniform1i(p,t.u_cubemap),u_opacity:new n.Uniform1f(p,t.u_opacity),u_temporal_offset:new n.Uniform1f(p,t.u_temporal_offset)}),skyboxGradient:(p,t)=>({u_matrix:new n.UniformMatrix4f(p,t.u_matrix),u_color_ramp:new n.Uniform1i(p,t.u_color_ramp),u_center_direction:new n.Uniform3f(p,t.u_center_direction),u_radius:new n.Uniform1f(p,t.u_radius),u_opacity:new n.Uniform1f(p,t.u_opacity),u_temporal_offset:new n.Uniform1f(p,t.u_temporal_offset)}),skyboxCapture:(p,t)=>({u_matrix_3f:new n.UniformMatrix3f(p,t.u_matrix_3f),u_sun_direction:new n.Uniform3f(p,t.u_sun_direction),u_sun_intensity:new n.Uniform1f(p,t.u_sun_intensity),u_color_tint_r:new n.Uniform4f(p,t.u_color_tint_r),u_color_tint_m:new n.Uniform4f(p,t.u_color_tint_m),u_luminance:new n.Uniform1f(p,t.u_luminance)}),globeRaster:(p,t)=>({u_proj_matrix:new n.UniformMatrix4f(p,t.u_proj_matrix),u_globe_matrix:new n.UniformMatrix4f(p,t.u_globe_matrix),u_normalize_matrix:new n.UniformMatrix4f(p,t.u_normalize_matrix),u_merc_matrix:new n.UniformMatrix4f(p,t.u_merc_matrix),u_zoom_transition:new n.Uniform1f(p,t.u_zoom_transition),u_merc_center:new n.Uniform2f(p,t.u_merc_center),u_image0:new n.Uniform1i(p,t.u_image0),u_grid_matrix:new n.UniformMatrix3f(p,t.u_grid_matrix),u_frustum_tl:new n.Uniform3f(p,t.u_frustum_tl),u_frustum_tr:new n.Uniform3f(p,t.u_frustum_tr),u_frustum_br:new n.Uniform3f(p,t.u_frustum_br),u_frustum_bl:new n.Uniform3f(p,t.u_frustum_bl),u_globe_pos:new n.Uniform3f(p,t.u_globe_pos),u_globe_radius:new n.Uniform1f(p,t.u_globe_radius),u_viewport:new n.Uniform2f(p,t.u_viewport)}),globeAtmosphere:(p,t)=>({u_frustum_tl:new n.Uniform3f(p,t.u_frustum_tl),u_frustum_tr:new n.Uniform3f(p,t.u_frustum_tr),u_frustum_br:new n.Uniform3f(p,t.u_frustum_br),u_frustum_bl:new n.Uniform3f(p,t.u_frustum_bl),u_horizon:new n.Uniform1f(p,t.u_horizon),u_transition:new n.Uniform1f(p,t.u_transition),u_fadeout_range:new n.Uniform1f(p,t.u_fadeout_range),u_color:new n.Uniform4f(p,t.u_color),u_high_color:new n.Uniform4f(p,t.u_high_color),u_space_color:new n.Uniform4f(p,t.u_space_color),u_star_intensity:new n.Uniform1f(p,t.u_star_intensity),u_star_density:new n.Uniform1f(p,t.u_star_density),u_star_size:new n.Uniform1f(p,t.u_star_size),u_temporal_offset:new n.Uniform1f(p,t.u_temporal_offset),u_horizon_angle:new n.Uniform1f(p,t.u_horizon_angle),u_rotation_matrix:new n.UniformMatrix4f(p,t.u_rotation_matrix)})};let _l;function sh(p,t,a,m,v,b,S){const k=p.context,D=k.gl,O=p.transform,V=p.useProgram("collisionBox"),G=[];let X=0,J=0;for(let ge=0;ge<m.length;ge++){const he=m[ge],fe=t.getTile(he),be=fe.getBucket(a);if(!be)continue;const Ve=ln(he,be,O);let Ze=Ve;v[0]===0&&v[1]===0||(Ze=p.translatePosMatrix(Ve,fe,v,b));const je=S?be.textCollisionBox:be.iconCollisionBox,Ue=be.collisionCircleArray;if(Ue.length>0){const _e=n.create(),rt=Ze;n.mul(_e,be.placementInvProjMatrix,O.glCoordMatrix),n.mul(_e,_e,be.placementViewportMatrix),G.push({circleArray:Ue,circleOffset:J,transform:rt,invTransform:_e,projection:be.getProjection()}),X+=Ue.length/4,J=X}je&&(p.terrain&&p.terrain.setupElevationDraw(fe,V),V.draw(k,D.LINES,n.DepthMode.disabled,n.StencilMode.disabled,p.colorModeForRenderPass(),n.CullFaceMode.disabled,Ac(Ze,O,fe,be.getProjection()),a.id,je.layoutVertexBuffer,je.indexBuffer,je.segments,null,O.zoom,null,je.collisionVertexBuffer,je.collisionVertexBufferExt))}if(!S||!G.length)return;const ee=p.useProgram("collisionCircle"),Y=new n.StructArrayLayout2f1f2i16;Y.resize(4*X),Y._trim();let pe=0;for(const ge of G)for(let he=0;he<ge.circleArray.length/4;he++){const fe=4*he,be=ge.circleArray[fe+0],Ve=ge.circleArray[fe+1],Ze=ge.circleArray[fe+2],je=ge.circleArray[fe+3];Y.emplace(pe++,be,Ve,Ze,je,0),Y.emplace(pe++,be,Ve,Ze,je,1),Y.emplace(pe++,be,Ve,Ze,je,2),Y.emplace(pe++,be,Ve,Ze,je,3)}(!_l||_l.length<2*X)&&(_l=function(ge){const he=2*ge,fe=new n.StructArrayLayout3ui6;fe.resize(he),fe._trim();for(let be=0;be<he;be++){const Ve=6*be;fe.uint16[Ve+0]=4*be+0,fe.uint16[Ve+1]=4*be+1,fe.uint16[Ve+2]=4*be+2,fe.uint16[Ve+3]=4*be+2,fe.uint16[Ve+4]=4*be+3,fe.uint16[Ve+5]=4*be+0}return fe}(X));const K=k.createIndexBuffer(_l,!0),ne=k.createVertexBuffer(Y,n.collisionCircleLayout.members,!0);for(const ge of G){const he={u_matrix:ge.transform,u_inv_matrix:ge.invTransform,u_camera_to_center_distance:(oe=O).getCameraToCenterDistance(ge.projection),u_viewport_size:[oe.width,oe.height]};ee.draw(k,D.TRIANGLES,n.DepthMode.disabled,n.StencilMode.disabled,p.colorModeForRenderPass(),n.CullFaceMode.disabled,he,a.id,ne,K,n.SegmentVector.simpleSegment(0,2*ge.circleOffset,ge.circleArray.length,ge.circleArray.length/2),null,O.zoom)}var oe;ne.destroy(),K.destroy()}const ah=n.create();function hf(p,t,a,m,v,b){const{horizontalAlign:S,verticalAlign:k}=n.getAnchorAlignment(p),D=-(S-.5)*t,O=-(k-.5)*a,V=n.evaluateVariableOffset(p,m);return new n.pointGeometry((D/v+V[0])*b,(O/v+V[1])*b)}function pf(p,t,a,m,v,b,S,k,D,O,V){const G=p.text.placedSymbolArray,X=p.text.dynamicLayoutVertexArray,J=p.icon.dynamicLayoutVertexArray,ee={},Y=tl(k,p.getProjection(),b),pe=b.elevation,K=p.getProjection().upVectorScale(k.canonical,b.center.lat,b.worldSize);X.clear();for(let ne=0;ne<G.length;ne++){const oe=G.get(ne),ge=p.allowVerticalPlacement&&!oe.placedOrientation,he=oe.hidden||!oe.crossTileID||ge?null:m[oe.crossTileID];if(he){const fe=new n.pointGeometry(oe.tileAnchorX,oe.tileAnchorY),be=p.getProjection().upVector(k.canonical,fe.x,fe.y),Ve=pe?pe.getAtTileOffset(k,fe.x,fe.y):0,Ze=Kn([oe.projectedAnchorX+Ve*be[0]*K.metersToTile,oe.projectedAnchorY+Ve*be[1]*K.metersToTile,oe.projectedAnchorZ+Ve*be[2]*K.metersToTile],a?Y:S),je=cs(b.getCameraToCenterDistance(p.getProjection()),Ze.signedDistanceFromCamera);let Ue=v.evaluateSizeForFeature(p.textSizeData,O,oe)*je/n.ONE_EM;a&&(Ue*=p.tilePixelRatio/D);const{width:_e,height:rt,anchor:it,textOffset:Et,textScale:Ke}=he,Ft=hf(it,_e,rt,Et,Ke,Ue);let vt;if(a){const ut=fe.add(Ft),{x:gt,y:Xt,z:Vt}=p.getProjection().projectTilePoint(ut.x,ut.y,k.canonical);vt=Kn([gt+Ve*be[0]*K.metersToTile,Xt+Ve*be[1]*K.metersToTile,Vt+Ve*be[2]*K.metersToTile],S).point}else{const ut=t?Ft.rotate(-b.angle):Ft;vt=[Ze.point[0]+ut.x,Ze.point[1]+ut.y,0]}const yt=p.allowVerticalPlacement&&oe.placedOrientation===n.WritingMode.vertical?Math.PI/2:0;for(let ut=0;ut<oe.numGlyphs;ut++)n.addDynamicAttributes(X,vt[0],vt[1],vt[2],yt);V&&oe.associatedIconIndex>=0&&(ee[oe.associatedIconIndex]={shiftedAnchor:vt,angle:yt})}else _r(oe.numGlyphs,X)}if(V){J.clear();const ne=p.icon.placedSymbolArray;for(let oe=0;oe<ne.length;oe++){const ge=ne.get(oe);if(ge.hidden)_r(ge.numGlyphs,J);else{const he=ee[oe];if(he)for(let fe=0;fe<ge.numGlyphs;fe++)n.addDynamicAttributes(J,he.shiftedAnchor[0],he.shiftedAnchor[1],he.shiftedAnchor[2],he.angle);else _r(ge.numGlyphs,J)}}p.icon.dynamicLayoutVertexBuffer.updateData(J)}p.text.dynamicLayoutVertexBuffer.updateData(X)}function Cc(p,t,a){return a.iconsInText&&t?"symbolTextAndIcon":p?"symbolSDF":"symbolIcon"}function gl(p,t,a,m,v,b,S,k,D,O,V,G){const X=p.context,J=X.gl,ee=p.transform,Y=k==="map",pe=D==="map",K=Y&&a.layout.get("symbol-placement")!=="point",ne=Y&&!pe&&!K,oe=a.layout.get("symbol-sort-key").constantOr(1)!==void 0;let ge=!1;const he=p.depthModeForSublayer(0,n.DepthMode.ReadOnly),fe=[n.mercatorXfromLng(ee.center.lng),n.mercatorYfromLat(ee.center.lat)],be=a.layout.get("text-variable-anchor"),Ve=ee.projection.name==="globe",Ze=[],je=[0,-1,0];let Ue=je;!Ve&&!ee.mercatorFromTransition||Y||(Ue=function(_e){const rt=_e._camera.getWorldToCamera(_e.worldSize,1),it=n.multiply([],rt,_e.globeMatrix);n.invert(it,it);const Et=[0,0,0],Ke=[0,1,0,0];return n.transformMat4$1(Ke,Ke,it),Et[0]=Ke[0],Et[1]=Ke[1],Et[2]=Ke[2],n.normalize(Et,Et),Et}(ee));for(const _e of m){const rt=t.getTile(_e),it=rt.getBucket(a);if(!it||it.projection.name==="mercator"&&Ve)continue;const Et=v?it.text:it.icon;if(!Et||it.fullyClipped||!Et.segments.get().length)continue;const Ke=Et.programConfigurations.get(a.id),Ft=v||it.sdfIcons,vt=v?it.textSizeData:it.iconSizeData,yt=pe||ee.pitch!==0,ut=n.evaluateSizeForZoom(vt,ee.zoom);let gt,Xt,Vt,oi,Ot=[0,0],ii=null;if(v){if(Xt=rt.glyphAtlasTexture,Vt=J.LINEAR,gt=rt.glyphAtlasTexture.size,it.iconsInText){Ot=rt.imageAtlasTexture.size,ii=rt.imageAtlasTexture;const hr=vt.kind==="composite"||vt.kind==="camera";oi=yt||p.options.rotating||p.options.zooming||hr?J.LINEAR:J.NEAREST}}else{const hr=a.layout.get("icon-size").constantOr(0)!==1||it.iconsNeedLinear;Xt=rt.imageAtlasTexture,Vt=Ft||p.options.rotating||p.options.zooming||hr||yt?J.LINEAR:J.NEAREST,gt=rt.imageAtlasTexture.size}const Si=it.projection.name==="globe",zi=Si?Ue:je,nr=Si?n.globeToMercatorTransition(ee.zoom):0,Ri=tl(_e,it.getProjection(),ee),en=ee.calculatePixelsToTileUnitsMatrix(rt),Bn=li(Ri,rt.tileID.canonical,pe,Y,ee,it.getProjection(),en),to=p.terrain&&pe&&K?n.invert(n.create(),Bn):ah,qi=Uo(Ri,rt.tileID.canonical,pe,Y,ee,it.getProjection(),en),$i=be&&it.hasTextData(),Mi=a.layout.get("icon-text-fit")!=="none"&&$i&&it.hasIconData();if(K){const hr=ee.elevation,On=hr?hr.getAtTileOffsetFunc(_e,ee.center.lat,ee.worldSize,it.getProjection()):Sa=>[0,0,0],io=bn(Ri,rt.tileID.canonical,pe,Y,ee,it.getProjection(),en);sn(it,Ri,p,v,io,qi,pe,O,On,_e)}const ur=K||v&&be||Mi,Ar=p.translatePosMatrix(Ri,rt,b,S),yi=ur?ah:Bn,jr=p.translatePosMatrix(qi,rt,b,S,!0),Ho=it.getProjection().createInversionMatrix(ee,_e.canonical),Tn=[];p.terrain&&pe&&Tn.push("PITCH_WITH_MAP_TERRAIN"),Si&&Tn.push("PROJECTION_GLOBE_VIEW"),ur&&Tn.push("PROJECTED_POS_ON_VIEWPORT");const Ss=Ft&&a.paint.get(v?"text-halo-width":"icon-halo-width").constantOr(1)!==0;let Ms;Ms=Ft?it.iconsInText?nh(vt.kind,ut,ne,pe,p,Ar,yi,jr,gt,Ot,_e,nr,fe,Ho,zi,it.getProjection()):rh(vt.kind,ut,ne,pe,p,Ar,yi,jr,v,gt,!0,_e,nr,fe,Ho,zi,it.getProjection()):da(vt.kind,ut,ne,pe,p,Ar,yi,jr,v,gt,_e,nr,fe,Ho,zi,it.getProjection());const vo={program:p.useProgram(Cc(Ft,v,it),Ke,Tn),buffers:Et,uniformValues:Ms,atlasTexture:Xt,atlasTextureIcon:ii,atlasInterpolation:Vt,atlasInterpolationIcon:oi,isSDF:Ft,hasHalo:Ss,tile:rt,labelPlaneMatrixInv:to};if(oe&&it.canOverlap){ge=!0;const hr=Et.segments.get();for(const On of hr)Ze.push({segments:new n.SegmentVector([On]),sortKey:On.sortKey,state:vo})}else Ze.push({segments:Et.segments,sortKey:0,state:vo})}ge&&Ze.sort((_e,rt)=>_e.sortKey-rt.sortKey);for(const _e of Ze){const rt=_e.state;if(p.terrain&&p.terrain.setupElevationDraw(rt.tile,rt.program,{useDepthForOcclusion:!Ve,labelPlaneMatrixInv:rt.labelPlaneMatrixInv}),X.activeTexture.set(J.TEXTURE0),rt.atlasTexture.bind(rt.atlasInterpolation,J.CLAMP_TO_EDGE),rt.atlasTextureIcon&&(X.activeTexture.set(J.TEXTURE1),rt.atlasTextureIcon&&rt.atlasTextureIcon.bind(rt.atlasInterpolationIcon,J.CLAMP_TO_EDGE)),rt.isSDF){const it=rt.uniformValues;rt.hasHalo&&(it.u_is_halo=1,zc(rt.buffers,_e.segments,a,p,rt.program,he,V,G,it)),it.u_is_halo=0}zc(rt.buffers,_e.segments,a,p,rt.program,he,V,G,rt.uniformValues)}}function zc(p,t,a,m,v,b,S,k,D){const O=m.context;v.draw(O,O.gl.TRIANGLES,b,S,k,n.CullFaceMode.disabled,D,a.id,p.layoutVertexBuffer,p.indexBuffer,t,a.paint,m.transform.zoom,p.programConfigurations.get(a.id),p.dynamicLayoutVertexBuffer,p.opacityVertexBuffer,p.globeExtVertexBuffer)}function Pc(p,t,a,m,v,b,S){const k=p.context.gl,D=a.paint.get("fill-pattern"),O=D&&D.constantOr(1),V=a.getCrossfadeParameters();let G,X,J,ee,Y;S?(X=O&&!a.getPaintProperty("fill-outline-color")?"fillOutlinePattern":"fillOutline",G=k.LINES):(X=O?"fillPattern":"fill",G=k.TRIANGLES);for(const pe of m){const K=t.getTile(pe);if(O&&!K.patternsLoaded())continue;const ne=K.getBucket(a);if(!ne)continue;p.prepareDrawTile();const oe=ne.programConfigurations.get(a.id),ge=p.useProgram(X,oe);O&&(p.context.activeTexture.set(k.TEXTURE0),K.imageAtlasTexture.bind(k.LINEAR,k.CLAMP_TO_EDGE),oe.updatePaintBuffers(V));const he=D.constantOr(null);if(he&&K.imageAtlas){const be=K.imageAtlas,Ve=be.patternPositions[he.to.toString()],Ze=be.patternPositions[he.from.toString()];Ve&&Ze&&oe.setConstantPatternPositions(Ve,Ze)}const fe=p.translatePosMatrix(pe.projMatrix,K,a.paint.get("fill-translate"),a.paint.get("fill-translate-anchor"));if(S){ee=ne.indexBuffer2,Y=ne.segments2;const be=p.terrain&&p.terrain.renderingToTexture?p.terrain.drapeBufferSize:[k.drawingBufferWidth,k.drawingBufferHeight];J=X==="fillOutlinePattern"&&O?Ec(fe,p,V,K,be):dl(fe,be)}else ee=ne.indexBuffer,Y=ne.segments,J=O?wc(fe,p,V,K):gs(fe);p.prepareDrawProgram(p.context,ge,pe.toUnwrapped()),ge.draw(p.context,G,v,p.stencilModeForClipping(pe),b,n.CullFaceMode.disabled,J,a.id,ne.layoutVertexBuffer,ee,Y,a.paint,p.transform.zoom,oe)}}function yl(p,t,a,m,v,b,S){const k=p.context,D=k.gl,O=p.transform,V=a.paint.get("fill-extrusion-pattern"),G=V.constantOr(1),X=a.getCrossfadeParameters(),J=a.paint.get("fill-extrusion-opacity"),ee=O.projection.name==="globe"?n.fillExtrusionHeightLift():0,Y=O.projection.name==="globe",pe=Y?n.globeToMercatorTransition(O.zoom):0,K=[n.mercatorXfromLng(O.center.lng),n.mercatorYfromLat(O.center.lat)],ne=[];Y&&ne.push("PROJECTION_GLOBE_VIEW");for(const oe of m){const ge=t.getTile(oe),he=ge.getBucket(a);if(!he||he.projection.name!==O.projection.name)continue;const fe=he.programConfigurations.get(a.id),be=p.useProgram(G?"fillExtrusionPattern":"fillExtrusion",fe,ne);if(p.terrain){const rt=p.terrain;if(p.style.terrainSetForDrapingOnly())rt.setupElevationDraw(ge,be,{useMeterToDem:!0});else{if(!he.enableTerrain)continue;if(rt.setupElevationDraw(ge,be,{useMeterToDem:!0}),Dc(k,t,oe,he,a,rt),!he.centroidVertexBuffer){const it=be.attributes.a_centroid_pos;it!==void 0&&D.vertexAttrib2f(it,0,0)}}}G&&(p.context.activeTexture.set(D.TEXTURE0),ge.imageAtlasTexture.bind(D.LINEAR,D.CLAMP_TO_EDGE),fe.updatePaintBuffers(X));const Ve=V.constantOr(null);if(Ve&&ge.imageAtlas){const rt=ge.imageAtlas,it=rt.patternPositions[Ve.to.toString()],Et=rt.patternPositions[Ve.from.toString()];it&&Et&&fe.setConstantPatternPositions(it,Et)}const Ze=p.translatePosMatrix(oe.projMatrix,ge,a.paint.get("fill-extrusion-translate"),a.paint.get("fill-extrusion-translate-anchor")),je=O.projection.createInversionMatrix(O,oe.canonical),Ue=a.paint.get("fill-extrusion-vertical-gradient"),_e=G?pa(Ze,p,Ue,J,oe,X,ge,ee,pe,K,je):Qu(Ze,p,Ue,J,oe,ee,pe,K,je);p.prepareDrawProgram(k,be,oe.toUnwrapped()),be.draw(k,k.gl.TRIANGLES,v,b,S,n.CullFaceMode.backCCW,_e,a.id,he.layoutVertexBuffer,he.indexBuffer,he.segments,a.paint,p.transform.zoom,fe,p.terrain?he.centroidVertexBuffer:null,Y?he.layoutVertexExtBuffer:null)}}function Dc(p,t,a,m,v,b){const S=[K=>{let ne=K.canonical.x-1,oe=K.wrap;return ne<0&&(ne=(1<<K.canonical.z)-1,oe--),new n.OverscaledTileID(K.overscaledZ,oe,K.canonical.z,ne,K.canonical.y)},K=>{let ne=K.canonical.x+1,oe=K.wrap;return ne===1<<K.canonical.z&&(ne=0,oe++),new n.OverscaledTileID(K.overscaledZ,oe,K.canonical.z,ne,K.canonical.y)},K=>new n.OverscaledTileID(K.overscaledZ,K.wrap,K.canonical.z,K.canonical.x,(K.canonical.y===0?1<<K.canonical.z:K.canonical.y)-1),K=>new n.OverscaledTileID(K.overscaledZ,K.wrap,K.canonical.z,K.canonical.x,K.canonical.y===(1<<K.canonical.z)-1?0:K.canonical.y+1)],k=K=>{const ne=t.getSource().minzoom,oe=he=>{const fe=t.getTileByID(he);if(fe&&fe.hasData())return fe.getBucket(v)},ge=[0,-1,1];for(const he of ge){if(K.overscaledZ+he<ne)continue;const fe=oe(K.calculateScaledKey(K.overscaledZ+he));if(fe)return fe}},D=[0,0,0],O=(K,ne)=>(D[0]=Math.min(K.min.y,ne.min.y),D[1]=Math.max(K.max.y,ne.max.y),D[2]=n.EXTENT-ne.min.x>K.max.x?ne.min.x-n.EXTENT:K.max.x,D),V=(K,ne)=>(D[0]=Math.min(K.min.x,ne.min.x),D[1]=Math.max(K.max.x,ne.max.x),D[2]=n.EXTENT-ne.min.y>K.max.y?ne.min.y-n.EXTENT:K.max.y,D),G=[(K,ne)=>O(K,ne),(K,ne)=>O(ne,K),(K,ne)=>V(K,ne),(K,ne)=>V(ne,K)],X=new n.pointGeometry(0,0);let J,ee,Y;const pe=(K,ne,oe,ge,he)=>{const fe=[[ge?oe:K,ge?K:oe,0],[ge?oe:ne,ge?ne:oe,0]],be=he<0?n.EXTENT+he:he,Ve=[ge?be:(K+ne)/2,ge?(K+ne)/2:be,0];return oe===0&&he<0||oe!==0&&he>0?b.getForTilePoints(Y,[Ve],!0,ee):fe.push(Ve),b.getForTilePoints(a,fe,!0,J),Math.max(fe[0][2],fe[1][2],Ve[2])/b.exaggeration()};for(let K=0;K<4;K++){const ne=(K<2?1:5)-K,oe=m.borders[K];if(oe.length===0)continue;const ge=Y=S[K](a),he=k(ge);if(!(he&&he instanceof n.FillExtrusionBucket&&he.enableTerrain)||m.borderDoneWithNeighborZ[K]===he.canonical.z&&he.borderDoneWithNeighborZ[ne]===m.canonical.z||(ee=b.findDEMTileFor(ge),!ee||!ee.dem))continue;if(!J){const Ze=b.findDEMTileFor(a);if(!Ze||!Ze.dem)return;J=Ze}const fe=he.borders[ne];let be=0;const Ve=he.borderDoneWithNeighborZ[ne]!==m.canonical.z;if(m.canonical.z===he.canonical.z){for(let Ze=0;Ze<oe.length;Ze++){const je=m.featuresOnBorder[oe[Ze]],Ue=je.borders[K];let _e;for(;be<fe.length&&(_e=he.featuresOnBorder[fe[be]],!(_e.borders[ne][1]>Ue[0]+3));)Ve&&he.encodeCentroid(void 0,_e,!1),be++;if(_e&&be<fe.length){const rt=be;let it=0;for(;!(_e.borders[ne][0]>Ue[1]-3)&&(it++,++be!==fe.length);)_e=he.featuresOnBorder[fe[be]];if(_e=he.featuresOnBorder[fe[rt]],je.intersectsCount()>1||_e.intersectsCount()>1||it!==1){it!==1&&(be=rt),m.encodeCentroid(void 0,je,!1),Ve&&he.encodeCentroid(void 0,_e,!1);continue}const Et=G[K](je,_e),Ke=K%2?n.EXTENT-1:0;X.x=pe(Et[0],Math.min(n.EXTENT-1,Et[1]),Ke,K<2,Et[2]),X.y=0,m.encodeCentroid(X,je,!1),Ve&&he.encodeCentroid(X,_e,!1)}else m.encodeCentroid(void 0,je,!1)}m.borderDoneWithNeighborZ[K]=he.canonical.z,m.needsCentroidUpdate=!0,Ve&&(he.borderDoneWithNeighborZ[ne]=m.canonical.z,he.needsCentroidUpdate=!0)}else{for(const Ze of oe)m.encodeCentroid(void 0,m.featuresOnBorder[Ze],!1);if(Ve){for(const Ze of fe)he.encodeCentroid(void 0,he.featuresOnBorder[Ze],!1);he.borderDoneWithNeighborZ[ne]=m.canonical.z,he.needsCentroidUpdate=!0}m.borderDoneWithNeighborZ[K]=he.canonical.z,m.needsCentroidUpdate=!0}}(m.needsCentroidUpdate||!m.centroidVertexBuffer&&m.centroidVertexArray.length!==0)&&m.uploadCentroid(p)}const Go=new n.Color(1,0,0,1),ma=new n.Color(0,1,0,1),lh=new n.Color(0,0,1,1),vs=new n.Color(1,0,1,1),xs=new n.Color(0,1,1,1);function Lc(p,t,a,m){wi(p,0,t+a/2,p.transform.width,a,m)}function vl(p,t,a,m){wi(p,t-a/2,0,a,p.transform.height,m)}function wi(p,t,a,m,v,b){const S=p.context,k=S.gl;k.enable(k.SCISSOR_TEST),k.scissor(t*n.exported.devicePixelRatio,a*n.exported.devicePixelRatio,m*n.exported.devicePixelRatio,v*n.exported.devicePixelRatio),S.clear({color:b}),k.disable(k.SCISSOR_TEST)}function xl(p,t,a){const m=p.context,v=m.gl,b=p.transform.projection.name==="globe",S=a.projMatrix,k=p.useProgram("debug",null,b?["PROJECTION_GLOBE_VIEW"]:null),D=t.getTileByID(a.key);p.terrain&&p.terrain.setupElevationDraw(D,k);const O=n.DepthMode.disabled,V=n.StencilMode.disabled,G=p.colorModeForRenderPass(),X="$debug";m.activeTexture.set(v.TEXTURE0),p.emptyTexture.bind(v.LINEAR,v.CLAMP_TO_EDGE),b?D._makeGlobeTileDebugBuffers(p.context,p.transform.projection):D._makeDebugTileBoundsBuffers(p.context,p.transform.projection);const J=D._tileDebugBuffer||p.debugBuffer,ee=D._tileDebugIndexBuffer||p.debugIndexBuffer,Y=D._tileDebugSegments||p.debugSegments;k.draw(m,v.LINE_STRIP,O,V,G,n.CullFaceMode.disabled,Sc(S,n.Color.red),X,J,ee,Y,null,null,null,D._globeTileDebugBorderBuffer);const pe=D.latestRawTileData,K=Math.floor((pe&&pe.byteLength||0)/1024),ne=t.getTile(a).tileSize,oe=512/Math.min(ne,512)*(a.overscaledZ/p.transform.zoom)*.5;let ge=a.canonical.toString();a.overscaledZ!==a.canonical.z&&(ge+=` => ${a.overscaledZ}`),function(Ve,Ze){Ve.initDebugOverlayCanvas();const je=Ve.debugOverlayCanvas,Ue=Ve.context.gl,_e=Ve.debugOverlayCanvas.getContext("2d");_e.clearRect(0,0,je.width,je.height),_e.shadowColor="white",_e.shadowBlur=2,_e.lineWidth=1.5,_e.strokeStyle="white",_e.textBaseline="top",_e.font="bold 36px Open Sans, sans-serif",_e.fillText(Ze,5,5),_e.strokeText(Ze,5,5),Ve.debugOverlayTexture.update(je),Ve.debugOverlayTexture.bind(Ue.LINEAR,Ue.CLAMP_TO_EDGE)}(p,`${ge} ${K}kb`);const he=D._tileDebugTextBuffer||p.debugBuffer,fe=D._tileDebugTextIndexBuffer||p.quadTriangleIndexBuffer,be=D._tileDebugTextSegments||p.debugSegments;k.draw(m,v.TRIANGLES,O,V,n.ColorMode.alphaBlended,n.CullFaceMode.disabled,Sc(S,n.Color.transparent,oe),X,he,fe,be,null,null,null,D._globeTileDebugTextBuffer)}const ff=n.createLayout([{name:"a_pos_3f",components:3,type:"Float32"}]),{members:ch}=ff;function cn(p,t,a,m){p.emplaceBack(t,a,m)}class uh{constructor(t){this.vertexArray=new n.StructArrayLayout3f12,this.indices=new n.StructArrayLayout3ui6,cn(this.vertexArray,-1,-1,1),cn(this.vertexArray,1,-1,1),cn(this.vertexArray,-1,1,1),cn(this.vertexArray,1,1,1),cn(this.vertexArray,-1,-1,-1),cn(this.vertexArray,1,-1,-1),cn(this.vertexArray,-1,1,-1),cn(this.vertexArray,1,1,-1),this.indices.emplaceBack(5,1,3),this.indices.emplaceBack(3,7,5),this.indices.emplaceBack(6,2,0),this.indices.emplaceBack(0,4,6),this.indices.emplaceBack(2,6,7),this.indices.emplaceBack(7,3,2),this.indices.emplaceBack(5,4,0),this.indices.emplaceBack(0,1,5),this.indices.emplaceBack(0,2,3),this.indices.emplaceBack(3,1,0),this.indices.emplaceBack(7,6,4),this.indices.emplaceBack(4,5,7),this.vertexBuffer=t.createVertexBuffer(this.vertexArray,ch),this.indexBuffer=t.createIndexBuffer(this.indices),this.segment=n.SegmentVector.simpleSegment(0,0,36,12)}}function bs(p,t,a,m,v,b){const S=p.gl,k=t.paint.get("sky-atmosphere-color"),D=t.paint.get("sky-atmosphere-halo-color"),O=t.paint.get("sky-atmosphere-sun-intensity"),V=((G,X,J,ee,Y)=>({u_matrix_3f:G,u_sun_direction:X,u_sun_intensity:J,u_color_tint_r:[ee.r,ee.g,ee.b,ee.a],u_color_tint_m:[Y.r,Y.g,Y.b,Y.a],u_luminance:5e-5}))(n.fromMat4(n.create$1(),m),v,O,k,D);S.framebufferTexture2D(S.FRAMEBUFFER,S.COLOR_ATTACHMENT0,S.TEXTURE_CUBE_MAP_POSITIVE_X+b,t.skyboxTexture,0),a.draw(p,S.TRIANGLES,n.DepthMode.disabled,n.StencilMode.disabled,n.ColorMode.unblended,n.CullFaceMode.frontCW,V,"skyboxCapture",t.skyboxGeometry.vertexBuffer,t.skyboxGeometry.indexBuffer,t.skyboxGeometry.segment)}const hh=n.createLayout([{type:"Float32",name:"a_pos",components:3},{type:"Float32",name:"a_uv",components:2}]);class df{constructor(t){const a=new n.StructArrayLayout5f20;a.emplaceBack(-1,1,1,0,0),a.emplaceBack(1,1,1,1,0),a.emplaceBack(1,-1,1,1,1),a.emplaceBack(-1,-1,1,0,1);const m=new n.StructArrayLayout3ui6;m.emplaceBack(0,1,2),m.emplaceBack(2,3,0),this.vertexBuffer=t.createVertexBuffer(a,hh.members),this.indexBuffer=t.createIndexBuffer(m),this.segments=n.SegmentVector.simpleSegment(0,0,4,2)}destroy(){this.vertexBuffer.destroy(),this.indexBuffer.destroy(),this.segments.destroy()}}const bl={symbol:function(p,t,a,m,v){if(p.renderPass!=="translucent")return;const b=n.StencilMode.disabled,S=p.colorModeForRenderPass();a.layout.get("text-variable-anchor")&&function(k,D,O,V,G,X,J){const ee=D.transform,Y=G==="map",pe=X==="map";for(const K of k){const ne=V.getTile(K),oe=ne.getBucket(O);if(!oe||!oe.text||!oe.text.segments.get().length)continue;const ge=n.evaluateSizeForZoom(oe.textSizeData,ee.zoom),he=tl(K,oe.getProjection(),ee),fe=ee.calculatePixelsToTileUnitsMatrix(ne),be=li(he,ne.tileID.canonical,pe,Y,ee,oe.getProjection(),fe),Ve=O.layout.get("icon-text-fit")!=="none"&&oe.hasIconData();if(ge){const Ze=Math.pow(2,ee.zoom-ne.tileID.overscaledZ);pf(oe,Y,pe,J,n.symbolSize,ee,be,K,Ze,ge,Ve)}}}(m,p,a,t,a.layout.get("text-rotation-alignment"),a.layout.get("text-pitch-alignment"),v),a.paint.get("icon-opacity").constantOr(1)!==0&&gl(p,t,a,m,!1,a.paint.get("icon-translate"),a.paint.get("icon-translate-anchor"),a.layout.get("icon-rotation-alignment"),a.layout.get("icon-pitch-alignment"),a.layout.get("icon-keep-upright"),b,S),a.paint.get("text-opacity").constantOr(1)!==0&&gl(p,t,a,m,!0,a.paint.get("text-translate"),a.paint.get("text-translate-anchor"),a.layout.get("text-rotation-alignment"),a.layout.get("text-pitch-alignment"),a.layout.get("text-keep-upright"),b,S),t.map.showCollisionBoxes&&(sh(p,t,a,m,a.paint.get("text-translate"),a.paint.get("text-translate-anchor"),!0),sh(p,t,a,m,a.paint.get("icon-translate"),a.paint.get("icon-translate-anchor"),!1))},circle:function(p,t,a,m){if(p.renderPass!=="translucent")return;const v=a.paint.get("circle-opacity"),b=a.paint.get("circle-stroke-width"),S=a.paint.get("circle-stroke-opacity"),k=a.layout.get("circle-sort-key").constantOr(1)!==void 0;if(v.constantOr(1)===0&&(b.constantOr(1)===0||S.constantOr(1)===0))return;const D=p.context,O=D.gl,V=p.transform,G=p.depthModeForSublayer(0,n.DepthMode.ReadOnly),X=n.StencilMode.disabled,J=p.colorModeForRenderPass(),ee=V.projection.name==="globe",Y=[n.mercatorXfromLng(V.center.lng),n.mercatorYfromLat(V.center.lat)],pe=[];for(let ne=0;ne<m.length;ne++){const oe=m[ne],ge=t.getTile(oe),he=ge.getBucket(a);if(!he||he.projection.name!==V.projection.name)continue;const fe=he.programConfigurations.get(a.id),be=eh(a);ee&&be.push("PROJECTION_GLOBE_VIEW");const Ve=p.useProgram("circle",fe,be),Ze=he.layoutVertexBuffer,je=he.globeExtVertexBuffer,Ue=he.indexBuffer,_e=V.projection.createInversionMatrix(V,oe.canonical),rt={programConfiguration:fe,program:Ve,layoutVertexBuffer:Ze,globeExtVertexBuffer:je,indexBuffer:Ue,uniformValues:Tc(p,oe,ge,_e,Y,a),tile:ge};if(k){const it=he.segments.get();for(const Et of it)pe.push({segments:new n.SegmentVector([Et]),sortKey:Et.sortKey,state:rt})}else pe.push({segments:he.segments,sortKey:0,state:rt})}k&&pe.sort((ne,oe)=>ne.sortKey-oe.sortKey);const K={useDepthForOcclusion:!ee};for(const ne of pe){const{programConfiguration:oe,program:ge,layoutVertexBuffer:he,globeExtVertexBuffer:fe,indexBuffer:be,uniformValues:Ve,tile:Ze}=ne.state,je=ne.segments;p.terrain&&p.terrain.setupElevationDraw(Ze,ge,K),p.prepareDrawProgram(D,ge,Ze.tileID.toUnwrapped()),ge.draw(D,O.TRIANGLES,G,X,J,n.CullFaceMode.disabled,Ve,a.id,he,be,je,a.paint,V.zoom,oe,ee?fe:null)}},heatmap:function(p,t,a,m){if(a.paint.get("heatmap-opacity")!==0)if(p.renderPass==="offscreen"){const v=p.context,b=v.gl,S=n.StencilMode.disabled,k=new n.ColorMode([b.ONE,b.ONE],n.Color.transparent,[!0,!0,!0,!0]);(function(J,ee,Y,pe){const K=J.gl,ne=ee.width*pe,oe=ee.height*pe;J.activeTexture.set(K.TEXTURE1),J.viewport.set([0,0,ne,oe]);let ge=Y.heatmapFbo;if(!ge||ge&&(ge.width!==ne||ge.height!==oe)){ge&&ge.destroy();const he=K.createTexture();K.bindTexture(K.TEXTURE_2D,he),K.texParameteri(K.TEXTURE_2D,K.TEXTURE_WRAP_S,K.CLAMP_TO_EDGE),K.texParameteri(K.TEXTURE_2D,K.TEXTURE_WRAP_T,K.CLAMP_TO_EDGE),K.texParameteri(K.TEXTURE_2D,K.TEXTURE_MIN_FILTER,K.LINEAR),K.texParameteri(K.TEXTURE_2D,K.TEXTURE_MAG_FILTER,K.LINEAR),ge=Y.heatmapFbo=J.createFramebuffer(ne,oe,!1),function(fe,be,Ve,Ze,je,Ue){const _e=fe.gl;_e.texImage2D(_e.TEXTURE_2D,0,_e.RGBA,je,Ue,0,_e.RGBA,fe.extRenderToTextureHalfFloat?fe.extTextureHalfFloat.HALF_FLOAT_OES:_e.UNSIGNED_BYTE,null),Ze.colorAttachment.set(Ve)}(J,0,he,ge,ne,oe)}else K.bindTexture(K.TEXTURE_2D,ge.colorAttachment.get()),J.bindFramebuffer.set(ge.framebuffer)})(v,p,a,p.transform.projection.name==="globe"?.5:.25),v.clear({color:n.Color.transparent});const D=p.transform,O=D.projection.name==="globe",V=O?["PROJECTION_GLOBE_VIEW"]:null,G=O?n.CullFaceMode.frontCCW:n.CullFaceMode.disabled,X=[n.mercatorXfromLng(D.center.lng),n.mercatorYfromLat(D.center.lat)];for(let J=0;J<m.length;J++){const ee=m[J];if(t.hasRenderableParent(ee))continue;const Y=t.getTile(ee),pe=Y.getBucket(a);if(!pe||pe.projection.name!==D.projection.name)continue;const K=pe.programConfigurations.get(a.id),ne=p.useProgram("heatmap",K,V),{zoom:oe}=p.transform;p.terrain&&p.terrain.setupElevationDraw(Y,ne),p.prepareDrawProgram(v,ne,ee.toUnwrapped());const ge=D.projection.createInversionMatrix(D,ee.canonical);ne.draw(v,b.TRIANGLES,n.DepthMode.disabled,S,k,G,af(p,ee,Y,ge,X,oe,a.paint.get("heatmap-intensity")),a.id,pe.layoutVertexBuffer,pe.indexBuffer,pe.segments,a.paint,p.transform.zoom,K,O?pe.globeExtVertexBuffer:null)}v.viewport.set([0,0,p.width,p.height])}else p.renderPass==="translucent"&&(p.context.setColorMode(p.colorModeForRenderPass()),function(v,b){const S=v.context,k=S.gl,D=b.heatmapFbo;if(!D)return;S.activeTexture.set(k.TEXTURE0),k.bindTexture(k.TEXTURE_2D,D.colorAttachment.get()),S.activeTexture.set(k.TEXTURE1);let O=b.colorRampTexture;O||(O=b.colorRampTexture=new n.Texture(S,b.colorRamp,k.RGBA)),O.bind(k.LINEAR,k.CLAMP_TO_EDGE),v.useProgram("heatmapTexture").draw(S,k.TRIANGLES,n.DepthMode.disabled,n.StencilMode.disabled,v.colorModeForRenderPass(),n.CullFaceMode.disabled,((V,G,X,J)=>({u_image:0,u_color_ramp:1,u_opacity:G.paint.get("heatmap-opacity")}))(0,b),b.id,v.viewportBuffer,v.quadTriangleIndexBuffer,v.viewportSegments,b.paint,v.transform.zoom)}(p,a))},line:function(p,t,a,m){if(p.renderPass!=="translucent")return;const v=a.paint.get("line-opacity"),b=a.paint.get("line-width");if(v.constantOr(1)===0||b.constantOr(1)===0)return;const S=p.depthModeForSublayer(0,n.DepthMode.ReadOnly),k=p.colorModeForRenderPass(),D=p.terrain&&p.terrain.renderingToTexture?1:n.exported.devicePixelRatio,O=a.paint.get("line-dasharray"),V=O.constantOr(1),G=a.layout.get("line-cap"),X=a.paint.get("line-pattern"),J=X.constantOr(1),ee=a.paint.get("line-gradient"),Y=a.getCrossfadeParameters(),pe=J?"linePattern":"line",K=p.context,ne=K.gl,oe=(he=>{const fe=[];ml(he)&&fe.push("RENDER_LINE_DASH"),he.paint.get("line-gradient")&&fe.push("RENDER_LINE_GRADIENT");const be=he.paint.get("line-trim-offset");be[0]===0&&be[1]===0||fe.push("RENDER_LINE_TRIM_OFFSET");const Ve=he.paint.get("line-pattern").constantOr(1),Ze=he.paint.get("line-opacity").constantOr(1)!==1;return!Ve&&Ze&&fe.push("RENDER_LINE_ALPHA_DISCARD"),fe})(a);let ge=oe.includes("RENDER_LINE_ALPHA_DISCARD");p.terrain&&p.terrain.clipOrMaskOverlapStencilType()&&(ge=!1);for(const he of m){const fe=t.getTile(he);if(J&&!fe.patternsLoaded())continue;const be=fe.getBucket(a);if(!be)continue;p.prepareDrawTile();const Ve=be.programConfigurations.get(a.id),Ze=p.useProgram(pe,Ve,oe),je=X.constantOr(null);if(je&&fe.imageAtlas){const vt=fe.imageAtlas,yt=vt.patternPositions[je.to.toString()],ut=vt.patternPositions[je.from.toString()];yt&&ut&&Ve.setConstantPatternPositions(yt,ut)}const Ue=O.constantOr(null),_e=G.constantOr(null);if(!J&&Ue&&_e&&fe.lineAtlas){const vt=fe.lineAtlas,yt=vt.getDash(Ue.to,_e),ut=vt.getDash(Ue.from,_e);yt&&ut&&Ve.setConstantPatternPositions(yt,ut)}let[rt,it]=a.paint.get("line-trim-offset");(_e==="round"||_e==="square")&&rt!==it&&(rt===0&&(rt-=1),it===1&&(it+=1));const Et=p.terrain?he.projMatrix:null,Ke=J?lf(p,fe,a,Y,Et,D):Ic(p,fe,a,Y,Et,be.lineClipsArray.length,D,[rt,it]);if(ee){const vt=be.gradients[a.id];let yt=vt.texture;if(a.gradientVersion!==vt.version){let ut=256;if(a.stepInterpolant){const gt=t.getSource().maxzoom,Xt=he.canonical.z===gt?Math.ceil(1<<p.transform.maxZoom-he.canonical.z):1;ut=n.clamp(n.nextPowerOfTwo(be.maxLineLength/n.EXTENT*1024*Xt),256,K.maxTextureSize)}vt.gradient=n.renderColorRamp({expression:a.gradientExpression(),evaluationKey:"lineProgress",resolution:ut,image:vt.gradient||void 0,clips:be.lineClipsArray}),vt.texture?vt.texture.update(vt.gradient):vt.texture=new n.Texture(K,vt.gradient,ne.RGBA),vt.version=a.gradientVersion,yt=vt.texture}K.activeTexture.set(ne.TEXTURE1),yt.bind(a.stepInterpolant?ne.NEAREST:ne.LINEAR,ne.CLAMP_TO_EDGE)}V&&(K.activeTexture.set(ne.TEXTURE0),fe.lineAtlasTexture.bind(ne.LINEAR,ne.REPEAT),Ve.updatePaintBuffers(Y)),J&&(K.activeTexture.set(ne.TEXTURE0),fe.imageAtlasTexture.bind(ne.LINEAR,ne.CLAMP_TO_EDGE),Ve.updatePaintBuffers(Y)),p.prepareDrawProgram(K,Ze,he.toUnwrapped());const Ft=vt=>{Ze.draw(K,ne.TRIANGLES,S,vt,k,n.CullFaceMode.disabled,Ke,a.id,be.layoutVertexBuffer,be.indexBuffer,be.segments,a.paint,p.transform.zoom,Ve,be.layoutVertexBuffer2)};if(ge){const vt=p.stencilModeForClipping(he).ref;vt===0&&p.terrain&&K.clear({stencil:0});const yt={func:ne.EQUAL,mask:255};Ke.u_alpha_discard_threshold=.8,Ft(new n.StencilMode(yt,vt,255,ne.KEEP,ne.KEEP,ne.INVERT)),Ke.u_alpha_discard_threshold=0,Ft(new n.StencilMode(yt,vt,255,ne.KEEP,ne.KEEP,ne.KEEP))}else Ft(p.stencilModeForClipping(he))}ge&&(p.resetStencilClippingMasks(),p.terrain&&K.clear({stencil:0}))},fill:function(p,t,a,m){const v=a.paint.get("fill-color"),b=a.paint.get("fill-opacity");if(b.constantOr(1)===0)return;const S=p.colorModeForRenderPass(),k=a.paint.get("fill-pattern"),D=p.opaquePassEnabledForLayer()&&!k.constantOr(1)&&v.constantOr(n.Color.transparent).a===1&&b.constantOr(0)===1?"opaque":"translucent";if(p.renderPass===D){const O=p.depthModeForSublayer(1,p.renderPass==="opaque"?n.DepthMode.ReadWrite:n.DepthMode.ReadOnly);Pc(p,t,a,m,O,S,!1)}if(p.renderPass==="translucent"&&a.paint.get("fill-antialias")){const O=p.depthModeForSublayer(a.getPaintProperty("fill-outline-color")?2:0,n.DepthMode.ReadOnly);Pc(p,t,a,m,O,S,!0)}},"fill-extrusion":function(p,t,a,m){const v=a.paint.get("fill-extrusion-opacity");if(v!==0&&p.renderPass==="translucent"){const b=new n.DepthMode(p.context.gl.LEQUAL,n.DepthMode.ReadWrite,p.depthRangeFor3D);if(v!==1||a.paint.get("fill-extrusion-pattern").constantOr(1))yl(p,t,a,m,b,n.StencilMode.disabled,n.ColorMode.disabled),yl(p,t,a,m,b,p.stencilModeFor3D(),p.colorModeForRenderPass()),p.resetStencilClippingMasks();else{const S=p.colorModeForRenderPass();yl(p,t,a,m,b,n.StencilMode.disabled,S)}}},hillshade:function(p,t,a,m){if(p.renderPass!=="offscreen"&&p.renderPass!=="translucent")return;const v=p.context,b=p.depthModeForSublayer(0,n.DepthMode.ReadOnly),S=p.colorModeForRenderPass(),k=p.terrain&&p.terrain.renderingToTexture,[D,O]=p.renderPass!=="translucent"||k?[{},m]:p.stencilConfigForOverlap(m);for(const V of O){const G=t.getTile(V);if(G.needsHillshadePrepare&&p.renderPass==="offscreen")ll(p,G,a,b,n.StencilMode.disabled,S);else if(p.renderPass==="translucent"){const X=k&&p.terrain?p.terrain.stencilModeForRTTOverlap(V):D[V.overscaledZ];Yu(p,V,G,a,b,X,S)}}v.viewport.set([0,0,p.width,p.height]),p.resetStencilClippingMasks()},raster:function(p,t,a,m,v,b){if(p.renderPass!=="translucent"||a.paint.get("raster-opacity")===0||!m.length)return;const S=p.context,k=S.gl,D=t.getSource(),O=p.useProgram("raster"),V=p.colorModeForRenderPass(),G=p.terrain&&p.terrain.renderingToTexture,[X,J]=D instanceof Ie||G?[{},m]:p.stencilConfigForOverlap(m),ee=J[J.length-1].overscaledZ,Y=!p.options.moving;for(const pe of J){const K=G?n.DepthMode.disabled:p.depthModeForSublayer(pe.overscaledZ-ee,a.paint.get("raster-opacity")===1?n.DepthMode.ReadWrite:n.DepthMode.ReadOnly,k.LESS),ne=pe.toUnwrapped(),oe=t.getTile(pe);if(G&&(!oe||!oe.hasData()))continue;const ge=G?pe.projMatrix:p.transform.calculateProjMatrix(ne,Y),he=p.terrain&&G?p.terrain.stencilModeForRTTOverlap(pe):X[pe.overscaledZ],fe=b?0:a.paint.get("raster-fade-duration");oe.registerFadeDuration(fe);const be=t.findLoadedParent(pe,0),Ve=vc(oe,be,t,p.transform,fe);let Ze,je;p.terrain&&p.terrain.prepareDrawTile();const Ue=a.paint.get("raster-resampling")==="nearest"?k.NEAREST:k.LINEAR;S.activeTexture.set(k.TEXTURE0),oe.texture.bind(Ue,k.CLAMP_TO_EDGE),S.activeTexture.set(k.TEXTURE1),be?(be.texture.bind(Ue,k.CLAMP_TO_EDGE),Ze=Math.pow(2,be.tileID.overscaledZ-oe.tileID.overscaledZ),je=[oe.tileID.canonical.x*Ze%1,oe.tileID.canonical.y*Ze%1]):oe.texture.bind(Ue,k.CLAMP_TO_EDGE);const _e=cf(ge,je||[0,0],Ze||1,Ve,a,D instanceof Ie?D.perspectiveTransform:[0,0]);if(p.prepareDrawProgram(S,O,ne),D instanceof Ie)D.boundsBuffer&&D.boundsSegments&&O.draw(S,k.TRIANGLES,K,n.StencilMode.disabled,V,n.CullFaceMode.disabled,_e,a.id,D.boundsBuffer,p.quadTriangleIndexBuffer,D.boundsSegments);else{const{tileBoundsBuffer:rt,tileBoundsIndexBuffer:it,tileBoundsSegments:Et}=p.getTileBoundsBuffers(oe);O.draw(S,k.TRIANGLES,K,he,V,n.CullFaceMode.disabled,_e,a.id,rt,it,Et)}}p.resetStencilClippingMasks()},background:function(p,t,a,m){const v=a.paint.get("background-color"),b=a.paint.get("background-opacity");if(b===0)return;const S=p.context,k=S.gl,D=p.transform,O=D.tileSize,V=a.paint.get("background-pattern");if(p.isPatternMissing(V))return;const G=!V&&v.a===1&&b===1&&p.opaquePassEnabledForLayer()?"opaque":"translucent";if(p.renderPass!==G)return;const X=n.StencilMode.disabled,J=p.depthModeForSublayer(0,G==="opaque"?n.DepthMode.ReadWrite:n.DepthMode.ReadOnly),ee=p.colorModeForRenderPass(),Y=p.useProgram(V?"backgroundPattern":"background");let pe,K=m;K||(pe=p.getBackgroundTiles(),K=Object.values(pe).map(oe=>oe.tileID)),V&&(S.activeTexture.set(k.TEXTURE0),p.imageManager.bind(p.context));const ne=a.getCrossfadeParameters();for(const oe of K){const ge=oe.toUnwrapped(),he=m?oe.projMatrix:p.transform.calculateProjMatrix(ge);p.prepareDrawTile();const fe=t?t.getTile(oe):pe?pe[oe.key]:new n.Tile(oe,O,D.zoom,p),be=V?ys(he,b,p,V,{tileID:oe,tileSize:O},ne):oh(he,b,v);p.prepareDrawProgram(S,Y,ge);const{tileBoundsBuffer:Ve,tileBoundsIndexBuffer:Ze,tileBoundsSegments:je}=p.getTileBoundsBuffers(fe);Y.draw(S,k.TRIANGLES,J,X,ee,n.CullFaceMode.disabled,be,a.id,Ve,Ze,je)}},sky:function(p,t,a){const m=p.transform,v=m.projection.name==="mercator"||m.projection.name==="globe"?1:n.smoothstep(7,8,m.zoom),b=a.paint.get("sky-opacity")*v;if(b===0)return;const S=p.context,k=a.paint.get("sky-type"),D=new n.DepthMode(S.gl.LEQUAL,n.DepthMode.ReadOnly,[0,1]),O=p.frameCounter/1e3%1;k==="atmosphere"?p.renderPass==="offscreen"?a.needsSkyboxCapture(p)&&(function(V,G,X,J){const ee=V.context,Y=ee.gl;let pe=G.skyboxFbo;if(!pe){pe=G.skyboxFbo=ee.createFramebuffer(32,32,!1),G.skyboxGeometry=new uh(ee),G.skyboxTexture=ee.gl.createTexture(),Y.bindTexture(Y.TEXTURE_CUBE_MAP,G.skyboxTexture),Y.texParameteri(Y.TEXTURE_CUBE_MAP,Y.TEXTURE_WRAP_S,Y.CLAMP_TO_EDGE),Y.texParameteri(Y.TEXTURE_CUBE_MAP,Y.TEXTURE_WRAP_T,Y.CLAMP_TO_EDGE),Y.texParameteri(Y.TEXTURE_CUBE_MAP,Y.TEXTURE_MIN_FILTER,Y.LINEAR),Y.texParameteri(Y.TEXTURE_CUBE_MAP,Y.TEXTURE_MAG_FILTER,Y.LINEAR);for(let ge=0;ge<6;++ge)Y.texImage2D(Y.TEXTURE_CUBE_MAP_POSITIVE_X+ge,0,Y.RGBA,32,32,0,Y.RGBA,Y.UNSIGNED_BYTE,null)}ee.bindFramebuffer.set(pe.framebuffer),ee.viewport.set([0,0,32,32]);const K=G.getCenter(V,!0),ne=V.useProgram("skyboxCapture"),oe=new Float64Array(16);n.identity(oe),n.rotateY(oe,oe,.5*-Math.PI),bs(ee,G,ne,oe,K,0),n.identity(oe),n.rotateY(oe,oe,.5*Math.PI),bs(ee,G,ne,oe,K,1),n.identity(oe),n.rotateX(oe,oe,.5*-Math.PI),bs(ee,G,ne,oe,K,2),n.identity(oe),n.rotateX(oe,oe,.5*Math.PI),bs(ee,G,ne,oe,K,3),n.identity(oe),bs(ee,G,ne,oe,K,4),n.identity(oe),n.rotateY(oe,oe,Math.PI),bs(ee,G,ne,oe,K,5),ee.viewport.set([0,0,V.width,V.height])}(p,a),a.markSkyboxValid(p)):p.renderPass==="sky"&&function(V,G,X,J,ee){const Y=V.context,pe=Y.gl,K=V.transform,ne=V.useProgram("skybox");Y.activeTexture.set(pe.TEXTURE0),pe.bindTexture(pe.TEXTURE_CUBE_MAP,G.skyboxTexture);const oe=((ge,he,fe,be,Ve)=>({u_matrix:ge,u_sun_direction:he,u_cubemap:0,u_opacity:be,u_temporal_offset:Ve}))(K.skyboxMatrix,G.getCenter(V,!1),0,J,ee);V.prepareDrawProgram(Y,ne),ne.draw(Y,pe.TRIANGLES,X,n.StencilMode.disabled,V.colorModeForRenderPass(),n.CullFaceMode.backCW,oe,"skybox",G.skyboxGeometry.vertexBuffer,G.skyboxGeometry.indexBuffer,G.skyboxGeometry.segment)}(p,a,D,b,O):k==="gradient"&&p.renderPass==="sky"&&function(V,G,X,J,ee){const Y=V.context,pe=Y.gl,K=V.transform,ne=V.useProgram("skyboxGradient");G.skyboxGeometry||(G.skyboxGeometry=new uh(Y)),Y.activeTexture.set(pe.TEXTURE0);let oe=G.colorRampTexture;oe||(oe=G.colorRampTexture=new n.Texture(Y,G.colorRamp,pe.RGBA)),oe.bind(pe.LINEAR,pe.CLAMP_TO_EDGE);const ge=((he,fe,be,Ve,Ze)=>({u_matrix:he,u_color_ramp:0,u_center_direction:fe,u_radius:n.degToRad(be),u_opacity:Ve,u_temporal_offset:Ze}))(K.skyboxMatrix,G.getCenter(V,!1),G.paint.get("sky-gradient-radius"),J,ee);V.prepareDrawProgram(Y,ne),ne.draw(Y,pe.TRIANGLES,X,n.StencilMode.disabled,V.colorModeForRenderPass(),n.CullFaceMode.backCW,ge,"skyboxGradient",G.skyboxGeometry.vertexBuffer,G.skyboxGeometry.indexBuffer,G.skyboxGeometry.segment)}(p,a,D,b,O)},debug:function(p,t,a){for(let m=0;m<a.length;m++)xl(p,t,a[m])},custom:function(p,t,a){const m=p.context,v=a.implementation;if(p.transform.projection.unsupportedLayers&&p.transform.projection.unsupportedLayers.includes("custom"))n.warnOnce("Custom layers are not yet supported with non-mercator projections. Use mercator to enable custom layers.");else if(p.renderPass==="offscreen"){const b=v.prerender;b&&(p.setCustomLayerDefaults(),m.setColorMode(p.colorModeForRenderPass()),b.call(v,m.gl,p.transform.customLayerMatrix()),m.setDirty(),p.setBaseState())}else if(p.renderPass==="translucent"){p.setCustomLayerDefaults(),m.setColorMode(p.colorModeForRenderPass()),m.setStencilMode(n.StencilMode.disabled);const b=v.renderingMode==="3d"?new n.DepthMode(p.context.gl.LEQUAL,n.DepthMode.ReadWrite,p.depthRangeFor3D):p.depthModeForSublayer(0,n.DepthMode.ReadOnly);m.setDepthMode(b),v.render(m.gl,p.transform.customLayerMatrix()),m.setDirty(),p.setBaseState(),m.bindFramebuffer.set(null)}}};class wl{constructor(t,a){this.context=new le(t),this.transform=a,this._tileTextures={},this.frameCopies=[],this.loadTimeStamps=[],this.setup(),this.numSublayers=n.SourceCache.maxUnderzooming+n.SourceCache.maxOverzooming+1,this.depthEpsilon=1/Math.pow(2,16),this.crossTileSymbolIndex=new Wu,this.deferredRenderGpuTimeQueries=[],this.gpuTimers={},this.frameCounter=0,this._backgroundTiles={}}updateTerrain(t,a){const m=!!t&&!!t.terrain&&this.transform.projection.supportsTerrain;if(!(m||this._terrain&&this._terrain.enabled))return;this._terrain||(this._terrain=new xc(this,t));const v=this._terrain;this.transform.elevation=m?v:null,v.update(t,this.transform,a)}_updateFog(t){const a=t.fog;if(!a||this.transform.projection.name==="globe"||a.getOpacity(this.transform.pitch)<1||a.properties.get("horizon-blend")<.03)return void(this.transform.fogCullDistSq=null);const[m,v]=a.getFovAdjustedRange(this.transform._fov);if(m>v)return void(this.transform.fogCullDistSq=null);const b=m+.78*(v-m);this.transform.fogCullDistSq=b*b}get terrain(){return this.transform._terrainEnabled()&&this._terrain&&this._terrain.enabled?this._terrain:null}resize(t,a){if(this.width=t*n.exported.devicePixelRatio,this.height=a*n.exported.devicePixelRatio,this.context.viewport.set([0,0,this.width,this.height]),this.style)for(const m of this.style.order)this.style._layers[m].resize()}setup(){const t=this.context,a=new n.StructArrayLayout2i4;a.emplaceBack(0,0),a.emplaceBack(n.EXTENT,0),a.emplaceBack(0,n.EXTENT),a.emplaceBack(n.EXTENT,n.EXTENT),this.tileExtentBuffer=t.createVertexBuffer(a,n.posAttributes.members),this.tileExtentSegments=n.SegmentVector.simpleSegment(0,0,4,2);const m=new n.StructArrayLayout2i4;m.emplaceBack(0,0),m.emplaceBack(n.EXTENT,0),m.emplaceBack(0,n.EXTENT),m.emplaceBack(n.EXTENT,n.EXTENT),this.debugBuffer=t.createVertexBuffer(m,n.posAttributes.members),this.debugSegments=n.SegmentVector.simpleSegment(0,0,4,5);const v=new n.StructArrayLayout2i4;v.emplaceBack(-1,-1),v.emplaceBack(1,-1),v.emplaceBack(-1,1),v.emplaceBack(1,1),this.viewportBuffer=t.createVertexBuffer(v,n.posAttributes.members),this.viewportSegments=n.SegmentVector.simpleSegment(0,0,4,2);const b=new n.StructArrayLayout4i8;b.emplaceBack(0,0,0,0),b.emplaceBack(n.EXTENT,0,n.EXTENT,0),b.emplaceBack(0,n.EXTENT,0,n.EXTENT),b.emplaceBack(n.EXTENT,n.EXTENT,n.EXTENT,n.EXTENT),this.mercatorBoundsBuffer=t.createVertexBuffer(b,n.boundsAttributes.members),this.mercatorBoundsSegments=n.SegmentVector.simpleSegment(0,0,4,2);const S=new n.StructArrayLayout3ui6;S.emplaceBack(0,1,2),S.emplaceBack(2,1,3),this.quadTriangleIndexBuffer=t.createIndexBuffer(S);const k=new n.StructArrayLayout1ui2;for(const O of[0,1,3,2,0])k.emplaceBack(O);this.debugIndexBuffer=t.createIndexBuffer(k),this.emptyTexture=new n.Texture(t,new n.RGBAImage({width:1,height:1},Uint8Array.of(0,0,0,0)),t.gl.RGBA),this.identityMat=n.create();const D=this.context.gl;this.stencilClearMode=new n.StencilMode({func:D.ALWAYS,mask:0},0,255,D.ZERO,D.ZERO,D.ZERO),this.loadTimeStamps.push(n.window.performance.now()),this.atmosphereBuffer=new df(this.context)}getMercatorTileBoundsBuffers(){return{tileBoundsBuffer:this.mercatorBoundsBuffer,tileBoundsIndexBuffer:this.quadTriangleIndexBuffer,tileBoundsSegments:this.mercatorBoundsSegments}}getTileBoundsBuffers(t){return t._makeTileBoundsBuffers(this.context,this.transform.projection),t._tileBoundsBuffer?{tileBoundsBuffer:t._tileBoundsBuffer,tileBoundsIndexBuffer:t._tileBoundsIndexBuffer,tileBoundsSegments:t._tileBoundsSegments}:this.getMercatorTileBoundsBuffers()}clearStencil(){const t=this.context,a=t.gl;this.nextStencilID=1,this.currentStencilSource=void 0,this._tileClippingMaskIDs={},this.useProgram("clippingMask").draw(t,a.TRIANGLES,n.DepthMode.disabled,this.stencilClearMode,n.ColorMode.disabled,n.CullFaceMode.disabled,ha(this.identityMat),"$clipping",this.viewportBuffer,this.quadTriangleIndexBuffer,this.viewportSegments)}resetStencilClippingMasks(){this.terrain||(this.currentStencilSource=void 0,this._tileClippingMaskIDs={})}_renderTileClippingMasks(t,a,m){if(!a||this.currentStencilSource===a.id||!t.isTileClipped()||!m||m.length===0)return;if(this._tileClippingMaskIDs&&!this.terrain){let k=!1;for(const D of m)if(this._tileClippingMaskIDs[D.key]===void 0){k=!0;break}if(!k)return}this.currentStencilSource=a.id;const v=this.context,b=v.gl;this.nextStencilID+m.length>256&&this.clearStencil(),v.setColorMode(n.ColorMode.disabled),v.setDepthMode(n.DepthMode.disabled);const S=this.useProgram("clippingMask");this._tileClippingMaskIDs={};for(const k of m){const D=a.getTile(k),O=this._tileClippingMaskIDs[k.key]=this.nextStencilID++,{tileBoundsBuffer:V,tileBoundsIndexBuffer:G,tileBoundsSegments:X}=this.getTileBoundsBuffers(D);S.draw(v,b.TRIANGLES,n.DepthMode.disabled,new n.StencilMode({func:b.ALWAYS,mask:0},O,255,b.KEEP,b.KEEP,b.REPLACE),n.ColorMode.disabled,n.CullFaceMode.disabled,ha(k.projMatrix),"$clipping",V,G,X)}}stencilModeFor3D(){this.currentStencilSource=void 0,this.nextStencilID+1>256&&this.clearStencil();const t=this.nextStencilID++,a=this.context.gl;return new n.StencilMode({func:a.NOTEQUAL,mask:255},t,255,a.KEEP,a.KEEP,a.REPLACE)}stencilModeForClipping(t){if(this.terrain)return this.terrain.stencilModeForRTTOverlap(t);const a=this.context.gl;return new n.StencilMode({func:a.EQUAL,mask:255},this._tileClippingMaskIDs[t.key],0,a.KEEP,a.KEEP,a.REPLACE)}stencilConfigForOverlap(t){const a=this.context.gl,m=t.sort((S,k)=>k.overscaledZ-S.overscaledZ),v=m[m.length-1].overscaledZ,b=m[0].overscaledZ-v+1;if(b>1){this.currentStencilSource=void 0,this.nextStencilID+b>256&&this.clearStencil();const S={};for(let k=0;k<b;k++)S[k+v]=new n.StencilMode({func:a.GEQUAL,mask:255},k+this.nextStencilID,255,a.KEEP,a.KEEP,a.REPLACE);return this.nextStencilID+=b,[S,m]}return[{[v]:n.StencilMode.disabled},m]}colorModeForRenderPass(){const t=this.context.gl;return this._showOverdrawInspector?new n.ColorMode([t.CONSTANT_COLOR,t.ONE],new n.Color(.125,.125,.125,0),[!0,!0,!0,!0]):this.renderPass==="opaque"?n.ColorMode.unblended:n.ColorMode.alphaBlended}depthModeForSublayer(t,a,m){if(!this.opaquePassEnabledForLayer())return n.DepthMode.disabled;const v=1-((1+this.currentLayer)*this.numSublayers+t)*this.depthEpsilon;return new n.DepthMode(m||this.context.gl.LEQUAL,a,[v,v])}opaquePassEnabledForLayer(){return this.currentLayer<this.opaquePassCutoff}render(t,a){this.style=t,this.options=a,this.lineAtlas=t.lineAtlas,this.imageManager=t.imageManager,this.glyphManager=t.glyphManager,this.symbolFadeChange=t.placement.symbolFadeChange(n.exported.now()),this.imageManager.beginFrame();const m=this.style.order,v=this.style._sourceCaches;for(const D in v){const O=v[D];O.used&&O.prepare(this.context)}const b={},S={},k={};for(const D in v){const O=v[D];b[D]=O.getVisibleCoordinates(),S[D]=b[D].slice().reverse(),k[D]=O.getVisibleCoordinates(!0).reverse()}this.opaquePassCutoff=1/0;for(let D=0;D<m.length;D++)if(this.style._layers[m[D]].is3D()){this.opaquePassCutoff=D;break}if(this.terrain&&(this.terrain.updateTileBinding(k),this.opaquePassCutoff=0),this.transform.projection.name!=="globe"||this.globeSharedBuffers||(this.globeSharedBuffers=new n.GlobeSharedBuffers(this.context)),n.isMapAuthenticated(this.context.gl)){this.renderPass="offscreen";for(const D of m){const O=this.style._layers[D],V=t._getLayerSourceCache(O);if(!O.hasOffscreenPass()||O.isHidden(this.transform.zoom))continue;const G=V?S[V.id]:void 0;(O.type==="custom"||O.isSky()||G&&G.length)&&this.renderLayer(this,V,O,G)}if(this.depthRangeFor3D=[0,1-(t.order.length+2)*this.numSublayers*this.depthEpsilon],this.terrain&&(this.style.hasSymbolLayers()||this.style.hasCircleLayers())&&this.terrain.drawDepth(),this.context.bindFramebuffer.set(null),this.context.viewport.set([0,0,this.width,this.height]),this.context.clear({color:a.showOverdrawInspector?n.Color.black:n.Color.transparent,depth:1}),this.clearStencil(),this._showOverdrawInspector=a.showOverdrawInspector,this.renderPass="opaque",!this.terrain)for(this.currentLayer=m.length-1;this.currentLayer>=0;this.currentLayer--){const D=this.style._layers[m[this.currentLayer]],O=t._getLayerSourceCache(D);if(D.isSky())continue;const V=O?S[O.id]:void 0;this._renderTileClippingMasks(D,O,V),this.renderLayer(this,O,D,V)}if(this.style.fog&&this.transform.projection.supportsFog&&function(D,O){const V=D.context,G=V.gl,X=D.transform,J=new n.DepthMode(G.LEQUAL,n.DepthMode.ReadOnly,[0,1]),ee=D.useProgram("globeAtmosphere",null,X.projection.name==="globe"?["PROJECTION_GLOBE_VIEW","FOG"]:["FOG"]),Y=n.globeToMercatorTransition(X.zoom),pe=O.properties.get("color").toArray01(),K=O.properties.get("high-color").toArray01(),ne=O.properties.get("space-color").toArray01PremultipliedAlpha(),oe=n.identity$1([]);n.rotateY$1(oe,oe,-n.degToRad(X._center.lng)),n.rotateX$1(oe,oe,n.degToRad(X._center.lat)),n.rotateZ$1(oe,oe,X.angle),n.rotateX$1(oe,oe,-X._pitch);const ge=n.fromQuat(new Float32Array(16),oe),he=n.mapValue(O.properties.get("star-intensity"),0,1,0,.25),fe=5e-4,be=n.mapValue(O.properties.get("horizon-blend"),0,1,fe,.25),Ve=n.globeUseCustomAntiAliasing(D,V,X)&&be===fe?X.worldSize/(2*Math.PI*1.025)-1:X.globeRadius,Ze=D.frameCounter/1e3%1,je=n.length(X.globeCenterInViewSpace),Ue=Math.sqrt(Math.pow(je,2)-Math.pow(Ve,2)),_e=Math.acos(Ue/je),rt=((Et,Ke,Ft,vt,yt,ut,gt,Xt,Vt,oi,Ot,ii,Si,zi)=>({u_frustum_tl:Et,u_frustum_tr:Ke,u_frustum_br:Ft,u_frustum_bl:vt,u_horizon:yt,u_transition:ut,u_fadeout_range:gt,u_color:Xt,u_high_color:Vt,u_space_color:oi,u_star_intensity:Ot,u_star_size:5*n.exported.devicePixelRatio,u_star_density:0,u_temporal_offset:ii,u_horizon_angle:Si,u_rotation_matrix:zi}))(X.frustumCorners.TL,X.frustumCorners.TR,X.frustumCorners.BR,X.frustumCorners.BL,X.frustumCorners.horizon,Y,be,pe,K,ne,he,Ze,_e,ge);D.prepareDrawProgram(V,ee);const it=D.atmosphereBuffer;it&&ee.draw(V,G.TRIANGLES,J,n.StencilMode.disabled,n.ColorMode.alphaBlended,n.CullFaceMode.backCW,rt,"skybox",it.vertexBuffer,it.indexBuffer,it.segments)}(this,this.style.fog),this.renderPass="sky",(n.globeToMercatorTransition(this.transform.zoom)>0||this.transform.projection.name!=="globe")&&this.transform.isHorizonVisible())for(this.currentLayer=0;this.currentLayer<m.length;this.currentLayer++){const D=this.style._layers[m[this.currentLayer]],O=t._getLayerSourceCache(D);D.isSky()&&this.renderLayer(this,O,D,O?S[O.id]:void 0)}for(this.renderPass="translucent",this.currentLayer=0;this.currentLayer<m.length;){const D=this.style._layers[m[this.currentLayer]],O=t._getLayerSourceCache(D);if(D.isSky()){++this.currentLayer;continue}if(this.terrain&&this.style.isLayerDraped(D)){if(D.isHidden(this.transform.zoom)){++this.currentLayer;continue}this.currentLayer=this.terrain.renderBatch(this.currentLayer);continue}const V=O?(D.type==="symbol"?k:S)[O.id]:void 0;this._renderTileClippingMasks(D,O,O?b[O.id]:void 0),this.renderLayer(this,O,D,V),++this.currentLayer}if(this.terrain&&this.terrain.postRender(),this.options.showTileBoundaries||this.options.showQueryGeometry){let D=null;n.values(this.style._layers).forEach(O=>{const V=t._getLayerSourceCache(O);V&&!O.isHidden(this.transform.zoom)&&(!D||D.getSource().maxzoom<V.getSource().maxzoom)&&(D=V)}),D&&this.options.showTileBoundaries&&bl.debug(this,D,D.getVisibleCoordinates())}this.options.showPadding&&function(D){const O=D.transform.padding;Lc(D,D.transform.height-(O.top||0),3,Go),Lc(D,O.bottom||0,3,ma),vl(D,O.left||0,3,lh),vl(D,D.transform.width-(O.right||0),3,vs);const V=D.transform.centerPoint;(function(G,X,J,ee){wi(G,X-1,J-10,2,20,ee),wi(G,X-10,J-1,20,2,ee)})(D,V.x,D.transform.height-V.y,xs)}(this),this.context.setDefault(),this.frameCounter=(this.frameCounter+1)%Number.MAX_SAFE_INTEGER,this.tileLoaded&&this.options.speedIndexTiming&&(this.loadTimeStamps.push(n.window.performance.now()),this.saveCanvasCopy())}}renderLayer(t,a,m,v){m.isHidden(this.transform.zoom)||(m.type==="background"||m.type==="sky"||m.type==="custom"||v&&v.length)&&(this.id=m.id,this.gpuTimingStart(m),t.transform.projection.unsupportedLayers&&t.transform.projection.unsupportedLayers.includes(m.type)||bl[m.type](t,a,m,v,this.style.placement.variableOffsets,this.options.isInitialLoad),this.gpuTimingEnd())}gpuTimingStart(t){if(!this.options.gpuTiming)return;const a=this.context.extTimerQuery;let m=this.gpuTimers[t.id];m||(m=this.gpuTimers[t.id]={calls:0,cpuTime:0,query:a.createQueryEXT()}),m.calls++,a.beginQueryEXT(a.TIME_ELAPSED_EXT,m.query)}gpuTimingDeferredRenderStart(){if(this.options.gpuTimingDeferredRender){const t=this.context.extTimerQuery,a=t.createQueryEXT();this.deferredRenderGpuTimeQueries.push(a),t.beginQueryEXT(t.TIME_ELAPSED_EXT,a)}}gpuTimingDeferredRenderEnd(){if(!this.options.gpuTimingDeferredRender)return;const t=this.context.extTimerQuery;t.endQueryEXT(t.TIME_ELAPSED_EXT)}gpuTimingEnd(){if(!this.options.gpuTiming)return;const t=this.context.extTimerQuery;t.endQueryEXT(t.TIME_ELAPSED_EXT)}collectGpuTimers(){const t=this.gpuTimers;return this.gpuTimers={},t}collectDeferredRenderGpuQueries(){const t=this.deferredRenderGpuTimeQueries;return this.deferredRenderGpuTimeQueries=[],t}queryGpuTimers(t){const a={};for(const m in t){const v=t[m],b=this.context.extTimerQuery,S=b.getQueryObjectEXT(v.query,b.QUERY_RESULT_EXT)/1e6;b.deleteQueryEXT(v.query),a[m]=S}return a}queryGpuTimeDeferredRender(t){if(!this.options.gpuTimingDeferredRender)return 0;const a=this.context.extTimerQuery;let m=0;for(const v of t)m+=a.getQueryObjectEXT(v,a.QUERY_RESULT_EXT)/1e6,a.deleteQueryEXT(v);return m}translatePosMatrix(t,a,m,v,b){if(!m[0]&&!m[1])return t;const S=b?v==="map"?this.transform.angle:0:v==="viewport"?-this.transform.angle:0;if(S){const O=Math.sin(S),V=Math.cos(S);m=[m[0]*V-m[1]*O,m[0]*O+m[1]*V]}const k=[b?m[0]:Lt(a,m[0],this.transform.zoom),b?m[1]:Lt(a,m[1],this.transform.zoom),0],D=new Float32Array(16);return n.translate(D,t,k),D}saveTileTexture(t){const a=this._tileTextures[t.size[0]];a?a.push(t):this._tileTextures[t.size[0]]=[t]}getTileTexture(t){const a=this._tileTextures[t];return a&&a.length>0?a.pop():null}isPatternMissing(t){if(!t)return!1;if(!t.from||!t.to)return!0;const a=this.imageManager.getPattern(t.from.toString()),m=this.imageManager.getPattern(t.to.toString());return!a||!m}currentGlobalDefines(){const t=this.terrain&&this.terrain.renderingToTexture,a=this.style&&this.style.fog,m=[];return this.terrain&&!this.terrain.renderingToTexture&&m.push("TERRAIN"),a&&!t&&a.getOpacity(this.transform.pitch)!==0&&m.push("FOG"),t&&m.push("RENDER_TO_TEXTURE"),this._showOverdrawInspector&&m.push("OVERDRAW_INSPECTOR"),m}useProgram(t,a,m){this.cache=this.cache||{};const v=m||[],b=this.currentGlobalDefines().concat(v),S=fl.cacheKey(t,b,a);return this.cache[S]||(this.cache[S]=new fl(this.context,t,sl[t],a,uf[t],b)),this.cache[S]}setCustomLayerDefaults(){this.context.unbindVAO(),this.context.cullFace.setDefault(),this.context.frontFace.setDefault(),this.context.cullFaceSide.setDefault(),this.context.activeTexture.setDefault(),this.context.pixelStoreUnpack.setDefault(),this.context.pixelStoreUnpackPremultiplyAlpha.setDefault(),this.context.pixelStoreUnpackFlipY.setDefault()}setBaseState(){const t=this.context.gl;this.context.cullFace.set(!1),this.context.viewport.set([0,0,this.width,this.height]),this.context.blendEquation.set(t.FUNC_ADD)}initDebugOverlayCanvas(){this.debugOverlayCanvas==null&&(this.debugOverlayCanvas=n.window.document.createElement("canvas"),this.debugOverlayCanvas.width=512,this.debugOverlayCanvas.height=512,this.debugOverlayTexture=new n.Texture(this.context,this.debugOverlayCanvas,this.context.gl.RGBA))}destroy(){this._terrain&&this._terrain.destroy(),this.globeSharedBuffers&&this.globeSharedBuffers.destroy(),this.emptyTexture.destroy(),this.debugOverlayTexture&&this.debugOverlayTexture.destroy(),this.atmosphereBuffer&&this.atmosphereBuffer.destroy()}prepareDrawTile(){this.terrain&&this.terrain.prepareDrawTile()}prepareDrawProgram(t,a,m){if(this.terrain&&this.terrain.renderingToTexture)return;const v=this.style.fog;if(v){const b=v.getOpacity(this.transform.pitch),S=((k,D,O,V,G,X,J,ee,Y,pe,K)=>{const ne=k.transform,oe=D.properties.get("color").toArray01();oe[3]=V;const ge=k.frameCounter/1e3%1;return{u_fog_matrix:O?ne.calculateFogTileMatrix(O):k.identityMat,u_fog_range:D.getFovAdjustedRange(ne._fov),u_fog_color:oe,u_fog_horizon_blend:D.properties.get("horizon-blend"),u_fog_temporal_offset:ge,u_frustum_tl:G,u_frustum_tr:X,u_frustum_br:J,u_frustum_bl:ee,u_globe_pos:Y,u_globe_radius:pe,u_viewport:K,u_globe_transition:n.globeToMercatorTransition(ne.zoom),u_is_globe:+(ne.projection.name==="globe")}})(this,v,m,b,this.transform.frustumCorners.TL,this.transform.frustumCorners.TR,this.transform.frustumCorners.BR,this.transform.frustumCorners.BL,this.transform.globeCenterInViewSpace,this.transform.globeRadius,[this.transform.width*n.exported.devicePixelRatio,this.transform.height*n.exported.devicePixelRatio]);a.setFogUniformValues(t,S)}}setTileLoadedFlag(t){this.tileLoaded=t}saveCanvasCopy(){this.frameCopies.push(this.canvasCopy()),this.tileLoaded=!1}canvasCopy(){const t=this.context.gl,a=t.createTexture();return t.bindTexture(t.TEXTURE_2D,a),t.copyTexImage2D(t.TEXTURE_2D,0,t.RGBA,0,0,t.drawingBufferWidth,t.drawingBufferHeight,0),a}getCanvasCopiesAndTimestamps(){return{canvasCopies:this.frameCopies,timeStamps:this.loadTimeStamps}}averageElevationNeedsEasing(){if(!this.transform._elevation)return!1;const t=this.style&&this.style.fog;return!!t&&t.getOpacity(this.transform.pitch)!==0}getBackgroundTiles(){const t=this._backgroundTiles,a=this._backgroundTiles={},m=this.transform.coveringTiles({tileSize:512});for(const v of m)a[v.key]=t[v.key]||new n.Tile(v,512,this.transform.tileZoom,this);return a}clearBackgroundTiles(){this._backgroundTiles={}}}class qo{constructor(t=0,a=0,m=0,v=0){if(isNaN(t)||t<0||isNaN(a)||a<0||isNaN(m)||m<0||isNaN(v)||v<0)throw new Error("Invalid value for edge-insets, top, bottom, left and right must all be numbers");this.top=t,this.bottom=a,this.left=m,this.right=v}interpolate(t,a,m){return a.top!=null&&t.top!=null&&(this.top=n.number(t.top,a.top,m)),a.bottom!=null&&t.bottom!=null&&(this.bottom=n.number(t.bottom,a.bottom,m)),a.left!=null&&t.left!=null&&(this.left=n.number(t.left,a.left,m)),a.right!=null&&t.right!=null&&(this.right=n.number(t.right,a.right,m)),this}getCenter(t,a){const m=n.clamp((this.left+t-this.right)/2,0,t),v=n.clamp((this.top+a-this.bottom)/2,0,a);return new n.pointGeometry(m,v)}equals(t){return this.top===t.top&&this.bottom===t.bottom&&this.left===t.left&&this.right===t.right}clone(){return new qo(this.top,this.bottom,this.left,this.right)}toJSON(){return{top:this.top,bottom:this.bottom,left:this.left,right:this.right}}}function El(p,t){const a=n.getColumn(p,3);n.fromQuat(p,t),n.setColumn(p,3,a)}function _a(p,t){const a=n.identity$1([]);return n.rotateZ$1(a,a,-t),n.rotateX$1(a,a,-p),a}function Tl(p,t){const a=[p[0],p[1],0],m=[t[0],t[1],0];if(n.length(a)>=1e-15){const S=n.normalize([],a);n.scale$2(m,S,n.dot(m,S)),t[0]=m[0],t[1]=m[1]}const v=n.cross([],t,p);if(n.len(v)<1e-15)return null;const b=Math.atan2(-v[1],v[0]);return _a(Math.atan2(Math.sqrt(p[0]*p[0]+p[1]*p[1]),-p[2]),b)}class ga{constructor(t,a){this.position=t,this.orientation=a}get position(){return this._position}set position(t){if(t){const a=t instanceof n.MercatorCoordinate?t:new n.MercatorCoordinate(t[0],t[1],t[2]);this._renderWorldCopies&&(a.x=n.wrap(a.x,0,1)),this._position=a}else this._position=null}lookAtPoint(t,a){if(this.orientation=null,!this.position)return;const m=this._elevation?this._elevation.getAtPointOrZero(n.MercatorCoordinate.fromLngLat(t)):0,v=this.position,b=n.MercatorCoordinate.fromLngLat(t,m),S=[b.x-v.x,b.y-v.y,b.z-v.z];a||(a=[0,0,1]),a[2]=Math.abs(a[2]),this.orientation=Tl(S,a)}setPitchBearing(t,a){this.orientation=_a(n.degToRad(t),n.degToRad(-a))}}class ws{constructor(t,a){this._transform=n.identity([]),this.orientation=a,this.position=t}get mercatorPosition(){const t=this.position;return new n.MercatorCoordinate(t[0],t[1],t[2])}get position(){const t=n.getColumn(this._transform,3);return[t[0],t[1],t[2]]}set position(t){var a;t&&n.setColumn(this._transform,3,[(a=t)[0],a[1],a[2],1])}get orientation(){return this._orientation}set orientation(t){this._orientation=t||n.identity$1([]),t&&El(this._transform,this._orientation)}getPitchBearing(){const t=this.forward(),a=this.right();return{bearing:Math.atan2(-a[1],a[0]),pitch:Math.atan2(Math.sqrt(t[0]*t[0]+t[1]*t[1]),-t[2])}}setPitchBearing(t,a){this._orientation=_a(t,a),El(this._transform,this._orientation)}forward(){const t=n.getColumn(this._transform,2);return[-t[0],-t[1],-t[2]]}up(){const t=n.getColumn(this._transform,1);return[-t[0],-t[1],-t[2]]}right(){const t=n.getColumn(this._transform,0);return[t[0],t[1],t[2]]}getCameraToWorld(t,a){const m=new Float64Array(16);return n.invert(m,this.getWorldToCamera(t,a)),m}getWorldToCameraPosition(t,a,m){const v=this.position;n.scale$2(v,v,-t);const b=new Float64Array(16);return n.fromScaling(b,[m,m,m]),n.translate(b,b,v),b[10]*=a,b}getWorldToCamera(t,a){const m=new Float64Array(16),v=new Float64Array(4),b=this.position;return n.conjugate(v,this._orientation),n.scale$2(b,b,-t),n.fromQuat(m,v),n.translate(m,m,b),m[1]*=-1,m[5]*=-1,m[9]*=-1,m[13]*=-1,m[8]*=a,m[9]*=a,m[10]*=a,m[11]*=a,m}getCameraToClipPerspective(t,a,m,v){const b=new Float64Array(16);return n.perspective(b,t,a,m,v),b}getDistanceToElevation(t){const a=t===0?0:n.mercatorZfromAltitude(t,this.position[1]),m=this.forward();return(a-this.position[2])/m[2]}clone(){return new ws([...this.position],[...this.orientation])}}function kt(p,t){const a=ya(p.projection,p.zoom,p.width,p.height),m=function(b,S,k,D,O){const V=new n.LngLat(k.lng-180*Zo,k.lat),G=new n.LngLat(k.lng+180*Zo,k.lat),X=b.project(V.lng,V.lat),J=b.project(G.lng,G.lat),ee=-Math.atan2(J.y-X.y,J.x-X.x),Y=n.MercatorCoordinate.fromLngLat(k);Y.y=n.clamp(Y.y,-.999975,.999975);const pe=Y.toLngLat(),K=b.project(pe.lng,pe.lat),ne=n.MercatorCoordinate.fromLngLat(pe);ne.x+=Zo;const oe=ne.toLngLat(),ge=b.project(oe.lng,oe.lat),he=$o(ge.x-K.x,ge.y-K.y,ee),fe=n.MercatorCoordinate.fromLngLat(pe);fe.y+=Zo;const be=fe.toLngLat(),Ve=b.project(be.lng,be.lat),Ze=$o(Ve.x-K.x,Ve.y-K.y,ee),je=Math.abs(he.x)/Math.abs(Ze.y),Ue=n.identity([]);n.rotateZ(Ue,Ue,-ee*(1-(O?0:D)));const _e=n.identity([]);return n.scale(_e,_e,[1,1-(1-je)*D,1]),_e[4]=-Ze.x/Ze.y*D,n.rotateZ(_e,_e,ee),n.multiply(_e,Ue,_e),_e}(p.projection,0,p.center,a,t),v=un(p);return n.scale(m,m,[v,v,1]),m}function un(p){const t=p.projection,a=ya(p.projection,p.zoom,p.width,p.height),m=Rc(t,p.center),v=Rc(t,n.LngLat.convert(t.center));return Math.pow(2,m*a+(1-a)*v)}function ya(p,t,a,m,v=1/0){const b=p.range;if(!b)return 0;const S=Math.min(v,Math.max(a,m)),k=Math.log(S/1024)/Math.LN2;return n.smoothstep(b[0]+k,b[1]+k,t)}const Zo=1/4e4;function Rc(p,t){const a=n.clamp(t.lat,-n.MAX_MERCATOR_LATITUDE,n.MAX_MERCATOR_LATITUDE),m=new n.LngLat(t.lng-180*Zo,a),v=new n.LngLat(t.lng+180*Zo,a),b=p.project(m.lng,a),S=p.project(v.lng,a),k=n.MercatorCoordinate.fromLngLat(m),D=n.MercatorCoordinate.fromLngLat(v),O=S.x-b.x,V=S.y-b.y,G=D.x-k.x,X=D.y-k.y,J=Math.sqrt((G*G+X*X)/(O*O+V*V));return Math.log(J)/Math.LN2}function $o(p,t,a){const m=Math.cos(a),v=Math.sin(a);return{x:p*m-t*v,y:p*v+t*m}}class Al{constructor(t,a,m,v,b,S,k){this.tileSize=512,this._renderWorldCopies=b===void 0||b,this._minZoom=t||0,this._maxZoom=a||22,this._minPitch=m==null?0:m,this._maxPitch=v==null?60:v,this.setProjection(S),this.setMaxBounds(k),this.width=0,this.height=0,this._center=new n.LngLat(0,0),this.zoom=0,this.angle=0,this._fov=.6435011087932844,this._pitch=0,this._nearZ=0,this._farZ=0,this._unmodified=!0,this._edgeInsets=new qo,this._projMatrixCache={},this._alignedProjMatrixCache={},this._fogTileMatrixCache={},this._distanceTileDataCache={},this._camera=new ws,this._centerAltitude=0,this._averageElevation=0,this.cameraElevationReference="ground",this._projectionScaler=1,this.globeRadius=0,this.globeCenterInViewSpace=[0,0,0],this._horizonShift=.1}clone(){const t=new Al(this._minZoom,this._maxZoom,this._minPitch,this.maxPitch,this._renderWorldCopies,this.getProjection());return t._elevation=this._elevation,t._centerAltitude=this._centerAltitude,t._centerAltitudeValidForExaggeration=this._centerAltitudeValidForExaggeration,t.tileSize=this.tileSize,t.width=this.width,t.height=this.height,t.cameraElevationReference=this.cameraElevationReference,t._center=this._center,t._setZoom(this.zoom),t._seaLevelZoom=this._seaLevelZoom,t.angle=this.angle,t._fov=this._fov,t._pitch=this._pitch,t._nearZ=this._nearZ,t._farZ=this._farZ,t._averageElevation=this._averageElevation,t._unmodified=this._unmodified,t._edgeInsets=this._edgeInsets.clone(),t._camera=this._camera.clone(),t._calcMatrices(),t.freezeTileCoverage=this.freezeTileCoverage,t.frustumCorners=this.frustumCorners,t}get elevation(){return this._elevation}set elevation(t){this._elevation!==t&&(this._elevation=t,this._updateCameraOnTerrain(),this._calcMatrices())}updateElevation(t){const a=this._elevation&&this._elevation.exaggeration()!==this._centerAltitudeValidForExaggeration;(this._seaLevelZoom==null||a)&&this._updateCameraOnTerrain(),(t||a)&&this._constrainCameraAltitude(),this._calcMatrices()}getProjection(){return n.pick(this.projection,["name","center","parallels"])}setProjection(t){this.projectionOptions=t||{name:"mercator"};const a=this.projection?this.getProjection():void 0;this.projection=n.getProjection(this.projectionOptions);const m=!w(a,this.getProjection());return m&&this._calcMatrices(),m}get minZoom(){return this._minZoom}set minZoom(t){this._minZoom!==t&&(this._minZoom=t,this.zoom=Math.max(this.zoom,t))}get maxZoom(){return this._maxZoom}set maxZoom(t){this._maxZoom!==t&&(this._maxZoom=t,this.zoom=Math.min(this.zoom,t))}get minPitch(){return this._minPitch}set minPitch(t){this._minPitch!==t&&(this._minPitch=t,this.pitch=Math.max(this.pitch,t))}get maxPitch(){return this._maxPitch}set maxPitch(t){this._maxPitch!==t&&(this._maxPitch=t,this.pitch=Math.min(this.pitch,t))}get renderWorldCopies(){return this._renderWorldCopies&&this.projection.supportsWorldCopies===!0}set renderWorldCopies(t){t===void 0?t=!0:t===null&&(t=!1),this._renderWorldCopies=t}get worldSize(){return this.tileSize*this.scale}get cameraWorldSize(){const t=Math.max(this._camera.getDistanceToElevation(this._averageElevation),Number.EPSILON);return this._worldSizeFromZoom(this._zoomFromMercatorZ(t))}get pixelsPerMeter(){return this.projection.pixelsPerMeter(this.center.lat,this.worldSize)}get cameraPixelsPerMeter(){return n.mercatorZfromAltitude(this.center.lat,this.cameraWorldSize)}get centerOffset(){return this.centerPoint._sub(this.size._div(2))}get size(){return new n.pointGeometry(this.width,this.height)}get bearing(){return n.wrap(this.rotation,-180,180)}set bearing(t){this.rotation=t}get rotation(){return-this.angle/Math.PI*180}set rotation(t){const a=-t*Math.PI/180;var m;this.angle!==a&&(this._unmodified=!1,this.angle=a,this._calcMatrices(),this.rotationMatrix=(m=new n.ARRAY_TYPE(4),n.ARRAY_TYPE!=Float32Array&&(m[1]=0,m[2]=0),m[0]=1,m[3]=1,m),function(v,b,S){var k=b[0],D=b[1],O=b[2],V=b[3],G=Math.sin(S),X=Math.cos(S);v[0]=k*X+O*G,v[1]=D*X+V*G,v[2]=k*-G+O*X,v[3]=D*-G+V*X}(this.rotationMatrix,this.rotationMatrix,this.angle))}get pitch(){return this._pitch/Math.PI*180}set pitch(t){const a=n.clamp(t,this.minPitch,this.maxPitch)/180*Math.PI;this._pitch!==a&&(this._unmodified=!1,this._pitch=a,this._calcMatrices())}get fov(){return this._fov/Math.PI*180}set fov(t){t=Math.max(.01,Math.min(60,t)),this._fov!==t&&(this._unmodified=!1,this._fov=t/180*Math.PI,this._calcMatrices())}get averageElevation(){return this._averageElevation}set averageElevation(t){this._averageElevation=t,this._calcFogMatrices(),this._distanceTileDataCache={}}get zoom(){return this._zoom}set zoom(t){const a=Math.min(Math.max(t,this.minZoom),this.maxZoom);this._zoom!==a&&(this._unmodified=!1,this._setZoom(a),this._updateSeaLevelZoom(),this._constrain(),this._calcMatrices())}_setZoom(t){this._zoom=t,this.scale=this.zoomScale(t),this.tileZoom=Math.floor(t),this.zoomFraction=t-this.tileZoom}_updateCameraOnTerrain(){if(!this._elevation||!this._elevation.isDataAvailableAtPoint(this.locationCoordinate(this.center)))return this._centerAltitude=0,this._seaLevelZoom=null,void(this._centerAltitudeValidForExaggeration=void 0);const t=this._elevation;this._centerAltitude=t.getAtPointOrZero(this.locationCoordinate(this.center)),this._centerAltitudeValidForExaggeration=t.exaggeration(),this._updateSeaLevelZoom()}_updateSeaLevelZoom(){this._centerAltitudeValidForExaggeration!==void 0&&(this._seaLevelZoom=this._zoomFromMercatorZ((this.pixelsPerMeter*this._centerAltitude+this.cameraToCenterDistance)/this.worldSize))}sampleAverageElevation(){if(!this._elevation)return 0;const t=this._elevation,a=[[.5,.2],[.3,.5],[.5,.5],[.7,.5],[.5,.8]],m=this.horizonLineFromTop();let v=0,b=0;for(let S=0;S<a.length;S++){const k=new n.pointGeometry(a[S][0]*this.width,m+a[S][1]*(this.height-m)),D=t.pointCoordinate(k);if(!D)continue;const O=1/Math.hypot(D[0]-this._camera.position[0],D[1]-this._camera.position[1]);v+=D[3]*O,b+=O}return b===0?NaN:v/b}get center(){return this._center}set center(t){t.lat===this._center.lat&&t.lng===this._center.lng||(this._unmodified=!1,this._center=t,this._terrainEnabled()&&(this.cameraElevationReference==="ground"?this._updateCameraOnTerrain():this._updateZoomFromElevation()),this._constrain(),this._calcMatrices())}_updateZoomFromElevation(){if(this._seaLevelZoom==null||!this._elevation)return;const t=this._seaLevelZoom,a=this._elevation.getAtPointOrZero(this.locationCoordinate(this.center)),m=this.pixelsPerMeter/this.worldSize*a,v=this._mercatorZfromZoom(t),b=this._mercatorZfromZoom(this._maxZoom),S=Math.max(v-m,b);this._setZoom(this._zoomFromMercatorZ(S))}get padding(){return this._edgeInsets.toJSON()}set padding(t){this._edgeInsets.equals(t)||(this._unmodified=!1,this._edgeInsets.interpolate(this._edgeInsets,t,1),this._calcMatrices())}computeZoomRelativeTo(t){const a=this.rayIntersectionCoordinate(this.pointRayIntersection(this.centerPoint,t.toAltitude()));let m;m=t.z<this._camera.position[2]?[a.x,a.y,a.z]:[t.x,t.y,t.z];const v=n.length(n.sub([],this._camera.position,m));return n.clamp(this._zoomFromMercatorZ(v),this._minZoom,this._maxZoom)}setFreeCameraOptions(t){if(!this.height||!t.position&&!t.orientation)return;this._updateCameraState();let a=!1;if(t.orientation&&!n.exactEquals(t.orientation,this._camera.orientation)&&(a=this._setCameraOrientation(t.orientation)),t.position){const m=[t.position.x,t.position.y,t.position.z];n.exactEquals$1(m,this._camera.position)||(this._setCameraPosition(m),a=!0)}a&&(this._updateStateFromCamera(),this.recenterOnTerrain())}getFreeCameraOptions(){this._updateCameraState();const t=this._camera.position,a=new ga;return a.position=new n.MercatorCoordinate(t[0],t[1],t[2]),a.orientation=this._camera.orientation,a._elevation=this.elevation,a._renderWorldCopies=this.renderWorldCopies,a}_setCameraOrientation(t){if(!n.length$1(t))return!1;n.normalize$1(t,t);const a=n.transformQuat([],[0,0,-1],t),m=n.transformQuat([],[0,-1,0],t);if(m[2]<0)return!1;const v=Tl(a,m);return!!v&&(this._camera.orientation=v,!0)}_setCameraPosition(t){const a=this.zoomScale(this.minZoom)*this.tileSize,m=this.zoomScale(this.maxZoom)*this.tileSize,v=this.cameraToCenterDistance;t[2]=n.clamp(t[2],v/m,v/a),this._camera.position=t}get centerPoint(){return this._edgeInsets.getCenter(this.width,this.height)}get fovAboveCenter(){return this._fov*(.5+this.centerOffset.y/this.height)}isPaddingEqual(t){return this._edgeInsets.equals(t)}interpolatePadding(t,a,m){this._unmodified=!1,this._edgeInsets.interpolate(t,a,m),this._constrain(),this._calcMatrices()}coveringZoomLevel(t){const a=(t.roundZoom?Math.round:Math.floor)(this.zoom+this.scaleZoom(this.tileSize/t.tileSize));return Math.max(0,a)}getVisibleUnwrappedCoordinates(t){const a=[new n.UnwrappedTileID(0,t)];if(this.renderWorldCopies){const m=this.pointCoordinate(new n.pointGeometry(0,0)),v=this.pointCoordinate(new n.pointGeometry(this.width,0)),b=this.pointCoordinate(new n.pointGeometry(this.width,this.height)),S=this.pointCoordinate(new n.pointGeometry(0,this.height)),k=Math.floor(Math.min(m.x,v.x,b.x,S.x)),D=Math.floor(Math.max(m.x,v.x,b.x,S.x)),O=1;for(let V=k-O;V<=D+O;V++)V!==0&&a.push(new n.UnwrappedTileID(V,t))}return a}coveringTiles(t){let a=this.coveringZoomLevel(t);const m=a,v=this.elevation&&!t.isTerrainDEM,b=this.projection.name==="mercator";if(t.minzoom!==void 0&&a<t.minzoom)return[];t.maxzoom!==void 0&&a>t.maxzoom&&(a=t.maxzoom);const S=this.locationCoordinate(this.center),k=this.center.lat,D=1<<a,O=[D*S.x,D*S.y,0],V=this.projection.name==="globe",G=!V,X=n.Frustum.fromInvProjectionMatrix(this.invProjMatrix,this.worldSize,a,G),J=V?this._camera.mercatorPosition:this.pointCoordinate(this.getCameraPoint()),ee=D*n.mercatorZfromAltitude(1,this.center.lat),Y=this._camera.position[2]/n.mercatorZfromAltitude(1,this.center.lat),pe=[D*J.x,D*J.y,Y*(G?1:ee)],K=this.cameraToCenterDistance/t.tileSize*(t.roundZoom?1:.502),ne=this.pitch<=60&&this._edgeInsets.top<=this._edgeInsets.bottom&&!this._elevation&&!this.projection.isReprojectedInTileSpace?a:0,oe=t.isTerrainDEM&&this._elevation?1e4*this._elevation.exaggeration():this._centerAltitude,ge=t.isTerrainDEM?-oe:this._elevation?this._elevation.getMinElevationBelowMSL():0,he=this.projection.isReprojectedInTileSpace?un(this):1,fe=Ke=>{const vt=new n.MercatorCoordinate(Ke.x+25e-6,Ke.y,Ke.z),yt=new n.MercatorCoordinate(Ke.x,Ke.y+25e-6,Ke.z),ut=Ke.toLngLat(),gt=vt.toLngLat(),Xt=yt.toLngLat(),Vt=this.locationCoordinate(ut),oi=this.locationCoordinate(gt),Ot=this.locationCoordinate(Xt),ii=Math.hypot(oi.x-Vt.x,oi.y-Vt.y),Si=Math.hypot(Ot.x-Vt.x,Ot.y-Vt.y);return Math.sqrt(ii*Si)*he/25e-6},be=Ke=>{const Ft=oe,vt=ge;return{aabb:n.tileAABB(this,D,0,0,0,Ke,vt,Ft,this.projection),zoom:0,x:0,y:0,minZ:vt,maxZ:Ft,wrap:Ke,fullyVisible:!1}},Ve=[];let Ze=[];const je=a,Ue=t.reparseOverscaled?m:a,_e=Ke=>Ke*Ke,rt=_e((Y-this._centerAltitude)*ee),it=Ke=>{if(!this._elevation||!Ke.tileID||!b)return;const Ft=this._elevation.getMinMaxForTile(Ke.tileID),vt=Ke.aabb;Ft?(vt.min[2]=Ft.min,vt.max[2]=Ft.max,vt.center[2]=(vt.min[2]+vt.max[2])/2):(Ke.shouldSplit=Et(Ke),Ke.shouldSplit||(vt.min[2]=vt.max[2]=vt.center[2]=this._centerAltitude))},Et=Ke=>{if(Ke.zoom<ne)return!0;if(Ke.zoom===je)return!1;if(Ke.shouldSplit!=null)return Ke.shouldSplit;const Ft=Ke.aabb.distanceX(pe),vt=Ke.aabb.distanceY(pe);let yt=rt,ut=1;if(V){yt=_e(Ke.aabb.distanceZ(pe));const Xt=Math.pow(2,Ke.zoom),Vt=n.latFromMercatorY((Ke.y+1)/Xt),oi=n.latFromMercatorY(Ke.y/Xt),Ot=Math.min(Math.max(k,Vt),oi),ii=n.circumferenceAtLatitude(Ot)/n.circumferenceAtLatitude(k);if(ut=Ot===k?1/Math.max(1,this._mercatorScaleRatio-.3):Math.min(1,ii/this._mercatorScaleRatio),this.zoom<=n.GLOBE_ZOOM_THRESHOLD_MIN&&Ke.zoom===je-1&&ii>=.9)return!0}else if(v&&(yt=_e(Ke.aabb.distanceZ(pe)*ee)),this.projection.isReprojectedInTileSpace&&m<=5){const Xt=Math.pow(2,Ke.zoom),Vt=fe(new n.MercatorCoordinate((Ke.x+.5)/Xt,(Ke.y+.5)/Xt));ut=Vt>.85?1:Vt}const gt=Ft*Ft+vt*vt+yt;return gt<_e((1<<je-Ke.zoom)*K*ut*((Xt,Vt)=>{if(Vt*_e(.707)<Xt)return 1;const oi=Math.sqrt(Vt/Xt);return oi/(1.4144271570014144+(Math.pow(1.1,oi-1.4144271570014144+1)-1)/(1.1-1)-1)})(Math.max(yt,rt),gt))};if(this.renderWorldCopies)for(let Ke=1;Ke<=3;Ke++)Ve.push(be(-Ke)),Ve.push(be(Ke));for(Ve.push(be(0));Ve.length>0;){const Ke=Ve.pop(),Ft=Ke.x,vt=Ke.y;let yt=Ke.fullyVisible;if(!yt){const ut=Ke.aabb.intersects(X);if(ut===0)continue;yt=ut===2}if(Ke.zoom!==je&&Et(Ke))for(let ut=0;ut<4;ut++){const gt=(Ft<<1)+ut%2,Xt=(vt<<1)+(ut>>1),Vt={aabb:b?Ke.aabb.quadrant(ut):n.tileAABB(this,D,Ke.zoom+1,gt,Xt,Ke.wrap,Ke.minZ,Ke.maxZ,this.projection),zoom:Ke.zoom+1,x:gt,y:Xt,wrap:Ke.wrap,fullyVisible:yt,tileID:void 0,shouldSplit:void 0,minZ:Ke.minZ,maxZ:Ke.maxZ};v&&!V&&(Vt.tileID=new n.OverscaledTileID(Ke.zoom+1===je?Ue:Ke.zoom+1,Ke.wrap,Ke.zoom+1,gt,Xt),it(Vt)),Ve.push(Vt)}else{const ut=Ke.zoom===je?Ue:Ke.zoom;if(t.minzoom&&t.minzoom>ut)continue;const gt=O[0]-(.5+Ft+(Ke.wrap<<Ke.zoom))*(1<<a-Ke.zoom),Xt=O[1]-.5-vt,Vt=Ke.tileID?Ke.tileID:new n.OverscaledTileID(ut,Ke.wrap,Ke.zoom,Ft,vt);Ze.push({tileID:Vt,distanceSq:gt*gt+Xt*Xt})}}if(this.fogCullDistSq){const Ke=this.fogCullDistSq,Ft=this.horizonLineFromTop();Ze=Ze.filter(vt=>{const yt=[0,0,0,1],ut=[n.EXTENT,n.EXTENT,0,1],gt=this.calculateFogTileMatrix(vt.tileID.toUnwrapped());n.transformMat4$1(yt,yt,gt),n.transformMat4$1(ut,ut,gt);const Xt=n.getAABBPointSquareDist(yt,ut);if(Xt===0)return!0;let Vt=!1;const oi=this._elevation;if(oi&&Xt>Ke&&Ft!==0){const Ot=this.calculateProjMatrix(vt.tileID.toUnwrapped());let ii;t.isTerrainDEM||(ii=oi.getMinMaxForTile(vt.tileID)),ii||(ii={min:ge,max:oe});const Si=n.furthestTileCorner(this.rotation),zi=[Si[0]*n.EXTENT,Si[1]*n.EXTENT,ii.max];n.transformMat4(zi,zi,Ot),Vt=(1-zi[1])*this.height*.5<Ft}return Xt<Ke||Vt})}return Ze.sort((Ke,Ft)=>Ke.distanceSq-Ft.distanceSq).map(Ke=>Ke.tileID)}resize(t,a){this.width=t,this.height=a,this.pixelsToGLUnits=[2/t,-2/a],this._constrain(),this._calcMatrices()}get unmodified(){return this._unmodified}zoomScale(t){return Math.pow(2,t)}scaleZoom(t){return Math.log(t)/Math.LN2}project(t){const a=n.clamp(t.lat,-n.MAX_MERCATOR_LATITUDE,n.MAX_MERCATOR_LATITUDE),m=this.projection.project(t.lng,a);return new n.pointGeometry(m.x*this.worldSize,m.y*this.worldSize)}unproject(t){return this.projection.unproject(t.x/this.worldSize,t.y/this.worldSize)}get point(){return this.project(this.center)}setLocationAtPoint(t,a){let m,v;const b=this.centerPoint;if(this.projection.name==="globe"){const k=this.worldSize;m=(a.x-b.x)/k,v=(a.y-b.y)/k}else{const k=this.pointCoordinate(a),D=this.pointCoordinate(b);m=k.x-D.x,v=k.y-D.y}const S=this.locationCoordinate(t);this.setLocation(new n.MercatorCoordinate(S.x-m,S.y-v))}setLocation(t){this.center=this.coordinateLocation(t),this.projection.wrap&&(this.center=this.center.wrap())}locationPoint(t){return this.projection.locationPoint(this,t)}locationPoint3D(t){return this.projection.locationPoint(this,t,!0)}pointLocation(t){return this.coordinateLocation(this.pointCoordinate(t))}pointLocation3D(t){return this.coordinateLocation(this.pointCoordinate3D(t))}locationCoordinate(t,a){const m=a?n.mercatorZfromAltitude(a,t.lat):void 0,v=this.projection.project(t.lng,t.lat);return new n.MercatorCoordinate(v.x,v.y,m)}coordinateLocation(t){return this.projection.unproject(t.x,t.y)}pointRayIntersection(t,a){const m=a!=null?a:this._centerAltitude,v=[t.x,t.y,0,1],b=[t.x,t.y,1,1];n.transformMat4$1(v,v,this.pixelMatrixInverse),n.transformMat4$1(b,b,this.pixelMatrixInverse);const S=b[3];n.scale$1(v,v,1/v[3]),n.scale$1(b,b,1/S);const k=v[2],D=b[2];return{p0:v,p1:b,t:k===D?0:(m-k)/(D-k)}}screenPointToMercatorRay(t){const a=[t.x,t.y,0,1],m=[t.x,t.y,1,1];return n.transformMat4$1(a,a,this.pixelMatrixInverse),n.transformMat4$1(m,m,this.pixelMatrixInverse),n.scale$1(a,a,1/a[3]),n.scale$1(m,m,1/m[3]),a[2]=n.mercatorZfromAltitude(a[2],this._center.lat)*this.worldSize,m[2]=n.mercatorZfromAltitude(m[2],this._center.lat)*this.worldSize,n.scale$1(a,a,1/this.worldSize),n.scale$1(m,m,1/this.worldSize),new n.Ray([a[0],a[1],a[2]],n.normalize([],n.sub([],m,a)))}rayIntersectionCoordinate(t){const{p0:a,p1:m,t:v}=t,b=n.mercatorZfromAltitude(a[2],this._center.lat),S=n.mercatorZfromAltitude(m[2],this._center.lat);return new n.MercatorCoordinate(n.number(a[0],m[0],v)/this.worldSize,n.number(a[1],m[1],v)/this.worldSize,n.number(b,S,v))}pointCoordinate(t,a=this._centerAltitude){return this.projection.pointCoordinate(this,t.x,t.y,a)}pointCoordinate3D(t){if(!this.elevation)return this.pointCoordinate(t);let a=this.projection.pointCoordinate3D(this,t.x,t.y);if(a)return new n.MercatorCoordinate(a[0],a[1],a[2]);let m=0,v=this.horizonLineFromTop();if(t.y>v)return this.pointCoordinate(t);const b=.02*v,S=t.clone();for(let k=0;k<10&&v-m>b;k++){S.y=n.number(m,v,.66);const D=this.projection.pointCoordinate3D(this,S.x,S.y);D?(v=S.y,a=D):m=S.y}return a?new n.MercatorCoordinate(a[0],a[1],a[2]):this.pointCoordinate(t)}isPointAboveHorizon(t){return this.projection.isPointAboveHorizon(this,t)}_coordinatePoint(t,a){const m=a&&this.elevation?this.elevation.getAtPointOrZero(t,this._centerAltitude):this._centerAltitude,v=[t.x*this.worldSize,t.y*this.worldSize,m+t.toAltitude(),1];return n.transformMat4$1(v,v,this.pixelMatrix),v[3]>0?new n.pointGeometry(v[0]/v[3],v[1]/v[3]):new n.pointGeometry(Number.MAX_VALUE,Number.MAX_VALUE)}_getBounds(t,a){const m=new n.pointGeometry(this._edgeInsets.left,this._edgeInsets.top),v=new n.pointGeometry(this.width-this._edgeInsets.right,this._edgeInsets.top),b=new n.pointGeometry(this.width-this._edgeInsets.right,this.height-this._edgeInsets.bottom),S=new n.pointGeometry(this._edgeInsets.left,this.height-this._edgeInsets.bottom);let k=this.pointCoordinate(m,t),D=this.pointCoordinate(v,t);const O=this.pointCoordinate(b,a),V=this.pointCoordinate(S,a),G=(X,J)=>(J.y-X.y)/(J.x-X.x);return k.y>1&&D.y>=0?k=new n.MercatorCoordinate((1-V.y)/G(V,k)+V.x,1):k.y<0&&D.y<=1&&(k=new n.MercatorCoordinate(-V.y/G(V,k)+V.x,0)),D.y>1&&k.y>=0?D=new n.MercatorCoordinate((1-O.y)/G(O,D)+O.x,1):D.y<0&&k.y<=1&&(D=new n.MercatorCoordinate(-O.y/G(O,D)+O.x,0)),new n.LngLatBounds().extend(this.coordinateLocation(k)).extend(this.coordinateLocation(D)).extend(this.coordinateLocation(V)).extend(this.coordinateLocation(O))}_getBounds3D(){const t=this.elevation;if(!t.visibleDemTiles.length)return this._getBounds(0,0);const a=t.visibleDemTiles.reduce((m,v)=>{if(v.dem){const b=v.dem.tree;m.min=Math.min(m.min,b.minimums[0]),m.max=Math.max(m.max,b.maximums[0])}return m},{min:Number.MAX_VALUE,max:0});return this._getBounds(a.min*t.exaggeration(),a.max*t.exaggeration())}getBounds(){return this._terrainEnabled()?this._getBounds3D():this._getBounds(0,0)}horizonLineFromTop(t=!0){const a=this.height/2/Math.tan(this._fov/2)/Math.tan(Math.max(this._pitch,.1))+this.centerOffset.y,m=this.height/2-a*(1-this._horizonShift);return t?Math.max(0,m):m}getMaxBounds(){return this.maxBounds}setMaxBounds(t){this.maxBounds=t,this.minLat=-n.MAX_MERCATOR_LATITUDE,this.maxLat=n.MAX_MERCATOR_LATITUDE,this.minLng=-180,this.maxLng=180,t&&(this.minLat=t.getSouth(),this.maxLat=t.getNorth(),this.minLng=t.getWest(),this.maxLng=t.getEast(),this.maxLng<this.minLng&&(this.maxLng+=360)),this.worldMinX=n.mercatorXfromLng(this.minLng)*this.tileSize,this.worldMaxX=n.mercatorXfromLng(this.maxLng)*this.tileSize,this.worldMinY=n.mercatorYfromLat(this.maxLat)*this.tileSize,this.worldMaxY=n.mercatorYfromLat(this.minLat)*this.tileSize,this._constrain()}calculatePosMatrix(t,a){return this.projection.createTileMatrix(this,a,t)}calculateDistanceTileData(t){const a=t.key,m=this._distanceTileDataCache;if(m[a])return m[a];const v=t.canonical,b=1/this.height,S=this.cameraWorldSize/this.zoomScale(v.z),k=(v.x+Math.pow(2,v.z)*t.wrap)*S,D=v.y*S,O=this.point,V=this.angle,G=Math.sin(-V),X=-Math.cos(-V);return m[a]={bearing:[G,X],center:[(O.x-k)*b,(O.y-D)*b],scale:S/n.EXTENT*b},m[a]}calculateFogTileMatrix(t){const a=t.key,m=this._fogTileMatrixCache;if(m[a])return m[a];const v=this.projection.createTileMatrix(this,this.cameraWorldSize,t);return n.multiply(v,this.worldToFogMatrix,v),m[a]=new Float32Array(v),m[a]}calculateProjMatrix(t,a=!1){const m=t.key,v=a?this._alignedProjMatrixCache:this._projMatrixCache;if(v[m])return v[m];const b=this.calculatePosMatrix(t,this.worldSize);return n.multiply(b,this.projection.isReprojectedInTileSpace?this.mercatorMatrix:a?this.alignedProjMatrix:this.projMatrix,b),v[m]=new Float32Array(b),v[m]}calculatePixelsToTileUnitsMatrix(t){const a=t.tileID.key,m=this._pixelsToTileUnitsCache;if(m[a])return m[a];const v=function(b,S){const{scale:k}=b.tileTransform,D=k*n.EXTENT/(b.tileSize*Math.pow(2,S.zoom-b.tileID.overscaledZ+b.tileID.canonical.z));return O=new Float32Array(4),X=(V=S.inverseAdjustmentMatrix)[1],J=V[2],ee=V[3],pe=(G=[D,D])[1],O[0]=V[0]*(Y=G[0]),O[1]=X*Y,O[2]=J*pe,O[3]=ee*pe,O;var O,V,G,X,J,ee,Y,pe}(t,this);return m[a]=v,m[a]}customLayerMatrix(){return this.mercatorMatrix.slice()}recenterOnTerrain(){if(!this._elevation||this.projection.name==="globe")return;const t=this._elevation;this._updateCameraState();const a=n.mercatorZfromAltitude(1,this._center.lat)*this.worldSize,m=this._computeCameraPosition(a),v=this._camera.forward(),b=n.mercatorZfromAltitude(1,this._center.lat);m[2]/=b,v[2]/=b,n.normalize(v,v);const S=t.raycast(m,v,t.exaggeration());if(S){const k=n.scaleAndAdd([],m,v,S),D=new n.MercatorCoordinate(k[0],k[1],n.mercatorZfromAltitude(k[2],n.latFromMercatorY(k[1]))),O=(D.z+n.length([D.x-m[0],D.y-m[1],D.z-m[2]*b]))*this._projectionScaler;this._seaLevelZoom=this._zoomFromMercatorZ(O),this._centerAltitude=D.toAltitude(),this._center=this.coordinateLocation(D),this._updateZoomFromElevation(),this._constrain(),this._calcMatrices()}}_constrainCameraAltitude(){if(!this._elevation)return;const t=this._elevation;this._updateCameraState();const a=n.mercatorZfromAltitude(1,this._center.lat)*this.worldSize,m=this._computeCameraPosition(a),v=t.getAtPointOrZero(new n.MercatorCoordinate(...m)),b=this._minimumHeightOverTerrain()*Math.cos(n.degToRad(this._maxPitch)),S=this._camera.position[2]-this.pixelsPerMeter/this.worldSize*v;if(S<b){const k=this.locationCoordinate(this._center,this._centerAltitude),D=[k.x-m[0],k.y-m[1],k.z-m[2]],O=n.length(D);D[2]-=(b-S)/this._projectionScaler;const V=n.length(D);if(V===0)return;n.scale$2(D,D,O/V*this._projectionScaler),this._camera.position=[k.x-D[0],k.y-D[1],k.z*this._projectionScaler-D[2]],this._camera.orientation=Tl(D,this._camera.up()),this._updateStateFromCamera()}}_constrain(){if(!this.center||!this.width||!this.height||this._constraining)return;if(this._constraining=!0,this.projection.isReprojectedInTileSpace){const G=this.center;return G.lat=n.clamp(G.lat,this.minLat,this.maxLat),!this.maxBounds&&this.renderWorldCopies||(G.lng=n.clamp(G.lng,this.minLng,this.maxLng)),this.center=G,void(this._constraining=!1)}const t=this._unmodified,{x:a,y:m}=this.point;let v=0,b=a,S=m;const k=this.width/2,D=this.height/2,O=this.worldMinY*this.scale,V=this.worldMaxY*this.scale;if(m-D<O&&(S=O+D),m+D>V&&(S=V-D),V-O<this.height&&(v=Math.max(v,this.height/(V-O)),S=(V+O)/2),this.maxBounds||!this._renderWorldCopies||!this.projection.wrap){const G=this.worldMinX*this.scale,X=this.worldMaxX*this.scale,J=this.worldSize/2-(G+X)/2;b=(a+J+this.worldSize)%this.worldSize-J,b-k<G&&(b=G+k),b+k>X&&(b=X-k),X-G<this.width&&(v=Math.max(v,this.width/(X-G)),b=(X+G)/2)}b===a&&S===m||(this.center=this.unproject(new n.pointGeometry(b,S))),v&&(this.zoom+=this.scaleZoom(v)),this._constrainCameraAltitude(),this._unmodified=t,this._constraining=!1}_minZoomForBounds(){let t=Math.max(0,this.scaleZoom(this.height/(this.worldMaxY-this.worldMinY)));return this.maxBounds&&(t=Math.max(t,this.scaleZoom(this.width/(this.worldMaxX-this.worldMinX)))),t}_maxCameraBoundsDistance(){return this._mercatorZfromZoom(this._minZoomForBounds())}_calcMatrices(){if(!this.height)return;const t=this.centerOffset,a=this.pixelsPerMeter;if(this.projection.name==="globe"){const he=n.mercatorZfromAltitude(1,this.center.lat)*this.worldSize,fe=n.mercatorZfromAltitude(1,n.GLOBE_SCALE_MATCH_LATITUDE)*this.worldSize;this._mercatorScaleRatio=he/fe}const m=ya(this.projection,this.zoom,this.width,this.height,1024);this._projectionScaler=this.projection.pixelSpaceConversion(this.center.lat,this.worldSize,m),this.cameraToCenterDistance=this.getCameraToCenterDistance(this.projection),this._updateCameraState(),this._farZ=this.projection.farthestPixelDistance(this),this._nearZ=this.height/50;const v=this._camera.getWorldToCamera(this.worldSize,this.projection.zAxisUnit==="meters"?a:1),b=this._camera.getCameraToClipPerspective(this._fov,this.width/this.height,this._nearZ,this._farZ);b[8]=2*-t.x/this.width,b[9]=2*t.y/this.height;let S=n.mul([],b,v);if(this.projection.isReprojectedInTileSpace){const he=this.locationCoordinate(this.center),fe=n.identity([]);n.translate(fe,fe,[he.x*this.worldSize,he.y*this.worldSize,0]),n.multiply(fe,fe,kt(this)),n.translate(fe,fe,[-he.x*this.worldSize,-he.y*this.worldSize,0]),n.multiply(S,S,fe),this.inverseAdjustmentMatrix=function(be){const Ve=kt(be,!0);return ze([],[Ve[0],Ve[1],Ve[4],Ve[5]])}(this)}else this.inverseAdjustmentMatrix=[1,0,0,1];this.mercatorMatrix=n.scale([],S,[this.worldSize,this.worldSize,this.worldSize/a,1]),this.projMatrix=S,this.invProjMatrix=n.invert(new Float64Array(16),this.projMatrix);const k=n.invert([],b);this.frustumCorners=n.FrustumCorners.fromInvProjectionMatrix(k,this.horizonLineFromTop(),this.height);const D=new Float32Array(16);n.identity(D),n.scale(D,D,[1,-1,1]),n.rotateX(D,D,this._pitch),n.rotateZ(D,D,this.angle);const O=n.perspective(new Float32Array(16),this._fov,this.width/this.height,this._nearZ,this._farZ),V=(Math.PI/2-this._pitch)*(this.height/this._fov)*this._horizonShift;O[8]=2*-t.x/this.width,O[9]=2*(t.y+V)/this.height,this.skyboxMatrix=n.multiply(D,O,D);const G=this.point,X=G.x,J=G.y,ee=this.width%2/2,Y=this.height%2/2,pe=Math.cos(this.angle),K=Math.sin(this.angle),ne=X-Math.round(X)+pe*ee+K*Y,oe=J-Math.round(J)+pe*Y+K*ee,ge=new Float64Array(S);if(n.translate(ge,ge,[ne>.5?ne-1:ne,oe>.5?oe-1:oe,0]),this.alignedProjMatrix=ge,S=n.create(),n.scale(S,S,[this.width/2,-this.height/2,1]),n.translate(S,S,[1,-1,0]),this.labelPlaneMatrix=S,S=n.create(),n.scale(S,S,[1,-1,1]),n.translate(S,S,[-1,-1,0]),n.scale(S,S,[2/this.width,2/this.height,1]),this.glCoordMatrix=S,this.pixelMatrix=n.multiply(new Float64Array(16),this.labelPlaneMatrix,this.projMatrix),this._calcFogMatrices(),this._distanceTileDataCache={},S=n.invert(new Float64Array(16),this.pixelMatrix),!S)throw new Error("failed to invert matrix");if(this.pixelMatrixInverse=S,this.projection.name==="globe"||this.mercatorFromTransition){this.globeMatrix=n.calculateGlobeMatrix(this);const he=[this.globeMatrix[12],this.globeMatrix[13],this.globeMatrix[14]];this.globeCenterInViewSpace=n.transformMat4(he,he,v),this.globeRadius=this.worldSize/2/Math.PI-1}else this.globeMatrix=S;this._projMatrixCache={},this._alignedProjMatrixCache={},this._pixelsToTileUnitsCache={}}_calcFogMatrices(){this._fogTileMatrixCache={};const t=this.cameraWorldSize,a=this.cameraPixelsPerMeter,m=this._camera.position,v=1/this.height/this._projectionScaler,b=[t,t,a];n.scale$2(b,b,v),n.scale$2(m,m,-1),n.multiply$2(m,m,b);const S=n.create();n.translate(S,S,m),n.scale(S,S,b),this.mercatorFogMatrix=S,this.worldToFogMatrix=this._camera.getWorldToCameraPosition(t,a,v)}_computeCameraPosition(t){const a=(t=t||this.pixelsPerMeter)/this.pixelsPerMeter,m=this._camera.forward(),v=this.point,b=this._mercatorZfromZoom(this._seaLevelZoom?this._seaLevelZoom:this._zoom)*a-t/this.worldSize*this._centerAltitude;return[v.x/this.worldSize-m[0]*b,v.y/this.worldSize-m[1]*b,t/this.worldSize*this._centerAltitude-m[2]*b]}_updateCameraState(){this.height&&(this._camera.setPitchBearing(this._pitch,this.angle),this._camera.position=this._computeCameraPosition())}_translateCameraConstrained(t){const a=this._maxCameraBoundsDistance()*Math.cos(this._pitch),m=t[2];let v=1;m>0&&(v=Math.min((a-this._camera.position[2])/m,1)),this._camera.position=n.scaleAndAdd([],this._camera.position,t,v),this._updateStateFromCamera(),this.projection.wrap&&(this.center=this.center.wrap())}_updateStateFromCamera(){const t=this._camera.position,a=this._camera.forward(),{pitch:m,bearing:v}=this._camera.getPitchBearing(),b=n.mercatorZfromAltitude(this._centerAltitude,this.center.lat)*this._projectionScaler,S=this._mercatorZfromZoom(this._maxZoom)*Math.cos(n.degToRad(this._maxPitch)),k=Math.max((t[2]-b)/Math.cos(m),S),D=this._zoomFromMercatorZ(k);n.scaleAndAdd(t,t,a,k),this._pitch=n.clamp(m,n.degToRad(this.minPitch),n.degToRad(this.maxPitch)),this.angle=n.wrap(v,-Math.PI,Math.PI),this._setZoom(n.clamp(D,this._minZoom,this._maxZoom)),this._updateSeaLevelZoom(),this._center=this.coordinateLocation(new n.MercatorCoordinate(t[0],t[1],t[2])),this._unmodified=!1,this._constrain(),this._calcMatrices()}_worldSizeFromZoom(t){return Math.pow(2,t)*this.tileSize}_mercatorZfromZoom(t){return this.cameraToCenterDistance/this._worldSizeFromZoom(t)}_minimumHeightOverTerrain(){const t=Math.min((this._seaLevelZoom!=null?this._seaLevelZoom:this._zoom)+2,this._maxZoom);return this._mercatorZfromZoom(t)}_zoomFromMercatorZ(t){return this.scaleZoom(this.cameraToCenterDistance/(t*this.tileSize))}_terrainEnabled(){return!(!this._elevation||!this.projection.supportsTerrain&&(n.warnOnce("Terrain is not yet supported with alternate projections. Use mercator or globe to enable terrain."),1))}anyCornerOffEdge(t,a){const m=Math.min(t.x,a.x),v=Math.max(t.x,a.x),b=Math.min(t.y,a.y),S=Math.max(t.y,a.y);if(b<this.horizonLineFromTop(!1))return!0;if(this.projection.name!=="mercator")return!1;const k=[new n.pointGeometry(m,b),new n.pointGeometry(v,S),new n.pointGeometry(m,S),new n.pointGeometry(v,b)],D=this.renderWorldCopies?-3:0,O=this.renderWorldCopies?4:1;for(const V of k){const G=this.pointRayIntersection(V);if(G.t<0)return!0;const X=this.rayIntersectionCoordinate(G);if(X.x<D||X.y<0||X.x>O||X.y>1)return!0}return!1}isHorizonVisible(){return this.pitch+n.radToDeg(this.fovAboveCenter)>88||this.anyCornerOffEdge(new n.pointGeometry(0,0),new n.pointGeometry(this.width,this.height))}zoomDeltaToMovement(t,a){const m=n.length(n.sub([],this._camera.position,t)),v=this._zoomFromMercatorZ(m)+a;return m-this._mercatorZfromZoom(v)}getCameraPoint(){if(this.projection.name==="globe"){const t=function(a,m){const v=[a[0],a[1],a[2],1];n.transformMat4$1(v,v,m);const b=Math.max(v[3],1e-6);return[v[0]/b,v[1]/b,v[2]/b,b]}([this.globeMatrix[12],this.globeMatrix[13],this.globeMatrix[14]],this.pixelMatrix);return new n.pointGeometry(t[0],t[1])}{const t=Math.tan(this._pitch)*(this.cameraToCenterDistance||1);return this.centerPoint.add(new n.pointGeometry(0,t))}}getCameraToCenterDistance(t){const a=ya(t,this.zoom,this.width,this.height,1024),m=t.pixelSpaceConversion(this.center.lat,this.worldSize,a);return .5/Math.tan(.5*this._fov)*this.height*m}}function va(p,t){let a=!1,m=null;const v=()=>{m=null,a&&(p(),m=setTimeout(v,t),a=!1)};return()=>(a=!0,m||v(),m)}class Bc{constructor(t){this._hashName=t&&encodeURIComponent(t),n.bindAll(["_getCurrentHash","_onHashChange","_updateHash"],this),this._updateHash=va(this._updateHashUnthrottled.bind(this),300)}addTo(t){return this._map=t,n.window.addEventListener("hashchange",this._onHashChange,!1),t.on("moveend",this._updateHash),this}remove(){return this._map?(this._map.off("moveend",this._updateHash),n.window.removeEventListener("hashchange",this._onHashChange,!1),clearTimeout(this._updateHash()),this._map=void 0,this):this}getHashString(t){const a=this._map;if(!a)return"";const m=a.getCenter(),v=Math.round(100*a.getZoom())/100,b=Math.ceil((v*Math.LN2+Math.log(512/360/.5))/Math.LN10),S=Math.pow(10,b),k=Math.round(m.lng*S)/S,D=Math.round(m.lat*S)/S,O=a.getBearing(),V=a.getPitch();let G="";if(G+=t?`/${k}/${D}/${v}`:`${v}/${D}/${k}`,(O||V)&&(G+="/"+Math.round(10*O)/10),V&&(G+=`/${Math.round(V)}`),this._hashName){const X=this._hashName;let J=!1;const ee=n.window.location.hash.slice(1).split("&").map(Y=>{const pe=Y.split("=")[0];return pe===X?(J=!0,`${pe}=${G}`):Y}).filter(Y=>Y);return J||ee.push(`${X}=${G}`),`#${ee.join("&")}`}return`#${G}`}_getCurrentHash(){const t=n.window.location.hash.replace("#","");if(this._hashName){let a;return t.split("&").map(m=>m.split("=")).forEach(m=>{m[0]===this._hashName&&(a=m)}),(a&&a[1]||"").split("/")}return t.split("/")}_onHashChange(){const t=this._map;if(!t)return!1;const a=this._getCurrentHash();if(a.length>=3&&!a.some(m=>isNaN(m))){const m=t.dragRotate.isEnabled()&&t.touchZoomRotate.isEnabled()?+(a[3]||0):t.getBearing();return t.jumpTo({center:[+a[2],+a[1]],zoom:+a[0],bearing:m,pitch:+(a[4]||0)}),!0}return!1}_updateHashUnthrottled(){const t=n.window.location.href.replace(/(#.+)?$/,this.getHashString());n.window.history.replaceState(n.window.history.state,null,t)}}const Wo={linearity:.3,easing:n.bezier(0,0,.3,1)},ph=n.extend({deceleration:2500,maxSpeed:1400},Wo),fh=n.extend({deceleration:20,maxSpeed:1400},Wo),Es=n.extend({deceleration:1e3,maxSpeed:360},Wo),mf=n.extend({deceleration:1e3,maxSpeed:90},Wo);class _f{constructor(t){this._map=t,this.clear()}clear(){this._inertiaBuffer=[]}record(t){this._drainInertiaBuffer(),this._inertiaBuffer.push({time:n.exported.now(),settings:t})}_drainInertiaBuffer(){const t=this._inertiaBuffer,a=n.exported.now();for(;t.length>0&&a-t[0].time>160;)t.shift()}_onMoveEnd(t){if(this._drainInertiaBuffer(),this._inertiaBuffer.length<2)return;const a={zoom:0,bearing:0,pitch:0,pan:new n.pointGeometry(0,0),pinchAround:void 0,around:void 0};for(const{settings:b}of this._inertiaBuffer)a.zoom+=b.zoomDelta||0,a.bearing+=b.bearingDelta||0,a.pitch+=b.pitchDelta||0,b.panDelta&&a.pan._add(b.panDelta),b.around&&(a.around=b.around),b.pinchAround&&(a.pinchAround=b.pinchAround);const m=this._inertiaBuffer[this._inertiaBuffer.length-1].time-this._inertiaBuffer[0].time,v={};if(a.pan.mag()){const b=Xo(a.pan.mag(),m,n.extend({},ph,t||{}));v.offset=a.pan.mult(b.amount/a.pan.mag()),v.center=this._map.transform.center,xa(v,b)}if(a.zoom){const b=Xo(a.zoom,m,fh);v.zoom=this._map.transform.zoom+b.amount,xa(v,b)}if(a.bearing){const b=Xo(a.bearing,m,Es);v.bearing=this._map.transform.bearing+n.clamp(b.amount,-179,179),xa(v,b)}if(a.pitch){const b=Xo(a.pitch,m,mf);v.pitch=this._map.transform.pitch+b.amount,xa(v,b)}if(v.zoom||v.bearing){const b=a.pinchAround===void 0?a.around:a.pinchAround;v.around=b?this._map.unproject(b):this._map.getCenter()}return this.clear(),v.noMoveStart=!0,v}}function xa(p,t){(!p.duration||p.duration<t.duration)&&(p.duration=t.duration,p.easing=t.easing)}function Xo(p,t,a){const{maxSpeed:m,linearity:v,deceleration:b}=a,S=n.clamp(p*v/(t/1e3),-m,m),k=Math.abs(S)/(b*v);return{easing:a.easing,duration:1e3*k,amount:S*(k/2)}}class Or extends n.Event{preventDefault(){this._defaultPrevented=!0}get defaultPrevented(){return this._defaultPrevented}constructor(t,a,m,v={}){const b=re(a.getCanvasContainer(),m),S=a.unproject(b);super(t,n.extend({point:b,lngLat:S,originalEvent:m},v)),this._defaultPrevented=!1,this.target=a}}class ba extends n.Event{preventDefault(){this._defaultPrevented=!0}get defaultPrevented(){return this._defaultPrevented}constructor(t,a,m){const v=t==="touchend"?m.changedTouches:m.touches,b=Ae(a.getCanvasContainer(),v),S=b.map(D=>a.unproject(D)),k=b.reduce((D,O,V,G)=>D.add(O.div(G.length)),new n.pointGeometry(0,0));super(t,{points:b,point:k,lngLats:S,lngLat:a.unproject(k),originalEvent:m}),this._defaultPrevented=!1}}class dh extends n.Event{preventDefault(){this._defaultPrevented=!0}get defaultPrevented(){return this._defaultPrevented}constructor(t,a,m){super(t,{originalEvent:m}),this._defaultPrevented=!1}}class Sl{constructor(t,a){this._map=t,this._clickTolerance=a.clickTolerance}reset(){this._mousedownPos=void 0}wheel(t){return this._firePreventable(new dh(t.type,this._map,t))}mousedown(t,a){return this._mousedownPos=a,this._firePreventable(new Or(t.type,this._map,t))}mouseup(t){this._map.fire(new Or(t.type,this._map,t))}preclick(t){const a=n.extend({},t);a.type="preclick",this._map.fire(new Or(a.type,this._map,a))}click(t,a){this._mousedownPos&&this._mousedownPos.dist(a)>=this._clickTolerance||(this.preclick(t),this._map.fire(new Or(t.type,this._map,t)))}dblclick(t){return this._firePreventable(new Or(t.type,this._map,t))}mouseover(t){this._map.fire(new Or(t.type,this._map,t))}mouseout(t){this._map.fire(new Or(t.type,this._map,t))}touchstart(t){return this._firePreventable(new ba(t.type,this._map,t))}touchmove(t){this._map.fire(new ba(t.type,this._map,t))}touchend(t){this._map.fire(new ba(t.type,this._map,t))}touchcancel(t){this._map.fire(new ba(t.type,this._map,t))}_firePreventable(t){if(this._map.fire(t),t.defaultPrevented)return{}}isEnabled(){return!0}isActive(){return!1}enable(){}disable(){}}class Oc{constructor(t){this._map=t}reset(){this._delayContextMenu=!1,this._contextMenuEvent=void 0}mousemove(t){this._map.fire(new Or(t.type,this._map,t))}mousedown(){this._delayContextMenu=!0}mouseup(){this._delayContextMenu=!1,this._contextMenuEvent&&(this._map.fire(new Or("contextmenu",this._map,this._contextMenuEvent)),delete this._contextMenuEvent)}contextmenu(t){this._delayContextMenu?this._contextMenuEvent=t:this._map.fire(new Or(t.type,this._map,t)),this._map.listens("contextmenu")&&t.preventDefault()}isEnabled(){return!0}isActive(){return!1}enable(){}disable(){}}class mh{constructor(t,a){this._map=t,this._el=t.getCanvasContainer(),this._container=t.getContainer(),this._clickTolerance=a.clickTolerance||1}isEnabled(){return!!this._enabled}isActive(){return!!this._active}enable(){this.isEnabled()||(this._enabled=!0)}disable(){this.isEnabled()&&(this._enabled=!1)}mousedown(t,a){this.isEnabled()&&t.shiftKey&&t.button===0&&(ae(),this._startPos=this._lastPos=a,this._active=!0)}mousemoveWindow(t,a){if(!this._active)return;const m=a;if(this._lastPos.equals(m)||!this._box&&m.dist(this._startPos)<this._clickTolerance)return;const v=this._startPos;this._lastPos=m,this._box||(this._box=P("div","mapboxgl-boxzoom",this._container),this._container.classList.add("mapboxgl-crosshair"),this._fireEvent("boxzoomstart",t));const b=Math.min(v.x,m.x),S=Math.max(v.x,m.x),k=Math.min(v.y,m.y),D=Math.max(v.y,m.y);this._map._requestDomTask(()=>{this._box&&(this._box.style.transform=`translate(${b}px,${k}px)`,this._box.style.width=S-b+"px",this._box.style.height=D-k+"px")})}mouseupWindow(t,a){if(!this._active||t.button!==0)return;const m=this._startPos,v=a;if(this.reset(),Q(),m.x!==v.x||m.y!==v.y)return this._map.fire(new n.Event("boxzoomend",{originalEvent:t})),{cameraAnimation:b=>b.fitScreenCoordinates(m,v,this._map.getBearing(),{linear:!1})};this._fireEvent("boxzoomcancel",t)}keydown(t){this._active&&t.keyCode===27&&(this.reset(),this._fireEvent("boxzoomcancel",t))}blur(){this.reset()}reset(){this._active=!1,this._container.classList.remove("mapboxgl-crosshair"),this._box&&(this._box.remove(),this._box=null),se(),delete this._startPos,delete this._lastPos}_fireEvent(t,a){return this._map.fire(new n.Event(t,{originalEvent:a}))}}function Ml(p,t){const a={};for(let m=0;m<p.length;m++)a[p[m].identifier]=t[m];return a}class _h{constructor(t){this.reset(),this.numTouches=t.numTouches}reset(){this.centroid=void 0,this.startTime=0,this.touches={},this.aborted=!1}touchstart(t,a,m){(this.centroid||m.length>this.numTouches)&&(this.aborted=!0),this.aborted||(this.startTime===0&&(this.startTime=t.timeStamp),m.length===this.numTouches&&(this.centroid=function(v){const b=new n.pointGeometry(0,0);for(const S of v)b._add(S);return b.div(v.length)}(a),this.touches=Ml(m,a)))}touchmove(t,a,m){if(this.aborted||!this.centroid)return;const v=Ml(m,a);for(const b in this.touches){const S=this.touches[b],k=v[b];(!k||k.dist(S)>30)&&(this.aborted=!0)}}touchend(t,a,m){if((!this.centroid||t.timeStamp-this.startTime>500)&&(this.aborted=!0),m.length===0){const v=!this.aborted&&this.centroid;if(this.reset(),v)return v}}}class Il{constructor(t){this.singleTap=new _h(t),this.numTaps=t.numTaps,this.reset()}reset(){this.lastTime=1/0,this.lastTap=void 0,this.count=0,this.singleTap.reset()}touchstart(t,a,m){this.singleTap.touchstart(t,a,m)}touchmove(t,a,m){this.singleTap.touchmove(t,a,m)}touchend(t,a,m){const v=this.singleTap.touchend(t,a,m);if(v){const b=t.timeStamp-this.lastTime<500,S=!this.lastTap||this.lastTap.dist(v)<30;if(b&&S||this.reset(),this.count++,this.lastTime=t.timeStamp,this.lastTap=v,this.count===this.numTaps)return this.reset(),v}}}class gh{constructor(){this._zoomIn=new Il({numTouches:1,numTaps:2}),this._zoomOut=new Il({numTouches:2,numTaps:1}),this.reset()}reset(){this._active=!1,this._zoomIn.reset(),this._zoomOut.reset()}touchstart(t,a,m){this._zoomIn.touchstart(t,a,m),this._zoomOut.touchstart(t,a,m)}touchmove(t,a,m){this._zoomIn.touchmove(t,a,m),this._zoomOut.touchmove(t,a,m)}touchend(t,a,m){const v=this._zoomIn.touchend(t,a,m),b=this._zoomOut.touchend(t,a,m);return v?(this._active=!0,t.preventDefault(),setTimeout(()=>this.reset(),0),{cameraAnimation:S=>S.easeTo({duration:300,zoom:S.getZoom()+1,around:S.unproject(v)},{originalEvent:t})}):b?(this._active=!0,t.preventDefault(),setTimeout(()=>this.reset(),0),{cameraAnimation:S=>S.easeTo({duration:300,zoom:S.getZoom()-1,around:S.unproject(b)},{originalEvent:t})}):void 0}touchcancel(){this.reset()}enable(){this._enabled=!0}disable(){this._enabled=!1,this.reset()}isEnabled(){return this._enabled}isActive(){return this._active}}const Ts={0:1,2:2};class kl{constructor(t){this.reset(),this._clickTolerance=t.clickTolerance||1}blur(){this.reset()}reset(){this._active=!1,this._moved=!1,this._lastPoint=void 0,this._eventButton=void 0}_correctButton(t,a){return!1}_move(t,a){return{}}mousedown(t,a){if(this._lastPoint)return;const m=$e(t);this._correctButton(t,m)&&(this._lastPoint=a,this._eventButton=m)}mousemoveWindow(t,a){const m=this._lastPoint;if(m){if(t.preventDefault(),this._eventButton!=null&&function(v,b){const S=Ts[b];return v.buttons===void 0||(v.buttons&S)!==S}(t,this._eventButton))this.reset();else if(this._moved||!(a.dist(m)<this._clickTolerance))return this._moved=!0,this._lastPoint=a,this._move(m,a)}}mouseupWindow(t){this._lastPoint&&$e(t)===this._eventButton&&(this._moved&&Q(),this.reset())}enable(){this._enabled=!0}disable(){this._enabled=!1,this.reset()}isEnabled(){return this._enabled}isActive(){return this._active}}class yh extends kl{mousedown(t,a){super.mousedown(t,a),this._lastPoint&&(this._active=!0)}_correctButton(t,a){return a===0&&!t.ctrlKey}_move(t,a){return{around:a,panDelta:a.sub(t)}}}class Fc extends kl{_correctButton(t,a){return a===0&&t.ctrlKey||a===2}_move(t,a){const m=.8*(a.x-t.x);if(m)return this._active=!0,{bearingDelta:m}}contextmenu(t){t.preventDefault()}}class Uc extends kl{_correctButton(t,a){return a===0&&t.ctrlKey||a===2}_move(t,a){const m=-.5*(a.y-t.y);if(m)return this._active=!0,{pitchDelta:m}}contextmenu(t){t.preventDefault()}}class vh{constructor(t,a){this._map=t,this._el=t.getCanvasContainer(),this._minTouches=1,this._clickTolerance=a.clickTolerance||1,this.reset(),n.bindAll(["_addTouchPanBlocker","_showTouchPanBlockerAlert"],this)}reset(){this._active=!1,this._touches={},this._sum=new n.pointGeometry(0,0)}touchstart(t,a,m){return this._calculateTransform(t,a,m)}touchmove(t,a,m){if(this._active&&!(m.length<this._minTouches)){if(this._map._cooperativeGestures&&!this._map.isMoving()){if(m.length===1)return void this._showTouchPanBlockerAlert();this._alertContainer.style.visibility!=="hidden"&&(this._alertContainer.style.visibility="hidden",clearTimeout(this._alertTimer))}return t.preventDefault(),this._calculateTransform(t,a,m)}}touchend(t,a,m){this._calculateTransform(t,a,m),this._active&&m.length<this._minTouches&&this.reset()}touchcancel(){this.reset()}_calculateTransform(t,a,m){m.length>0&&(this._active=!0);const v=Ml(m,a),b=new n.pointGeometry(0,0),S=new n.pointGeometry(0,0);let k=0;for(const O in v){const V=v[O],G=this._touches[O];G&&(b._add(V),S._add(V.sub(G)),k++,v[O]=V)}if(this._touches=v,k<this._minTouches||!S.mag())return;const D=S.div(k);return this._sum._add(D),this._sum.mag()<this._clickTolerance?void 0:{around:b.div(k),panDelta:D}}enable(){this._enabled=!0,this._map._cooperativeGestures&&(this._addTouchPanBlocker(),this._el.classList.add("mapboxgl-touch-pan-blocker-override","mapboxgl-scrollable-page"))}disable(){this._enabled=!1,this._map._cooperativeGestures&&(clearTimeout(this._alertTimer),this._alertContainer.remove(),this._el.classList.remove("mapboxgl-touch-pan-blocker-override","mapboxgl-scrollable-page")),this.reset()}isEnabled(){return this._enabled}isActive(){return this._active}_addTouchPanBlocker(){this._map&&!this._alertContainer&&(this._alertContainer=P("div","mapboxgl-touch-pan-blocker",this._map._container),this._alertContainer.textContent=this._map._getUIString("TouchPanBlocker.Message"),this._alertContainer.style.fontSize=`${Math.max(10,Math.min(24,Math.floor(.05*this._el.clientWidth)))}px`)}_showTouchPanBlockerAlert(){this._alertContainer.style.visibility==="hidden"&&(this._alertContainer.style.visibility="visible"),this._alertContainer.classList.add("mapboxgl-touch-pan-blocker-show"),clearTimeout(this._alertTimer),this._alertTimer=setTimeout(()=>{this._alertContainer.classList.remove("mapboxgl-touch-pan-blocker-show")},500)}}class Cl{constructor(){this.reset()}reset(){this._active=!1,this._firstTwoTouches=void 0}_start(t){}_move(t,a,m){return{}}touchstart(t,a,m){this._firstTwoTouches||m.length<2||(this._firstTwoTouches=[m[0].identifier,m[1].identifier],this._start([a[0],a[1]]))}touchmove(t,a,m){const v=this._firstTwoTouches;if(!v)return;t.preventDefault();const[b,S]=v,k=xr(m,a,b),D=xr(m,a,S);if(!k||!D)return;const O=this._aroundCenter?null:k.add(D).div(2);return this._move([k,D],O,t)}touchend(t,a,m){if(!this._firstTwoTouches)return;const[v,b]=this._firstTwoTouches,S=xr(m,a,v),k=xr(m,a,b);S&&k||(this._active&&Q(),this.reset())}touchcancel(){this.reset()}enable(t){this._enabled=!0,this._aroundCenter=!!t&&t.around==="center"}disable(){this._enabled=!1,this.reset()}isEnabled(){return this._enabled}isActive(){return this._active}}function xr(p,t,a){for(let m=0;m<p.length;m++)if(p[m].identifier===a)return t[m]}function xh(p,t){return Math.log(p/t)/Math.LN2}class bh extends Cl{reset(){super.reset(),this._distance=0,this._startDistance=0}_start(t){this._startDistance=this._distance=t[0].dist(t[1])}_move(t,a){const m=this._distance;if(this._distance=t[0].dist(t[1]),this._active||!(Math.abs(xh(this._distance,this._startDistance))<.1))return this._active=!0,{zoomDelta:xh(this._distance,m),pinchAround:a}}}function wh(p,t){return 180*p.angleWith(t)/Math.PI}class gf extends Cl{reset(){super.reset(),this._minDiameter=0,this._startVector=void 0,this._vector=void 0}_start(t){this._startVector=this._vector=t[0].sub(t[1]),this._minDiameter=t[0].dist(t[1])}_move(t,a){const m=this._vector;if(this._vector=t[0].sub(t[1]),this._active||!this._isBelowThreshold(this._vector))return this._active=!0,{bearingDelta:wh(this._vector,m),pinchAround:a}}_isBelowThreshold(t){this._minDiameter=Math.min(this._minDiameter,t.mag());const a=25/(Math.PI*this._minDiameter)*360,m=wh(t,this._startVector);return Math.abs(m)<a}}function En(p){return Math.abs(p.y)>Math.abs(p.x)}class Eh extends Cl{constructor(t){super(),this._map=t}reset(){super.reset(),this._valid=void 0,this._firstMove=void 0,this._lastPoints=void 0}_start(t){this._lastPoints=t,En(t[0].sub(t[1]))&&(this._valid=!1)}_move(t,a,m){const v=this._lastPoints;if(!v)return;const b=t[0].sub(v[0]),S=t[1].sub(v[1]);return this._map._cooperativeGestures&&m.touches.length<3||(this._valid=this.gestureBeginsVertically(b,S,m.timeStamp),!this._valid)?void 0:(this._lastPoints=t,this._active=!0,{pitchDelta:(b.y+S.y)/2*-.5})}gestureBeginsVertically(t,a,m){if(this._valid!==void 0)return this._valid;const v=t.mag()>=2,b=a.mag()>=2;if(!v&&!b)return;if(!v||!b)return this._firstMove==null&&(this._firstMove=m),m-this._firstMove<100&&void 0;const S=t.y>0==a.y>0;return En(t)&&En(a)&&S}}const As={panStep:100,bearingStep:15,pitchStep:10};class Rn{constructor(){const t=As;this._panStep=t.panStep,this._bearingStep=t.bearingStep,this._pitchStep=t.pitchStep,this._rotationDisabled=!1}blur(){this.reset()}reset(){this._active=!1}keydown(t){if(t.altKey||t.ctrlKey||t.metaKey)return;let a=0,m=0,v=0,b=0,S=0;switch(t.keyCode){case 61:case 107:case 171:case 187:a=1;break;case 189:case 109:case 173:a=-1;break;case 37:t.shiftKey?m=-1:(t.preventDefault(),b=-1);break;case 39:t.shiftKey?m=1:(t.preventDefault(),b=1);break;case 38:t.shiftKey?v=1:(t.preventDefault(),S=-1);break;case 40:t.shiftKey?v=-1:(t.preventDefault(),S=1);break;default:return}return this._rotationDisabled&&(m=0,v=0),{cameraAnimation:k=>{const D=k.getZoom();k.easeTo({duration:300,easeId:"keyboardHandler",easing:zl,zoom:a?Math.round(D)+a*(t.shiftKey?2:1):D,bearing:k.getBearing()+m*this._bearingStep,pitch:k.getPitch()+v*this._pitchStep,offset:[-b*this._panStep,-S*this._panStep],center:k.getCenter()},{originalEvent:t})}}}enable(){this._enabled=!0}disable(){this._enabled=!1,this.reset()}isEnabled(){return this._enabled}isActive(){return this._active}disableRotation(){this._rotationDisabled=!0}enableRotation(){this._rotationDisabled=!1}}function zl(p){return p*(2-p)}const Ct=4.000244140625;class Th{constructor(t,a){this._map=t,this._el=t.getCanvasContainer(),this._handler=a,this._delta=0,this._defaultZoomRate=.01,this._wheelZoomRate=.0022222222222222222,n.bindAll(["_onTimeout","_addScrollZoomBlocker","_showBlockerAlert","_isFullscreen"],this)}setZoomRate(t){this._defaultZoomRate=t}setWheelZoomRate(t){this._wheelZoomRate=t}isEnabled(){return!!this._enabled}isActive(){return!!this._active||this._finishTimeout!==void 0}isZooming(){return!!this._zooming}enable(t){this.isEnabled()||(this._enabled=!0,this._aroundCenter=!!t&&t.around==="center",this._map._cooperativeGestures&&this._addScrollZoomBlocker())}disable(){this.isEnabled()&&(this._enabled=!1,this._map._cooperativeGestures&&(clearTimeout(this._alertTimer),this._alertContainer.remove()))}wheel(t){if(!this.isEnabled())return;if(this._map._cooperativeGestures){if(!(t.ctrlKey||t.metaKey||this.isZooming()||this._isFullscreen()))return void this._showBlockerAlert();this._alertContainer.style.visibility!=="hidden"&&(this._alertContainer.style.visibility="hidden",clearTimeout(this._alertTimer))}let a=t.deltaMode===n.window.WheelEvent.DOM_DELTA_LINE?40*t.deltaY:t.deltaY;const m=n.exported.now(),v=m-(this._lastWheelEventTime||0);this._lastWheelEventTime=m,a!==0&&a%Ct==0?this._type="wheel":a!==0&&Math.abs(a)<4?this._type="trackpad":v>400?(this._type=null,this._lastValue=a,this._timeout=setTimeout(this._onTimeout,40,t)):this._type||(this._type=Math.abs(v*a)<200?"trackpad":"wheel",this._timeout&&(clearTimeout(this._timeout),this._timeout=null,a+=this._lastValue)),t.shiftKey&&a&&(a/=4),this._type&&(this._lastWheelEvent=t,this._delta-=a,this._active||this._start(t)),t.preventDefault()}_onTimeout(t){this._type="wheel",this._delta-=this._lastValue,this._active||this._start(t)}_start(t){if(!this._delta)return;this._frameId&&(this._frameId=null),this._active=!0,this.isZooming()||(this._zooming=!0),this._finishTimeout&&(clearTimeout(this._finishTimeout),delete this._finishTimeout);const a=re(this._el,t);this._aroundPoint=this._aroundCenter?this._map.transform.centerPoint:a,this._aroundCoord=this._map.transform.pointCoordinate3D(this._aroundPoint),this._targetZoom=void 0,this._frameId||(this._frameId=!0,this._handler._triggerRenderFrame())}renderFrame(){if(!this._frameId||(this._frameId=null,!this.isActive()))return;const t=this._map.transform,a=()=>t._terrainEnabled()&&this._aroundCoord?t.computeZoomRelativeTo(this._aroundCoord):t.zoom;if(this._delta!==0){const D=this._type==="wheel"&&Math.abs(this._delta)>Ct?this._wheelZoomRate:this._defaultZoomRate;let O=2/(1+Math.exp(-Math.abs(this._delta*D)));this._delta<0&&O!==0&&(O=1/O);const V=a(),G=Math.pow(2,V),X=typeof this._targetZoom=="number"?t.zoomScale(this._targetZoom):G;this._targetZoom=Math.min(t.maxZoom,Math.max(t.minZoom,t.scaleZoom(X*O))),this._type==="wheel"&&(this._startZoom=a(),this._easing=this._smoothOutEasing(200)),this._delta=0}const m=typeof this._targetZoom=="number"?this._targetZoom:a(),v=this._startZoom,b=this._easing;let S,k=!1;if(this._type==="wheel"&&v&&b){const D=Math.min((n.exported.now()-this._lastWheelEventTime)/200,1),O=b(D);S=n.number(v,m,O),D<1?this._frameId||(this._frameId=!0):k=!0}else S=m,k=!0;return this._active=!0,k&&(this._active=!1,this._finishTimeout=setTimeout(()=>{this._zooming=!1,this._handler._triggerRenderFrame(),delete this._targetZoom,delete this._finishTimeout},200)),{noInertia:!0,needsRenderFrame:!k,zoomDelta:S-a(),around:this._aroundPoint,aroundCoord:this._aroundCoord,originalEvent:this._lastWheelEvent}}_smoothOutEasing(t){let a=n.ease;if(this._prevEase){const m=this._prevEase,v=(n.exported.now()-m.start)/m.duration,b=m.easing(v+.01)-m.easing(v),S=.27/Math.sqrt(b*b+1e-4)*.01,k=Math.sqrt(.0729-S*S);a=n.bezier(S,k,.25,1)}return this._prevEase={start:n.exported.now(),duration:t,easing:a},a}blur(){this.reset()}reset(){this._active=!1}_addScrollZoomBlocker(){this._map&&!this._alertContainer&&(this._alertContainer=P("div","mapboxgl-scroll-zoom-blocker",this._map._container),this._alertContainer.textContent=/(Mac|iPad)/i.test(n.window.navigator.userAgent)?this._map._getUIString("ScrollZoomBlocker.CmdMessage"):this._map._getUIString("ScrollZoomBlocker.CtrlMessage"),this._alertContainer.style.fontSize=`${Math.max(10,Math.min(24,Math.floor(.05*this._el.clientWidth)))}px`)}_isFullscreen(){return!!n.window.document.fullscreenElement||!!n.window.document.webkitFullscreenElement}_showBlockerAlert(){this._alertContainer.style.visibility==="hidden"&&(this._alertContainer.style.visibility="visible"),this._alertContainer.classList.add("mapboxgl-scroll-zoom-blocker-show"),clearTimeout(this._alertTimer),this._alertTimer=setTimeout(()=>{this._alertContainer.classList.remove("mapboxgl-scroll-zoom-blocker-show")},200)}}class Ah{constructor(t,a){this._clickZoom=t,this._tapZoom=a}enable(){this._clickZoom.enable(),this._tapZoom.enable()}disable(){this._clickZoom.disable(),this._tapZoom.disable()}isEnabled(){return this._clickZoom.isEnabled()&&this._tapZoom.isEnabled()}isActive(){return this._clickZoom.isActive()||this._tapZoom.isActive()}}class wa{constructor(){this.reset()}reset(){this._active=!1}blur(){this.reset()}dblclick(t,a){return t.preventDefault(),{cameraAnimation:m=>{m.easeTo({duration:300,zoom:m.getZoom()+(t.shiftKey?-1:1),around:m.unproject(a)},{originalEvent:t})}}}enable(){this._enabled=!0}disable(){this._enabled=!1,this.reset()}isEnabled(){return this._enabled}isActive(){return this._active}}class Ea{constructor(){this._tap=new Il({numTouches:1,numTaps:1}),this.reset()}reset(){this._active=!1,this._swipePoint=void 0,this._swipeTouch=0,this._tapTime=0,this._tap.reset()}touchstart(t,a,m){this._swipePoint||(this._tapTime&&t.timeStamp-this._tapTime>500&&this.reset(),this._tapTime?m.length>0&&(this._swipePoint=a[0],this._swipeTouch=m[0].identifier):this._tap.touchstart(t,a,m))}touchmove(t,a,m){if(this._tapTime){if(this._swipePoint){if(m[0].identifier!==this._swipeTouch)return;const v=a[0],b=v.y-this._swipePoint.y;return this._swipePoint=v,t.preventDefault(),this._active=!0,{zoomDelta:b/128}}}else this._tap.touchmove(t,a,m)}touchend(t,a,m){this._tapTime?this._swipePoint&&m.length===0&&this.reset():this._tap.touchend(t,a,m)&&(this._tapTime=t.timeStamp)}touchcancel(){this.reset()}enable(){this._enabled=!0}disable(){this._enabled=!1,this.reset()}isEnabled(){return this._enabled}isActive(){return this._active}}class Sh{constructor(t,a,m){this._el=t,this._mousePan=a,this._touchPan=m}enable(t){this._inertiaOptions=t||{},this._mousePan.enable(),this._touchPan.enable(),this._el.classList.add("mapboxgl-touch-drag-pan")}disable(){this._mousePan.disable(),this._touchPan.disable(),this._el.classList.remove("mapboxgl-touch-drag-pan")}isEnabled(){return this._mousePan.isEnabled()&&this._touchPan.isEnabled()}isActive(){return this._mousePan.isActive()||this._touchPan.isActive()}}class Mh{constructor(t,a,m){this._pitchWithRotate=t.pitchWithRotate,this._mouseRotate=a,this._mousePitch=m}enable(){this._mouseRotate.enable(),this._pitchWithRotate&&this._mousePitch.enable()}disable(){this._mouseRotate.disable(),this._mousePitch.disable()}isEnabled(){return this._mouseRotate.isEnabled()&&(!this._pitchWithRotate||this._mousePitch.isEnabled())}isActive(){return this._mouseRotate.isActive()||this._mousePitch.isActive()}}class Ih{constructor(t,a,m,v){this._el=t,this._touchZoom=a,this._touchRotate=m,this._tapDragZoom=v,this._rotationDisabled=!1,this._enabled=!0}enable(t){this._touchZoom.enable(t),this._rotationDisabled||this._touchRotate.enable(t),this._tapDragZoom.enable(),this._el.classList.add("mapboxgl-touch-zoom-rotate")}disable(){this._touchZoom.disable(),this._touchRotate.disable(),this._tapDragZoom.disable(),this._el.classList.remove("mapboxgl-touch-zoom-rotate")}isEnabled(){return this._touchZoom.isEnabled()&&(this._rotationDisabled||this._touchRotate.isEnabled())&&this._tapDragZoom.isEnabled()}isActive(){return this._touchZoom.isActive()||this._touchRotate.isActive()||this._tapDragZoom.isActive()}disableRotation(){this._rotationDisabled=!0,this._touchRotate.disable()}enableRotation(){this._rotationDisabled=!1,this._touchZoom.isEnabled()&&this._touchRotate.enable()}}const Ta=p=>p.zoom||p.drag||p.pitch||p.rotate;class kh extends n.Event{}class Ch{constructor(){this.constants=[1,1,.01],this.radius=0}setup(t,a){const m=n.sub([],a,t);this.radius=n.length(m[2]<0?n.div([],m,this.constants):[m[0],m[1],0])}projectRay(t){n.div(t,t,this.constants),n.normalize(t,t),n.mul$1(t,t,this.constants);const a=n.scale$2([],t,this.radius);if(a[2]>0){const m=n.scale$2([],[0,0,1],n.dot(a,[0,0,1])),v=n.scale$2([],n.normalize([],[a[0],a[1],0]),this.radius),b=n.add([],a,n.scale$2([],n.sub([],n.add([],v,m),a),2));a[0]=b[0],a[1]=b[1]}return a}}function Aa(p){return p.panDelta&&p.panDelta.mag()||p.zoomDelta||p.bearingDelta||p.pitchDelta}class Pl{constructor(t,a){this._map=t,this._el=this._map.getCanvasContainer(),this._handlers=[],this._handlersById={},this._changes=[],this._inertia=new _f(t),this._bearingSnap=a.bearingSnap,this._previousActiveHandlers={},this._trackingEllipsoid=new Ch,this._dragOrigin=null,this._eventsInProgress={},this._addDefaultHandlers(a),n.bindAll(["handleEvent","handleWindowEvent"],this);const m=this._el;this._listeners=[[m,"touchstart",{passive:!0}],[m,"touchmove",{passive:!1}],[m,"touchend",void 0],[m,"touchcancel",void 0],[m,"mousedown",void 0],[m,"mousemove",void 0],[m,"mouseup",void 0],[n.window.document,"mousemove",{capture:!0}],[n.window.document,"mouseup",void 0],[m,"mouseover",void 0],[m,"mouseout",void 0],[m,"dblclick",void 0],[m,"click",void 0],[m,"keydown",{capture:!1}],[m,"keyup",void 0],[m,"wheel",{passive:!1}],[m,"contextmenu",void 0],[n.window,"blur",void 0]];for(const[v,b,S]of this._listeners)v.addEventListener(b,v===n.window.document?this.handleWindowEvent:this.handleEvent,S)}destroy(){for(const[t,a,m]of this._listeners)t.removeEventListener(a,t===n.window.document?this.handleWindowEvent:this.handleEvent,m)}_addDefaultHandlers(t){const a=this._map,m=a.getCanvasContainer();this._add("mapEvent",new Sl(a,t));const v=a.boxZoom=new mh(a,t);this._add("boxZoom",v);const b=new gh,S=new wa;a.doubleClickZoom=new Ah(S,b),this._add("tapZoom",b),this._add("clickZoom",S);const k=new Ea;this._add("tapDragZoom",k);const D=a.touchPitch=new Eh(a);this._add("touchPitch",D);const O=new Fc(t),V=new Uc(t);a.dragRotate=new Mh(t,O,V),this._add("mouseRotate",O,["mousePitch"]),this._add("mousePitch",V,["mouseRotate"]);const G=new yh(t),X=new vh(a,t);a.dragPan=new Sh(m,G,X),this._add("mousePan",G),this._add("touchPan",X,["touchZoom","touchRotate"]);const J=new gf,ee=new bh;a.touchZoomRotate=new Ih(m,ee,J,k),this._add("touchRotate",J,["touchPan","touchZoom"]),this._add("touchZoom",ee,["touchPan","touchRotate"]),this._add("blockableMapEvent",new Oc(a));const Y=a.scrollZoom=new Th(a,this);this._add("scrollZoom",Y,["mousePan"]);const pe=a.keyboard=new Rn;this._add("keyboard",pe);for(const K of["boxZoom","doubleClickZoom","tapDragZoom","touchPitch","dragRotate","dragPan","touchZoomRotate","scrollZoom","keyboard"])t.interactive&&t[K]&&a[K].enable(t[K])}_add(t,a,m){this._handlers.push({handlerName:t,handler:a,allowed:m}),this._handlersById[t]=a}stop(t){if(!this._updatingCamera){for(const{handler:a}of this._handlers)a.reset();this._inertia.clear(),this._fireEvents({},{},t),this._changes=[]}}isActive(){for(const{handler:t}of this._handlers)if(t.isActive())return!0;return!1}isZooming(){return!!this._eventsInProgress.zoom||this._map.scrollZoom.isZooming()}isRotating(){return!!this._eventsInProgress.rotate}isMoving(){return!!Ta(this._eventsInProgress)||this.isZooming()}_blockedByActive(t,a,m){for(const v in t)if(v!==m&&(!a||a.indexOf(v)<0))return!0;return!1}handleWindowEvent(t){this.handleEvent(t,`${t.type}Window`)}_getMapTouches(t){const a=[];for(const m of t)this._el.contains(m.target)&&a.push(m);return a}handleEvent(t,a){this._updatingCamera=!0;const m=t.type==="renderFrame",v=m?void 0:t,b={needsRenderFrame:!1},S={},k={},D=t.touches?this._getMapTouches(t.touches):void 0,O=D?Ae(this._el,D):m?void 0:re(this._el,t);for(const{handlerName:X,handler:J,allowed:ee}of this._handlers){if(!J.isEnabled())continue;let Y;this._blockedByActive(k,ee,X)?J.reset():J[a||t.type]&&(Y=J[a||t.type](t,O,D),this.mergeHandlerResult(b,S,Y,X,v),Y&&Y.needsRenderFrame&&this._triggerRenderFrame()),(Y||J.isActive())&&(k[X]=J)}const V={};for(const X in this._previousActiveHandlers)k[X]||(V[X]=v);this._previousActiveHandlers=k,(Object.keys(V).length||Aa(b))&&(this._changes.push([b,S,V]),this._triggerRenderFrame()),(Object.keys(k).length||Aa(b))&&this._map._stop(!0),this._updatingCamera=!1;const{cameraAnimation:G}=b;G&&(this._inertia.clear(),this._fireEvents({},{},!0),this._changes=[],G(this._map))}mergeHandlerResult(t,a,m,v,b){if(!m)return;n.extend(t,m);const S={handlerName:v,originalEvent:m.originalEvent||b};m.zoomDelta!==void 0&&(a.zoom=S),m.panDelta!==void 0&&(a.drag=S),m.pitchDelta!==void 0&&(a.pitch=S),m.bearingDelta!==void 0&&(a.rotate=S)}_applyChanges(){const t={},a={},m={};for(const[v,b,S]of this._changes)v.panDelta&&(t.panDelta=(t.panDelta||new n.pointGeometry(0,0))._add(v.panDelta)),v.zoomDelta&&(t.zoomDelta=(t.zoomDelta||0)+v.zoomDelta),v.bearingDelta&&(t.bearingDelta=(t.bearingDelta||0)+v.bearingDelta),v.pitchDelta&&(t.pitchDelta=(t.pitchDelta||0)+v.pitchDelta),v.around!==void 0&&(t.around=v.around),v.aroundCoord!==void 0&&(t.aroundCoord=v.aroundCoord),v.pinchAround!==void 0&&(t.pinchAround=v.pinchAround),v.noInertia&&(t.noInertia=v.noInertia),n.extend(a,b),n.extend(m,S);this._updateMapTransform(t,a,m),this._changes=[]}_updateMapTransform(t,a,m){const v=this._map,b=v.transform,S=ne=>[ne.x,ne.y,ne.z];if((ne=>{const oe=this._eventsInProgress.drag;return oe&&!this._handlersById[oe.handlerName].isActive()})()&&!Aa(t)){const ne=b.zoom;b.cameraElevationReference="sea",b.recenterOnTerrain(),b.cameraElevationReference="ground",ne!==b.zoom&&this._map._update(!0)}if(!Aa(t))return void this._fireEvents(a,m,!0);let{panDelta:k,zoomDelta:D,bearingDelta:O,pitchDelta:V,around:G,aroundCoord:X,pinchAround:J}=t;J!==void 0&&(G=J),(ne=>a.drag&&!this._eventsInProgress.drag)()&&G&&(this._dragOrigin=S(b.pointCoordinate3D(G)),this._trackingEllipsoid.setup(b._camera.position,this._dragOrigin)),b.cameraElevationReference="sea",v._stop(!0),G=G||v.transform.centerPoint,O&&(b.bearing+=O),V&&(b.pitch+=V),b._updateCameraState();const ee=[0,0,0];if(k){const ne=b.pointCoordinate(G);if(b.projection.name==="globe"){const oe=n.latFromMercatorY(ne.y),ge=b.center.lat,he=Math.min(n.mercatorZfromAltitude(1,oe)/n.mercatorZfromAltitude(1,ge),2);k=k.rotate(-b.angle),ee[0]=-k.x/b.worldSize*he,ee[1]=-k.y/b.worldSize*he}else{const oe=b.pointCoordinate(G.sub(k));ne&&oe&&(ee[0]=oe.x-ne.x,ee[1]=oe.y-ne.y)}}const Y=b.zoom,pe=[0,0,0];if(D){const ne=S(X||b.pointCoordinate3D(G)),oe={dir:n.normalize([],n.sub([],ne,b._camera.position))};if(oe.dir[2]<0){const ge=b.zoomDeltaToMovement(ne,D);n.scale$2(pe,oe.dir,ge)}}const K=n.add(ee,ee,pe);b._translateCameraConstrained(K),D&&Math.abs(b.zoom-Y)>1e-4&&b.recenterOnTerrain(),b.cameraElevationReference="ground",this._map._update(),t.noInertia||this._inertia.record(t),this._fireEvents(a,m,!0)}_fireEvents(t,a,m){const v=Ta(this._eventsInProgress),b=Ta(t),S={};for(const V in t){const{originalEvent:G}=t[V];this._eventsInProgress[V]||(S[`${V}start`]=G),this._eventsInProgress[V]=t[V]}!v&&b&&this._fireEvent("movestart",b.originalEvent);for(const V in S)this._fireEvent(V,S[V]);b&&this._fireEvent("move",b.originalEvent);for(const V in t){const{originalEvent:G}=t[V];this._fireEvent(V,G)}const k={};let D;for(const V in this._eventsInProgress){const{handlerName:G,originalEvent:X}=this._eventsInProgress[V];this._handlersById[G].isActive()||(delete this._eventsInProgress[V],D=a[G]||X,k[`${V}end`]=D)}for(const V in k)this._fireEvent(V,k[V]);const O=Ta(this._eventsInProgress);if(m&&(v||b)&&!O){this._updatingCamera=!0;const V=this._inertia._onMoveEnd(this._map.dragPan._inertiaOptions),G=X=>X!==0&&-this._bearingSnap<X&&X<this._bearingSnap;V?(G(V.bearing||this._map.getBearing())&&(V.bearing=0),this._map.easeTo(V,{originalEvent:D})):(this._map.fire(new n.Event("moveend",{originalEvent:D})),G(this._map.getBearing())&&this._map.resetNorth()),this._updatingCamera=!1}}_fireEvent(t,a){this._map.fire(new n.Event(t,a?{originalEvent:a}:{}))}_requestFrame(){return this._map.triggerRepaint(),this._map._renderTaskQueue.add(t=>{this._frameId=void 0,this.handleEvent(new kh("renderFrame",{timeStamp:t})),this._applyChanges()})}_triggerRenderFrame(){this._frameId===void 0&&(this._frameId=this._requestFrame())}}const Dl="map.setFreeCameraOptions(...) and map.getFreeCameraOptions() are not yet supported for non-mercator projections.";class Ll extends n.Evented{constructor(t,a){super(),this._moving=!1,this._zooming=!1,this.transform=t,this._bearingSnap=a.bearingSnap,n.bindAll(["_renderFrameCallback"],this)}getCenter(){return new n.LngLat(this.transform.center.lng,this.transform.center.lat)}setCenter(t,a){return this.jumpTo({center:t},a)}panBy(t,a,m){return t=n.pointGeometry.convert(t).mult(-1),this.panTo(this.transform.center,n.extend({offset:t},a),m)}panTo(t,a,m){return this.easeTo(n.extend({center:t},a),m)}getZoom(){return this.transform.zoom}setZoom(t,a){return this.jumpTo({zoom:t},a),this}zoomTo(t,a,m){return this.easeTo(n.extend({zoom:t},a),m)}zoomIn(t,a){return this.zoomTo(this.getZoom()+1,t,a),this}zoomOut(t,a){return this.zoomTo(this.getZoom()-1,t,a),this}getBearing(){return this.transform.bearing}setBearing(t,a){return this.jumpTo({bearing:t},a),this}getPadding(){return this.transform.padding}setPadding(t,a){return this.jumpTo({padding:t},a),this}rotateTo(t,a,m){return this.easeTo(n.extend({bearing:t},a),m)}resetNorth(t,a){return this.rotateTo(0,n.extend({duration:1e3},t),a),this}resetNorthPitch(t,a){return this.easeTo(n.extend({bearing:0,pitch:0,duration:1e3},t),a),this}snapToNorth(t,a){return Math.abs(this.getBearing())<this._bearingSnap?this.resetNorth(t,a):this}getPitch(){return this.transform.pitch}setPitch(t,a){return this.jumpTo({pitch:t},a),this}cameraForBounds(t,a){this.transform.projection.name==="globe"&&n.warnOnce('Globe projection does not support cameraForBounds API, this API may behave unexpectedly."'),t=n.LngLatBounds.convert(t);const m=a&&a.bearing||0;return this._cameraForBoxAndBearing(t.getNorthWest(),t.getSouthEast(),m,a)}_extendCameraOptions(t){const a={top:0,bottom:0,right:0,left:0};if(typeof(t=n.extend({padding:a,offset:[0,0],maxZoom:this.transform.maxZoom},t)).padding=="number"){const m=t.padding;t.padding={top:m,bottom:m,right:m,left:m}}return t.padding=n.extend(a,t.padding),t}_cameraForBoxAndBearing(t,a,m,v){const b=this._extendCameraOptions(v),S=this.transform,k=S.padding,D=S.project(n.LngLat.convert(t)),O=S.project(n.LngLat.convert(a)),V=new n.pointGeometry(D.x,O.y),G=new n.pointGeometry(O.x,D.y),X=-n.degToRad(m),J=D.rotate(X),ee=O.rotate(X),Y=V.rotate(X),pe=G.rotate(X),K=new n.pointGeometry(Math.max(J.x,ee.x,Y.x,pe.x),Math.max(J.y,ee.y,Y.y,pe.y)),ne=new n.pointGeometry(Math.min(J.x,ee.x,Y.x,pe.x),Math.min(J.y,ee.y,Y.y,pe.y)),oe=K.sub(ne),ge=(S.width-((k.left||0)+(k.right||0)+b.padding.left+b.padding.right))/oe.x,he=(S.height-((k.top||0)+(k.bottom||0)+b.padding.top+b.padding.bottom))/oe.y;if(he<0||ge<0)return void n.warnOnce("Map cannot fit within canvas with the given bounds, padding, and/or offset.");const fe=Math.min(S.scaleZoom(S.scale*Math.min(ge,he)),b.maxZoom),be=typeof b.offset.x=="number"&&typeof b.offset.y=="number"?new n.pointGeometry(b.offset.x,b.offset.y):n.pointGeometry.convert(b.offset),Ve=new n.pointGeometry((b.padding.left-b.padding.right)/2,(b.padding.top-b.padding.bottom)/2).rotate(m*Math.PI/180),Ze=be.add(Ve).mult(S.scale/S.zoomScale(fe));return{center:S.unproject(D.add(O).div(2).sub(Ze)),zoom:fe,bearing:m}}_cameraForBox(t,a,m,v,b){const S=this._extendCameraOptions(b);m=m||0,v=v||0,t=n.LngLat.convert(t),a=n.LngLat.convert(a);const k=this.transform.clone();k.padding=S.padding;const D=this.getFreeCameraOptions(),O=new n.LngLat(.5*(t.lng+a.lng),.5*(t.lat+a.lat)),V=.5*(m+v);if(k._camera.position[2]<n.mercatorZfromAltitude(V,O.lat))return void n.warnOnce("Map cannot fit within canvas with the given bounds, padding, and/or offset.");D.lookAtPoint(O),k.setFreeCameraOptions(D);const G=n.MercatorCoordinate.fromLngLat(t),X=n.MercatorCoordinate.fromLngLat(a),J=k.pointRayIntersection(k.centerPoint,V),ee=[(Y=k.rayIntersectionCoordinate(J)).x,Y.y,Y.z];var Y;const pe=k.screenPointToMercatorRay(k.centerPoint),K=k.projection.name!=="globe";let ne,oe=0;do{const ge=Math.floor(k.zoom),he=1<<ge,fe=Math.min(he*G.x,he*X.x),be=Math.min(he*G.y,he*X.y),Ve=Math.max(he*G.x,he*X.x),Ze=Math.max(he*G.y,he*X.y),je=new n.Aabb([fe,be,m],[Ve,Ze,v]),Ue=n.Frustum.fromInvProjectionMatrix(k.invProjMatrix,k.worldSize,ge,K);if(je.intersects(Ue)!==2){ne&&(k._camera.position=n.scaleAndAdd([],k._camera.position,pe.dir,-ne),k._updateStateFromCamera());break}const _e=n.sub([],k._camera.position,ee);ne=.5*n.length(_e),k._camera.position=n.scaleAndAdd([],k._camera.position,pe.dir,ne);try{k._updateStateFromCamera()}catch{return void n.warnOnce("Map cannot fit within canvas with the given bounds, padding, and/or offset.")}}while(++oe<10);return{center:k.center,zoom:k.zoom,bearing:k.bearing,pitch:k.pitch}}fitBounds(t,a,m){return this.transform.projection.name==="globe"&&n.warnOnce("Globe projection does not support fitBounds API, this API may behave unexpectedly."),this._fitInternal(this.cameraForBounds(t,a),a,m)}_raycastElevationBox(t,a){const m=this.transform.elevation;if(!m)return;const v=new n.pointGeometry(t.x,a.y),b=new n.pointGeometry(a.x,t.y),S=m.pointCoordinate(t);if(!S)return;const k=m.pointCoordinate(a);if(!k)return;const D=m.pointCoordinate(v);if(!D)return;const O=m.pointCoordinate(b);if(!O)return;const V=new n.MercatorCoordinate(S[0],S[1]).toLngLat(),G=new n.MercatorCoordinate(k[0],k[1]).toLngLat(),X=new n.MercatorCoordinate(D[0],D[1]).toLngLat(),J=new n.MercatorCoordinate(O[0],O[1]).toLngLat(),ee=Math.min(V.lng,Math.min(G.lng,Math.min(X.lng,J.lng))),Y=Math.min(V.lat,Math.min(G.lat,Math.min(X.lat,J.lat))),pe=Math.max(V.lng,Math.max(G.lng,Math.max(X.lng,J.lng))),K=Math.max(V.lat,Math.max(G.lat,Math.max(X.lat,J.lat))),ne=Math.min(S[3],Math.min(k[3],Math.min(D[3],O[3]))),oe=Math.max(S[3],Math.max(k[3],Math.max(D[3],O[3])));return{minLngLat:new n.LngLat(ee,Y),maxLngLat:new n.LngLat(pe,K),minAltitude:ne,maxAltitude:oe}}fitScreenCoordinates(t,a,m,v,b){let S,k,D,O;this.transform.projection.name==="globe"&&n.warnOnce("Globe projection does not support fitScreenCoordinates API, this API may behave unexpectedly.");const V=n.pointGeometry.convert(t),G=n.pointGeometry.convert(a),X=this._raycastElevationBox(V,G);if(X)S=X.minLngLat,k=X.maxLngLat,D=X.minAltitude,O=X.maxAltitude;else{if(this.transform.anyCornerOffEdge(V,G))return this;S=this.transform.pointLocation(V),k=this.transform.pointLocation(G)}return this._fitInternal(this.transform.pitch===0?this._cameraForBoxAndBearing(this.transform.pointLocation(n.pointGeometry.convert(t)),this.transform.pointLocation(n.pointGeometry.convert(a)),m,v):this._cameraForBox(S,k,D,O,v),v,b)}_fitInternal(t,a,m){return t?(delete(a=n.extend(t,a)).padding,a.linear?this.easeTo(a,m):this.flyTo(a,m)):this}jumpTo(t,a){this.stop();const m=t.preloadOnly?this.transform.clone():this.transform;let v=!1,b=!1,S=!1;return"zoom"in t&&m.zoom!==+t.zoom&&(v=!0,m.zoom=+t.zoom),t.center!==void 0&&(m.center=n.LngLat.convert(t.center)),"bearing"in t&&m.bearing!==+t.bearing&&(b=!0,m.bearing=+t.bearing),"pitch"in t&&m.pitch!==+t.pitch&&(S=!0,m.pitch=+t.pitch),t.padding==null||m.isPaddingEqual(t.padding)||(m.padding=t.padding),t.preloadOnly?(this._preloadTiles(m),this):(this.fire(new n.Event("movestart",a)).fire(new n.Event("move",a)),v&&this.fire(new n.Event("zoomstart",a)).fire(new n.Event("zoom",a)).fire(new n.Event("zoomend",a)),b&&this.fire(new n.Event("rotatestart",a)).fire(new n.Event("rotate",a)).fire(new n.Event("rotateend",a)),S&&this.fire(new n.Event("pitchstart",a)).fire(new n.Event("pitch",a)).fire(new n.Event("pitchend",a)),this.fire(new n.Event("moveend",a)))}getFreeCameraOptions(){return this.transform.projection.supportsFreeCamera||n.warnOnce(Dl),this.transform.getFreeCameraOptions()}setFreeCameraOptions(t,a){const m=this.transform;if(!m.projection.supportsFreeCamera)return n.warnOnce(Dl),this;this.stop();const v=m.zoom,b=m.pitch,S=m.bearing;m.setFreeCameraOptions(t);const k=v!==m.zoom,D=b!==m.pitch,O=S!==m.bearing;return this.fire(new n.Event("movestart",a)).fire(new n.Event("move",a)),k&&this.fire(new n.Event("zoomstart",a)).fire(new n.Event("zoom",a)).fire(new n.Event("zoomend",a)),O&&this.fire(new n.Event("rotatestart",a)).fire(new n.Event("rotate",a)).fire(new n.Event("rotateend",a)),D&&this.fire(new n.Event("pitchstart",a)).fire(new n.Event("pitch",a)).fire(new n.Event("pitchend",a)),this.fire(new n.Event("moveend",a)),this}easeTo(t,a){this._stop(!1,t.easeId),((t=n.extend({offset:[0,0],duration:500,easing:n.ease},t)).animate===!1||!t.essential&&n.exported.prefersReducedMotion)&&(t.duration=0);const m=this.transform,v=this.getZoom(),b=this.getBearing(),S=this.getPitch(),k=this.getPadding(),D="zoom"in t?+t.zoom:v,O="bearing"in t?this._normalizeBearing(t.bearing,b):b,V="pitch"in t?+t.pitch:S,G="padding"in t?t.padding:m.padding,X=n.pointGeometry.convert(t.offset);let J,ee,Y;if(m.projection.name==="globe"){const Ze=n.MercatorCoordinate.fromLngLat(m.center),je=X.rotate(-m.angle);Ze.x+=je.x/m.worldSize,Ze.y+=je.y/m.worldSize;const Ue=Ze.toLngLat(),_e=n.LngLat.convert(t.center||Ue);this._normalizeCenter(_e),J=m.centerPoint.add(je),ee=new n.pointGeometry(Ze.x,Ze.y).mult(m.worldSize),Y=new n.pointGeometry(n.mercatorXfromLng(_e.lng),n.mercatorYfromLat(_e.lat)).mult(m.worldSize).sub(ee)}else{J=m.centerPoint.add(X);const Ze=m.pointLocation(J),je=n.LngLat.convert(t.center||Ze);this._normalizeCenter(je),ee=m.project(Ze),Y=m.project(je).sub(ee)}const pe=m.zoomScale(D-v);let K,ne;t.around&&(K=n.LngLat.convert(t.around),ne=m.locationPoint(K));const oe=this._zooming||D!==v,ge=this._rotating||b!==O,he=this._pitching||V!==S,fe=!m.isPaddingEqual(G),be=Ze=>je=>{if(oe&&(Ze.zoom=n.number(v,D,je)),ge&&(Ze.bearing=n.number(b,O,je)),he&&(Ze.pitch=n.number(S,V,je)),fe&&(Ze.interpolatePadding(k,G,je),J=Ze.centerPoint.add(X)),K)Ze.setLocationAtPoint(K,ne);else{const Ue=Ze.zoomScale(Ze.zoom-v),_e=D>v?Math.min(2,pe):Math.max(.5,pe),rt=Math.pow(_e,1-je),it=Ze.unproject(ee.add(Y.mult(je*rt)).mult(Ue));Ze.setLocationAtPoint(Ze.renderWorldCopies?it.wrap():it,J)}return t.preloadOnly||this._fireMoveEvents(a),Ze};if(t.preloadOnly){const Ze=this._emulate(be,t.duration,m);return this._preloadTiles(Ze),this}const Ve={moving:this._moving,zooming:this._zooming,rotating:this._rotating,pitching:this._pitching};return this._zooming=oe,this._rotating=ge,this._pitching=he,this._padding=fe,this._easeId=t.easeId,this._prepareEase(a,t.noMoveStart,Ve),this._ease(be(m),Ze=>{m.recenterOnTerrain(),this._afterEase(a,Ze)},t),this}_prepareEase(t,a,m={}){this._moving=!0,this.transform.cameraElevationReference="sea",a||m.moving||this.fire(new n.Event("movestart",t)),this._zooming&&!m.zooming&&this.fire(new n.Event("zoomstart",t)),this._rotating&&!m.rotating&&this.fire(new n.Event("rotatestart",t)),this._pitching&&!m.pitching&&this.fire(new n.Event("pitchstart",t))}_fireMoveEvents(t){this.fire(new n.Event("move",t)),this._zooming&&this.fire(new n.Event("zoom",t)),this._rotating&&this.fire(new n.Event("rotate",t)),this._pitching&&this.fire(new n.Event("pitch",t))}_afterEase(t,a){if(this._easeId&&a&&this._easeId===a)return;this._easeId=void 0,this.transform.cameraElevationReference="ground";const m=this._zooming,v=this._rotating,b=this._pitching;this._moving=!1,this._zooming=!1,this._rotating=!1,this._pitching=!1,this._padding=!1,m&&this.fire(new n.Event("zoomend",t)),v&&this.fire(new n.Event("rotateend",t)),b&&this.fire(new n.Event("pitchend",t)),this.fire(new n.Event("moveend",t))}flyTo(t,a){if(!t.essential&&n.exported.prefersReducedMotion){const yt=n.pick(t,["center","zoom","bearing","pitch","around"]);return this.jumpTo(yt,a)}this.stop(),t=n.extend({offset:[0,0],speed:1.2,curve:1.42,easing:n.ease},t);const m=this.transform,v=this.getZoom(),b=this.getBearing(),S=this.getPitch(),k=this.getPadding(),D="zoom"in t?n.clamp(+t.zoom,m.minZoom,m.maxZoom):v,O="bearing"in t?this._normalizeBearing(t.bearing,b):b,V="pitch"in t?+t.pitch:S,G="padding"in t?t.padding:m.padding,X=m.zoomScale(D-v),J=n.pointGeometry.convert(t.offset);let ee=m.centerPoint.add(J);const Y=m.pointLocation(ee),pe=n.LngLat.convert(t.center||Y);this._normalizeCenter(pe);const K=m.project(Y),ne=m.project(pe).sub(K);let oe=t.curve;const ge=Math.max(m.width,m.height),he=ge/X,fe=ne.mag();if("minZoom"in t){const yt=n.clamp(Math.min(t.minZoom,v,D),m.minZoom,m.maxZoom),ut=ge/m.zoomScale(yt-v);oe=Math.sqrt(ut/fe*2)}const be=oe*oe;function Ve(yt){const ut=(he*he-ge*ge+(yt?-1:1)*be*be*fe*fe)/(2*(yt?he:ge)*be*fe);return Math.log(Math.sqrt(ut*ut+1)-ut)}function Ze(yt){return(Math.exp(yt)-Math.exp(-yt))/2}function je(yt){return(Math.exp(yt)+Math.exp(-yt))/2}const Ue=Ve(0);let _e=function(yt){return je(Ue)/je(Ue+oe*yt)},rt=function(yt){return ge*((je(Ue)*(Ze(ut=Ue+oe*yt)/je(ut))-Ze(Ue))/be)/fe;var ut},it=(Ve(1)-Ue)/oe;if(Math.abs(fe)<1e-6||!isFinite(it)){if(Math.abs(ge-he)<1e-6)return this.easeTo(t,a);const yt=he<ge?-1:1;it=Math.abs(Math.log(he/ge))/oe,rt=function(){return 0},_e=function(ut){return Math.exp(yt*oe*ut)}}t.duration="duration"in t?+t.duration:1e3*it/("screenSpeed"in t?+t.screenSpeed/oe:+t.speed),t.maxDuration&&t.duration>t.maxDuration&&(t.duration=0);const Et=b!==O,Ke=V!==S,Ft=!m.isPaddingEqual(G),vt=yt=>ut=>{const gt=ut*it,Xt=1/_e(gt);yt.zoom=ut===1?D:v+yt.scaleZoom(Xt),Et&&(yt.bearing=n.number(b,O,ut)),Ke&&(yt.pitch=n.number(S,V,ut)),Ft&&(yt.interpolatePadding(k,G,ut),ee=yt.centerPoint.add(J));const Vt=ut===1?pe:yt.unproject(K.add(ne.mult(rt(gt))).mult(Xt));return yt.setLocationAtPoint(yt.renderWorldCopies?Vt.wrap():Vt,ee),yt._updateCameraOnTerrain(),t.preloadOnly||this._fireMoveEvents(a),yt};if(t.preloadOnly){const yt=this._emulate(vt,t.duration,m);return this._preloadTiles(yt),this}return this._zooming=!0,this._rotating=Et,this._pitching=Ke,this._padding=Ft,this._prepareEase(a,!1),this._ease(vt(m),()=>this._afterEase(a),t),this}isEasing(){return!!this._easeFrameId}stop(){return this._stop()}_stop(t,a){if(this._easeFrameId&&(this._cancelRenderFrame(this._easeFrameId),this._easeFrameId=void 0,this._onEaseFrame=void 0),this._onEaseEnd){const m=this._onEaseEnd;this._onEaseEnd=void 0,m.call(this,a)}if(!t){const m=this.handlers;m&&m.stop(!1)}return this}_ease(t,a,m){m.animate===!1||m.duration===0?(t(1),a()):(this._easeStart=n.exported.now(),this._easeOptions=m,this._onEaseFrame=t,this._onEaseEnd=a,this._easeFrameId=this._requestRenderFrame(this._renderFrameCallback))}_renderFrameCallback(){const t=Math.min((n.exported.now()-this._easeStart)/this._easeOptions.duration,1),a=this._onEaseFrame;a&&a(this._easeOptions.easing(t)),t<1?this._easeFrameId=this._requestRenderFrame(this._renderFrameCallback):this.stop()}_normalizeBearing(t,a){t=n.wrap(t,-180,180);const m=Math.abs(t-a);return Math.abs(t-360-a)<m&&(t-=360),Math.abs(t+360-a)<m&&(t+=360),t}_normalizeCenter(t){const a=this.transform;if(!a.renderWorldCopies||a.maxBounds)return;const m=t.lng-a.center.lng;t.lng+=m>180?-360:m<-180?360:0}_emulate(t,a,m){const v=Math.ceil(15*a/1e3),b=[],S=t(m.clone());for(let k=0;k<=v;k++){const D=S(k/v);b.push(D.clone())}return b}}class Vc{constructor(t={}){this.options=t,n.bindAll(["_toggleAttribution","_updateEditLink","_updateData","_updateCompact"],this)}getDefaultPosition(){return"bottom-right"}onAdd(t){const a=this.options&&this.options.compact;return this._map=t,this._container=P("div","mapboxgl-ctrl mapboxgl-ctrl-attrib"),this._compactButton=P("button","mapboxgl-ctrl-attrib-button",this._container),P("span","mapboxgl-ctrl-icon",this._compactButton).setAttribute("aria-hidden","true"),this._compactButton.type="button",this._compactButton.addEventListener("click",this._toggleAttribution),this._setElementTitle(this._compactButton,"ToggleAttribution"),this._innerContainer=P("div","mapboxgl-ctrl-attrib-inner",this._container),this._innerContainer.setAttribute("role","list"),a&&this._container.classList.add("mapboxgl-compact"),this._updateAttributions(),this._updateEditLink(),this._map.on("styledata",this._updateData),this._map.on("sourcedata",this._updateData),this._map.on("moveend",this._updateEditLink),a===void 0&&(this._map.on("resize",this._updateCompact),this._updateCompact()),this._container}onRemove(){this._container.remove(),this._map.off("styledata",this._updateData),this._map.off("sourcedata",this._updateData),this._map.off("moveend",this._updateEditLink),this._map.off("resize",this._updateCompact),this._map=void 0,this._attribHTML=void 0}_setElementTitle(t,a){const m=this._map._getUIString(`AttributionControl.${a}`);t.setAttribute("aria-label",m),t.removeAttribute("title"),t.firstElementChild&&t.firstElementChild.setAttribute("title",m)}_toggleAttribution(){this._container.classList.contains("mapboxgl-compact-show")?(this._container.classList.remove("mapboxgl-compact-show"),this._compactButton.setAttribute("aria-expanded","false")):(this._container.classList.add("mapboxgl-compact-show"),this._compactButton.setAttribute("aria-expanded","true"))}_updateEditLink(){let t=this._editLink;t||(t=this._editLink=this._container.querySelector(".mapbox-improve-map"));const a=[{key:"owner",value:this.styleOwner},{key:"id",value:this.styleId},{key:"access_token",value:this._map._requestManager._customAccessToken||n.config.ACCESS_TOKEN}];if(t){const m=a.reduce((v,b,S)=>(b.value&&(v+=`${b.key}=${b.value}${S<a.length-1?"&":""}`),v),"?");t.href=`${n.config.FEEDBACK_URL}/${m}${this._map._hash?this._map._hash.getHashString(!0):""}`,t.rel="noopener nofollow",this._setElementTitle(t,"MapFeedback")}}_updateData(t){!t||t.sourceDataType!=="metadata"&&t.sourceDataType!=="visibility"&&t.dataType!=="style"||(this._updateAttributions(),this._updateEditLink())}_updateAttributions(){if(!this._map.style)return;let t=[];if(this._map.style.stylesheet){const v=this._map.style.stylesheet;this.styleOwner=v.owner,this.styleId=v.id}const a=this._map.style._sourceCaches;for(const v in a){const b=a[v];if(b.used){const S=b.getSource();S.attribution&&t.indexOf(S.attribution)<0&&t.push(S.attribution)}}t.sort((v,b)=>v.length-b.length),t=t.filter((v,b)=>{for(let S=b+1;S<t.length;S++)if(t[S].indexOf(v)>=0)return!1;return!0}),this.options.customAttribution&&(Array.isArray(this.options.customAttribution)?t=[...this.options.customAttribution,...t]:t.unshift(this.options.customAttribution));const m=t.join(" | ");m!==this._attribHTML&&(this._attribHTML=m,t.length?(this._innerContainer.innerHTML=m,this._container.classList.remove("mapboxgl-attrib-empty")):this._container.classList.add("mapboxgl-attrib-empty"),this._editLink=null)}_updateCompact(){this._map.getCanvasContainer().offsetWidth<=640?this._container.classList.add("mapboxgl-compact"):this._container.classList.remove("mapboxgl-compact","mapboxgl-compact-show")}}class Nc{constructor(){n.bindAll(["_updateLogo","_updateCompact"],this)}onAdd(t){this._map=t,this._container=P("div","mapboxgl-ctrl");const a=P("a","mapboxgl-ctrl-logo");return a.target="_blank",a.rel="noopener nofollow",a.href="https://www.mapbox.com/",a.setAttribute("aria-label",this._map._getUIString("LogoControl.Title")),a.setAttribute("rel","noopener nofollow"),this._container.appendChild(a),this._container.style.display="none",this._map.on("sourcedata",this._updateLogo),this._updateLogo(),this._map.on("resize",this._updateCompact),this._updateCompact(),this._container}onRemove(){this._container.remove(),this._map.off("sourcedata",this._updateLogo),this._map.off("resize",this._updateCompact)}getDefaultPosition(){return"bottom-left"}_updateLogo(t){t&&t.sourceDataType!=="metadata"||(this._container.style.display=this._logoRequired()?"block":"none")}_logoRequired(){if(!this._map.style)return!0;const t=this._map.style._sourceCaches;if(Object.entries(t).length===0)return!0;for(const a in t){const m=t[a].getSource();if(m.hasOwnProperty("mapbox_logo")&&!m.mapbox_logo)return!1}return!0}_updateCompact(){const t=this._container.children;if(t.length){const a=t[0];this._map.getCanvasContainer().offsetWidth<250?a.classList.add("mapboxgl-compact"):a.classList.remove("mapboxgl-compact")}}}class jc{constructor(){this._queue=[],this._id=0,this._cleared=!1,this._currentlyRunning=!1}add(t){const a=++this._id;return this._queue.push({callback:t,id:a,cancelled:!1}),a}remove(t){const a=this._currentlyRunning,m=a?this._queue.concat(a):this._queue;for(const v of m)if(v.id===t)return void(v.cancelled=!0)}run(t=0){const a=this._currentlyRunning=this._queue;this._queue=[];for(const m of a)if(!m.cancelled&&(m.callback(t),this._cleared))break;this._cleared=!1,this._currentlyRunning=!1}clear(){this._currentlyRunning&&(this._cleared=!0),this._queue=[]}}function Gc(p,t,a){if(p=new n.LngLat(p.lng,p.lat),t){const m=new n.LngLat(p.lng-360,p.lat),v=new n.LngLat(p.lng+360,p.lat),b=360*Math.ceil(Math.abs(p.lng-a.center.lng)/360),S=a.locationPoint(p).distSqr(t),k=t.x<0||t.y<0||t.x>a.width||t.y>a.height;a.locationPoint(m).distSqr(t)<S&&(k||Math.abs(m.lng-a.center.lng)<b)?p=m:a.locationPoint(v).distSqr(t)<S&&(k||Math.abs(v.lng-a.center.lng)<b)&&(p=v)}for(;Math.abs(p.lng-a.center.lng)>180;){const m=a.locationPoint(p);if(m.x>=0&&m.y>=0&&m.x<=a.width&&m.y<=a.height)break;p.lng>a.center.lng?p.lng-=360:p.lng+=360}return p}const Rl={center:"translate(-50%,-50%)",top:"translate(-50%,0)","top-left":"translate(0,0)","top-right":"translate(-100%,0)",bottom:"translate(-50%,-100%)","bottom-left":"translate(0,-100%)","bottom-right":"translate(-100%,-100%)",left:"translate(0,-50%)",right:"translate(-100%,-50%)"};class Bl extends n.Evented{constructor(t,a){if(super(),(t instanceof n.window.HTMLElement||a)&&(t=n.extend({element:t},a)),n.bindAll(["_update","_onMove","_onUp","_addDragHandler","_onMapClick","_onKeyPress","_clearFadeTimer"],this),this._anchor=t&&t.anchor||"center",this._color=t&&t.color||"#3FB1CE",this._scale=t&&t.scale||1,this._draggable=t&&t.draggable||!1,this._clickTolerance=t&&t.clickTolerance||0,this._isDragging=!1,this._state="inactive",this._rotation=t&&t.rotation||0,this._rotationAlignment=t&&t.rotationAlignment||"auto",this._pitchAlignment=t&&t.pitchAlignment&&t.pitchAlignment||"auto",this._updateMoving=()=>this._update(!0),t&&t.element)this._element=t.element,this._offset=n.pointGeometry.convert(t&&t.offset||[0,0]);else{this._defaultMarker=!0,this._element=P("div");const v=41,b=27,S=z("svg",{display:"block",height:v*this._scale+"px",width:b*this._scale+"px",viewBox:`0 0 ${b} ${v}`},this._element),k=z("radialGradient",{id:"shadowGradient"},z("defs",{},S));z("stop",{offset:"10%","stop-opacity":.4},k),z("stop",{offset:"100%","stop-opacity":.05},k),z("ellipse",{cx:13.5,cy:34.8,rx:10.5,ry:5.25,fill:"url(#shadowGradient)"},S),z("path",{fill:this._color,d:"M27,13.5C27,19.07 20.25,27 14.75,34.5C14.02,35.5 12.98,35.5 12.25,34.5C6.75,27 0,19.22 0,13.5C0,6.04 6.04,0 13.5,0C20.96,0 27,6.04 27,13.5Z"},S),z("path",{opacity:.25,d:"M13.5,0C6.04,0 0,6.04 0,13.5C0,19.22 6.75,27 12.25,34.5C13,35.52 14.02,35.5 14.75,34.5C20.25,27 27,19.07 27,13.5C27,6.04 20.96,0 13.5,0ZM13.5,1C20.42,1 26,6.58 26,13.5C26,15.9 24.5,19.18 22.22,22.74C19.95,26.3 16.71,30.14 13.94,33.91C13.74,34.18 13.61,34.32 13.5,34.44C13.39,34.32 13.26,34.18 13.06,33.91C10.28,30.13 7.41,26.31 5.02,22.77C2.62,19.23 1,15.95 1,13.5C1,6.58 6.58,1 13.5,1Z"},S),z("circle",{fill:"white",cx:13.5,cy:13.5,r:5.5},S),this._offset=n.pointGeometry.convert(t&&t.offset||[0,-14])}this._element.hasAttribute("aria-label")||this._element.setAttribute("aria-label","Map marker"),this._element.classList.add("mapboxgl-marker"),this._element.addEventListener("dragstart",v=>{v.preventDefault()}),this._element.addEventListener("mousedown",v=>{v.preventDefault()});const m=this._element.classList;for(const v in Rl)m.remove(`mapboxgl-marker-anchor-${v}`);m.add(`mapboxgl-marker-anchor-${this._anchor}`),this._popup=null}addTo(t){return t===this._map||(this.remove(),this._map=t,t.getCanvasContainer().appendChild(this._element),t.on("move",this._updateMoving),t.on("moveend",this._update),t.on("remove",this._clearFadeTimer),t._addMarker(this),this.setDraggable(this._draggable),this._update(),t.on("click",this._onMapClick)),this}remove(){const t=this._map;return t&&(t.off("click",this._onMapClick),t.off("move",this._updateMoving),t.off("moveend",this._update),t.off("mousedown",this._addDragHandler),t.off("touchstart",this._addDragHandler),t.off("mouseup",this._onUp),t.off("touchend",this._onUp),t.off("mousemove",this._onMove),t.off("touchmove",this._onMove),t.off("remove",this._clearFadeTimer),t._removeMarker(this),this._map=void 0),this._clearFadeTimer(),this._element.remove(),this._popup&&this._popup.remove(),this}getLngLat(){return this._lngLat}setLngLat(t){return this._lngLat=n.LngLat.convert(t),this._pos=null,this._popup&&this._popup.setLngLat(this._lngLat),this._update(!0),this}getElement(){return this._element}setPopup(t){if(this._popup&&(this._popup.remove(),this._popup=null,this._element.removeAttribute("role"),this._element.removeEventListener("keypress",this._onKeyPress),this._originalTabIndex||this._element.removeAttribute("tabindex")),t){if(!("offset"in t.options)){const v=Math.sqrt(Math.pow(13.5,2)/2);t.options.offset=this._defaultMarker?{top:[0,0],"top-left":[0,0],"top-right":[0,0],bottom:[0,-38.1],"bottom-left":[v,-1*(38.1-13.5+v)],"bottom-right":[-v,-1*(38.1-13.5+v)],left:[13.5,-1*(38.1-13.5)],right:[-13.5,-1*(38.1-13.5)]}:this._offset}this._popup=t,t._marker=this,this._lngLat&&this._popup.setLngLat(this._lngLat),this._element.setAttribute("role","button"),this._originalTabIndex=this._element.getAttribute("tabindex"),this._originalTabIndex||this._element.setAttribute("tabindex","0"),this._element.addEventListener("keypress",this._onKeyPress),this._element.setAttribute("aria-expanded","false")}return this}_onKeyPress(t){const a=t.code,m=t.charCode||t.keyCode;a!=="Space"&&a!=="Enter"&&m!==32&&m!==13||this.togglePopup()}_onMapClick(t){const a=t.originalEvent.target,m=this._element;this._popup&&(a===m||m.contains(a))&&this.togglePopup()}getPopup(){return this._popup}togglePopup(){const t=this._popup;return t?(t.isOpen()?(t.remove(),this._element.setAttribute("aria-expanded","false")):this._map&&(t.addTo(this._map),this._element.setAttribute("aria-expanded","true")),this):this}_behindTerrain(){const t=this._map;if(!t)return!1;const a=t.unproject(this._pos),m=t.getFreeCameraOptions();if(!m.position)return!1;const v=m.position.toLngLat();return v.distanceTo(a)<.9*v.distanceTo(this._lngLat)}_evaluateOpacity(){const t=this._map;if(!t)return;const a=this._pos;if(!a||a.x<0||a.x>t.transform.width||a.y<0||a.y>t.transform.height)return void this._clearFadeTimer();const m=t.unproject(a);let v;t._usingGlobe()&&n.isLngLatBehindGlobe(t.transform,this._lngLat)?v=0:(v=1-t._queryFogOpacity(m),t.transform._terrainEnabled()&&t.getTerrain()&&this._behindTerrain()&&(v*=.2)),this._element.style.opacity=`${v}`,this._element.style.pointerEvents=v>0?"auto":"none",this._popup&&this._popup._setOpacity(v),this._fadeTimer=null}_clearFadeTimer(){this._fadeTimer&&(clearTimeout(this._fadeTimer),this._fadeTimer=null)}_updateDOM(){const t=this._pos;if(!t||!this._map)return;const a=this._calculateXYTransform()+this._calculateZTransform(),m=this._offset.mult(this._scale);this._element.style.transform=`
            translate(${t.x}px,${t.y}px) ${Rl[this._anchor]}
            ${a}
            translate(${m.x}px,${m.y}px)
        `}_calculateXYTransform(){const t=this._pos,a=this._map;if(this.getPitchAlignment()!=="map"||!a||!t)return"";if(!a._usingGlobe()){const D=a.getPitch();return D?`rotateX(${D}deg)`:""}const m=n.radToDeg(n.globeTiltAtLngLat(a.transform,this._lngLat)),v=t.sub(n.globeCenterToScreenPoint(a.transform)),b=m/(Math.abs(v.x)+Math.abs(v.y)),S=v.x*b,k=-v.y*b;return k||S?`rotateX(${k}deg) rotateY(${S}deg)`:""}_calculateZTransform(){const t=this._calculateRotation();return t?`rotateZ(${t}deg)`:""}_calculateRotation(){if(this._rotationAlignment==="viewport"||this._rotationAlignment==="auto")return this._rotation;if(this._map&&this._rotationAlignment==="map"){const t=this._map;if(this._pos&&t&&t._usingGlobe()){const a=t.project(new n.LngLat(this._lngLat.lng,this._lngLat.lat+.001)),m=t.project(new n.LngLat(this._lngLat.lng,this._lngLat.lat-.001)).sub(a);return this._rotation+n.radToDeg(Math.atan2(m.y,m.x))-90}return this._rotation-this._map.getBearing()}return 0}_update(t){n.window.cancelAnimationFrame(this._updateFrameId);const a=this._map;a&&(a.transform.renderWorldCopies&&(this._lngLat=Gc(this._lngLat,this._pos,a.transform)),this._pos=a.project(this._lngLat),t===!0?this._updateFrameId=n.window.requestAnimationFrame(()=>{this._element&&this._pos&&this._anchor&&(this._pos=this._pos.round(),this._updateDOM())}):this._pos=this._pos.round(),a._requestDomTask(()=>{this._map&&(this._element&&this._pos&&this._anchor&&this._updateDOM(),(a._usingGlobe()||a.getTerrain()||a.getFog())&&!this._fadeTimer&&(this._fadeTimer=setTimeout(this._evaluateOpacity.bind(this),60)))}))}getOffset(){return this._offset}setOffset(t){return this._offset=n.pointGeometry.convert(t),this._update(),this}_onMove(t){const a=this._map;if(a){if(!this._isDragging){const m=this._clickTolerance||a._clickTolerance;this._isDragging=t.point.dist(this._pointerdownPos)>=m}this._isDragging&&(this._pos=t.point.sub(this._positionDelta),this._lngLat=a.unproject(this._pos),this.setLngLat(this._lngLat),this._element.style.pointerEvents="none",this._state==="pending"&&(this._state="active",this.fire(new n.Event("dragstart"))),this.fire(new n.Event("drag")))}}_onUp(){this._element.style.pointerEvents="auto",this._positionDelta=null,this._pointerdownPos=null,this._isDragging=!1;const t=this._map;t&&(t.off("mousemove",this._onMove),t.off("touchmove",this._onMove)),this._state==="active"&&this.fire(new n.Event("dragend")),this._state="inactive"}_addDragHandler(t){const a=this._map;a&&this._element.contains(t.originalEvent.target)&&(t.preventDefault(),this._positionDelta=t.point.sub(this._pos),this._pointerdownPos=t.point,this._state="pending",a.on("mousemove",this._onMove),a.on("touchmove",this._onMove),a.once("mouseup",this._onUp),a.once("touchend",this._onUp))}setDraggable(t){this._draggable=!!t;const a=this._map;return a&&(t?(a.on("mousedown",this._addDragHandler),a.on("touchstart",this._addDragHandler)):(a.off("mousedown",this._addDragHandler),a.off("touchstart",this._addDragHandler))),this}isDraggable(){return this._draggable}setRotation(t){return this._rotation=t||0,this._update(),this}getRotation(){return this._rotation}setRotationAlignment(t){return this._rotationAlignment=t||"auto",this._update(),this}getRotationAlignment(){return this._rotationAlignment==="auto"?"viewport":this._rotationAlignment}setPitchAlignment(t){return this._pitchAlignment=t||"auto",this._update(),this}getPitchAlignment(){return this._pitchAlignment==="auto"?this.getRotationAlignment():this._pitchAlignment}}class zh{constructor(t){this.jumpTo(t)}getValue(t){if(t<=this._startTime)return this._start;if(t>=this._endTime)return this._end;const a=n.easeCubicInOut((t-this._startTime)/(this._endTime-this._startTime));return this._start*(1-a)+this._end*a}isEasing(t){return t>=this._startTime&&t<=this._endTime}jumpTo(t){this._startTime=-1/0,this._endTime=-1/0,this._start=t,this._end=t}easeTo(t,a,m){this._start=this.getValue(a),this._end=t,this._startTime=a,this._endTime=a+m}}const qc={"AttributionControl.ToggleAttribution":"Toggle attribution","AttributionControl.MapFeedback":"Map feedback","FullscreenControl.Enter":"Enter fullscreen","FullscreenControl.Exit":"Exit fullscreen","GeolocateControl.FindMyLocation":"Find my location","GeolocateControl.LocationNotAvailable":"Location not available","LogoControl.Title":"Mapbox logo","Map.Title":"Map","NavigationControl.ResetBearing":"Reset bearing to north","NavigationControl.ZoomIn":"Zoom in","NavigationControl.ZoomOut":"Zoom out","ScrollZoomBlocker.CtrlMessage":"Use ctrl + scroll to zoom the map","ScrollZoomBlocker.CmdMessage":"Use \u2318 + scroll to zoom the map","TouchPanBlocker.Message":"Use two fingers to move the map"},Ph={center:[0,0],zoom:0,bearing:0,pitch:0,minZoom:-2,maxZoom:22,minPitch:0,maxPitch:85,interactive:!0,scrollZoom:!0,boxZoom:!0,dragRotate:!0,dragPan:!0,keyboard:!0,doubleClickZoom:!0,touchZoomRotate:!0,touchPitch:!0,cooperativeGestures:!1,bearingSnap:7,clickTolerance:3,pitchWithRotate:!0,hash:!1,attributionControl:!0,failIfMajorPerformanceCaveat:!1,preserveDrawingBuffer:!1,trackResize:!0,optimizeForTerrain:!0,renderWorldCopies:!0,refreshExpiredTiles:!0,minTileCacheSize:null,maxTileCacheSize:null,localIdeographFontFamily:"sans-serif",localFontFamily:null,transformRequest:null,accessToken:null,fadeDuration:300,crossSourceCollisions:!0};function Ol(p){p.parentNode&&p.parentNode.removeChild(p)}const Dh={showCompass:!0,showZoom:!0,visualizePitch:!1};class Lh{constructor(t,a,m=!1){this._clickTolerance=10,this.element=a,this.mouseRotate=new Fc({clickTolerance:t.dragRotate._mouseRotate._clickTolerance}),this.map=t,m&&(this.mousePitch=new Uc({clickTolerance:t.dragRotate._mousePitch._clickTolerance})),n.bindAll(["mousedown","mousemove","mouseup","touchstart","touchmove","touchend","reset"],this),a.addEventListener("mousedown",this.mousedown),a.addEventListener("touchstart",this.touchstart,{passive:!1}),a.addEventListener("touchmove",this.touchmove),a.addEventListener("touchend",this.touchend),a.addEventListener("touchcancel",this.reset)}down(t,a){this.mouseRotate.mousedown(t,a),this.mousePitch&&this.mousePitch.mousedown(t,a),ae()}move(t,a){const m=this.map,v=this.mouseRotate.mousemoveWindow(t,a),b=v&&v.bearingDelta;if(b&&m.setBearing(m.getBearing()+b),this.mousePitch){const S=this.mousePitch.mousemoveWindow(t,a),k=S&&S.pitchDelta;k&&m.setPitch(m.getPitch()+k)}}off(){const t=this.element;t.removeEventListener("mousedown",this.mousedown),t.removeEventListener("touchstart",this.touchstart,{passive:!1}),t.removeEventListener("touchmove",this.touchmove),t.removeEventListener("touchend",this.touchend),t.removeEventListener("touchcancel",this.reset),this.offTemp()}offTemp(){se(),n.window.removeEventListener("mousemove",this.mousemove),n.window.removeEventListener("mouseup",this.mouseup)}mousedown(t){this.down(n.extend({},t,{ctrlKey:!0,preventDefault:()=>t.preventDefault()}),re(this.element,t)),n.window.addEventListener("mousemove",this.mousemove),n.window.addEventListener("mouseup",this.mouseup)}mousemove(t){this.move(t,re(this.element,t))}mouseup(t){this.mouseRotate.mouseupWindow(t),this.mousePitch&&this.mousePitch.mouseupWindow(t),this.offTemp()}touchstart(t){t.targetTouches.length!==1?this.reset():(this._startPos=this._lastPos=Ae(this.element,t.targetTouches)[0],this.down({type:"mousedown",button:0,ctrlKey:!0,preventDefault:()=>t.preventDefault()},this._startPos))}touchmove(t){t.targetTouches.length!==1?this.reset():(this._lastPos=Ae(this.element,t.targetTouches)[0],this.move({preventDefault:()=>t.preventDefault()},this._lastPos))}touchend(t){t.targetTouches.length===0&&this._startPos&&this._lastPos&&this._startPos.dist(this._lastPos)<this._clickTolerance&&this.element.click(),this.reset()}reset(){this.mouseRotate.reset(),this.mousePitch&&this.mousePitch.reset(),delete this._startPos,delete this._lastPos,this.offTemp()}}const Zc={positionOptions:{enableHighAccuracy:!1,maximumAge:0,timeout:6e3},fitBoundsOptions:{maxZoom:15},trackUserLocation:!1,showAccuracyCircle:!0,showUserLocation:!0,showUserHeading:!1},Rh={maxWidth:100,unit:"metric"};function $c(p,t,a){const m=Wc(t),v=m/t,b={kilometer:"km",meter:"m",mile:"mi",foot:"ft","nautical-mile":"nm"}[a];this._map._requestDomTask(()=>{this._container.style.width=p*v+"px",this._container.innerHTML=`${m}&nbsp;${b}`})}function Wc(p){const t=Math.pow(10,`${Math.floor(p)}`.length-1);let a=p/t;return a=a>=10?10:a>=5?5:a>=3?3:a>=2?2:a>=1?1:function(m){const v=Math.pow(10,Math.ceil(-Math.log(m)/Math.LN10));return Math.round(m*v)/v}(a),t*a}const Xc={closeButton:!0,closeOnClick:!0,focusAfterOpen:!0,className:"",maxWidth:"240px"},Hc=["a[href]","[tabindex]:not([tabindex='-1'])","[contenteditable]:not([contenteditable='false'])","button:not([disabled])","input:not([disabled])","select:not([disabled])","textarea:not([disabled])"].join(", ");function Fl(p=new n.pointGeometry(0,0),t="bottom"){if(typeof p=="number"){const a=Math.round(Math.sqrt(.5*Math.pow(p,2)));switch(t){case"top":return new n.pointGeometry(0,p);case"top-left":return new n.pointGeometry(a,a);case"top-right":return new n.pointGeometry(-a,a);case"bottom":return new n.pointGeometry(0,-p);case"bottom-left":return new n.pointGeometry(a,-a);case"bottom-right":return new n.pointGeometry(-a,-a);case"left":return new n.pointGeometry(p,0);case"right":return new n.pointGeometry(-p,0)}return new n.pointGeometry(0,0)}return p instanceof n.pointGeometry||Array.isArray(p)?n.pointGeometry.convert(p):n.pointGeometry.convert(p[t]||[0,0])}const Ul={version:n.version,supported:T,setRTLTextPlugin:n.setRTLTextPlugin,getRTLTextPluginStatus:n.getRTLTextPluginStatus,Map:class extends Ll{constructor(p){if((p=n.extend({},Ph,p)).minZoom!=null&&p.maxZoom!=null&&p.minZoom>p.maxZoom)throw new Error("maxZoom must be greater than or equal to minZoom");if(p.minPitch!=null&&p.maxPitch!=null&&p.minPitch>p.maxPitch)throw new Error("maxPitch must be greater than or equal to minPitch");if(p.minPitch!=null&&p.minPitch<0)throw new Error("minPitch must be greater than or equal to 0");if(p.maxPitch!=null&&p.maxPitch>85)throw new Error("maxPitch must be less than or equal to 85");if(p.antialias&&n.isSafariWithAntialiasingBug(n.window)&&(p.antialias=!1,n.warnOnce("Antialiasing is disabled for this WebGL context to avoid browser bug: https://github.com/mapbox/mapbox-gl-js/issues/11609")),super(new Al(p.minZoom,p.maxZoom,p.minPitch,p.maxPitch,p.renderWorldCopies),p),this._interactive=p.interactive,this._minTileCacheSize=p.minTileCacheSize,this._maxTileCacheSize=p.maxTileCacheSize,this._failIfMajorPerformanceCaveat=p.failIfMajorPerformanceCaveat,this._preserveDrawingBuffer=p.preserveDrawingBuffer,this._antialias=p.antialias,this._trackResize=p.trackResize,this._bearingSnap=p.bearingSnap,this._refreshExpiredTiles=p.refreshExpiredTiles,this._fadeDuration=p.fadeDuration,this._isInitialLoad=!0,this._crossSourceCollisions=p.crossSourceCollisions,this._crossFadingFactor=1,this._collectResourceTiming=p.collectResourceTiming,this._optimizeForTerrain=p.optimizeForTerrain,this._language=p.language==="auto"?n.window.navigator.language:p.language,this._worldview=p.worldview,this._renderTaskQueue=new jc,this._domRenderTaskQueue=new jc,this._controls=[],this._markers=[],this._mapId=n.uniqueId(),this._locale=n.extend({},qc,p.locale),this._clickTolerance=p.clickTolerance,this._cooperativeGestures=p.cooperativeGestures,this._containerWidth=0,this._containerHeight=0,this._averageElevationLastSampledAt=-1/0,this._averageElevationExaggeration=0,this._averageElevation=new zh(0),this._explicitProjection=null,this._requestManager=new n.RequestManager(p.transformRequest,p.accessToken,p.testMode),this._silenceAuthErrors=!!p.testMode,typeof p.container=="string"){if(this._container=n.window.document.getElementById(p.container),!this._container)throw new Error(`Container '${p.container}' not found.`)}else{if(!(p.container instanceof n.window.HTMLElement))throw new Error("Invalid type: 'container' must be a String or HTMLElement.");this._container=p.container}if(this._container.childNodes.length>0&&n.warnOnce("The map container element should be empty, otherwise the map's interactivity will be negatively impacted. If you want to display a message when WebGL is not supported, use the Mapbox GL Supported plugin instead."),p.maxBounds&&this.setMaxBounds(p.maxBounds),n.bindAll(["_onWindowOnline","_onWindowResize","_onMapScroll","_contextLost","_contextRestored"],this),this._setupContainer(),this._setupPainter(),this.painter===void 0)throw new Error("Failed to initialize WebGL.");this.on("move",()=>this._update(!1)),this.on("moveend",()=>this._update(!1)),this.on("zoom",()=>this._update(!0)),n.window!==void 0&&(n.window.addEventListener("online",this._onWindowOnline,!1),n.window.addEventListener("resize",this._onWindowResize,!1),n.window.addEventListener("orientationchange",this._onWindowResize,!1),n.window.addEventListener("webkitfullscreenchange",this._onWindowResize,!1)),this.handlers=new Pl(this,p),this._localFontFamily=p.localFontFamily,this._localIdeographFontFamily=p.localIdeographFontFamily,p.style&&this.setStyle(p.style,{localFontFamily:this._localFontFamily,localIdeographFontFamily:this._localIdeographFontFamily}),p.projection&&this.setProjection(p.projection),this._hash=p.hash&&new Bc(typeof p.hash=="string"&&p.hash||void 0).addTo(this),this._hash&&this._hash._onHashChange()||(this.jumpTo({center:p.center,zoom:p.zoom,bearing:p.bearing,pitch:p.pitch}),p.bounds&&(this.resize(),this.fitBounds(p.bounds,n.extend({},p.fitBoundsOptions,{duration:0})))),this.resize(),p.attributionControl&&this.addControl(new Vc({customAttribution:p.customAttribution})),this._logoControl=new Nc,this.addControl(this._logoControl,p.logoPosition),this.on("style.load",()=>{this.transform.unmodified&&this.jumpTo(this.style.stylesheet)}),this.on("data",t=>{this._update(t.dataType==="style"),this.fire(new n.Event(`${t.dataType}data`,t))}),this.on("dataloading",t=>{this.fire(new n.Event(`${t.dataType}dataloading`,t))})}_getMapId(){return this._mapId}addControl(p,t){if(t===void 0&&(t=p.getDefaultPosition?p.getDefaultPosition():"top-right"),!p||!p.onAdd)return this.fire(new n.ErrorEvent(new Error("Invalid argument to map.addControl(). Argument must be a control with onAdd and onRemove methods.")));const a=p.onAdd(this);this._controls.push(p);const m=this._controlPositions[t];return t.indexOf("bottom")!==-1?m.insertBefore(a,m.firstChild):m.appendChild(a),this}removeControl(p){if(!p||!p.onRemove)return this.fire(new n.ErrorEvent(new Error("Invalid argument to map.removeControl(). Argument must be a control with onAdd and onRemove methods.")));const t=this._controls.indexOf(p);return t>-1&&this._controls.splice(t,1),p.onRemove(this),this}hasControl(p){return this._controls.indexOf(p)>-1}getContainer(){return this._container}getCanvasContainer(){return this._canvasContainer}getCanvas(){return this._canvas}resize(p){if(this._updateContainerDimensions(),this._containerWidth===this.transform.width&&this._containerHeight===this.transform.height)return this;this._resizeCanvas(this._containerWidth,this._containerHeight),this.transform.resize(this._containerWidth,this._containerHeight),this.painter.resize(Math.ceil(this._containerWidth),Math.ceil(this._containerHeight));const t=!this._moving;return t&&this.fire(new n.Event("movestart",p)).fire(new n.Event("move",p)),this.fire(new n.Event("resize",p)),t&&this.fire(new n.Event("moveend",p)),this}getBounds(){return this.transform.projection.name==="globe"&&n.warnOnce('Globe projection does not support getBounds API, this API may behave unexpectedly."'),this.transform.getBounds()}getMaxBounds(){return this.transform.getMaxBounds()||null}setMaxBounds(p){return this.transform.setMaxBounds(n.LngLatBounds.convert(p)),this._update()}setMinZoom(p){if((p=p==null?-2:p)>=-2&&p<=this.transform.maxZoom)return this.transform.minZoom=p,this._update(),this.getZoom()<p?this.setZoom(p):this.fire(new n.Event("zoomstart")).fire(new n.Event("zoom")).fire(new n.Event("zoomend")),this;throw new Error("minZoom must be between -2 and the current maxZoom, inclusive")}getMinZoom(){return this.transform.minZoom}setMaxZoom(p){if((p=p==null?22:p)>=this.transform.minZoom)return this.transform.maxZoom=p,this._update(),this.getZoom()>p?this.setZoom(p):this.fire(new n.Event("zoomstart")).fire(new n.Event("zoom")).fire(new n.Event("zoomend")),this;throw new Error("maxZoom must be greater than the current minZoom")}getMaxZoom(){return this.transform.maxZoom}setMinPitch(p){if((p=p==null?0:p)<0)throw new Error("minPitch must be greater than or equal to 0");if(p>=0&&p<=this.transform.maxPitch)return this.transform.minPitch=p,this._update(),this.getPitch()<p?this.setPitch(p):this.fire(new n.Event("pitchstart")).fire(new n.Event("pitch")).fire(new n.Event("pitchend")),this;throw new Error("minPitch must be between 0 and the current maxPitch, inclusive")}getMinPitch(){return this.transform.minPitch}setMaxPitch(p){if((p=p==null?85:p)>85)throw new Error("maxPitch must be less than or equal to 85");if(p>=this.transform.minPitch)return this.transform.maxPitch=p,this._update(),this.getPitch()>p?this.setPitch(p):this.fire(new n.Event("pitchstart")).fire(new n.Event("pitch")).fire(new n.Event("pitchend")),this;throw new Error("maxPitch must be greater than or equal to minPitch")}getMaxPitch(){return this.transform.maxPitch}getRenderWorldCopies(){return this.transform.renderWorldCopies}setRenderWorldCopies(p){return this.transform.renderWorldCopies=p,this._update()}getLanguage(){return this._language}setLanguage(p){if(this._language=p==="auto"?n.window.navigator.language:p,this.style)for(const t in this.style._sourceCaches){const a=this.style._sourceCaches[t]._source;a._setLanguage&&a._setLanguage(this._language)}for(const t of this._controls)t._setLanguage&&t._setLanguage(this._language);return this}getWorldview(){return this._worldview}setWorldview(p){if(this._worldview=p,this.style)for(const t in this.style._sourceCaches){const a=this.style._sourceCaches[t]._source;a._setWorldview&&a._setWorldview(p)}return this}getProjection(){return this._explicitProjection?this._explicitProjection:this.style&&this.style.stylesheet&&this.style.stylesheet.projection?this.style.stylesheet.projection:{name:"mercator",center:[0,0]}}_usingGlobe(){return this.transform.projection.name==="globe"}setProjection(p){return this._lazyInitEmptyStyle(),p?typeof p=="string"&&(p={name:p}):p=null,this._updateProjection(p)}_updateProjection(p){const t=this.getProjection();p===null&&(this._explicitProjection=null);const a=p||this.getProjection();let m;if(a&&a.name==="globe"&&this.transform.zoom>=n.GLOBE_ZOOM_THRESHOLD_MAX?(m=this.transform.setProjection({name:"mercator"}),this.transform.mercatorFromTransition=!0):(m=this.transform.setProjection(a),this.transform.mercatorFromTransition=!1),p&&(this._explicitProjection=p.name==="globe"?{name:"globe",center:[0,0]}:this.transform.getProjection()),this.style.applyProjectionUpdate(),m){if(t.name==="globe"&&this.getProjection().name==="globe")this.style._forceSymbolLayerUpdate();else{this.painter.clearBackgroundTiles();for(const v in this.style._sourceCaches)this.style._sourceCaches[v].clearTiles()}this._update(!0)}return this}project(p){return this.transform.locationPoint3D(n.LngLat.convert(p))}unproject(p){return this.transform.pointLocation3D(n.pointGeometry.convert(p))}isMoving(){return this._moving||this.handlers&&this.handlers.isMoving()||!1}isZooming(){return this._zooming||this.handlers&&this.handlers.isZooming()||!1}isRotating(){return this._rotating||this.handlers&&this.handlers.isRotating()||!1}_createDelegatedListener(p,t,a){if(p==="mouseenter"||p==="mouseover"){let m=!1;const v=S=>{const k=t.filter(O=>this.getLayer(O)),D=k.length?this.queryRenderedFeatures(S.point,{layers:k}):[];D.length?m||(m=!0,a.call(this,new Or(p,this,S.originalEvent,{features:D}))):m=!1},b=()=>{m=!1};return{layers:new Set(t),listener:a,delegates:{mousemove:v,mouseout:b}}}if(p==="mouseleave"||p==="mouseout"){let m=!1;const v=S=>{const k=t.filter(D=>this.getLayer(D));(k.length?this.queryRenderedFeatures(S.point,{layers:k}):[]).length?m=!0:m&&(m=!1,a.call(this,new Or(p,this,S.originalEvent)))},b=S=>{m&&(m=!1,a.call(this,new Or(p,this,S.originalEvent)))};return{layers:new Set(t),listener:a,delegates:{mousemove:v,mouseout:b}}}{const m=v=>{const b=t.filter(k=>this.getLayer(k)),S=b.length?this.queryRenderedFeatures(v.point,{layers:b}):[];S.length&&(v.features=S,a.call(this,v),delete v.features)};return{layers:new Set(t),listener:a,delegates:{[p]:m}}}}on(p,t,a){if(a===void 0)return super.on(p,t);Array.isArray(t)||(t=[t]);const m=this._createDelegatedListener(p,t,a);this._delegatedListeners=this._delegatedListeners||{},this._delegatedListeners[p]=this._delegatedListeners[p]||[],this._delegatedListeners[p].push(m);for(const v in m.delegates)this.on(v,m.delegates[v]);return this}once(p,t,a){if(a===void 0)return super.once(p,t);Array.isArray(t)||(t=[t]);const m=this._createDelegatedListener(p,t,a);for(const v in m.delegates)this.once(v,m.delegates[v]);return this}off(p,t,a){if(a===void 0)return super.off(p,t);t=new Set(Array.isArray(t)?t:[t]);const m=(b,S)=>{if(b.size!==S.size)return!1;for(const k of b)if(!S.has(k))return!1;return!0},v=this._delegatedListeners?this._delegatedListeners[p]:void 0;return v&&(b=>{for(let S=0;S<b.length;S++){const k=b[S];if(k.listener===a&&m(k.layers,t)){for(const D in k.delegates)this.off(D,k.delegates[D]);return b.splice(S,1),this}}})(v),this}queryRenderedFeatures(p,t){return this.style?(t!==void 0||p===void 0||p instanceof n.pointGeometry||Array.isArray(p)||(t=p,p=void 0),this.style.queryRenderedFeatures(p=p||[[0,0],[this.transform.width,this.transform.height]],t=t||{},this.transform)):[]}querySourceFeatures(p,t){return this.style.querySourceFeatures(p,t)}queryTerrainElevation(p,t){const a=this.transform.elevation;return a?(t=n.extend({},{exaggerated:!0},t),a.getAtPoint(n.MercatorCoordinate.fromLngLat(p),null,t.exaggerated)):null}setStyle(p,t){return(t=n.extend({},{localIdeographFontFamily:this._localIdeographFontFamily,localFontFamily:this._localFontFamily},t)).diff!==!1&&t.localIdeographFontFamily===this._localIdeographFontFamily&&t.localFontFamily===this._localFontFamily&&this.style&&p?(this._diffStyle(p,t),this):(this._localIdeographFontFamily=t.localIdeographFontFamily,this._localFontFamily=t.localFontFamily,this._updateStyle(p,t))}_getUIString(p){const t=this._locale[p];if(t==null)throw new Error(`Missing UI string '${p}'`);return t}_updateStyle(p,t){return this.style&&(this.style.setEventedParent(null),this.style._remove(),this.style=void 0),p&&(this.style=new wn(this,t||{}),this.style.setEventedParent(this,{style:this.style}),typeof p=="string"?this.style.loadURL(p):this.style.loadJSON(p)),this._updateTerrain(),this}_lazyInitEmptyStyle(){this.style||(this.style=new wn(this,{}),this.style.setEventedParent(this,{style:this.style}),this.style.loadEmpty())}_diffStyle(p,t){if(typeof p=="string"){const a=this._requestManager.normalizeStyleURL(p),m=this._requestManager.transformRequest(a,n.ResourceType.Style);n.getJSON(m,(v,b)=>{v?this.fire(new n.ErrorEvent(v)):b&&this._updateDiff(b,t)})}else typeof p=="object"&&this._updateDiff(p,t)}_updateDiff(p,t){try{this.style.setState(p)&&this._update(!0)}catch(a){n.warnOnce(`Unable to perform style diff: ${a.message||a.error||a}.  Rebuilding the style from scratch.`),this._updateStyle(p,t)}}getStyle(){if(this.style)return this.style.serialize()}isStyleLoaded(){return this.style?this.style.loaded():(n.warnOnce("There is no style added to the map."),!1)}addSource(p,t){return this._lazyInitEmptyStyle(),this.style.addSource(p,t),this._update(!0)}isSourceLoaded(p){return!!this.style&&this.style._isSourceCacheLoaded(p)}areTilesLoaded(){const p=this.style&&this.style._sourceCaches;for(const t in p){const a=p[t]._tiles;for(const m in a){const v=a[m];if(v.state!=="loaded"&&v.state!=="errored")return!1}}return!0}addSourceType(p,t,a){this._lazyInitEmptyStyle(),this.style.addSourceType(p,t,a)}removeSource(p){return this.style.removeSource(p),this._updateTerrain(),this._update(!0)}getSource(p){return this.style.getSource(p)}addImage(p,t,{pixelRatio:a=1,sdf:m=!1,stretchX:v,stretchY:b,content:S}={}){if(this._lazyInitEmptyStyle(),t instanceof n.window.HTMLImageElement||n.window.ImageBitmap&&t instanceof n.window.ImageBitmap){const{width:k,height:D,data:O}=n.exported.getImageData(t);this.style.addImage(p,{data:new n.RGBAImage({width:k,height:D},O),pixelRatio:a,stretchX:v,stretchY:b,content:S,sdf:m,version:0})}else if(t.width===void 0||t.height===void 0)this.fire(new n.ErrorEvent(new Error("Invalid arguments to map.addImage(). The second argument must be an `HTMLImageElement`, `ImageData`, `ImageBitmap`, or object with `width`, `height`, and `data` properties with the same format as `ImageData`")));else{const{width:k,height:D}=t,O=t;this.style.addImage(p,{data:new n.RGBAImage({width:k,height:D},new Uint8Array(O.data)),pixelRatio:a,stretchX:v,stretchY:b,content:S,sdf:m,version:0,userImage:O}),O.onAdd&&O.onAdd(this,p)}}updateImage(p,t){const a=this.style.getImage(p);if(!a)return void this.fire(new n.ErrorEvent(new Error("The map has no image with that id. If you are adding a new image use `map.addImage(...)` instead.")));const m=t instanceof n.window.HTMLImageElement||n.window.ImageBitmap&&t instanceof n.window.ImageBitmap?n.exported.getImageData(t):t,{width:v,height:b}=m;v!==void 0&&b!==void 0?v===a.data.width&&b===a.data.height?(a.data.replace(m.data,!(t instanceof n.window.HTMLImageElement||n.window.ImageBitmap&&t instanceof n.window.ImageBitmap)),this.style.updateImage(p,a)):this.fire(new n.ErrorEvent(new Error(`The width and height of the updated image (${v}, ${b})
                must be that same as the previous version of the image
                (${a.data.width}, ${a.data.height})`))):this.fire(new n.ErrorEvent(new Error("Invalid arguments to map.updateImage(). The second argument must be an `HTMLImageElement`, `ImageData`, `ImageBitmap`, or object with `width`, `height`, and `data` properties with the same format as `ImageData`")))}hasImage(p){return p?!!this.style.getImage(p):(this.fire(new n.ErrorEvent(new Error("Missing required image id"))),!1)}removeImage(p){this.style.removeImage(p)}loadImage(p,t){n.getImage(this._requestManager.transformRequest(p,n.ResourceType.Image),(a,m)=>{t(a,m instanceof n.window.HTMLImageElement?n.exported.getImageData(m):m)})}listImages(){return this.style.listImages()}addLayer(p,t){return this._lazyInitEmptyStyle(),this.style.addLayer(p,t),this._update(!0)}moveLayer(p,t){return this.style.moveLayer(p,t),this._update(!0)}removeLayer(p){return this.style.removeLayer(p),this._update(!0)}getLayer(p){return this.style.getLayer(p)}setLayerZoomRange(p,t,a){return this.style.setLayerZoomRange(p,t,a),this._update(!0)}setFilter(p,t,a={}){return this.style.setFilter(p,t,a),this._update(!0)}getFilter(p){return this.style.getFilter(p)}setPaintProperty(p,t,a,m={}){return this.style.setPaintProperty(p,t,a,m),this._update(!0)}getPaintProperty(p,t){return this.style.getPaintProperty(p,t)}setLayoutProperty(p,t,a,m={}){return this.style.setLayoutProperty(p,t,a,m),this._update(!0)}getLayoutProperty(p,t){return this.style.getLayoutProperty(p,t)}setLight(p,t={}){return this._lazyInitEmptyStyle(),this.style.setLight(p,t),this._update(!0)}getLight(){return this.style.getLight()}setTerrain(p){return this._lazyInitEmptyStyle(),!p&&this.transform.projection.requiresDraping?this.style.setTerrainForDraping():this.style.setTerrain(p),this._averageElevationLastSampledAt=-1/0,this._update(!0)}getTerrain(){return this.style?this.style.getTerrain():null}setFog(p){return this._lazyInitEmptyStyle(),this.style.setFog(p),this._update(!0)}getFog(){return this.style?this.style.getFog():null}_queryFogOpacity(p){return this.style&&this.style.fog?this.style.fog.getOpacityAtLatLng(n.LngLat.convert(p),this.transform):0}setFeatureState(p,t){return this.style.setFeatureState(p,t),this._update()}removeFeatureState(p,t){return this.style.removeFeatureState(p,t),this._update()}getFeatureState(p){return this.style.getFeatureState(p)}_updateContainerDimensions(){if(!this._container)return;const p=this._container.getBoundingClientRect().width||400,t=this._container.getBoundingClientRect().height||300;let a,m,v,b=this._container;for(;b&&(!m||!v);){const S=n.window.getComputedStyle(b).transform;S&&S!=="none"&&(a=S.match(/matrix.*\((.+)\)/)[1].split(", "),a[0]&&a[0]!=="0"&&a[0]!=="1"&&(m=a[0]),a[3]&&a[3]!=="0"&&a[3]!=="1"&&(v=a[3])),b=b.parentElement}this._containerWidth=m?Math.abs(p/m):p,this._containerHeight=v?Math.abs(t/v):t}_detectMissingCSS(){n.window.getComputedStyle(this._missingCSSCanary).getPropertyValue("background-color")!=="rgb(250, 128, 114)"&&n.warnOnce("This page appears to be missing CSS declarations for Mapbox GL JS, which may cause the map to display incorrectly. Please ensure your page includes mapbox-gl.css, as described in https://www.mapbox.com/mapbox-gl-js/api/.")}_setupContainer(){const p=this._container;p.classList.add("mapboxgl-map"),(this._missingCSSCanary=P("div","mapboxgl-canary",p)).style.visibility="hidden",this._detectMissingCSS();const t=this._canvasContainer=P("div","mapboxgl-canvas-container",p);this._interactive&&t.classList.add("mapboxgl-interactive"),this._canvas=P("canvas","mapboxgl-canvas",t),this._canvas.addEventListener("webglcontextlost",this._contextLost,!1),this._canvas.addEventListener("webglcontextrestored",this._contextRestored,!1),this._canvas.setAttribute("tabindex","0"),this._canvas.setAttribute("aria-label",this._getUIString("Map.Title")),this._canvas.setAttribute("role","region"),this._updateContainerDimensions(),this._resizeCanvas(this._containerWidth,this._containerHeight);const a=this._controlContainer=P("div","mapboxgl-control-container",p),m=this._controlPositions={};["top-left","top-right","bottom-left","bottom-right"].forEach(v=>{m[v]=P("div",`mapboxgl-ctrl-${v}`,a)}),this._container.addEventListener("scroll",this._onMapScroll,!1)}_resizeCanvas(p,t){const a=n.exported.devicePixelRatio||1;this._canvas.width=a*Math.ceil(p),this._canvas.height=a*Math.ceil(t),this._canvas.style.width=`${p}px`,this._canvas.style.height=`${t}px`}_addMarker(p){this._markers.push(p)}_removeMarker(p){const t=this._markers.indexOf(p);t!==-1&&this._markers.splice(t,1)}_setupPainter(){const p=n.extend({},T.webGLContextAttributes,{failIfMajorPerformanceCaveat:this._failIfMajorPerformanceCaveat,preserveDrawingBuffer:this._preserveDrawingBuffer,antialias:this._antialias||!1}),t=this._canvas.getContext("webgl",p)||this._canvas.getContext("experimental-webgl",p);t?(n.storeAuthState(t,!0),this.painter=new wl(t,this.transform),this.on("data",a=>{a.dataType==="source"&&this.painter.setTileLoadedFlag(!0)}),n.exported$1.testSupport(t)):this.fire(new n.ErrorEvent(new Error("Failed to initialize WebGL")))}_contextLost(p){p.preventDefault(),this._frame&&(this._frame.cancel(),this._frame=null),this.fire(new n.Event("webglcontextlost",{originalEvent:p}))}_contextRestored(p){this._setupPainter(),this.resize(),this._update(),this.fire(new n.Event("webglcontextrestored",{originalEvent:p}))}_onMapScroll(p){if(p.target===this._container)return this._container.scrollTop=0,this._container.scrollLeft=0,!1}loaded(){return!this._styleDirty&&!this._sourcesDirty&&!!this.style&&this.style.loaded()}_update(p){return this.style?(this._styleDirty=this._styleDirty||p,this._sourcesDirty=!0,this.triggerRepaint(),this):this}_requestRenderFrame(p){return this._update(),this._renderTaskQueue.add(p)}_cancelRenderFrame(p){this._renderTaskQueue.remove(p)}_requestDomTask(p){!this.loaded()||this.loaded()&&!this.isMoving()?p():this._domRenderTaskQueue.add(p)}_render(p){let t;const a=this.painter.context.extTimerQuery,m=n.exported.now();if(this.listens("gpu-timing-frame")&&(t=a.createQueryEXT(),a.beginQueryEXT(a.TIME_ELAPSED_EXT,t)),this.painter.context.setDirty(),this.painter.setBaseState(),this._renderTaskQueue.run(p),this._domRenderTaskQueue.run(p),this._removed)return;this.getProjection().name==="globe"&&(this.transform.zoom>=n.GLOBE_ZOOM_THRESHOLD_MAX?this.transform.projection.name==="globe"&&this._updateProjection():this.transform.projection.name==="mercator"&&this._updateProjection());let v=!1;const b=this._isInitialLoad?0:this._fadeDuration;if(this.style&&this._styleDirty){this._styleDirty=!1;const D=this.transform.zoom,O=this.transform.pitch,V=n.exported.now();this.style.zoomHistory.update(D,V);const G=new n.EvaluationParameters(D,{now:V,fadeDuration:b,pitch:O,zoomHistory:this.style.zoomHistory,transition:this.style.getTransition()}),X=G.crossFadingFactor();X===1&&X===this._crossFadingFactor||(v=!0,this._crossFadingFactor=X),this.style.update(G)}this.style&&this.style.fog&&this.style.fog.hasTransition()&&(this.style._markersNeedUpdate=!0,this._sourcesDirty=!0);let S=!1;if(this.style&&this._sourcesDirty?(this._sourcesDirty=!1,this.painter._updateFog(this.style),this._updateTerrain(),S=this._updateAverageElevation(m),this.style._updateSources(this.transform),this._forceMarkerUpdate()):S=this._updateAverageElevation(m),this._placementDirty=this.style&&this.style._updatePlacement(this.painter.transform,this.showCollisionBoxes,b,this._crossSourceCollisions),this.style&&this.painter.render(this.style,{showTileBoundaries:this.showTileBoundaries,showTerrainWireframe:this.showTerrainWireframe,showOverdrawInspector:this._showOverdrawInspector,showQueryGeometry:!!this._showQueryGeometry,rotating:this.isRotating(),zooming:this.isZooming(),moving:this.isMoving(),fadeDuration:b,isInitialLoad:this._isInitialLoad,showPadding:this.showPadding,gpuTiming:!!this.listens("gpu-timing-layer"),gpuTimingDeferredRender:!!this.listens("gpu-timing-deferred-render"),speedIndexTiming:this.speedIndexTiming}),this.fire(new n.Event("render")),this.loaded()&&!this._loaded&&(this._loaded=!0,this.fire(new n.Event("load"))),this.style&&(this.style.hasTransitions()||v)&&(this._styleDirty=!0),this.style&&!this._placementDirty&&this.style._releaseSymbolFadeTiles(),t){const D=n.exported.now()-m;a.endQueryEXT(a.TIME_ELAPSED_EXT,t),setTimeout(()=>{const O=a.getQueryObjectEXT(t,a.QUERY_RESULT_EXT)/1e6;a.deleteQueryEXT(t),this.fire(new n.Event("gpu-timing-frame",{cpuTime:D,gpuTime:O})),n.window.performance.mark("frame-gpu",{startTime:m,detail:{gpuTime:O}})},50)}if(this.listens("gpu-timing-layer")){const D=this.painter.collectGpuTimers();setTimeout(()=>{const O=this.painter.queryGpuTimers(D);this.fire(new n.Event("gpu-timing-layer",{layerTimes:O}))},50)}if(this.listens("gpu-timing-deferred-render")){const D=this.painter.collectDeferredRenderGpuQueries();setTimeout(()=>{const O=this.painter.queryGpuTimeDeferredRender(D);this.fire(new n.Event("gpu-timing-deferred-render",{gpuTime:O}))},50)}const k=this._sourcesDirty||this._styleDirty||this._placementDirty||S;if(k||this._repaint)this.triggerRepaint();else{const D=!this.isMoving()&&this.loaded();if(D&&(S=this._updateAverageElevation(m,!0)),S)this.triggerRepaint();else if(this._triggerFrame(!1),D&&(this.fire(new n.Event("idle")),this._isInitialLoad=!1,this.speedIndexTiming)){const O=this._calculateSpeedIndex();this.fire(new n.Event("speedindexcompleted",{speedIndex:O})),this.speedIndexTiming=!1}}!this._loaded||this._fullyLoaded||k||(this._fullyLoaded=!0,this._authenticate())}_forceMarkerUpdate(){for(const p of this._markers)p._update()}_updateAverageElevation(p,t=!1){const a=m=>(this.transform.averageElevation=m,this._update(!1),!0);if(!this.painter.averageElevationNeedsEasing())return this.transform.averageElevation!==0&&a(0);if((t||p-this._averageElevationLastSampledAt>500)&&!this._averageElevation.isEasing(p)){const m=this.transform.averageElevation;let v=this.transform.sampleAverageElevation(),b=!1;this.transform.elevation&&(b=this.transform.elevation.exaggeration()!==this._averageElevationExaggeration,this._averageElevationExaggeration=this.transform.elevation.exaggeration()),isNaN(v)?v=0:this._averageElevationLastSampledAt=p;const S=Math.abs(m-v);if(S>1){if(this._isInitialLoad||b)return this._averageElevation.jumpTo(v),a(v);this._averageElevation.easeTo(v,p,300)}else if(S>1e-4)return this._averageElevation.jumpTo(v),a(v)}return!!this._averageElevation.isEasing(p)&&a(this._averageElevation.getValue(p))}_authenticate(){n.getMapSessionAPI(this._getMapId(),this._requestManager._skuToken,this._requestManager._customAccessToken,p=>{if(p&&(p.message===n.AUTH_ERR_MSG||p.status===401)){const t=this.painter.context.gl;n.storeAuthState(t,!1),this._logoControl instanceof Nc&&this._logoControl._updateLogo(),t&&t.clear(t.DEPTH_BUFFER_BIT|t.COLOR_BUFFER_BIT|t.STENCIL_BUFFER_BIT),this._silenceAuthErrors||this.fire(new n.ErrorEvent(new Error("A valid Mapbox access token is required to use Mapbox GL JS. To create an account or a new access token, visit https://account.mapbox.com/")))}}),n.postMapLoadEvent(this._getMapId(),this._requestManager._skuToken,this._requestManager._customAccessToken,()=>{})}_updateTerrain(){this.painter.updateTerrain(this.style,this.isMoving()||this.isRotating()||this.isZooming())}_calculateSpeedIndex(){const p=this.painter.canvasCopy(),t=this.painter.getCanvasCopiesAndTimestamps();t.timeStamps.push(performance.now());const a=this.painter.context.gl,m=a.createFramebuffer();function v(b){a.framebufferTexture2D(a.FRAMEBUFFER,a.COLOR_ATTACHMENT0,a.TEXTURE_2D,b,0);const S=new Uint8Array(a.drawingBufferWidth*a.drawingBufferHeight*4);return a.readPixels(0,0,a.drawingBufferWidth,a.drawingBufferHeight,a.RGBA,a.UNSIGNED_BYTE,S),S}return a.bindFramebuffer(a.FRAMEBUFFER,m),this._canvasPixelComparison(v(p),t.canvasCopies.map(v),t.timeStamps)}_canvasPixelComparison(p,t,a){let m=a[1]-a[0];const v=p.length/4;for(let b=0;b<t.length;b++){const S=t[b];let k=0;for(let D=0;D<S.length;D+=4)S[D]===p[D]&&S[D+1]===p[D+1]&&S[D+2]===p[D+2]&&S[D+3]===p[D+3]&&(k+=1);m+=(a[b+2]-a[b+1])*(1-k/v)}return m}remove(){this._hash&&this._hash.remove();for(const t of this._controls)t.onRemove(this);this._controls=[],this._frame&&(this._frame.cancel(),this._frame=null),this._renderTaskQueue.clear(),this._domRenderTaskQueue.clear(),this.style&&this.style.destroy(),this.painter.destroy(),this.handlers&&this.handlers.destroy(),this.handlers=void 0,this.setStyle(null),n.window!==void 0&&(n.window.removeEventListener("resize",this._onWindowResize,!1),n.window.removeEventListener("orientationchange",this._onWindowResize,!1),n.window.removeEventListener("webkitfullscreenchange",this._onWindowResize,!1),n.window.removeEventListener("online",this._onWindowOnline,!1));const p=this.painter.context.gl.getExtension("WEBGL_lose_context");p&&p.loseContext(),Ol(this._canvasContainer),Ol(this._controlContainer),Ol(this._missingCSSCanary),this._container.classList.remove("mapboxgl-map"),n.removeAuthState(this.painter.context.gl),this._removed=!0,this.fire(new n.Event("remove"))}triggerRepaint(){this._triggerFrame(!0)}_triggerFrame(p){this._renderNextFrame=this._renderNextFrame||p,this.style&&!this._frame&&(this._frame=n.exported.frame(t=>{const a=!!this._renderNextFrame;this._frame=null,this._renderNextFrame=null,a&&this._render(t)}))}_preloadTiles(p){const t=this.style?Object.values(this.style._sourceCaches):[];return n.asyncAll(t,(a,m)=>a._preloadTiles(p,m),()=>{this.triggerRepaint()}),this}_onWindowOnline(){this._update()}_onWindowResize(p){this._trackResize&&this.resize({originalEvent:p})._update()}get showTileBoundaries(){return!!this._showTileBoundaries}set showTileBoundaries(p){this._showTileBoundaries!==p&&(this._showTileBoundaries=p,this._update())}get showTerrainWireframe(){return!!this._showTerrainWireframe}set showTerrainWireframe(p){this._showTerrainWireframe!==p&&(this._showTerrainWireframe=p,this._update())}get speedIndexTiming(){return!!this._speedIndexTiming}set speedIndexTiming(p){this._speedIndexTiming!==p&&(this._speedIndexTiming=p,this._update())}get showPadding(){return!!this._showPadding}set showPadding(p){this._showPadding!==p&&(this._showPadding=p,this._update())}get showCollisionBoxes(){return!!this._showCollisionBoxes}set showCollisionBoxes(p){this._showCollisionBoxes!==p&&(this._showCollisionBoxes=p,p?this.style._generateCollisionBoxes():this._update())}get showOverdrawInspector(){return!!this._showOverdrawInspector}set showOverdrawInspector(p){this._showOverdrawInspector!==p&&(this._showOverdrawInspector=p,this._update())}get repaint(){return!!this._repaint}set repaint(p){this._repaint!==p&&(this._repaint=p,this.triggerRepaint())}get vertices(){return!!this._vertices}set vertices(p){this._vertices=p,this._update()}_setCacheLimits(p,t){n.setCacheLimits(p,t)}get version(){return n.version}},NavigationControl:class{constructor(p){this.options=n.extend({},Dh,p),this._container=P("div","mapboxgl-ctrl mapboxgl-ctrl-group"),this._container.addEventListener("contextmenu",t=>t.preventDefault()),this.options.showZoom&&(n.bindAll(["_setButtonTitle","_updateZoomButtons"],this),this._zoomInButton=this._createButton("mapboxgl-ctrl-zoom-in",t=>{this._map&&this._map.zoomIn({},{originalEvent:t})}),P("span","mapboxgl-ctrl-icon",this._zoomInButton).setAttribute("aria-hidden","true"),this._zoomOutButton=this._createButton("mapboxgl-ctrl-zoom-out",t=>{this._map&&this._map.zoomOut({},{originalEvent:t})}),P("span","mapboxgl-ctrl-icon",this._zoomOutButton).setAttribute("aria-hidden","true")),this.options.showCompass&&(n.bindAll(["_rotateCompassArrow"],this),this._compass=this._createButton("mapboxgl-ctrl-compass",t=>{const a=this._map;a&&(this.options.visualizePitch?a.resetNorthPitch({},{originalEvent:t}):a.resetNorth({},{originalEvent:t}))}),this._compassIcon=P("span","mapboxgl-ctrl-icon",this._compass),this._compassIcon.setAttribute("aria-hidden","true"))}_updateZoomButtons(){const p=this._map;if(!p)return;const t=p.getZoom(),a=t===p.getMaxZoom(),m=t===p.getMinZoom();this._zoomInButton.disabled=a,this._zoomOutButton.disabled=m,this._zoomInButton.setAttribute("aria-disabled",a.toString()),this._zoomOutButton.setAttribute("aria-disabled",m.toString())}_rotateCompassArrow(){const p=this._map;if(!p)return;const t=this.options.visualizePitch?`scale(${1/Math.pow(Math.cos(p.transform.pitch*(Math.PI/180)),.5)}) rotateX(${p.transform.pitch}deg) rotateZ(${p.transform.angle*(180/Math.PI)}deg)`:`rotate(${p.transform.angle*(180/Math.PI)}deg)`;p._requestDomTask(()=>{this._compassIcon&&(this._compassIcon.style.transform=t)})}onAdd(p){return this._map=p,this.options.showZoom&&(this._setButtonTitle(this._zoomInButton,"ZoomIn"),this._setButtonTitle(this._zoomOutButton,"ZoomOut"),p.on("zoom",this._updateZoomButtons),this._updateZoomButtons()),this.options.showCompass&&(this._setButtonTitle(this._compass,"ResetBearing"),this.options.visualizePitch&&p.on("pitch",this._rotateCompassArrow),p.on("rotate",this._rotateCompassArrow),this._rotateCompassArrow(),this._handler=new Lh(p,this._compass,this.options.visualizePitch)),this._container}onRemove(){const p=this._map;p&&(this._container.remove(),this.options.showZoom&&p.off("zoom",this._updateZoomButtons),this.options.showCompass&&(this.options.visualizePitch&&p.off("pitch",this._rotateCompassArrow),p.off("rotate",this._rotateCompassArrow),this._handler&&this._handler.off(),this._handler=void 0),this._map=void 0)}_createButton(p,t){const a=P("button",p,this._container);return a.type="button",a.addEventListener("click",t),a}_setButtonTitle(p,t){if(!this._map)return;const a=this._map._getUIString(`NavigationControl.${t}`);p.setAttribute("aria-label",a),p.firstElementChild&&p.firstElementChild.setAttribute("title",a)}},GeolocateControl:class extends n.Evented{constructor(p){super(),this.options=n.extend({geolocation:n.window.navigator.geolocation},Zc,p),n.bindAll(["_onSuccess","_onError","_onZoom","_finish","_setupUI","_updateCamera","_updateMarker","_updateMarkerRotation","_onDeviceOrientation"],this),this._updateMarkerRotationThrottled=va(this._updateMarkerRotation,20),this._numberOfWatches=0}onAdd(p){return this._map=p,this._container=P("div","mapboxgl-ctrl mapboxgl-ctrl-group"),this._checkGeolocationSupport(this._setupUI),this._container}onRemove(){this._geolocationWatchID!==void 0&&(this.options.geolocation.clearWatch(this._geolocationWatchID),this._geolocationWatchID=void 0),this.options.showUserLocation&&this._userLocationDotMarker&&this._userLocationDotMarker.remove(),this.options.showAccuracyCircle&&this._accuracyCircleMarker&&this._accuracyCircleMarker.remove(),this._container.remove(),this._map.off("zoom",this._onZoom),this._map=void 0,this._numberOfWatches=0,this._noTimeout=!1}_checkGeolocationSupport(p){this._supportsGeolocation!==void 0?p(this._supportsGeolocation):n.window.navigator.permissions!==void 0?n.window.navigator.permissions.query({name:"geolocation"}).then(t=>{this._supportsGeolocation=t.state!=="denied",p(this._supportsGeolocation)}):(this._supportsGeolocation=!!this.options.geolocation,p(this._supportsGeolocation))}_isOutOfMapMaxBounds(p){const t=this._map.getMaxBounds(),a=p.coords;return!!t&&(a.longitude<t.getWest()||a.longitude>t.getEast()||a.latitude<t.getSouth()||a.latitude>t.getNorth())}_setErrorState(){switch(this._watchState){case"WAITING_ACTIVE":this._watchState="ACTIVE_ERROR",this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-active"),this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-active-error");break;case"ACTIVE_LOCK":this._watchState="ACTIVE_ERROR",this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-active"),this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-active-error"),this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-waiting");break;case"BACKGROUND":this._watchState="BACKGROUND_ERROR",this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-background"),this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-background-error"),this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-waiting")}}_onSuccess(p){if(this._map){if(this._isOutOfMapMaxBounds(p))return this._setErrorState(),this.fire(new n.Event("outofmaxbounds",p)),this._updateMarker(),void this._finish();if(this.options.trackUserLocation)switch(this._lastKnownPosition=p,this._watchState){case"WAITING_ACTIVE":case"ACTIVE_LOCK":case"ACTIVE_ERROR":this._watchState="ACTIVE_LOCK",this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-waiting"),this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-active-error"),this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-active");break;case"BACKGROUND":case"BACKGROUND_ERROR":this._watchState="BACKGROUND",this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-waiting"),this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-background-error"),this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-background")}this.options.showUserLocation&&this._watchState!=="OFF"&&this._updateMarker(p),this.options.trackUserLocation&&this._watchState!=="ACTIVE_LOCK"||this._updateCamera(p),this.options.showUserLocation&&this._dotElement.classList.remove("mapboxgl-user-location-dot-stale"),this.fire(new n.Event("geolocate",p)),this._finish()}}_updateCamera(p){const t=new n.LngLat(p.coords.longitude,p.coords.latitude),a=p.coords.accuracy,m=this._map.getBearing(),v=n.extend({bearing:m},this.options.fitBoundsOptions);this._map.fitBounds(t.toBounds(a),v,{geolocateSource:!0})}_updateMarker(p){if(p){const t=new n.LngLat(p.coords.longitude,p.coords.latitude);this._accuracyCircleMarker.setLngLat(t).addTo(this._map),this._userLocationDotMarker.setLngLat(t).addTo(this._map),this._accuracy=p.coords.accuracy,this.options.showUserLocation&&this.options.showAccuracyCircle&&this._updateCircleRadius()}else this._userLocationDotMarker.remove(),this._accuracyCircleMarker.remove()}_updateCircleRadius(){const p=this._map.transform,t=n.mercatorZfromAltitude(1,p._center.lat)*p.worldSize,a=Math.ceil(2*this._accuracy*t);this._circleElement.style.width=`${a}px`,this._circleElement.style.height=`${a}px`}_onZoom(){this.options.showUserLocation&&this.options.showAccuracyCircle&&this._updateCircleRadius()}_updateMarkerRotation(){this._userLocationDotMarker&&typeof this._heading=="number"?(this._userLocationDotMarker.setRotation(this._heading),this._dotElement.classList.add("mapboxgl-user-location-show-heading")):(this._dotElement.classList.remove("mapboxgl-user-location-show-heading"),this._userLocationDotMarker.setRotation(0))}_onError(p){if(this._map){if(this.options.trackUserLocation)if(p.code===1){this._watchState="OFF",this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-waiting"),this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-active"),this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-active-error"),this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-background"),this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-background-error"),this._geolocateButton.disabled=!0;const t=this._map._getUIString("GeolocateControl.LocationNotAvailable");this._geolocateButton.setAttribute("aria-label",t),this._geolocateButton.firstElementChild&&this._geolocateButton.firstElementChild.setAttribute("title",t),this._geolocationWatchID!==void 0&&this._clearWatch()}else{if(p.code===3&&this._noTimeout)return;this._setErrorState()}this._watchState!=="OFF"&&this.options.showUserLocation&&this._dotElement.classList.add("mapboxgl-user-location-dot-stale"),this.fire(new n.Event("error",p)),this._finish()}}_finish(){this._timeoutId&&clearTimeout(this._timeoutId),this._timeoutId=void 0}_setupUI(p){if(this._container.addEventListener("contextmenu",t=>t.preventDefault()),this._geolocateButton=P("button","mapboxgl-ctrl-geolocate",this._container),P("span","mapboxgl-ctrl-icon",this._geolocateButton).setAttribute("aria-hidden","true"),this._geolocateButton.type="button",p===!1){n.warnOnce("Geolocation support is not available so the GeolocateControl will be disabled.");const t=this._map._getUIString("GeolocateControl.LocationNotAvailable");this._geolocateButton.disabled=!0,this._geolocateButton.setAttribute("aria-label",t),this._geolocateButton.firstElementChild&&this._geolocateButton.firstElementChild.setAttribute("title",t)}else{const t=this._map._getUIString("GeolocateControl.FindMyLocation");this._geolocateButton.setAttribute("aria-label",t),this._geolocateButton.firstElementChild&&this._geolocateButton.firstElementChild.setAttribute("title",t)}this.options.trackUserLocation&&(this._geolocateButton.setAttribute("aria-pressed","false"),this._watchState="OFF"),this.options.showUserLocation&&(this._dotElement=P("div","mapboxgl-user-location"),this._dotElement.appendChild(P("div","mapboxgl-user-location-dot")),this._dotElement.appendChild(P("div","mapboxgl-user-location-heading")),this._userLocationDotMarker=new Bl({element:this._dotElement,rotationAlignment:"map",pitchAlignment:"map"}),this._circleElement=P("div","mapboxgl-user-location-accuracy-circle"),this._accuracyCircleMarker=new Bl({element:this._circleElement,pitchAlignment:"map"}),this.options.trackUserLocation&&(this._watchState="OFF"),this._map.on("zoom",this._onZoom)),this._geolocateButton.addEventListener("click",this.trigger.bind(this)),this._setup=!0,this.options.trackUserLocation&&this._map.on("movestart",t=>{t.geolocateSource||this._watchState!=="ACTIVE_LOCK"||t.originalEvent&&t.originalEvent.type==="resize"||(this._watchState="BACKGROUND",this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-background"),this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-active"),this.fire(new n.Event("trackuserlocationend")))})}_onDeviceOrientation(p){this._userLocationDotMarker&&(p.webkitCompassHeading?this._heading=p.webkitCompassHeading:p.absolute===!0&&(this._heading=-1*p.alpha),this._updateMarkerRotationThrottled())}trigger(){if(!this._setup)return n.warnOnce("Geolocate control triggered before added to a map"),!1;if(this.options.trackUserLocation){switch(this._watchState){case"OFF":this._watchState="WAITING_ACTIVE",this.fire(new n.Event("trackuserlocationstart"));break;case"WAITING_ACTIVE":case"ACTIVE_LOCK":case"ACTIVE_ERROR":case"BACKGROUND_ERROR":this._numberOfWatches--,this._noTimeout=!1,this._watchState="OFF",this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-waiting"),this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-active"),this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-active-error"),this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-background"),this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-background-error"),this.fire(new n.Event("trackuserlocationend"));break;case"BACKGROUND":this._watchState="ACTIVE_LOCK",this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-background"),this._lastKnownPosition&&this._updateCamera(this._lastKnownPosition),this.fire(new n.Event("trackuserlocationstart"))}switch(this._watchState){case"WAITING_ACTIVE":this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-waiting"),this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-active");break;case"ACTIVE_LOCK":this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-active");break;case"ACTIVE_ERROR":this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-waiting"),this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-active-error");break;case"BACKGROUND":this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-background");break;case"BACKGROUND_ERROR":this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-waiting"),this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-background-error")}if(this._watchState==="OFF"&&this._geolocationWatchID!==void 0)this._clearWatch();else if(this._geolocationWatchID===void 0){let p;this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-waiting"),this._geolocateButton.setAttribute("aria-pressed","true"),this._numberOfWatches++,this._numberOfWatches>1?(p={maximumAge:6e5,timeout:0},this._noTimeout=!0):(p=this.options.positionOptions,this._noTimeout=!1),this._geolocationWatchID=this.options.geolocation.watchPosition(this._onSuccess,this._onError,p),this.options.showUserHeading&&this._addDeviceOrientationListener()}}else this.options.geolocation.getCurrentPosition(this._onSuccess,this._onError,this.options.positionOptions),this._timeoutId=setTimeout(this._finish,1e4);return!0}_addDeviceOrientationListener(){const p=()=>{n.window.addEventListener("ondeviceorientationabsolute"in n.window?"deviceorientationabsolute":"deviceorientation",this._onDeviceOrientation)};n.window.DeviceMotionEvent!==void 0&&typeof n.window.DeviceMotionEvent.requestPermission=="function"?DeviceOrientationEvent.requestPermission().then(t=>{t==="granted"&&p()}).catch(console.error):p()}_clearWatch(){this.options.geolocation.clearWatch(this._geolocationWatchID),n.window.removeEventListener("deviceorientation",this._onDeviceOrientation),n.window.removeEventListener("deviceorientationabsolute",this._onDeviceOrientation),this._geolocationWatchID=void 0,this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-waiting"),this._geolocateButton.setAttribute("aria-pressed","false"),this.options.showUserLocation&&this._updateMarker(null)}},AttributionControl:Vc,ScaleControl:class{constructor(p){this.options=n.extend({},Rh,p),function(){try{return new Intl.NumberFormat("en",{style:"unit",unitDisplay:"narrow",unit:"meter"}),!0}catch{return!1}}()||(this._setScale=$c.bind(this)),n.bindAll(["_update","_setScale","setUnit"],this)}getDefaultPosition(){return"bottom-left"}_update(){const p=this.options.maxWidth||100,t=this._map,a=t._containerHeight/2,m=t._containerWidth/2-p/2,v=t.unproject([m,a]),b=t.unproject([m+p,a]),S=v.distanceTo(b);if(this.options.unit==="imperial"){const k=3.2808*S;k>5280?this._setScale(p,k/5280,"mile"):this._setScale(p,k,"foot")}else this.options.unit==="nautical"?this._setScale(p,S/1852,"nautical-mile"):S>=1e3?this._setScale(p,S/1e3,"kilometer"):this._setScale(p,S,"meter")}_setScale(p,t,a){const m=Wc(t),v=m/t;this._map._requestDomTask(()=>{this._container.style.width=p*v+"px",this._container.innerHTML=a!=="nautical-mile"?new Intl.NumberFormat(this._language,{style:"unit",unitDisplay:"narrow",unit:a}).format(m):`${m}&nbsp;nm`})}onAdd(p){return this._map=p,this._language=p.getLanguage(),this._container=P("div","mapboxgl-ctrl mapboxgl-ctrl-scale",p.getContainer()),this._container.dir="auto",this._map.on("move",this._update),this._update(),this._container}onRemove(){this._container.remove(),this._map.off("move",this._update),this._map=void 0}_setLanguage(p){this._language=p,this._update()}setUnit(p){this.options.unit=p,this._update()}},FullscreenControl:class{constructor(p){this._fullscreen=!1,p&&p.container&&(p.container instanceof n.window.HTMLElement?this._container=p.container:n.warnOnce("Full screen control 'container' must be a DOM element.")),n.bindAll(["_onClickFullscreen","_changeIcon"],this),"onfullscreenchange"in n.window.document?this._fullscreenchange="fullscreenchange":"onwebkitfullscreenchange"in n.window.document&&(this._fullscreenchange="webkitfullscreenchange")}onAdd(p){return this._map=p,this._container||(this._container=this._map.getContainer()),this._controlContainer=P("div","mapboxgl-ctrl mapboxgl-ctrl-group"),this._checkFullscreenSupport()?this._setupUI():(this._controlContainer.style.display="none",n.warnOnce("This device does not support fullscreen mode.")),this._controlContainer}onRemove(){this._controlContainer.remove(),this._map=null,n.window.document.removeEventListener(this._fullscreenchange,this._changeIcon)}_checkFullscreenSupport(){return!(!n.window.document.fullscreenEnabled&&!n.window.document.webkitFullscreenEnabled)}_setupUI(){const p=this._fullscreenButton=P("button","mapboxgl-ctrl-fullscreen",this._controlContainer);P("span","mapboxgl-ctrl-icon",p).setAttribute("aria-hidden","true"),p.type="button",this._updateTitle(),this._fullscreenButton.addEventListener("click",this._onClickFullscreen),n.window.document.addEventListener(this._fullscreenchange,this._changeIcon)}_updateTitle(){const p=this._getTitle();this._fullscreenButton.setAttribute("aria-label",p),this._fullscreenButton.firstElementChild&&this._fullscreenButton.firstElementChild.setAttribute("title",p)}_getTitle(){return this._map._getUIString(this._isFullscreen()?"FullscreenControl.Exit":"FullscreenControl.Enter")}_isFullscreen(){return this._fullscreen}_changeIcon(){(n.window.document.fullscreenElement||n.window.document.webkitFullscreenElement)===this._container!==this._fullscreen&&(this._fullscreen=!this._fullscreen,this._fullscreenButton.classList.toggle("mapboxgl-ctrl-shrink"),this._fullscreenButton.classList.toggle("mapboxgl-ctrl-fullscreen"),this._updateTitle())}_onClickFullscreen(){this._isFullscreen()?n.window.document.exitFullscreen?n.window.document.exitFullscreen():n.window.document.webkitCancelFullScreen&&n.window.document.webkitCancelFullScreen():this._container.requestFullscreen?this._container.requestFullscreen():this._container.webkitRequestFullscreen&&this._container.webkitRequestFullscreen()}},Popup:class extends n.Evented{constructor(p){super(),this.options=n.extend(Object.create(Xc),p),n.bindAll(["_update","_onClose","remove","_onMouseEvent"],this),this._classList=new Set(p&&p.className?p.className.trim().split(/\s+/):[])}addTo(p){return this._map&&this.remove(),this._map=p,this.options.closeOnClick&&p.on("preclick",this._onClose),this.options.closeOnMove&&p.on("move",this._onClose),p.on("remove",this.remove),this._update(),this._focusFirstElement(),this._trackPointer?(p.on("mousemove",this._onMouseEvent),p.on("mouseup",this._onMouseEvent),p._canvasContainer.classList.add("mapboxgl-track-pointer")):p.on("move",this._update),this.fire(new n.Event("open")),this}isOpen(){return!!this._map}remove(){this._content&&this._content.remove(),this._container&&(this._container.remove(),this._container=void 0);const p=this._map;return p&&(p.off("move",this._update),p.off("move",this._onClose),p.off("preclick",this._onClose),p.off("click",this._onClose),p.off("remove",this.remove),p.off("mousemove",this._onMouseEvent),p.off("mouseup",this._onMouseEvent),p.off("drag",this._onMouseEvent),this._map=void 0),this.fire(new n.Event("close")),this}getLngLat(){return this._lngLat}setLngLat(p){this._lngLat=n.LngLat.convert(p),this._pos=null,this._trackPointer=!1,this._update();const t=this._map;return t&&(t.on("move",this._update),t.off("mousemove",this._onMouseEvent),t._canvasContainer.classList.remove("mapboxgl-track-pointer")),this}trackPointer(){this._trackPointer=!0,this._pos=null,this._update();const p=this._map;return p&&(p.off("move",this._update),p.on("mousemove",this._onMouseEvent),p.on("drag",this._onMouseEvent),p._canvasContainer.classList.add("mapboxgl-track-pointer")),this}getElement(){return this._container}setText(p){return this.setDOMContent(n.window.document.createTextNode(p))}setHTML(p){const t=n.window.document.createDocumentFragment(),a=n.window.document.createElement("body");let m;for(a.innerHTML=p;m=a.firstChild,m;)t.appendChild(m);return this.setDOMContent(t)}getMaxWidth(){return this._container&&this._container.style.maxWidth}setMaxWidth(p){return this.options.maxWidth=p,this._update(),this}setDOMContent(p){let t=this._content;if(t)for(;t.hasChildNodes();)t.firstChild&&t.removeChild(t.firstChild);else t=this._content=P("div","mapboxgl-popup-content",this._container||void 0);if(t.appendChild(p),this.options.closeButton){const a=this._closeButton=P("button","mapboxgl-popup-close-button",t);a.type="button",a.setAttribute("aria-label","Close popup"),a.setAttribute("aria-hidden","true"),a.innerHTML="&#215;",a.addEventListener("click",this._onClose)}return this._update(),this._focusFirstElement(),this}addClassName(p){return this._classList.add(p),this._updateClassList(),this}removeClassName(p){return this._classList.delete(p),this._updateClassList(),this}setOffset(p){return this.options.offset=p,this._update(),this}toggleClassName(p){let t;return this._classList.delete(p)?t=!1:(this._classList.add(p),t=!0),this._updateClassList(),t}_onMouseEvent(p){this._update(p.point)}_getAnchor(p){if(this.options.anchor)return this.options.anchor;const t=this._map,a=this._container,m=this._pos;if(!t||!a||!m)return"bottom";const v=a.offsetWidth,b=a.offsetHeight,S=m.x<v/2,k=m.x>t.transform.width-v/2;if(m.y+p<b)return S?"top-left":k?"top-right":"top";if(m.y>t.transform.height-b){if(S)return"bottom-left";if(k)return"bottom-right"}return S?"left":k?"right":"bottom"}_updateClassList(){const p=this._container;if(!p)return;const t=[...this._classList];t.push("mapboxgl-popup"),this._anchor&&t.push(`mapboxgl-popup-anchor-${this._anchor}`),this._trackPointer&&t.push("mapboxgl-popup-track-pointer"),p.className=t.join(" ")}_update(p){const t=this._map,a=this._content;if(!t||!this._lngLat&&!this._trackPointer||!a)return;let m=this._container;if(m||(m=this._container=P("div","mapboxgl-popup",t.getContainer()),this._tip=P("div","mapboxgl-popup-tip",m),m.appendChild(a)),this.options.maxWidth&&m.style.maxWidth!==this.options.maxWidth&&(m.style.maxWidth=this.options.maxWidth),t.transform.renderWorldCopies&&!this._trackPointer&&(this._lngLat=Gc(this._lngLat,this._pos,t.transform)),!this._trackPointer||p){const v=this._pos=this._trackPointer&&p?p:t.project(this._lngLat),b=Fl(this.options.offset),S=this._anchor=this._getAnchor(b.y),k=Fl(this.options.offset,S),D=v.add(k).round();t._requestDomTask(()=>{this._container&&S&&(this._container.style.transform=`${Rl[S]} translate(${D.x}px,${D.y}px)`)})}if(!this._marker&&t._usingGlobe()){const v=n.isLngLatBehindGlobe(t.transform,this._lngLat)?0:1;this._setOpacity(v)}this._updateClassList()}_focusFirstElement(){if(!this.options.focusAfterOpen||!this._container)return;const p=this._container.querySelector(Hc);p&&p.focus()}_onClose(){this.remove()}_setOpacity(p){this._container&&(this._container.style.opacity=`${p}`),this._content&&(this._content.style.pointerEvents=p?"auto":"none")}},Marker:Bl,Style:wn,LngLat:n.LngLat,LngLatBounds:n.LngLatBounds,Point:n.pointGeometry,MercatorCoordinate:n.MercatorCoordinate,FreeCameraOptions:ga,Evented:n.Evented,config:n.config,prewarm:function(){Ti().acquire(jt)},clearPrewarmedResources:function(){const p=ai;p&&(p.isPreloaded()&&p.numActive()===1?(p.release(jt),ai=null):console.warn("Could not clear WebWorkers since there are active Map instances that still reference it. The pre-warmed WebWorker pool can only be cleared when all map instances have been removed with map.remove()"))},get accessToken(){return n.config.ACCESS_TOKEN},set accessToken(p){n.config.ACCESS_TOKEN=p},get baseApiUrl(){return n.config.API_URL},set baseApiUrl(p){n.config.API_URL=p},get workerCount(){return Wt.workerCount},set workerCount(p){Wt.workerCount=p},get maxParallelImageRequests(){return n.config.MAX_PARALLEL_IMAGE_REQUESTS},set maxParallelImageRequests(p){n.config.MAX_PARALLEL_IMAGE_REQUESTS=p},clearStorage(p){n.clearTileCache(p)},workerUrl:"",workerClass:null,setNow:n.exported.setNow,restoreNow:n.exported.restoreNow};return Ul});var y=d;return y})})(gy);var R3=gy.exports;function vy(h,o,l){l===void 0&&(l={});var u={type:"Feature"};return(l.id===0||l.id)&&(u.id=l.id),l.bbox&&(u.bbox=l.bbox),u.properties=o||{},u.geometry=h,u}function B3(h,o,l){l===void 0&&(l={});for(var u=0,d=h;u<d.length;u++){var g=d[u];if(g.length<4)throw new Error("Each LinearRing of a Polygon must have 4 or more Positions.");for(var y=0;y<g[g.length-1].length;y++)if(g[g.length-1][y]!==g[0][y])throw new Error("First and last Position are not equivalent.")}var n={type:"Polygon",coordinates:h};return vy(n,o,l)}function O3(h,o,l){l===void 0&&(l={});var u={type:"MultiPolygon",coordinates:h};return vy(u,o,l)}function xy(h,o,l){if(h!==null)for(var u,d,g,y,n,w,T,M=0,I=0,P,z=h.type,R=z==="FeatureCollection",F=z==="Feature",q=R?h.features.length:1,ae=0;ae<q;ae++){T=R?h.features[ae].geometry:F?h.geometry:h,P=T?T.type==="GeometryCollection":!1,n=P?T.geometries.length:1;for(var se=0;se<n;se++){var ie=0,Q=0;if(y=P?T.geometries[se]:T,y!==null){w=y.coordinates;var re=y.type;switch(M=l&&(re==="Polygon"||re==="MultiPolygon")?1:0,re){case null:break;case"Point":if(o(w,I,ae,ie,Q)===!1)return!1;I++,ie++;break;case"LineString":case"MultiPoint":for(u=0;u<w.length;u++){if(o(w[u],I,ae,ie,Q)===!1)return!1;I++,re==="MultiPoint"&&ie++}re==="LineString"&&ie++;break;case"Polygon":case"MultiLineString":for(u=0;u<w.length;u++){for(d=0;d<w[u].length-M;d++){if(o(w[u][d],I,ae,ie,Q)===!1)return!1;I++}re==="MultiLineString"&&ie++,re==="Polygon"&&Q++}re==="Polygon"&&ie++;break;case"MultiPolygon":for(u=0;u<w.length;u++){for(Q=0,d=0;d<w[u].length;d++){for(g=0;g<w[u][d].length-M;g++){if(o(w[u][d][g],I,ae,ie,Q)===!1)return!1;I++}Q++}ie++}break;case"GeometryCollection":for(u=0;u<y.geometries.length;u++)if(xy(y.geometries[u],o,l)===!1)return!1;break;default:throw new Error("Unknown Geometry Type")}}}}}function Rd(h){var o=[1/0,1/0,-1/0,-1/0];return xy(h,function(l){o[0]>l[0]&&(o[0]=l[0]),o[1]>l[1]&&(o[1]=l[1]),o[2]<l[0]&&(o[2]=l[0]),o[3]<l[1]&&(o[3]=l[1])}),o}Rd.default=Rd;function og(h){let o;const l=h[8].default,u=co(l,h,h[7],null);return{c(){u&&u.c()},l(d){u&&u.l(d)},m(d,g){u&&u.m(d,g),o=!0},p(d,g){u&&u.p&&(!o||g&128)&&uo(u,l,d,d[7],o?po(l,d[7],g,null):ho(d[7]),null)},i(d){o||(Le(u,d),o=!0)},o(d){Xe(u,d),o=!1},d(d){u&&u.d(d)}}}function F3(h){let o,l,u,d,g=h[0]&&og(h);return{c(){o=He("div"),l=bt(),g&&g.c(),u=Gi(),this.h()},l(y){o=Ye(y,"DIV",{id:!0,class:!0}),Ce(o).forEach(W),l=wt(y),g&&g.l(y),u=Gi(),this.h()},h(){H(o,"id",h[3]),H(o,"class","map container svelte-1qscswv")},m(y,n){Me(y,o,n),Me(y,l,n),g&&g.m(y,n),Me(y,u,n),d=!0},p(y,[n]){y[0]?g?(g.p(y,n),n&1&&Le(g,1)):(g=og(y),g.c(),Le(g,1),g.m(u.parentNode,u)):g&&(br(),Xe(g,1,1,()=>{g=null}),wr())},i(y){d||(Le(g),d=!0)},o(y){Xe(g),d=!1},d(y){y&&W(o),y&&W(l),g&&g.d(y),y&&W(u)}}}let sg=0;function U3(h,o,l){let u,d,g,{$$slots:y={},$$scope:n}=o,{fitShape:w}=o,{resize:T}=o,{bounds:M}=o;const I=kn(null);xt(h,I,F=>l(0,d=F)),qp("map",{MAP:I});const P=kr("theme");xt(h,P,F=>l(10,g=F));const z=`map-${sg}`;function R(F){if(F){const q=Rd(F);d==null||d.fitBounds(q,{animate:!1,padding:{left:10,top:10,right:10,bottom:10}})}}return Zp(()=>{const F=new R3.Map({accessToken:"pk.eyJ1IjoiZmxhdmlvZ29ydGFuYSIsImEiOiJzalRHcS1JIn0.aeJmH09S2p_hjOSs3wuT3w",container:z,style:g.mapStyle,attributionControl:!1});F.on("load",()=>{I.set(F)}),F.on("webglcontextlost",()=>{console.log("A webglcontextlost event occurred.")}),F.on("moveend",u)}),sg++,u1(()=>{d==null||d.off("moveend",u)}),h.$$set=F=>{"fitShape"in F&&l(5,w=F.fitShape),"resize"in F&&l(6,T=F.resize),"bounds"in F&&l(4,M=F.bounds),"$$scope"in F&&l(7,n=F.$$scope)},h.$$.update=()=>{h.$$.dirty&17&&(u=()=>{if(!d)return;const F=d.getBounds(),q=(M==null?void 0:M.getSouthWest())||{},ae=(M==null?void 0:M.getNorthEast())||{},se=F.getSouthWest(),ie=F.getNorthEast();(!M||q.lng!==se.lng||q.lat!==se.lat||ae.lng!==ie.lng||ae.lat!==ie.lat)&&l(4,M=F)}),h.$$.dirty&17&&M&&d&&d.fitBounds(M,{animate:!1}),h.$$.dirty&97&&(T||!T)&&d&&(d.resize(),R(w)),h.$$.dirty&32&&R(w)},[d,I,P,z,M,w,T,n,y]}class V3 extends Jt{constructor(o){super(),Qt(this,o,U3,F3,ei,{fitShape:5,resize:6,bounds:4})}}function N3(h,o,l){let u,d,{data:g}=o,{coordinatesOrigin:y}=o,{resolution:n}=o,{colorScale:w}=o,{before:T}=o;const{MAP:M}=kr("map");xt(h,M,z=>l(7,d=z));const I="data-source",P="grid-layer";return u1(()=>{d.getLayer(P)&&d.removeLayer(P),d.getSource(I)&&d.removeSource(I)}),h.$$set=z=>{"data"in z&&l(1,g=z.data),"coordinatesOrigin"in z&&l(2,y=z.coordinatesOrigin),"resolution"in z&&l(3,n=z.resolution),"colorScale"in z&&l(4,w=z.colorScale),"before"in z&&l(5,T=z.before)},h.$$.update=()=>{h.$$.dirty&30&&l(6,u={type:"FeatureCollection",features:(g==null?void 0:g.reduce((z,R,F)=>(R.forEach((q,ae)=>{if(q===null)return;const se=y[1]+n*ae-n/2,ie=y[0]+n*F-n/2;z.push({type:"Feature",properties:{value:q,color:w(q)},geometry:{type:"Polygon",coordinates:[[[ie,se],[ie+n,se],[ie+n,se+n],[ie,se+n],[ie,se]]]}})}),z),[]))||[]}),h.$$.dirty&192&&(d.getSource(I)||d.addSource(I,{type:"geojson",data:u})),h.$$.dirty&192&&d.getSource(I).setData(u),h.$$.dirty&160&&d.addLayer({id:P,type:"fill",source:I,paint:{"fill-color":["get","color"],"fill-opacity":1,"fill-antialias":!0}},T)},[M,g,y,n,w,T,u,d]}class j3 extends Jt{constructor(o){super(),Qt(this,o,N3,null,ei,{data:1,coordinatesOrigin:2,resolution:3,colorScale:4,before:5})}}function ag(h,o,l){const u=h.slice();return u[8]=o[l],u}function lg(h){let o,l=h[8].label+"",u,d;return{c(){o=He("option"),u=Oe(l),this.h()},l(g){o=Ye(g,"OPTION",{});var y=Ce(o);u=Fe(y,l),y.forEach(W),this.h()},h(){o.__value=d=h[8].uid||h[8].value,o.value=o.__value},m(g,y){Me(g,o,y),de(o,u)},p(g,y){y&2&&l!==(l=g[8].label+"")&&zt(u,l),y&2&&d!==(d=g[8].uid||g[8].value)&&(o.__value=d,o.value=o.__value)},d(g){g&&W(o)}}}function G3(h){let o,l,u,d,g,y,n,w,T=h[1],M=[];for(let I=0;I<T.length;I+=1)M[I]=lg(ag(h,T,I));return{c(){o=He("div"),l=He("label"),u=Oe(h[2]),d=bt(),g=He("div"),y=He("select");for(let I=0;I<M.length;I+=1)M[I].c();this.h()},l(I){o=Ye(I,"DIV",{class:!0});var P=Ce(o);l=Ye(P,"LABEL",{class:!0,for:!0});var z=Ce(l);u=Fe(z,h[2]),z.forEach(W),d=wt(P),g=Ye(P,"DIV",{class:!0});var R=Ce(g);y=Ye(R,"SELECT",{class:!0,id:!0});var F=Ce(y);for(let q=0;q<M.length;q+=1)M[q].l(F);F.forEach(W),R.forEach(W),P.forEach(W),this.h()},h(){H(l,"class","control-label svelte-1vcpmyh"),H(l,"for",h[3]),H(y,"class","select svelte-1vcpmyh"),H(y,"id",h[3]),h[0]===void 0&&$p(()=>h[6].call(y)),H(g,"class","select-wrapper svelte-1vcpmyh"),H(o,"class","root svelte-1vcpmyh")},m(I,P){Me(I,o,P),de(o,l),de(l,u),de(o,d),de(o,g),de(g,y);for(let z=0;z<M.length;z+=1)M[z].m(y,null);$_(y,h[0]),n||(w=[Oi(y,"change",h[6]),Oi(y,"change",h[4])],n=!0)},p(I,[P]){if(P&4&&zt(u,I[2]),P&8&&H(l,"for",I[3]),P&2){T=I[1];let z;for(z=0;z<T.length;z+=1){const R=ag(I,T,z);M[z]?M[z].p(R,P):(M[z]=lg(R),M[z].c(),M[z].m(y,null))}for(;z<M.length;z+=1)M[z].d(1);M.length=T.length}P&8&&H(y,"id",I[3]),P&3&&$_(y,I[0])},i:ti,o:ti,d(I){I&&W(o),Br(M,I),n=!1,$s(w)}}}let cg=0;function q3(h,o,l){let u,{options:d=[]}=o,{value:g}=o,{label:y}=o,{uid:n}=o;const w=sc();function T(){w("change",{key:n,value:g})}cg++;function M(){g=Ix(this),l(0,g),l(1,d)}return h.$$set=I=>{"options"in I&&l(1,d=I.options),"value"in I&&l(0,g=I.value),"label"in I&&l(2,y=I.label),"uid"in I&&l(5,n=I.uid)},h.$$.update=()=>{h.$$.dirty&32&&l(3,u=n||`select-${cg}`)},[g,d,y,u,T,n,M]}class d1 extends Jt{constructor(o){super(),Qt(this,o,q3,G3,ei,{options:1,value:0,label:2,uid:5})}}function ug(h,o,l){const u=h.slice();return u[8]=o[l],u}function hg(h){let o,l;return{c(){o=He("legend"),l=Oe(h[2]),this.h()},l(u){o=Ye(u,"LEGEND",{class:!0,for:!0});var d=Ce(o);l=Fe(d,h[2]),d.forEach(W),this.h()},h(){H(o,"class","control-label svelte-pa6i01"),H(o,"for",h[3])},m(u,d){Me(u,o,d),de(o,l)},p(u,d){d&4&&zt(l,u[2]),d&8&&H(o,"for",u[3])},d(u){u&&W(o)}}}function pg(h){let o,l,u,d,g,y,n=h[8].label+"",w,T,M,I,P;return{c(){o=He("div"),l=He("input"),g=bt(),y=He("label"),w=Oe(n),M=bt(),this.h()},l(z){o=Ye(z,"DIV",{class:!0});var R=Ce(o);l=Ye(R,"INPUT",{type:!0,class:!0,id:!0}),g=wt(R),y=Ye(R,"LABEL",{class:!0,for:!0});var F=Ce(y);w=Fe(F,n),F.forEach(W),M=wt(R),R.forEach(W),this.h()},h(){H(l,"type","radio"),H(l,"class","segment-button svelte-pa6i01"),H(l,"id",u=h[8].uid||h[8].value),l.__value=d=h[8].uid||h[8].value,l.value=l.__value,h[6][0].push(l),H(y,"class","segment-label svelte-pa6i01"),H(y,"for",T=h[8].uid||h[8].value),H(o,"class","segment svelte-pa6i01")},m(z,R){Me(z,o,R),de(o,l),l.checked=l.__value===h[0],de(o,g),de(o,y),de(y,w),de(o,M),I||(P=Oi(l,"change",h[5]),I=!0)},p(z,R){R&2&&u!==(u=z[8].uid||z[8].value)&&H(l,"id",u),R&2&&d!==(d=z[8].uid||z[8].value)&&(l.__value=d,l.value=l.__value),R&1&&(l.checked=l.__value===z[0]),R&2&&n!==(n=z[8].label+"")&&zt(w,n),R&2&&T!==(T=z[8].uid||z[8].value)&&H(y,"for",T)},d(z){z&&W(o),h[6][0].splice(h[6][0].indexOf(l),1),I=!1,P()}}}function Z3(h){let o,l,u,d=h[2]&&hg(h),g=h[1],y=[];for(let n=0;n<g.length;n+=1)y[n]=pg(ug(h,g,n));return{c(){o=He("div"),d&&d.c(),l=bt(),u=He("fieldset");for(let n=0;n<y.length;n+=1)y[n].c();this.h()},l(n){o=Ye(n,"DIV",{class:!0});var w=Ce(o);d&&d.l(w),l=wt(w),u=Ye(w,"FIELDSET",{role:!0,class:!0,id:!0});var T=Ce(u);for(let M=0;M<y.length;M+=1)y[M].l(T);T.forEach(W),w.forEach(W),this.h()},h(){H(u,"role","radiogroup"),H(u,"class","segments svelte-pa6i01"),H(u,"id",h[3]),H(o,"class","root svelte-pa6i01")},m(n,w){Me(n,o,w),d&&d.m(o,null),de(o,l),de(o,u);for(let T=0;T<y.length;T+=1)y[T].m(u,null)},p(n,[w]){if(n[2]?d?d.p(n,w):(d=hg(n),d.c(),d.m(o,l)):d&&(d.d(1),d=null),w&3){g=n[1];let T;for(T=0;T<g.length;T+=1){const M=ug(n,g,T);y[T]?y[T].p(M,w):(y[T]=pg(M),y[T].c(),y[T].m(u,null))}for(;T<y.length;T+=1)y[T].d(1);y.length=g.length}w&8&&H(u,"id",n[3])},i:ti,o:ti,d(n){n&&W(o),d&&d.d(),Br(y,n)}}}let fg=0;function $3(h,o,l){let u,{options:d=[]}=o,{value:g}=o,{label:y}=o,{uid:n}=o;sc(),fg++;const w=[[]];function T(){g=this.__value,l(0,g)}return h.$$set=M=>{"options"in M&&l(1,d=M.options),"value"in M&&l(0,g=M.value),"label"in M&&l(2,y=M.label),"uid"in M&&l(4,n=M.uid)},h.$$.update=()=>{h.$$.dirty&16&&l(3,u=n||`select-${fg}`)},[g,d,y,u,n,T,w]}class W3 extends Jt{constructor(o){super(),Qt(this,o,$3,Z3,ei,{options:1,value:0,label:2,uid:4})}}function X3(h){let o,l;const u=h[2].default,d=co(u,h,h[1],null);return{c(){o=He("dl"),d&&d.c(),this.h()},l(g){o=Ye(g,"DL",{class:!0});var y=Ce(o);d&&d.l(y),y.forEach(W),this.h()},h(){H(o,"class","chart-info-facts svelte-xs7x9r"),Dt(o,"chart-info-facts--horizontal",h[0]==="horizontal")},m(g,y){Me(g,o,y),d&&d.m(o,null),l=!0},p(g,[y]){d&&d.p&&(!l||y&2)&&uo(d,u,g,g[1],l?po(u,g[1],y,null):ho(g[1]),null),y&1&&Dt(o,"chart-info-facts--horizontal",g[0]==="horizontal")},i(g){l||(Le(d,g),l=!0)},o(g){Xe(d,g),l=!1},d(g){g&&W(o),d&&d.d(g)}}}function H3(h,o,l){let{$$slots:u={},$$scope:d}=o,{direction:g}=o;return h.$$set=y=>{"direction"in y&&l(0,g=y.direction),"$$scope"in y&&l(1,d=y.$$scope)},[g,d,u]}class m1 extends Jt{constructor(o){super(),Qt(this,o,H3,X3,ei,{direction:0})}}function dg(h){let o;return{c(){o=Oe("s")},l(l){o=Fe(l,"s")},m(l,u){Me(l,o,u)},d(l){l&&W(o)}}}function Y3(h){let o,l,u,d,g,y=(h[1]||"\u2014")+"",n,w=h[0]>1&&dg();return{c(){o=He("dt"),l=Oe("Model"),w&&w.c(),u=Oe(":"),d=bt(),g=He("dd"),n=Oe(y)},l(T){o=Ye(T,"DT",{});var M=Ce(o);l=Fe(M,"Model"),w&&w.l(M),u=Fe(M,":"),M.forEach(W),d=wt(T),g=Ye(T,"DD",{});var I=Ce(g);n=Fe(I,y),I.forEach(W)},m(T,M){Me(T,o,M),de(o,l),w&&w.m(o,null),de(o,u),Me(T,d,M),Me(T,g,M),de(g,n)},p(T,[M]){T[0]>1?w||(w=dg(),w.c(),w.m(o,u)):w&&(w.d(1),w=null),M&2&&y!==(y=(T[1]||"\u2014")+"")&&zt(n,y)},i:ti,o:ti,d(T){T&&W(o),w&&w.d(),T&&W(d),T&&W(g)}}}function K3(h,o,l){let u,d,{data:g}=o;return h.$$set=y=>{"data"in y&&l(2,g=y.data)},h.$$.update=()=>{h.$$.dirty&4&&l(1,{label:u,length:d}=i3(g),u,(l(0,d),l(2,g)))},[d,u,g]}class _1 extends Jt{constructor(o){super(),Qt(this,o,K3,Y3,ei,{data:2})}}function J3(h){let o,l,u,d,g;return{c(){o=He("dt"),l=Oe("Spatial resolution:"),u=bt(),d=He("dd"),g=Oe(h[0])},l(y){o=Ye(y,"DT",{});var n=Ce(o);l=Fe(n,"Spatial resolution:"),n.forEach(W),u=wt(y),d=Ye(y,"DD",{});var w=Ce(d);g=Fe(w,h[0]),w.forEach(W)},m(y,n){Me(y,o,n),de(o,l),Me(y,u,n),Me(y,d,n),de(d,g)},p(y,[n]){n&1&&zt(g,y[0])},i:ti,o:ti,d(y){y&&W(o),y&&W(u),y&&W(d)}}}function Q3(h,o,l){let u,d,{resolution:g}=o;return h.$$set=y=>{"resolution"in y&&l(1,g=y.resolution)},h.$$.update=()=>{h.$$.dirty&2&&l(2,u=Hr(g,"degree")),h.$$.dirty&6&&l(0,d=g?`${u} \xD7 ${u}`:"\u2014")},[d,g,u]}class eb extends Jt{constructor(o){super(),Qt(this,o,Q3,J3,ei,{resolution:1})}}function tb(h){let o,l,u=h[2].label+"",d,g,y=h[2].unit.labelLong+"",n,w,T=h[1].label+"",M,I,P,z,R=h[3].reference.label+"",F,q,ae,se,ie;return ae=new Wp({props:{scenarios:h[4]}}),{c(){o=He("p"),l=Oe(`This map shows the change in
          `),d=Oe(u),g=Oe(` (expressed in
          `),n=Oe(y),w=Oe(`) in
          `),M=Oe(T),I=Oe(` in
          `),P=Oe(h[5]),z=Oe(`
          compared to the reference period
          `),F=Oe(R),q=Oe(`, according to the
          `),ht(ae.$$.fragment),se=Oe(".")},l(Q){o=Ye(Q,"P",{});var re=Ce(o);l=Fe(re,`This map shows the change in
          `),d=Fe(re,u),g=Fe(re,` (expressed in
          `),n=Fe(re,y),w=Fe(re,`) in
          `),M=Fe(re,T),I=Fe(re,` in
          `),P=Fe(re,h[5]),z=Fe(re,`
          compared to the reference period
          `),F=Fe(re,R),q=Fe(re,`, according to the
          `),pt(ae.$$.fragment,re),se=Fe(re,"."),re.forEach(W)},m(Q,re){Me(Q,o,re),de(o,l),de(o,d),de(o,g),de(o,n),de(o,w),de(o,M),de(o,I),de(o,P),de(o,z),de(o,F),de(o,q),ft(ae,o,null),de(o,se),ie=!0},p(Q,re){(!ie||re&4)&&u!==(u=Q[2].label+"")&&zt(d,u),(!ie||re&4)&&y!==(y=Q[2].unit.labelLong+"")&&zt(n,y),(!ie||re&2)&&T!==(T=Q[1].label+"")&&zt(M,T),(!ie||re&32)&&zt(P,Q[5]),(!ie||re&8)&&R!==(R=Q[3].reference.label+"")&&zt(F,R);const Ae={};re&16&&(Ae.scenarios=Q[4]),ae.$set(Ae)},i(Q){ie||(Le(ae.$$.fragment,Q),ie=!0)},o(Q){Xe(ae.$$.fragment,Q),ie=!1},d(Q){Q&&W(o),dt(ae)}}}function ib(h){let o,l,u=h[2].label+"",d,g,y=h[2].unit.labelLong+"",n,w,T=h[1].label+"",M,I,P,z,R=h[3].reference.label+"",F,q,ae,se,ie;return ae=new Wp({props:{scenarios:h[4]}}),{c(){o=He("p"),l=Oe(`These maps show the changes in
          `),d=Oe(u),g=Oe(` (expressed in
          `),n=Oe(y),w=Oe(`) in
          `),M=Oe(T),I=Oe(` in
          `),P=Oe(h[5]),z=Oe(` compared to the reference period
          `),F=Oe(R),q=Oe(`, according to the
          `),ht(ae.$$.fragment),se=Oe(" .")},l(Q){o=Ye(Q,"P",{});var re=Ce(o);l=Fe(re,`These maps show the changes in
          `),d=Fe(re,u),g=Fe(re,` (expressed in
          `),n=Fe(re,y),w=Fe(re,`) in
          `),M=Fe(re,T),I=Fe(re,` in
          `),P=Fe(re,h[5]),z=Fe(re,` compared to the reference period
          `),F=Fe(re,R),q=Fe(re,`, according to the
          `),pt(ae.$$.fragment,re),se=Fe(re," ."),re.forEach(W)},m(Q,re){Me(Q,o,re),de(o,l),de(o,d),de(o,g),de(o,n),de(o,w),de(o,M),de(o,I),de(o,P),de(o,z),de(o,F),de(o,q),ft(ae,o,null),de(o,se),ie=!0},p(Q,re){(!ie||re&4)&&u!==(u=Q[2].label+"")&&zt(d,u),(!ie||re&4)&&y!==(y=Q[2].unit.labelLong+"")&&zt(n,y),(!ie||re&2)&&T!==(T=Q[1].label+"")&&zt(M,T),(!ie||re&32)&&zt(P,Q[5]),(!ie||re&8)&&R!==(R=Q[3].reference.label+"")&&zt(F,R);const Ae={};re&16&&(Ae.scenarios=Q[4]),ae.$set(Ae)},i(Q){ie||(Le(ae.$$.fragment,Q),ie=!0)},o(Q){Xe(ae.$$.fragment,Q),ie=!1},d(Q){Q&&W(o),dt(ae)}}}function rb(h){let o,l,u=h[2].label+"",d,g,y=h[2].unit.labelLong+"",n,w,T=h[1].label+"",M,I,P,z,R=h[3].reference.label+"",F,q,ae,se,ie;return ae=new Wp({props:{scenarios:h[4]}}),{c(){o=He("p"),l=Oe(`This map shows the differences in change of
          `),d=Oe(u),g=Oe(` (expressed in
          `),n=Oe(y),w=Oe(`) in
          `),M=Oe(T),I=Oe(` in
          `),P=Oe(h[5]),z=Oe(` compared to the reference period
          `),F=Oe(R),q=Oe(` between
          `),ht(ae.$$.fragment),se=Oe(".")},l(Q){o=Ye(Q,"P",{});var re=Ce(o);l=Fe(re,`This map shows the differences in change of
          `),d=Fe(re,u),g=Fe(re,` (expressed in
          `),n=Fe(re,y),w=Fe(re,`) in
          `),M=Fe(re,T),I=Fe(re,` in
          `),P=Fe(re,h[5]),z=Fe(re,` compared to the reference period
          `),F=Fe(re,R),q=Fe(re,` between
          `),pt(ae.$$.fragment,re),se=Fe(re,"."),re.forEach(W)},m(Q,re){Me(Q,o,re),de(o,l),de(o,d),de(o,g),de(o,n),de(o,w),de(o,M),de(o,I),de(o,P),de(o,z),de(o,F),de(o,q),ft(ae,o,null),de(o,se),ie=!0},p(Q,re){(!ie||re&4)&&u!==(u=Q[2].label+"")&&zt(d,u),(!ie||re&4)&&y!==(y=Q[2].unit.labelLong+"")&&zt(n,y),(!ie||re&2)&&T!==(T=Q[1].label+"")&&zt(M,T),(!ie||re&32)&&zt(P,Q[5]),(!ie||re&8)&&R!==(R=Q[3].reference.label+"")&&zt(F,R);const Ae={};re&16&&(Ae.scenarios=Q[4]),ae.$set(Ae)},i(Q){ie||(Le(ae.$$.fragment,Q),ie=!0)},o(Q){Xe(ae.$$.fragment,Q),ie=!1},d(Q){Q&&W(o),dt(ae)}}}function nb(h){let o,l,u,d;return o=new eb({props:{resolution:h[7][0].resolution}}),u=new _1({props:{data:h[7].map(_g)}}),{c(){ht(o.$$.fragment),l=bt(),ht(u.$$.fragment)},l(g){pt(o.$$.fragment,g),l=wt(g),pt(u.$$.fragment,g)},m(g,y){ft(o,g,y),Me(g,l,y),ft(u,g,y),d=!0},p(g,y){const n={};y&128&&(n.resolution=g[7][0].resolution),o.$set(n);const w={};y&128&&(w.data=g[7].map(_g)),u.$set(w)},i(g){d||(Le(o.$$.fragment,g),Le(u.$$.fragment,g),d=!0)},o(g){Xe(o.$$.fragment,g),Xe(u.$$.fragment,g),d=!1},d(g){dt(o,g),g&&W(l),dt(u,g)}}}function mg(h){let o,l,u,d;function g(n){h[9](n)}let y={options:Ox};return h[0]!==void 0&&(y.value=h[0]),l=new W3({props:y}),cr.push(()=>zn(l,"value",g)),{c(){o=He("div"),ht(l.$$.fragment),this.h()},l(n){o=Ye(n,"DIV",{class:!0});var w=Ce(o);pt(l.$$.fragment,w),w.forEach(W),this.h()},h(){H(o,"class","control svelte-127kq2a")},m(n,w){Me(n,o,w),ft(l,o,null),d=!0},p(n,w){const T={};!u&&w&1&&(u=!0,T.value=n[0],Cn(()=>u=!1)),l.$set(T)},i(n){d||(Le(l.$$.fragment,n),d=!0)},o(n){Xe(l.$$.fragment,n),d=!1},d(n){n&&W(o),dt(l)}}}function ob(h){let o,l,u,d,g,y=h[2].label+"",n,w,T=h[1].label+"",M,I,P,z,R,F,q,ae,se,ie,Q,re,Ae,$e,Je;const ze=[rb,ib,tb],Pe=[];function Ge(Ne,At){return Ne[6]?0:Ne[4].length>1?1:2}R=Ge(h),F=Pe[R]=ze[R](h),ae=new m1({props:{direction:"horizontal",$$slots:{default:[nb]},$$scope:{ctx:h}}});let Qe=h[4].length===2&&mg(h);function Rt(Ne){h[10](Ne)}let mt={options:Bx,label:"Year"};return h[8]!==void 0&&(mt.value=h[8]),Ae=new d1({props:mt}),cr.push(()=>zn(Ae,"value",Rt)),{c(){o=He("div"),l=He("div"),u=He("div"),d=He("h2"),g=Oe("Change in "),n=Oe(y),w=Oe(" in "),M=Oe(T),I=Oe(" in "),P=Oe(h[5]),z=bt(),F.c(),q=bt(),ht(ae.$$.fragment),se=bt(),ie=He("div"),Qe&&Qe.c(),Q=bt(),re=He("div"),ht(Ae.$$.fragment),this.h()},l(Ne){o=Ye(Ne,"DIV",{class:!0});var At=Ce(o);l=Ye(At,"DIV",{class:!0});var $t=Ce(l);u=Ye($t,"DIV",{class:!0});var _t=Ce(u);d=Ye(_t,"H2",{});var Ht=Ce(d);g=Fe(Ht,"Change in "),n=Fe(Ht,y),w=Fe(Ht," in "),M=Fe(Ht,T),I=Fe(Ht," in "),P=Fe(Ht,h[5]),Ht.forEach(W),z=wt(_t),F.l(_t),q=wt(_t),pt(ae.$$.fragment,_t),_t.forEach(W),se=wt($t),ie=Ye($t,"DIV",{class:!0});var Ci=Ce(ie);Qe&&Qe.l(Ci),Q=wt(Ci),re=Ye(Ci,"DIV",{class:!0});var Ui=Ce(re);pt(Ae.$$.fragment,Ui),Ui.forEach(W),Ci.forEach(W),$t.forEach(W),At.forEach(W),this.h()},h(){H(u,"class","chart-info svelte-127kq2a"),H(re,"class","control svelte-127kq2a"),H(ie,"class","controls svelte-127kq2a"),H(l,"class","wrapper grid header svelte-127kq2a"),H(o,"class","container")},m(Ne,At){Me(Ne,o,At),de(o,l),de(l,u),de(u,d),de(d,g),de(d,n),de(d,w),de(d,M),de(d,I),de(d,P),de(u,z),Pe[R].m(u,null),de(u,q),ft(ae,u,null),de(l,se),de(l,ie),Qe&&Qe.m(ie,null),de(ie,Q),de(ie,re),ft(Ae,re,null),Je=!0},p(Ne,[At]){(!Je||At&4)&&y!==(y=Ne[2].label+"")&&zt(n,y),(!Je||At&2)&&T!==(T=Ne[1].label+"")&&zt(M,T),(!Je||At&32)&&zt(P,Ne[5]);let $t=R;R=Ge(Ne),R===$t?Pe[R].p(Ne,At):(br(),Xe(Pe[$t],1,1,()=>{Pe[$t]=null}),wr(),F=Pe[R],F?F.p(Ne,At):(F=Pe[R]=ze[R](Ne),F.c()),Le(F,1),F.m(u,q));const _t={};At&2176&&(_t.$$scope={dirty:At,ctx:Ne}),ae.$set(_t),Ne[4].length===2?Qe?(Qe.p(Ne,At),At&16&&Le(Qe,1)):(Qe=mg(Ne),Qe.c(),Le(Qe,1),Qe.m(ie,Q)):Qe&&(br(),Xe(Qe,1,1,()=>{Qe=null}),wr());const Ht={};!$e&&At&256&&($e=!0,Ht.value=Ne[8],Cn(()=>$e=!1)),Ae.$set(Ht)},i(Ne){Je||(Le(F),Le(ae.$$.fragment,Ne),Le(Qe),Le(Ae.$$.fragment,Ne),Je=!0)},o(Ne){Xe(F),Xe(ae.$$.fragment,Ne),Xe(Qe),Xe(Ae.$$.fragment,Ne),Je=!1},d(Ne){Ne&&W(o),Pe[R].d(),dt(ae),Qe&&Qe.d(),dt(Ae)}}}const _g=h=>h.model;function sb(h,o,l){let u;xt(h,kd,R=>l(8,u=R));let{currentGeography:d}=o,{currentIndicator:g}=o,{currentOptions:y}=o,{currentScenarios:n}=o,{currentYear:w}=o,{displayOption:T}=o,{showDifference:M}=o,{data:I}=o;function P(R){T=R,l(0,T)}function z(R){u=R,kd.set(u)}return h.$$set=R=>{"currentGeography"in R&&l(1,d=R.currentGeography),"currentIndicator"in R&&l(2,g=R.currentIndicator),"currentOptions"in R&&l(3,y=R.currentOptions),"currentScenarios"in R&&l(4,n=R.currentScenarios),"currentYear"in R&&l(5,w=R.currentYear),"displayOption"in R&&l(0,T=R.displayOption),"showDifference"in R&&l(6,M=R.showDifference),"data"in R&&l(7,I=R.data)},[T,d,g,y,n,w,M,I,u,P,z]}class ab extends Jt{constructor(o){super(),Qt(this,o,sb,ob,ei,{currentGeography:1,currentIndicator:2,currentOptions:3,currentScenarios:4,currentYear:5,displayOption:0,showDifference:6,data:7})}}function lb(h){let o,l,u,d,g=Hr(h[4][0],h[0].uid)+"",y,n,w,T,M,I,P,z,R=Hr(h[5],h[0].uid)+"",F,q,ae,se,ie,Q,re,Ae=Hr(h[4][h[4].length-1],h[0].uid)+"",$e;return{c(){o=He("div"),l=He("span"),u=Oe("Below"),d=He("br"),y=Oe(g),n=bt(),w=He("div"),T=He("canvas"),M=bt(),I=He("div"),P=He("span"),z=He("span"),F=Oe(R),se=bt(),ie=He("span"),Q=Oe("Above"),re=He("br"),$e=Oe(Ae),this.h()},l(Je){o=Ye(Je,"DIV",{class:!0});var ze=Ce(o);l=Ye(ze,"SPAN",{class:!0});var Pe=Ce(l);u=Fe(Pe,"Below"),d=Ye(Pe,"BR",{}),y=Fe(Pe,g),Pe.forEach(W),n=wt(ze),w=Ye(ze,"DIV",{class:!0});var Ge=Ce(w);T=Ye(Ge,"CANVAS",{width:!0,height:!0}),Ce(T).forEach(W),M=wt(Ge),I=Ye(Ge,"DIV",{class:!0});var Qe=Ce(I);P=Ye(Qe,"SPAN",{style:!0,class:!0});var Rt=Ce(P);z=Ye(Rt,"SPAN",{class:!0});var mt=Ce(z);F=Fe(mt,R),mt.forEach(W),Rt.forEach(W),Qe.forEach(W),Ge.forEach(W),se=wt(ze),ie=Ye(ze,"SPAN",{class:!0});var Ne=Ce(ie);Q=Fe(Ne,"Above"),re=Ye(Ne,"BR",{}),$e=Fe(Ne,Ae),Ne.forEach(W),ze.forEach(W),this.h()},h(){H(l,"class","tick-label svelte-lb6hqp"),H(T,"width",h[2]),H(T,"height",h[3]),H(z,"class","tick-label svelte-lb6hqp"),H(P,"style",q=`left: ${h[6](h[5])}px;`),H(P,"class","tick svelte-lb6hqp"),H(I,"class","ticks"),H(w,"class","canvas-wrapper svelte-lb6hqp"),$p(()=>h[14].call(w)),H(ie,"class","tick-label svelte-lb6hqp"),H(o,"class","root svelte-lb6hqp")},m(Je,ze){Me(Je,o,ze),de(o,l),de(l,u),de(l,d),de(l,y),de(o,n),de(o,w),de(w,T),h[13](T),de(w,M),de(w,I),de(I,P),de(P,z),de(z,F),ae=h1(w,h[14].bind(w)),de(o,se),de(o,ie),de(ie,Q),de(ie,re),de(ie,$e)},p(Je,[ze]){ze&17&&g!==(g=Hr(Je[4][0],Je[0].uid)+"")&&zt(y,g),ze&4&&H(T,"width",Je[2]),ze&8&&H(T,"height",Je[3]),ze&33&&R!==(R=Hr(Je[5],Je[0].uid)+"")&&zt(F,R),ze&96&&q!==(q=`left: ${Je[6](Je[5])}px;`)&&H(P,"style",q),ze&17&&Ae!==(Ae=Hr(Je[4][Je[4].length-1],Je[0].uid)+"")&&zt($e,Ae)},i:ti,o:ti,d(Je){Je&&W(o),h[13](null),ae()}}}function cb(h,o,l){let u,d,g,y,n,w,T,M,{scale:I}=o,{unit:P}=o,z,R,F;function q(se){cr[se?"unshift":"push"](()=>{z=se,l(1,z)})}function ae(){R=this.clientWidth,F=this.clientHeight,l(2,R),l(3,F)}return h.$$set=se=>{"scale"in se&&l(7,I=se.scale),"unit"in se&&l(0,P=se.unit)},h.$$.update=()=>{h.$$.dirty&128&&l(4,u=I.domain()),h.$$.dirty&128&&l(12,d=I.range()),h.$$.dirty&16&&l(10,g=u.length===2),h.$$.dirty&16&&l(9,y=Math.abs(u[0]-u[u.length-1])),h.$$.dirty&1556&&l(11,n=g?[0,R]:[0,Math.abs(u[0]/y*R),R]),h.$$.dirty&6144&&l(8,w=zp().domain(n).range(d)),h.$$.dirty&2064&&l(6,T=zp().domain(u).range(n)),h.$$.dirty&1552&&l(5,M=g?[u[0]+y/2]:[0]),h.$$.dirty&286&&(async()=>{if(z){const se=z.getContext("2d");await se.clearRect(0,0,R,F);for(let ie=u[0];ie<R;ie++)se.fillStyle=a3(w(ie)).hex(),se.fillRect(ie,0,1,F)}})()},[P,z,R,F,u,M,T,I,w,y,g,n,d,q,ae]}class ub extends Jt{constructor(o){super(),Qt(this,o,cb,lb,ei,{scale:7,unit:0})}}/**
 * splaytree v3.1.1
 * Fast Splay tree for Node and browser
 *
 * @author Alexander Milevski <info@w8r.name>
 * @license MIT
 * @preserve
 *//*! *****************************************************************************
Copyright (c) Microsoft Corporation. All rights reserved.
Licensed under the Apache License, Version 2.0 (the "License"); you may not use
this file except in compliance with the License. You may obtain a copy of the
License at http://www.apache.org/licenses/LICENSE-2.0

THIS CODE IS PROVIDED ON AN *AS IS* BASIS, WITHOUT WARRANTIES OR CONDITIONS OF ANY
KIND, EITHER EXPRESS OR IMPLIED, INCLUDING WITHOUT LIMITATION ANY IMPLIED
WARRANTIES OR CONDITIONS OF TITLE, FITNESS FOR A PARTICULAR PURPOSE,
MERCHANTABLITY OR NON-INFRINGEMENT.

See the Apache Version 2.0 License for specific language governing permissions
and limitations under the License.
***************************************************************************** */function hb(h,o){var l={label:0,sent:function(){if(g[0]&1)throw g[1];return g[1]},trys:[],ops:[]},u,d,g,y;return y={next:n(0),throw:n(1),return:n(2)},typeof Symbol=="function"&&(y[Symbol.iterator]=function(){return this}),y;function n(T){return function(M){return w([T,M])}}function w(T){if(u)throw new TypeError("Generator is already executing.");for(;l;)try{if(u=1,d&&(g=T[0]&2?d.return:T[0]?d.throw||((g=d.return)&&g.call(d),0):d.next)&&!(g=g.call(d,T[1])).done)return g;switch(d=0,g&&(T=[T[0]&2,g.value]),T[0]){case 0:case 1:g=T;break;case 4:return l.label++,{value:T[1],done:!1};case 5:l.label++,d=T[1],T=[0];continue;case 7:T=l.ops.pop(),l.trys.pop();continue;default:if(g=l.trys,!(g=g.length>0&&g[g.length-1])&&(T[0]===6||T[0]===2)){l=0;continue}if(T[0]===3&&(!g||T[1]>g[0]&&T[1]<g[3])){l.label=T[1];break}if(T[0]===6&&l.label<g[1]){l.label=g[1],g=T;break}if(g&&l.label<g[2]){l.label=g[2],l.ops.push(T);break}g[2]&&l.ops.pop(),l.trys.pop();continue}T=o.call(h,l)}catch(M){T=[6,M],d=0}finally{u=g=0}if(T[0]&5)throw T[1];return{value:T[0]?T[1]:void 0,done:!0}}}var Zs=function(){function h(o,l){this.next=null,this.key=o,this.data=l,this.left=null,this.right=null}return h}();function pb(h,o){return h>o?1:h<o?-1:0}function Ns(h,o,l){for(var u=new Zs(null,null),d=u,g=u;;){var y=l(h,o.key);if(y<0){if(o.left===null)break;if(l(h,o.left.key)<0){var n=o.left;if(o.left=n.right,n.right=o,o=n,o.left===null)break}g.left=o,g=o,o=o.left}else if(y>0){if(o.right===null)break;if(l(h,o.right.key)>0){var n=o.right;if(o.right=n.left,n.left=o,o=n,o.right===null)break}d.right=o,d=o,o=o.right}else break}return d.right=o.left,g.left=o.right,o.left=u.right,o.right=u.left,o}function wd(h,o,l,u){var d=new Zs(h,o);if(l===null)return d.left=d.right=null,d;l=Ns(h,l,u);var g=u(h,l.key);return g<0?(d.left=l.left,d.right=l,l.left=null):g>=0&&(d.right=l.right,d.left=l,l.right=null),d}function gg(h,o,l){var u=null,d=null;if(o){o=Ns(h,o,l);var g=l(o.key,h);g===0?(u=o.left,d=o.right):g<0?(d=o.right,o.right=null,u=o):(u=o.left,o.left=null,d=o)}return{left:u,right:d}}function fb(h,o,l){return o===null?h:(h===null||(o=Ns(h.key,o,l),o.left=h),o)}function Bd(h,o,l,u,d){if(h){u(""+o+(l?"\u2514\u2500\u2500 ":"\u251C\u2500\u2500 ")+d(h)+`
`);var g=o+(l?"    ":"\u2502   ");h.left&&Bd(h.left,g,!1,u,d),h.right&&Bd(h.right,g,!0,u,d)}}var g1=function(){function h(o){o===void 0&&(o=pb),this._root=null,this._size=0,this._comparator=o}return h.prototype.insert=function(o,l){return this._size++,this._root=wd(o,l,this._root,this._comparator)},h.prototype.add=function(o,l){var u=new Zs(o,l);this._root===null&&(u.left=u.right=null,this._size++,this._root=u);var d=this._comparator,g=Ns(o,this._root,d),y=d(o,g.key);return y===0?this._root=g:(y<0?(u.left=g.left,u.right=g,g.left=null):y>0&&(u.right=g.right,u.left=g,g.right=null),this._size++,this._root=u),this._root},h.prototype.remove=function(o){this._root=this._remove(o,this._root,this._comparator)},h.prototype._remove=function(o,l,u){var d;if(l===null)return null;l=Ns(o,l,u);var g=u(o,l.key);return g===0?(l.left===null?d=l.right:(d=Ns(o,l.left,u),d.right=l.right),this._size--,d):l},h.prototype.pop=function(){var o=this._root;if(o){for(;o.left;)o=o.left;return this._root=Ns(o.key,this._root,this._comparator),this._root=this._remove(o.key,this._root,this._comparator),{key:o.key,data:o.data}}return null},h.prototype.findStatic=function(o){for(var l=this._root,u=this._comparator;l;){var d=u(o,l.key);if(d===0)return l;d<0?l=l.left:l=l.right}return null},h.prototype.find=function(o){return this._root&&(this._root=Ns(o,this._root,this._comparator),this._comparator(o,this._root.key)!==0)?null:this._root},h.prototype.contains=function(o){for(var l=this._root,u=this._comparator;l;){var d=u(o,l.key);if(d===0)return!0;d<0?l=l.left:l=l.right}return!1},h.prototype.forEach=function(o,l){for(var u=this._root,d=[],g=!1;!g;)u!==null?(d.push(u),u=u.left):d.length!==0?(u=d.pop(),o.call(l,u),u=u.right):g=!0;return this},h.prototype.range=function(o,l,u,d){for(var g=[],y=this._comparator,n=this._root,w;g.length!==0||n;)if(n)g.push(n),n=n.left;else{if(n=g.pop(),w=y(n.key,l),w>0)break;if(y(n.key,o)>=0&&u.call(d,n))return this;n=n.right}return this},h.prototype.keys=function(){var o=[];return this.forEach(function(l){var u=l.key;return o.push(u)}),o},h.prototype.values=function(){var o=[];return this.forEach(function(l){var u=l.data;return o.push(u)}),o},h.prototype.min=function(){return this._root?this.minNode(this._root).key:null},h.prototype.max=function(){return this._root?this.maxNode(this._root).key:null},h.prototype.minNode=function(o){if(o===void 0&&(o=this._root),o)for(;o.left;)o=o.left;return o},h.prototype.maxNode=function(o){if(o===void 0&&(o=this._root),o)for(;o.right;)o=o.right;return o},h.prototype.at=function(o){for(var l=this._root,u=!1,d=0,g=[];!u;)if(l)g.push(l),l=l.left;else if(g.length>0){if(l=g.pop(),d===o)return l;d++,l=l.right}else u=!0;return null},h.prototype.next=function(o){var l=this._root,u=null;if(o.right){for(u=o.right;u.left;)u=u.left;return u}for(var d=this._comparator;l;){var g=d(o.key,l.key);if(g===0)break;g<0?(u=l,l=l.left):l=l.right}return u},h.prototype.prev=function(o){var l=this._root,u=null;if(o.left!==null){for(u=o.left;u.right;)u=u.right;return u}for(var d=this._comparator;l;){var g=d(o.key,l.key);if(g===0)break;g<0?l=l.left:(u=l,l=l.right)}return u},h.prototype.clear=function(){return this._root=null,this._size=0,this},h.prototype.toList=function(){return mb(this._root)},h.prototype.load=function(o,l,u){l===void 0&&(l=[]),u===void 0&&(u=!1);var d=o.length,g=this._comparator;if(u&&Ud(o,l,0,d-1,g),this._root===null)this._root=Od(o,l,0,d),this._size=d;else{var y=_b(this.toList(),db(o,l),g);d=this._size+d,this._root=Fd({head:y},0,d)}return this},h.prototype.isEmpty=function(){return this._root===null},Object.defineProperty(h.prototype,"size",{get:function(){return this._size},enumerable:!0,configurable:!0}),Object.defineProperty(h.prototype,"root",{get:function(){return this._root},enumerable:!0,configurable:!0}),h.prototype.toString=function(o){o===void 0&&(o=function(u){return String(u.key)});var l=[];return Bd(this._root,"",!0,function(u){return l.push(u)},o),l.join("")},h.prototype.update=function(o,l,u){var d=this._comparator,g=gg(o,this._root,d),y=g.left,n=g.right;d(o,l)<0?n=wd(l,u,n,d):y=wd(l,u,y,d),this._root=fb(y,n,d)},h.prototype.split=function(o){return gg(o,this._root,this._comparator)},h.prototype[Symbol.iterator]=function(){var o;return hb(this,function(l){switch(l.label){case 0:o=this.minNode(),l.label=1;case 1:return o?[4,o]:[3,3];case 2:return l.sent(),o=this.next(o),[3,1];case 3:return[2]}})},h}();function Od(h,o,l,u){var d=u-l;if(d>0){var g=l+Math.floor(d/2),y=h[g],n=o[g],w=new Zs(y,n);return w.left=Od(h,o,l,g),w.right=Od(h,o,g+1,u),w}return null}function db(h,o){for(var l=new Zs(null,null),u=l,d=0;d<h.length;d++)u=u.next=new Zs(h[d],o[d]);return u.next=null,l.next}function mb(h){for(var o=h,l=[],u=!1,d=new Zs(null,null),g=d;!u;)o?(l.push(o),o=o.left):l.length>0?(o=g=g.next=l.pop(),o=o.right):u=!0;return g.next=null,d.next}function Fd(h,o,l){var u=l-o;if(u>0){var d=o+Math.floor(u/2),g=Fd(h,o,d),y=h.head;return y.left=g,h.head=h.head.next,y.right=Fd(h,d+1,l),y}return null}function _b(h,o,l){for(var u=new Zs(null,null),d=u,g=h,y=o;g!==null&&y!==null;)l(g.key,y.key)<0?(d.next=g,g=g.next):(d.next=y,y=y.next),d=d.next;return g!==null?d.next=g:y!==null&&(d.next=y),u.next}function Ud(h,o,l,u,d){if(!(l>=u)){for(var g=h[l+u>>1],y=l-1,n=u+1;;){do y++;while(d(h[y],g)<0);do n--;while(d(h[n],g)>0);if(y>=n)break;var w=h[y];h[y]=h[n],h[n]=w,w=o[y],o[y]=o[n],o[n]=w}Ud(h,o,l,n,d),Ud(h,o,n+1,u,d)}}function Zn(h,o){if(!(h instanceof o))throw new TypeError("Cannot call a class as a function")}function yg(h,o){for(var l=0;l<o.length;l++){var u=o[l];u.enumerable=u.enumerable||!1,u.configurable=!0,"value"in u&&(u.writable=!0),Object.defineProperty(h,u.key,u)}}function rn(h,o,l){return o&&yg(h.prototype,o),l&&yg(h,l),h}var Tu=function(o,l){return o.ll.x<=l.x&&l.x<=o.ur.x&&o.ll.y<=l.y&&l.y<=o.ur.y},Vd=function(o,l){if(l.ur.x<o.ll.x||o.ur.x<l.ll.x||l.ur.y<o.ll.y||o.ur.y<l.ll.y)return null;var u=o.ll.x<l.ll.x?l.ll.x:o.ll.x,d=o.ur.x<l.ur.x?o.ur.x:l.ur.x,g=o.ll.y<l.ll.y?l.ll.y:o.ll.y,y=o.ur.y<l.ur.y?o.ur.y:l.ur.y;return{ll:{x:u,y:g},ur:{x:d,y}}},qs=Number.EPSILON;qs===void 0&&(qs=Math.pow(2,-52));var gb=qs*qs,Nd=function(o,l){if(-qs<o&&o<qs&&-qs<l&&l<qs)return 0;var u=o-l;return u*u<gb*o*l?0:o<l?-1:1},yb=function(){function h(){Zn(this,h),this.reset()}return rn(h,[{key:"reset",value:function(){this.xRounder=new vg,this.yRounder=new vg}},{key:"round",value:function(l,u){return{x:this.xRounder.round(l),y:this.yRounder.round(u)}}}]),h}(),vg=function(){function h(){Zn(this,h),this.tree=new g1,this.round(0)}return rn(h,[{key:"round",value:function(l){var u=this.tree.add(l),d=this.tree.prev(u);if(d!==null&&Nd(u.key,d.key)===0)return this.tree.remove(l),d.key;var g=this.tree.next(u);return g!==null&&Nd(u.key,g.key)===0?(this.tree.remove(l),g.key):l}}]),h}(),Vu=new yb,Cu=function(o,l){return o.x*l.y-o.y*l.x},by=function(o,l){return o.x*l.x+o.y*l.y},xg=function(o,l,u){var d={x:l.x-o.x,y:l.y-o.y},g={x:u.x-o.x,y:u.y-o.y},y=Cu(d,g);return Nd(y,0)},Pp=function(o){return Math.sqrt(by(o,o))},vb=function(o,l,u){var d={x:l.x-o.x,y:l.y-o.y},g={x:u.x-o.x,y:u.y-o.y};return Cu(g,d)/Pp(g)/Pp(d)},xb=function(o,l,u){var d={x:l.x-o.x,y:l.y-o.y},g={x:u.x-o.x,y:u.y-o.y};return by(g,d)/Pp(g)/Pp(d)},bg=function(o,l,u){return l.y===0?null:{x:o.x+l.x/l.y*(u-o.y),y:u}},wg=function(o,l,u){return l.x===0?null:{x:u,y:o.y+l.y/l.x*(u-o.x)}},bb=function(o,l,u,d){if(l.x===0)return wg(u,d,o.x);if(d.x===0)return wg(o,l,u.x);if(l.y===0)return bg(u,d,o.y);if(d.y===0)return bg(o,l,u.y);var g=Cu(l,d);if(g==0)return null;var y={x:u.x-o.x,y:u.y-o.y},n=Cu(y,l)/g,w=Cu(y,d)/g,T=o.x+w*l.x,M=u.x+n*d.x,I=o.y+w*l.y,P=u.y+n*d.y,z=(T+M)/2,R=(I+P)/2;return{x:z,y:R}},ko=function(){rn(h,null,[{key:"compare",value:function(l,u){var d=h.comparePoints(l.point,u.point);return d!==0?d:(l.point!==u.point&&l.link(u),l.isLeft!==u.isLeft?l.isLeft?1:-1:Dp.compare(l.segment,u.segment))}},{key:"comparePoints",value:function(l,u){return l.x<u.x?-1:l.x>u.x?1:l.y<u.y?-1:l.y>u.y?1:0}}]);function h(o,l){Zn(this,h),o.events===void 0?o.events=[this]:o.events.push(this),this.point=o,this.isLeft=l}return rn(h,[{key:"link",value:function(l){if(l.point===this.point)throw new Error("Tried to link already linked events");for(var u=l.point.events,d=0,g=u.length;d<g;d++){var y=u[d];this.point.events.push(y),y.point=this.point}this.checkForConsuming()}},{key:"checkForConsuming",value:function(){for(var l=this.point.events.length,u=0;u<l;u++){var d=this.point.events[u];if(d.segment.consumedBy===void 0)for(var g=u+1;g<l;g++){var y=this.point.events[g];y.consumedBy===void 0&&d.otherSE.point.events===y.otherSE.point.events&&d.segment.consume(y.segment)}}}},{key:"getAvailableLinkedEvents",value:function(){for(var l=[],u=0,d=this.point.events.length;u<d;u++){var g=this.point.events[u];g!==this&&!g.segment.ringOut&&g.segment.isInResult()&&l.push(g)}return l}},{key:"getLeftmostComparator",value:function(l){var u=this,d=new Map,g=function(n){var w=n.otherSE;d.set(n,{sine:vb(u.point,l.point,w.point),cosine:xb(u.point,l.point,w.point)})};return function(y,n){d.has(y)||g(y),d.has(n)||g(n);var w=d.get(y),T=w.sine,M=w.cosine,I=d.get(n),P=I.sine,z=I.cosine;return T>=0&&P>=0?M<z?1:M>z?-1:0:T<0&&P<0?M<z?-1:M>z?1:0:P<T?-1:P>T?1:0}}}]),h}(),wb=0,Dp=function(){rn(h,null,[{key:"compare",value:function(l,u){var d=l.leftSE.point.x,g=u.leftSE.point.x,y=l.rightSE.point.x,n=u.rightSE.point.x;if(n<d)return 1;if(y<g)return-1;var w=l.leftSE.point.y,T=u.leftSE.point.y,M=l.rightSE.point.y,I=u.rightSE.point.y;if(d<g){if(T<w&&T<M)return 1;if(T>w&&T>M)return-1;var P=l.comparePoint(u.leftSE.point);if(P<0)return 1;if(P>0)return-1;var z=u.comparePoint(l.rightSE.point);return z!==0?z:-1}if(d>g){if(w<T&&w<I)return-1;if(w>T&&w>I)return 1;var R=u.comparePoint(l.leftSE.point);if(R!==0)return R;var F=l.comparePoint(u.rightSE.point);return F<0?1:F>0?-1:1}if(w<T)return-1;if(w>T)return 1;if(y<n){var q=u.comparePoint(l.rightSE.point);if(q!==0)return q}if(y>n){var ae=l.comparePoint(u.rightSE.point);if(ae<0)return 1;if(ae>0)return-1}if(y!==n){var se=M-w,ie=y-d,Q=I-T,re=n-g;if(se>ie&&Q<re)return 1;if(se<ie&&Q>re)return-1}return y>n?1:y<n||M<I?-1:M>I?1:l.id<u.id?-1:l.id>u.id?1:0}}]);function h(o,l,u,d){Zn(this,h),this.id=++wb,this.leftSE=o,o.segment=this,o.otherSE=l,this.rightSE=l,l.segment=this,l.otherSE=o,this.rings=u,this.windings=d}return rn(h,[{key:"replaceRightSE",value:function(l){this.rightSE=l,this.rightSE.segment=this,this.rightSE.otherSE=this.leftSE,this.leftSE.otherSE=this.rightSE}},{key:"bbox",value:function(){var l=this.leftSE.point.y,u=this.rightSE.point.y;return{ll:{x:this.leftSE.point.x,y:l<u?l:u},ur:{x:this.rightSE.point.x,y:l>u?l:u}}}},{key:"vector",value:function(){return{x:this.rightSE.point.x-this.leftSE.point.x,y:this.rightSE.point.y-this.leftSE.point.y}}},{key:"isAnEndpoint",value:function(l){return l.x===this.leftSE.point.x&&l.y===this.leftSE.point.y||l.x===this.rightSE.point.x&&l.y===this.rightSE.point.y}},{key:"comparePoint",value:function(l){if(this.isAnEndpoint(l))return 0;var u=this.leftSE.point,d=this.rightSE.point,g=this.vector();if(u.x===d.x)return l.x===u.x?0:l.x<u.x?1:-1;var y=(l.y-u.y)/g.y,n=u.x+y*g.x;if(l.x===n)return 0;var w=(l.x-u.x)/g.x,T=u.y+w*g.y;return l.y===T?0:l.y<T?-1:1}},{key:"getIntersection",value:function(l){var u=this.bbox(),d=l.bbox(),g=Vd(u,d);if(g===null)return null;var y=this.leftSE.point,n=this.rightSE.point,w=l.leftSE.point,T=l.rightSE.point,M=Tu(u,w)&&this.comparePoint(w)===0,I=Tu(d,y)&&l.comparePoint(y)===0,P=Tu(u,T)&&this.comparePoint(T)===0,z=Tu(d,n)&&l.comparePoint(n)===0;if(I&&M)return z&&!P?n:!z&&P?T:null;if(I)return P&&y.x===T.x&&y.y===T.y?null:y;if(M)return z&&n.x===w.x&&n.y===w.y?null:w;if(z&&P)return null;if(z)return n;if(P)return T;var R=bb(y,this.vector(),w,l.vector());return R===null||!Tu(g,R)?null:Vu.round(R.x,R.y)}},{key:"split",value:function(l){var u=[],d=l.events!==void 0,g=new ko(l,!0),y=new ko(l,!1),n=this.rightSE;this.replaceRightSE(y),u.push(y),u.push(g);var w=new h(g,n,this.rings.slice(),this.windings.slice());return ko.comparePoints(w.leftSE.point,w.rightSE.point)>0&&w.swapEvents(),ko.comparePoints(this.leftSE.point,this.rightSE.point)>0&&this.swapEvents(),d&&(g.checkForConsuming(),y.checkForConsuming()),u}},{key:"swapEvents",value:function(){var l=this.rightSE;this.rightSE=this.leftSE,this.leftSE=l,this.leftSE.isLeft=!0,this.rightSE.isLeft=!1;for(var u=0,d=this.windings.length;u<d;u++)this.windings[u]*=-1}},{key:"consume",value:function(l){for(var u=this,d=l;u.consumedBy;)u=u.consumedBy;for(;d.consumedBy;)d=d.consumedBy;var g=h.compare(u,d);if(g!==0){if(g>0){var y=u;u=d,d=y}if(u.prev===d){var n=u;u=d,d=n}for(var w=0,T=d.rings.length;w<T;w++){var M=d.rings[w],I=d.windings[w],P=u.rings.indexOf(M);P===-1?(u.rings.push(M),u.windings.push(I)):u.windings[P]+=I}d.rings=null,d.windings=null,d.consumedBy=u,d.leftSE.consumedBy=u.leftSE,d.rightSE.consumedBy=u.rightSE}}},{key:"prevInResult",value:function(){return this._prevInResult!==void 0?this._prevInResult:(this.prev?this.prev.isInResult()?this._prevInResult=this.prev:this._prevInResult=this.prev.prevInResult():this._prevInResult=null,this._prevInResult)}},{key:"beforeState",value:function(){if(this._beforeState!==void 0)return this._beforeState;if(!this.prev)this._beforeState={rings:[],windings:[],multiPolys:[]};else{var l=this.prev.consumedBy||this.prev;this._beforeState=l.afterState()}return this._beforeState}},{key:"afterState",value:function(){if(this._afterState!==void 0)return this._afterState;var l=this.beforeState();this._afterState={rings:l.rings.slice(0),windings:l.windings.slice(0),multiPolys:[]};for(var u=this._afterState.rings,d=this._afterState.windings,g=this._afterState.multiPolys,y=0,n=this.rings.length;y<n;y++){var w=this.rings[y],T=this.windings[y],M=u.indexOf(w);M===-1?(u.push(w),d.push(T)):d[M]+=T}for(var I=[],P=[],z=0,R=u.length;z<R;z++)if(d[z]!==0){var F=u[z],q=F.poly;if(P.indexOf(q)===-1)if(F.isExterior)I.push(q);else{P.indexOf(q)===-1&&P.push(q);var ae=I.indexOf(F.poly);ae!==-1&&I.splice(ae,1)}}for(var se=0,ie=I.length;se<ie;se++){var Q=I[se].multiPoly;g.indexOf(Q)===-1&&g.push(Q)}return this._afterState}},{key:"isInResult",value:function(){if(this.consumedBy)return!1;if(this._isInResult!==void 0)return this._isInResult;var l=this.beforeState().multiPolys,u=this.afterState().multiPolys;switch(lo.type){case"union":{var d=l.length===0,g=u.length===0;this._isInResult=d!==g;break}case"intersection":{var y,n;l.length<u.length?(y=l.length,n=u.length):(y=u.length,n=l.length),this._isInResult=n===lo.numMultiPolys&&y<n;break}case"xor":{var w=Math.abs(l.length-u.length);this._isInResult=w%2===1;break}case"difference":{var T=function(I){return I.length===1&&I[0].isSubject};this._isInResult=T(l)!==T(u);break}default:throw new Error("Unrecognized operation type found ".concat(lo.type))}return this._isInResult}}],[{key:"fromRing",value:function(l,u,d){var g,y,n,w=ko.comparePoints(l,u);if(w<0)g=l,y=u,n=1;else if(w>0)g=u,y=l,n=-1;else throw new Error("Tried to create degenerate segment at [".concat(l.x,", ").concat(l.y,"]"));var T=new ko(g,!0),M=new ko(y,!1);return new h(T,M,[d],[n])}}]),h}(),Eg=function(){function h(o,l,u){if(Zn(this,h),!Array.isArray(o)||o.length===0)throw new Error("Input geometry is not a valid Polygon or MultiPolygon");if(this.poly=l,this.isExterior=u,this.segments=[],typeof o[0][0]!="number"||typeof o[0][1]!="number")throw new Error("Input geometry is not a valid Polygon or MultiPolygon");var d=Vu.round(o[0][0],o[0][1]);this.bbox={ll:{x:d.x,y:d.y},ur:{x:d.x,y:d.y}};for(var g=d,y=1,n=o.length;y<n;y++){if(typeof o[y][0]!="number"||typeof o[y][1]!="number")throw new Error("Input geometry is not a valid Polygon or MultiPolygon");var w=Vu.round(o[y][0],o[y][1]);w.x===g.x&&w.y===g.y||(this.segments.push(Dp.fromRing(g,w,this)),w.x<this.bbox.ll.x&&(this.bbox.ll.x=w.x),w.y<this.bbox.ll.y&&(this.bbox.ll.y=w.y),w.x>this.bbox.ur.x&&(this.bbox.ur.x=w.x),w.y>this.bbox.ur.y&&(this.bbox.ur.y=w.y),g=w)}(d.x!==g.x||d.y!==g.y)&&this.segments.push(Dp.fromRing(g,d,this))}return rn(h,[{key:"getSweepEvents",value:function(){for(var l=[],u=0,d=this.segments.length;u<d;u++){var g=this.segments[u];l.push(g.leftSE),l.push(g.rightSE)}return l}}]),h}(),Eb=function(){function h(o,l){if(Zn(this,h),!Array.isArray(o))throw new Error("Input geometry is not a valid Polygon or MultiPolygon");this.exteriorRing=new Eg(o[0],this,!0),this.bbox={ll:{x:this.exteriorRing.bbox.ll.x,y:this.exteriorRing.bbox.ll.y},ur:{x:this.exteriorRing.bbox.ur.x,y:this.exteriorRing.bbox.ur.y}},this.interiorRings=[];for(var u=1,d=o.length;u<d;u++){var g=new Eg(o[u],this,!1);g.bbox.ll.x<this.bbox.ll.x&&(this.bbox.ll.x=g.bbox.ll.x),g.bbox.ll.y<this.bbox.ll.y&&(this.bbox.ll.y=g.bbox.ll.y),g.bbox.ur.x>this.bbox.ur.x&&(this.bbox.ur.x=g.bbox.ur.x),g.bbox.ur.y>this.bbox.ur.y&&(this.bbox.ur.y=g.bbox.ur.y),this.interiorRings.push(g)}this.multiPoly=l}return rn(h,[{key:"getSweepEvents",value:function(){for(var l=this.exteriorRing.getSweepEvents(),u=0,d=this.interiorRings.length;u<d;u++)for(var g=this.interiorRings[u].getSweepEvents(),y=0,n=g.length;y<n;y++)l.push(g[y]);return l}}]),h}(),Tg=function(){function h(o,l){if(Zn(this,h),!Array.isArray(o))throw new Error("Input geometry is not a valid Polygon or MultiPolygon");try{typeof o[0][0][0]=="number"&&(o=[o])}catch{}this.polys=[],this.bbox={ll:{x:Number.POSITIVE_INFINITY,y:Number.POSITIVE_INFINITY},ur:{x:Number.NEGATIVE_INFINITY,y:Number.NEGATIVE_INFINITY}};for(var u=0,d=o.length;u<d;u++){var g=new Eb(o[u],this);g.bbox.ll.x<this.bbox.ll.x&&(this.bbox.ll.x=g.bbox.ll.x),g.bbox.ll.y<this.bbox.ll.y&&(this.bbox.ll.y=g.bbox.ll.y),g.bbox.ur.x>this.bbox.ur.x&&(this.bbox.ur.x=g.bbox.ur.x),g.bbox.ur.y>this.bbox.ur.y&&(this.bbox.ur.y=g.bbox.ur.y),this.polys.push(g)}this.isSubject=l}return rn(h,[{key:"getSweepEvents",value:function(){for(var l=[],u=0,d=this.polys.length;u<d;u++)for(var g=this.polys[u].getSweepEvents(),y=0,n=g.length;y<n;y++)l.push(g[y]);return l}}]),h}(),Tb=function(){rn(h,null,[{key:"factory",value:function(l){for(var u=[],d=0,g=l.length;d<g;d++){var y=l[d];if(!(!y.isInResult()||y.ringOut)){for(var n=null,w=y.leftSE,T=y.rightSE,M=[w],I=w.point,P=[];n=w,w=T,M.push(w),w.point!==I;)for(;;){var z=w.getAvailableLinkedEvents();if(z.length===0){var R=M[0].point,F=M[M.length-1].point;throw new Error("Unable to complete output ring starting at [".concat(R.x,",")+" ".concat(R.y,"]. Last matching segment found ends at")+" [".concat(F.x,", ").concat(F.y,"]."))}if(z.length===1){T=z[0].otherSE;break}for(var q=null,ae=0,se=P.length;ae<se;ae++)if(P[ae].point===w.point){q=ae;break}if(q!==null){var ie=P.splice(q)[0],Q=M.splice(ie.index);Q.unshift(Q[0].otherSE),u.push(new h(Q.reverse()));continue}P.push({index:M.length,point:w.point});var re=w.getLeftmostComparator(n);T=z.sort(re)[0].otherSE;break}u.push(new h(M))}}return u}}]);function h(o){Zn(this,h),this.events=o;for(var l=0,u=o.length;l<u;l++)o[l].segment.ringOut=this;this.poly=null}return rn(h,[{key:"getGeom",value:function(){for(var l=this.events[0].point,u=[l],d=1,g=this.events.length-1;d<g;d++){var y=this.events[d].point,n=this.events[d+1].point;xg(y,l,n)!==0&&(u.push(y),l=y)}if(u.length===1)return null;var w=u[0],T=u[1];xg(w,l,T)===0&&u.shift(),u.push(u[0]);for(var M=this.isExteriorRing()?1:-1,I=this.isExteriorRing()?0:u.length-1,P=this.isExteriorRing()?u.length:-1,z=[],R=I;R!=P;R+=M)z.push([u[R].x,u[R].y]);return z}},{key:"isExteriorRing",value:function(){if(this._isExteriorRing===void 0){var l=this.enclosingRing();this._isExteriorRing=l?!l.isExteriorRing():!0}return this._isExteriorRing}},{key:"enclosingRing",value:function(){return this._enclosingRing===void 0&&(this._enclosingRing=this._calcEnclosingRing()),this._enclosingRing}},{key:"_calcEnclosingRing",value:function(){for(var l=this.events[0],u=1,d=this.events.length;u<d;u++){var g=this.events[u];ko.compare(l,g)>0&&(l=g)}for(var y=l.segment.prevInResult(),n=y?y.prevInResult():null;;){if(!y)return null;if(!n)return y.ringOut;if(n.ringOut!==y.ringOut)return n.ringOut.enclosingRing()!==y.ringOut?y.ringOut:y.ringOut.enclosingRing();y=n.prevInResult(),n=y?y.prevInResult():null}}}]),h}(),Ag=function(){function h(o){Zn(this,h),this.exteriorRing=o,o.poly=this,this.interiorRings=[]}return rn(h,[{key:"addInterior",value:function(l){this.interiorRings.push(l),l.poly=this}},{key:"getGeom",value:function(){var l=[this.exteriorRing.getGeom()];if(l[0]===null)return null;for(var u=0,d=this.interiorRings.length;u<d;u++){var g=this.interiorRings[u].getGeom();g!==null&&l.push(g)}return l}}]),h}(),Ab=function(){function h(o){Zn(this,h),this.rings=o,this.polys=this._composePolys(o)}return rn(h,[{key:"getGeom",value:function(){for(var l=[],u=0,d=this.polys.length;u<d;u++){var g=this.polys[u].getGeom();g!==null&&l.push(g)}return l}},{key:"_composePolys",value:function(l){for(var u=[],d=0,g=l.length;d<g;d++){var y=l[d];if(!y.poly)if(y.isExteriorRing())u.push(new Ag(y));else{var n=y.enclosingRing();n.poly||u.push(new Ag(n)),n.poly.addInterior(y)}}return u}}]),h}(),Sb=function(){function h(o){var l=arguments.length>1&&arguments[1]!==void 0?arguments[1]:Dp.compare;Zn(this,h),this.queue=o,this.tree=new g1(l),this.segments=[]}return rn(h,[{key:"process",value:function(l){var u=l.segment,d=[];if(l.consumedBy)return l.isLeft?this.queue.remove(l.otherSE):this.tree.remove(u),d;var g=l.isLeft?this.tree.insert(u):this.tree.find(u);if(!g)throw new Error("Unable to find segment #".concat(u.id," ")+"[".concat(u.leftSE.point.x,", ").concat(u.leftSE.point.y,"] -> ")+"[".concat(u.rightSE.point.x,", ").concat(u.rightSE.point.y,"] ")+"in SweepLine tree. Please submit a bug report.");for(var y=g,n=g,w=void 0,T=void 0;w===void 0;)y=this.tree.prev(y),y===null?w=null:y.key.consumedBy===void 0&&(w=y.key);for(;T===void 0;)n=this.tree.next(n),n===null?T=null:n.key.consumedBy===void 0&&(T=n.key);if(l.isLeft){var M=null;if(w){var I=w.getIntersection(u);if(I!==null&&(u.isAnEndpoint(I)||(M=I),!w.isAnEndpoint(I)))for(var P=this._splitSafely(w,I),z=0,R=P.length;z<R;z++)d.push(P[z])}var F=null;if(T){var q=T.getIntersection(u);if(q!==null&&(u.isAnEndpoint(q)||(F=q),!T.isAnEndpoint(q)))for(var ae=this._splitSafely(T,q),se=0,ie=ae.length;se<ie;se++)d.push(ae[se])}if(M!==null||F!==null){var Q=null;if(M===null)Q=F;else if(F===null)Q=M;else{var re=ko.comparePoints(M,F);Q=re<=0?M:F}this.queue.remove(u.rightSE),d.push(u.rightSE);for(var Ae=u.split(Q),$e=0,Je=Ae.length;$e<Je;$e++)d.push(Ae[$e])}d.length>0?(this.tree.remove(u),d.push(l)):(this.segments.push(u),u.prev=w)}else{if(w&&T){var ze=w.getIntersection(T);if(ze!==null){if(!w.isAnEndpoint(ze))for(var Pe=this._splitSafely(w,ze),Ge=0,Qe=Pe.length;Ge<Qe;Ge++)d.push(Pe[Ge]);if(!T.isAnEndpoint(ze))for(var Rt=this._splitSafely(T,ze),mt=0,Ne=Rt.length;mt<Ne;mt++)d.push(Rt[mt])}}this.tree.remove(u)}return d}},{key:"_splitSafely",value:function(l,u){this.tree.remove(l);var d=l.rightSE;this.queue.remove(d);var g=l.split(u);return g.push(d),l.consumedBy===void 0&&this.tree.insert(l),g}}]),h}(),Sg=typeof process!="undefined"&&{}.POLYGON_CLIPPING_MAX_QUEUE_SIZE||1e6,Mb=typeof process!="undefined"&&{}.POLYGON_CLIPPING_MAX_SWEEPLINE_SEGMENTS||1e6,Ib=function(){function h(){Zn(this,h)}return rn(h,[{key:"run",value:function(l,u,d){lo.type=l,Vu.reset();for(var g=[new Tg(u,!0)],y=0,n=d.length;y<n;y++)g.push(new Tg(d[y],!1));if(lo.numMultiPolys=g.length,lo.type==="difference")for(var w=g[0],T=1;T<g.length;)Vd(g[T].bbox,w.bbox)!==null?T++:g.splice(T,1);if(lo.type==="intersection"){for(var M=0,I=g.length;M<I;M++)for(var P=g[M],z=M+1,R=g.length;z<R;z++)if(Vd(P.bbox,g[z].bbox)===null)return[]}for(var F=new g1(ko.compare),q=0,ae=g.length;q<ae;q++)for(var se=g[q].getSweepEvents(),ie=0,Q=se.length;ie<Q;ie++)if(F.insert(se[ie]),F.size>Sg)throw new Error("Infinite loop when putting segment endpoints in a priority queue (queue size too big). Please file a bug report.");for(var re=new Sb(F),Ae=F.size,$e=F.pop();$e;){var Je=$e.key;if(F.size===Ae){var ze=Je.segment;throw new Error("Unable to pop() ".concat(Je.isLeft?"left":"right"," SweepEvent ")+"[".concat(Je.point.x,", ").concat(Je.point.y,"] from segment #").concat(ze.id," ")+"[".concat(ze.leftSE.point.x,", ").concat(ze.leftSE.point.y,"] -> ")+"[".concat(ze.rightSE.point.x,", ").concat(ze.rightSE.point.y,"] from queue. ")+"Please file a bug report.")}if(F.size>Sg)throw new Error("Infinite loop when passing sweep line over endpoints (queue size too big). Please file a bug report.");if(re.segments.length>Mb)throw new Error("Infinite loop when passing sweep line over endpoints (too many sweep line segments). Please file a bug report.");for(var Pe=re.process(Je),Ge=0,Qe=Pe.length;Ge<Qe;Ge++){var Rt=Pe[Ge];Rt.consumedBy===void 0&&F.insert(Rt)}Ae=F.size,$e=F.pop()}Vu.reset();var mt=Tb.factory(re.segments),Ne=new Ab(mt);return Ne.getGeom()}}]),h}(),lo=new Ib,kb=function(o){for(var l=arguments.length,u=new Array(l>1?l-1:0),d=1;d<l;d++)u[d-1]=arguments[d];return lo.run("union",o,u)},Cb=function(o){for(var l=arguments.length,u=new Array(l>1?l-1:0),d=1;d<l;d++)u[d-1]=arguments[d];return lo.run("intersection",o,u)},zb=function(o){for(var l=arguments.length,u=new Array(l>1?l-1:0),d=1;d<l;d++)u[d-1]=arguments[d];return lo.run("xor",o,u)},Pb=function(o){for(var l=arguments.length,u=new Array(l>1?l-1:0),d=1;d<l;d++)u[d-1]=arguments[d];return lo.run("difference",o,u)},Db={union:kb,intersection:Cb,xor:zb,difference:Pb};function Mg(h){return h.type==="Feature"?h.geometry:h}function Lb(h,o){var l=Mg(h),u=Mg(o),d=h.properties||{},g=Db.difference(l.coordinates,u.coordinates);return g.length===0?null:g.length===1?B3(g[0],d):O3(g,d)}function Rb(h,o,l){let u,d,g,{feature:y}=o,{layerId:n="mask-layer"}=o;const w="mask-source",T={type:"Feature",properties:{},geometry:{type:"Polygon",coordinates:[[[-180,90],[180,90],[180,-90],[-180,-90],[-180,90]]]}},{MAP:M}=kr("map");return xt(h,M,I=>l(5,g=I)),u1(()=>{g.getLayer(n)&&g.removeLayer(n),g.getSource(w)&&g.removeSource(w)}),h.$$set=I=>{"feature"in I&&l(1,y=I.feature),"layerId"in I&&l(2,n=I.layerId)},h.$$.update=()=>{h.$$.dirty&2&&l(4,u=y||{type:"Feature",geometry:{coordinates:[],type:"Polygon"}}),h.$$.dirty&16&&l(3,d=Lb(T,u)),h.$$.dirty&40&&(g.getSource(w)||g.addSource(w,{type:"geojson",data:d})),h.$$.dirty&40&&g.getSource(w).setData(d),h.$$.dirty&36&&g.addLayer({id:n,type:"fill",source:w,paint:{"fill-color":"#fff","fill-opacity":1}},"water")},[M,y,n,d,u,g]}class Bb extends Jt{constructor(o){super(),Qt(this,o,Rb,null,ei,{feature:1,layerId:2})}}function Ig(h){let o,l,u,d,g;return{c(){o=He("div"),l=He("div"),u=bt(),d=He("div"),g=Oe("Loading"),this.h()},l(y){o=Ye(y,"DIV",{class:!0});var n=Ce(o);l=Ye(n,"DIV",{class:!0}),Ce(l).forEach(W),u=wt(n),d=Ye(n,"DIV",{class:!0});var w=Ce(d);g=Fe(w,"Loading"),w.forEach(W),n.forEach(W),this.h()},h(){H(l,"class","loader svelte-17cnmrp"),H(d,"class","label svelte-17cnmrp"),H(o,"class","wrapper svelte-17cnmrp")},m(y,n){Me(y,o,n),de(o,l),de(o,u),de(o,d),de(d,g)},d(y){y&&W(o)}}}function Ob(h){let o,l=h[0]&&Ig();return{c(){l&&l.c(),o=Gi()},l(u){l&&l.l(u),o=Gi()},m(u,d){l&&l.m(u,d),Me(u,o,d)},p(u,[d]){u[0]?l||(l=Ig(),l.c(),l.m(o.parentNode,o)):l&&(l.d(1),l=null)},i:ti,o:ti,d(u){l&&l.d(u),u&&W(o)}}}function Fb(h,o,l){let{isLoading:u}=o;return h.$$set=d=>{"isLoading"in d&&l(0,u=d.isLoading)},[u]}class Ub extends Jt{constructor(o){super(),Qt(this,o,Fb,Ob,ei,{isLoading:0})}}function kg(h,o,l){const u=h.slice();return u[26]=o[l],u}function Vb(h){let o,l,u,d;o=new Bb({props:{feature:h[23].geoShape,layerId:"mask-layer"}});const g=[{colorScale:h[23].colorScale},h[26],{before:"mask-layer"}];let y={};for(let n=0;n<g.length;n+=1)y=Fi(y,g[n]);return u=new j3({props:y}),{c(){ht(o.$$.fragment),l=bt(),ht(u.$$.fragment)},l(n){pt(o.$$.fragment,n),l=wt(n),pt(u.$$.fragment,n)},m(n,w){ft(o,n,w),Me(n,l,w),ft(u,n,w),d=!0},p(n,w){const T={};w&8388608&&(T.feature=n[23].geoShape),o.$set(T);const M=w&8388608?yn(g,[{colorScale:n[23].colorScale},Na(n[26]),g[2]]):{};u.$set(M)},i(n){d||(Le(o.$$.fragment,n),Le(u.$$.fragment,n),d=!0)},o(n){Xe(o.$$.fragment,n),Xe(u.$$.fragment,n),d=!1},d(n){dt(o,n),n&&W(l),dt(u,n)}}}function Cg(h){let o,l=h[26].label+"",u;return{c(){o=He("div"),u=Oe(l),this.h()},l(d){o=Ye(d,"DIV",{style:!0,class:!0});var g=Ce(o);u=Fe(g,l),g.forEach(W),this.h()},h(){lr(o,"--color",h[26].color),H(o,"class","text-underlined scenario-label svelte-539dsy")},m(d,g){Me(d,o,g),de(o,u)},p(d,g){g&8388608&&l!==(l=d[26].label+"")&&zt(u,l),g&8388608&&lr(o,"--color",d[26].color)},d(d){d&&W(o)}}}function zg(h){let o,l,u,d,g,y,n,w;function T(R){h[17](R)}function M(R){h[18](R)}function I(R){h[19](R)}let P={fitShape:h[23].geoShape,resize:h[23].geoData.length,$$slots:{default:[Vb]},$$scope:{ctx:h}};h[4]!==void 0&&(P.zoom=h[4]),h[5]!==void 0&&(P.center=h[5]),h[6]!==void 0&&(P.bounds=h[6]),l=new V3({props:P}),cr.push(()=>zn(l,"zoom",T)),cr.push(()=>zn(l,"center",M)),cr.push(()=>zn(l,"bounds",I));let z=h[26].label&&Cg(h);return{c(){o=He("div"),ht(l.$$.fragment),y=bt(),z&&z.c(),n=bt(),this.h()},l(R){o=Ye(R,"DIV",{class:!0});var F=Ce(o);pt(l.$$.fragment,F),y=wt(F),z&&z.l(F),n=wt(F),F.forEach(W),this.h()},h(){H(o,"class","map-wrapper svelte-539dsy")},m(R,F){Me(R,o,F),ft(l,o,null),de(o,y),z&&z.m(o,null),de(o,n),w=!0},p(R,F){const q={};F&8388608&&(q.fitShape=R[23].geoShape),F&8388608&&(q.resize=R[23].geoData.length),F&545259520&&(q.$$scope={dirty:F,ctx:R}),!u&&F&16&&(u=!0,q.zoom=R[4],Cn(()=>u=!1)),!d&&F&32&&(d=!0,q.center=R[5],Cn(()=>d=!1)),!g&&F&64&&(g=!0,q.bounds=R[6],Cn(()=>g=!1)),l.$set(q),R[26].label?z?z.p(R,F):(z=Cg(R),z.c(),z.m(o,n)):z&&(z.d(1),z=null)},i(R){w||(Le(l.$$.fragment,R),w=!0)},o(R){Xe(l.$$.fragment,R),w=!1},d(R){R&&W(o),dt(l),z&&z.d()}}}function Nb(h){let o,l,u,d,g,y,n,w,T,M,I,P,z;const R=[{showDifference:h[23].showDifference},h[24],{data:h[23].geoData}];function F(Q){h[16](Q)}let q={};for(let Q=0;Q<R.length;Q+=1)q=Fi(q,R[Q]);h[0]!==void 0&&(q.displayOption=h[0]),u=new ab({props:q}),cr.push(()=>zn(u,"displayOption",F));let ae=h[23].geoData,se=[];for(let Q=0;Q<ae.length;Q+=1)se[Q]=zg(kg(h,ae,Q));const ie=Q=>Xe(se[Q],1,1,()=>{se[Q]=null});return T=new Ub({props:{isLoading:h[25]}}),P=new ub({props:{unit:h[24].currentIndicator.unit,scale:h[23].colorScale}}),{c(){o=He("div"),l=He("div"),ht(u.$$.fragment),g=bt(),y=He("div");for(let Q=0;Q<se.length;Q+=1)se[Q].c();w=bt(),ht(T.$$.fragment),M=bt(),I=He("div"),ht(P.$$.fragment),this.h()},l(Q){o=Ye(Q,"DIV",{class:!0});var re=Ce(o);l=Ye(re,"DIV",{class:!0});var Ae=Ce(l);pt(u.$$.fragment,Ae),Ae.forEach(W),g=wt(re),y=Ye(re,"DIV",{class:!0});var $e=Ce(y);for(let ze=0;ze<se.length;ze+=1)se[ze].l($e);$e.forEach(W),w=wt(re),pt(T.$$.fragment,re),M=wt(re),I=Ye(re,"DIV",{class:!0});var Je=Ce(I);pt(P.$$.fragment,Je),Je.forEach(W),re.forEach(W),this.h()},h(){H(l,"class","chart-info svelte-539dsy"),H(y,"class",n=Cp(`maps cols-${h[23].geoData.length}`)+" svelte-539dsy"),H(I,"class","legend svelte-539dsy"),H(o,"class","wrapper grid")},m(Q,re){Me(Q,o,re),de(o,l),ft(u,l,null),de(o,g),de(o,y);for(let Ae=0;Ae<se.length;Ae+=1)se[Ae].m(y,null);de(o,w),ft(T,o,null),de(o,M),de(o,I),ft(P,I,null),z=!0},p(Q,re){const Ae=re&25165824?yn(R,[re&8388608&&{showDifference:Q[23].showDifference},re&16777216&&Na(Q[24]),re&8388608&&{data:Q[23].geoData}]):{};if(!d&&re&1&&(d=!0,Ae.displayOption=Q[0],Cn(()=>d=!1)),u.$set(Ae),re&8388720){ae=Q[23].geoData;let ze;for(ze=0;ze<ae.length;ze+=1){const Pe=kg(Q,ae,ze);se[ze]?(se[ze].p(Pe,re),Le(se[ze],1)):(se[ze]=zg(Pe),se[ze].c(),Le(se[ze],1),se[ze].m(y,null))}for(br(),ze=ae.length;ze<se.length;ze+=1)ie(ze);wr()}(!z||re&8388608&&n!==(n=Cp(`maps cols-${Q[23].geoData.length}`)+" svelte-539dsy"))&&H(y,"class",n);const $e={};re&33554432&&($e.isLoading=Q[25]),T.$set($e);const Je={};re&16777216&&(Je.unit=Q[24].currentIndicator.unit),re&8388608&&(Je.scale=Q[23].colorScale),P.$set(Je)},i(Q){if(!z){Le(u.$$.fragment,Q);for(let re=0;re<ae.length;re+=1)Le(se[re]);Le(T.$$.fragment,Q),Le(P.$$.fragment,Q),z=!0}},o(Q){Xe(u.$$.fragment,Q),se=se.filter(Boolean);for(let re=0;re<se.length;re+=1)Xe(se[re]);Xe(T.$$.fragment,Q),Xe(P.$$.fragment,Q),z=!1},d(Q){Q&&W(o),dt(u),Br(se,Q),dt(T),dt(P)}}}function jb(h){let o,l;return o=new Xp({props:{asyncProps:{geoData:h[8],geoShape:h[9]},props:{currentYear:h[2],currentGeography:h[1],currentIndicator:h[3],currentOptions:h[10],currentScenarios:h[11]},process:h[7],$$slots:{default:[Nb,({asyncProps:u,props:d,isLoading:g})=>({23:u,24:d,25:g}),({asyncProps:u,props:d,isLoading:g})=>(u?8388608:0)|(d?16777216:0)|(g?33554432:0)]},$$scope:{ctx:h}}}),{c(){ht(o.$$.fragment)},l(u){pt(o.$$.fragment,u)},m(u,d){ft(o,u,d),l=!0},p(u,[d]){const g={};d&768&&(g.asyncProps={geoData:u[8],geoShape:u[9]}),d&3086&&(g.props={currentYear:u[2],currentGeography:u[1],currentIndicator:u[3],currentOptions:u[10],currentScenarios:u[11]}),d&128&&(g.process=u[7]),d&595591281&&(g.$$scope={dirty:d,ctx:u}),o.$set(g)},i(u){l||(Le(o.$$.fragment,u),l=!0)},o(u){Xe(o.$$.fragment,u),l=!1},d(u){dt(o,u)}}}function Gb(h,o,l){let u,d,g,y,n,w,T,M,I,P;xt(h,ac,Pe=>l(1,d=Pe)),xt(h,Ru,Pe=>l(14,g=Pe)),xt(h,kd,Pe=>l(2,y=Pe)),xt(h,$a,Pe=>l(3,n=Pe)),xt(h,Bu,Pe=>l(15,w=Pe)),xt(h,p1,Pe=>l(10,I=Pe)),xt(h,Wa,Pe=>l(11,P=Pe));let z="side-by-side",R,F,q;const ae=["#F9CEA6","#C91C1C"],se=["#437E8E","#DACFBF"],ie=["#437E8E","#F4E4D6","#C91C1C"];let Q=kn([]);xt(h,Q,Pe=>l(8,T=Pe));let re=kn({});xt(h,re,Pe=>l(9,M=Pe));function Ae(Pe){z=Pe,l(0,z)}function $e(Pe){R=Pe,l(4,R)}function Je(Pe){F=Pe,l(5,F)}function ze(Pe){q=Pe,l(6,q)}return h.$$.update=()=>{h.$$.dirty&49166&&Fu(Q,w.map(Pe=>({endpoint:Fx,params:Xi({geography:d.uid,indicator:n.uid,scenario:Pe,year:y},g)}))),h.$$.dirty&2&&Fu(re,{endpoint:Ux,params:{geography:d.uid}}),h.$$.dirty&1&&l(7,u=({geoData:Pe,geoShape:Ge},{currentScenarios:Qe})=>{const Rt=Pe.length===2,mt=z==="difference"&&Rt,Ne=Pe.length>1&&!mt,$t=mt?[(()=>{const[Ht,Ci]=Pe;return Ur(Xi({},Ht.data),{data:Ht.data.data.map((Ui,Kt)=>Ui.map((Yt,Lt)=>Yt===null?null:Ci.data.data[Kt][Lt]-Yt))})})()]:Pe.map((Ht,Ci)=>Xi(Xi({},Ne?Qe[Ci]:{}),Ht.data)),_t=(()=>{let Ht;const Ci=$t.map(Zt=>Zt.data).flat(3);let Ui=h3(Ci),[Kt,Yt]=Ui;if(Kt>=0&&Yt>=0||Kt<=0&&Yt<=0)Ht=Kt>=0?ae:se;else{const Zt=Math.abs(Kt)<=Yt,vr=Zt?Yt:Kt,vi=Zt?Kt:Yt,vn=Math.abs(vi/vr),fo=Zt?ie[2]:ie[0],xn=Zt?ie[0]:ie[2],Do=zp().domain([0,vi]).range([ie[1],xn])(vn*vi);Ht=Zt?[Do,ie[1],fo]:[fo,ie[1],Do],Ui=Zt?[vi,0,vr]:[vr,0,vi]}return zp().interpolate(hy).domain(Ui).range(Ht)})();return{showDifference:mt,geoData:$t,geoShape:Ge.data.data.features[0],colorScale:_t}})},[z,d,y,n,R,F,q,u,T,M,I,P,Q,re,g,w,Ae,$e,Je,ze]}class qb extends Jt{constructor(o){super(),Qt(this,o,Gb,jb,ei,{})}}const Zb=h=>({element:h&1}),Pg=h=>({element:h[0]});function $b(h){let o,l;const u=h[6].default,d=co(u,h,h[5],Pg);return{c(){o=He("div"),d&&d.c(),this.h()},l(g){o=Ye(g,"DIV",{class:!0});var y=Ce(o);d&&d.l(y),y.forEach(W),this.h()},h(){H(o,"class","layercake-layout-html svelte-1bu60uu"),lr(o,"z-index",h[1],!1),lr(o,"pointer-events",h[2]===!1?"none":null,!1),lr(o,"top",h[3].top+"px",!1),lr(o,"right",h[3].right+"px",!1),lr(o,"bottom",h[3].bottom+"px",!1),lr(o,"left",h[3].left+"px",!1)},m(g,y){Me(g,o,y),d&&d.m(o,null),h[7](o),l=!0},p(g,[y]){d&&d.p&&(!l||y&33)&&uo(d,u,g,g[5],l?po(u,g[5],y,Zb):ho(g[5]),Pg),y&2&&lr(o,"z-index",g[1],!1),y&4&&lr(o,"pointer-events",g[2]===!1?"none":null,!1),y&8&&lr(o,"top",g[3].top+"px",!1),y&8&&lr(o,"right",g[3].right+"px",!1),y&8&&lr(o,"bottom",g[3].bottom+"px",!1),y&8&&lr(o,"left",g[3].left+"px",!1)},i(g){l||(Le(d,g),l=!0)},o(g){Xe(d,g),l=!1},d(g){g&&W(o),d&&d.d(g),h[7](null)}}}function Wb(h,o,l){let u,{$$slots:d={},$$scope:g}=o,{element:y=void 0}=o,{zIndex:n=void 0}=o,{pointerEvents:w=void 0}=o;const{padding:T}=kr("LayerCake");xt(h,T,I=>l(3,u=I));function M(I){cr[I?"unshift":"push"](()=>{y=I,l(0,y)})}return h.$$set=I=>{"element"in I&&l(0,y=I.element),"zIndex"in I&&l(1,n=I.zIndex),"pointerEvents"in I&&l(2,w=I.pointerEvents),"$$scope"in I&&l(5,g=I.$$scope)},[y,n,w,u,T,g,d,M]}class Xb extends Jt{constructor(o){super(),Qt(this,o,Wb,$b,ei,{element:0,zIndex:1,pointerEvents:2})}}function Hb(h){let o,l,u,d,g=h[0][0].yearStep+"",y,n;return{c(){o=He("dt"),l=Oe("Data time increments:"),u=bt(),d=He("dd"),y=Oe(g),n=Oe(" years")},l(w){o=Ye(w,"DT",{});var T=Ce(o);l=Fe(T,"Data time increments:"),T.forEach(W),u=wt(w),d=Ye(w,"DD",{});var M=Ce(d);y=Fe(M,g),n=Fe(M," years"),M.forEach(W)},m(w,T){Me(w,o,T),de(o,l),Me(w,u,T),Me(w,d,T),de(d,y),de(d,n)},p(w,[T]){T&1&&g!==(g=w[0][0].yearStep+"")&&zt(y,g)},i:ti,o:ti,d(w){w&&W(o),w&&W(u),w&&W(d)}}}function Dg(h){return`${h} ${h===1?"year":"years"}`}function Yb(h,o,l){let{hasSingleScenario:u}=o,{impactTimeData:d}=o,{distributionData:g}=o;function y(T,M,I){var P;return T&&((P=I==null?void 0:I.mean)==null?void 0:P.length)?I.yearStep:!T&&M.length?r3(M.map(({yearStep:z})=>z)):void 0}const n=new Intl.ListFormat("en-GB",{style:"long",type:"conjunction"});function w(T){if(T)return oy(T)?n.format(T.map(M=>Dg(M))):Dg(T)}return h.$$set=T=>{"hasSingleScenario"in T&&l(1,u=T.hasSingleScenario),"impactTimeData"in T&&l(0,d=T.impactTimeData),"distributionData"in T&&l(2,g=T.distributionData)},h.$$.update=()=>{h.$$.dirty&7&&w(y(u,d,g))},[d,u,g]}class Kb extends Jt{constructor(o){super(),Qt(this,o,Yb,Hb,ei,{hasSingleScenario:1,impactTimeData:0,distributionData:2})}}function Jb(h){let o,l=h[0].label+"",u,d,g=h[1].label+"",y,n,w,T,M;return{c(){o=He("h2"),u=Oe(l),d=Oe(" in "),y=Oe(g),n=Oe(" from "),w=Oe(h[3]),T=Oe(" to "),M=Oe(h[2])},l(I){o=Ye(I,"H2",{});var P=Ce(o);u=Fe(P,l),d=Fe(P," in "),y=Fe(P,g),n=Fe(P," from "),w=Fe(P,h[3]),T=Fe(P," to "),M=Fe(P,h[2]),P.forEach(W)},m(I,P){Me(I,o,P),de(o,u),de(o,d),de(o,y),de(o,n),de(o,w),de(o,T),de(o,M)},p(I,[P]){P&1&&l!==(l=I[0].label+"")&&zt(u,l),P&2&&g!==(g=I[1].label+"")&&zt(y,g),P&8&&zt(w,I[3]),P&4&&zt(M,I[2])},i:ti,o:ti,d(I){I&&W(o)}}}function Qb(h,o,l){let u,d,{indicator:g}=o,{geography:y}=o,{impactTimeData:n}=o;return h.$$set=w=>{"indicator"in w&&l(0,g=w.indicator),"geography"in w&&l(1,y=w.geography),"impactTimeData"in w&&l(4,n=w.impactTimeData)},h.$$.update=()=>{h.$$.dirty&16&&l(3,u=n[0].values[0].year),h.$$.dirty&16&&l(2,d=fy(n[0].values,w=>w.year))},[g,y,d,u,n]}class e5 extends Jt{constructor(o){super(),Qt(this,o,Qb,Jb,ei,{indicator:0,geography:1,impactTimeData:4})}}function t5(h){let o;return{c(){o=Oe("The lines indicate the median estimates for each scenario.")},l(l){o=Fe(l,"The lines indicate the median estimates for each scenario.")},m(l,u){Me(l,o,u)},d(l){l&&W(o)}}}function i5(h){let o;return{c(){o=Oe(`The line indicates the median estimate for this scenario, while the coloured
    area shows the uncertainty range (see Methodology for more information).`)},l(l){o=Fe(l,`The line indicates the median estimate for this scenario, while the coloured
    area shows the uncertainty range (see Methodology for more information).`)},m(l,u){Me(l,o,u)},d(l){l&&W(o)}}}function r5(h){var $e,Je;let o,l,u=h[0].label+"",d,g,y=h[0].unit.labelLong+"",n,w,T=h[1].label+"",M,I,P=((Je=($e=h[3])==null?void 0:$e.reference)==null?void 0:Je.label)+"",z,R,F,q,ae,se,ie;F=new Wp({props:{scenarios:h[2]}});function Q(ze,Pe){return ze[2].length===1?i5:t5}let re=Q(h),Ae=re(h);return{c(){o=He("p"),l=Oe("This graph shows how changes in "),d=Oe(u),g=Oe(" (expressed in "),n=Oe(y),w=Oe(") will play out over time in "),M=Oe(T),I=Oe(` compared to the
  reference period `),z=Oe(P),R=Oe(`, according to the
  `),ht(F.$$.fragment),q=Oe("."),ae=bt(),se=He("p"),Ae.c()},l(ze){o=Ye(ze,"P",{});var Pe=Ce(o);l=Fe(Pe,"This graph shows how changes in "),d=Fe(Pe,u),g=Fe(Pe," (expressed in "),n=Fe(Pe,y),w=Fe(Pe,") will play out over time in "),M=Fe(Pe,T),I=Fe(Pe,` compared to the
  reference period `),z=Fe(Pe,P),R=Fe(Pe,`, according to the
  `),pt(F.$$.fragment,Pe),q=Fe(Pe,"."),Pe.forEach(W),ae=wt(ze),se=Ye(ze,"P",{});var Ge=Ce(se);Ae.l(Ge),Ge.forEach(W)},m(ze,Pe){Me(ze,o,Pe),de(o,l),de(o,d),de(o,g),de(o,n),de(o,w),de(o,M),de(o,I),de(o,z),de(o,R),ft(F,o,null),de(o,q),Me(ze,ae,Pe),Me(ze,se,Pe),Ae.m(se,null),ie=!0},p(ze,[Pe]){var Qe,Rt;(!ie||Pe&1)&&u!==(u=ze[0].label+"")&&zt(d,u),(!ie||Pe&1)&&y!==(y=ze[0].unit.labelLong+"")&&zt(n,y),(!ie||Pe&2)&&T!==(T=ze[1].label+"")&&zt(M,T),(!ie||Pe&8)&&P!==(P=((Rt=(Qe=ze[3])==null?void 0:Qe.reference)==null?void 0:Rt.label)+"")&&zt(z,P);const Ge={};Pe&4&&(Ge.scenarios=ze[2]),F.$set(Ge),re!==(re=Q(ze))&&(Ae.d(1),Ae=re(ze),Ae&&(Ae.c(),Ae.m(se,null)))},i(ze){ie||(Le(F.$$.fragment,ze),ie=!0)},o(ze){Xe(F.$$.fragment,ze),ie=!1},d(ze){ze&&W(o),dt(F),ze&&W(ae),ze&&W(se),Ae.d()}}}function n5(h,o,l){let{indicator:u}=o,{geography:d}=o,{scenarios:g}=o,{parameters:y}=o;return h.$$set=n=>{"indicator"in n&&l(0,u=n.indicator),"geography"in n&&l(1,d=n.geography),"scenarios"in n&&l(2,g=n.scenarios),"parameters"in n&&l(3,y=n.parameters)},[u,d,g,y]}class o5 extends Jt{constructor(o){super(),Qt(this,o,n5,r5,ei,{indicator:0,geography:1,scenarios:2,parameters:3})}}function s5(h){let o,l,u,d;return o=new Kb({props:{hasSingleScenario:h[11],impactTimeData:h[10]}}),u=new _1({props:{data:h[10].map(Lg)}}),{c(){ht(o.$$.fragment),l=bt(),ht(u.$$.fragment)},l(g){pt(o.$$.fragment,g),l=wt(g),pt(u.$$.fragment,g)},m(g,y){ft(o,g,y),Me(g,l,y),ft(u,g,y),d=!0},p(g,y){const n={};y&2048&&(n.hasSingleScenario=g[11]),y&1024&&(n.impactTimeData=g[10]),o.$set(n);const w={};y&1024&&(w.data=g[10].map(Lg)),u.$set(w)},i(g){d||(Le(o.$$.fragment,g),Le(u.$$.fragment,g),d=!0)},o(g){Xe(o.$$.fragment,g),Xe(u.$$.fragment,g),d=!1},d(g){dt(o,g),g&&W(l),dt(u,g)}}}function a5(h){let o,l,u,d,g,y,n,w,T,M,I;return u=new Dd({props:{yLabel:h[12].label,data:h[10],unit:h[12].unit.uid}}),y=new e5({props:{indicator:h[12],geography:h[14],hasSingleScenario:h[11],impactTimeData:h[10]}}),w=new o5({props:{indicator:h[12],geography:h[14],scenarios:h[13],parameters:h[15]}}),M=new m1({props:{$$slots:{default:[s5]},$$scope:{ctx:h}}}),{c(){o=He("div"),l=He("div"),ht(u.$$.fragment),d=bt(),g=He("div"),ht(y.$$.fragment),n=bt(),ht(w.$$.fragment),T=bt(),ht(M.$$.fragment),this.h()},l(P){o=Ye(P,"DIV",{class:!0});var z=Ce(o);l=Ye(z,"DIV",{class:!0});var R=Ce(l);pt(u.$$.fragment,R),R.forEach(W),d=wt(z),g=Ye(z,"DIV",{class:!0});var F=Ce(g);pt(y.$$.fragment,F),n=wt(F),pt(w.$$.fragment,F),T=wt(F),pt(M.$$.fragment,F),F.forEach(W),z.forEach(W),this.h()},h(){H(l,"class","chart svelte-1ljy9v5"),H(g,"class","chart-info svelte-1ljy9v5"),H(o,"class","wrapper grid")},m(P,z){Me(P,o,z),de(o,l),ft(u,l,null),de(o,d),de(o,g),ft(y,g,null),de(g,n),ft(w,g,null),de(g,T),ft(M,g,null),I=!0},p(P,z){const R={};z&4096&&(R.yLabel=P[12].label),z&1024&&(R.data=P[10]),z&4096&&(R.unit=P[12].unit.uid),u.$set(R);const F={};z&4096&&(F.indicator=P[12]),z&16384&&(F.geography=P[14]),z&2048&&(F.hasSingleScenario=P[11]),z&1024&&(F.impactTimeData=P[10]),y.$set(F);const q={};z&4096&&(q.indicator=P[12]),z&16384&&(q.geography=P[14]),z&8192&&(q.scenarios=P[13]),z&32768&&(q.parameters=P[15]),w.$set(q);const ae={};z&68608&&(ae.$$scope={dirty:z,ctx:P}),M.$set(ae)},i(P){I||(Le(u.$$.fragment,P),Le(y.$$.fragment,P),Le(w.$$.fragment,P),Le(M.$$.fragment,P),I=!0)},o(P){Xe(u.$$.fragment,P),Xe(y.$$.fragment,P),Xe(w.$$.fragment,P),Xe(M.$$.fragment,P),I=!1},d(P){P&&W(o),dt(u),dt(y),dt(w),dt(M)}}}function l5(h){let o,l;return o=new Xp({props:{process:h[2],asyncProps:{impactTimeData:h[3]},props:{indicator:h[0],scenarios:h[4],geography:h[1],parameters:h[5]},$$slots:{default:[a5,({asyncProps:{impactTime:u,hasSingleScenario:d},props:{indicator:g,scenarios:y,geography:n,parameters:w}})=>({10:u,11:d,12:g,13:y,14:n,15:w}),({asyncProps:u,props:d})=>(u?1024:0)|(u?2048:0)|(d?4096:0)|(d?8192:0)|(d?16384:0)|(d?32768:0)]},$$scope:{ctx:h}}}),{c(){ht(o.$$.fragment)},l(u){pt(o.$$.fragment,u)},m(u,d){ft(o,u,d),l=!0},p(u,[d]){const g={};d&4&&(g.process=u[2]),d&8&&(g.asyncProps={impactTimeData:u[3]}),d&51&&(g.props={indicator:u[0],scenarios:u[4],geography:u[1],parameters:u[5]}),d&130048&&(g.$$scope={dirty:d,ctx:u}),o.$set(g)},i(u){l||(Le(o.$$.fragment,u),l=!0)},o(u){Xe(o.$$.fragment,u),l=!1},d(u){dt(o,u)}}}const Lg=h=>h.model;function c5(h,o,l){let u,d,g,y,n,w,T,M,I;xt(h,Cd,z=>l(7,d=z)),xt(h,Ru,z=>l(8,g=z)),xt(h,$a,z=>l(0,y=z)),xt(h,ac,z=>l(1,n=z)),xt(h,Bu,z=>l(9,w=z)),xt(h,Wa,z=>l(4,M=z)),xt(h,p1,z=>l(5,I=z));let P=kn([]);return xt(h,P,z=>l(3,T=z)),h.$$.update=()=>{h.$$.dirty&771&&Fu(P,w.map(z=>({endpoint:sy,params:Xi({geography:n.uid,indicator:y.uid,scenario:z},g)}))),h.$$.dirty&128&&l(2,u=({impactTimeData:z},{scenarios:R})=>{const F=z.map((ae,se)=>{const{yearStart:ie,yearStep:Q,data:re,model:Ae,parameters:$e}=ae.data,Je=re[d];return{color:R[se].color,yearStart:ie,yearStep:Q,parameters:$e,model:Ae,strokeWidth:3,values:Je.map((ze,Pe)=>({min:ze[0],value:ze[1],max:ze[2],year:ie+Q*Pe}))}}),q=z.length===1;return{impactTime:F,hasSingleScenario:q}})},[y,n,u,T,M,I,P,d,g,w]}class u5 extends Jt{constructor(o){super(),Qt(this,o,c5,l5,ei,{})}}function Rg(h){let o,l,u,d,g;return l=new u5({}),d=new qb({}),{c(){o=He("div"),ht(l.$$.fragment),u=bt(),ht(d.$$.fragment),this.h()},l(y){o=Ye(y,"DIV",{class:!0});var n=Ce(o);pt(l.$$.fragment,n),u=wt(n),pt(d.$$.fragment,n),n.forEach(W),this.h()},h(){H(o,"class","wrapper vertical-space")},m(y,n){Me(y,o,n),ft(l,o,null),de(o,u),ft(d,o,null),g=!0},i(y){g||(Le(l.$$.fragment,y),Le(d.$$.fragment,y),g=!0)},o(y){Xe(l.$$.fragment,y),Xe(d.$$.fragment,y),g=!1},d(y){y&&W(o),dt(l),dt(d)}}}function h5(h){let o,l,u=h[0]&&Rg();return{c(){u&&u.c(),o=Gi()},l(d){u&&u.l(d),o=Gi()},m(d,g){u&&u.m(d,g),Me(d,o,g),l=!0},p(d,[g]){d[0]?u?g&1&&Le(u,1):(u=Rg(),u.c(),Le(u,1),u.m(o.parentNode,o)):u&&(br(),Xe(u,1,1,()=>{u=null}),wr())},i(d){l||(Le(u),l=!0)},o(d){Xe(u),l=!1},d(d){u&&u.d(d),d&&W(o)}}}function p5(h,o,l){let u;return xt(h,ay,d=>l(0,u=d)),[u]}class f5 extends Jt{constructor(o){super(),Qt(this,o,p5,h5,ei,{})}}function d5(h){let o,l,u,d,g,y,n,w,T,M,I,P,z,R;return{c(){o=fi("pattern"),l=fi("g"),u=fi("line"),g=fi("line"),T=fi("line"),this.h()},l(F){o=di(F,"pattern",{id:!0,width:!0,height:!0,patternUnits:!0});var q=Ce(o);l=di(q,"g",{});var ae=Ce(l);u=di(ae,"line",{x1:!0,x2:!0,y1:!0,y2:!0,style:!0}),Ce(u).forEach(W),g=di(ae,"line",{x1:!0,x2:!0,y1:!0,y2:!0,style:!0}),Ce(g).forEach(W),T=di(ae,"line",{x1:!0,x2:!0,y1:!0,y2:!0,style:!0}),Ce(T).forEach(W),ae.forEach(W),q.forEach(W),this.h()},h(){H(u,"x1",0),H(u,"x2",h[0]),H(u,"y1",h[0]),H(u,"y2",0),H(u,"style",d=`stroke: ${h[2]}; stroke-width: ${h[1]}`),H(g,"x1",y=-h[1]),H(g,"x2",h[1]),H(g,"y1",h[1]),H(g,"y2",n=-h[1]),H(g,"style",w=`stroke: ${h[2]}; stroke-width: ${h[1]}`),H(T,"x1",M=h[0]-h[1]),H(T,"x2",I=h[0]+h[1]),H(T,"y1",P=h[0]+h[1]),H(T,"y2",z=h[0]-h[1]),H(T,"style",R=`stroke: ${h[2]}; stroke-width: ${h[1]}`),H(o,"id",h[3]),H(o,"width",h[0]),H(o,"height",h[0]),H(o,"patternUnits","userSpaceOnUse")},m(F,q){Me(F,o,q),de(o,l),de(l,u),de(l,g),de(l,T)},p(F,[q]){q&1&&H(u,"x2",F[0]),q&1&&H(u,"y1",F[0]),q&6&&d!==(d=`stroke: ${F[2]}; stroke-width: ${F[1]}`)&&H(u,"style",d),q&2&&y!==(y=-F[1])&&H(g,"x1",y),q&2&&H(g,"x2",F[1]),q&2&&H(g,"y1",F[1]),q&2&&n!==(n=-F[1])&&H(g,"y2",n),q&6&&w!==(w=`stroke: ${F[2]}; stroke-width: ${F[1]}`)&&H(g,"style",w),q&3&&M!==(M=F[0]-F[1])&&H(T,"x1",M),q&3&&I!==(I=F[0]+F[1])&&H(T,"x2",I),q&3&&P!==(P=F[0]+F[1])&&H(T,"y1",P),q&3&&z!==(z=F[0]-F[1])&&H(T,"y2",z),q&6&&R!==(R=`stroke: ${F[2]}; stroke-width: ${F[1]}`)&&H(T,"style",R),q&8&&H(o,"id",F[3]),q&1&&H(o,"width",F[0]),q&1&&H(o,"height",F[0])},i:ti,o:ti,d(F){F&&W(o)}}}function m5(h,o,l){let{size:u=5}=o,{strokeWidth:d=1}=o,{color:g="white"}=o,{id:y="hatching"}=o;return h.$$set=n=>{"size"in n&&l(0,u=n.size),"strokeWidth"in n&&l(1,d=n.strokeWidth),"color"in n&&l(2,g=n.color),"id"in n&&l(3,y=n.id)},[u,d,g,y]}class _5 extends Jt{constructor(o){super(),Qt(this,o,m5,d5,ei,{size:0,strokeWidth:1,color:2,id:3})}}function Bg(h,o,l){const u=h.slice();return u[15]=o[l],u}function Og(h,o,l){const u=h.slice();return u[18]=o[l],u}function Fg(h,o,l){const u=h.slice();return u[21]=o[l],u[23]=l,u}function Ug(h){let o,l,u,d,g,y;l=new _5({props:{color:h[0]}});let n=h[4],w=[];for(let I=0;I<n.length;I+=1)w[I]=Vg(Fg(h,n,I));let T=h[3],M=[];for(let I=0;I<T.length;I+=1)M[I]=jg(Bg(h,T,I));return{c(){o=fi("defs"),ht(l.$$.fragment),u=bt(),d=fi("g");for(let I=0;I<w.length;I+=1)w[I].c();g=Gi();for(let I=0;I<M.length;I+=1)M[I].c()},l(I){o=di(I,"defs",{});var P=Ce(o);pt(l.$$.fragment,P),P.forEach(W),u=wt(I),d=di(I,"g",{});var z=Ce(d);for(let R=0;R<w.length;R+=1)w[R].l(z);g=Gi();for(let R=0;R<M.length;R+=1)M[R].l(z);z.forEach(W)},m(I,P){Me(I,o,P),ft(l,o,null),Me(I,u,P),Me(I,d,P);for(let z=0;z<w.length;z+=1)w[z].m(d,null);de(d,g);for(let z=0;z<M.length;z+=1)M[z].m(d,null);y=!0},p(I,P){const z={};if(P&1&&(z.color=I[0]),l.$set(z),P&118){n=I[4];let R;for(R=0;R<n.length;R+=1){const F=Fg(I,n,R);w[R]?w[R].p(F,P):(w[R]=Vg(F),w[R].c(),w[R].m(d,g))}for(;R<w.length;R+=1)w[R].d(1);w.length=n.length}if(P&202){T=I[3];let R;for(R=0;R<T.length;R+=1){const F=Bg(I,T,R);M[R]?M[R].p(F,P):(M[R]=jg(F),M[R].c(),M[R].m(d,null))}for(;R<M.length;R+=1)M[R].d(1);M.length=T.length}},i(I){y||(Le(l.$$.fragment,I),y=!0)},o(I){Xe(l.$$.fragment,I),y=!1},d(I){I&&W(o),dt(l),I&&W(u),I&&W(d),Br(w,I),Br(M,I)}}}function Vg(h){let o,l,u,d,g;return{c(){o=fi("rect"),this.h()},l(y){o=di(y,"rect",{x:!0,y:!0,height:!0,width:!0,fill:!0}),Ce(o).forEach(W),this.h()},h(){H(o,"x",l=h[1](h[21])),H(o,"y",u=h[5]-(h[5]-h[6](h[2].values[h[23]]))),H(o,"height",d=h[5]-h[6](h[2].values[h[23]])),H(o,"width",g=h[1].bandwidth()),H(o,"fill","url(#hatching)")},m(y,n){Me(y,o,n)},p(y,n){n&18&&l!==(l=y[1](y[21]))&&H(o,"x",l),n&100&&u!==(u=y[5]-(y[5]-y[6](y[2].values[y[23]])))&&H(o,"y",u),n&100&&d!==(d=y[5]-y[6](y[2].values[y[23]]))&&H(o,"height",d),n&2&&g!==(g=y[1].bandwidth())&&H(o,"width",g)},d(y){y&&W(o)}}}function Ng(h){let o,l,u,d,g;return{c(){o=fi("g"),l=fi("line"),this.h()},l(y){o=di(y,"g",{transform:!0});var n=Ce(o);l=di(n,"line",{x2:!0,class:!0,style:!0}),Ce(l).forEach(W),n.forEach(W),this.h()},h(){H(l,"x2",u=h[1].bandwidth()),H(l,"class","line svelte-awokas"),H(l,"style",d=`stroke: ${h[15].color};`),Dt(l,"active",Boolean(h[15].color)),H(o,"transform",g=`translate(${h[7](h[18])} ,${h[6](h[18])})`)},m(y,n){Me(y,o,n),de(o,l)},p(y,n){n&2&&u!==(u=y[1].bandwidth())&&H(l,"x2",u),n&8&&d!==(d=`stroke: ${y[15].color};`)&&H(l,"style",d),n&8&&Dt(l,"active",Boolean(y[15].color)),n&200&&g!==(g=`translate(${y[7](y[18])} ,${y[6](y[18])})`)&&H(o,"transform",g)},d(y){y&&W(o)}}}function jg(h){let o,l=h[15].values,u=[];for(let d=0;d<l.length;d+=1)u[d]=Ng(Og(h,l,d));return{c(){for(let d=0;d<u.length;d+=1)u[d].c();o=Gi()},l(d){for(let g=0;g<u.length;g+=1)u[g].l(d);o=Gi()},m(d,g){for(let y=0;y<u.length;y+=1)u[y].m(d,g);Me(d,o,g)},p(d,g){if(g&202){l=d[15].values;let y;for(y=0;y<l.length;y+=1){const n=Og(d,l,y);u[y]?u[y].p(n,g):(u[y]=Ng(n),u[y].c(),u[y].m(o.parentNode,o))}for(;y<u.length;y+=1)u[y].d(1);u.length=l.length}},d(d){Br(u,d),d&&W(o)}}}function g5(h){let o,l,u=h[5]>0&&Ug(h);return{c(){u&&u.c(),o=Gi()},l(d){u&&u.l(d),o=Gi()},m(d,g){u&&u.m(d,g),Me(d,o,g),l=!0},p(d,[g]){d[5]>0?u?(u.p(d,g),g&32&&Le(u,1)):(u=Ug(d),u.c(),Le(u,1),u.m(o.parentNode,o)):u&&(br(),Xe(u,1,1,()=>{u=null}),wr())},i(d){l||(Le(u),l=!0)},o(d){Xe(u),l=!1},d(d){u&&u.d(d),d&&W(o)}}}function y5(h,o,l){let u,d,g,y,n,w,T,M;const{data:I,xScale:P,yScale:z,yGet:R,height:F,xGet:q}=kr("LayerCake");xt(h,I,se=>l(13,y=se)),xt(h,P,se=>l(1,n=se)),xt(h,R,se=>l(6,T=se)),xt(h,F,se=>l(5,w=se)),xt(h,q,se=>l(7,M=se));let{hatchingColor:ae}=o;return h.$$set=se=>{"hatchingColor"in se&&l(0,ae=se.hatchingColor)},h.$$.update=()=>{h.$$.dirty&2&&l(4,u=n.domain()),h.$$.dirty&8192&&l(3,d=y.filter(se=>se.uid!==Ou)),h.$$.dirty&8192&&l(2,g=y.filter(se=>se.uid===Ou)[0])},[ae,n,g,d,u,w,T,M,I,P,R,F,q,y]}class v5 extends Jt{constructor(o){super(),Qt(this,o,y5,g5,ei,{hatchingColor:0})}}function Gg(h,o,l){const u=h.slice();return u[8]=o[l],u[10]=l,u}function qg(h){let o,l,u,d,g=h[8].label+"",y,n,w;return{c(){o=He("div"),l=He("div"),u=bt(),d=He("div"),y=Oe(g),n=bt(),this.h()},l(T){o=Ye(T,"DIV",{class:!0,style:!0});var M=Ce(o);l=Ye(M,"DIV",{class:!0,"aria-hidden":!0}),Ce(l).forEach(W),u=wt(M),d=Ye(M,"DIV",{class:!0});var I=Ce(d);y=Fe(I,g),I.forEach(W),n=wt(M),M.forEach(W),this.h()},h(){H(l,"class","tick-domain svelte-uplaxx"),H(l,"aria-hidden","true"),H(d,"class","tick-label svelte-uplaxx"),H(o,"class","tick svelte-uplaxx"),H(o,"style",w=`top: ${h[8].y2}px; height: ${h[8].height}px;`)},m(T,M){Me(T,o,M),de(o,l),de(o,u),de(o,d),de(d,y),de(o,n)},p(T,M){M&1&&g!==(g=T[8].label+"")&&zt(y,g),M&1&&w!==(w=`top: ${T[8].y2}px; height: ${T[8].height}px;`)&&H(o,"style",w)},d(T){T&&W(o)}}}function x5(h){let o,l=h[0],u=[];for(let d=0;d<l.length;d+=1)u[d]=qg(Gg(h,l,d));return{c(){o=He("div");for(let d=0;d<u.length;d+=1)u[d].c();this.h()},l(d){o=Ye(d,"DIV",{class:!0});var g=Ce(o);for(let y=0;y<u.length;y+=1)u[y].l(g);g.forEach(W),this.h()},h(){H(o,"class","root svelte-uplaxx")},m(d,g){Me(d,o,g);for(let y=0;y<u.length;y+=1)u[y].m(o,null)},p(d,[g]){if(g&1){l=d[0];let y;for(y=0;y<l.length;y+=1){const n=Gg(d,l,y);u[y]?u[y].p(n,g):(u[y]=qg(n),u[y].c(),u[y].m(o,null))}for(;y<u.length;y+=1)u[y].d(1);u.length=l.length}},i:ti,o:ti,d(d){d&&W(o),Br(u,d)}}}function b5(h,o,l){let u,d,g,y,n,w;const{data:T,yScale:M}=kr("LayerCake");return xt(h,T,I=>l(7,w=I)),xt(h,M,I=>l(6,n=I)),h.$$.update=()=>{h.$$.dirty&128&&l(5,u=w.find(I=>I.uid===Ou)),h.$$.dirty&32&&l(4,d=u.values[u.values.length-1].value),h.$$.dirty&128&&l(3,g=fy(w,I=>I.values[I.values.length-1].value)),h.$$.dirty&88&&l(0,y=[{label:"Unavoidable risk even with the highest-ambition scenario",min:0,max:d},{label:"Avoidable risk through mitigation",min:d,max:g}].map(I=>{const P=n(I.min),z=n(I.max),R=P-z,F=P-R/2;return Ur(Xi({},I),{y1:P,y2:z,height:R,centerY:F})}))},[y,T,M,g,d,u,n,w]}class w5 extends Jt{constructor(o){super(),Qt(this,o,b5,x5,ei,{})}}function E5(h){let o,l,u,d,g,y;return o=new v5({props:{hatchingColor:h[5].color.foreground.weakest}}),u=new cy({props:{gridlines:!1,padding:h[7],formatTick:h[3]}}),g=new uy({props:{formatTick:h[4],ticksHighlighted:[0,1]}}),{c(){ht(o.$$.fragment),l=bt(),ht(u.$$.fragment),d=bt(),ht(g.$$.fragment)},l(n){pt(o.$$.fragment,n),l=wt(n),pt(u.$$.fragment,n),d=wt(n),pt(g.$$.fragment,n)},m(n,w){ft(o,n,w),Me(n,l,w),ft(u,n,w),Me(n,d,w),ft(g,n,w),y=!0},p(n,w){const T={};w&32&&(T.hatchingColor=n[5].color.foreground.weakest),o.$set(T);const M={};w&8&&(M.formatTick=n[3]),u.$set(M);const I={};w&16&&(I.formatTick=n[4]),g.$set(I)},i(n){y||(Le(o.$$.fragment,n),Le(u.$$.fragment,n),Le(g.$$.fragment,n),y=!0)},o(n){Xe(o.$$.fragment,n),Xe(u.$$.fragment,n),Xe(g.$$.fragment,n),y=!1},d(n){dt(o,n),n&&W(l),dt(u,n),n&&W(d),dt(g,n)}}}function T5(h){let o,l,u;return l=new w5({}),{c(){o=He("div"),ht(l.$$.fragment),this.h()},l(d){o=Ye(d,"DIV",{class:!0});var g=Ce(o);pt(l.$$.fragment,g),g.forEach(W),this.h()},h(){H(o,"class","labels svelte-1lsmg8e")},m(d,g){Me(d,o,g),ft(l,o,null),u=!0},p:ti,i(d){u||(Le(l.$$.fragment,d),u=!0)},o(d){Xe(l.$$.fragment,d),u=!1},d(d){d&&W(o),dt(l)}}}function A5(h){let o,l,u,d;return o=new Yp({props:{$$slots:{default:[E5]},$$scope:{ctx:h}}}),u=new Xb({props:{$$slots:{default:[T5]},$$scope:{ctx:h}}}),{c(){ht(o.$$.fragment),l=bt(),ht(u.$$.fragment)},l(g){pt(o.$$.fragment,g),l=wt(g),pt(u.$$.fragment,g)},m(g,y){ft(o,g,y),Me(g,l,y),ft(u,g,y),d=!0},p(g,y){const n={};y&1080&&(n.$$scope={dirty:y,ctx:g}),o.$set(n);const w={};y&1024&&(w.$$scope={dirty:y,ctx:g}),u.$set(w)},i(g){d||(Le(o.$$.fragment,g),Le(u.$$.fragment,g),d=!0)},o(g){Xe(o.$$.fragment,g),Xe(u.$$.fragment,g),d=!1},d(g){dt(o,g),g&&W(l),dt(u,g)}}}function S5(h){let o,l,u;return l=new Hp({props:{data:h[0],x:h[1],y:h[2],padding:h[7],yDomain:[0,1],xScale:my().paddingOuter(.2).paddingInner(.2),flatData:h[8](h[0]),$$slots:{default:[A5]},$$scope:{ctx:h}}}),{c(){o=He("div"),ht(l.$$.fragment),this.h()},l(d){o=Ye(d,"DIV",{class:!0});var g=Ce(o);pt(l.$$.fragment,g),g.forEach(W),this.h()},h(){H(o,"class","chart-container svelte-1lsmg8e")},m(d,g){Me(d,o,g),ft(l,o,null),u=!0},p(d,[g]){const y={};g&1&&(y.data=d[0]),g&2&&(y.x=d[1]),g&4&&(y.y=d[2]),g&1&&(y.flatData=d[8](d[0])),g&1080&&(y.$$scope={dirty:g,ctx:d}),l.$set(y)},i(d){u||(Le(l.$$.fragment,d),u=!0)},o(d){Xe(l.$$.fragment,d),u=!1},d(d){d&&W(o),dt(l)}}}function M5(h,o,l){let u,d,g,{data:y}=o,{xKey:n="year"}=o,{yKey:w="value"}=o,{unit:T=zd}=o;const M=kr("theme");xt(h,M,z=>l(5,g=z));const I={top:5,right:0,bottom:20,left:0},P=z=>z.reduce((R,F)=>R.concat(F.values),[]);return h.$$set=z=>{"data"in z&&l(0,y=z.data),"xKey"in z&&l(1,n=z.xKey),"yKey"in z&&l(2,w=z.yKey),"unit"in z&&l(9,T=z.unit)},h.$$.update=()=>{h.$$.dirty&512&&l(4,u=z=>Hr(z,T))},l(3,d=z=>typeof z=="string"?z:Hr(z,"year")),[y,n,w,d,u,g,M,I,P,T]}class I5 extends Jt{constructor(o){super(),Qt(this,o,M5,S5,ei,{data:0,xKey:1,yKey:2,unit:9})}}function Zg(h,o,l){const u=h.slice();return u[17]=o[l],u}function k5(h){let o,l,u,d=h[11].values[0].formattedValue+"",g,y;return{c(){o=Oe("Today, the risk of what used to be a 1-in-20 year "),l=Oe(h[5]),u=Oe(` year in
    1850-1900 in Denmark is `),g=Oe(d),y=Oe(".")},l(n){o=Fe(n,"Today, the risk of what used to be a 1-in-20 year "),l=Fe(n,h[5]),u=Fe(n,` year in
    1850-1900 in Denmark is `),g=Fe(n,d),y=Fe(n,".")},m(n,w){Me(n,o,w),Me(n,l,w),Me(n,u,w),Me(n,g,w),Me(n,y,w)},p(n,w){w&32&&zt(l,n[5]),w&2048&&d!==(d=n[11].values[0].formattedValue+"")&&zt(g,d)},d(n){n&&W(o),n&&W(l),n&&W(u),n&&W(g),n&&W(y)}}}function C5(h){let o,l=h[3].frequency.label+"",u,d,g,y,n=h[2].label+"",w,T,M=h[11].values[0].formattedValue+"",I,P;return{c(){o=Oe("The risk of a "),u=Oe(l),d=Oe(" year "),g=Oe(h[5]),y=Oe(`
    year occurring today (in 2011-2020) in `),w=Oe(n),T=Oe(` is
    `),I=Oe(M),P=Oe(".")},l(z){o=Fe(z,"The risk of a "),u=Fe(z,l),d=Fe(z," year "),g=Fe(z,h[5]),y=Fe(z,`
    year occurring today (in 2011-2020) in `),w=Fe(z,n),T=Fe(z,` is
    `),I=Fe(z,M),P=Fe(z,".")},m(z,R){Me(z,o,R),Me(z,u,R),Me(z,d,R),Me(z,g,R),Me(z,y,R),Me(z,w,R),Me(z,T,R),Me(z,I,R),Me(z,P,R)},p(z,R){R&8&&l!==(l=z[3].frequency.label+"")&&zt(u,l),R&32&&zt(g,z[5]),R&4&&n!==(n=z[2].label+"")&&zt(w,n),R&2048&&M!==(M=z[11].values[0].formattedValue+"")&&zt(I,M)},d(z){z&&W(o),z&&W(u),z&&W(d),z&&W(g),z&&W(y),z&&W(w),z&&W(T),z&&W(I),z&&W(P)}}}function z5(h){let o,l=h[2].label+"",u,d,g,y,n=h[3].reference.label+"",w,T,M=h[11].values[0].formattedValue+"",I,P;return{c(){o=Oe("Today (2011-2020), the risk of annual mean temperatures in "),u=Oe(l),d=Oe(`
    exceeding
    `),g=Oe(h[4]),y=Oe(" from "),w=Oe(n),T=Oe(` levels is
    `),I=Oe(M),P=Oe(".")},l(z){o=Fe(z,"Today (2011-2020), the risk of annual mean temperatures in "),u=Fe(z,l),d=Fe(z,`
    exceeding
    `),g=Fe(z,h[4]),y=Fe(z," from "),w=Fe(z,n),T=Fe(z,` levels is
    `),I=Fe(z,M),P=Fe(z,".")},m(z,R){Me(z,o,R),Me(z,u,R),Me(z,d,R),Me(z,g,R),Me(z,y,R),Me(z,w,R),Me(z,T,R),Me(z,I,R),Me(z,P,R)},p(z,R){R&4&&l!==(l=z[2].label+"")&&zt(u,l),R&16&&zt(g,z[4]),R&8&&n!==(n=z[3].reference.label+"")&&zt(w,n),R&2048&&M!==(M=z[11].values[0].formattedValue+"")&&zt(I,M)},d(z){z&&W(o),z&&W(u),z&&W(d),z&&W(g),z&&W(y),z&&W(w),z&&W(T),z&&W(I),z&&W(P)}}}function $g(h){let o,l,u=h[8],d=[];for(let y=0;y<u.length;y+=1)d[y]=Wg(Zg(h,u,y));const g=y=>Xe(d[y],1,1,()=>{d[y]=null});return{c(){o=He("p");for(let y=0;y<d.length;y+=1)d[y].c()},l(y){o=Ye(y,"P",{});var n=Ce(o);for(let w=0;w<d.length;w+=1)d[w].l(n);n.forEach(W)},m(y,n){Me(y,o,n);for(let w=0;w<d.length;w+=1)d[w].m(o,null);l=!0},p(y,n){if(n&256){u=y[8];let w;for(w=0;w<u.length;w+=1){const T=Zg(y,u,w);d[w]?(d[w].p(T,n),Le(d[w],1)):(d[w]=Wg(T),d[w].c(),Le(d[w],1),d[w].m(o,null))}for(br(),w=u.length;w<d.length;w+=1)g(w);wr()}},i(y){if(!l){for(let n=0;n<u.length;n+=1)Le(d[n]);l=!0}},o(y){d=d.filter(Boolean);for(let n=0;n<d.length;n+=1)Xe(d[n]);l=!1},d(y){y&&W(o),Br(d,y)}}}function Wg(h){let o,l,u=h[17].values[0].formattedValue+"",d,g,y=h[17].values[1].formattedValue+"",n,w,T=h[17].values[2].formattedValue+"",M,I,P=" ",z,R;return o=new Ld({props:{scenario:h[17]}}),{c(){ht(o.$$.fragment),l=Oe(" would lead to risk levels of "),d=Oe(u),g=Oe(" in 2030, "),n=Oe(y),w=Oe(` in
      2050 and `),M=Oe(T),I=Oe(" in 2100."),z=Oe(P)},l(F){pt(o.$$.fragment,F),l=Fe(F," would lead to risk levels of "),d=Fe(F,u),g=Fe(F," in 2030, "),n=Fe(F,y),w=Fe(F,` in
      2050 and `),M=Fe(F,T),I=Fe(F," in 2100."),z=Fe(F,P)},m(F,q){ft(o,F,q),Me(F,l,q),Me(F,d,q),Me(F,g,q),Me(F,n,q),Me(F,w,q),Me(F,M,q),Me(F,I,q),Me(F,z,q),R=!0},p(F,q){const ae={};q&256&&(ae.scenario=F[17]),o.$set(ae),(!R||q&256)&&u!==(u=F[17].values[0].formattedValue+"")&&zt(d,u),(!R||q&256)&&y!==(y=F[17].values[1].formattedValue+"")&&zt(n,y),(!R||q&256)&&T!==(T=F[17].values[2].formattedValue+"")&&zt(M,T)},i(F){R||(Le(o.$$.fragment,F),R=!0)},o(F){Xe(o.$$.fragment,F),R=!1},d(F){dt(o,F),F&&W(l),F&&W(d),F&&W(g),F&&W(n),F&&W(w),F&&W(M),F&&W(I),F&&W(z)}}}function P5(h){let o,l;return o=new _1({props:{data:[h[1]]}}),{c(){ht(o.$$.fragment)},l(u){pt(o.$$.fragment,u)},m(u,d){ft(o,u,d),l=!0},p(u,d){const g={};d&2&&(g.data=[u[1]]),o.$set(g)},i(u){l||(Le(o.$$.fragment,u),l=!0)},o(u){Xe(o.$$.fragment,u),l=!1},d(u){dt(o,u)}}}function D5(h){let o,l,u=h[0].label+"",d,g,y,n,w,T,M,I,P=h[9].values[0].formattedValue+"",z,R,F=h[9].values[1].formattedValue+"",q,ae,se=h[9].values[2].formattedValue+"",ie,Q,re,Ae,$e=h[10].values[0].formattedValue+"",Je,ze,Pe=h[10].values[1].formattedValue+"",Ge,Qe,Rt=h[10].values[2].formattedValue+"",mt,Ne,At,$t,_t,Ht;function Ci(Lt,Zt){return Lt[7]?z5:Lt[6]?C5:k5}let Ui=Ci(h),Kt=Ui(h);M=new Ld({props:{scenario:h[9]}}),re=new Ld({props:{scenario:h[10]}});let Yt=h[8].length&&$g(h);return _t=new m1({props:{$$slots:{default:[P5]},$$scope:{ctx:h}}}),{c(){o=He("h2"),l=Oe("Risk from changes in "),d=Oe(u),g=bt(),y=He("p"),Kt.c(),n=bt(),w=He("p"),T=Oe("The "),ht(M.$$.fragment),I=Oe(` scenario \u2013 leading to the highest
  global mean temperature increase by 2100 \u2013 puts us on a trajectory to see this
  rise to `),z=Oe(P),R=Oe(" in 2030, "),q=Oe(F),ae=Oe(`
  in 2050 and `),ie=Oe(se),Q=Oe(" in 2100. In contrast, the "),ht(re.$$.fragment),Ae=Oe(` scenario \u2013 considered as the scenario with the highest feasible mitigation levels
  \u2013 would limit this risk to `),Je=Oe($e),ze=Oe(" in 2030, "),Ge=Oe(Pe),Qe=Oe(" in 2050 and "),mt=Oe(Rt),Ne=Oe(" in 2100."),At=bt(),Yt&&Yt.c(),$t=bt(),ht(_t.$$.fragment)},l(Lt){o=Ye(Lt,"H2",{});var Zt=Ce(o);l=Fe(Zt,"Risk from changes in "),d=Fe(Zt,u),Zt.forEach(W),g=wt(Lt),y=Ye(Lt,"P",{});var vr=Ce(y);Kt.l(vr),vr.forEach(W),n=wt(Lt),w=Ye(Lt,"P",{});var vi=Ce(w);T=Fe(vi,"The "),pt(M.$$.fragment,vi),I=Fe(vi,` scenario \u2013 leading to the highest
  global mean temperature increase by 2100 \u2013 puts us on a trajectory to see this
  rise to `),z=Fe(vi,P),R=Fe(vi," in 2030, "),q=Fe(vi,F),ae=Fe(vi,`
  in 2050 and `),ie=Fe(vi,se),Q=Fe(vi," in 2100. In contrast, the "),pt(re.$$.fragment,vi),Ae=Fe(vi,` scenario \u2013 considered as the scenario with the highest feasible mitigation levels
  \u2013 would limit this risk to `),Je=Fe(vi,$e),ze=Fe(vi," in 2030, "),Ge=Fe(vi,Pe),Qe=Fe(vi," in 2050 and "),mt=Fe(vi,Rt),Ne=Fe(vi," in 2100."),vi.forEach(W),At=wt(Lt),Yt&&Yt.l(Lt),$t=wt(Lt),pt(_t.$$.fragment,Lt)},m(Lt,Zt){Me(Lt,o,Zt),de(o,l),de(o,d),Me(Lt,g,Zt),Me(Lt,y,Zt),Kt.m(y,null),Me(Lt,n,Zt),Me(Lt,w,Zt),de(w,T),ft(M,w,null),de(w,I),de(w,z),de(w,R),de(w,q),de(w,ae),de(w,ie),de(w,Q),ft(re,w,null),de(w,Ae),de(w,Je),de(w,ze),de(w,Ge),de(w,Qe),de(w,mt),de(w,Ne),Me(Lt,At,Zt),Yt&&Yt.m(Lt,Zt),Me(Lt,$t,Zt),ft(_t,Lt,Zt),Ht=!0},p(Lt,[Zt]){(!Ht||Zt&1)&&u!==(u=Lt[0].label+"")&&zt(d,u),Ui===(Ui=Ci(Lt))&&Kt?Kt.p(Lt,Zt):(Kt.d(1),Kt=Ui(Lt),Kt&&(Kt.c(),Kt.m(y,null)));const vr={};Zt&512&&(vr.scenario=Lt[9]),M.$set(vr),(!Ht||Zt&512)&&P!==(P=Lt[9].values[0].formattedValue+"")&&zt(z,P),(!Ht||Zt&512)&&F!==(F=Lt[9].values[1].formattedValue+"")&&zt(q,F),(!Ht||Zt&512)&&se!==(se=Lt[9].values[2].formattedValue+"")&&zt(ie,se);const vi={};Zt&1024&&(vi.scenario=Lt[10]),re.$set(vi),(!Ht||Zt&1024)&&$e!==($e=Lt[10].values[0].formattedValue+"")&&zt(Je,$e),(!Ht||Zt&1024)&&Pe!==(Pe=Lt[10].values[1].formattedValue+"")&&zt(Ge,Pe),(!Ht||Zt&1024)&&Rt!==(Rt=Lt[10].values[2].formattedValue+"")&&zt(mt,Rt),Lt[8].length?Yt?(Yt.p(Lt,Zt),Zt&256&&Le(Yt,1)):(Yt=$g(Lt),Yt.c(),Le(Yt,1),Yt.m($t.parentNode,$t)):Yt&&(br(),Xe(Yt,1,1,()=>{Yt=null}),wr());const vn={};Zt&1048578&&(vn.$$scope={dirty:Zt,ctx:Lt}),_t.$set(vn)},i(Lt){Ht||(Le(M.$$.fragment,Lt),Le(re.$$.fragment,Lt),Le(Yt),Le(_t.$$.fragment,Lt),Ht=!0)},o(Lt){Xe(M.$$.fragment,Lt),Xe(re.$$.fragment,Lt),Xe(Yt),Xe(_t.$$.fragment,Lt),Ht=!1},d(Lt){Lt&&W(o),Lt&&W(g),Lt&&W(y),Kt.d(),Lt&&W(n),Lt&&W(w),dt(M),dt(re),Lt&&W(At),Yt&&Yt.d(Lt),Lt&&W($t),dt(_t,Lt)}}}function L5(h,o,l){let u,d,g,y,n,w,T,M,I,P,{indicator:z}=o,{threshold:R}=o,{data:F}=o,{currentScenarios:q}=o,{model:ae}=o,{currentGeography:se}=o,{currentIndicatorOptions:ie}=o;return h.$$set=Q=>{"indicator"in Q&&l(0,z=Q.indicator),"threshold"in Q&&l(12,R=Q.threshold),"data"in Q&&l(13,F=Q.data),"currentScenarios"in Q&&l(14,q=Q.currentScenarios),"model"in Q&&l(1,ae=Q.model),"currentGeography"in Q&&l(2,se=Q.currentGeography),"currentIndicatorOptions"in Q&&l(3,ie=Q.currentIndicatorOptions)},h.$$.update=()=>{h.$$.dirty&24576&&l(16,u=F.filter(Q=>q[Q.uid])),h.$$.dirty&8192&&l(11,d=F.find(Q=>Q.uid===Ou)),h.$$.dirty&8192&&l(10,g=F.find(Q=>Q.uid===Y_)),h.$$.dirty&8192&&l(9,y=F.find(Q=>Q.uid===K_)),h.$$.dirty&65536&&l(8,n=u.filter(Q=>![Y_,K_].includes(Q.uid))),h.$$.dirty&1&&l(7,w=z.uid===Vx),h.$$.dirty&8&&l(6,T=ie.reference.value===Nx),h.$$.dirty&1&&l(15,M=z.uid===jx),h.$$.dirty&32768&&l(5,I=M?"hot":"cold"),h.$$.dirty&4097&&l(4,P=Hr(R,z.unit.uid))},[z,ae,se,ie,P,I,T,w,n,y,g,d,R,F,q,M,u]}class R5 extends Jt{constructor(o){super(),Qt(this,o,L5,D5,ei,{indicator:0,threshold:12,data:13,currentScenarios:14,model:1,currentGeography:2,currentIndicatorOptions:3})}}function Xg(h){let o,l,u,d;function g(n){h[11](n)}let y={label:"Threshold",options:h[13].thresholds};return h[0]!==void 0&&(y.value=h[0]),l=new d1({props:y}),cr.push(()=>zn(l,"value",g)),{c(){o=He("div"),ht(l.$$.fragment),this.h()},l(n){o=Ye(n,"DIV",{class:!0});var w=Ce(o);pt(l.$$.fragment,w),w.forEach(W),this.h()},h(){H(o,"class","chart-options svelte-3koh4r")},m(n,w){Me(n,o,w),ft(l,o,null),d=!0},p(n,w){const T={};w&8192&&(T.options=n[13].thresholds),!u&&w&1&&(u=!0,T.value=n[0],Cn(()=>u=!1)),l.$set(T)},i(n){d||(Le(l.$$.fragment,n),d=!0)},o(n){Xe(l.$$.fragment,n),d=!1},d(n){n&&W(o),dt(l)}}}function B5(h){let o,l,u,d,g,y,n,w,T;const M=[h[12],h[13],{threshold:h[0]}];let I={};for(let F=0;F<M.length;F+=1)I=Fi(I,M[F]);u=new R5({props:I});let P=h[13].thresholds.length>1&&Xg(h);const z=[{isLoading:h[14]},h[12],h[13],{unit:"percent"}];let R={};for(let F=0;F<z.length;F+=1)R=Fi(R,z[F]);return w=new I5({props:R}),{c(){o=He("div"),l=He("div"),ht(u.$$.fragment),d=bt(),g=He("div"),P&&P.c(),y=bt(),n=He("div"),ht(w.$$.fragment),this.h()},l(F){o=Ye(F,"DIV",{class:!0});var q=Ce(o);l=Ye(q,"DIV",{class:!0});var ae=Ce(l);pt(u.$$.fragment,ae),ae.forEach(W),d=wt(q),g=Ye(q,"DIV",{class:!0});var se=Ce(g);P&&P.l(se),y=wt(se),n=Ye(se,"DIV",{class:!0});var ie=Ce(n);pt(w.$$.fragment,ie),ie.forEach(W),se.forEach(W),q.forEach(W),this.h()},h(){H(l,"class","chart-info svelte-3koh4r"),H(n,"class","chart svelte-3koh4r"),H(g,"class","chart-container svelte-3koh4r"),H(o,"class","wrapper grid")},m(F,q){Me(F,o,q),de(o,l),ft(u,l,null),de(o,d),de(o,g),P&&P.m(g,null),de(g,y),de(g,n),ft(w,n,null),T=!0},p(F,q){const ae=q&12289?yn(M,[q&4096&&Na(F[12]),q&8192&&Na(F[13]),q&1&&{threshold:F[0]}]):{};u.$set(ae),F[13].thresholds.length>1?P?(P.p(F,q),q&8192&&Le(P,1)):(P=Xg(F),P.c(),Le(P,1),P.m(g,y)):P&&(br(),Xe(P,1,1,()=>{P=null}),wr());const se=q&28672?yn(z,[q&16384&&{isLoading:F[14]},q&4096&&Na(F[12]),q&8192&&Na(F[13]),z[3]]):{};w.$set(se)},i(F){T||(Le(u.$$.fragment,F),Le(P),Le(w.$$.fragment,F),T=!0)},o(F){Xe(u.$$.fragment,F),Xe(P),Xe(w.$$.fragment,F),T=!1},d(F){F&&W(o),dt(u),P&&P.d(),dt(w)}}}function O5(h){let o,l;return o=new Xp({props:{process:h[3],asyncProps:h[4],props:{scenarios:h[5],currentScenarios:h[6],indicator:h[1],currentGeography:h[2],currentIndicatorOptions:h[7]},$$slots:{default:[B5,({props:u,asyncProps:d,isLoading:g})=>({12:u,13:d,14:g}),({props:u,asyncProps:d,isLoading:g})=>(u?4096:0)|(d?8192:0)|(g?16384:0)]},$$scope:{ctx:h}}}),{c(){ht(o.$$.fragment)},l(u){pt(o.$$.fragment,u)},m(u,d){ft(o,u,d),l=!0},p(u,[d]){const g={};d&8&&(g.process=u[3]),d&16&&(g.asyncProps=u[4]),d&230&&(g.props={scenarios:u[5],currentScenarios:u[6],indicator:u[1],currentGeography:u[2],currentIndicatorOptions:u[7]}),d&61441&&(g.$$scope={dirty:d,ctx:u}),o.$set(g)},i(u){l||(Le(o.$$.fragment,u),l=!0)},o(u){Xe(o.$$.fragment,u),l=!1},d(u){dt(o,u)}}}function F5(h,o,l){let u,d,g,y,n,w,T,M,I;xt(h,Gx,F=>l(9,d=F)),xt(h,Ru,F=>l(10,g=F)),xt(h,$a,F=>l(1,y=F)),xt(h,ac,F=>l(2,n=F)),xt(h,qx,F=>l(5,T=F)),xt(h,ly,F=>l(6,M=F)),xt(h,p1,F=>l(7,I=F));let P,z=kn({});xt(h,z,F=>l(4,w=F));function R(F){P=F,l(0,P),l(9,d)}return h.$$.update=()=>{h.$$.dirty&1030&&Fu(z,{endpoint:Zx,params:Xi({geography:n.uid,indicator:y.uid},g)}),h.$$.dirty&513&&l(3,u=({data:F},{scenarios:q,currentScenarios:ae})=>{const se=F.thresholds.map(Ae=>({label:Hr(Ae,d),value:Ae}));l(0,P=P||se[0].value);const ie=F.thresholds.indexOf(P);let Q=F.data.map(Ae=>{const $e=Object.keys(Ae)[0],Je=ae[$e]||q[$e],ze=F.years.map((Pe,Ge)=>{const Qe=Ae[$e][ie][Ge];return{year:Pe,value:Qe,formattedValue:Hr(Qe,"percent")}});return Ur(Xi({},Je),{values:ze})});Q=w3(f1(Q,"color"));const re=F.years.map((Ae,$e)=>{const Je=p3(Q,ze=>ze.values[$e].value);return{year:Ae,value:Je,formattedValue:Hr(Je,"percent")}});return re.unshift({year:"Today's risk",value:F.today[ie],formattedValue:Hr(F.today[ie],"percent")}),Q.unshift({uid:Ou,label:"Unavoidable",values:re}),Ur(Xi({},F),{thresholds:se,data:Q})})},[P,y,n,u,w,T,M,I,z,d,g,R]}class U5 extends Jt{constructor(o){super(),Qt(this,o,F5,O5,ei,{})}}function Hg(h){let o,l,u;return l=new U5({}),{c(){o=He("div"),ht(l.$$.fragment),this.h()},l(d){o=Ye(d,"DIV",{class:!0});var g=Ce(o);pt(l.$$.fragment,g),g.forEach(W),this.h()},h(){H(o,"class","wrapper vertical-space")},m(d,g){Me(d,o,g),ft(l,o,null),u=!0},i(d){u||(Le(l.$$.fragment,d),u=!0)},o(d){Xe(l.$$.fragment,d),u=!1},d(d){d&&W(o),dt(l)}}}function V5(h){let o,l,u=h[0]&&Hg();return{c(){u&&u.c(),o=Gi()},l(d){u&&u.l(d),o=Gi()},m(d,g){u&&u.m(d,g),Me(d,o,g),l=!0},p(d,[g]){d[0]?u?g&1&&Le(u,1):(u=Hg(),u.c(),Le(u,1),u.m(o.parentNode,o)):u&&(br(),Xe(u,1,1,()=>{u=null}),wr())},i(d){l||(Le(u),l=!0)},o(d){Xe(u),l=!1},d(d){u&&u.d(d),d&&W(o)}}}function N5(h,o,l){let u;return xt(h,ay,d=>l(0,u=d)),[u]}class j5 extends Jt{constructor(o){super(),Qt(this,o,N5,V5,ei,{})}}function G5(h){let o,l,u,d,g,y,n;return{c(){o=He("span"),l=Oe("This is Mitigation Benefits for "),u=Oe(h[0]),d=Oe(" in "),g=Oe(h[1]),y=Oe(" for "),n=Oe(h[2])},l(w){o=Ye(w,"SPAN",{});var T=Ce(o);l=Fe(T,"This is Mitigation Benefits for "),u=Fe(T,h[0]),d=Fe(T," in "),g=Fe(T,h[1]),y=Fe(T," for "),n=Fe(T,h[2]),T.forEach(W)},m(w,T){Me(w,o,T),de(o,l),de(o,u),de(o,d),de(o,g),de(o,y),de(o,n)},p(w,[T]){T&1&&zt(u,w[0]),T&2&&zt(g,w[1]),T&4&&zt(n,w[2])},i:ti,o:ti,d(w){w&&W(o)}}}function q5(h,o,l){let u,d,g;return xt(h,$a,y=>l(0,u=y)),xt(h,ac,y=>l(1,d=y)),xt(h,Wa,y=>l(2,g=y)),[u,d,g]}class Z5 extends Jt{constructor(o){super(),Qt(this,o,q5,G5,ei,{})}}function $5(h){let o,l,u,d,g,y,n;return{c(){o=He("span"),l=Oe("This is Reversibility for "),u=Oe(h[0]),d=Oe(" in "),g=Oe(h[1]),y=Oe(" for "),n=Oe(h[2])},l(w){o=Ye(w,"SPAN",{});var T=Ce(o);l=Fe(T,"This is Reversibility for "),u=Fe(T,h[0]),d=Fe(T," in "),g=Fe(T,h[1]),y=Fe(T," for "),n=Fe(T,h[2]),T.forEach(W)},m(w,T){Me(w,o,T),de(o,l),de(o,u),de(o,d),de(o,g),de(o,y),de(o,n)},p(w,[T]){T&1&&zt(u,w[0]),T&2&&zt(g,w[1]),T&4&&zt(n,w[2])},i:ti,o:ti,d(w){w&&W(o)}}}function W5(h,o,l){let u,d,g;return xt(h,$a,y=>l(0,u=y)),xt(h,ac,y=>l(1,d=y)),xt(h,Wa,y=>l(2,g=y)),[u,d,g]}class X5 extends Jt{constructor(o){super(),Qt(this,o,W5,$5,ei,{})}}function Yg(h,o,l){const u=h.slice();return u[23]=o[l],u}const H5=h=>({item:h&16}),Kg=h=>({item:h[23].data});function Y5(h){let o;return{c(){o=Oe("Missing template")},l(l){o=Fe(l,"Missing template")},m(l,u){Me(l,o,u)},d(l){l&&W(o)}}}function Jg(h,o){let l,u,d;const g=o[14].default,y=co(g,o,o[13],Kg),n=y||Y5();return{key:h,first:null,c(){l=He("svelte-virtual-list-row"),n&&n.c(),u=bt(),this.h()},l(w){l=Ye(w,"SVELTE-VIRTUAL-LIST-ROW",{class:!0});var T=Ce(l);n&&n.l(T),u=wt(T),T.forEach(W),this.h()},h(){Id(l,"class","svelte-1tqh76q"),this.first=l},m(w,T){Me(w,l,T),n&&n.m(l,null),de(l,u),d=!0},p(w,T){o=w,y&&y.p&&(!d||T&8208)&&uo(y,g,o,o[13],d?po(g,o[13],T,H5):ho(o[13]),Kg)},i(w){d||(Le(n,w),d=!0)},o(w){Xe(n,w),d=!1},d(w){w&&W(l),n&&n.d(w)}}}function K5(h){let o,l,u=[],d=new Map,g,y,n,w,T=h[4];const M=I=>I[23].index;for(let I=0;I<T.length;I+=1){let P=Yg(h,T,I),z=M(P);d.set(z,u[I]=Jg(z,P))}return{c(){o=He("svelte-virtual-list-viewport"),l=He("svelte-virtual-list-contents");for(let I=0;I<u.length;I+=1)u[I].c();this.h()},l(I){o=Ye(I,"SVELTE-VIRTUAL-LIST-VIEWPORT",{style:!0,class:!0});var P=Ce(o);l=Ye(P,"SVELTE-VIRTUAL-LIST-CONTENTS",{style:!0,class:!0});var z=Ce(l);for(let R=0;R<u.length;R+=1)u[R].l(z);z.forEach(W),P.forEach(W),this.h()},h(){lr(l,"padding-top",h[5]+"px"),lr(l,"padding-bottom",h[6]+"px"),Id(l,"class","svelte-1tqh76q"),lr(o,"height",h[0]),Id(o,"class","svelte-1tqh76q"),$p(()=>h[17].call(o))},m(I,P){Me(I,o,P),de(o,l);for(let z=0;z<u.length;z+=1)u[z].m(l,null);h[15](l),h[16](o),g=h1(o,h[17].bind(o)),y=!0,n||(w=Oi(o,"scroll",h[7]),n=!0)},p(I,[P]){P&8208&&(T=I[4],br(),u=kx(u,P,M,1,I,T,d,l,Cx,Jg,null,Yg),wr()),(!y||P&32)&&lr(l,"padding-top",I[5]+"px"),(!y||P&64)&&lr(l,"padding-bottom",I[6]+"px"),(!y||P&1)&&lr(o,"height",I[0])},i(I){if(!y){for(let P=0;P<T.length;P+=1)Le(u[P]);y=!0}},o(I){for(let P=0;P<u.length;P+=1)Xe(u[P]);y=!1},d(I){I&&W(o);for(let P=0;P<u.length;P+=1)u[P].d();h[15](null),h[16](null),g(),n=!1,w()}}}function J5(h,o,l){let{$$slots:u={},$$scope:d}=o,{items:g}=o,{height:y="100%"}=o,{itemHeight:n=void 0}=o,{start:w=0}=o,{end:T=0}=o,M=[],I,P,z,R=0,F,q,ae=0,se=0,ie;async function Q(ze,Pe,Ge){const{scrollTop:Qe}=P;await Ip();let Rt=ae-Qe,mt=w;for(;Rt<Pe&&mt<ze.length;){let At=I[mt-w];At||(l(9,T=mt+1),await Ip(),At=I[mt-w]),Rt+=M[mt]=Ge||At.offsetHeight,mt+=1}l(9,T=mt);const Ne=ze.length-T;ie=(ae+Rt)/T,l(6,se=Ne*ie),M.length=ze.length}async function re(){const{scrollTop:ze}=P,Pe=w;for(let mt=0;mt<I.length;mt+=1)M[w+mt]=n||I[mt].offsetHeight;let Ge=0,Qe=0;for(;Ge<g.length;){const mt=M[Ge]||ie;if(Qe+mt>ze){l(8,w=Ge),l(5,ae=Qe);break}Qe+=mt,Ge+=1}for(;Ge<g.length&&(Qe+=M[Ge]||ie,Ge+=1,!(Qe>ze+R)););l(9,T=Ge);const Rt=g.length-T;for(ie=Qe/T;Ge<g.length;)M[Ge++]=ie;if(l(6,se=Rt*ie),w<Pe){await Ip();let mt=0,Ne=0;for(let $t=w;$t<Pe;$t+=1)I[$t-w]&&(mt+=M[$t],Ne+=n||I[$t-w].offsetHeight);const At=Ne-mt;P.scrollTo(0,ze+At)}}Zp(()=>{I=z.getElementsByTagName("svelte-virtual-list-row"),l(12,q=!0)});function Ae(ze){cr[ze?"unshift":"push"](()=>{z=ze,l(3,z)})}function $e(ze){cr[ze?"unshift":"push"](()=>{P=ze,l(2,P)})}function Je(){R=this.offsetHeight,l(1,R)}return h.$$set=ze=>{"items"in ze&&l(10,g=ze.items),"height"in ze&&l(0,y=ze.height),"itemHeight"in ze&&l(11,n=ze.itemHeight),"start"in ze&&l(8,w=ze.start),"end"in ze&&l(9,T=ze.end),"$$scope"in ze&&l(13,d=ze.$$scope)},h.$$.update=()=>{h.$$.dirty&1792&&l(4,F=g.slice(w,T).map((ze,Pe)=>({index:Pe+w,data:ze}))),h.$$.dirty&7170&&q&&Q(g,R,n)},[y,R,P,z,F,ae,se,re,w,T,g,n,q,d,u,Ae,$e,Je]}class Q5 extends Jt{constructor(o){super(),Qt(this,o,J5,K5,ei,{items:10,height:0,itemHeight:11,start:8,end:9})}}function ns(h){return Array.isArray?Array.isArray(h):Ty(h)==="[object Array]"}const e4=1/0;function t4(h){if(typeof h=="string")return h;let o=h+"";return o=="0"&&1/h==-e4?"-0":o}function i4(h){return h==null?"":t4(h)}function Po(h){return typeof h=="string"}function wy(h){return typeof h=="number"}function r4(h){return h===!0||h===!1||n4(h)&&Ty(h)=="[object Boolean]"}function Ey(h){return typeof h=="object"}function n4(h){return Ey(h)&&h!==null}function In(h){return h!=null}function Ed(h){return!h.trim().length}function Ty(h){return h==null?h===void 0?"[object Undefined]":"[object Null]":Object.prototype.toString.call(h)}const o4="Incorrect 'index' type",s4=h=>`Invalid value for key ${h}`,a4=h=>`Pattern length exceeds max of ${h}.`,l4=h=>`Missing ${h} property in key`,c4=h=>`Property 'weight' in key '${h}' must be a positive integer`,Qg=Object.prototype.hasOwnProperty;class u4{constructor(o){this._keys=[],this._keyMap={};let l=0;o.forEach(u=>{let d=Ay(u);l+=d.weight,this._keys.push(d),this._keyMap[d.id]=d,l+=d.weight}),this._keys.forEach(u=>{u.weight/=l})}get(o){return this._keyMap[o]}keys(){return this._keys}toJSON(){return JSON.stringify(this._keys)}}function Ay(h){let o=null,l=null,u=null,d=1,g=null;if(Po(h)||ns(h))u=h,o=e0(h),l=jd(h);else{if(!Qg.call(h,"name"))throw new Error(l4("name"));const y=h.name;if(u=y,Qg.call(h,"weight")&&(d=h.weight,d<=0))throw new Error(c4(y));o=e0(y),l=jd(y),g=h.getFn}return{path:o,id:l,weight:d,src:u,getFn:g}}function e0(h){return ns(h)?h:h.split(".")}function jd(h){return ns(h)?h.join("."):h}function h4(h,o){let l=[],u=!1;const d=(g,y,n)=>{if(!!In(g))if(!y[n])l.push(g);else{let w=y[n];const T=g[w];if(!In(T))return;if(n===y.length-1&&(Po(T)||wy(T)||r4(T)))l.push(i4(T));else if(ns(T)){u=!0;for(let M=0,I=T.length;M<I;M+=1)d(T[M],y,n+1)}else y.length&&d(T,y,n+1)}};return d(h,Po(o)?o.split("."):o,0),u?l:l[0]}const p4={includeMatches:!1,findAllMatches:!1,minMatchCharLength:1},f4={isCaseSensitive:!1,includeScore:!1,keys:[],shouldSort:!0,sortFn:(h,o)=>h.score===o.score?h.idx<o.idx?-1:1:h.score<o.score?-1:1},d4={location:0,threshold:.6,distance:100},m4={useExtendedSearch:!1,getFn:h4,ignoreLocation:!1,ignoreFieldNorm:!1,fieldNormWeight:1};var ui=Xi(Xi(Xi(Xi({},f4),p4),d4),m4);const _4=/[^ ]+/g;function g4(h=1,o=3){const l=new Map,u=Math.pow(10,o);return{get(d){const g=d.match(_4).length;if(l.has(g))return l.get(g);const y=1/Math.pow(g,.5*h),n=parseFloat(Math.round(y*u)/u);return l.set(g,n),n},clear(){l.clear()}}}class y1{constructor({getFn:o=ui.getFn,fieldNormWeight:l=ui.fieldNormWeight}={}){this.norm=g4(l,3),this.getFn=o,this.isCreated=!1,this.setIndexRecords()}setSources(o=[]){this.docs=o}setIndexRecords(o=[]){this.records=o}setKeys(o=[]){this.keys=o,this._keysMap={},o.forEach((l,u)=>{this._keysMap[l.id]=u})}create(){this.isCreated||!this.docs.length||(this.isCreated=!0,Po(this.docs[0])?this.docs.forEach((o,l)=>{this._addString(o,l)}):this.docs.forEach((o,l)=>{this._addObject(o,l)}),this.norm.clear())}add(o){const l=this.size();Po(o)?this._addString(o,l):this._addObject(o,l)}removeAt(o){this.records.splice(o,1);for(let l=o,u=this.size();l<u;l+=1)this.records[l].i-=1}getValueForItemAtKeyId(o,l){return o[this._keysMap[l]]}size(){return this.records.length}_addString(o,l){if(!In(o)||Ed(o))return;let u={v:o,i:l,n:this.norm.get(o)};this.records.push(u)}_addObject(o,l){let u={i:l,$:{}};this.keys.forEach((d,g)=>{let y=d.getFn?d.getFn(o):this.getFn(o,d.path);if(!!In(y)){if(ns(y)){let n=[];const w=[{nestedArrIndex:-1,value:y}];for(;w.length;){const{nestedArrIndex:T,value:M}=w.pop();if(!!In(M))if(Po(M)&&!Ed(M)){let I={v:M,i:T,n:this.norm.get(M)};n.push(I)}else ns(M)&&M.forEach((I,P)=>{w.push({nestedArrIndex:P,value:I})})}u.$[g]=n}else if(Po(y)&&!Ed(y)){let n={v:y,n:this.norm.get(y)};u.$[g]=n}}}),this.records.push(u)}toJSON(){return{keys:this.keys,records:this.records}}}function Sy(h,o,{getFn:l=ui.getFn,fieldNormWeight:u=ui.fieldNormWeight}={}){const d=new y1({getFn:l,fieldNormWeight:u});return d.setKeys(h.map(Ay)),d.setSources(o),d.create(),d}function y4(h,{getFn:o=ui.getFn,fieldNormWeight:l=ui.fieldNormWeight}={}){const{keys:u,records:d}=h,g=new y1({getFn:o,fieldNormWeight:l});return g.setKeys(u),g.setIndexRecords(d),g}function Ep(h,{errors:o=0,currentLocation:l=0,expectedLocation:u=0,distance:d=ui.distance,ignoreLocation:g=ui.ignoreLocation}={}){const y=o/h.length;if(g)return y;const n=Math.abs(u-l);return d?y+n/d:n?1:y}function v4(h=[],o=ui.minMatchCharLength){let l=[],u=-1,d=-1,g=0;for(let y=h.length;g<y;g+=1){let n=h[g];n&&u===-1?u=g:!n&&u!==-1&&(d=g-1,d-u+1>=o&&l.push([u,d]),u=-1)}return h[g-1]&&g-u>=o&&l.push([u,g-1]),l}const Va=32;function x4(h,o,l,{location:u=ui.location,distance:d=ui.distance,threshold:g=ui.threshold,findAllMatches:y=ui.findAllMatches,minMatchCharLength:n=ui.minMatchCharLength,includeMatches:w=ui.includeMatches,ignoreLocation:T=ui.ignoreLocation}={}){if(o.length>Va)throw new Error(a4(Va));const M=o.length,I=h.length,P=Math.max(0,Math.min(u,I));let z=g,R=P;const F=n>1||w,q=F?Array(I):[];let ae;for(;(ae=h.indexOf(o,R))>-1;){let $e=Ep(o,{currentLocation:ae,expectedLocation:P,distance:d,ignoreLocation:T});if(z=Math.min($e,z),R=ae+M,F){let Je=0;for(;Je<M;)q[ae+Je]=1,Je+=1}}R=-1;let se=[],ie=1,Q=M+I;const re=1<<M-1;for(let $e=0;$e<M;$e+=1){let Je=0,ze=Q;for(;Je<ze;)Ep(o,{errors:$e,currentLocation:P+ze,expectedLocation:P,distance:d,ignoreLocation:T})<=z?Je=ze:Q=ze,ze=Math.floor((Q-Je)/2+Je);Q=ze;let Pe=Math.max(1,P-ze+1),Ge=y?I:Math.min(P+ze,I)+M,Qe=Array(Ge+2);Qe[Ge+1]=(1<<$e)-1;for(let mt=Ge;mt>=Pe;mt-=1){let Ne=mt-1,At=l[h.charAt(Ne)];if(F&&(q[Ne]=+!!At),Qe[mt]=(Qe[mt+1]<<1|1)&At,$e&&(Qe[mt]|=(se[mt+1]|se[mt])<<1|1|se[mt+1]),Qe[mt]&re&&(ie=Ep(o,{errors:$e,currentLocation:Ne,expectedLocation:P,distance:d,ignoreLocation:T}),ie<=z)){if(z=ie,R=Ne,R<=P)break;Pe=Math.max(1,2*P-R)}}if(Ep(o,{errors:$e+1,currentLocation:P,expectedLocation:P,distance:d,ignoreLocation:T})>z)break;se=Qe}const Ae={isMatch:R>=0,score:Math.max(.001,ie)};if(F){const $e=v4(q,n);$e.length?w&&(Ae.indices=$e):Ae.isMatch=!1}return Ae}function b4(h){let o={};for(let l=0,u=h.length;l<u;l+=1){const d=h.charAt(l);o[d]=(o[d]||0)|1<<u-l-1}return o}class My{constructor(o,{location:l=ui.location,threshold:u=ui.threshold,distance:d=ui.distance,includeMatches:g=ui.includeMatches,findAllMatches:y=ui.findAllMatches,minMatchCharLength:n=ui.minMatchCharLength,isCaseSensitive:w=ui.isCaseSensitive,ignoreLocation:T=ui.ignoreLocation}={}){if(this.options={location:l,threshold:u,distance:d,includeMatches:g,findAllMatches:y,minMatchCharLength:n,isCaseSensitive:w,ignoreLocation:T},this.pattern=w?o:o.toLowerCase(),this.chunks=[],!this.pattern.length)return;const M=(P,z)=>{this.chunks.push({pattern:P,alphabet:b4(P),startIndex:z})},I=this.pattern.length;if(I>Va){let P=0;const z=I%Va,R=I-z;for(;P<R;)M(this.pattern.substr(P,Va),P),P+=Va;if(z){const F=I-Va;M(this.pattern.substr(F),F)}}else M(this.pattern,0)}searchIn(o){const{isCaseSensitive:l,includeMatches:u}=this.options;if(l||(o=o.toLowerCase()),this.pattern===o){let R={isMatch:!0,score:0};return u&&(R.indices=[[0,o.length-1]]),R}const{location:d,distance:g,threshold:y,findAllMatches:n,minMatchCharLength:w,ignoreLocation:T}=this.options;let M=[],I=0,P=!1;this.chunks.forEach(({pattern:R,alphabet:F,startIndex:q})=>{const{isMatch:ae,score:se,indices:ie}=x4(o,R,F,{location:d+q,distance:g,threshold:y,findAllMatches:n,minMatchCharLength:w,includeMatches:u,ignoreLocation:T});ae&&(P=!0),I+=se,ae&&ie&&(M=[...M,...ie])});let z={isMatch:P,score:P?I/this.chunks.length:1};return P&&u&&(z.indices=M),z}}class Ws{constructor(o){this.pattern=o}static isMultiMatch(o){return t0(o,this.multiRegex)}static isSingleMatch(o){return t0(o,this.singleRegex)}search(){}}function t0(h,o){const l=h.match(o);return l?l[1]:null}class w4 extends Ws{constructor(o){super(o)}static get type(){return"exact"}static get multiRegex(){return/^="(.*)"$/}static get singleRegex(){return/^=(.*)$/}search(o){const l=o===this.pattern;return{isMatch:l,score:l?0:1,indices:[0,this.pattern.length-1]}}}class E4 extends Ws{constructor(o){super(o)}static get type(){return"inverse-exact"}static get multiRegex(){return/^!"(.*)"$/}static get singleRegex(){return/^!(.*)$/}search(o){const u=o.indexOf(this.pattern)===-1;return{isMatch:u,score:u?0:1,indices:[0,o.length-1]}}}class T4 extends Ws{constructor(o){super(o)}static get type(){return"prefix-exact"}static get multiRegex(){return/^\^"(.*)"$/}static get singleRegex(){return/^\^(.*)$/}search(o){const l=o.startsWith(this.pattern);return{isMatch:l,score:l?0:1,indices:[0,this.pattern.length-1]}}}class A4 extends Ws{constructor(o){super(o)}static get type(){return"inverse-prefix-exact"}static get multiRegex(){return/^!\^"(.*)"$/}static get singleRegex(){return/^!\^(.*)$/}search(o){const l=!o.startsWith(this.pattern);return{isMatch:l,score:l?0:1,indices:[0,o.length-1]}}}class S4 extends Ws{constructor(o){super(o)}static get type(){return"suffix-exact"}static get multiRegex(){return/^"(.*)"\$$/}static get singleRegex(){return/^(.*)\$$/}search(o){const l=o.endsWith(this.pattern);return{isMatch:l,score:l?0:1,indices:[o.length-this.pattern.length,o.length-1]}}}class M4 extends Ws{constructor(o){super(o)}static get type(){return"inverse-suffix-exact"}static get multiRegex(){return/^!"(.*)"\$$/}static get singleRegex(){return/^!(.*)\$$/}search(o){const l=!o.endsWith(this.pattern);return{isMatch:l,score:l?0:1,indices:[0,o.length-1]}}}class Iy extends Ws{constructor(o,{location:l=ui.location,threshold:u=ui.threshold,distance:d=ui.distance,includeMatches:g=ui.includeMatches,findAllMatches:y=ui.findAllMatches,minMatchCharLength:n=ui.minMatchCharLength,isCaseSensitive:w=ui.isCaseSensitive,ignoreLocation:T=ui.ignoreLocation}={}){super(o),this._bitapSearch=new My(o,{location:l,threshold:u,distance:d,includeMatches:g,findAllMatches:y,minMatchCharLength:n,isCaseSensitive:w,ignoreLocation:T})}static get type(){return"fuzzy"}static get multiRegex(){return/^"(.*)"$/}static get singleRegex(){return/^(.*)$/}search(o){return this._bitapSearch.searchIn(o)}}class ky extends Ws{constructor(o){super(o)}static get type(){return"include"}static get multiRegex(){return/^'"(.*)"$/}static get singleRegex(){return/^'(.*)$/}search(o){let l=0,u;const d=[],g=this.pattern.length;for(;(u=o.indexOf(this.pattern,l))>-1;)l=u+g,d.push([u,l-1]);const y=!!d.length;return{isMatch:y,score:y?0:1,indices:d}}}const Gd=[w4,ky,T4,A4,M4,S4,E4,Iy],i0=Gd.length,I4=/ +(?=(?:[^\"]*\"[^\"]*\")*[^\"]*$)/,k4="|";function C4(h,o={}){return h.split(k4).map(l=>{let u=l.trim().split(I4).filter(g=>g&&!!g.trim()),d=[];for(let g=0,y=u.length;g<y;g+=1){const n=u[g];let w=!1,T=-1;for(;!w&&++T<i0;){const M=Gd[T];let I=M.isMultiMatch(n);I&&(d.push(new M(I,o)),w=!0)}if(!w)for(T=-1;++T<i0;){const M=Gd[T];let I=M.isSingleMatch(n);if(I){d.push(new M(I,o));break}}}return d})}const z4=new Set([Iy.type,ky.type]);class P4{constructor(o,{isCaseSensitive:l=ui.isCaseSensitive,includeMatches:u=ui.includeMatches,minMatchCharLength:d=ui.minMatchCharLength,ignoreLocation:g=ui.ignoreLocation,findAllMatches:y=ui.findAllMatches,location:n=ui.location,threshold:w=ui.threshold,distance:T=ui.distance}={}){this.query=null,this.options={isCaseSensitive:l,includeMatches:u,minMatchCharLength:d,findAllMatches:y,ignoreLocation:g,location:n,threshold:w,distance:T},this.pattern=l?o:o.toLowerCase(),this.query=C4(this.pattern,this.options)}static condition(o,l){return l.useExtendedSearch}searchIn(o){const l=this.query;if(!l)return{isMatch:!1,score:1};const{includeMatches:u,isCaseSensitive:d}=this.options;o=d?o:o.toLowerCase();let g=0,y=[],n=0;for(let w=0,T=l.length;w<T;w+=1){const M=l[w];y.length=0,g=0;for(let I=0,P=M.length;I<P;I+=1){const z=M[I],{isMatch:R,indices:F,score:q}=z.search(o);if(R){if(g+=1,n+=q,u){const ae=z.constructor.type;z4.has(ae)?y=[...y,...F]:y.push(F)}}else{n=0,g=0,y.length=0;break}}if(g){let I={isMatch:!0,score:n/g};return u&&(I.indices=y),I}}return{isMatch:!1,score:1}}}const qd=[];function D4(...h){qd.push(...h)}function Zd(h,o){for(let l=0,u=qd.length;l<u;l+=1){let d=qd[l];if(d.condition(h,o))return new d(h,o)}return new My(h,o)}const Lp={AND:"$and",OR:"$or"},$d={PATH:"$path",PATTERN:"$val"},Wd=h=>!!(h[Lp.AND]||h[Lp.OR]),L4=h=>!!h[$d.PATH],R4=h=>!ns(h)&&Ey(h)&&!Wd(h),r0=h=>({[Lp.AND]:Object.keys(h).map(o=>({[o]:h[o]}))});function Cy(h,o,{auto:l=!0}={}){const u=d=>{let g=Object.keys(d);const y=L4(d);if(!y&&g.length>1&&!Wd(d))return u(r0(d));if(R4(d)){const w=y?d[$d.PATH]:g[0],T=y?d[$d.PATTERN]:d[w];if(!Po(T))throw new Error(s4(w));const M={keyId:jd(w),pattern:T};return l&&(M.searcher=Zd(T,o)),M}let n={children:[],operator:g[0]};return g.forEach(w=>{const T=d[w];ns(T)&&T.forEach(M=>{n.children.push(u(M))})}),n};return Wd(h)||(h=r0(h)),u(h)}function B4(h,{ignoreFieldNorm:o=ui.ignoreFieldNorm}){h.forEach(l=>{let u=1;l.matches.forEach(({key:d,norm:g,score:y})=>{const n=d?d.weight:null;u*=Math.pow(y===0&&n?Number.EPSILON:y,(n||1)*(o?1:g))}),l.score=u})}function O4(h,o){const l=h.matches;o.matches=[],In(l)&&l.forEach(u=>{if(!In(u.indices)||!u.indices.length)return;const{indices:d,value:g}=u;let y={indices:d,value:g};u.key&&(y.key=u.key.src),u.idx>-1&&(y.refIndex=u.idx),o.matches.push(y)})}function F4(h,o){o.score=h.score}function U4(h,o,{includeMatches:l=ui.includeMatches,includeScore:u=ui.includeScore}={}){const d=[];return l&&d.push(O4),u&&d.push(F4),h.map(g=>{const{idx:y}=g,n={item:o[y],refIndex:y};return d.length&&d.forEach(w=>{w(g,n)}),n})}class lc{constructor(o,l={},u){this.options=Xi(Xi({},ui),l),this.options.useExtendedSearch,this._keyStore=new u4(this.options.keys),this.setCollection(o,u)}setCollection(o,l){if(this._docs=o,l&&!(l instanceof y1))throw new Error(o4);this._myIndex=l||Sy(this.options.keys,this._docs,{getFn:this.options.getFn,fieldNormWeight:this.options.fieldNormWeight})}add(o){!In(o)||(this._docs.push(o),this._myIndex.add(o))}remove(o=()=>!1){const l=[];for(let u=0,d=this._docs.length;u<d;u+=1){const g=this._docs[u];o(g,u)&&(this.removeAt(u),u-=1,d-=1,l.push(g))}return l}removeAt(o){this._docs.splice(o,1),this._myIndex.removeAt(o)}getIndex(){return this._myIndex}search(o,{limit:l=-1}={}){const{includeMatches:u,includeScore:d,shouldSort:g,sortFn:y,ignoreFieldNorm:n}=this.options;let w=Po(o)?Po(this._docs[0])?this._searchStringList(o):this._searchObjectList(o):this._searchLogical(o);return B4(w,{ignoreFieldNorm:n}),g&&w.sort(y),wy(l)&&l>-1&&(w=w.slice(0,l)),U4(w,this._docs,{includeMatches:u,includeScore:d})}_searchStringList(o){const l=Zd(o,this.options),{records:u}=this._myIndex,d=[];return u.forEach(({v:g,i:y,n})=>{if(!In(g))return;const{isMatch:w,score:T,indices:M}=l.searchIn(g);w&&d.push({item:g,idx:y,matches:[{score:T,value:g,norm:n,indices:M}]})}),d}_searchLogical(o){const l=Cy(o,this.options),u=(n,w,T)=>{if(!n.children){const{keyId:I,searcher:P}=n,z=this._findMatches({key:this._keyStore.get(I),value:this._myIndex.getValueForItemAtKeyId(w,I),searcher:P});return z&&z.length?[{idx:T,item:w,matches:z}]:[]}const M=[];for(let I=0,P=n.children.length;I<P;I+=1){const z=n.children[I],R=u(z,w,T);if(R.length)M.push(...R);else if(n.operator===Lp.AND)return[]}return M},d=this._myIndex.records,g={},y=[];return d.forEach(({$:n,i:w})=>{if(In(n)){let T=u(l,n,w);T.length&&(g[w]||(g[w]={idx:w,item:n,matches:[]},y.push(g[w])),T.forEach(({matches:M})=>{g[w].matches.push(...M)}))}}),y}_searchObjectList(o){const l=Zd(o,this.options),{keys:u,records:d}=this._myIndex,g=[];return d.forEach(({$:y,i:n})=>{if(!In(y))return;let w=[];u.forEach((T,M)=>{w.push(...this._findMatches({key:T,value:y[M],searcher:l}))}),w.length&&g.push({idx:n,item:y,matches:w})}),g}_findMatches({key:o,value:l,searcher:u}){if(!In(l))return[];let d=[];if(ns(l))l.forEach(({v:g,i:y,n})=>{if(!In(g))return;const{isMatch:w,score:T,indices:M}=u.searchIn(g);w&&d.push({score:T,key:o,value:g,idx:y,norm:n,indices:M})});else{const{v:g,n:y}=l,{isMatch:n,score:w,indices:T}=u.searchIn(g);n&&d.push({score:w,key:o,value:g,norm:y,indices:T})}return d}}lc.version="6.6.2";lc.createIndex=Sy;lc.parseIndex=y4;lc.config=ui;lc.parseQuery=Cy;D4(P4);function V4(h){let o,l,u,d,g,y;const n=h[7].default,w=co(n,h,h[6],null);let T=[{disabled:h[0]},h[3]],M={};for(let I=0;I<T.length;I+=1)M=Fi(M,T[I]);return{c(){o=He("fieldset"),l=He("legend"),u=Oe(h[1]),d=bt(),g=He("div"),w&&w.c(),this.h()},l(I){o=Ye(I,"FIELDSET",{});var P=Ce(o);l=Ye(P,"LEGEND",{class:!0});var z=Ce(l);u=Fe(z,h[1]),z.forEach(W),d=wt(P),g=Ye(P,"DIV",{class:!0});var R=Ce(g);w&&w.l(R),R.forEach(W),P.forEach(W),this.h()},h(){H(l,"class","svelte-1mwyuwh"),Dt(l,"text-label",!0),Dt(l,"text-label--bold",!0),H(g,"class","tile-group-content svelte-1mwyuwh"),Lr(o,M),Dt(o,"tile-group",!0),Dt(o,"svelte-1mwyuwh",!0)},m(I,P){Me(I,o,P),de(o,l),de(l,u),de(o,d),de(o,g),w&&w.m(g,null),y=!0},p(I,[P]){(!y||P&2)&&zt(u,I[1]),w&&w.p&&(!y||P&64)&&uo(w,n,I,I[6],y?po(n,I[6],P,null):ho(I[6]),null),Lr(o,M=yn(T,[(!y||P&1)&&{disabled:I[0]},P&8&&I[3]])),Dt(o,"tile-group",!0),Dt(o,"svelte-1mwyuwh",!0)},i(I){y||(Le(w,I),y=!0)},o(I){Xe(w,I),y=!1},d(I){I&&W(o),w&&w.d(I)}}}function N4(h,o,l){const u=["selected","disabled","legend"];let d=Rr(o,u),g,{$$slots:y={},$$scope:n}=o,{selected:w=void 0}=o,{disabled:T=!1}=o,{legend:M=""}=o;const I=sc(),P=kn(w);return xt(h,P,z=>l(5,g=z)),qp("TileGroup",{selectedValue:P,add:({checked:z,value:R})=>{z&&P.set(R)},update:z=>{P.set(z),I("select",z)}}),h.$$set=z=>{o=Fi(Fi({},o),os(z)),l(3,d=Rr(o,u)),"selected"in z&&l(4,w=z.selected),"disabled"in z&&l(0,T=z.disabled),"legend"in z&&l(1,M=z.legend),"$$scope"in z&&l(6,n=z.$$scope)},h.$$.update=()=>{h.$$.dirty&32&&l(4,w=g),h.$$.dirty&16&&P.set(w)},[T,M,P,d,w,g,n,y]}class j4 extends Jt{constructor(o){super(),Qt(this,o,N4,V4,ei,{selected:4,disabled:0,legend:1})}}function G4(h){let o,l,u,d,g,y,n,w;const T=h[13].default,M=co(T,h,h[12],null);let I=[{for:h[5]},h[9]],P={};for(let z=0;z<I.length;z+=1)P=Fi(P,I[z]);return{c(){o=He("input"),u=bt(),d=He("label"),g=He("span"),M&&M.c(),this.h()},l(z){o=Ye(z,"INPUT",{type:!0,id:!0,name:!0,tabindex:!0,class:!0}),u=wt(z),d=Ye(z,"LABEL",{for:!0});var R=Ce(d);g=Ye(R,"SPAN",{class:!0});var F=Ce(g);M&&M.l(F),F.forEach(W),R.forEach(W),this.h()},h(){H(o,"type","radio"),H(o,"id",h[5]),H(o,"name",h[6]),o.value=h[3],o.checked=h[0],H(o,"tabindex",l=h[2]?void 0:h[4]),o.disabled=h[2],H(o,"class","svelte-w2wf71"),Dt(o,"tile-input",!0),H(g,"class","svelte-w2wf71"),Dt(g,"tile-content",!0),Lr(d,P),Dt(d,"tile",!0),Dt(d,"tile--selectable",!0),Dt(d,"tile--is-selected",h[0]),Dt(d,"tile--light",h[1]),Dt(d,"tile--disabled",h[2]),Dt(d,"svelte-w2wf71",!0)},m(z,R){Me(z,o,R),Me(z,u,R),Me(z,d,R),de(d,g),M&&M.m(g,null),y=!0,n||(w=[Oi(o,"change",h[18]),Oi(o,"change",h[20]),Oi(o,"keydown",h[19]),Oi(o,"keydown",h[21]),Oi(d,"click",h[14]),Oi(d,"mouseover",h[15]),Oi(d,"mouseenter",h[16]),Oi(d,"mouseleave",h[17])],n=!0)},p(z,[R]){(!y||R&32)&&H(o,"id",z[5]),(!y||R&64)&&H(o,"name",z[6]),(!y||R&8)&&(o.value=z[3]),(!y||R&1)&&(o.checked=z[0]),(!y||R&20&&l!==(l=z[2]?void 0:z[4]))&&H(o,"tabindex",l),(!y||R&4)&&(o.disabled=z[2]),M&&M.p&&(!y||R&4096)&&uo(M,T,z,z[12],y?po(T,z[12],R,null):ho(z[12]),null),Lr(d,P=yn(I,[(!y||R&32)&&{for:z[5]},R&512&&z[9]])),Dt(d,"tile",!0),Dt(d,"tile--selectable",!0),Dt(d,"tile--is-selected",z[0]),Dt(d,"tile--light",z[1]),Dt(d,"tile--disabled",z[2]),Dt(d,"svelte-w2wf71",!0)},i(z){y||(Le(M,z),y=!0)},o(z){Xe(M,z),y=!1},d(z){z&&W(o),z&&W(u),z&&W(d),M&&M.d(z),n=!1,$s(w)}}}function q4(h,o,l){const u=["checked","light","disabled","value","tabindex","iconDescription","id","name"];let d=Rr(o,u),g,{$$slots:y={},$$scope:n}=o,{checked:w=!1}=o,{light:T=!1}=o,{disabled:M=!1}=o,{value:I=""}=o,{tabindex:P="0"}=o,{iconDescription:z="Tile checkmark"}=o,{id:R="ccs-"+Math.random().toString(36)}=o,{name:F=""}=o;const{add:q,update:ae,selectedValue:se}=kr("TileGroup");xt(h,se,Ge=>l(11,g=Ge)),q({value:I,checked:w});function ie(Ge){Vr.call(this,h,Ge)}function Q(Ge){Vr.call(this,h,Ge)}function re(Ge){Vr.call(this,h,Ge)}function Ae(Ge){Vr.call(this,h,Ge)}function $e(Ge){Vr.call(this,h,Ge)}function Je(Ge){Vr.call(this,h,Ge)}const ze=()=>{M||ae(I)},Pe=Ge=>{M||(Ge.key===" "||Ge.key==="Enter")&&(Ge.preventDefault(),ae(I))};return h.$$set=Ge=>{o=Fi(Fi({},o),os(Ge)),l(9,d=Rr(o,u)),"checked"in Ge&&l(0,w=Ge.checked),"light"in Ge&&l(1,T=Ge.light),"disabled"in Ge&&l(2,M=Ge.disabled),"value"in Ge&&l(3,I=Ge.value),"tabindex"in Ge&&l(4,P=Ge.tabindex),"iconDescription"in Ge&&l(10,z=Ge.iconDescription),"id"in Ge&&l(5,R=Ge.id),"name"in Ge&&l(6,F=Ge.name),"$$scope"in Ge&&l(12,n=Ge.$$scope)},h.$$.update=()=>{h.$$.dirty&2056&&l(0,w=I===g)},[w,T,M,I,P,R,F,ae,se,d,z,g,n,y,ie,Q,re,Ae,$e,Je,ze,Pe]}class Z4 extends Jt{constructor(o){super(),Qt(this,o,q4,G4,ei,{checked:0,light:1,disabled:2,value:3,tabindex:4,iconDescription:10,id:5,name:6})}}var er=1e-6,zy=1e-12,Pi=Math.PI,jn=Pi/2,n0=Pi/4,qn=Pi*2,rs=180/Pi,Mn=Pi/180,mr=Math.abs,$4=Math.atan,Nu=Math.atan2,fr=Math.cos,dr=Math.sin,W4=Math.sign||function(h){return h>0?1:h<0?-1:0},Xs=Math.sqrt;function X4(h){return h>1?0:h<-1?Pi:Math.acos(h)}function qa(h){return h>1?jn:h<-1?-jn:Math.asin(h)}function Gn(){}function Rp(h,o){h&&s0.hasOwnProperty(h.type)&&s0[h.type](h,o)}var o0={Feature:function(h,o){Rp(h.geometry,o)},FeatureCollection:function(h,o){for(var l=h.features,u=-1,d=l.length;++u<d;)Rp(l[u].geometry,o)}},s0={Sphere:function(h,o){o.sphere()},Point:function(h,o){h=h.coordinates,o.point(h[0],h[1],h[2])},MultiPoint:function(h,o){for(var l=h.coordinates,u=-1,d=l.length;++u<d;)h=l[u],o.point(h[0],h[1],h[2])},LineString:function(h,o){Xd(h.coordinates,o,0)},MultiLineString:function(h,o){for(var l=h.coordinates,u=-1,d=l.length;++u<d;)Xd(l[u],o,0)},Polygon:function(h,o){a0(h.coordinates,o)},MultiPolygon:function(h,o){for(var l=h.coordinates,u=-1,d=l.length;++u<d;)a0(l[u],o)},GeometryCollection:function(h,o){for(var l=h.geometries,u=-1,d=l.length;++u<d;)Rp(l[u],o)}};function Xd(h,o,l){var u=-1,d=h.length-l,g;for(o.lineStart();++u<d;)g=h[u],o.point(g[0],g[1],g[2]);o.lineEnd()}function a0(h,o){var l=-1,u=h.length;for(o.polygonStart();++l<u;)Xd(h[l],o,1);o.polygonEnd()}function ic(h,o){h&&o0.hasOwnProperty(h.type)?o0[h.type](h,o):Rp(h,o)}function Hd(h){return[Nu(h[1],h[0]),qa(h[2])]}function nc(h){var o=h[0],l=h[1],u=fr(l);return[u*fr(o),u*dr(o),dr(l)]}function Tp(h,o){return h[0]*o[0]+h[1]*o[1]+h[2]*o[2]}function Bp(h,o){return[h[1]*o[2]-h[2]*o[1],h[2]*o[0]-h[0]*o[2],h[0]*o[1]-h[1]*o[0]]}function Td(h,o){h[0]+=o[0],h[1]+=o[1],h[2]+=o[2]}function Ap(h,o){return[h[0]*o,h[1]*o,h[2]*o]}function Yd(h){var o=Xs(h[0]*h[0]+h[1]*h[1]+h[2]*h[2]);h[0]/=o,h[1]/=o,h[2]/=o}function Kd(h,o){function l(u,d){return u=h(u,d),o(u[0],u[1])}return h.invert&&o.invert&&(l.invert=function(u,d){return u=o.invert(u,d),u&&h.invert(u[0],u[1])}),l}function Jd(h,o){return[mr(h)>Pi?h+Math.round(-h/qn)*qn:h,o]}Jd.invert=Jd;function H4(h,o,l){return(h%=qn)?o||l?Kd(c0(h),u0(o,l)):c0(h):o||l?u0(o,l):Jd}function l0(h){return function(o,l){return o+=h,[o>Pi?o-qn:o<-Pi?o+qn:o,l]}}function c0(h){var o=l0(h);return o.invert=l0(-h),o}function u0(h,o){var l=fr(h),u=dr(h),d=fr(o),g=dr(o);function y(n,w){var T=fr(w),M=fr(n)*T,I=dr(n)*T,P=dr(w),z=P*l+M*u;return[Nu(I*d-z*g,M*l-P*u),qa(z*d+I*g)]}return y.invert=function(n,w){var T=fr(w),M=fr(n)*T,I=dr(n)*T,P=dr(w),z=P*d-I*g;return[Nu(I*d+P*g,M*l+z*u),qa(z*l-M*u)]},y}function Y4(h,o,l,u,d,g){if(!!l){var y=fr(o),n=dr(o),w=u*l;d==null?(d=o+u*qn,g=o-w/2):(d=h0(y,d),g=h0(y,g),(u>0?d<g:d>g)&&(d+=u*qn));for(var T,M=d;u>0?M>g:M<g;M-=w)T=Hd([y,-n*fr(M),-n*dr(M)]),h.point(T[0],T[1])}}function h0(h,o){o=nc(o),o[0]-=h,Yd(o);var l=X4(-o[1]);return((-o[2]<0?-l:l)+qn-er)%qn}function Py(){var h=[],o;return{point:function(l,u,d){o.push([l,u,d])},lineStart:function(){h.push(o=[])},lineEnd:Gn,rejoin:function(){h.length>1&&h.push(h.pop().concat(h.shift()))},result:function(){var l=h;return h=[],o=null,l}}}function kp(h,o){return mr(h[0]-o[0])<er&&mr(h[1]-o[1])<er}function Sp(h,o,l,u){this.x=h,this.z=o,this.o=l,this.e=u,this.v=!1,this.n=this.p=null}function Dy(h,o,l,u,d){var g=[],y=[],n,w;if(h.forEach(function(R){if(!((F=R.length-1)<=0)){var F,q=R[0],ae=R[F],se;if(kp(q,ae)){if(!q[2]&&!ae[2]){for(d.lineStart(),n=0;n<F;++n)d.point((q=R[n])[0],q[1]);d.lineEnd();return}ae[0]+=2*er}g.push(se=new Sp(q,R,null,!0)),y.push(se.o=new Sp(q,null,se,!1)),g.push(se=new Sp(ae,R,null,!1)),y.push(se.o=new Sp(ae,null,se,!0))}}),!!g.length){for(y.sort(o),p0(g),p0(y),n=0,w=y.length;n<w;++n)y[n].e=l=!l;for(var T=g[0],M,I;;){for(var P=T,z=!0;P.v;)if((P=P.n)===T)return;M=P.z,d.lineStart();do{if(P.v=P.o.v=!0,P.e){if(z)for(n=0,w=M.length;n<w;++n)d.point((I=M[n])[0],I[1]);else u(P.x,P.n.x,1,d);P=P.n}else{if(z)for(M=P.p.z,n=M.length-1;n>=0;--n)d.point((I=M[n])[0],I[1]);else u(P.x,P.p.x,-1,d);P=P.p}P=P.o,M=P.z,z=!z}while(!P.v);d.lineEnd()}}}function p0(h){if(!!(o=h.length)){for(var o,l=0,u=h[0],d;++l<o;)u.n=d=h[l],d.p=u,u=d;u.n=d=h[0],d.p=u}}function Ad(h){return mr(h[0])<=Pi?h[0]:W4(h[0])*((mr(h[0])+Pi)%qn-Pi)}function K4(h,o){var l=Ad(o),u=o[1],d=dr(u),g=[dr(l),-fr(l),0],y=0,n=0,w=new Ga;d===1?u=jn+er:d===-1&&(u=-jn-er);for(var T=0,M=h.length;T<M;++T)if(!!(P=(I=h[T]).length))for(var I,P,z=I[P-1],R=Ad(z),F=z[1]/2+n0,q=dr(F),ae=fr(F),se=0;se<P;++se,R=Q,q=Ae,ae=$e,z=ie){var ie=I[se],Q=Ad(ie),re=ie[1]/2+n0,Ae=dr(re),$e=fr(re),Je=Q-R,ze=Je>=0?1:-1,Pe=ze*Je,Ge=Pe>Pi,Qe=q*Ae;if(w.add(Nu(Qe*ze*dr(Pe),ae*$e+Qe*fr(Pe))),y+=Ge?Je+ze*qn:Je,Ge^R>=l^Q>=l){var Rt=Bp(nc(z),nc(ie));Yd(Rt);var mt=Bp(g,Rt);Yd(mt);var Ne=(Ge^Je>=0?-1:1)*qa(mt[2]);(u>Ne||u===Ne&&(Rt[0]||Rt[1]))&&(n+=Ge^Je>=0?1:-1)}}return(y<-er||y<er&&w<-zy)^n&1}function Ly(h,o,l,u){return function(d){var g=o(d),y=Py(),n=o(y),w=!1,T,M,I,P={point:z,lineStart:F,lineEnd:q,polygonStart:function(){P.point=ae,P.lineStart=se,P.lineEnd=ie,M=[],T=[]},polygonEnd:function(){P.point=z,P.lineStart=F,P.lineEnd=q,M=dy(M);var Q=K4(T,u);M.length?(w||(d.polygonStart(),w=!0),Dy(M,Q4,Q,l,d)):Q&&(w||(d.polygonStart(),w=!0),d.lineStart(),l(null,null,1,d),d.lineEnd()),w&&(d.polygonEnd(),w=!1),M=T=null},sphere:function(){d.polygonStart(),d.lineStart(),l(null,null,1,d),d.lineEnd(),d.polygonEnd()}};function z(Q,re){h(Q,re)&&d.point(Q,re)}function R(Q,re){g.point(Q,re)}function F(){P.point=R,g.lineStart()}function q(){P.point=z,g.lineEnd()}function ae(Q,re){I.push([Q,re]),n.point(Q,re)}function se(){n.lineStart(),I=[]}function ie(){ae(I[0][0],I[0][1]),n.lineEnd();var Q=n.clean(),re=y.result(),Ae,$e=re.length,Je,ze,Pe;if(I.pop(),T.push(I),I=null,!!$e){if(Q&1){if(ze=re[0],(Je=ze.length-1)>0){for(w||(d.polygonStart(),w=!0),d.lineStart(),Ae=0;Ae<Je;++Ae)d.point((Pe=ze[Ae])[0],Pe[1]);d.lineEnd()}return}$e>1&&Q&2&&re.push(re.pop().concat(re.shift())),M.push(re.filter(J4))}}return P}}function J4(h){return h.length>1}function Q4(h,o){return((h=h.x)[0]<0?h[1]-jn-er:jn-h[1])-((o=o.x)[0]<0?o[1]-jn-er:jn-o[1])}var f0=Ly(function(){return!0},ew,iw,[-Pi,-jn]);function ew(h){var o=NaN,l=NaN,u=NaN,d;return{lineStart:function(){h.lineStart(),d=1},point:function(g,y){var n=g>0?Pi:-Pi,w=mr(g-o);mr(w-Pi)<er?(h.point(o,l=(l+y)/2>0?jn:-jn),h.point(u,l),h.lineEnd(),h.lineStart(),h.point(n,l),h.point(g,l),d=0):u!==n&&w>=Pi&&(mr(o-u)<er&&(o-=u*er),mr(g-n)<er&&(g-=n*er),l=tw(o,l,g,y),h.point(u,l),h.lineEnd(),h.lineStart(),h.point(n,l),d=0),h.point(o=g,l=y),u=n},lineEnd:function(){h.lineEnd(),o=l=NaN},clean:function(){return 2-d}}}function tw(h,o,l,u){var d,g,y=dr(h-l);return mr(y)>er?$4((dr(o)*(g=fr(u))*dr(l)-dr(u)*(d=fr(o))*dr(h))/(d*g*y)):(o+u)/2}function iw(h,o,l,u){var d;if(h==null)d=l*jn,u.point(-Pi,d),u.point(0,d),u.point(Pi,d),u.point(Pi,0),u.point(Pi,-d),u.point(0,-d),u.point(-Pi,-d),u.point(-Pi,0),u.point(-Pi,d);else if(mr(h[0]-o[0])>er){var g=h[0]<o[0]?Pi:-Pi;d=l*g/2,u.point(-g,d),u.point(0,d),u.point(g,d)}else u.point(o[0],o[1])}function rw(h){var o=fr(h),l=6*Mn,u=o>0,d=mr(o)>er;function g(M,I,P,z){Y4(z,h,l,P,M,I)}function y(M,I){return fr(M)*fr(I)>o}function n(M){var I,P,z,R,F;return{lineStart:function(){R=z=!1,F=1},point:function(q,ae){var se=[q,ae],ie,Q=y(q,ae),re=u?Q?0:T(q,ae):Q?T(q+(q<0?Pi:-Pi),ae):0;if(!I&&(R=z=Q)&&M.lineStart(),Q!==z&&(ie=w(I,se),(!ie||kp(I,ie)||kp(se,ie))&&(se[2]=1)),Q!==z)F=0,Q?(M.lineStart(),ie=w(se,I),M.point(ie[0],ie[1])):(ie=w(I,se),M.point(ie[0],ie[1],2),M.lineEnd()),I=ie;else if(d&&I&&u^Q){var Ae;!(re&P)&&(Ae=w(se,I,!0))&&(F=0,u?(M.lineStart(),M.point(Ae[0][0],Ae[0][1]),M.point(Ae[1][0],Ae[1][1]),M.lineEnd()):(M.point(Ae[1][0],Ae[1][1]),M.lineEnd(),M.lineStart(),M.point(Ae[0][0],Ae[0][1],3)))}Q&&(!I||!kp(I,se))&&M.point(se[0],se[1]),I=se,z=Q,P=re},lineEnd:function(){z&&M.lineEnd(),I=null},clean:function(){return F|(R&&z)<<1}}}function w(M,I,P){var z=nc(M),R=nc(I),F=[1,0,0],q=Bp(z,R),ae=Tp(q,q),se=q[0],ie=ae-se*se;if(!ie)return!P&&M;var Q=o*ae/ie,re=-o*se/ie,Ae=Bp(F,q),$e=Ap(F,Q),Je=Ap(q,re);Td($e,Je);var ze=Ae,Pe=Tp($e,ze),Ge=Tp(ze,ze),Qe=Pe*Pe-Ge*(Tp($e,$e)-1);if(!(Qe<0)){var Rt=Xs(Qe),mt=Ap(ze,(-Pe-Rt)/Ge);if(Td(mt,$e),mt=Hd(mt),!P)return mt;var Ne=M[0],At=I[0],$t=M[1],_t=I[1],Ht;At<Ne&&(Ht=Ne,Ne=At,At=Ht);var Ci=At-Ne,Ui=mr(Ci-Pi)<er,Kt=Ui||Ci<er;if(!Ui&&_t<$t&&(Ht=$t,$t=_t,_t=Ht),Kt?Ui?$t+_t>0^mt[1]<(mr(mt[0]-Ne)<er?$t:_t):$t<=mt[1]&&mt[1]<=_t:Ci>Pi^(Ne<=mt[0]&&mt[0]<=At)){var Yt=Ap(ze,(-Pe+Rt)/Ge);return Td(Yt,$e),[mt,Hd(Yt)]}}}function T(M,I){var P=u?h:Pi-h,z=0;return M<-P?z|=1:M>P&&(z|=2),I<-P?z|=4:I>P&&(z|=8),z}return Ly(y,n,g,u?[0,-h]:[-Pi,h-Pi])}function nw(h,o,l,u,d,g){var y=h[0],n=h[1],w=o[0],T=o[1],M=0,I=1,P=w-y,z=T-n,R;if(R=l-y,!(!P&&R>0)){if(R/=P,P<0){if(R<M)return;R<I&&(I=R)}else if(P>0){if(R>I)return;R>M&&(M=R)}if(R=d-y,!(!P&&R<0)){if(R/=P,P<0){if(R>I)return;R>M&&(M=R)}else if(P>0){if(R<M)return;R<I&&(I=R)}if(R=u-n,!(!z&&R>0)){if(R/=z,z<0){if(R<M)return;R<I&&(I=R)}else if(z>0){if(R>I)return;R>M&&(M=R)}if(R=g-n,!(!z&&R<0)){if(R/=z,z<0){if(R>I)return;R>M&&(M=R)}else if(z>0){if(R<M)return;R<I&&(I=R)}return M>0&&(h[0]=y+M*P,h[1]=n+M*z),I<1&&(o[0]=y+I*P,o[1]=n+I*z),!0}}}}}var Au=1e9,Mp=-Au;function ow(h,o,l,u){function d(T,M){return h<=T&&T<=l&&o<=M&&M<=u}function g(T,M,I,P){var z=0,R=0;if(T==null||(z=y(T,I))!==(R=y(M,I))||w(T,M)<0^I>0)do P.point(z===0||z===3?h:l,z>1?u:o);while((z=(z+I+4)%4)!==R);else P.point(M[0],M[1])}function y(T,M){return mr(T[0]-h)<er?M>0?0:3:mr(T[0]-l)<er?M>0?2:1:mr(T[1]-o)<er?M>0?1:0:M>0?3:2}function n(T,M){return w(T.x,M.x)}function w(T,M){var I=y(T,1),P=y(M,1);return I!==P?I-P:I===0?M[1]-T[1]:I===1?T[0]-M[0]:I===2?T[1]-M[1]:M[0]-T[0]}return function(T){var M=T,I=Py(),P,z,R,F,q,ae,se,ie,Q,re,Ae,$e={point:Je,lineStart:Qe,lineEnd:Rt,polygonStart:Pe,polygonEnd:Ge};function Je(Ne,At){d(Ne,At)&&M.point(Ne,At)}function ze(){for(var Ne=0,At=0,$t=z.length;At<$t;++At)for(var _t=z[At],Ht=1,Ci=_t.length,Ui=_t[0],Kt,Yt,Lt=Ui[0],Zt=Ui[1];Ht<Ci;++Ht)Kt=Lt,Yt=Zt,Ui=_t[Ht],Lt=Ui[0],Zt=Ui[1],Yt<=u?Zt>u&&(Lt-Kt)*(u-Yt)>(Zt-Yt)*(h-Kt)&&++Ne:Zt<=u&&(Lt-Kt)*(u-Yt)<(Zt-Yt)*(h-Kt)&&--Ne;return Ne}function Pe(){M=I,P=[],z=[],Ae=!0}function Ge(){var Ne=ze(),At=Ae&&Ne,$t=(P=dy(P)).length;(At||$t)&&(T.polygonStart(),At&&(T.lineStart(),g(null,null,1,T),T.lineEnd()),$t&&Dy(P,n,Ne,g,T),T.polygonEnd()),M=T,P=z=R=null}function Qe(){$e.point=mt,z&&z.push(R=[]),re=!0,Q=!1,se=ie=NaN}function Rt(){P&&(mt(F,q),ae&&Q&&I.rejoin(),P.push(I.result())),$e.point=Je,Q&&M.lineEnd()}function mt(Ne,At){var $t=d(Ne,At);if(z&&R.push([Ne,At]),re)F=Ne,q=At,ae=$t,re=!1,$t&&(M.lineStart(),M.point(Ne,At));else if($t&&Q)M.point(Ne,At);else{var _t=[se=Math.max(Mp,Math.min(Au,se)),ie=Math.max(Mp,Math.min(Au,ie))],Ht=[Ne=Math.max(Mp,Math.min(Au,Ne)),At=Math.max(Mp,Math.min(Au,At))];nw(_t,Ht,h,o,l,u)?(Q||(M.lineStart(),M.point(_t[0],_t[1])),M.point(Ht[0],Ht[1]),$t||M.lineEnd(),Ae=!1):$t&&(M.lineStart(),M.point(Ne,At),Ae=!1)}se=Ne,ie=At,Q=$t}return $e}}var Qd=h=>h,Sd=new Ga,e1=new Ga,Ry,By,t1,i1,js={point:Gn,lineStart:Gn,lineEnd:Gn,polygonStart:function(){js.lineStart=sw,js.lineEnd=lw},polygonEnd:function(){js.lineStart=js.lineEnd=js.point=Gn,Sd.add(mr(e1)),e1=new Ga},result:function(){var h=Sd/2;return Sd=new Ga,h}};function sw(){js.point=aw}function aw(h,o){js.point=Oy,Ry=t1=h,By=i1=o}function Oy(h,o){e1.add(i1*h-t1*o),t1=h,i1=o}function lw(){Oy(Ry,By)}var d0=js,oc=1/0,Op=oc,ju=-oc,Fp=ju,cw={point:uw,lineStart:Gn,lineEnd:Gn,polygonStart:Gn,polygonEnd:Gn,result:function(){var h=[[oc,Op],[ju,Fp]];return ju=Fp=-(Op=oc=1/0),h}};function uw(h,o){h<oc&&(oc=h),h>ju&&(ju=h),o<Op&&(Op=o),o>Fp&&(Fp=o)}var Up=cw,r1=0,n1=0,Su=0,Vp=0,Np=0,rc=0,o1=0,s1=0,Mu=0,Fy,Uy,Co,zo,so={point:Za,lineStart:m0,lineEnd:_0,polygonStart:function(){so.lineStart=fw,so.lineEnd=dw},polygonEnd:function(){so.point=Za,so.lineStart=m0,so.lineEnd=_0},result:function(){var h=Mu?[o1/Mu,s1/Mu]:rc?[Vp/rc,Np/rc]:Su?[r1/Su,n1/Su]:[NaN,NaN];return r1=n1=Su=Vp=Np=rc=o1=s1=Mu=0,h}};function Za(h,o){r1+=h,n1+=o,++Su}function m0(){so.point=hw}function hw(h,o){so.point=pw,Za(Co=h,zo=o)}function pw(h,o){var l=h-Co,u=o-zo,d=Xs(l*l+u*u);Vp+=d*(Co+h)/2,Np+=d*(zo+o)/2,rc+=d,Za(Co=h,zo=o)}function _0(){so.point=Za}function fw(){so.point=mw}function dw(){Vy(Fy,Uy)}function mw(h,o){so.point=Vy,Za(Fy=Co=h,Uy=zo=o)}function Vy(h,o){var l=h-Co,u=o-zo,d=Xs(l*l+u*u);Vp+=d*(Co+h)/2,Np+=d*(zo+o)/2,rc+=d,d=zo*h-Co*o,o1+=d*(Co+h),s1+=d*(zo+o),Mu+=d*3,Za(Co=h,zo=o)}var g0=so;function Ny(h){this._context=h}Ny.prototype={_radius:4.5,pointRadius:function(h){return this._radius=h,this},polygonStart:function(){this._line=0},polygonEnd:function(){this._line=NaN},lineStart:function(){this._point=0},lineEnd:function(){this._line===0&&this._context.closePath(),this._point=NaN},point:function(h,o){switch(this._point){case 0:{this._context.moveTo(h,o),this._point=1;break}case 1:{this._context.lineTo(h,o);break}default:{this._context.moveTo(h+this._radius,o),this._context.arc(h,o,this._radius,0,qn);break}}},result:Gn};var a1=new Ga,Md,jy,Gy,Iu,ku,jp={point:Gn,lineStart:function(){jp.point=_w},lineEnd:function(){Md&&qy(jy,Gy),jp.point=Gn},polygonStart:function(){Md=!0},polygonEnd:function(){Md=null},result:function(){var h=+a1;return a1=new Ga,h}};function _w(h,o){jp.point=qy,jy=Iu=h,Gy=ku=o}function qy(h,o){Iu-=h,ku-=o,a1.add(Xs(Iu*Iu+ku*ku)),Iu=h,ku=o}var y0=jp;function Zy(){this._string=[]}Zy.prototype={_radius:4.5,_circle:v0(4.5),pointRadius:function(h){return(h=+h)!==this._radius&&(this._radius=h,this._circle=null),this},polygonStart:function(){this._line=0},polygonEnd:function(){this._line=NaN},lineStart:function(){this._point=0},lineEnd:function(){this._line===0&&this._string.push("Z"),this._point=NaN},point:function(h,o){switch(this._point){case 0:{this._string.push("M",h,",",o),this._point=1;break}case 1:{this._string.push("L",h,",",o);break}default:{this._circle==null&&(this._circle=v0(this._radius)),this._string.push("M",h,",",o,this._circle);break}}},result:function(){if(this._string.length){var h=this._string.join("");return this._string=[],h}else return null}};function v0(h){return"m0,"+h+"a"+h+","+h+" 0 1,1 0,"+-2*h+"a"+h+","+h+" 0 1,1 0,"+2*h+"z"}function gw(h,o){var l=4.5,u,d;function g(y){return y&&(typeof l=="function"&&d.pointRadius(+l.apply(this,arguments)),ic(y,u(d))),d.result()}return g.area=function(y){return ic(y,u(d0)),d0.result()},g.measure=function(y){return ic(y,u(y0)),y0.result()},g.bounds=function(y){return ic(y,u(Up)),Up.result()},g.centroid=function(y){return ic(y,u(g0)),g0.result()},g.projection=function(y){return arguments.length?(u=y==null?(h=null,Qd):(h=y).stream,g):h},g.context=function(y){return arguments.length?(d=y==null?(o=null,new Zy):new Ny(o=y),typeof l!="function"&&d.pointRadius(l),g):o},g.pointRadius=function(y){return arguments.length?(l=typeof y=="function"?y:(d.pointRadius(+y),+y),g):l},g.projection(h).context(o)}function v1(h){return function(o){var l=new l1;for(var u in h)l[u]=h[u];return l.stream=o,l}}function l1(){}l1.prototype={constructor:l1,point:function(h,o){this.stream.point(h,o)},sphere:function(){this.stream.sphere()},lineStart:function(){this.stream.lineStart()},lineEnd:function(){this.stream.lineEnd()},polygonStart:function(){this.stream.polygonStart()},polygonEnd:function(){this.stream.polygonEnd()}};function x1(h,o,l){var u=h.clipExtent&&h.clipExtent();return h.scale(150).translate([0,0]),u!=null&&h.clipExtent(null),ic(l,h.stream(Up)),o(Up.result()),u!=null&&h.clipExtent(u),h}function $y(h,o,l){return x1(h,function(u){var d=o[1][0]-o[0][0],g=o[1][1]-o[0][1],y=Math.min(d/(u[1][0]-u[0][0]),g/(u[1][1]-u[0][1])),n=+o[0][0]+(d-y*(u[1][0]+u[0][0]))/2,w=+o[0][1]+(g-y*(u[1][1]+u[0][1]))/2;h.scale(150*y).translate([n,w])},l)}function yw(h,o,l){return $y(h,[[0,0],o],l)}function vw(h,o,l){return x1(h,function(u){var d=+o,g=d/(u[1][0]-u[0][0]),y=(d-g*(u[1][0]+u[0][0]))/2,n=-g*u[0][1];h.scale(150*g).translate([y,n])},l)}function xw(h,o,l){return x1(h,function(u){var d=+o,g=d/(u[1][1]-u[0][1]),y=-g*u[0][0],n=(d-g*(u[1][1]+u[0][1]))/2;h.scale(150*g).translate([y,n])},l)}var x0=16,bw=fr(30*Mn);function b0(h,o){return+o?Ew(h,o):ww(h)}function ww(h){return v1({point:function(o,l){o=h(o,l),this.stream.point(o[0],o[1])}})}function Ew(h,o){function l(u,d,g,y,n,w,T,M,I,P,z,R,F,q){var ae=T-u,se=M-d,ie=ae*ae+se*se;if(ie>4*o&&F--){var Q=y+P,re=n+z,Ae=w+R,$e=Xs(Q*Q+re*re+Ae*Ae),Je=qa(Ae/=$e),ze=mr(mr(Ae)-1)<er||mr(g-I)<er?(g+I)/2:Nu(re,Q),Pe=h(ze,Je),Ge=Pe[0],Qe=Pe[1],Rt=Ge-u,mt=Qe-d,Ne=se*Rt-ae*mt;(Ne*Ne/ie>o||mr((ae*Rt+se*mt)/ie-.5)>.3||y*P+n*z+w*R<bw)&&(l(u,d,g,y,n,w,Ge,Qe,ze,Q/=$e,re/=$e,Ae,F,q),q.point(Ge,Qe),l(Ge,Qe,ze,Q,re,Ae,T,M,I,P,z,R,F,q))}}return function(u){var d,g,y,n,w,T,M,I,P,z,R,F,q={point:ae,lineStart:se,lineEnd:Q,polygonStart:function(){u.polygonStart(),q.lineStart=re},polygonEnd:function(){u.polygonEnd(),q.lineStart=se}};function ae(Je,ze){Je=h(Je,ze),u.point(Je[0],Je[1])}function se(){I=NaN,q.point=ie,u.lineStart()}function ie(Je,ze){var Pe=nc([Je,ze]),Ge=h(Je,ze);l(I,P,M,z,R,F,I=Ge[0],P=Ge[1],M=Je,z=Pe[0],R=Pe[1],F=Pe[2],x0,u),u.point(I,P)}function Q(){q.point=ae,u.lineEnd()}function re(){se(),q.point=Ae,q.lineEnd=$e}function Ae(Je,ze){ie(d=Je,ze),g=I,y=P,n=z,w=R,T=F,q.point=ie}function $e(){l(I,P,M,z,R,F,g,y,d,n,w,T,x0,u),q.lineEnd=Q,Q()}return q}}var Tw=v1({point:function(h,o){this.stream.point(h*Mn,o*Mn)}});function Aw(h){return v1({point:function(o,l){var u=h(o,l);return this.stream.point(u[0],u[1])}})}function Sw(h,o,l,u,d){function g(y,n){return y*=u,n*=d,[o+h*y,l-h*n]}return g.invert=function(y,n){return[(y-o)/h*u,(l-n)/h*d]},g}function w0(h,o,l,u,d,g){if(!g)return Sw(h,o,l,u,d);var y=fr(g),n=dr(g),w=y*h,T=n*h,M=y/h,I=n/h,P=(n*l-y*o)/h,z=(n*o+y*l)/h;function R(F,q){return F*=u,q*=d,[w*F-T*q+o,l-T*F-w*q]}return R.invert=function(F,q){return[u*(M*F-I*q+P),d*(z-I*F-M*q)]},R}function Mw(h){return Iw(function(){return h})()}function Iw(h){var o,l=150,u=480,d=250,g=0,y=0,n=0,w=0,T=0,M,I=0,P=1,z=1,R=null,F=f0,q=null,ae,se,ie,Q=Qd,re=.5,Ae,$e,Je,ze,Pe;function Ge(Ne){return Je(Ne[0]*Mn,Ne[1]*Mn)}function Qe(Ne){return Ne=Je.invert(Ne[0],Ne[1]),Ne&&[Ne[0]*rs,Ne[1]*rs]}Ge.stream=function(Ne){return ze&&Pe===Ne?ze:ze=Tw(Aw(M)(F(Ae(Q(Pe=Ne)))))},Ge.preclip=function(Ne){return arguments.length?(F=Ne,R=void 0,mt()):F},Ge.postclip=function(Ne){return arguments.length?(Q=Ne,q=ae=se=ie=null,mt()):Q},Ge.clipAngle=function(Ne){return arguments.length?(F=+Ne?rw(R=Ne*Mn):(R=null,f0),mt()):R*rs},Ge.clipExtent=function(Ne){return arguments.length?(Q=Ne==null?(q=ae=se=ie=null,Qd):ow(q=+Ne[0][0],ae=+Ne[0][1],se=+Ne[1][0],ie=+Ne[1][1]),mt()):q==null?null:[[q,ae],[se,ie]]},Ge.scale=function(Ne){return arguments.length?(l=+Ne,Rt()):l},Ge.translate=function(Ne){return arguments.length?(u=+Ne[0],d=+Ne[1],Rt()):[u,d]},Ge.center=function(Ne){return arguments.length?(g=Ne[0]%360*Mn,y=Ne[1]%360*Mn,Rt()):[g*rs,y*rs]},Ge.rotate=function(Ne){return arguments.length?(n=Ne[0]%360*Mn,w=Ne[1]%360*Mn,T=Ne.length>2?Ne[2]%360*Mn:0,Rt()):[n*rs,w*rs,T*rs]},Ge.angle=function(Ne){return arguments.length?(I=Ne%360*Mn,Rt()):I*rs},Ge.reflectX=function(Ne){return arguments.length?(P=Ne?-1:1,Rt()):P<0},Ge.reflectY=function(Ne){return arguments.length?(z=Ne?-1:1,Rt()):z<0},Ge.precision=function(Ne){return arguments.length?(Ae=b0($e,re=Ne*Ne),mt()):Xs(re)},Ge.fitExtent=function(Ne,At){return $y(Ge,Ne,At)},Ge.fitSize=function(Ne,At){return yw(Ge,Ne,At)},Ge.fitWidth=function(Ne,At){return vw(Ge,Ne,At)},Ge.fitHeight=function(Ne,At){return xw(Ge,Ne,At)};function Rt(){var Ne=w0(l,0,0,P,z,I).apply(null,o(g,y)),At=w0(l,u-Ne[0],d-Ne[1],P,z,I);return M=H4(n,w,T),$e=Kd(o,At),Je=Kd(M,$e),Ae=b0($e,re),mt()}function mt(){return ze=Pe=null,Ge}return function(){return o=h.apply(this,arguments),Ge.invert=o.invert&&Qe,Rt()}}var zu=1.340264,Pu=-.081106,Du=893e-6,Lu=.003796,Gp=Xs(3)/2,kw=12;function Wy(h,o){var l=qa(Gp*dr(o)),u=l*l,d=u*u*u;return[h*fr(l)/(Gp*(zu+3*Pu*u+d*(7*Du+9*Lu*u))),l*(zu+Pu*u+d*(Du+Lu*u))]}Wy.invert=function(h,o){for(var l=o,u=l*l,d=u*u*u,g=0,y,n,w;g<kw&&(n=l*(zu+Pu*u+d*(Du+Lu*u))-o,w=zu+3*Pu*u+d*(7*Du+9*Lu*u),l-=y=n/w,u=l*l,d=u*u*u,!(mr(y)<zy));++g);return[Gp*h*(zu+3*Pu*u+d*(7*Du+9*Lu*u))/fr(l),qa(dr(l)/Gp)]};function Cw(){return Mw(Wy).scale(177.158)}function zw(h){return h}function Pw(h){if(h==null)return zw;var o,l,u=h.scale[0],d=h.scale[1],g=h.translate[0],y=h.translate[1];return function(n,w){w||(o=l=0);var T=2,M=n.length,I=new Array(M);for(I[0]=(o+=n[0])*u+g,I[1]=(l+=n[1])*d+y;T<M;)I[T]=n[T],++T;return I}}function Dw(h,o){for(var l,u=h.length,d=u-o;d<--u;)l=h[d],h[d++]=h[u],h[u]=l}function Lw(h,o){return typeof o=="string"&&(o=h.objects[o]),o.type==="GeometryCollection"?{type:"FeatureCollection",features:o.geometries.map(function(l){return E0(h,l)})}:E0(h,o)}function E0(h,o){var l=o.id,u=o.bbox,d=o.properties==null?{}:o.properties,g=Rw(h,o);return l==null&&u==null?{type:"Feature",properties:d,geometry:g}:u==null?{type:"Feature",id:l,properties:d,geometry:g}:{type:"Feature",id:l,bbox:u,properties:d,geometry:g}}function Rw(h,o){var l=Pw(h.transform),u=h.arcs;function d(M,I){I.length&&I.pop();for(var P=u[M<0?~M:M],z=0,R=P.length;z<R;++z)I.push(l(P[z],z));M<0&&Dw(I,R)}function g(M){return l(M)}function y(M){for(var I=[],P=0,z=M.length;P<z;++P)d(M[P],I);return I.length<2&&I.push(I[0]),I}function n(M){for(var I=y(M);I.length<4;)I.push(I[0]);return I}function w(M){return M.map(n)}function T(M){var I=M.type,P;switch(I){case"GeometryCollection":return{type:I,geometries:M.geometries.map(T)};case"Point":P=g(M.coordinates);break;case"MultiPoint":P=M.coordinates.map(g);break;case"LineString":P=y(M.arcs);break;case"MultiLineString":P=M.arcs.map(y);break;case"Polygon":P=w(M.arcs);break;case"MultiPolygon":P=M.arcs.map(w);break;default:return null}return{type:I,coordinates:P}}return T(o)}const Xy="Topology",Hy=[[[25241,4772],[0,-59],[-45,-30],[-44,-25],[-9,45],[35,24],[22,7],[41,38]],[[25110,4598],[17,20],[24,-35],[-11,-63],[-44,-16],[-39,14],[-6,54],[27,41],[32,-15]],[[14,4777],[-8,-58],[-6,-6],[0,59],[14,5]],[[14998,6596],[11,-14],[255,-245],[4,-70],[101,-121]],[[15369,6146],[-32,-149],[4,-68],[45,-44],[2,-31],[-19,-73],[4,-37],[-5,-58],[25,-75],[29,-119],[25,-27]],[[15447,5465],[0,0],[-56,-70],[-76,-46],[-42,2],[-25,-37],[-49,-3],[-18,-15],[-85,34],[-52,-10]],[[15044,5320],[-20,164],[-24,57],[-14,33],[-69,22]],[[14917,5596],[-39,37],[-45,20],[-28,20],[-29,31]],[[14776,5704],[0,0],[-38,152],[-41,68],[-14,69],[7,63],[-12,111]],[[14678,6167],[29,6],[25,44],[27,63],[18,25],[-1,39],[-15,27],[-4,48]],[[14757,6419],[0,0],[20,15],[4,71],[-28,68]],[[14753,6573],[25,15],[77,-2],[143,10]],[[12013,10047],[0,-8],[-1,-23]],[[12012,10016],[-1,-183],[-230,6],[3,-308],[-66,-11],[-17,-62],[13,-174],[-275,0],[-15,-40]],[[11424,9244],[3,51]],[[11427,9295],[1,0],[158,10],[9,43],[28,54],[24,167],[97,130],[33,152],[22,9],[23,94],[59,13],[25,-16],[32,0],[23,28],[43,4],[-2,64],[11,0]],[[4008,12623],[-10,0],[-135,118],[-51,53],[-127,50],[-39,106],[10,74],[-89,52],[-13,97],[-84,88],[-2,62]],[[3468,13323],[0,0],[39,58],[-2,76],[-119,77],[-72,138],[-44,86],[-64,55],[-47,49],[-37,62],[-71,-39],[-68,-67],[-62,79],[-49,53],[-68,33],[-69,4],[0,687],[0,448],[0,0]],[[2735,15122],[131,-29],[111,-58],[73,-11],[61,50],[85,38],[104,-15],[105,53],[115,30],[48,-50],[53,28],[15,57],[49,-13],[118,-108],[94,82],[9,-92],[86,20],[27,35],[85,-7],[107,-51],[164,-44],[96,-20],[69,8],[95,-62],[-99,-60],[127,-25],[189,14],[60,21],[74,-72],[77,61],[-72,51],[45,41],[86,6],[56,12],[57,-29],[70,-66],[78,10],[124,-54],[109,19],[102,-3],[-8,75],[63,21],[108,-41],[0,-114],[44,96],[57,-3],[31,121],[-75,75],[-81,48],[5,134],[83,87],[93,-19],[70,-53],[96,-136],[-63,-60],[131,-24],[0,-123],[93,94],[84,-78],[-21,-89],[68,-81],[73,87],[51,104],[4,132],[100,-9],[104,-18],[94,-60],[4,-59],[-52,-65],[49,-64],[-9,-59],[-137,-84],[-98,-19],[-72,36],[-21,-60],[-68,-102],[-20,-53],[-81,-81],[-101,-8],[-55,-51],[-5,-79],[-81,-15],[-86,-98],[-76,-136],[-27,-95],[-4,-140],[103,-20],[31,-113],[33,-92],[98,24],[131,-52],[70,-46],[50,-57],[88,-33],[74,-51],[116,-7],[76,-11],[-11,-105],[21,-121],[51,-135],[104,-115],[54,39],[38,124],[-36,191],[-50,64],[113,56],[79,85],[39,84],[-6,80],[-47,103],[-86,91],[83,126],[-30,109],[-24,189],[49,28],[120,-33],[72,-12],[58,32],[66,-41],[86,-70],[21,-47],[125,-9],[-2,-101],[23,-153],[64,-19],[51,-71],[102,67],[67,133],[46,56],[55,-107],[91,-154],[78,-145],[-28,-76],[93,-68],[63,-69],[112,-31],[45,-38],[27,-103],[55,-16],[28,-45],[5,-136],[-51,-45],[-50,-42],[-115,-43],[-89,-99],[-118,-20],[-150,25],[-105,1],[-73,-8],[-59,-87],[-89,-53],[-101,-160],[-81,-111],[60,20],[112,158],[147,101],[105,12],[62,-59],[-66,-81],[22,-131],[23,-91],[91,-60],[116,18],[70,135],[5,-87],[45,-44],[-86,-79],[-156,-72],[-69,-49],[-78,-87],[-54,9],[-2,102],[121,100],[-112,-4],[-78,-14]],[[7913,12157],[-46,68],[0,164],[-31,35],[-47,-20],[-23,31],[-53,-91],[-22,-94],[-25,-54],[-30,-19],[-22,-6],[-7,-30],[-129,0],[-107,-1],[-31,-22],[-74,-87],[-9,-9],[-23,-47],[-64,0],[-69,-1],[-32,-19],[12,-24],[6,-37],[-1,-12],[-92,-60],[-72,-19],[-82,-64],[-17,0],[-24,19],[-8,17],[2,13],[15,42],[33,66],[21,72],[-15,104],[-14,110],[-74,57],[9,21],[-10,15],[-19,0],[-15,19],[-3,28],[-14,-12],[-18,4],[4,12],[-17,12],[-6,31],[-55,39],[-57,40],[-68,47],[-66,44],[-63,-35],[-23,-1],[-86,32],[-57,-16],[-68,37],[-71,20],[-49,7],[-22,20],[-13,67],[-23,-1],[0,-46],[-146,0],[-239,0],[-239,0],[-210,0],[-211,0],[-206,0],[-214,0],[-69,0],[-208,0],[-199,0]],[[6731,14246],[52,56],[97,-2],[-2,-23],[-82,-67],[-49,3],[-16,33]],[[7027,15495],[-77,64],[3,43],[34,8],[160,-13],[121,-66],[6,-33],[-74,3],[-76,3],[-77,-17],[-20,8]],[[6989,14202],[27,36],[29,-3],[18,-25],[-28,-63],[-31,10],[-18,36],[3,9]],[[6057,15757],[-38,-46],[-102,9],[-85,31],[37,54],[101,33],[61,-42],[26,-39]],[[6041,16064],[-32,-4],[-131,8],[-19,34],[141,-2],[49,-22],[-8,-14]],[[5837,16214],[83,-42],[-19,-43],[-103,-25],[-57,28],[-30,45],[-6,50],[91,-5],[41,-8]],[[6440,15687],[-113,14],[-187,39],[-24,67],[-8,59],[-71,53],[-145,15],[-81,37],[26,50],[145,-8],[78,-39],[138,0],[60,-39],[-16,-46],[81,-27],[44,-29],[95,-5],[102,-10],[112,26],[142,10],[114,-8],[75,-45],[16,-50],[-44,-32],[-104,-26],[-90,14],[-201,-18],[-144,-2]],[[4819,16140],[99,-19],[-23,-36],[-131,-34],[-104,39],[57,38],[102,12]],[[4840,16219],[92,-25],[-86,-23],[-116,0],[1,17],[72,36],[37,-5]],[[8722,12902],[-37,-76],[-47,-105],[46,40],[47,-25],[-24,-43],[62,-33],[32,30],[70,-37],[-22,-89],[49,21],[9,-64],[22,-75],[-29,-106],[-32,-5],[-46,23],[15,99],[-20,15],[-81,-105],[-42,5],[50,56],[-67,30],[-76,-8],[-136,4],[-11,36],[44,42],[-30,33],[58,73],[73,192],[43,69],[61,41],[33,-5],[-14,-33]],[[6739,14566],[77,-41],[80,-37],[6,-58],[52,10],[50,-40],[-62,-38],[-109,29],[-40,54],[-69,-64],[-100,-63],[-24,71],[-95,-12],[61,60],[9,95],[24,110],[51,-9],[13,-54],[35,19],[41,-32]],[[7098,15440],[66,48],[155,-61],[97,-57],[9,-53],[130,27],[73,-76],[170,-48],[61,-49],[66,-113],[-129,-56],[165,-79],[112,-26],[101,-111],[110,-8],[-22,-85],[-123,-140],[-86,52],[-111,116],[-90,-15],[-9,-70],[74,-70],[95,-55],[29,-32],[45,-120],[-24,-86],[-88,32],[-176,97],[99,-104],[73,-73],[11,-42],[-190,48],[-150,70],[-85,59],[24,34],[-104,62],[-102,59],[1,-35],[-203,-20],[-59,42],[46,89],[132,2],[144,15],[-24,43],[25,60],[91,118],[-20,53],[-27,42],[-107,58],[-142,41],[45,31],[-74,75],[-62,7],[-55,41],[-38,-36],[-127,-15],[-255,27],[-149,35],[-113,18],[-59,43],[74,55],[-100,0],[-22,122],[54,108],[72,49],[181,33],[-52,-78],[56,-76],[64,98],[178,49],[120,-125],[-10,-79],[139,35]],[[5994,15655],[147,-4],[134,-29],[-105,-108],[-84,-23],[-75,-90],[-80,4],[-44,106],[1,60],[37,52],[69,32]],[[4007,15895],[0,0],[119,90],[144,78],[107,-2],[96,18],[-9,-93],[-54,-42],[-66,-5],[-130,-52],[-112,-19],[-95,27]],[[3316,13231],[67,9],[-21,-137],[61,-97],[-28,1],[-42,55],[-26,55],[-35,38],[-13,53],[4,38],[33,-15]],[[5224,16279],[138,-17],[189,-44],[54,-57],[27,-50],[-114,13],[-116,39],[-156,5],[68,36],[-85,29],[-5,46]],[[3961,12564],[-36,-17],[-115,55],[-21,42],[-62,43],[-13,34],[-72,22],[-27,65],[6,28],[73,-26],[43,-18],[66,-13],[24,-42],[35,-57],[70,-50],[29,-66]],[[4099,15693],[100,-25],[179,-6],[68,-35],[76,-51],[-89,-31],[-171,-84],[-87,-85],[0,-52],[-185,-59],[-37,53],[-162,64],[30,51],[49,88],[61,80],[-69,74],[237,18]],[[5061,15862],[62,20],[74,-5],[12,-59],[-43,-58],[-237,-18],[-177,-52],[-107,-3],[-8,39],[145,53],[-317,-14],[-98,22],[96,118],[66,33],[197,-40],[125,-72],[122,-9],[-100,115],[64,44],[73,-14],[23,-57],[28,-43]],[[5152,15528],[78,-49],[44,-118],[22,-85],[118,-59],[126,-58],[-7,-53],[-115,-9],[44,-47],[-23,-44],[-127,19],[-121,33],[-81,-8],[-132,-41],[-178,-18],[-124,-11],[-38,57],[-96,33],[-62,-14],[-87,96],[47,13],[108,20],[99,-5],[92,21],[-136,28],[-150,-10],[-99,3],[-37,44],[162,49],[-108,-2],[-122,32],[59,90],[48,48],[188,73],[72,-23],[-35,-56],[156,36],[97,-61],[80,62],[64,-40],[57,-118],[35,50],[-50,123],[62,18],[70,-19]],[[5578,15483],[-77,79],[83,58],[84,-25],[125,15],[18,-35],[-65,-58],[106,-52],[-13,-108],[-115,-47],[-67,10],[-49,46],[-174,93],[1,39],[143,-15]],[[5146,15591],[94,5],[54,-27],[-62,-79],[-109,84],[23,17]],[[5714,15967],[54,-56],[2,-61],[-32,-90],[-115,-13],[-76,20],[2,70],[-115,-9],[-5,93],[76,-4],[105,42],[99,-7],[5,15]],[[5888,16436],[49,37],[72,8],[-31,28],[163,6],[90,-65],[118,-25],[115,-23],[55,-80],[85,-39],[-97,-36],[-129,-90],[-124,-9],[-145,15],[-76,49],[1,44],[56,32],[-128,-1],[-78,41],[-44,54],[48,54]],[[6199,16592],[104,23],[82,4],[138,19],[103,45],[87,-6],[75,-34],[54,65],[92,20],[126,13],[214,5],[38,-13],[202,20],[152,-7],[152,-8],[187,-9],[151,-16],[128,-33],[-3,-32],[-171,-52],[-170,-25],[-63,-27],[152,1],[-165,-73],[-114,-34],[-120,-99],[-145,-20],[-45,-25],[-212,-13],[97,-15],[-49,-21],[58,-60],[-66,-41],[-109,-34],[-33,-47],[-98,-37],[10,-27],[120,5],[1,-30],[-187,-72],[-183,33],[-206,-18],[-104,14],[-133,7],[-9,57],[130,28],[-35,87],[43,8],[187,-52],[-95,78],[-114,23],[57,46],[124,29],[20,42],[-99,47],[-30,63],[192,-6],[55,-13],[110,44],[-158,14],[-245,-8],[-124,41],[-59,49],[-82,36],[-15,41]],[[7347,14848],[-46,-35],[-78,-7],[-18,60],[30,67],[64,17],[55,-34],[1,-51],[-8,-17]],[[5872,15095],[42,-46],[-43,-42],[-95,36],[-57,-13],[-96,54],[62,38],[49,52],[74,-34],[42,-22],[22,-23]],[[8097,12728],[24,10],[92,-30],[72,-51],[2,-22],[-34,-2],[-91,38],[-65,57]],[[8132,12386],[25,-59],[51,-16],[65,3],[-35,-49],[-26,-8],[-89,51],[-17,40],[26,38]],[[7913,12157],[12,-40],[-75,-58],[-72,-42],[-74,-36],[-37,-71],[-12,-28],[0,-64],[23,-64],[29,-3],[-7,45],[21,-27],[-6,-35],[-47,-19],[-34,2],[-52,-21],[-30,-6],[-41,-6],[-59,-35],[103,23],[21,-23],[-98,-36],[-45,-1],[2,15],[-21,-33],[21,-6],[-15,-86],[-51,-93],[-6,31],[-15,6],[-23,30],[15,-65],[17,-21],[1,-46],[-23,-47],[-39,-96],[-6,5],[21,82],[-35,46],[-9,100],[-13,-52],[15,-77],[-47,19],[49,-39],[3,-114],[20,-9],[7,-41],[10,-121],[-45,-90],[-72,-35],[-46,-71],[-35,-8],[-36,-44],[-10,-41],[-77,-78],[-39,-58],[-33,-71],[-11,-86],[12,-84],[24,-103],[31,-85],[0,-52],[33,-140],[-2,-82],[-3,-47],[-17,-73],[-21,-16],[-35,15],[-11,53],[-27,28],[-37,104],[-32,92],[-11,47],[15,80],[-20,66],[-55,101],[-27,19],[-71,-55],[-12,6],[-34,56],[-44,30],[-80,-15],[-62,14],[-53,-9],[-29,-19],[12,-32],[-1,-49],[15,-23],[-13,-16],[-26,17],[-27,-22],[-50,3],[-53,64],[-61,-15],[-51,28],[-44,-8],[-59,-29],[-63,-89],[-70,-52],[-38,-58],[-16,-54],[-1,-83],[3,-58],[14,-41],[-28,-4]],[[5782,9828],[-49,27],[-55,37],[-20,57],[-15,84],[-42,69],[-24,71],[-35,82],[-49,48],[-58,-2],[-44,-95],[-58,36],[-36,36],[-18,67],[-23,63],[-42,53],[-36,38],[-25,43],[-122,0],[0,-50],[-55,0],[-140,-1],[-160,85],[-106,59],[7,23],[-89,-13],[-80,-9]],[[4408,10636],[-12,62],[-45,69],[-33,14],[-7,35],[-40,6],[-25,33],[-65,12],[-18,19],[-8,66],[-68,122],[-59,167],[3,28],[-31,40],[-54,101],[-10,99],[-38,65],[16,100],[-3,104],[-22,92],[27,114],[9,110],[8,109],[-12,162],[-22,103],[-21,56],[9,24],[101,-41],[37,-114],[18,32],[-11,99],[-24,99]],[[1725,9133],[12,-10],[11,-17],[18,-42],[-1,-7],[-28,-25],[-22,-19],[-10,-20],[-18,17],[2,34],[-11,44],[3,13],[12,20],[-5,23],[4,12],[6,-3],[27,-20]],[[1683,9216],[-6,-15],[-23,-8],[-12,25],[-8,10],[-1,7],[7,11],[25,-12],[18,-18]],[[1630,9265],[-3,-13],[-37,4],[5,15],[35,-6]],[[1541,9331],[6,-8],[20,-40],[-4,-7],[-5,2],[-24,4],[-9,27],[-3,5],[19,17]],[[1447,9391],[1,-28],[-8,-12],[-24,22],[4,8],[11,12],[16,-2]],[[949,13996],[55,-11],[7,-46],[-43,-19],[-46,23],[-42,33],[69,20]],[[1877,13705],[47,-8],[29,-38],[-60,-57],[-70,-46],[-36,31],[-11,57],[64,42],[37,19]],[[3468,13323],[0,0],[-38,45],[-62,39],[-20,105],[-90,98],[-38,113],[-68,8],[-111,3],[-82,35],[-145,125],[-67,23],[-123,43],[-97,-10],[-138,55],[-83,52],[-78,-26],[14,-84],[-38,-7],[-82,-26],[-61,-40],[-78,-26],[-10,71],[32,119],[74,37],[-19,30],[-90,-67],[-47,-81],[-101,-85],[51,-59],[-66,-87],[-76,-50],[-70,-37],[-17,-53],[-110,-63],[-22,-56],[-82,-52],[-48,9],[-65,-33],[-72,-41],[-58,-41],[-120,-34],[-11,20],[76,56],[69,38],[75,66],[87,13],[34,50],[98,72],[15,24],[52,43],[12,91],[36,71],[-81,-36],[-23,21],[-38,-44],[-46,61],[-18,-43],[-27,60],[-70,-48],[-43,0],[-6,71],[13,45],[-45,43],[-91,-23],[-60,56],[-48,29],[0,69],[-54,51],[27,69],[57,68],[25,62],[57,8],[48,-19],[57,58],[51,-10],[53,37],[-13,55],[-39,22],[52,47],[-43,-2],[-75,-26],[-21,-27],[-55,27],[-100,-13],[-102,28],[-30,49],[-88,70],[98,51],[157,58],[57,0],[-9,-60],[148,5],[-57,75],[-87,46],[-49,60],[-68,51],[-96,39],[39,63],[125,4],[88,55],[17,58],[71,58],[69,14],[133,53],[64,-8],[108,64],[106,-25],[51,-54],[31,23],[118,-7],[-4,-28],[108,-21],[71,13],[148,-39],[135,-11],[54,-16],[93,20],[106,-36],[76,-17],[0,0]],[[580,14406],[43,-23],[44,13],[56,-32],[70,-16],[-6,-13],[-53,-26],[-53,26],[-27,22],[-62,-7],[-16,11],[4,45]],[[18746,12649],[-54,-81],[-58,-11],[-3,-121],[-39,-55],[-139,40],[-51,-216],[-36,-27],[-139,-48],[63,-210],[-48,-31],[6,-69]],[[18248,11820],[-43,18],[-36,43],[-104,13],[-116,3],[-25,-13],[-100,51],[-40,-25],[-11,-72],[-115,42],[-46,-17],[-16,-53]],[[17596,11810],[-40,-22],[-93,-84],[-30,-87],[-27,0],[-19,57],[-89,4],[-14,99],[-34,0],[5,121],[-84,89],[-120,-10],[-83,-17],[-66,108],[-58,46],[-109,86],[-13,11],[-180,-71],[3,-445]],[[16545,11695],[-36,-6],[-49,94],[-48,34],[-79,-25],[-31,-40]],[[16302,11752],[-4,29],[17,51],[-13,42],[-82,41],[-31,108],[-39,31],[-2,39],[68,-12],[3,89],[59,19],[61,-18],[13,118],[-12,75],[-71,-6],[-59,29],[-81,-53],[-66,-25]],[[16063,12309],[-35,19],[7,62],[-45,81],[-52,-3],[-60,82],[41,91],[-21,25],[56,132],[72,-70],[9,88],[145,132],[109,3],[155,-84],[83,-49],[74,51],[112,3],[89,-63],[21,36],[98,-5],[18,57],[-114,83],[67,59],[-13,33],[68,31],[-51,83],[32,41],[262,42],[35,30],[175,44],[63,50],[126,-26],[22,-125],[73,29],[90,-41],[-5,-66],[67,7],[176,114],[-26,-38],[89,-93],[157,-306],[37,63],[97,-70],[101,31],[39,-21],[33,-70],[49,-24],[30,-51],[90,16],[38,-73]],[[17596,11810],[21,-12],[-59,-78],[52,-45],[50,30],[83,-64],[-90,-87],[-53,12]],[[17600,11566],[-29,-3],[-10,34],[14,56],[-94,-28],[-22,-78],[-33,-67],[-59,6],[-18,-53],[52,-29],[15,-90],[-40,-122]],[[17376,11192],[-53,26],[-39,0]],[[17284,11218],[2,74],[-93,52],[-73,59],[-46,57],[-80,83],[-35,125],[-23,22],[-76,-6],[-27,25],[-7,96],[-95,64],[-59,-70],[-60,-42],[12,-61],[-79,-1]],[[22507,6396],[121,-83],[130,-69],[48,-62],[39,-60],[11,-71],[117,-75],[17,-64],[-65,-13],[16,-80],[62,-79],[46,-128],[40,4],[-3,-54],[54,-20],[-21,-23],[75,-51],[-8,-35],[-46,-8],[-18,31],[-60,14],[-71,18],[-54,77],[-40,66],[-36,106],[-92,53],[-59,-35],[-43,-40],[9,-89],[-55,-41],[-40,20],[-72,5]],[[22509,5610],[-1,393],[-1,393]],[[23323,6269],[26,-39],[9,-63],[-22,-32],[-13,71],[-17,47],[-31,39],[-40,52],[-51,35],[19,30],[38,-34],[24,-27],[30,-29],[28,-50]],[[23229,6005],[-39,-29],[-36,-28],[-37,0],[-57,35],[-40,34],[6,37],[62,-18],[39,10],[10,58],[10,3],[7,-64],[40,9],[20,41],[39,43],[-8,71],[42,3],[15,-20],[-2,-67],[-23,-74],[-37,-10],[-11,-34]],[[23471,6066],[22,-27],[34,-77],[33,-41],[-10,-34],[-20,-12],[-30,47],[-31,76],[-15,92],[10,12],[7,-36]],[[22509,5610],[-63,99],[-71,24],[-17,-34],[-89,-4],[30,98],[44,34],[-18,131],[-34,101],[-136,103],[-58,10],[-105,111],[-21,-58],[-26,-11],[-16,44],[-1,53],[-53,59],[75,43],[50,-2],[-6,32],[-102,0],[-28,72],[-63,22],[-29,60],[94,29],[36,40],[113,-50],[11,-45],[19,-195],[73,-72],[59,128],[80,73],[62,0],[60,-42],[52,-43],[76,-24]],[[21383,5637],[7,-24],[1,-36]],[[21391,5577],[-46,-90],[-60,-27],[-8,15],[6,41],[30,73],[70,48]],[[22030,5878],[-6,91],[12,43],[15,41],[16,-35],[0,-58],[-37,-82]],[[20886,7209],[-40,-109],[51,-114],[-12,-55],[79,-112],[-83,-14],[-24,-82],[3,-110],[-67,-82],[-2,-120],[-27,-185],[-10,43],[-80,-54],[-28,73],[-50,7],[-35,39],[-83,-43],[-26,58],[-45,-7],[-58,14],[-11,162],[-35,34],[-34,103],[-9,105],[8,112],[41,80]],[[20309,6952],[12,-80],[48,-68],[45,24],[45,-9],[41,61],[34,11],[66,-34],[57,26],[36,168],[27,42],[24,137],[81,0],[61,-21]],[[21691,6372],[77,-35],[26,-92],[-59,49],[-59,10],[-40,-7],[-48,4],[17,66],[86,5]],[[21516,6253],[-48,22],[-14,52],[71,6],[17,-40],[-26,-40]],[[21590,6973],[5,-66],[42,-11],[6,-49],[-3,-106],[-36,12],[-11,-73],[29,-64],[-20,-14],[-28,76],[-21,154],[14,97],[23,44]],[[21239,6816],[81,5],[69,88],[13,-27],[-57,-120],[-52,-23],[-68,23],[-117,-6],[-61,-17],[-10,-91],[63,-108],[38,55],[130,41],[-5,-56],[-31,18],[-30,-71],[-62,-47],[66,-154],[-13,-42],[63,-139],[0,-79],[-38,-36],[-27,43],[34,99],[-69,-47],[-17,33],[9,47],[-51,71],[5,117],[-46,-37],[6,-140],[2,-173],[-44,-17],[-30,35],[20,111],[-11,117],[-29,0],[-22,83],[29,79],[10,96],[35,182],[15,50],[59,89],[55,-35],[88,-17]],[[21055,5472],[-93,85],[65,24],[37,-37],[25,-37],[-5,-32],[-29,-3]],[[21128,5680],[47,9],[63,45],[-11,-67],[-105,-35],[-93,15],[0,44],[55,25],[44,-36]],[[20912,5701],[44,10],[17,-51],[-81,-24],[-49,-17],[-37,1],[24,70],[38,1],[19,42],[25,-32]],[[20227,5935],[10,-43],[134,-12],[15,50],[130,-58],[26,-78],[105,-22],[86,-72],[-80,-46],[-77,49],[-64,-3],[-72,8],[-66,22],[-81,46],[-52,12],[-29,-15],[-128,50],[-12,52],[-64,9],[48,115],[85,-7],[57,-47],[29,-10]],[[19938,6579],[12,-84],[25,-67],[51,-11],[34,-76],[-17,-150],[-3,-187],[-78,-2],[-59,100],[-90,99],[-30,73],[-53,98],[-35,91],[-53,169],[-62,100],[-20,104],[-26,94],[-63,76],[-37,103],[-53,68],[-73,133],[-6,61],[45,-4],[109,-24],[62,-118],[54,-82],[38,-50],[67,-129],[71,-2],[59,-83],[41,-101],[53,-55],[-28,-99],[40,-42],[25,-3]],[[7808,359],[27,-56],[35,-90],[91,-73],[99,-30],[-32,-60],[-67,-6],[-35,42]],[[7926,86],[-43,4],[-75,0],[0,269]],[[8580,3064],[-17,-96],[-19,-124],[1,-121],[-16,-26],[-5,-78]],[[8524,2619],[-5,-63],[89,-104],[-9,-83],[43,-52],[-3,-59],[-68,-155],[-103,-65],[-141,-25],[-77,12],[15,-72],[-15,-90],[13,-61],[-42,-42],[-72,-17],[-67,44],[-27,-32],[10,-120],[47,-36],[38,38],[21,-63],[-64,-37],[-57,-75],[-10,-121],[-17,-65],[-66,0],[-55,-62],[-20,-91],[69,-88],[67,-24],[-24,-109],[-83,-68],[-45,-141],[-64,-48],[-29,-56],[23,-126],[46,-69],[-29,6]],[[7813,400],[-65,19],[-170,16],[-29,70],[2,90],[-47,-7],[-25,43],[-6,128],[54,53],[22,77],[-8,61],[37,103],[26,160],[-8,71],[31,22],[-8,46],[-32,24],[23,51],[-32,45],[-16,140],[28,24],[-12,147],[17,124],[18,108],[42,43],[-21,118],[0,111],[53,79],[-2,101],[40,117],[1,111],[-19,22],[-32,209],[43,124],[-6,117],[25,109],[46,113],[49,76],[-21,47],[15,39],[-3,201],[77,59],[24,126],[-9,30]],[[7915,3967],[59,109],[92,-29],[41,-88],[27,97],[80,-5],[11,-25]],[[8225,4026],[129,-197],[58,-19],[85,-89],[73,-47],[10,-53],[-69,-184],[70,-32],[79,-19],[55,20],[64,92],[12,106]],[[8791,3604],[34,24],[35,-70],[-1,-96],[-59,-67],[-47,-49],[-79,-117],[-94,-165]],[[7926,86],[-24,-49],[-60,-37],[-34,4],[-42,10],[-51,36],[-73,17],[-88,68],[-72,65],[-96,135],[57,-26],[99,-80],[93,-43],[36,55],[23,82],[64,50],[50,-14]],[[7741,4589],[35,-82],[9,-87],[37,-51],[-22,-117],[37,-135],[28,-167],[50,17]],[[7813,400],[-63,1],[-33,-30],[-64,-44],[-11,-112],[-30,-3],[-79,39],[-80,84],[0,0],[-87,69],[-22,77],[20,70],[-36,80],[-9,206],[30,116],[74,93],[-106,36],[67,106],[23,201],[78,-43],[37,250],[-47,32],[-22,-150],[-44,17],[22,172],[24,224],[32,82],[-20,118],[-6,136],[29,4],[44,195],[48,193],[30,180],[-16,180],[20,100],[-8,149],[41,147],[13,234],[22,250],[22,270],[-5,197],[-15,170]],[[7686,4496],[36,31],[19,62]],[[14776,5704],[-28,12],[-94,-20],[-19,-15],[-20,-77],[16,-53],[-13,-143],[-8,-121],[19,-21],[49,-47],[19,22],[6,-130],[-54,1],[-29,66],[-25,51],[-54,17],[-16,63],[-43,-38],[-56,17],[-23,55],[-45,11],[-33,-3],[-4,38],[-24,3]],[[14297,5392],[-32,7],[-43,-18],[-31,3],[-17,-11],[4,143],[-24,45],[-5,74],[10,73],[-14,47],[-1,75],[-85,-1],[6,44],[-36,-1],[-4,-20],[-43,-5],[-18,-70],[-10,-31],[-39,17],[-23,-17],[-46,-9],[-27,63],[-16,39],[-20,72],[-18,90],[-207,2],[-24,-15],[-21,2],[-29,-16]],[[13484,5974],[-9,38]],[[13475,6012],[17,12],[3,53],[11,31],[26,25]],[[13532,6133],[18,-12],[24,46],[38,-1],[5,-34],[26,-21],[41,75],[41,59],[18,39],[-3,99],[31,117],[32,62],[46,58],[8,39],[2,44],[11,42],[-3,68],[8,107],[14,76],[21,64],[4,73]],[[13914,7133],[7,84],[27,61],[37,39],[58,-41],[45,-44],[51,-12],[52,-24],[21,73],[10,10],[32,-13],[78,61],[28,-26],[22,4],[11,29],[26,10],[53,-12],[45,-3],[23,13]],[[14540,7342],[42,-100],[32,-14],[19,20],[32,-8],[39,25],[17,-51],[61,-80]],[[14782,7134],[0,0],[-4,-141],[28,-17],[-22,-43],[-27,-32],[-27,-63],[-15,-56],[-4,-97],[-16,-46],[-1,-91]],[[14694,6548],[-20,-33],[-2,-72],[-10,-9],[-6,-66]],[[14656,6368],[17,-55],[5,-146]],[[15536,6507],[-41,100],[-1,439],[61,137]],[[15555,7183],[19,38],[45,2],[63,85],[91,6],[198,362]],[[15971,7676],[49,101],[32,74],[0,63],[0,121],[0,50],[0,2],[0,0]],[[16052,8087],[23,2],[32,18],[37,13],[34,41],[26,0],[2,-33],[-7,-70],[0,-64],[-14,-43],[-20,-131],[-34,-135],[-43,-154],[-60,-177],[-60,-135],[-83,-164],[-70,-98],[-105,-120],[-65,-92],[-77,-146],[-16,-63],[-16,-29]],[[14998,6596],[-1,127],[20,49],[34,80],[26,88],[-31,139],[-8,60],[-33,84]],[[15005,7223],[43,72],[47,80]],[[15095,7375],[37,-21],[0,-67],[24,-40],[49,0],[88,-103],[22,-1],[17,4],[15,-14],[47,-10],[21,50],[64,51],[28,-41],[48,0]],[[15536,6507],[-49,-48],[-17,-50],[-27,-9],[-9,-85],[-23,-49],[-14,-80],[-28,-40]],[[14343,7703],[-53,53],[-25,35],[-4,37],[11,50],[0,50],[-40,75],[-8,52]],[[14224,8055],[0,29],[-25,35],[-1,71],[-15,46],[-24,-7],[7,44],[18,51],[-8,50],[23,37],[-15,28],[19,74],[32,89],[60,-8],[-3,479]],[[14292,9073],[1,50],[80,1],[0,241]],[[14373,9365],[282,0],[272,0],[278,0]],[[15205,9365],[23,-119],[-15,-21],[10,-125],[25,-144],[27,-29],[39,-45]],[[15314,8882],[-36,-69],[-52,-20],[-22,-37],[-7,-80],[-30,-177],[8,-49]],[[15175,8450],[-11,-103],[-29,-119],[-42,-60],[-30,-92],[-7,-49],[-34,-34],[-20,-126],[1,-109]],[[15003,7758],[-1,94],[-10,3],[1,60],[-8,41],[-36,48],[-9,87],[9,89],[-33,8],[-5,-27],[-42,-6],[17,-35],[6,-73],[-38,-66],[-35,-87],[-36,-12],[-59,70],[-27,-25],[-7,-35],[-36,-23],[-3,-25],[-69,0],[-10,25],[-51,4],[-25,-20],[-19,10],[-36,70],[-12,33],[-51,-16],[-19,-56],[-18,-108],[-24,-23],[-22,-13],[48,-47]],[[14224,8055],[-45,-21],[-35,-49],[-51,-131],[-66,-56],[-68,7],[-20,-11],[7,-42],[-36,-43],[-30,-47],[-88,-46],[-18,28],[-11,2],[-13,-31],[-58,-9]],[[13692,7606],[11,32],[-22,84],[-10,50],[-31,20],[-41,70],[15,57],[32,-12],[20,9],[39,-1],[-38,109],[2,81],[-4,80],[-28,77]],[[13637,8262],[7,57],[-45,2],[0,78],[-29,45],[30,159],[90,114],[3,156],[27,245],[16,52],[-30,42],[-1,38],[-26,31],[-17,188]],[[13662,9469],[71,66],[279,-231],[280,-231]],[[7592,9089],[7,-66],[-6,-46],[-17,-20],[18,-37],[-1,-32]],[[7593,8888],[-47,20],[-33,-8],[-43,8],[-32,-22],[-38,37],[6,39],[65,-16],[53,-10],[25,27],[-32,52],[0,46],[-44,19],[16,33],[43,-5],[60,-19]],[[7592,9089],[9,21],[55,-1],[41,-31],[19,3],[13,-43],[38,3],[-2,-36],[31,-5],[34,-44],[-26,-49],[-33,26],[-32,-5],[-23,6],[-13,-22],[-27,-8],[-10,30],[-24,-18],[-28,-82],[-18,19],[-3,35]],[[25152,15289],[89,50],[0,-82],[-77,-6],[-12,38]],[[16063,12309],[-32,-72],[-68,-20],[-69,-124],[63,-115],[-7,-81],[77,-142],[0,0]],[[16027,11755],[-42,-49],[-12,-30],[-31,8],[-48,73],[-20,4]],[[15874,11761],[-44,28],[-21,50],[-66,25],[-42,-19],[-13,22],[-95,58],[-103,20],[-60,20],[-8,-14]],[[15422,11951],[-89,102],[-80,46],[-61,71],[51,19],[58,101],[-39,47],[103,50],[-2,26],[-62,-19]],[[15301,12394],[2,53],[36,34],[68,9],[11,40],[-16,67],[29,63],[-1,35],[-103,39],[-41,-1],[-44,57],[-53,-19],[-90,42],[2,24],[-25,52],[-56,6],[-6,37],[18,25],[-45,68],[-73,-12],[-21,6],[-18,-27],[-26,5]],[[14849,12997],[0,0],[-17,77],[-17,40],[14,12],[56,-5],[28,27],[-20,32],[-48,21],[5,22],[-29,22],[-44,79],[15,32],[-7,57],[-68,29],[-37,-15],[-10,30],[-74,31]],[[14596,13488],[-22,71],[-6,58],[-34,28]],[[14534,13645],[30,39],[-21,112],[50,70],[-11,21],[0,0]],[[14582,13887],[80,66],[-73,58]],[[14589,14011],[0,0],[150,154],[65,69],[26,62],[-104,83],[29,78],[-63,90],[47,103],[-81,138],[64,91],[-107,80],[10,85]],[[14625,15044],[57,11],[119,48]],[[14801,15103],[0,0],[72,42],[116,-73],[192,-28],[265,-137],[53,-57],[5,-81],[-78,-63],[-114,-32],[-313,92],[-52,-16],[114,-88],[5,-56],[5,-123],[90,-37],[55,-32],[9,59],[-43,52],[45,46],[170,-76],[59,30],[-48,88],[164,118],[65,-7],[65,-42],[41,83],[-59,72],[35,72],[-52,75],[196,-39],[40,-67],[-88,-15],[0,-67],[55,-42],[109,27],[17,77],[146,57],[245,104],[53,-6],[-69,-73],[87,-13],[50,41],[131,3],[104,51],[80,-73],[80,80],[-74,70],[37,39],[207,-36],[97,-38],[254,-138],[47,64],[-71,63],[-2,26],[-85,12],[23,57],[-37,94],[-2,39],[129,109],[46,110],[52,23],[186,-31],[15,-68],[-67,-97],[44,-39],[22,-84],[-16,-166],[78,-74],[-30,-80],[-138,-171],[80,-18],[28,43],[77,31],[19,60],[61,57],[-41,69],[33,80],[-77,10],[-17,67],[56,121],[-91,98],[125,82],[-16,85],[35,3],[37,-67],[-28,-116],[75,-22],[-32,87],[118,47],[145,7],[130,-69],[-63,100],[-7,129],[122,24],[169,-5],[152,16],[-57,63],[81,79],[81,3],[136,60],[185,16],[24,33],[184,11],[57,-27],[157,64],[129,-2],[19,53],[67,51],[166,49],[120,-39],[-95,-29],[159,-19],[19,-60],[64,30],[205,-2],[158,-59],[56,-45],[-18,-63],[-77,-35],[-184,-67],[-53,-36],[87,-17],[104,-30],[63,22],[36,-77],[30,31],[112,19],[225,-20],[17,-56],[294,-18],[4,92],[148,-21],[112,1],[114,-64],[32,-77],[-42,-51],[88,-94],[111,-49],[67,126],[113,-54],[119,32],[136,-37],[52,34],[114,-17],[-50,112],[92,52],[634,-78],[59,-72],[184,-92],[283,23],[139,-20],[59,-50],[-9,-88],[87,-34],[94,24],[124,4],[132,-24],[133,13],[122,-107],[87,39],[-57,77],[32,53],[223,-33],[146,7],[202,-58],[98,-52],[0,-481],[-1,-1],[-90,-53],[-91,9],[64,-64],[41,-100],[33,-32],[8,-50],[-18,-32],[-131,26],[-196,-91],[-62,-14],[-107,-84],[-102,-75],[-26,-54],[-100,83],[-183,-95],[-32,45],[-67,-51],[-94,16],[-23,-79],[-84,-117],[3,-49],[80,-27],[-10,-175],[-65,-5],[-30,-101],[29,-52],[-122,-61],[-25,-138],[-104,-30],[-21,-122],[-101,-113],[-26,83],[-30,176],[-39,269],[33,167],[59,72],[4,56],[109,27],[125,152],[121,124],[126,97],[56,170],[-85,-10],[-42,-100],[-178,-132],[-57,148],[-181,-41],[-176,-202],[58,-74],[-156,-32],[-109,-12],[5,87],[-109,18],[-86,-59],[-215,21],[-230,-36],[-228,-235],[-268,-285],[110,-15],[35,-76],[68,-27],[45,61],[77,-8],[101,-133],[2,-103],[-55,-120],[-6,-144],[-31,-193],[-106,-175],[-23,-83],[-96,-141],[-94,-139],[-45,-71],[-94,-71],[-44,-2],[-44,59],[-94,-88],[-11,-40]],[[21790,11805],[-10,21],[0,0]],[[21780,11826],[0,61],[36,3],[10,143],[-19,103],[60,43],[85,-22],[48,118],[24,132],[27,44],[37,109],[-116,-36],[-61,-47],[-106,0],[-29,113],[-83,86],[-122,38],[-26,119],[-24,74],[-27,52],[-43,121],[-61,45],[-105,36],[-93,-4],[-88,-21],[-57,-60],[38,-29],[1,-67],[-39,-38],[-63,-128],[0,-53],[-99,-77],[-84,46]],[[20801,12730],[-83,-10],[-37,40],[-42,13],[-103,-85],[-92,-20],[-65,-30],[-88,20],[-65,-1],[-42,61],[-69,58],[-70,16],[-89,-15],[-66,-23],[-100,51],[-13,90],[-83,31],[-63,14],[-79,50],[-73,-125],[29,-71],[-68,-84],[-102,31],[-70,4],[-46,56],[-74,2],[-61,37],[-106,-57],[-134,-104],[-74,-20]],[[18773,12659],[-27,-10]],[[19196,16487],[151,27],[137,-61],[161,-116],[-17,-109],[-153,-15],[-196,35],[-116,46],[-54,87],[-95,23],[182,83]],[[19831,16276],[178,-68],[-21,-49],[-396,-47],[129,159],[57,13],[53,-8]],[[22354,15897],[186,-5],[253,-64],[-55,-90],[-259,3],[-116,-28],[-139,78],[38,83],[92,23]],[[23013,15802],[176,-32],[-81,-48],[-112,11],[-131,48],[17,39],[131,-18]],[[22427,15563],[66,48],[88,11],[100,-46],[8,-32],[-106,-1],[-144,14],[-12,6]],[[15765,16434],[137,22],[106,2],[15,-33],[40,29],[66,20],[104,-26],[-27,-19],[-94,-16],[-63,-9],[-10,-20],[-82,-20],[-76,29],[40,38],[-156,3]],[[14214,13265],[-129,-1],[-86,13]],[[13999,13277],[16,53],[97,40]],[[14112,13370],[73,-22],[31,-19],[-7,-33],[5,-31]],[[16372,15609],[168,106],[-19,55],[157,63],[231,78],[234,23],[120,44],[136,16],[49,-48],[-47,-37],[-249,-60],[-214,-58],[-217,-115],[-105,-117],[-110,-116],[14,-101],[135,-99],[-42,-10],[-229,16],[-19,53],[-126,33],[-11,65],[72,26],[-2,65],[139,103],[-65,15]],[[22641,13190],[24,-116],[-2,-119],[29,-121],[71,-214],[-104,40],[-43,-175],[68,-123],[-2,-85],[-53,73],[-46,-93],[-13,101],[8,117],[-8,131],[16,91],[3,161],[-41,119],[6,165],[65,55],[-28,56],[32,17],[18,-80]],[[356,14819],[-6,-75],[47,-30],[-16,88],[190,-18],[137,-113],[-69,-52],[-115,-13],[-2,-118],[-28,-25],[-66,4],[-53,42],[-93,35],[-16,52],[-71,20],[-80,-16],[-38,43],[15,44],[-84,-28],[32,-57],[-40,-51],[0,481],[172,-93],[184,-120]],[[92,15264],[-92,-7],[0,82],[9,5],[59,0],[102,-34],[-6,-17],[-72,-29]],[[14965,12257],[18,30],[50,-26],[23,-4],[9,-24],[10,-4]],[[15075,12229],[1,-10],[34,-30],[72,8],[-14,-43],[-77,-21],[-95,-70],[-39,25],[16,56],[-77,36],[12,23],[67,40],[-10,14]],[[7083,9943],[33,9],[46,-3],[2,-32],[-76,-19],[-5,45]],[[7166,9973],[56,-54],[-12,-86],[-13,15],[1,63],[-32,48],[0,14]],[[7138,9752],[21,-5],[25,-100],[0,-70],[-17,-6],[-18,70],[-26,35],[15,76]],[[8330,454],[84,72],[59,-30],[42,48],[56,-54],[-21,-42],[-94,-36],[-32,42],[-59,-54],[-35,54]],[[13682,16324],[27,41],[103,4],[88,-42],[231,-90],[-176,-47],[-39,-89],[-62,-23],[-33,-100],[-85,-5],[-151,74],[64,43],[-105,35],[-137,102],[-54,94],[191,43],[38,-42],[100,2]],[[14625,15044],[30,84],[-90,48],[-109,-41],[-34,-88],[-67,-53],[-75,29],[-92,-6],[-78,64],[-42,-32]],[[14068,15049],[-43,-5],[-11,-80],[-132,20],[-18,-67],[-68,0],[-46,-86],[-70,-134],[-109,-169],[25,-42],[-24,-47],[-69,2],[-46,-114],[4,-160],[45,-61],[-23,-142],[-58,-83],[-31,-69]],[[13394,13812],[-47,74],[-139,-140],[-93,-28],[-97,62],[-25,129],[-22,279],[64,77],[185,102],[139,124],[128,168],[168,233],[118,91],[193,152],[153,52],[116,-6],[107,100],[127,-5],[126,24],[220,-89],[-91,-32],[77,-76]],[[14542,16370],[-104,-65],[-203,-14],[-207,20],[-12,33],[-101,2],[-77,56],[217,33],[102,-29],[70,36],[178,-30],[137,-42]],[[14354,16104],[-157,-49],[-123,28],[48,31],[-42,39],[145,24],[28,-46],[101,-27]],[[9342,16680],[235,72],[246,-5],[90,44],[247,12],[560,-15],[439,-96],[-130,-46],[-268,-6],[-377,-11],[35,-22],[248,13],[212,-41],[136,37],[58,-44],[-77,-70],[178,45],[341,47],[210,-23],[40,-52],[-286,-86],[-40,-28],[-224,-20],[162,-6],[-82,-88],[-56,-79],[2,-134],[84,-79],[-109,-5],[-116,-38],[130,-64],[16,-102],[-75,-11],[91,-104],[-156,-9],[82,-49],[-23,-42],[-99,-19],[-98,0],[88,-82],[1,-54],[-139,50],[-36,-32],[95,-30],[92,-74],[26,-97],[-125,-24],[-54,47],[-86,69],[24,-82],[-82,-63],[185,-5],[97,-7],[-188,-105],[-191,-95],[-205,-42],[-77,0],[-73,-47],[-98,-127],[-150,-85],[-49,-5],[-93,-29],[-101,-28],[-60,-75],[-1,-85],[-35,-79],[-115,-96],[29,-95],[-32,-99],[-36,-118],[-99,-8],[-103,99],[-140,1],[-68,66],[-47,118],[-122,150],[-35,78],[-10,109],[-97,111],[25,89],[-46,42],[69,141],[105,45],[28,51],[15,94],[-80,-43],[-39,-18],[-63,-17],[-86,39],[-4,82],[27,65],[65,1],[143,-32],[-120,77],[-63,41],[-70,-17],[-58,30],[78,113],[-43,45],[-55,83],[-85,128],[-89,47],[1,50],[-188,71],[-149,9],[-188,-5],[-171,-9],[-81,38],[-122,76],[184,38],[141,7],[-300,31],[-158,49],[10,47],[265,58],[257,58],[27,44],[-189,43],[61,48],[243,85],[102,13],[-29,54],[166,32],[215,19],[216,1],[76,-38],[186,66],[168,-45],[98,-9],[146,-39],[-167,65],[10,51]],[[17454,843],[45,-38],[66,-15],[3,-23],[-20,-55],[-108,-8],[-1,65],[10,49],[5,25]],[[21383,5637],[8,29],[60,27],[49,4],[22,15],[27,-15],[-26,-33],[-73,-53],[-59,-34]],[[13767,3262],[33,60],[28,-33],[12,-52],[31,-9],[44,-22],[38,8],[62,62],[0,446]],[[14015,3722],[19,-18],[42,-115],[-6,-74],[15,-42],[50,12],[35,54],[34,36],[17,58],[34,28],[30,-14],[33,-34],[57,-6],[45,28],[7,38],[12,57],[39,10],[21,45],[23,81],[63,90],[99,89]],[[14684,4045],[29,-2],[34,-20],[23,14],[37,-12]],[[14807,4025],[34,-170],[18,-85],[-12,-135],[6,-43]],[[14853,3592],[-36,22],[-20,-9],[-6,-35],[-20,-45],[1,-42],[42,-65],[41,13],[14,53]],[[14869,3484],[53,-1]],[[14922,3483],[-17,-87],[-8,-101],[-19,-54],[-47,-61],[-14,-17],[-30,-62],[-19,-62],[-40,-86],[-79,-125],[-50,-72],[-53,-55],[-73,-47],[-36,-6],[-9,-34],[-43,18],[-34,-23],[-76,24],[-43,-15],[-29,6],[-72,-48],[-60,-19],[-43,-45],[-32,-3],[-30,43],[-23,2],[-31,54],[-3,-17],[-9,33],[0,70],[-23,81],[23,22],[-2,93],[-46,113],[-35,102],[0,0],[-50,157]],[[14652,3216],[-30,38],[-33,-25],[-38,-47],[-37,-77],[52,-92],[25,12],[13,38],[39,19],[12,39],[22,59],[-25,36]],[[5782,9828],[28,4],[-28,-106],[-12,-87],[-5,-162],[-7,-59],[12,-65],[22,-59],[14,-94],[47,-90],[16,-69],[28,-59],[74,-32],[29,-50],[61,33],[54,12],[52,22],[45,21],[44,49],[17,70],[6,102],[12,35],[47,32],[74,28],[62,-5],[43,11],[17,-26],[-3,-58],[-37,-72],[-17,-73],[13,-21],[-11,-52],[-17,-95],[-18,31],[-15,-2]],[[6429,8942],[-13,-1],[-25,-73],[-13,14],[-8,-5],[0,-18]],[[6370,8859],[-65,1],[-65,0],[0,-68],[-32,0],[26,-40],[26,-28],[8,-26],[11,-8],[-1,-41],[-90,0],[-34,-99],[10,-22],[-8,-28],[-2,-35]],[[6154,8465],[-79,129],[-36,40],[-58,31],[-39,-9],[-56,-45],[-36,-12],[-49,32],[-53,23],[-65,55],[-53,17],[-79,56],[-59,58],[-17,32],[-40,7],[-71,38],[-30,55],[-75,69],[-35,76],[-17,59],[24,12],[-8,34],[17,31],[0,42],[-24,54],[-6,48],[-24,61],[-61,120],[-71,94],[-34,76],[-60,49],[-13,29],[11,75],[-36,28],[-41,59],[-18,84],[-38,10],[-40,63],[-33,59],[-3,38],[-38,91],[-25,92],[1,46],[-51,48],[-23,-5],[-40,33],[-11,-49],[11,-58],[7,-90],[24,-50],[52,-83],[12,-29],[11,-8],[9,-42],[12,2],[14,-78],[22,-30],[15,-43],[44,-62],[23,-112],[21,-53],[19,-56],[4,-64],[34,-4],[28,-55],[25,-54],[-1,-21],[-30,-44],[-12,0],[-19,73],[-46,69],[-50,59],[-36,30],[2,88],[-10,66],[-34,37],[-48,54],[-9,-15],[-18,31],[-43,29],[-41,70],[5,9],[29,-6],[26,45],[2,54],[-54,86],[-41,34],[-26,75],[-26,79],[-32,96],[-29,109]],[[8580,3064],[46,13],[70,-93],[26,3],[72,-77],[55,-67],[41,-82],[-31,-57],[19,-68]],[[8878,2636],[-30,-76],[-79,-67],[-52,24],[-38,-13],[-65,52],[-47,-4],[-43,67]],[[8791,3604],[13,70],[10,71],[0,67],[-25,22],[-27,-20],[-26,6],[-8,46],[-7,111],[-13,36],[-47,32],[-29,-23],[-74,23],[5,164],[-21,67]],[[8542,4276],[22,25],[-7,68],[20,53],[12,95],[-16,75],[-39,34],[-7,48],[10,69],[-134,5],[-27,141],[20,2],[-1,52],[-14,35],[-3,70],[-40,36],[-44,-1],[-29,35],[-48,24],[-27,45],[-79,20],[-76,108],[6,81],[-9,46],[7,90],[-91,-20],[-37,-45],[-62,-49],[-15,-37],[-36,-2],[-52,10]],[[7746,5389],[-40,-21],[-32,14],[5,183],[-58,-71],[-62,3],[-26,65],[-47,6],[15,52],[-39,74],[-29,108],[18,22],[0,51],[43,35],[-7,65],[18,42],[5,57],[80,82],[57,23],[10,18],[63,-5]],[[7720,6192],[32,330],[1,53],[-11,69],[-31,44],[0,88],[40,19],[14,-12],[2,46],[-41,13],[-1,75],[137,-3],[23,42],[20,-38],[13,-71],[14,14]],[[7932,6861],[38,-63],[55,7],[13,37],[52,29],[29,19],[8,51],[50,35],[-3,25],[-60,11],[-9,76],[2,80],[-31,32],[13,11],[52,-16],[56,-30],[20,29],[50,18],[79,46],[26,46],[-10,34]],[[8362,7338],[37,5],[16,-28],[-9,-53],[24,-18],[16,-56],[-19,-43],[-12,-102],[18,-61],[5,-56],[44,-57],[34,-6],[8,24],[22,5],[32,21],[22,32],[39,-10],[17,4]],[[8656,6939],[38,-9],[7,24],[-12,24],[7,35],[28,-11],[33,13],[41,-26]],[[8798,6989],[30,-25],[22,33],[16,-5],[9,-34],[34,9],[27,45],[21,89],[42,111]],[[8999,7212],[23,5],[18,-66],[39,-211],[38,-20],[2,-84],[-53,-99],[22,-36],[124,-19],[2,-121],[53,79],[89,-43],[116,-74],[34,-71],[-11,-67],[81,38],[137,-64],[104,5],[104,-100],[90,-135],[54,-35],[60,-5],[25,-38],[24,-154],[11,-73],[-27,-199],[-36,-79],[-99,-168],[-45,-136],[-52,-105],[-17,-2],[-20,-89],[5,-226],[-19,-186],[-8,-80],[-22,-47],[-12,-162],[-71,-157],[-12,-125],[-57,-52],[-16,-72],[-77,0],[-110,-46],[-49,-54],[-79,-35],[-82,-96],[-60,-120],[-10,-90],[12,-67],[-13,-122],[-16,-59],[-49,-66],[-78,-212],[-62,-96],[-47,-57],[-32,-114],[-47,-69]],[[8542,4276],[-1,37],[-65,62],[-65,1],[-123,-35],[-33,-106],[-2,-65],[-28,-144]],[[7741,4589],[44,130],[-30,102],[16,40],[-12,45],[27,60],[2,103],[3,85],[15,41],[-60,194]],[[7686,4496],[-70,70],[-6,49],[-139,121],[-126,132],[-54,75],[-29,99],[12,35],[-60,158],[-69,223],[-66,240],[-29,55],[-22,89],[-54,79],[-50,49],[22,54],[-34,115],[22,84],[56,76]],[[6990,6299],[8,-50],[-20,-29],[2,-44],[29,10],[29,-13],[29,-61],[40,49],[13,82],[43,105],[84,47],[77,127],[22,78],[-10,92]],[[7336,6692],[18,11],[47,-57],[22,-57],[33,-31],[41,-126],[52,-15],[39,31],[25,-20],[42,10],[54,-57],[-45,-122],[21,-3],[35,-64]],[[7336,6692],[-30,28],[-35,40],[-20,-19],[-59,17],[-17,52],[-13,-2],[-70,69]],[[7092,6877],[-10,37],[26,9],[-3,61],[17,44],[34,8],[30,75],[27,64],[-26,28],[13,70],[-16,111],[15,32],[-11,102],[-28,64]],[[7160,7582],[9,59],[23,-9],[13,36],[-17,71],[9,17]],[[7197,7756],[36,-3],[53,84],[29,13],[0,40],[13,102],[40,56],[45,2],[5,25],[55,-10],[55,61],[28,27],[34,58],[24,-7],[19,-32],[-14,-41]],[[7619,8131],[-45,-20],[-18,-60],[-27,-35],[-20,-45],[-9,-86],[-19,-70],[36,-9],[9,-55],[15,-27],[6,-48],[-8,-45],[2,-25],[17,-10],[17,-42],[90,11],[41,-15],[49,-104],[29,13],[50,-6],[40,13],[25,-20],[-13,-65],[-15,-41],[-6,-86],[14,-80],[20,-36],[3,-27],[-36,-60],[26,-27],[18,-42],[22,-121]],[[7160,7582],[-23,35],[-15,65],[17,32],[-18,8],[-13,40],[-35,34],[-31,-8],[-14,-42],[-28,-30],[-15,-4],[-7,-26],[33,-65],[-19,-15],[-10,-18],[-33,-7],[-12,73],[-9,-21],[-23,7],[-14,49],[-29,8],[-18,14],[-30,0],[-3,-27],[-8,19]],[[6803,7703],[4,24],[6,24],[-3,22],[11,14],[-15,18],[0,49],[27,10]],[[6833,7864],[25,-43],[-1,-25],[28,-6],[6,10],[19,-30],[35,9],[30,31],[42,24],[24,36],[39,-7],[-3,-12],[39,-4],[32,-21],[23,-36],[26,-34]],[[6803,7703],[-38,26],[-14,26],[8,21],[-2,26],[-20,29],[-27,24],[-24,15],[-5,36],[-18,21],[4,-35],[-14,-29],[-16,34],[-23,12],[-9,24],[0,37],[10,38],[-20,17],[16,23]],[[6611,8048],[10,16],[47,-32],[16,15],[22,-10],[12,-24],[20,-8],[17,25]],[[6755,8030],[18,-65],[27,-49],[33,-52]],[[6611,8048],[-24,38],[-33,49],[-16,41],[-29,37],[-35,55],[8,19],[11,-19],[5,9]],[[6498,8277],[22,5],[9,28],[10,1],[-1,59],[16,3],[15,-1],[15,32],[21,-24],[7,15],[13,14],[24,33],[1,25],[7,-1],[9,29],[7,3],[12,-18],[14,-6],[16,16],[18,0],[24,16],[10,16],[24,-2]],[[6791,8520],[-6,-12],[-4,-27],[7,-44],[-16,-41],[-7,-49],[-3,-53],[4,-31],[2,-54],[-11,-12],[-6,-52],[4,-32],[-14,-30],[3,-33],[11,-20]],[[6498,8277],[-12,38],[-21,10]],[[6465,8325],[5,49],[-10,13],[-14,8],[-31,-14],[-2,16],[-22,19],[-15,25],[-20,10]],[[6356,8451],[14,30],[-5,24],[5,23],[33,34],[32,46]],[[6435,8608],[7,-5],[15,21],[20,2],[7,-10],[11,6],[32,-11],[33,4],[22,13],[9,13],[22,-6],[17,-8],[18,3],[14,10],[32,-16],[11,-3],[22,-23],[20,-27],[25,-18],[19,-33]],[[6465,8325],[-8,-28],[-40,2],[-26,11],[-29,24],[-39,8],[-19,26]],[[6304,8368],[2,17],[24,31],[13,13],[-4,14],[17,8]],[[6370,8859],[0,-96],[-6,-136],[21,0]],[[6385,8627],[23,-22],[6,18],[21,-15]],[[6304,8368],[-36,21],[-44,2],[-32,24],[-38,50]],[[6429,8942],[1,-17],[13,-1],[-1,-33],[-12,-52],[7,-18],[-8,-44],[5,-11],[-8,-61],[-14,-32],[-13,-4],[-14,-42]],[[7619,8131],[-2,-28],[-41,-14],[23,-55],[-1,-63],[-31,-70],[27,-96],[30,8],[16,87],[-22,42],[-4,92],[88,49],[-10,57],[25,38],[25,-85],[49,-2],[45,-67],[3,-40],[63,-1],[75,12],[40,-54],[54,-15],[39,38],[1,30],[87,8],[84,1],[-60,-35],[24,-57],[56,-9],[53,-60],[12,-96],[36,2],[28,-28]],[[8431,7720],[-56,-71],[-6,-44],[24,-45],[-17,-22],[-44,-20],[2,-56],[-19,-33],[47,-91]],[[8431,7720],[46,-45],[43,-78],[2,-62],[26,-3],[38,-59],[28,-42]],[[8614,7431],[-12,-109],[-42,-31],[4,-29],[-13,-62],[31,-87],[22,-1],[9,-68],[43,-105]],[[8614,7431],[84,-24],[7,22],[57,8],[75,-32]],[[8837,7405],[-36,-104],[5,-82],[28,-72],[-12,-52],[-7,-55],[-17,-51]],[[8837,7405],[24,-13],[52,-29],[74,-102],[12,-49]],[[13054,12679],[33,-32],[101,-22],[-35,-83],[-9,-86]],[[13144,12456],[-19,-20],[-32,11],[2,-31],[-51,-68],[-1,-54],[33,19],[24,-53]],[[13100,12260],[-3,-34],[21,-46],[-24,-37],[18,-93],[38,-15],[-8,-53]],[[13142,11982],[-64,-68],[-138,33],[-102,-39],[-8,-73]],[[12830,11835],[-81,-16],[-79,55],[-26,-26],[-129,55],[-28,47]],[[12487,11950],[36,72],[14,240],[-73,127],[-51,61],[-107,47],[-7,88],[90,26],[118,-31],[-22,136],[66,-51],[163,94],[21,99],[62,24]],[[12797,12882],[10,-43],[32,-2],[33,-48],[49,-57],[36,10],[61,-55]],[[13018,12687],[16,-11],[20,3]],[[13234,11854],[45,46],[12,-104],[-23,-93],[-32,25],[-16,81],[14,45]],[[6990,6299],[37,91],[-15,52],[-26,-56],[-42,53],[14,34],[-12,110],[24,18],[13,75],[27,78],[-5,49],[38,26],[49,48]],[[7973,8944],[36,-10],[13,-24],[-18,-31],[-53,1],[-41,-4],[-4,51],[10,18],[57,-1]],[[7182,8941],[47,-10],[37,-29],[12,-34],[-49,-2],[-22,-20],[-39,19],[-40,44],[8,28],[30,8],[16,-4]],[[6852,9508],[61,-8],[55,-2],[66,-41],[28,-44],[65,14],[25,-29],[59,-74],[44,-55],[23,2],[42,-25],[-5,-34],[52,-5],[53,-49],[-9,-28],[-46,-16],[-48,-6],[-48,10],[-100,-12],[47,67],[-29,32],[-45,8],[-24,35],[-17,68],[-39,-4],[-66,32],[-21,25],[-91,19],[-25,23],[27,31],[-69,6],[-51,-63],[-29,-2],[-10,-29],[-34,-13],[-30,11],[37,38],[15,43],[31,27],[36,23],[53,12],[17,13]],[[14684,4045],[-45,54],[-54,19],[-20,76],[-1,43],[-30,13],[-79,132],[-22,70],[-14,22],[-27,96]],[[14392,4570],[78,-13],[23,-14],[24,3],[39,78],[60,99],[26,10],[8,41],[40,49],[53,16]],[[14743,4839],[5,-45],[58,2],[33,-25],[15,-30],[33,-9],[37,-38],[0,-153],[-14,-84],[-3,-90],[11,-36],[-8,-71],[-10,-11],[-19,-87],[-74,-137]],[[14015,3722],[0,352],[70,4],[2,430],[52,4],[108,42],[27,-50],[44,48],[22,0],[39,27]],[[14379,4579],[13,-9]],[[13767,3262],[-53,91],[-27,88],[-16,118],[-17,87],[-23,186],[-2,144],[-9,66],[-27,50],[-36,100],[-37,144],[-15,76],[-58,118],[-4,93]],[[13443,4623],[34,23],[42,20],[45,-4],[42,-54],[11,8],[284,6],[49,-58],[169,-17],[129,49]],[[14248,4596],[58,27],[45,-7],[28,-27],[0,-10]],[[11449,8351],[-29,94],[-35,43],[31,22],[34,85],[16,62]],[[11466,8657],[24,39],[35,-11],[34,27],[39,1],[34,-35],[46,-32],[43,-89],[46,-83]],[[11767,8474],[3,-75],[14,-69],[26,-34],[6,-47],[-3,-37]],[[11813,8212],[-10,-7],[-38,9],[-5,-13],[-16,-3],[-50,30],[-34,1]],[[11660,8229],[-130,5],[-18,-14],[-24,4],[-37,-19]],[[11451,8205],[-11,92]],[[11440,8297],[63,-2],[17,16],[13,1],[26,28],[30,-25],[30,-2],[31,27],[-14,35],[-24,-21],[-21,1],[-28,30],[-22,-2],[-16,-29],[-76,-3]],[[11767,8474],[24,22],[12,71],[22,3],[49,-34],[39,24],[27,-8],[11,27],[281,2],[16,84],[-12,15],[-34,521],[-34,521],[107,2]],[[12275,9724],[237,-264],[236,-263],[17,-56],[44,-35],[32,-20],[1,-76],[78,12]],[[12920,9022],[0,-278],[-38,-81],[-6,-74],[-63,-19],[-95,-11],[-26,-43],[-45,-4]],[[12647,8512],[-45,-1],[-18,23],[-38,-17],[-66,-50],[-13,-38],[-55,-54],[-9,-31],[-29,-24],[-34,16],[-20,-30],[-10,-82],[-56,-100],[2,-41],[-19,-51],[5,-70]],[[12242,7962],[-29,-18],[-17,-16],[-11,52],[-20,-14],[-12,3],[-13,-35],[-54,1],[-19,18],[-10,-11]],[[12057,7942],[-21,35],[4,35],[-9,15],[-15,-12],[3,39],[14,31],[-29,51],[-8,33],[-15,26],[-14,4],[-17,-17],[-23,-17],[-19,-26],[-30,10],[-20,31],[-11,4],[-19,-16],[-11,-1],[-4,45]],[[12012,10016],[263,-292]],[[11466,8657],[-6,65],[20,60],[8,113],[-7,119],[-9,60],[7,61],[-18,57],[-37,52]],[[12809,7465],[-58,-14]],[[12751,7451],[-17,84],[3,277],[-14,25],[-3,59],[-24,42],[-21,36],[9,63]],[[12684,8037],[24,14],[14,53],[34,11],[16,36]],[[12772,8151],[23,35],[25,1],[54,-70]],[[12874,8117],[-3,-40],[16,-72],[-14,-48],[7,-33],[-34,-74],[-21,-37],[-14,-76],[2,-77],[-4,-195]],[[13637,8262],[-20,-7],[-2,-38]],[[13615,8217],[-13,-3],[-48,132],[-16,5],[-55,-68],[-54,36],[-38,7],[-20,-17],[-41,3],[-42,-51],[-35,-3],[-85,62],[-34,-29],[-35,2],[-27,45],[-70,45],[-75,-14],[-18,-26],[-10,-69],[-20,-49],[-5,-108]],[[12772,8151],[1,83],[-81,27],[-2,58],[-39,79],[-10,55],[6,59]],[[12920,9022],[99,53],[203,237],[240,230]],[[13462,9542],[111,-52],[39,-66],[50,45]],[[13615,8217],[28,-49],[-8,-21],[-4,-40],[-59,-94],[-18,-77],[-10,-63],[-15,-26],[-14,-85],[-38,-50],[-11,-61],[-15,-48],[-7,-50],[-48,-41],[-39,50],[-27,-2],[-42,-71],[-20,-1],[-33,-117],[-19,-85]],[[13216,7286],[-72,-43],[-27,6],[-27,-27],[-56,3],[-37,75],[-24,87],[-49,80],[-53,-2],[-62,0]],[[13692,7606],[-35,-123],[-17,-21],[-6,-94],[7,-51],[-5,-36],[33,-63],[6,-43],[26,-62],[32,-39],[3,-55],[7,-35]],[[13743,6984],[-5,-65],[-56,28],[-56,32],[-89,5]],[[13537,6984],[-8,6],[-42,-15],[-43,16],[-33,-8]],[[13411,6983],[-114,3]],[[13297,6986],[10,95],[-27,80],[-32,20],[-14,54],[-18,18],[0,33]],[[12751,7451],[-56,-25]],[[12695,7426],[-16,42],[-19,77],[-5,60],[15,108],[-17,44],[-7,95],[0,88],[-29,62],[5,38]],[[12622,8040],[62,-3]],[[12695,7426],[-110,-71],[-39,-41],[-63,-35],[-63,34]],[[12420,7313],[3,47],[-30,104],[18,137],[30,101],[-19,172]],[[12422,7874],[-9,91],[1,68],[122,6],[31,-9],[23,19],[32,-9]],[[12242,7962],[31,-27],[12,-40],[32,-25],[24,30],[33,5],[48,-31]],[[12420,7313],[-32,-1],[-49,23],[-45,-1],[-83,-21],[-48,-35],[-70,-44],[-13,3]],[[12080,7237],[5,99],[7,15],[-2,48],[-30,50],[-22,8],[-21,34],[16,53],[-7,59],[3,35]],[[12029,7638],[11,0],[4,52],[-5,24],[6,16],[26,15],[-17,97],[-16,49],[6,41],[13,10]],[[12029,7638],[-20,3],[-14,-49],[-20,1],[-14,25],[5,49],[-29,74],[-19,-14],[-15,-2]],[[11903,7725],[-19,-7],[1,44],[-12,31],[3,36],[-15,50],[-20,43],[-56,1],[-16,-23],[-20,-3],[-12,-26],[-8,-33],[-37,-54]],[[11692,7784],[-31,72],[-27,47],[-18,16],[-18,24],[-8,53],[-10,27],[-20,19]],[[11560,8042],[31,59],[21,-2],[18,20],[16,0],[11,16],[-6,40],[8,13],[1,41]],[[11560,8042],[-38,51],[-29,8],[-16,34],[0,18],[-21,26],[-5,26]],[[12080,7237],[-19,-1],[-72,57],[-64,92],[-59,66],[-48,78]],[[11818,7529],[17,39],[4,35],[32,65],[32,57]],[[11818,7529],[-18,9],[-51,49],[-36,64],[-13,44],[-8,89]],[[13914,7133],[-45,7],[-47,20],[-42,-64],[-37,-112]],[[14343,7703],[38,-49],[1,-39],[47,-63],[29,-52],[18,-72],[53,-48],[11,-38]],[[13532,6133],[-27,42],[-21,-21],[-28,-52]],[[13456,6102],[-58,128]],[[13398,6230],[54,67],[-27,80],[24,30],[48,15],[5,53],[38,-58],[62,-5],[21,57],[9,80],[-8,95],[-33,71],[30,140],[-17,24],[-52,-10],[-20,62],[5,53]],[[13398,6230],[-72,122],[-46,99],[-43,125],[3,40],[15,39],[17,88],[14,89]],[[13286,6832],[24,7],[102,-1],[-1,145]],[[13286,6832],[-13,18],[24,136]],[[14917,5596],[33,-53],[18,-103],[-12,-33],[-14,-97],[14,-100],[-22,-42],[-22,-112],[37,-32]],[[14949,5024],[-212,-99],[6,-86]],[[14248,4596],[-46,75],[-47,99],[3,384],[146,-2],[-6,42],[11,45],[-12,57],[7,58],[-7,38]],[[15044,5320],[-20,-92],[20,-156],[24,1],[25,-39],[30,-87],[6,-155],[-31,-25],[-21,-84],[-46,74],[-5,86],[15,56],[-4,48],[-28,31],[-19,-12],[-41,58]],[[15447,5465],[0,0],[12,-54],[-3,-120],[8,-106],[3,-188],[12,-60],[-20,-86],[-28,-84],[-44,-74],[-64,-46],[-79,-59],[-80,-129],[-27,-22],[-49,-86],[-28,-28],[-6,-86],[33,-91],[14,-71],[1,-36],[12,6],[-2,-119],[-11,-56],[16,-20],[-10,-50],[-30,-43],[-57,-41],[-85,-65],[-31,-45],[6,-51],[18,-8],[-6,-64]],[[14869,3484],[-6,54],[-10,54]],[[13475,6012],[-19,90]],[[13443,4623],[-6,75],[9,107],[25,110],[3,52],[23,109],[17,49],[40,79],[22,54],[8,89],[-4,68],[-21,44],[-19,73],[-17,72],[4,25],[22,48],[-22,117],[-14,80],[-35,77],[6,23]],[[14656,6368],[42,-10],[22,69],[37,-8]],[[15125,10657],[-12,-38]],[[15113,10619],[-26,17],[-14,-81],[17,-13],[-18,-17],[-3,-32],[33,17]],[[15102,10510],[2,-47],[-35,-193]],[[15069,10270],[-7,31]],[[15062,10301],[-39,176],[0,0]],[[15023,10477],[0,0],[20,40],[-4,7],[18,56],[14,91],[10,31],[2,1]],[[15083,10703],[24,0],[6,21],[19,2]],[[15132,10726],[1,-50],[-9,-18],[1,-1]],[[15083,10703],[25,98],[35,85],[1,5]],[[15144,10891],[32,-7],[11,-47],[-38,-45],[-17,-66]],[[16094,5206],[19,-52],[17,-79],[11,-146],[19,-56],[-7,-58],[-13,-35],[-24,70],[-13,-35],[14,-90],[-7,-51],[-19,-28],[-4,-102],[-28,-141],[-35,-166],[-43,-229],[-27,-167],[-31,-140],[-57,-29],[-62,-51],[-40,31],[-56,43],[-19,64],[-5,107],[-24,96],[-7,87],[13,87],[32,21],[0,40],[34,91],[6,77],[-16,57],[-13,76],[-6,112],[24,67],[10,77],[35,4],[39,25],[26,22],[31,1],[40,69],[57,74],[21,61],[-9,52],[30,-15],[38,84],[2,72],[23,54],[24,-51]],[[15113,10619],[0,-74],[-11,-35]],[[11440,8297],[9,54]],[[13285,10367],[-30,217],[-43,48],[0,30],[-58,72],[-6,90],[43,68],[17,99],[-11,115],[14,62]],[[13211,11168],[76,49],[49,-15],[-2,-61],[60,45],[5,-23],[-35,-59],[-1,-56],[25,-30],[-10,-105],[-46,-60],[13,-66],[37,-2],[17,-58],[27,-18]],[[13426,10709],[-4,-93],[-34,-35],[-22,-38],[-48,-47],[8,-50],[-6,-51],[-35,-28]],[[12013,10047],[-1,143],[114,89],[70,19],[57,32],[27,61],[82,47],[3,90],[40,10],[32,45],[92,20],[13,47],[-19,26],[-24,127],[-4,73],[-27,78]],[[12468,10954],[68,66],[76,21],[44,49],[67,37],[119,22],[116,9],[36,-17],[66,47],[74,1],[29,-28],[48,7]],[[13285,10367],[23,-106],[4,-56],[-13,-99],[6,-55],[-9,-66],[6,-76],[-28,-50],[41,-88],[3,-52],[25,-67],[33,22],[55,-56],[31,-76]],[[15125,10657],[78,-48],[137,129]],[[15340,10738],[29,-147]],[[15369,10591],[-14,-18],[-140,-61],[70,-121],[-23,-20],[-12,-40],[-53,-17],[-17,-44],[-31,-37],[-78,19]],[[15071,10252],[-2,18]],[[16237,9636],[12,6],[3,-33],[55,19],[58,-4],[42,-3],[48,81],[53,78],[44,74]],[[16552,9854],[13,-41]],[[16565,9813],[10,-95]],[[16575,9718],[-36,-1],[-6,-78],[13,-17],[-32,-24],[0,-49],[-21,-50],[-2,-49]],[[16491,9450],[-14,-25],[-211,61],[-26,122],[-3,28]],[[16183,9697],[-5,88],[19,63],[19,13],[22,-38],[1,-70],[-15,-71]],[[16224,9682],[-20,-9],[-21,24]],[[15984,10327],[15,-53],[-6,-28],[22,-91]],[[16015,10155],[-49,-3],[-18,58],[-62,11]],[[15886,10221],[51,116],[47,-10]],[[15340,10738],[156,125],[26,146],[-7,88],[39,30],[36,75]],[[15590,11202],[30,19],[81,-15],[25,-31],[34,20]],[[15760,11195],[45,-144],[46,-36],[5,-70],[-35,-42],[-16,-94],[48,-115],[86,-66],[36,-92],[-11,-87],[22,0],[1,-64],[39,-64]],[[16026,10321],[-42,6]],[[15886,10221],[-131,10],[-197,243],[-105,84],[-84,33]],[[16575,9718],[31,-83],[39,-44],[52,-15],[41,-22],[32,-69],[19,-41],[25,-15],[0,-27],[-26,-72],[-11,-34],[-30,-38],[-26,-83],[-31,7],[-15,-29],[-11,-61],[8,-81],[-6,-15],[-33,1],[-43,-46],[-7,-58],[-16,-26],[-44,1],[-27,-30],[0,-49],[-34,-33],[-39,11],[-46,-41],[-33,-7]],[[16344,8719],[-23,85],[-55,199]],[[16266,9003],[211,120],[47,242],[-33,85]],[[16552,9854],[20,41],[9,-10],[-7,-50],[-9,-22]],[[24345,4793],[44,-70],[-23,-16],[-24,53],[3,33]],[[24315,4820],[-10,33],[-1,92],[33,-37],[11,-97],[-18,15],[-15,-6]],[[19813,8181],[-16,145],[44,101],[91,23],[66,-18]],[[19998,8432],[58,-47],[31,83],[63,-44]],[[20150,8424],[16,-81],[-9,-144],[-118,-93],[31,-73],[-74,-9],[-60,-48]],[[19936,7976],[-59,17],[-28,63],[-36,125]],[[19813,8181],[-63,55],[-60,-2],[10,95],[-61,-1],[-6,-133],[-38,-176],[-22,-107],[4,-87],[46,-4],[28,-110],[13,-104],[39,-69],[43,-14],[36,-63]],[[19782,7461],[-23,-50],[-46,-14],[-6,62],[-57,53],[-12,-22]],[[19638,7490],[-28,47],[-12,59],[-37,68],[-34,58],[-12,-71],[-13,67],[8,75],[20,116]],[[19530,7909],[34,124],[39,112],[-27,110],[1,56],[-8,68],[-47,96],[-17,60],[24,22],[26,105],[-29,80],[-44,88],[-34,106],[29,22],[32,130],[50,6],[41,52],[40,28]],[[19640,9174],[30,-37],[4,-73],[48,-5],[-17,-128],[1,-108],[74,72],[21,-21],[41,4],[14,41],[53,-8],[54,-98],[4,-119],[57,-105],[-3,-102],[-23,-55]],[[19640,9174],[15,44],[60,79]],[[19715,9297],[6,-29],[37,-3],[-10,138],[36,18]],[[19784,9421],[41,-95],[32,-110],[86,-1],[27,-105],[-45,-32],[-20,-43],[84,-72],[58,-143],[45,-106],[53,-84],[17,-85],[-12,-121]],[[19530,7909],[-6,89],[21,93],[-23,71],[5,132],[-28,62],[-23,145],[-13,152],[-30,100],[-46,-61],[-80,-86],[-39,11],[-44,28],[25,150],[-15,113],[-55,139],[9,44],[-41,15],[-50,98]],[[19097,9204],[-5,97],[25,-18],[1,87]],[[19118,9370],[35,28],[-8,52],[16,41],[3,125],[55,-28],[31,100],[4,58],[38,102],[-2,69],[91,83],[50,-22],[-6,74],[25,23],[-6,45]],[[19444,10120],[41,9],[24,-71],[31,-29],[2,-92],[-3,-99],[-67,-101],[-8,-143],[74,20],[17,-111],[44,-24],[-20,-100],[52,-45],[30,-22],[52,35],[2,-50]],[[19784,9421],[38,29],[56,0],[68,14],[60,64],[33,-45],[64,-22],[-11,-70],[34,-49],[70,-31]],[[20196,9311],[-93,-103],[-59,-114],[-15,-84],[53,-127],[66,-158],[64,-75],[42,-96],[32,-224],[-9,-212],[-59,-79],[-80,-78],[-57,-101],[-87,-112],[-26,77],[20,82],[-52,69]],[[21790,11805],[-27,7],[-30,-41],[-21,-41],[3,-87],[-37,-26],[-12,-22],[-27,-35],[-46,-20],[-31,-33],[-2,-52],[-8,-13],[28,-20],[40,-53]],[[21620,11369],[-10,-29],[-30,-8],[-50,-6],[-27,-54],[-32,4],[-4,-11]],[[21467,11265],[-34,23],[-8,-23],[-21,-10],[-2,23],[-19,11],[-18,19],[19,54],[16,14],[-6,22],[18,65],[-5,20],[-41,13],[-33,32]],[[21333,11528],[57,77],[78,65],[48,86],[33,-38],[61,-4],[-11,63],[108,52],[28,68],[45,-71]],[[21620,11369],[60,-142],[17,-78],[1,-139],[-26,-67],[-64,-23],[-56,-50],[-63,-10],[-8,65],[13,91],[-31,126],[52,20],[-48,103]],[[20801,12730],[-34,-91],[-49,-121],[18,-49],[39,15],[70,-18],[53,44],[57,-39],[63,-84],[-7,-43],[-56,14],[-102,-16],[-49,-34],[-51,-80],[-107,-47],[-70,-64],[-72,24],[-40,11],[-36,-77],[22,-47],[11,-40],[-49,-40],[-50,-65],[-82,-42],[-105,-5],[-113,-42],[-82,-65],[-31,38],[-85,0],[-104,73],[-69,18],[-93,-17],[-145,27],[-77,-2],[-41,71],[-32,111],[-43,14],[-85,75],[-95,17],[-83,21],[-25,52],[27,141],[-49,97],[-100,45],[-59,64],[-18,85]],[[19118,9370],[-37,191],[-19,0],[-12,-77],[-38,62],[22,69],[31,7],[32,102],[-40,21],[-65,-2],[-67,16],[-6,84],[-33,6],[-56,52],[-25,-82],[51,-63],[-44,-45],[-16,-44],[44,-33],[-12,-72],[24,-91],[11,-99]],[[18863,9372],[-10,-45],[-48,2],[-86,-25],[4,-91],[-38,-71],[-101,-81],[-78,-142],[-53,-77],[-70,-79],[0,-55],[-35,-30],[-63,-43],[-33,-6],[-21,-92],[15,-157],[4,-100],[-30,-115],[0,-205],[-37,-6],[-32,-92],[22,-40],[-64,-34],[-24,-82],[-28,-35],[-66,113],[-33,169],[-27,122],[-24,57],[-37,116],[-18,151],[-12,75],[-64,166],[-29,234],[-21,154],[1,146],[-14,113],[-102,-72],[-50,14],[-91,147],[34,43],[-21,48],[-82,102]],[[17401,9569],[46,80],[155,0],[-14,104],[-40,61],[-8,93],[-46,54],[78,126],[81,-9],[73,127],[44,122],[68,121],[-1,86],[60,70],[-56,60],[-25,81],[-25,106],[35,52],[106,-29],[78,18],[68,101]],[[18078,10993],[75,-141],[-7,-99],[28,-62],[-2,-61],[-50,16],[19,-133],[69,-76],[98,-85]],[[18308,10352],[-45,-55],[-27,-112],[68,-46],[66,-59],[91,-68],[96,-16],[41,-61],[54,-11],[84,-29],[59,2],[8,48],[-9,77],[5,52]],[[18799,10074],[43,25],[6,-95]],[[18848,10004],[1,-24],[64,-46],[44,19],[59,-8],[57,4],[5,74],[-28,38]],[[19050,10061],[56,15],[64,90],[81,77],[59,-30],[50,51],[33,-75],[-24,-51],[75,-18]],[[19097,9204],[-20,63],[-4,62],[-14,58],[-29,70],[-64,5],[6,-50],[-22,-67],[-30,25],[-10,-22],[-20,13],[-27,11]],[[18848,10004],[46,90],[38,31],[50,-28],[37,-3],[31,-33]],[[18308,10352],[29,29],[56,-37],[71,-79],[39,-17],[24,-58],[54,-24],[57,-53],[79,-27],[82,-12]],[[17401,9569],[-52,30],[-21,87],[-54,92],[-129,-23],[-114,-2],[-99,-17]],[[16932,9736],[27,140],[101,63],[-6,55],[-33,20],[-2,106],[-67,53],[-29,73],[-34,63]],[[16889,10309],[117,-61],[70,18],[42,-15],[14,26],[49,-11],[91,51],[3,102],[39,69],[52,-1],[8,34],[53,16],[26,-11],[28,34],[-4,72],[30,73],[44,30],[-27,80],[66,-4],[20,44],[-3,46],[35,51],[-8,60],[-17,51],[41,53],[75,25],[81,14],[35,22],[41,14]],[[17890,11191],[52,-56],[21,-93],[115,-49]],[[17376,11192],[22,-14],[51,38],[23,-23],[23,55],[42,-2],[10,17],[8,49],[30,42],[38,-27],[-8,-37],[22,-6],[-7,-101],[28,-40],[24,25],[31,12],[44,54],[48,-8],[73,-1]],[[17878,11225],[12,-34]],[[16889,10309],[63,110],[-6,78],[-53,20],[-5,76],[-23,97],[30,66],[-31,18],[20,87],[28,151]],[[16912,11012],[72,-46],[53,16],[14,55],[56,18],[39,37],[14,96],[59,24],[11,42],[33,-32],[21,-4]],[[17600,11566],[-26,-37],[-76,20],[-7,-69],[76,9],[87,-39],[132,18]],[[17786,11468],[18,-112],[23,13],[43,-28],[-3,-47],[11,-69]],[[18248,11820],[-10,-27],[-110,-65],[-25,-48],[-90,-15],[-27,-77],[-74,17],[-49,-24],[-67,-57],[10,-28],[-20,-28]],[[16912,11012],[-6,101],[-52,5],[-80,107],[-56,13],[-78,61],[-50,11],[-30,-22],[-47,3],[-50,-69],[-62,-23]],[[16401,11199],[-13,85],[10,126],[-54,41],[18,83],[-47,7],[16,101],[66,-29],[61,38],[-51,73],[-20,69],[-56,-31],[-7,-88],[-22,78]],[[15760,11195],[0,0],[-39,97],[14,37],[-22,139],[48,34]],[[15761,11502],[11,-45],[36,-56],[48,-16]],[[15856,11385],[25,3]],[[15881,11388],[83,89],[26,9],[21,-35],[-24,-60],[43,-63],[18,6]],[[16048,11334],[22,-89],[67,-25],[48,-61],[100,-20],[109,31],[7,29]],[[16932,9736],[-132,37],[-76,27],[-79,16],[-30,148],[-34,21],[-53,-21],[-71,-59],[-86,40],[-71,93],[-67,35],[-47,114],[-52,161],[-37,-20],[-45,40],[-26,-47]],[[15144,10891],[-6,92],[17,50]],[[15155,11033],[19,26],[19,26],[3,68],[23,-24],[78,34],[37,-23],[58,0],[80,46],[38,-2],[80,18]],[[15856,11385],[-29,70],[1,18],[-31,0],[-21,32],[-15,-3]],[[15761,11502],[-27,35],[-53,30],[7,59],[-12,42]],[[15676,11668],[98,19]],[[15774,11687],[14,-31],[27,-21],[-14,-31],[37,-41],[-20,-38],[30,-33],[32,-20],[1,-84]],[[14068,15049],[94,-59],[109,-82],[2,-186],[23,-47]],[[14296,14675],[-120,-34],[-68,-85],[11,-74],[-112,-97],[-135,-103],[-51,-170],[50,-85],[67,-67],[-65,-136],[-73,-29],[-26,-202],[-40,-113],[-85,12],[-40,-96],[-81,-6],[-22,114],[-59,137],[-53,171]],[[14849,12997],[-60,-7],[-22,-27],[-4,-60],[-28,11],[-63,-6],[-19,29],[-26,-21],[-26,17],[-56,2],[-78,29],[-71,10],[-54,-3],[-38,-33],[-34,-4]],[[14270,12934],[-1,53],[-22,56],[42,25],[1,48],[-20,46],[-3,53]],[[14267,13215],[68,0],[76,45],[16,68],[58,39],[-7,54]],[[14478,13421],[43,20],[75,47]],[[15301,12394],[-56,-10],[-47,-39],[-66,-6],[-60,-45],[3,-65]],[[14965,12257],[-10,13],[-109,31],[-5,45],[-65,-15],[-26,-66],[-54,-90]],[[14696,12175],[-32,21],[-33,-19],[-31,22]],[[14600,12199],[18,13],[12,41],[19,39],[-5,22],[15,9],[7,-17],[41,-3],[19,9],[-13,12],[5,18],[-25,31],[-10,50],[-26,20],[5,41],[-31,32],[-29,5],[-52,37],[-46,-12],[-17,-17]],[[14487,12529],[-30,0],[-17,-29],[-52,-11],[-24,-19],[-33,30],[-45,0],[-43,14],[-30,-26]],[[14213,12488],[-5,32],[-39,33]],[[14169,12553],[14,49],[19,31]],[[14202,12633],[15,-7],[-18,54],[64,101],[35,14],[7,33],[-35,106]],[[14202,12633],[-66,46],[-51,-17],[-33,13],[-41,-26],[-36,43],[-29,-17],[-4,8]],[[13942,12683],[-32,59],[-52,7],[-7,38],[-48,14],[-10,-32],[-38,25],[4,34],[-52,10],[-34,39]],[[13673,12877],[-28,77],[5,41],[-17,65],[-26,43],[20,32],[-17,62]],[[13610,13197],[48,35],[110,56],[88,41],[70,-21],[5,-29],[68,-2]],[[14214,13265],[36,-12],[17,-38]],[[13811,12517],[-5,-49],[-40,-1],[14,-26],[-23,-77]],[[13757,12364],[-14,-21],[-61,-3],[-36,-27],[-57,9]],[[13589,12322],[-101,31],[-15,42],[-70,-21],[-8,-23],[-42,17]],[[13353,12368],[-36,4],[-32,22],[11,29],[-3,22]],[[13293,12445],[21,6],[36,-33],[10,32],[62,-5],[50,21],[33,-4],[22,-24],[7,20],[-10,79],[25,15],[25,56]],[[13574,12608],[52,-39],[39,49],[25,9],[54,-36],[33,6],[33,-23]],[[13810,12574],[-6,-15],[7,-42]],[[14213,12488],[-43,-26],[-33,-81],[-43,-82],[-56,-23]],[[14038,12276],[-44,5],[-53,-31],[0,0]],[[13941,12250],[-26,-18],[-58,23],[-53,52],[-22,14]],[[13782,12321],[-14,41],[-11,2]],[[13811,12517],[36,-31],[26,-13],[58,15],[6,24],[28,3],[34,19],[8,-8],[33,16],[16,28],[23,7],[75,-36],[15,12]],[[14600,12199],[-12,55],[7,52],[-2,52],[-41,72],[-22,51],[-22,36],[-21,12]],[[14696,12175],[2,-31],[-34,-26],[-22,12],[-19,-146]],[[14623,11984],[-41,13],[-51,44],[-83,-28],[-35,-31],[-103,6],[-54,19],[-27,-9],[-20,50]],[[14209,12048],[-13,21],[16,20],[-17,15],[-22,-27],[-41,35],[-5,50],[-43,28],[-8,39],[-38,47]],[[14112,13370],[-15,101]],[[14097,13471],[80,37],[118,-8],[69,12],[9,-25],[38,-8],[67,-58]],[[14097,13471],[2,91],[35,76],[66,41],[55,-90],[57,2],[13,93]],[[14325,13684],[60,21],[31,-15],[60,-45],[58,0]],[[14325,13684],[8,71],[-25,-15],[-45,43],[-6,69],[89,33],[88,18],[76,-20],[72,4],[0,0]],[[13673,12877],[-31,-13],[-18,14],[-18,-23],[-50,-23],[-26,-30],[-51,-27],[12,-35],[7,-51],[36,-29],[40,-52]],[[13293,12445],[-75,37],[-14,-27],[-60,1]],[[13054,12679],[4,53],[-14,27]],[[13044,12759],[8,81]],[[13052,12840],[-12,127],[43,0],[17,45],[18,111],[-13,40]],[[13105,13163],[13,26],[59,7],[13,-27],[48,59],[-16,46],[-4,68]],[[13218,13342],[53,-16],[45,19]],[[13316,13345],[1,-47],[71,-28],[0,-43],[71,23],[39,33],[79,-48],[33,-38]],[[14623,11984],[-37,-50],[-25,-86],[22,-69]],[[14583,11779],[-60,16],[-71,-38]],[[14452,11757],[-1,-60],[-64,-11],[-49,42],[-56,-33],[-52,3]],[[14230,11698],[-5,80],[-35,39]],[[14190,11817],[11,17],[-7,14],[11,38],[27,38],[-34,52],[-6,44],[17,28]],[[14464,10970],[-9,-36],[-101,-10],[1,20],[-86,23],[13,51],[39,-40],[54,7],[52,-9],[-1,-21],[38,15]],[[14452,11757],[34,-32],[-22,-75],[-17,-14]],[[14447,11636],[-42,4],[-37,11],[-85,-31],[49,-68],[-36,-20],[-39,0],[-37,62],[-13,-26],[16,-72],[35,-57],[-27,-26],[39,-56],[35,-35],[1,-68],[-65,32],[21,-62],[-45,-12],[27,-107],[-47,-1],[-57,52],[-26,97],[-13,80],[-27,55],[-36,69],[-5,34]],[[14033,11491],[33,59],[4,39],[23,18],[1,31]],[[14094,11638],[46,11],[27,26],[38,-2],[11,21],[14,4]],[[15155,11033],[-26,54],[27,46],[-43,-11],[-59,28],[-48,-69],[-106,-14],[-57,65],[-75,4],[-17,-50],[-48,-15],[-68,65],[-76,-2],[-42,120],[-51,66],[34,94],[-45,58],[78,115],[108,5],[30,92],[133,-16],[85,78],[81,34],[116,3],[123,-85],[100,-47],[82,19],[60,-11],[83,63]],[[15534,11722],[75,6],[67,-60]],[[14583,11779],[9,-46],[61,-39],[-13,-30],[-83,-7],[-30,-37],[-58,-65],[-22,56],[0,25]],[[14033,11491],[-12,9],[-1,26],[-39,41],[-6,57],[6,83],[10,37],[-12,19],[0,0]],[[13979,11763],[-5,39],[30,59],[5,-23],[19,11]],[[14028,11849],[15,-32],[16,-13],[5,-43]],[[14064,11761],[0,0],[-9,-41],[10,-52],[29,-30]],[[13941,12250],[17,-47],[22,-34],[-27,-46]],[[13953,12123],[-32,27],[-48,-2],[-60,20],[-33,-2],[-15,-25],[-26,27],[-14,-50],[34,-56],[15,-38],[33,-45],[26,-26],[27,-51],[62,-46]],[[13922,11856],[-8,-20]],[[13914,11836],[0,0],[-66,45],[-40,43],[-65,36],[-59,89],[15,9],[-32,50],[-2,41],[-45,19],[-21,-52],[-21,41],[2,41],[2,2]],[[13582,12200],[49,-4],[13,21],[24,-20],[27,-2],[0,33],[24,13],[7,48],[56,32]],[[13353,12368],[-6,-49],[-31,-20],[-52,15],[-15,-49],[-33,-4],[-12,19],[-40,-41],[-34,-5],[-30,26]],[[13018,12687],[8,67],[18,5]],[[12797,12882],[56,24],[0,0]],[[12853,12906],[0,0],[51,-10],[65,25],[45,-53],[38,-28]],[[12853,12906],[36,33],[61,177],[96,51],[59,-4]],[[11987,11764],[25,30],[29,18],[18,-59],[41,0],[12,15],[41,-4],[20,-61],[-33,-32],[-1,-94],[-11,-18],[-3,-57],[-30,-10],[28,-72],[-20,-80],[25,-35],[-10,-33],[-26,-46],[6,-39]],[[12098,11187],[-28,-32],[-37,17],[-36,-13],[10,94],[-6,75],[-32,11],[-16,45],[5,79],[28,44],[5,49],[15,72],[-2,52],[-14,43],[-3,41]],[[11987,11764],[4,86],[-29,52],[99,87],[86,-22],[94,1],[75,-21],[58,7],[113,-4]],[[12830,11835],[4,-70],[-67,-80],[-90,-26],[-6,-40],[-43,-67],[-27,-99],[27,-69],[-40,-53],[-15,-79],[-53,-24],[-50,-93],[-89,-1],[-67,2],[-44,-43],[-27,-45],[-34,10],[-26,40],[-20,70],[-65,19]],[[12186,13210],[12,-86],[-53,-108],[-125,-71],[-99,18],[57,126],[-37,123],[96,94],[53,57]],[[12090,13363],[14,-65],[-14,-65],[43,2],[53,-25]],[[24244,4167],[57,-75],[37,-56],[-27,-29],[-38,33],[-50,54],[-46,64],[-46,85],[-10,41],[30,-1],[40,-42],[31,-41],[22,-33]],[[23987,5445],[20,-41],[-49,1],[-27,74],[42,-29],[14,-5]],[[23957,5552],[-11,-22],[-52,104],[-15,72],[24,0],[25,-96],[29,-58]],[[23898,5519],[-27,-3],[-43,12],[-15,19],[5,48],[46,-19],[23,-25],[11,-32]],[[23813,5743],[17,-39],[3,-24],[-55,51],[-38,44],[-27,40],[11,12],[32,-29],[57,-55]],[[23638,5863],[28,-39],[-14,-7],[-30,27],[-29,50],[3,20],[42,-51]],[[25023,1876],[-27,-65],[-35,-83],[-54,-48],[-12,32],[-29,17],[40,99],[-23,67],[-75,48],[2,44],[51,42],[11,93],[-3,78],[-28,81],[2,21],[-34,50],[-55,106],[-29,86],[26,9],[38,-67],[54,-31],[20,-107],[51,-127],[2,82],[31,-33],[11,-91],[56,-40],[47,-9],[40,46],[36,-14],[-17,-107],[-21,-71],[-54,3],[-19,-37],[7,-52],[-10,-22]],[[24517,1455],[60,63],[42,63],[31,89],[26,31],[11,67],[49,56],[16,-51],[16,-50],[49,49],[21,-51],[0,-51],[-26,-56],[-46,-89],[-36,-48],[26,-58],[-54,-2],[-60,-45],[-19,-79],[-40,-122],[-55,-54],[-35,-35],[-65,3],[-45,40],[-76,8],[-12,45],[38,89],[88,119],[45,23],[51,46]],[[22976,1786],[42,-8],[5,-143],[-24,-42],[-8,-97],[-24,33],[-49,-84],[-14,7],[-43,3],[-44,104],[-9,79],[-41,105],[2,56],[46,-11],[68,-42],[38,17],[55,23]],[[21465,2823],[-74,-62],[-61,-28],[-13,-63],[-26,-49],[-60,-3],[-44,-11],[-62,22],[-50,-13],[-48,-5],[-42,-65],[-20,6],[-36,-34],[-33,-39],[-51,5],[-47,0],[-75,77],[-38,23],[2,69],[35,17],[12,27],[-3,43],[9,84],[-8,72],[-37,122],[-12,69],[3,68],[-28,79],[-1,35],[-31,48],[-9,95],[-40,95],[-10,52],[31,-52],[-24,112],[35,-35],[21,-47],[-1,62],[-35,95],[-7,38],[-16,36],[8,70],[14,29],[10,61],[-8,70],[29,87],[5,-92],[30,83],[57,41],[34,51],[54,44],[31,10],[20,-15],[55,45],[43,13],[10,27],[19,11],[39,-3],[73,35],[38,54],[18,64],[41,61],[3,49],[2,65],[49,103],[30,-104],[30,24],[-25,57],[22,58],[31,-26],[8,92],[39,59],[16,48],[36,20],[1,34],[31,-14],[1,30],[31,18],[34,16],[51,-55],[39,-72],[44,-1],[45,-11],[-15,66],[33,97],[32,31],[-11,31],[31,69],[42,42],[36,-14],[59,23],[-1,61],[-52,40],[38,17],[46,-29],[37,-50],[59,-31],[20,12],[44,-37],[41,35],[26,-11],[17,24],[32,-60],[-19,-65],[-27,-49],[-24,-4],[8,-48],[-20,-60],[-25,-59],[5,-34],[56,-67],[54,-39],[36,-41],[50,-72],[20,0],[37,-31],[11,-37],[67,-41],[46,41],[14,65],[14,54],[8,66],[22,96],[-10,58],[5,35],[-8,69],[9,91],[14,25],[-11,40],[17,64],[13,66],[2,35],[26,45],[20,-59],[4,-76],[18,-14],[3,-51],[25,-61],[6,-69],[-3,-44],[25,-94],[45,45],[24,-51],[33,-47],[-7,-53],[15,-104],[11,-60],[17,-15],[19,-103],[-6,-62],[22,-82],[76,-63],[50,-58],[47,-52],[-9,-29],[40,-76],[27,-131],[28,27],[28,-52],[18,18],[12,-128],[49,-74],[33,-46],[55,-98],[19,-97],[2,-68],[-5,-75],[34,-103],[-4,-106],[-12,-56],[-19,-108],[1,-69],[-14,-87],[-31,-109],[-52,-60],[-25,-93],[-24,-60],[-20,-104],[-27,-60],[-18,-90],[-9,-83],[3,-39],[-40,-41],[-78,-5],[-65,-49],[-32,-47],[-43,-52],[-58,53],[-43,22],[11,63],[-38,-23],[-61,-88],[-61,33],[-40,19],[-40,9],[-68,35],[-45,74],[-13,92],[-16,61],[-35,49],[-67,14],[23,59],[-17,89],[-34,-83],[-63,-22],[37,66],[10,70],[28,59],[-6,89],[-57,-102],[-44,-42],[-27,-96],[-55,50],[3,64],[-44,88],[-37,45],[13,28],[-90,73],[-49,3],[-68,59],[-125,-12],[-91,-43],[-80,-40],[-67,8]],[[18355,7618],[-11,-126],[-29,-34],[-61,-28],[-33,96],[-13,174],[32,196],[48,-67],[33,-85],[34,-126]],[[20296,8906],[-57,37],[-2,104],[34,55],[77,34],[40,-3],[16,-46],[-31,-53],[-16,-70],[-61,-58]],[[21333,11528],[-98,-35],[-51,-56],[-76,-33],[37,56],[-14,47],[55,81],[-37,63],[-61,-43],[-79,-84],[-43,-78],[-69,-5],[-36,-57],[37,-81],[58,-20],[2,-54],[55,-35],[79,86],[62,-47],[45,-3],[12,-64],[-99,-33],[-33,-66],[-68,-60],[-36,-84],[75,-67],[28,-118],[42,-111],[48,-93],[-1,-89],[-44,-33],[17,-65],[41,-37],[-11,-98],[-18,-96],[-39,-11],[-51,-130],[-57,-159],[-65,-144],[-96,-111],[-98,-102],[-79,-14],[-43,-53],[-24,39],[-40,-60],[-98,-60],[-74,-19],[-24,-127],[-39,-7],[-18,87],[17,47],[-95,38],[-33,-19]],[[21159,9654],[-42,-194],[-30,-99],[-37,102],[-8,90],[41,118],[56,91],[32,-36],[-12,-72]],[[13589,12322],[-8,-59],[17,-52]],[[13598,12211],[-56,18],[-57,-43],[4,-60],[-9,-34],[23,-62],[66,-60],[35,-100],[78,-97],[55,0],[17,-26],[-19,-24],[62,-44],[52,-36],[60,-63],[7,-23],[-13,-43],[-39,56],[-61,20],[-29,-78],[50,-45],[-8,-63],[-29,-7],[-38,-103],[-29,-10],[0,37],[15,65],[15,26],[-27,70],[-22,61],[-29,15],[-21,52],[-45,22],[-30,48],[-52,8],[-55,54],[-64,79],[-47,69],[-22,120],[-35,14],[-57,40],[-33,-17],[-40,-56],[-29,-9]],[[13655,11313],[54,10],[-26,-95],[11,-37],[-15,-62],[-53,45],[-36,13],[-98,62],[10,62],[82,-11],[71,13]],[[13231,11645],[35,38],[42,-86],[-10,-160],[-31,8],[-29,-40],[-27,32],[-2,145],[-16,69],[38,-6]],[[13218,13342],[-28,67],[-2,123],[11,33],[21,36],[61,8],[25,33],[56,34],[-2,-62],[-21,-39],[9,-34],[38,-18],[-18,-46],[-20,13],[-51,-87],[19,-58]],[[13488,13481],[22,-61],[-42,-98],[-73,69],[-10,50],[103,40]],[[12090,13363],[58,4],[76,-74],[-38,-83]],[[12404,13154],[0,0],[10,70],[-47,74],[-1,2],[-85,21],[-17,33],[26,54],[-23,33],[-38,-57],[-4,116],[-36,62],[26,125],[54,98],[56,-10],[85,10],[-75,-130],[71,16],[77,0],[-18,-99],[-63,-108],[72,-8],[6,-12],[62,-143],[48,-19],[43,-137],[20,-48],[85,-23],[-8,-77],[-36,-36],[28,-62],[-63,-63],[-94,1],[-119,-33],[-33,23],[-46,-56],[-65,14],[-49,-47],[-38,25],[103,126],[63,26],[0,0],[-110,21],[-20,48],[73,37],[-38,65],[13,79],[105,-11]],[[11603,14729],[-16,-78],[79,-82],[-91,-92],[-202,-83],[-61,-22],[-92,18],[-196,38],[70,53],[-153,59],[124,23],[-3,36],[-147,28],[47,79],[107,17],[109,-81],[106,65],[89,-34],[114,64],[116,-8]],[[16027,11755],[37,-64],[35,-85],[33,-6],[22,-32],[-58,-10],[-12,-94],[-12,-42],[-26,-28],[2,-60]],[[15774,11687],[17,20],[52,-35],[38,-7],[9,14],[-34,66],[18,16]],[[15534,11722],[10,52],[-17,82],[-41,44],[-38,14],[-26,37]],[[21093,8243],[-36,92],[60,-4],[24,-44],[-18,-104],[-30,60]],[[21215,7915],[18,33],[8,75],[38,7],[-11,-81],[52,117],[-7,-116],[-25,-39],[-22,-76],[-22,-36],[-43,83],[14,33]],[[21481,7726],[7,-81],[5,-67],[-24,-111],[-26,123],[-33,-61],[23,-89],[-20,-56],[-83,70],[-20,87],[22,57],[-45,57],[-22,-50],[-33,5],[-52,-67],[-11,35],[27,102],[44,34],[39,45],[24,-54],[54,33],[11,53],[50,4],[-4,93],[56,-57],[6,-61],[5,-44]],[[20929,7834],[-93,-114],[34,84],[51,75],[42,83],[37,120],[12,-98],[-46,-67],[-37,-83]],[[21198,8909],[-11,-50],[24,-86],[-19,-101],[-41,-40],[-11,-97],[15,-96],[38,-13],[31,14],[87,-67],[-7,-65],[23,-29],[-7,-56],[-55,59],[-25,64],[-19,-45],[-44,72],[-64,-17],[-35,26],[4,50],[22,31],[-21,28],[-9,-44],[-35,70],[-10,52],[-3,116],[28,-40],[8,189],[22,109],[43,0],[43,-34],[22,31],[6,-31]],[[21177,8088],[-11,57],[42,-37],[45,0],[-1,-50],[-33,-52],[-44,-36],[-3,56],[5,62]],[[21420,8178],[20,-135],[-54,32],[1,-40],[17,-75],[-33,-27],[-3,85],[-21,6],[-11,73],[41,-9],[-1,45],[-43,92],[68,-2],[19,-45]],[[19782,7461],[16,-11],[42,-73],[29,-81],[4,-81],[-7,-55],[6,-42],[5,-71],[25,-33],[28,-107],[-2,-41],[-49,-8],[-67,90],[-83,95],[-8,62],[-40,81],[-10,99],[-25,66],[7,88],[-15,51]],[[20309,6952],[52,-41],[54,23],[14,102],[30,22],[84,27],[50,95],[35,76]],[[20628,7256],[32,-62],[14,41],[34,-4],[4,77],[3,60]],[[20715,7368],[54,83],[36,95],[28,0],[36,-61],[3,-52],[46,-34],[59,-36],[-5,-48],[-47,-6],[12,-58],[-51,-42]],[[20628,7256],[28,45],[59,67]],[[13582,12200],[16,11]],[[14589,14011],[0,0],[-128,-10],[-123,-44],[-114,-26],[-41,66],[-68,40],[16,119],[-34,109],[33,70],[64,76],[160,130],[47,26],[-7,51],[-98,57]],[[13810,12574],[10,27],[31,-2],[24,12],[1,11],[14,6],[5,27],[16,6],[10,21],[21,1]],[[15314,8882],[40,-140],[20,-111],[38,-58],[96,-114],[39,-69],[38,-70],[22,-41],[34,-36]],[[15641,8243],[-21,-30],[-30,11]],[[15590,8224],[-24,39],[-29,70],[-31,39],[-18,42],[-61,48],[-48,2],[-17,25],[-41,-29],[-43,55],[-22,-90],[-81,25]],[[22569,11438],[-65,-122],[1,-124],[-27,-96],[13,-61],[-37,-85],[-89,-57],[-124,-7],[-100,-138],[-47,47],[-3,90],[-121,-27],[-83,-57],[-83,-2],[72,-89],[-47,-205],[-46,-51],[-34,47],[18,109],[-45,35],[-28,83],[66,37],[37,76],[70,62],[52,83],[139,36],[75,-25],[74,215],[46,-58],[103,121],[40,46],[44,148],[-12,136],[30,76],[74,22],[39,-167],[-2,-98]],[[22760,12015],[50,51],[15,-136],[-104,-33],[-61,-120],[-111,83],[-38,-132],[-78,-2],[-9,120],[34,93],[75,7],[21,167],[20,94],[83,-126],[54,-41],[49,-25]],[[21902,10748],[38,72],[40,-14],[29,51],[52,-26],[8,-42],[-39,-73],[-29,39],[-36,-28],[-18,-71],[-46,35],[1,57]],[[16344,8719],[-51,-32],[-13,-54],[-2,-41],[-70,-51],[-112,-56],[-62,-85],[-31,-7],[-21,7],[-41,-50],[-45,-23],[-59,-6],[-18,-7],[-15,-32],[-18,-9],[-11,-30],[-35,2],[-22,-16],[-49,6],[-18,70],[2,66],[-11,36],[-14,89],[-20,50],[14,6],[-7,55],[8,23],[-3,53]],[[15620,8683],[31,38],[-7,51],[18,59],[29,-31],[19,11],[81,3],[13,-12],[67,-12],[27,6],[18,-41],[33,21],[50,126],[65,55],[202,46]],[[16015,10155],[28,-104],[34,-27],[12,-43],[48,-50],[4,-50],[-7,-40],[9,-41],[20,-34],[10,-39],[10,-30]],[[16224,9682],[13,-46]],[[15620,8683],[-9,51],[-21,37],[-6,48],[-36,43],[-37,101],[-20,99],[-49,83],[-31,19],[-46,115],[-8,84],[3,72],[-41,134],[-32,47],[-38,25],[-23,69],[3,27],[-19,63],[-21,26],[-27,90],[-43,98],[-35,82],[-35,0],[11,66],[3,42],[8,48]],[[14915,10950],[5,1],[11,29],[50,-2],[64,36],[-48,-51],[6,-23]],[[15003,10940],[-8,5],[-13,-9],[-11,2],[-3,-5],[-2,13],[-5,7],[-13,1],[-19,-10],[-14,6]],[[15003,10940],[2,-9],[-72,-49],[-34,15],[-17,49],[33,4]],[[11427,9295],[3,56],[27,33],[23,63],[-4,41],[24,85],[39,76],[24,20],[18,70],[2,65],[25,74],[47,44],[44,123],[1,2],[36,46],[65,14],[55,82],[35,32],[59,101],[-18,150],[27,104],[9,64],[45,81],[71,55],[52,50],[47,125],[22,74],[51,0],[43,-52],[66,9],[73,-27],[30,-1]],[[14373,9365],[0,444],[0,429],[-21,97],[18,75],[-10,52],[25,57]],[[14385,10519],[93,2],[68,-31],[69,-36],[33,-19],[54,38],[29,35],[61,10],[50,-15],[19,-60],[17,39],[56,-28],[54,-7],[35,30]],[[15062,10301],[7,-31],[-20,-49],[-15,-91],[-19,-63],[-16,-21],[-24,39],[-31,54],[-50,173],[-7,-11],[29,-127],[43,-121],[53,-188],[26,-66],[22,-68],[63,-134],[-14,-21],[2,-78],[82,-108],[12,-25]],[[13426,10709],[82,-42],[30,10],[58,-20],[93,-54],[33,-107],[63,-23],[99,-51],[75,-60],[34,32],[34,55],[-17,92],[22,59],[51,57],[48,16],[95,-25],[24,-53],[26,-1],[22,-21],[70,-14],[17,-40]],[[15095,7375],[-41,131],[-32,28],[-12,48],[-36,59],[-43,9],[24,68],[37,3],[11,37]],[[15590,8224],[-25,-54],[-23,-56],[5,-34],[1,-36],[39,-2],[17,8],[16,-21]],[[15620,8029],[-16,-43],[26,-67],[26,-58],[27,-43],[229,-143],[59,1]],[[15641,8243],[17,-38],[-3,-50],[-40,-29],[31,-33]],[[15646,8093],[-26,-64]],[[15646,8093],[22,-22],[14,-50],[32,-50],[35,-1],[66,31],[76,14],[62,38],[34,8],[26,22],[39,4],[0,0]],[[14753,6573],[-42,-37],[-17,12]],[[14782,7134],[29,33],[45,-27],[56,28],[50,0],[43,55]],[[13953,12123],[0,0],[25,0],[-17,-53],[34,-46],[-11,-57],[-16,-5]],[[13968,11962],[-13,-11],[-23,-28],[-10,-67]],[[14064,11761],[9,-1],[3,24],[42,19],[15,5]],[[14133,11808],[24,7],[33,2]],[[14133,11808],[-2,9],[8,14],[8,29],[-10,0],[-13,22],[-12,6],[-9,19],[-13,7],[-10,18],[-13,-7],[-9,-40],[-17,-9]],[[14041,11876],[6,10],[-27,25],[-23,13],[-10,17],[-19,21]],[[13979,11763],[-15,10],[-20,39],[-30,24]],[[14041,11876],[-13,-27]],[[8296,8009],[40,15],[15,-4],[-3,-90],[-58,-13],[-13,11],[20,33],[-1,48]]],Yy={scale:[.014262509409294404,.0082876248288996],translate:[-180,-55.61183]},Ky={ne_110m_admin_0_countries:{type:"GeometryCollection",geometries:[{arcs:[[[0]],[[1]],[[2]]],type:"MultiPolygon",properties:{ADM0_A3:"FJI"}},{arcs:[[3,4,5,6,7,8,9,10,11]],type:"Polygon",properties:{ADM0_A3:"TZA"}},{arcs:[[12,13,14,15]],type:"Polygon",properties:{ADM0_A3:"SAH"}},{arcs:[[[16,17,18,19]],[[20]],[[21]],[[22]],[[23]],[[24]],[[25]],[[26]],[[27]],[[28]],[[29]],[[30]],[[31]],[[32]],[[33]],[[34]],[[35]],[[36]],[[37]],[[38]],[[39]],[[40]],[[41]],[[42]],[[43]],[[44]],[[45]],[[46]],[[47]],[[48]]],type:"MultiPolygon",properties:{ADM0_A3:"CAN"}},{arcs:[[[-20,49,50,51]],[[52]],[[53]],[[54]],[[55]],[[56]],[[57]],[[58]],[[-18,59]],[[60]]],type:"MultiPolygon",properties:{ADM0_A3:"USA"}},{arcs:[[61,62,63,64,65,66]],type:"Polygon",properties:{ADM0_A3:"KAZ"}},{arcs:[[-64,67,68,69,70]],type:"Polygon",properties:{ADM0_A3:"UZB"}},{arcs:[[[71,72]],[[73]],[[74]],[[75]]],type:"MultiPolygon",properties:{ADM0_A3:"PNG"}},{arcs:[[[-73,76]],[[77,78]],[[79]],[[80,81]],[[82]],[[83]],[[84]],[[85]],[[86]],[[87]],[[88]],[[89]],[[90]]],type:"MultiPolygon",properties:{ADM0_A3:"IDN"}},{arcs:[[[91,92]],[[93,94,95,96,97,98]]],type:"MultiPolygon",properties:{ADM0_A3:"ARG"}},{arcs:[[[-93,99]],[[100,-96,101,102]]],type:"MultiPolygon",properties:{ADM0_A3:"CHL"}},{arcs:[[-9,103,104,105,106,107,108,109,110,111,112]],type:"Polygon",properties:{ADM0_A3:"COD"}},{arcs:[[113,114,115,116]],type:"Polygon",properties:{ADM0_A3:"SOM"}},{arcs:[[-4,117,118,119,-114,120]],type:"Polygon",properties:{ADM0_A3:"KEN"}},{arcs:[[121,122,123,124,125,126,127,128]],type:"Polygon",properties:{ADM0_A3:"SDN"}},{arcs:[[-123,129,130,131,132]],type:"Polygon",properties:{ADM0_A3:"TCD"}},{arcs:[[133,134]],type:"Polygon",properties:{ADM0_A3:"HTI"}},{arcs:[[-134,135]],type:"Polygon",properties:{ADM0_A3:"DOM"}},{arcs:[[[136]],[[137,138,139,140,141,142,143,144,145,146,147,148,149,150,151,152,-67]],[[153]],[[154]],[[155]],[[156]],[[157]],[[158]],[[159,160,161]],[[162]],[[163]],[[164]],[[165]],[[166,167]]],type:"MultiPolygon",properties:{ADM0_A3:"RUS"}},{arcs:[[[168]],[[169]],[[170]]],type:"MultiPolygon",properties:{ADM0_A3:"BHS"}},{arcs:[[171]],type:"Polygon",properties:{ADM0_A3:"FLK"}},{arcs:[[[172]],[[-148,173,174,175]],[[176]],[[177]]],type:"MultiPolygon",properties:{ADM0_A3:"NOR"}},{arcs:[[178]],type:"Polygon",properties:{ADM0_A3:"GRL"}},{arcs:[[179]],type:"Polygon",properties:{ADM0_A3:"ATF"}},{arcs:[[180,-78]],type:"Polygon",properties:{ADM0_A3:"TLS"}},{arcs:[[181,182,183,184,185,186,187],[188]],type:"Polygon",properties:{ADM0_A3:"ZAF"}},{arcs:[[-189]],type:"Polygon",properties:{ADM0_A3:"LSO"}},{arcs:[[-51,189,190,191,192]],type:"Polygon",properties:{ADM0_A3:"MEX"}},{arcs:[[193,194,-94]],type:"Polygon",properties:{ADM0_A3:"URY"}},{arcs:[[-194,-99,195,196,197,198,199,200,201,202,203]],type:"Polygon",properties:{ADM0_A3:"BRA"}},{arcs:[[-197,204,-97,-101,205]],type:"Polygon",properties:{ADM0_A3:"BOL"}},{arcs:[[-198,-206,-103,206,207,208]],type:"Polygon",properties:{ADM0_A3:"PER"}},{arcs:[[-199,-209,209,210,211,212,213]],type:"Polygon",properties:{ADM0_A3:"COL"}},{arcs:[[-212,214,215,216]],type:"Polygon",properties:{ADM0_A3:"PAN"}},{arcs:[[-216,217,218,219]],type:"Polygon",properties:{ADM0_A3:"CRI"}},{arcs:[[-219,220,221,222]],type:"Polygon",properties:{ADM0_A3:"NIC"}},{arcs:[[-222,223,224,225,226]],type:"Polygon",properties:{ADM0_A3:"HND"}},{arcs:[[-225,227,228]],type:"Polygon",properties:{ADM0_A3:"SLV"}},{arcs:[[-192,229,230,-226,-229,231]],type:"Polygon",properties:{ADM0_A3:"GTM"}},{arcs:[[-191,232,-230]],type:"Polygon",properties:{ADM0_A3:"BLZ"}},{arcs:[[-200,-214,233,234]],type:"Polygon",properties:{ADM0_A3:"VEN"}},{arcs:[[-201,-235,235,236]],type:"Polygon",properties:{ADM0_A3:"GUY"}},{arcs:[[-202,-237,237,238]],type:"Polygon",properties:{ADM0_A3:"SUR"}},{arcs:[[[-203,-239,239]],[[240,241,242,243,244,245,246,247]],[[248]]],type:"MultiPolygon",properties:{ADM0_A3:"FRA"}},{arcs:[[-208,249,-210]],type:"Polygon",properties:{ADM0_A3:"ECU"}},{arcs:[[250]],type:"Polygon",properties:{ADM0_A3:"PRI"}},{arcs:[[251]],type:"Polygon",properties:{ADM0_A3:"JAM"}},{arcs:[[252]],type:"Polygon",properties:{ADM0_A3:"CUB"}},{arcs:[[-184,253,254,255]],type:"Polygon",properties:{ADM0_A3:"ZWE"}},{arcs:[[-183,256,257,-254]],type:"Polygon",properties:{ADM0_A3:"BWA"}},{arcs:[[-182,258,259,260,-257]],type:"Polygon",properties:{ADM0_A3:"NAM"}},{arcs:[[261,262,263,264,265,266,267]],type:"Polygon",properties:{ADM0_A3:"SEN"}},{arcs:[[-264,268,269,270,271,272,273]],type:"Polygon",properties:{ADM0_A3:"MLI"}},{arcs:[[-14,274,-269,-263,275]],type:"Polygon",properties:{ADM0_A3:"MRT"}},{arcs:[[276,277,278,279,280]],type:"Polygon",properties:{ADM0_A3:"BEN"}},{arcs:[[-132,281,282,-280,283,-271,284,285]],type:"Polygon",properties:{ADM0_A3:"NER"}},{arcs:[[-281,-283,286,287]],type:"Polygon",properties:{ADM0_A3:"NGA"}},{arcs:[[-131,288,289,290,291,292,-287,-282]],type:"Polygon",properties:{ADM0_A3:"CMR"}},{arcs:[[-278,293,294,295]],type:"Polygon",properties:{ADM0_A3:"TGO"}},{arcs:[[-295,296,297,298]],type:"Polygon",properties:{ADM0_A3:"GHA"}},{arcs:[[-273,299,-298,300,301,302]],type:"Polygon",properties:{ADM0_A3:"CIV"}},{arcs:[[-265,-274,-303,303,304,305,306]],type:"Polygon",properties:{ADM0_A3:"GIN"}},{arcs:[[-266,-307,307]],type:"Polygon",properties:{ADM0_A3:"GNB"}},{arcs:[[-302,308,309,-304]],type:"Polygon",properties:{ADM0_A3:"LBR"}},{arcs:[[-305,-310,310]],type:"Polygon",properties:{ADM0_A3:"SLE"}},{arcs:[[-272,-284,-279,-296,-299,-300]],type:"Polygon",properties:{ADM0_A3:"BFA"}},{arcs:[[-109,311,-289,-130,-122,312]],type:"Polygon",properties:{ADM0_A3:"CAF"}},{arcs:[[-108,313,314,315,-290,-312]],type:"Polygon",properties:{ADM0_A3:"COG"}},{arcs:[[-291,-316,316,317]],type:"Polygon",properties:{ADM0_A3:"GAB"}},{arcs:[[-292,-318,318]],type:"Polygon",properties:{ADM0_A3:"GNQ"}},{arcs:[[-8,319,320,-255,-258,-261,321,-104]],type:"Polygon",properties:{ADM0_A3:"ZMB"}},{arcs:[[-7,322,-320]],type:"Polygon",properties:{ADM0_A3:"MWI"}},{arcs:[[-6,323,-187,324,-185,-256,-321,-323]],type:"Polygon",properties:{ADM0_A3:"MOZ"}},{arcs:[[-186,-325]],type:"Polygon",properties:{ADM0_A3:"SWZ"}},{arcs:[[[-107,325,-314]],[[-105,-322,-260,326]]],type:"MultiPolygon",properties:{ADM0_A3:"AGO"}},{arcs:[[-10,-113,327]],type:"Polygon",properties:{ADM0_A3:"BDI"}},{arcs:[[328,329,330,331,332,333,334,335]],type:"Polygon",properties:{ADM0_A3:"ISR"}},{arcs:[[-335,336,337]],type:"Polygon",properties:{ADM0_A3:"LBN"}},{arcs:[[338]],type:"Polygon",properties:{ADM0_A3:"MDG"}},{arcs:[[-330,339]],type:"Polygon",properties:{ADM0_A3:"PSX"}},{arcs:[[-268,340]],type:"Polygon",properties:{ADM0_A3:"GMB"}},{arcs:[[341,342,343]],type:"Polygon",properties:{ADM0_A3:"TUN"}},{arcs:[[-13,344,345,-342,346,-285,-270,-275]],type:"Polygon",properties:{ADM0_A3:"DZA"}},{arcs:[[-329,347,348,349,350,-331,-340]],type:"Polygon",properties:{ADM0_A3:"JOR"}},{arcs:[[351,352,353,354,355]],type:"Polygon",properties:{ADM0_A3:"ARE"}},{arcs:[[356,357]],type:"Polygon",properties:{ADM0_A3:"QAT"}},{arcs:[[358,359,360]],type:"Polygon",properties:{ADM0_A3:"KWT"}},{arcs:[[-349,361,362,363,364,-361,365]],type:"Polygon",properties:{ADM0_A3:"IRQ"}},{arcs:[[[-355,366,367,368]],[[-353,369]]],type:"MultiPolygon",properties:{ADM0_A3:"OMN"}},{arcs:[[[370]],[[371]]],type:"MultiPolygon",properties:{ADM0_A3:"VUT"}},{arcs:[[372,373,374,375]],type:"Polygon",properties:{ADM0_A3:"KHM"}},{arcs:[[-373,376,377,378,379,380]],type:"Polygon",properties:{ADM0_A3:"THA"}},{arcs:[[-374,-381,381,382,383]],type:"Polygon",properties:{ADM0_A3:"LAO"}},{arcs:[[-380,384,385,386,387,-382]],type:"Polygon",properties:{ADM0_A3:"MMR"}},{arcs:[[-375,-384,388,389]],type:"Polygon",properties:{ADM0_A3:"VNM"}},{arcs:[[-150,390,391,392,393]],type:"Polygon",properties:{ADM0_A3:"PRK"}},{arcs:[[-392,394]],type:"Polygon",properties:{ADM0_A3:"KOR"}},{arcs:[[-152,395]],type:"Polygon",properties:{ADM0_A3:"MNG"}},{arcs:[[-387,396,397,398,399,400,401,402,403]],type:"Polygon",properties:{ADM0_A3:"IND"}},{arcs:[[-386,404,-397]],type:"Polygon",properties:{ADM0_A3:"BGD"}},{arcs:[[-403,405]],type:"Polygon",properties:{ADM0_A3:"BTN"}},{arcs:[[-401,406]],type:"Polygon",properties:{ADM0_A3:"NPL"}},{arcs:[[-399,407,408,409,410]],type:"Polygon",properties:{ADM0_A3:"PAK"}},{arcs:[[-70,411,412,-410,413,414]],type:"Polygon",properties:{ADM0_A3:"AFG"}},{arcs:[[-69,415,416,-412]],type:"Polygon",properties:{ADM0_A3:"TJK"}},{arcs:[[-63,417,-416,-68]],type:"Polygon",properties:{ADM0_A3:"KGZ"}},{arcs:[[-65,-71,-415,418,419]],type:"Polygon",properties:{ADM0_A3:"TKM"}},{arcs:[[-364,420,421,422,423,424,-419,-414,-409,425]],type:"Polygon",properties:{ADM0_A3:"IRN"}},{arcs:[[-336,-338,426,427,-362,-348]],type:"Polygon",properties:{ADM0_A3:"SYR"}},{arcs:[[-423,428,429,430,431]],type:"Polygon",properties:{ADM0_A3:"ARM"}},{arcs:[[-175,432,433]],type:"Polygon",properties:{ADM0_A3:"SWE"}},{arcs:[[-143,434,435,436,437]],type:"Polygon",properties:{ADM0_A3:"BLR"}},{arcs:[[-142,438,-167,439,440,441,442,443,444,445,-435]],type:"Polygon",properties:{ADM0_A3:"UKR"}},{arcs:[[-436,-446,446,447,448,449,-160,450]],type:"Polygon",properties:{ADM0_A3:"POL"}},{arcs:[[451,452,453,454,455,456,457]],type:"Polygon",properties:{ADM0_A3:"AUT"}},{arcs:[[-444,458,459,460,461,-452,462]],type:"Polygon",properties:{ADM0_A3:"HUN"}},{arcs:[[-442,463]],type:"Polygon",properties:{ADM0_A3:"MDA"}},{arcs:[[-441,464,465,466,-459,-443,-464]],type:"Polygon",properties:{ADM0_A3:"ROU"}},{arcs:[[-437,-451,-162,467,468]],type:"Polygon",properties:{ADM0_A3:"LTU"}},{arcs:[[-144,-438,-469,469,470]],type:"Polygon",properties:{ADM0_A3:"LVA"}},{arcs:[[-145,-471,471]],type:"Polygon",properties:{ADM0_A3:"EST"}},{arcs:[[-449,472,-456,473,-241,474,475,476,477,478,479]],type:"Polygon",properties:{ADM0_A3:"DEU"}},{arcs:[[-466,480,481,482,483,484]],type:"Polygon",properties:{ADM0_A3:"BGR"}},{arcs:[[[485]],[[-483,486,487,488,489]]],type:"MultiPolygon",properties:{ADM0_A3:"GRC"}},{arcs:[[[-363,-428,490,491,-430,-421]],[[-482,492,-487]]],type:"MultiPolygon",properties:{ADM0_A3:"TUR"}},{arcs:[[-489,493,494,495,496]],type:"Polygon",properties:{ADM0_A3:"ALB"}},{arcs:[[-461,497,498,499,500,501]],type:"Polygon",properties:{ADM0_A3:"HRV"}},{arcs:[[-455,502,-242,-474]],type:"Polygon",properties:{ADM0_A3:"CHE"}},{arcs:[[-475,-248,503]],type:"Polygon",properties:{ADM0_A3:"LUX"}},{arcs:[[-476,-504,-247,504,505]],type:"Polygon",properties:{ADM0_A3:"BEL"}},{arcs:[[-477,-506,506]],type:"Polygon",properties:{ADM0_A3:"NLD"}},{arcs:[[507,508]],type:"Polygon",properties:{ADM0_A3:"PRT"}},{arcs:[[-508,509,-245,510]],type:"Polygon",properties:{ADM0_A3:"ESP"}},{arcs:[[511,512]],type:"Polygon",properties:{ADM0_A3:"IRL"}},{arcs:[[513]],type:"Polygon",properties:{ADM0_A3:"NCL"}},{arcs:[[[514]],[[515]],[[516]],[[517]],[[518]]],type:"MultiPolygon",properties:{ADM0_A3:"SLB"}},{arcs:[[[519]],[[520]]],type:"MultiPolygon",properties:{ADM0_A3:"NZL"}},{arcs:[[[521]],[[522]]],type:"MultiPolygon",properties:{ADM0_A3:"AUS"}},{arcs:[[523]],type:"Polygon",properties:{ADM0_A3:"LKA"}},{arcs:[[[524]],[[-62,-153,-396,-151,-394,525,-389,-383,-388,-404,-406,-402,-407,-400,-411,-413,-417,-418]]],type:"MultiPolygon",properties:{ADM0_A3:"CHN"}},{arcs:[[526]],type:"Polygon",properties:{ADM0_A3:"TWN"}},{arcs:[[[-454,527,528,-243,-503]],[[529]],[[530]]],type:"MultiPolygon",properties:{ADM0_A3:"ITA"}},{arcs:[[[-479,531]],[[532]]],type:"MultiPolygon",properties:{ADM0_A3:"DNK"}},{arcs:[[[-513,533]],[[534]]],type:"MultiPolygon",properties:{ADM0_A3:"GBR"}},{arcs:[[535]],type:"Polygon",properties:{ADM0_A3:"ISL"}},{arcs:[[[-139,536,-424,-432,537]],[[-422,-429]]],type:"MultiPolygon",properties:{ADM0_A3:"AZE"}},{arcs:[[-140,-538,-431,-492,538]],type:"Polygon",properties:{ADM0_A3:"GEO"}},{arcs:[[[539]],[[540]],[[541]],[[542]],[[543]],[[544]],[[545]]],type:"MultiPolygon",properties:{ADM0_A3:"PHL"}},{arcs:[[[-378,546]],[[-82,547,548,549]]],type:"MultiPolygon",properties:{ADM0_A3:"MYS"}},{arcs:[[-549,550]],type:"Polygon",properties:{ADM0_A3:"BRN"}},{arcs:[[-453,-462,-502,551,-528]],type:"Polygon",properties:{ADM0_A3:"SVN"}},{arcs:[[-147,552,-433,-174]],type:"Polygon",properties:{ADM0_A3:"FIN"}},{arcs:[[-445,-463,-458,553,-447]],type:"Polygon",properties:{ADM0_A3:"SVK"}},{arcs:[[-448,-554,-457,-473]],type:"Polygon",properties:{ADM0_A3:"CZE"}},{arcs:[[-127,554,555,556]],type:"Polygon",properties:{ADM0_A3:"ERI"}},{arcs:[[[557]],[[558]],[[559]]],type:"MultiPolygon",properties:{ADM0_A3:"JPN"}},{arcs:[[-196,-98,-205]],type:"Polygon",properties:{ADM0_A3:"PRY"}},{arcs:[[-368,560,561]],type:"Polygon",properties:{ADM0_A3:"YEM"}},{arcs:[[-350,-366,-360,562,-358,563,-356,-369,-562,564]],type:"Polygon",properties:{ADM0_A3:"SAU"}},{arcs:[[565,566]],type:"Polygon",properties:{ADM0_A3:"CYN"}},{arcs:[[-567,567]],type:"Polygon",properties:{ADM0_A3:"CYP"}},{arcs:[[-345,-16,568]],type:"Polygon",properties:{ADM0_A3:"MAR"}},{arcs:[[-125,569,570,-333,571]],type:"Polygon",properties:{ADM0_A3:"EGY"}},{arcs:[[-124,-133,-286,-347,-344,572,-570]],type:"Polygon",properties:{ADM0_A3:"LBY"}},{arcs:[[-115,-120,573,-128,-557,574,575]],type:"Polygon",properties:{ADM0_A3:"ETH"}},{arcs:[[-556,576,577,-575]],type:"Polygon",properties:{ADM0_A3:"DJI"}},{arcs:[[-116,-576,-578,578]],type:"Polygon",properties:{ADM0_A3:"SOL"}},{arcs:[[-12,579,-111,580,-118]],type:"Polygon",properties:{ADM0_A3:"UGA"}},{arcs:[[-11,-328,-112,-580]],type:"Polygon",properties:{ADM0_A3:"RWA"}},{arcs:[[-499,581,582]],type:"Polygon",properties:{ADM0_A3:"BIH"}},{arcs:[[-484,-490,-497,583,584]],type:"Polygon",properties:{ADM0_A3:"MKD"}},{arcs:[[-460,-467,-485,-585,585,586,-582,-498]],type:"Polygon",properties:{ADM0_A3:"SRB"}},{arcs:[[-495,587,-500,-583,-587,588]],type:"Polygon",properties:{ADM0_A3:"MNE"}},{arcs:[[-496,-589,-586,-584]],type:"Polygon",properties:{ADM0_A3:"KOS"}},{arcs:[[589]],type:"Polygon",properties:{ADM0_A3:"TTO"}},{arcs:[[-110,-313,-129,-574,-119,-581]],type:"Polygon",properties:{ADM0_A3:"SDS"}}]}};var Bw={type:Xy,arcs:Hy,transform:Yy,objects:Ky},T0=Object.freeze(Object.defineProperty({__proto__:null,type:Xy,arcs:Hy,transform:Yy,objects:Ky,default:Bw},Symbol.toStringTag,{value:"Module"}));function A0(h,o,l){const u=h.slice();return u[16]=o[l],u}function S0(h){let o,l;return{c(){o=fi("path"),this.h()},l(u){o=di(u,"path",{d:!0,class:!0}),Ce(o).forEach(W),this.h()},h(){H(o,"d",l=h[16].d),H(o,"class","svelte-1aifow3"),Dt(o,"active",h[1]===wp),Dt(o,"hover",h[0]===wp)},m(u,d){Me(u,o,d)},p(u,d){d&4&&l!==(l=u[16].d)&&H(o,"d",l),d&2&&Dt(o,"active",u[1]===wp),d&1&&Dt(o,"hover",u[0]===wp)},d(u){u&&W(o)}}}function M0(h){let o,l;return{c(){o=fi("path"),this.h()},l(u){o=di(u,"path",{d:!0,class:!0}),Ce(o).forEach(W),this.h()},h(){H(o,"d",l=h[4].d),H(o,"class","hover svelte-1aifow3")},m(u,d){Me(u,o,d)},p(u,d){d&16&&l!==(l=u[4].d)&&H(o,"d",l)},d(u){u&&W(o)}}}function I0(h){let o,l;return{c(){o=fi("path"),this.h()},l(u){o=di(u,"path",{d:!0,class:!0}),Ce(o).forEach(W),this.h()},h(){H(o,"d",l=h[5].d),H(o,"class","active svelte-1aifow3")},m(u,d){Me(u,o,d)},p(u,d){d&32&&l!==(l=u[5].d)&&H(o,"d",l)},d(u){u&&W(o)}}}function Ow(h){let o,l,u,d,g,y,n,w,T=h[2],M=[];for(let z=0;z<T.length;z+=1)M[z]=S0(A0(h,T,z));let I=h[4]&&M0(h),P=h[5]&&I0(h);return{c(){o=He("figure"),l=fi("svg"),u=fi("g"),d=fi("g");for(let z=0;z<M.length;z+=1)M[z].c();g=fi("g"),I&&I.c(),y=fi("g"),P&&P.c(),n=fi("desc"),w=Oe("TODO"),this.h()},l(z){o=Ye(z,"FIGURE",{class:!0,role:!0});var R=Ce(o);l=di(R,"svg",{class:!0,viewBox:!0,preserveAspectRatio:!0,"aria-describedby":!0,role:!0,fill:!0});var F=Ce(l);u=di(F,"g",{});var q=Ce(u);d=di(q,"g",{role:!0});var ae=Ce(d);for(let re=0;re<M.length;re+=1)M[re].l(ae);ae.forEach(W),g=di(q,"g",{role:!0});var se=Ce(g);I&&I.l(se),se.forEach(W),y=di(q,"g",{role:!0});var ie=Ce(y);P&&P.l(ie),ie.forEach(W),q.forEach(W),n=di(F,"desc",{id:!0});var Q=Ce(n);w=Fe(Q,"TODO"),Q.forEach(W),F.forEach(W),R.forEach(W),this.h()},h(){H(d,"role","list"),H(g,"role","list"),H(y,"role","list"),H(n,"id","map-description"),H(l,"class","vis"),H(l,"viewBox",h[6]),H(l,"preserveAspectRatio","xMinYMin meet"),H(l,"aria-describedby","map-description"),H(l,"role","group"),H(l,"fill","currentColor"),H(o,"class","page-map"),H(o,"role","main")},m(z,R){Me(z,o,R),de(o,l),de(l,u),de(u,d);for(let F=0;F<M.length;F+=1)M[F].m(d,null);de(u,g),I&&I.m(g,null),de(u,y),P&&P.m(y,null),de(l,n),de(n,w),h[12](l)},p(z,[R]){if(R&7){T=z[2];let F;for(F=0;F<T.length;F+=1){const q=A0(z,T,F);M[F]?M[F].p(q,R):(M[F]=S0(q),M[F].c(),M[F].m(d,null))}for(;F<M.length;F+=1)M[F].d(1);M.length=T.length}z[4]?I?I.p(z,R):(I=M0(z),I.c(),I.m(g,null)):I&&(I.d(1),I=null),z[5]?P?P.p(z,R):(P=I0(z),P.c(),P.m(y,null)):P&&(P.d(1),P=null),R&64&&H(l,"viewBox",z[6])},i:ti,o:ti,d(z){z&&W(o),Br(M,z),I&&I.d(),P&&P.d(),h[12](null)}}}const Fw="ne_110m_admin_0_countries",k0=2;function Uw(h,o,l){let u,d,g,y,n,w,T,{hovered:M}=o,{selected:I}=o;const P=ja(T0,["objects",Fw],{});$x(P)&&console.warn("Could not find any countries. The MAP_KEY might be wrong.");const z=Lw(T0,P);let R=100,F=50,q;Zp(async()=>{ae()});const ae=()=>{l(7,{width:R,height:F}=q.getBoundingClientRect(),R,l(8,F))};function se(ie){cr[ie?"unshift":"push"](()=>{q=ie,l(3,q)})}return h.$$set=ie=>{"hovered"in ie&&l(0,M=ie.hovered),"selected"in ie&&l(1,I=ie.selected)},h.$$.update=()=>{h.$$.dirty&384&&l(11,u=Math.min(R,F*k0)),h.$$.dirty&2048&&l(6,d=`0 0 ${u} ${u/k0}`),h.$$.dirty&384&&l(10,g=Cw().rotate([0,0]).precision(.1).fitSize([R,F],z)),h.$$.dirty&1024&&l(9,y=gw().projection(g)),h.$$.dirty&512&&l(2,n=Wx(ja(z,"features",[]),(ie,Q)=>{const re=y(ie);return{code:ja(ie,["properties","ADM0_A3"]),d:re}})),h.$$.dirty&6&&l(5,w=n.find(({code:ie})=>ie===I)),h.$$.dirty&5&&l(4,T=n.find(({code:ie})=>ie===M))},[M,I,n,q,T,w,d,R,F,y,g,u,se]}class Vw extends Jt{constructor(o){super(),Qt(this,o,Uw,Ow,ei,{hovered:0,selected:1})}}function C0(h){let o,l=h[12].continent.label+"",u;return{c(){o=He("span"),u=Oe(l)},l(d){o=Ye(d,"SPAN",{});var g=Ce(o);u=Fe(g,l),g.forEach(W)},m(d,g){Me(d,o,g),de(o,u)},p(d,g){g&4096&&l!==(l=d[12].continent.label+"")&&zt(u,l)},d(d){d&&W(o)}}}function z0(h){let o,l,u=h[12].emoji+"",d;return{c(){o=He("span"),l=He("i"),d=Oe(u),this.h()},l(g){o=Ye(g,"SPAN",{});var y=Ce(o);l=Ye(y,"I",{class:!0});var n=Ce(l);d=Fe(n,u),n.forEach(W),y.forEach(W),this.h()},h(){H(l,"class","emoji")},m(g,y){Me(g,o,y),de(o,l),de(l,d)},p(g,y){y&4096&&u!==(u=g[12].emoji+"")&&zt(d,u)},d(g){g&&W(o)}}}function Nw(h){var n,w;let o,l,u,d=h[12].label+"",g=((w=(n=h[12])==null?void 0:n.continent)==null?void 0:w.label)&&C0(h),y=h[12].emoji&&z0(h);return{c(){g&&g.c(),o=bt(),y&&y.c(),l=bt(),u=He("span")},l(T){g&&g.l(T),o=wt(T),y&&y.l(T),l=wt(T),u=Ye(T,"SPAN",{});var M=Ce(u);M.forEach(W)},m(T,M){g&&g.m(T,M),Me(T,o,M),y&&y.m(T,M),Me(T,l,M),Me(T,u,M),u.innerHTML=d},p(T,M){var I,P;(P=(I=T[12])==null?void 0:I.continent)!=null&&P.label?g?g.p(T,M):(g=C0(T),g.c(),g.m(o.parentNode,o)):g&&(g.d(1),g=null),T[12].emoji?y?y.p(T,M):(y=z0(T),y.c(),y.m(l.parentNode,l)):y&&(y.d(1),y=null),M&4096&&d!==(d=T[12].label+"")&&(u.innerHTML=d)},d(T){g&&g.d(T),T&&W(o),y&&y.d(T),T&&W(l),T&&W(u)}}}function jw(h){let o,l;function u(){return h[8](h[12])}return o=new Z4({props:{value:h[12].uid,$$slots:{default:[Nw]},$$scope:{ctx:h}}}),o.$on("mouseover",u),o.$on("mouseleave",h[9]),{c(){ht(o.$$.fragment)},l(d){pt(o.$$.fragment,d)},m(d,g){ft(o,d,g),l=!0},p(d,g){h=d;const y={};g&4096&&(y.value=h[12].uid),g&12288&&(y.$$scope={dirty:g,ctx:h}),o.$set(y)},i(d){l||(Le(o.$$.fragment,d),l=!0)},o(d){Xe(o.$$.fragment,d),l=!1},d(d){dt(o,d)}}}function Gw(h){let o,l,u,d,g,y,n;return d=new Q5({props:{items:h[2],$$slots:{default:[jw,({item:w})=>({12:w}),({item:w})=>w?4096:0]},$$scope:{ctx:h}}}),{c(){o=He("input"),l=bt(),u=He("div"),ht(d.$$.fragment),this.h()},l(w){o=Ye(w,"INPUT",{class:!0,type:!0,placeholder:!0}),l=wt(w),u=Ye(w,"DIV",{class:!0});var T=Ce(u);pt(d.$$.fragment,T),T.forEach(W),this.h()},h(){H(o,"class","searchbox svelte-gp3wn5"),H(o,"type","text"),H(o,"placeholder","Search\u2026"),H(u,"class","country-container svelte-gp3wn5")},m(w,T){Me(w,o,T),W_(o,h[0]),Me(w,l,T),Me(w,u,T),ft(d,u,null),g=!0,y||(n=Oi(o,"input",h[7]),y=!0)},p(w,T){T&1&&o.value!==w[0]&&W_(o,w[0]);const M={};T&4&&(M.items=w[2]),T&12290&&(M.$$scope={dirty:T,ctx:w}),d.$set(M)},i(w){g||(Le(d.$$.fragment,w),g=!0)},o(w){Xe(d.$$.fragment,w),g=!1},d(w){w&&W(o),w&&W(l),w&&W(u),dt(d),y=!1,n()}}}function qw(h){let o,l,u,d,g,y;function n(T){h[10](T)}let w={legend:"Countries",$$slots:{default:[Gw]},$$scope:{ctx:h}};return h[3]!==void 0&&(w.selected=h[3]),l=new j4({props:w}),cr.push(()=>zn(l,"selected",n)),g=new Vw({props:{hovered:h[1],selected:h[3]}}),{c(){o=He("div"),ht(l.$$.fragment),d=bt(),ht(g.$$.fragment),this.h()},l(T){o=Ye(T,"DIV",{class:!0});var M=Ce(o);pt(l.$$.fragment,M),d=wt(M),pt(g.$$.fragment,M),M.forEach(W),this.h()},h(){H(o,"class","selection-country-wrapper svelte-gp3wn5")},m(T,M){Me(T,o,M),ft(l,o,null),de(o,d),ft(g,o,null),y=!0},p(T,[M]){const I={};M&8199&&(I.$$scope={dirty:M,ctx:T}),!u&&M&8&&(u=!0,I.selected=T[3],Cn(()=>u=!1)),l.$set(I);const P={};M&2&&(P.hovered=T[1]),M&8&&(P.selected=T[3]),g.$set(P)},i(T){y||(Le(l.$$.fragment,T),Le(g.$$.fragment,T),y=!0)},o(T){Xe(l.$$.fragment,T),Xe(g.$$.fragment,T),y=!1},d(T){T&&W(o),dt(l),dt(g)}}}function Zw(h,o,l){let u,d,g,y,n;xt(h,Xx,F=>l(6,y=F)),xt(h,Pd,F=>l(3,n=F));const w={includeScore:!0,keys:["label","uid"],includeMatches:!0};let T="",M;function I(){T=this.value,l(0,T)}const P=F=>l(1,M=F==null?void 0:F.uid),z=()=>l(1,M=void 0);function R(F){n=F,Pd.set(n)}return h.$$.update=()=>{h.$$.dirty&64&&l(4,u=new lc(y,w)),h.$$.dirty&64&&l(5,d=f1(y.map(F=>({item:F})),["item.hasContinent","item.continent.label","item.label"])),h.$$.dirty&49&&l(2,g=(T===""?d:u.search(T)).map(({item:F,matches:q})=>{let ae=F.label;if(q){const se=q.find(ie=>ie.key==="label");if(se){ae="";for(let ie=0;ie<se.indices.length;ie++){const[Q,re]=se.indices[ie];if(ie===0&&(Q===0||re===0||(ae+=`${F.label.substring(0,Q)}`)),ae+=`<mark>${F.label.substring(Q,re+1)}</mark>`,re!==F.label.length-1){let Ae=F.label.length;se.indices[ie+1]&&([Ae]=se.indices[ie+1]),ae+=`${F.label.substring(re+1,Ae)}`}}}}return Ur(Xi({},F),{label:ae,matches:q})}))},[T,M,g,n,u,d,y,I,P,z,R]}class $w extends Jt{constructor(o){super(),Qt(this,o,Zw,qw,ei,{})}}function P0(h,o,l){const u=h.slice();return u[4]=o[l].label,u[7]=o[l].emoji,u[8]=o[l].isAvailable,u}function D0(h,o,l){const u=h.slice();return u[3]=o[l].uid,u[4]=o[l].label,u}function L0(h){let o,l;return o=new Gs({props:{label:h[4],icon:h[7],disabled:!h[8]}}),{c(){ht(o.$$.fragment)},l(u){pt(o.$$.fragment,u)},m(u,d){ft(o,u,d),l=!0},p(u,d){const g={};d&2&&(g.label=u[4]),d&2&&(g.icon=u[7]),d&2&&(g.disabled=!u[8]),o.$set(g)},i(u){l||(Le(o.$$.fragment,u),l=!0)},o(u){Xe(o.$$.fragment,u),l=!1},d(u){dt(o,u)}}}function Ww(h){let o,l,u,d,g,y=h[1],n=[];for(let T=0;T<y.length;T+=1)n[T]=L0(P0(h,y,T));const w=T=>Xe(n[T],1,1,()=>{n[T]=null});return{c(){o=He("span"),l=Oe("Geographies"),u=bt();for(let T=0;T<n.length;T+=1)n[T].c();d=Gi(),this.h()},l(T){o=Ye(T,"SPAN",{class:!0});var M=Ce(o);l=Fe(M,"Geographies"),M.forEach(W),u=wt(T);for(let I=0;I<n.length;I+=1)n[I].l(T);d=Gi(),this.h()},h(){H(o,"class","text-label text-label--bold")},m(T,M){Me(T,o,M),de(o,l),Me(T,u,M);for(let I=0;I<n.length;I+=1)n[I].m(T,M);Me(T,d,M),g=!0},p(T,M){if(M&2){y=T[1];let I;for(I=0;I<y.length;I+=1){const P=P0(T,y,I);n[I]?(n[I].p(P,M),Le(n[I],1)):(n[I]=L0(P),n[I].c(),Le(n[I],1),n[I].m(d.parentNode,d))}for(br(),I=y.length;I<n.length;I+=1)w(I);wr()}},i(T){if(!g){for(let M=0;M<y.length;M+=1)Le(n[M]);g=!0}},o(T){n=n.filter(Boolean);for(let M=0;M<n.length;M+=1)Xe(n[M]);g=!1},d(T){T&&W(o),T&&W(u),Br(n,T),T&&W(d)}}}function Xw(h){let o,l=h[4]+"",u;return{c(){o=Oe("Other geography: "),u=Oe(l)},l(d){o=Fe(d,"Other geography: "),u=Fe(d,l)},m(d,g){Me(d,o,g),Me(d,u,g)},p(d,g){g&2&&l!==(l=d[4]+"")&&zt(u,l)},i:ti,o:ti,d(d){d&&W(o),d&&W(u)}}}function Hw(h){let o,l;return o=new $w({}),{c(){ht(o.$$.fragment)},l(u){pt(o.$$.fragment,u)},m(u,d){ft(o,u,d),l=!0},p:ti,i(u){l||(Le(o.$$.fragment,u),l=!0)},o(u){Xe(o.$$.fragment,u),l=!1},d(u){dt(o,u)}}}function Yw(h){let o,l,u,d;const g=[Hw,Xw],y=[];function n(w,T){return w[3]==="admin0"?0:1}return o=n(h),l=y[o]=g[o](h),{c(){l.c(),u=bt()},l(w){l.l(w),u=wt(w)},m(w,T){y[o].m(w,T),Me(w,u,T),d=!0},p(w,T){let M=o;o=n(w),o===M?y[o].p(w,T):(br(),Xe(y[M],1,1,()=>{y[M]=null}),wr(),l=y[o],l?l.p(w,T):(l=y[o]=g[o](w),l.c()),Le(l,1),l.m(u.parentNode,u))},i(w){d||(Le(l),d=!0)},o(w){Xe(l),d=!1},d(w){y[o].d(w),w&&W(u)}}}function R0(h){let o,l;return o=new ao({props:{$$slots:{default:[Yw]},$$scope:{ctx:h}}}),{c(){ht(o.$$.fragment)},l(u){pt(o.$$.fragment,u)},m(u,d){ft(o,u,d),l=!0},p(u,d){const g={};d&2050&&(g.$$scope={dirty:d,ctx:u}),o.$set(g)},i(u){l||(Le(o.$$.fragment,u),l=!0)},o(u){Xe(o.$$.fragment,u),l=!1},d(u){dt(o,u)}}}function Kw(h){let o,l,u=h[1],d=[];for(let y=0;y<u.length;y+=1)d[y]=R0(D0(h,u,y));const g=y=>Xe(d[y],1,1,()=>{d[y]=null});return{c(){for(let y=0;y<d.length;y+=1)d[y].c();o=Gi()},l(y){for(let n=0;n<d.length;n+=1)d[n].l(y);o=Gi()},m(y,n){for(let w=0;w<d.length;w+=1)d[w].m(y,n);Me(y,o,n),l=!0},p(y,n){if(n&2){u=y[1];let w;for(w=0;w<u.length;w+=1){const T=D0(y,u,w);d[w]?(d[w].p(T,n),Le(d[w],1)):(d[w]=R0(T),d[w].c(),Le(d[w],1),d[w].m(o.parentNode,o))}for(br(),w=u.length;w<d.length;w+=1)g(w);wr()}},i(y){if(!l){for(let n=0;n<u.length;n+=1)Le(d[n]);l=!0}},o(y){d=d.filter(Boolean);for(let n=0;n<d.length;n+=1)Xe(d[n]);l=!1},d(y){Br(d,y),y&&W(o)}}}function Jw(h){let o,l,u,d,g,y,n;function w(M){h[2](M)}let T={$$slots:{content:[Kw],default:[Ww]},$$scope:{ctx:h}};return h[0]!==void 0&&(T.selected=h[0]),g=new Uu({props:T}),cr.push(()=>zn(g,"selected",w)),{c(){o=He("div"),l=He("span"),u=Oe("Select a geography to explore"),d=bt(),ht(g.$$.fragment),this.h()},l(M){o=Ye(M,"DIV",{class:!0});var I=Ce(o);l=Ye(I,"SPAN",{class:!0});var P=Ce(l);u=Fe(P,"Select a geography to explore"),P.forEach(W),d=wt(I),pt(g.$$.fragment,I),I.forEach(W),this.h()},h(){H(l,"class","intro svelte-4la116"),H(o,"class","geography-selection svelte-4la116")},m(M,I){Me(M,o,I),de(o,l),de(l,u),de(o,d),ft(g,o,null),n=!0},p(M,[I]){const P={};I&2050&&(P.$$scope={dirty:I,ctx:M}),!y&&I&1&&(y=!0,P.selected=M[0],Cn(()=>y=!1)),g.$set(P)},i(M){n||(Le(g.$$.fragment,M),n=!0)},o(M){Xe(g.$$.fragment,M),n=!1},d(M){M&&W(o),dt(g)}}}function Qw(h,o,l){let u,d;xt(h,J_,y=>l(0,u=y)),xt(h,Hx,y=>l(1,d=y));function g(y){u=y,J_.set(u)}return[u,d,g]}class e6 extends Jt{constructor(o){super(),Qt(this,o,Qw,Jw,ei,{})}}function B0(h){let o;return{c(){o=fi("path"),this.h()},l(l){o=di(l,"path",{d:!0,class:!0,stroke:!0,fill:!0,"stroke-width":!0}),Ce(o).forEach(W),this.h()},h(){H(o,"d","M9 12l2 2l4 -4"),H(o,"class","mark svelte-17tqfyl"),H(o,"stroke","currentColor"),H(o,"fill","none"),H(o,"stroke-width","2")},m(l,u){Me(l,o,u)},d(l){l&&W(o)}}}function t6(h){let o,l,u,d,g,y,n,w,T,M,I,P,z,R,F,q,ae=h[0]&&B0(),se=[h[17]],ie={};for(let Q=0;Q<se.length;Q+=1)ie=Fi(ie,se[Q]);return{c(){o=He("div"),l=He("input"),u=bt(),d=He("label"),g=fi("svg"),y=fi("rect"),ae&&ae.c(),w=bt(),T=He("div"),M=Oe(h[9]),I=bt(),P=fi("svg"),z=fi("circle"),this.h()},l(Q){o=Ye(Q,"DIV",{});var re=Ce(o);l=Ye(re,"INPUT",{type:!0,id:!0,name:!0,class:!0}),u=wt(re),d=Ye(re,"LABEL",{for:!0,title:!0,"aria-disabled":!0,class:!0});var Ae=Ce(d);g=di(Ae,"svg",{xmlns:!0,class:!0,width:!0,height:!0,viewBox:!0,"stroke-linecap":!0,"stroke-linejoin":!0});var $e=Ce(g);y=di($e,"rect",{x:!0,y:!0,width:!0,height:!0,rx:!0,class:!0,stroke:!0,fill:!0,"stroke-width":!0}),Ce(y).forEach(W),ae&&ae.l($e),$e.forEach(W),w=wt(Ae),T=Ye(Ae,"DIV",{class:!0});var Je=Ce(T);M=Fe(Je,h[9]),Je.forEach(W),I=wt(Ae),P=di(Ae,"svg",{xmlns:!0,class:!0,width:!0,height:!0,viewBox:!0,"stroke-width":!0,stroke:!0,fill:!0,"stroke-linecap":!0,"stroke-linejoin":!0});var ze=Ce(P);z=di(ze,"circle",{cx:!0,cy:!0,r:!0}),Ce(z).forEach(W),ze.forEach(W),Ae.forEach(W),re.forEach(W),this.h()},h(){H(l,"type","checkbox"),l.value=h[4],l.checked=h[0],l.disabled=h[15],H(l,"id",h[11]),l.indeterminate=h[6],H(l,"name",h[10]),l.required=h[7],l.readOnly=h[8],H(l,"class","svelte-17tqfyl"),Dt(l,"checkbox",!0),H(y,"x","4"),H(y,"y","4"),H(y,"width","16"),H(y,"height","16"),H(y,"rx","2"),H(y,"class","box svelte-17tqfyl"),H(y,"stroke","currentColor"),H(y,"fill",n=h[0]?"currentColor":"none"),H(y,"stroke-width","1"),H(g,"xmlns","http://www.w3.org/2000/svg"),H(g,"class","icon checkbox"),H(g,"width","24"),H(g,"height","24"),H(g,"viewBox","0 0 24 24"),H(g,"stroke-linecap","round"),H(g,"stroke-linejoin","round"),H(T,"class","svelte-17tqfyl"),Dt(T,"checkbox-label-text",!0),H(z,"cx","12"),H(z,"cy","12"),H(z,"r","5"),H(P,"xmlns","http://www.w3.org/2000/svg"),H(P,"class","icon color-indicator svelte-17tqfyl"),H(P,"width","24"),H(P,"height","24"),H(P,"viewBox","0 0 24 24"),H(P,"stroke-width","2"),H(P,"stroke","none"),H(P,"fill","currentColor"),H(P,"stroke-linecap","round"),H(P,"stroke-linejoin","round"),H(d,"for",h[11]),H(d,"title",h[2]),H(d,"aria-disabled",h[15]),H(d,"class",R=Cp(h[0]?`checked-${h[16]}`:"")+" svelte-17tqfyl"),Dt(d,"checkbox-label",!0),Lr(o,ie),Dt(o,"form-item",!0),Dt(o,"checkbox-wrapper",!0),Dt(o,"svelte-17tqfyl",!0)},m(Q,re){Me(Q,o,re),de(o,l),h[26](l),de(o,u),de(o,d),de(d,g),de(g,y),ae&&ae.m(g,null),de(d,w),de(d,T),de(T,M),h[28](T),de(d,I),de(d,P),de(P,z),F||(q=[Oi(l,"change",h[27]),Oi(l,"change",h[24]),Oi(l,"blur",h[25]),Oi(o,"click",h[20]),Oi(o,"mouseover",h[21]),Oi(o,"mouseenter",h[22]),Oi(o,"mouseleave",h[23])],F=!0)},p(Q,[re]){re&16&&(l.value=Q[4]),re&1&&(l.checked=Q[0]),re&32768&&(l.disabled=Q[15]),re&2048&&H(l,"id",Q[11]),re&64&&(l.indeterminate=Q[6]),re&1024&&H(l,"name",Q[10]),re&128&&(l.required=Q[7]),re&256&&(l.readOnly=Q[8]),re&1&&n!==(n=Q[0]?"currentColor":"none")&&H(y,"fill",n),Q[0]?ae||(ae=B0(),ae.c(),ae.m(g,null)):ae&&(ae.d(1),ae=null),re&512&&zt(M,Q[9]),re&2048&&H(d,"for",Q[11]),re&4&&H(d,"title",Q[2]),re&32768&&H(d,"aria-disabled",Q[15]),re&65537&&R!==(R=Cp(Q[0]?`checked-${Q[16]}`:"")+" svelte-17tqfyl")&&H(d,"class",R),re&65537&&Dt(d,"checkbox-label",!0),Lr(o,ie=yn(se,[re&131072&&Q[17]])),Dt(o,"form-item",!0),Dt(o,"checkbox-wrapper",!0),Dt(o,"svelte-17tqfyl",!0)},i:ti,o:ti,d(Q){Q&&W(o),h[26](null),ae&&ae.d(),h[28](null),F=!1,$s(q)}}}function i6(h,o,l){let u,d,g,y,n;const w=["value","checked","maxSelectableItems","minSelectableItems","group","indeterminate","required","readonly","labelText","name","title","id","ref"];let T=Rr(o,w),{value:M=""}=o,{checked:I=!1}=o,{maxSelectableItems:P=3}=o,{minSelectableItems:z=1}=o,{group:R=void 0}=o,{indeterminate:F=!1}=o,{required:q=!1}=o,{readonly:ae=!1}=o,{labelText:se=""}=o,{name:ie=""}=o,{title:Q=void 0}=o,{id:re="ccs-"+Math.random().toString(36)}=o,{ref:Ae=null}=o;const $e=sc();let Je=null;function ze(_t){Vr.call(this,h,_t)}function Pe(_t){Vr.call(this,h,_t)}function Ge(_t){Vr.call(this,h,_t)}function Qe(_t){Vr.call(this,h,_t)}function Rt(_t){Vr.call(this,h,_t)}function mt(_t){Vr.call(this,h,_t)}function Ne(_t){cr[_t?"unshift":"push"](()=>{Ae=_t,l(3,Ae)})}const At=()=>{if(d)if(R.includes(M)){const _t=R.filter(Ht=>Ht!==M);l(1,R=_t.length>=z?_t:R)}else u||l(1,R=[...R,M]);else l(0,I=!I)};function $t(_t){cr[_t?"unshift":"push"](()=>{Je=_t,l(12,Je)})}return h.$$set=_t=>{o=Fi(Fi({},o),os(_t)),l(17,T=Rr(o,w)),"value"in _t&&l(4,M=_t.value),"checked"in _t&&l(0,I=_t.checked),"maxSelectableItems"in _t&&l(18,P=_t.maxSelectableItems),"minSelectableItems"in _t&&l(5,z=_t.minSelectableItems),"group"in _t&&l(1,R=_t.group),"indeterminate"in _t&&l(6,F=_t.indeterminate),"required"in _t&&l(7,q=_t.required),"readonly"in _t&&l(8,ae=_t.readonly),"labelText"in _t&&l(9,se=_t.labelText),"name"in _t&&l(10,ie=_t.name),"title"in _t&&l(2,Q=_t.title),"id"in _t&&l(11,re=_t.id),"ref"in _t&&l(3,Ae=_t.ref)},h.$$.update=()=>{h.$$.dirty&262146&&l(13,u=R.length>=P),h.$$.dirty&2&&l(14,d=Array.isArray(R)),h.$$.dirty&16403&&l(0,I=d?R.includes(M):I),h.$$.dirty&18&&l(16,g=R.indexOf(M)),h.$$.dirty&1&&$e("check",I),h.$$.dirty&4096&&l(19,y=(Je==null?void 0:Je.offsetWidth)<(Je==null?void 0:Je.scrollWidth)),h.$$.dirty&528388&&l(2,Q=!Q&&y?Je==null?void 0:Je.innerText:Q),h.$$.dirty&8193&&l(15,n=u&&!I)},[I,R,Q,Ae,M,z,F,q,ae,se,ie,re,Je,u,d,n,g,T,P,y,ze,Pe,Ge,Qe,Rt,mt,Ne,At,$t]}class r6 extends Jt{constructor(o){super(),Qt(this,o,i6,t6,ei,{value:4,checked:0,maxSelectableItems:18,minSelectableItems:5,group:1,indeterminate:6,required:7,readonly:8,labelText:9,name:10,title:2,id:11,ref:3})}}function O0(h,o,l){const u=h.slice();return u[6]=o[l],u}function F0(h){let o,l,u=h[6].label+"",d,g,y=h[6].label+"",n,w;return{c(){o=fi("g"),l=fi("text"),d=Oe(u),g=fi("text"),n=Oe(y),this.h()},l(T){o=di(T,"g",{transform:!0});var M=Ce(o);l=di(M,"text",{class:!0,"text-anchor":!0});var I=Ce(l);d=Fe(I,u),I.forEach(W),g=di(M,"text",{class:!0,"text-anchor":!0});var P=Ce(g);n=Fe(P,y),P.forEach(W),M.forEach(W),this.h()},h(){H(l,"class","chart-label chart-label--bold chart-label--bg"),H(l,"text-anchor","middle"),H(g,"class","chart-label chart-label--bold"),H(g,"text-anchor","middle"),H(o,"transform",w=`translate(0, ${-c1-4})`)},m(T,M){Me(T,o,M),de(o,l),de(l,d),de(o,g),de(g,n)},p(T,M){M&1&&u!==(u=T[6].label+"")&&zt(d,u),M&1&&y!==(y=T[6].label+"")&&zt(n,y)},d(T){T&&W(o)}}}function U0(h){let o,l,u,d,g,y=h[6].highlight&&F0(h);return{c(){o=fi("g"),l=fi("circle"),y&&y.c(),this.h()},l(n){o=di(n,"g",{transform:!0});var w=Ce(o);l=di(w,"circle",{class:!0,r:!0,style:!0}),Ce(l).forEach(W),y&&y.l(w),w.forEach(W),this.h()},h(){H(l,"class","dot svelte-cbgrwh"),H(l,"r",u=h[6].color||h[6].highlight?c1:V0),H(l,"style",d=`fill: ${h[6].color}`),Dt(l,"highlight",h[6].highlight),H(o,"transform",g=`translate(${h[1](h[6])}, ${h[2](h[6])})`)},m(n,w){Me(n,o,w),de(o,l),y&&y.m(o,null)},p(n,w){w&1&&u!==(u=n[6].color||n[6].highlight?c1:V0)&&H(l,"r",u),w&1&&d!==(d=`fill: ${n[6].color}`)&&H(l,"style",d),w&1&&Dt(l,"highlight",n[6].highlight),n[6].highlight?y?y.p(n,w):(y=F0(n),y.c(),y.m(o,null)):y&&(y.d(1),y=null),w&7&&g!==(g=`translate(${n[1](n[6])}, ${n[2](n[6])})`)&&H(o,"transform",g)},d(n){n&&W(o),y&&y.d()}}}function n6(h){let o,l=h[0],u=[];for(let d=0;d<l.length;d+=1)u[d]=U0(O0(h,l,d));return{c(){for(let d=0;d<u.length;d+=1)u[d].c();o=Gi()},l(d){for(let g=0;g<u.length;g+=1)u[g].l(d);o=Gi()},m(d,g){for(let y=0;y<u.length;y+=1)u[y].m(d,g);Me(d,o,g)},p(d,[g]){if(g&7){l=d[0];let y;for(y=0;y<l.length;y+=1){const n=O0(d,l,y);u[y]?u[y].p(n,g):(u[y]=U0(n),u[y].c(),u[y].m(o.parentNode,o))}for(;y<u.length;y+=1)u[y].d(1);u.length=l.length}},i:ti,o:ti,d(d){Br(u,d),d&&W(o)}}}const c1=8,V0=5;function o6(h,o,l){let u,d,g;const{data:y,xGet:n,yGet:w}=kr("LayerCake");return xt(h,y,T=>l(0,u=T)),xt(h,n,T=>l(1,d=T)),xt(h,w,T=>l(2,g=T)),[u,d,g,y,n,w]}class s6 extends Jt{constructor(o){super(),Qt(this,o,o6,n6,ei,{})}}function N0(h,o,l){const u=h.slice();return u[19]=o[l].label,u[20]=o[l].xMin,u[21]=o[l].xMax,u[22]=o[l].yMin,u[23]=o[l].yMax,u[24]=o[l].xText,u[25]=o[l].yText,u[26]=o[l].baseline,u[27]=o[l].fill,u[28]=o[l].uid,u}function j0(h){let o,l=h[19]+"",u,d,g,y;return{c(){o=fi("text"),u=Oe(l),this.h()},l(n){o=di(n,"text",{class:!0,"dominant-baseline":!0,x:!0,y:!0,"text-anchor":!0});var w=Ce(o);u=Fe(w,l),w.forEach(W),this.h()},h(){H(o,"class","chart-label"),H(o,"dominant-baseline",d=h[26]),H(o,"x",g=h[24]),H(o,"y",y=h[25]),H(o,"text-anchor","middle")},m(n,w){Me(n,o,w),de(o,u)},p(n,w){w&2&&l!==(l=n[19]+"")&&zt(u,l),w&2&&d!==(d=n[26])&&H(o,"dominant-baseline",d),w&2&&g!==(g=n[24])&&H(o,"x",g),w&2&&y!==(y=n[25])&&H(o,"y",y)},d(n){n&&W(o)}}}function G0(h){let o,l,u,d,g,y,n=h[19]&&j0(h);function w(){return h[12](h[28])}return{c(){o=fi("g"),l=fi("path"),n&&n.c(),this.h()},l(T){o=di(T,"g",{});var M=Ce(o);l=di(M,"path",{class:!0,d:!0,fill:!0}),Ce(l).forEach(W),n&&n.l(M),M.forEach(W),this.h()},h(){H(l,"class","sector svelte-el4psd"),H(l,"d",u=`M${h[20]} ${h[22]}H${h[21]}V${h[23]}H${h[20]}Z`),H(l,"fill",d=h[27])},m(T,M){Me(T,o,M),de(o,l),n&&n.m(o,null),g||(y=[Oi(o,"mouseenter",w),Oi(o,"mouseleave",h[13])],g=!0)},p(T,M){h=T,M&2&&u!==(u=`M${h[20]} ${h[22]}H${h[21]}V${h[23]}H${h[20]}Z`)&&H(l,"d",u),M&2&&d!==(d=h[27])&&H(l,"fill",d),h[19]?n?n.p(h,M):(n=j0(h),n.c(),n.m(o,null)):n&&(n.d(1),n=null)},d(T){T&&W(o),n&&n.d(),g=!1,$s(y)}}}function a6(h){let o,l=h[1],u=[];for(let d=0;d<l.length;d+=1)u[d]=G0(N0(h,l,d));return{c(){for(let d=0;d<u.length;d+=1)u[d].c();o=Gi()},l(d){for(let g=0;g<u.length;g+=1)u[g].l(d);o=Gi()},m(d,g){for(let y=0;y<u.length;y+=1)u[y].m(d,g);Me(d,o,g)},p(d,[g]){if(g&3){l=d[1];let y;for(y=0;y<l.length;y+=1){const n=N0(d,l,y);u[y]?u[y].p(n,g):(u[y]=G0(n),u[y].c(),u[y].m(o.parentNode,o))}for(;y<u.length;y+=1)u[y].d(1);u.length=l.length}},i:ti,o:ti,d(d){Br(u,d),d&&W(o)}}}function l6(h,o,l){let u,d,g,y,n,w;const{data:T,xGet:M,yGet:I,xDomain:P,yDomain:z,xScale:R,yScale:F}=kr("LayerCake");xt(h,P,Ae=>l(10,n=Ae)),xt(h,z,Ae=>l(8,g=Ae)),xt(h,R,Ae=>l(11,w=Ae)),xt(h,F,Ae=>l(9,y=Ae));const q=kr("theme");xt(h,q,Ae=>l(7,d=Ae));let{hoveredSector:ae="default"}=o;const se=[{uid:"high-overshoot",label:"High overshoot",x:[void 0,0],y:[1.6,void 0],bg:0},{uid:"high-warming",label:"High warming",x:[0,void 0],y:[1.6,void 0],bg:0},{x:[0,void 0],y:[1.5,1.6],bg:.5},{uid:"low-overshoot",x:[void 0,0],y:[1.5,1.6],bg:.5},{uid:"low-overshoot",label:"Low or no overshoot",x:[void 0,0],y:[void 0,1.5],textPostion:"bottom",bg:1},{x:[0,void 0],y:[void 0,1.5],bg:1}],ie=hy(d.color.petrol300,d.color.petrol100),Q=Ae=>l(0,ae=Ae),re=()=>l(0,ae=void 0);return h.$$set=Ae=>{"hoveredSector"in Ae&&l(0,ae=Ae.hoveredSector)},h.$$.update=()=>{h.$$.dirty&3969&&l(1,u=se.map(({label:Ae,x:$e,y:Je,textPostion:ze="top",bg:Pe,uid:Ge})=>{let[Qe,Rt]=$e,[mt,Ne]=Je;Qe=w(Q_([Qe,n[0]])),Rt=w(eg([Rt,n[1]])),mt=y(Q_([mt,g[0]])),Ne=y(eg([Ne,g[1]]));const At=Qe+(Rt-Qe)/2,$t=ze==="top"?Ne+3:mt-3,_t=ze==="top"?"hanging":"auto",Ht=Ge&&ae===Ge?d.color.petrol700:ie(Pe);return{label:Ae,xMin:Qe,xMax:Rt,yMin:mt,yMax:Ne,xText:At,yText:$t,baseline:_t,fill:Ht,uid:Ge}}))},[ae,u,P,z,R,F,q,d,g,y,n,w,Q,re]}class c6 extends Jt{constructor(o){super(),Qt(this,o,l6,a6,ei,{hoveredSector:0})}}function u6(h){let o,l,u;return{c(){o=fi("g"),l=fi("text"),u=Oe(h[0]),this.h()},l(d){o=di(d,"g",{class:!0});var g=Ce(o);l=di(g,"text",{x:!0,y:!0,"text-anchor":!0,class:!0,"dominant-baseline":!0});var y=Ce(l);u=Fe(y,h[0]),y.forEach(W),g.forEach(W),this.h()},h(){H(l,"x",h[2]),H(l,"y",h[1]),H(l,"text-anchor","middle"),H(l,"class","chart-label chart-label--bold"),H(l,"dominant-baseline","haning"),H(o,"class","axis x-axis x-axis-label")},m(d,g){Me(d,o,g),de(o,l),de(l,u)},p(d,[g]){g&1&&zt(u,d[0]),g&4&&H(l,"x",d[2]),g&2&&H(l,"y",d[1])},i:ti,o:ti,d(d){d&&W(o)}}}function h6(h,o,l){let u,d,g,y,n,w,T,M;const{xRange:I,yRange:P}=kr("LayerCake");xt(h,I,F=>l(10,M=F)),xt(h,P,F=>l(9,T=F));let{label:z}=o,{padding:R}=o;return h.$$set=F=>{"label"in F&&l(0,z=F.label),"padding"in F&&l(5,R=F.padding)},h.$$.update=()=>{h.$$.dirty&1024&&l(7,[u,d]=M,u,(l(8,d),l(10,M))),h.$$.dirty&512&&l(6,[g,y]=T,y),h.$$.dirty&384&&l(2,n=u+(d-u)/2),h.$$.dirty&96&&l(1,w=y-((R==null?void 0:R.top)||0))},[z,w,n,I,P,R,y,u,d,T,M]}class p6 extends Jt{constructor(o){super(),Qt(this,o,h6,u6,ei,{label:0,padding:5})}}function f6(h){let o,l,u,d;return{c(){o=fi("g"),l=fi("text"),u=Oe(h[0]),this.h()},l(g){o=di(g,"g",{class:!0});var y=Ce(o);l=di(y,"text",{transform:!0,x:!0,y:!0,"text-anchor":!0,class:!0,"dominant-baseline":!0});var n=Ce(l);u=Fe(n,h[0]),n.forEach(W),y.forEach(W),this.h()},h(){H(l,"transform",d=`rotate(90 ${h[1]} ${h[2]})`),H(l,"x",h[1]),H(l,"y",h[2]),H(l,"text-anchor","middle"),H(l,"class","chart-label chart-label--bold"),H(l,"dominant-baseline","hanging"),H(o,"class","axis x-axis x-axis-label")},m(g,y){Me(g,o,y),de(o,l),de(l,u)},p(g,[y]){y&1&&zt(u,g[0]),y&6&&d!==(d=`rotate(90 ${g[1]} ${g[2]})`)&&H(l,"transform",d),y&2&&H(l,"x",g[1]),y&4&&H(l,"y",g[2])},i:ti,o:ti,d(g){g&&W(o)}}}function d6(h,o,l){let u,d,g,y,n,w,T,M;const{yRange:I,xRange:P}=kr("LayerCake");xt(h,I,F=>l(10,M=F)),xt(h,P,F=>l(9,T=F));let{padding:z}=o,{label:R}=o;return h.$$set=F=>{"padding"in F&&l(5,z=F.padding),"label"in F&&l(0,R=F.label)},h.$$.update=()=>{h.$$.dirty&1024&&l(7,[u,d]=M,u,(l(8,d),l(10,M))),h.$$.dirty&512&&l(6,[g,y]=T,y),h.$$.dirty&384&&l(2,n=u+(d-u)/2),h.$$.dirty&96&&l(1,w=y+((z==null?void 0:z.right)||0))},[R,w,n,I,P,z,y,u,d,T,M]}class m6 extends Jt{constructor(o){super(),Qt(this,o,d6,f6,ei,{padding:5,label:0})}}function _6(h){let o,l,u,d,g,y,n,w,T,M,I,P,z;o=new cy({props:{padding:h[6],formatTick:h[5],ticks:[-.5,0,1.2],gridClass:"chart-gridline--invert"}}),u=new uy({props:{padding:h[6],formatTick:h[4],ticks:[1.3,1.5,1.6,2.3],gridClass:"chart-gridline--invert"}});function R(q){h[10](q)}let F={};return h[0]!==void 0&&(F.hoveredSector=h[0]),g=new c6({props:F}),cr.push(()=>zn(g,"hoveredSector",R)),w=new p6({props:{padding:h[6],label:"Warming between 2050 and 2100"}}),M=new m6({props:{padding:h[6],label:"Warming in 2050"}}),P=new s6({}),{c(){ht(o.$$.fragment),l=bt(),ht(u.$$.fragment),d=bt(),ht(g.$$.fragment),n=bt(),ht(w.$$.fragment),T=bt(),ht(M.$$.fragment),I=bt(),ht(P.$$.fragment)},l(q){pt(o.$$.fragment,q),l=wt(q),pt(u.$$.fragment,q),d=wt(q),pt(g.$$.fragment,q),n=wt(q),pt(w.$$.fragment,q),T=wt(q),pt(M.$$.fragment,q),I=wt(q),pt(P.$$.fragment,q)},m(q,ae){ft(o,q,ae),Me(q,l,ae),ft(u,q,ae),Me(q,d,ae),ft(g,q,ae),Me(q,n,ae),ft(w,q,ae),Me(q,T,ae),ft(M,q,ae),Me(q,I,ae),ft(P,q,ae),z=!0},p(q,ae){const se={};ae&32&&(se.formatTick=q[5]),o.$set(se);const ie={};ae&16&&(ie.formatTick=q[4]),u.$set(ie);const Q={};!y&&ae&1&&(y=!0,Q.hoveredSector=q[0],Cn(()=>y=!1)),g.$set(Q)},i(q){z||(Le(o.$$.fragment,q),Le(u.$$.fragment,q),Le(g.$$.fragment,q),Le(w.$$.fragment,q),Le(M.$$.fragment,q),Le(P.$$.fragment,q),z=!0)},o(q){Xe(o.$$.fragment,q),Xe(u.$$.fragment,q),Xe(g.$$.fragment,q),Xe(w.$$.fragment,q),Xe(M.$$.fragment,q),Xe(P.$$.fragment,q),z=!1},d(q){dt(o,q),q&&W(l),dt(u,q),q&&W(d),dt(g,q),q&&W(n),dt(w,q),q&&W(T),dt(M,q),q&&W(I),dt(P,q)}}}function g6(h){let o,l;return o=new Yp({props:{$$slots:{default:[_6]},$$scope:{ctx:h}}}),{c(){ht(o.$$.fragment)},l(u){pt(o.$$.fragment,u)},m(u,d){ft(o,u,d),l=!0},p(u,d){const g={};d&2097&&(g.$$scope={dirty:d,ctx:u}),o.$set(g)},i(u){l||(Le(o.$$.fragment,u),l=!0)},o(u){Xe(o.$$.fragment,u),l=!1},d(u){dt(o,u)}}}function y6(h){let o,l,u,d;return u=new Hp({props:{padding:h[6],x:h[1],y:h[2],data:h[3],flatData:h[3],xDomain:[-.5,1.2],yDomain:[1.3,2.3],$$slots:{default:[g6]},$$scope:{ctx:h}}}),{c(){o=He("div"),l=He("div"),ht(u.$$.fragment),this.h()},l(g){o=Ye(g,"DIV",{class:!0});var y=Ce(o);l=Ye(y,"DIV",{class:!0});var n=Ce(l);pt(u.$$.fragment,n),n.forEach(W),y.forEach(W),this.h()},h(){H(l,"class","chart-container svelte-1hoy26s"),H(o,"class","figure-container svelte-1hoy26s")},m(g,y){Me(g,o,y),de(o,l),ft(u,l,null),d=!0},p(g,[y]){const n={};y&2&&(n.x=g[1]),y&4&&(n.y=g[2]),y&8&&(n.data=g[3]),y&8&&(n.flatData=g[3]),y&2097&&(n.$$scope={dirty:y,ctx:g}),u.$set(n)},i(g){d||(Le(u.$$.fragment,g),d=!0)},o(g){Xe(u.$$.fragment,g),d=!1},d(g){g&&W(o),dt(u)}}}function v6(h,o,l){let u,d,g,{data:y=[]}=o,{xKey:n="x"}=o,{yKey:w="y"}=o,{unitX:T=zd}=o,{unitY:M=zd}=o;const I={top:5,right:15,bottom:20,left:40};let{hoveredSector:P}=o;function z(R){P=R,l(0,P)}return h.$$set=R=>{"data"in R&&l(7,y=R.data),"xKey"in R&&l(1,n=R.xKey),"yKey"in R&&l(2,w=R.yKey),"unitX"in R&&l(8,T=R.unitX),"unitY"in R&&l(9,M=R.unitY),"hoveredSector"in R&&l(0,P=R.hoveredSector)},h.$$.update=()=>{h.$$.dirty&256&&l(5,u=R=>Hr(R,T)),h.$$.dirty&512&&l(4,d=R=>Hr(R,M)),h.$$.dirty&128&&l(3,g=f1(y,["highlight","isSelected"]))},[P,n,w,g,d,u,I,y,T,M,z]}class x6 extends Jt{constructor(o){super(),Qt(this,o,v6,y6,ei,{data:7,xKey:1,yKey:2,unitX:8,unitY:9,hoveredSector:0})}}const{Boolean:b6}=zx;function q0(h,o,l){const u=h.slice();return u[25]=o[l],u}function w6(h){let o,l,u;function d(n){h[19](n)}function g(){return h[20](h[25])}let y={labelText:h[25].label,value:h[25].uid};return h[13]!==void 0&&(y.group=h[13]),o=new r6({props:y}),cr.push(()=>zn(o,"group",d)),o.$on("mouseover",g),o.$on("mouseleave",h[21]),{c(){ht(o.$$.fragment)},l(n){pt(o.$$.fragment,n)},m(n,w){ft(o,n,w),u=!0},p(n,w){h=n;const T={};w&4096&&(T.labelText=h[25].label),w&4096&&(T.value=h[25].uid),!l&&w&8192&&(l=!0,T.group=h[13],Cn(()=>l=!1)),o.$set(T)},i(n){u||(Le(o.$$.fragment,n),u=!0)},o(n){Xe(o.$$.fragment,n),u=!1},d(n){dt(o,n)}}}function E6(h){let o,l=h[25].label+"",u;return{c(){o=He("span"),u=Oe(l),this.h()},l(d){o=Ye(d,"SPAN",{class:!0});var g=Ce(o);u=Fe(g,l),g.forEach(W),this.h()},h(){H(o,"class","text-label text-label--bold")},m(d,g){Me(d,o,g),de(o,u)},p(d,g){g&4096&&l!==(l=d[25].label+"")&&zt(u,l)},i:ti,o:ti,d(d){d&&W(o)}}}function Z0(h){let o,l,u,d;const g=[E6,w6],y=[];function n(w,T){return w[25].isSpacer?0:1}return o=n(h),l=y[o]=g[o](h),{c(){l.c(),u=Gi()},l(w){l.l(w),u=Gi()},m(w,T){y[o].m(w,T),Me(w,u,T),d=!0},p(w,T){let M=o;o=n(w),o===M?y[o].p(w,T):(br(),Xe(y[M],1,1,()=>{y[M]=null}),wr(),l=y[o],l?l.p(w,T):(l=y[o]=g[o](w),l.c()),Le(l,1),l.m(u.parentNode,u))},i(w){d||(Le(l),d=!0)},o(w){Xe(l),d=!1},d(w){y[o].d(w),w&&W(u)}}}function $0(h){let o,l,u=h[3].label+"",d,g,y,n=(h[3].description||"Description missing")+"",w,T;return{c(){o=He("div"),l=He("h3"),d=Oe(u),g=bt(),y=He("p"),w=Oe(n),this.h()},l(M){o=Ye(M,"DIV",{});var I=Ce(o);l=Ye(I,"H3",{});var P=Ce(l);d=Fe(P,u),P.forEach(W),g=wt(I),y=Ye(I,"P",{});var z=Ce(y);w=Fe(z,n),z.forEach(W),I.forEach(W),this.h()},h(){$p(()=>h[22].call(o))},m(M,I){Me(M,o,I),de(o,l),de(l,d),de(o,g),de(o,y),de(y,w),T=h1(o,h[22].bind(o))},p(M,I){I&8&&u!==(u=M[3].label+"")&&zt(d,u),I&8&&n!==(n=(M[3].description||"Description missing")+"")&&zt(w,n)},d(M){M&&W(o),T()}}}function T6(h){let o,l,u,d;return o=new Gs({props:{label:"Overshoot vs warming"}}),u=new Gs({props:{label:"Trajectories"}}),{c(){ht(o.$$.fragment),l=bt(),ht(u.$$.fragment)},l(g){pt(o.$$.fragment,g),l=wt(g),pt(u.$$.fragment,g)},m(g,y){ft(o,g,y),Me(g,l,y),ft(u,g,y),d=!0},p:ti,i(g){d||(Le(o.$$.fragment,g),Le(u.$$.fragment,g),d=!0)},o(g){Xe(o.$$.fragment,g),Xe(u.$$.fragment,g),d=!1},d(g){dt(o,g),g&&W(l),dt(u,g)}}}function A6(h){let o,l,u,d,g,y,n,w;function T(I){h[23](I)}let M={data:h[2],unitX:h[9],unity:h[8]};return h[1]!==void 0&&(M.hoveredSector=h[1]),u=new x6({props:M}),cr.push(()=>zn(u,"hoveredSector",T)),{c(){o=He("div"),l=He("div"),ht(u.$$.fragment),g=bt(),y=He("div"),n=He("p"),this.h()},l(I){o=Ye(I,"DIV",{class:!0});var P=Ce(o);l=Ye(P,"DIV",{class:!0});var z=Ce(l);pt(u.$$.fragment,z),z.forEach(W),g=wt(P),y=Ye(P,"DIV",{class:!0});var R=Ce(y);n=Ye(R,"P",{});var F=Ce(n);F.forEach(W),R.forEach(W),P.forEach(W),this.h()},h(){H(l,"class","scenario-chart svelte-1mim542"),H(y,"class","quadrant-description svelte-1mim542"),H(o,"class","scenario-warming svelte-1mim542")},m(I,P){Me(I,o,P),de(o,l),ft(u,l,null),de(o,g),de(o,y),de(y,n),n.innerHTML=h[7],w=!0},p(I,P){const z={};P&4&&(z.data=I[2]),P&512&&(z.unitX=I[9]),P&256&&(z.unity=I[8]),!d&&P&2&&(d=!0,z.hoveredSector=I[1],Cn(()=>d=!1)),u.$set(z),(!w||P&128)&&(n.innerHTML=I[7])},i(I){w||(Le(u.$$.fragment,I),w=!0)},o(I){Xe(u.$$.fragment,I),w=!1},d(I){I&&W(o),dt(u)}}}function S6(h){let o,l,u,d,g,y,n;return u=new Dd({props:{data:h[5],unit:h[11],yLabel:"Global GHG emissions",ticksYHighlighted:[0],yTicks:4,xTicks:4}}),y=new Dd({props:{data:h[4],unit:h[10],yLabel:"Global mean temperature",yDomain:[1,3],ticksYHighlighted:[1],ticks:4,yTicks:4,xTicks:4}}),{c(){o=He("div"),l=He("div"),ht(u.$$.fragment),d=bt(),g=He("div"),ht(y.$$.fragment),this.h()},l(w){o=Ye(w,"DIV",{class:!0});var T=Ce(o);l=Ye(T,"DIV",{class:!0});var M=Ce(l);pt(u.$$.fragment,M),M.forEach(W),d=wt(T),g=Ye(T,"DIV",{class:!0});var I=Ce(g);pt(y.$$.fragment,I),I.forEach(W),T.forEach(W),this.h()},h(){H(l,"class","scenario-chart svelte-1mim542"),H(g,"class","scenario-chart svelte-1mim542"),H(o,"class","scenario-trajectories svelte-1mim542")},m(w,T){Me(w,o,T),de(o,l),ft(u,l,null),de(o,d),de(o,g),ft(y,g,null),n=!0},p(w,T){const M={};T&32&&(M.data=w[5]),T&2048&&(M.unit=w[11]),u.$set(M);const I={};T&16&&(I.data=w[4]),T&1024&&(I.unit=w[10]),y.$set(I)},i(w){n||(Le(u.$$.fragment,w),Le(y.$$.fragment,w),n=!0)},o(w){Xe(u.$$.fragment,w),Xe(y.$$.fragment,w),n=!1},d(w){w&&W(o),dt(u),dt(y)}}}function M6(h){let o,l,u,d;return o=new ao({props:{$$slots:{default:[A6]},$$scope:{ctx:h}}}),u=new ao({props:{$$slots:{default:[S6]},$$scope:{ctx:h}}}),{c(){ht(o.$$.fragment),l=bt(),ht(u.$$.fragment)},l(g){pt(o.$$.fragment,g),l=wt(g),pt(u.$$.fragment,g)},m(g,y){ft(o,g,y),Me(g,l,y),ft(u,g,y),d=!0},p(g,y){const n={};y&268436358&&(n.$$scope={dirty:y,ctx:g}),o.$set(n);const w={};y&268438576&&(w.$$scope={dirty:y,ctx:g}),u.$set(w)},i(g){d||(Le(o.$$.fragment,g),Le(u.$$.fragment,g),d=!0)},o(g){Xe(o.$$.fragment,g),Xe(u.$$.fragment,g),d=!1},d(g){dt(o,g),g&&W(l),dt(u,g)}}}function I6(h){let o,l,u,d,g,y,n,w,T,M,I,P,z=h[12],R=[];for(let ae=0;ae<z.length;ae+=1)R[ae]=Z0(q0(h,z,ae));const F=ae=>Xe(R[ae],1,1,()=>{R[ae]=null});let q=h[3]&&$0(h);return I=new Uu({props:{type:"nav",format:"compact",$$slots:{content:[M6],default:[T6]},$$scope:{ctx:h}}}),{c(){o=He("div"),l=He("span"),u=Oe("Select the warming scenario(s) you would like to explore"),d=bt(),g=He("div");for(let ae=0;ae<R.length;ae+=1)R[ae].c();y=bt(),n=He("div"),w=He("div"),q&&q.c(),M=bt(),ht(I.$$.fragment),this.h()},l(ae){o=Ye(ae,"DIV",{class:!0});var se=Ce(o);l=Ye(se,"SPAN",{class:!0});var ie=Ce(l);u=Fe(ie,"Select the warming scenario(s) you would like to explore"),ie.forEach(W),d=wt(se),g=Ye(se,"DIV",{class:!0});var Q=Ce(g);for(let $e=0;$e<R.length;$e+=1)R[$e].l(Q);Q.forEach(W),y=wt(se),n=Ye(se,"DIV",{class:!0});var re=Ce(n);w=Ye(re,"DIV",{class:!0,style:!0});var Ae=Ce(w);q&&q.l(Ae),Ae.forEach(W),M=wt(re),pt(I.$$.fragment,re),re.forEach(W),se.forEach(W),this.h()},h(){H(l,"class","intro svelte-1mim542"),H(g,"class","scenario-list"),H(w,"class","scenario-description svelte-1mim542"),H(w,"style",T=`height: ${h[6]}px;`),H(n,"class","scenario-split svelte-1mim542"),H(o,"class","scenario-selection svelte-1mim542")},m(ae,se){Me(ae,o,se),de(o,l),de(l,u),de(o,d),de(o,g);for(let ie=0;ie<R.length;ie+=1)R[ie].m(g,null);de(o,y),de(o,n),de(n,w),q&&q.m(w,null),de(n,M),ft(I,n,null),P=!0},p(ae,[se]){if(se&12289){z=ae[12];let Q;for(Q=0;Q<z.length;Q+=1){const re=q0(ae,z,Q);R[Q]?(R[Q].p(re,se),Le(R[Q],1)):(R[Q]=Z0(re),R[Q].c(),Le(R[Q],1),R[Q].m(g,null))}for(br(),Q=z.length;Q<R.length;Q+=1)F(Q);wr()}ae[3]?q?q.p(ae,se):(q=$0(ae),q.c(),q.m(w,null)):q&&(q.d(1),q=null),(!P||se&64&&T!==(T=`height: ${ae[6]}px;`))&&H(w,"style",T);const ie={};se&268439478&&(ie.$$scope={dirty:se,ctx:ae}),I.$set(ie)},i(ae){if(!P){for(let se=0;se<z.length;se+=1)Le(R[se]);Le(I.$$.fragment,ae),P=!0}},o(ae){R=R.filter(b6);for(let se=0;se<R.length;se+=1)Xe(R[se]);Xe(I.$$.fragment,ae),P=!1},d(ae){ae&&W(o),Br(R,ae),q&&q.d(),dt(I)}}}const W0="unitX",X0="unitY";function k6(h,o,l){let u,d,g,y,n,w,T,M,I,P,z,R,F,q,ae,se;xt(h,ly,Qe=>l(16,F=Qe)),xt(h,Yx,Qe=>l(17,q=Qe)),xt(h,Wa,Qe=>l(18,ae=Qe)),xt(h,Bu,Qe=>l(13,se=Qe));let ie=130,Q,re;const Ae={default:"See how scenarios compare when it comes to warming and overshooting 1.5\xB0C to 2050 and to 2100. Hover to learn more about the scenario categories.","high-overshoot":"<strong>High overshoot</strong> scenarios exceed 1.5\xB0C by more than 0.1\xB0C by 2050, but exhibit a decrease in global mean temperature in the second half of the 21st century. These scenarios are especially useful to see if climate impacts are reversible after warming has stopped and temperatures have been brought back down.","low-overshoot":"<strong>Low or no overshoot</strong> scenarios exceed 1.5\xB0C of warming level by at most 0.1\xB0C, and if so exhibit a decrease in global mean temperature in the second half of the 21st century. These scenarios are primarily used to explore climate impacts close to the 1.5\xB0C warming limit of the Paris Agreement.","high-warming":"Scenarios with <strong>high continuous warming</strong> exceed 1.5\xB0C of warming by 2050, and see further warming thereafter. They are useful to see the climate impacts that would result from high levels of global warming."};function $e(Qe){se=Qe,Bu.set(se)}const Je=Qe=>l(0,Q=Qe),ze=()=>l(0,Q=null);function Pe(){ie=this.clientHeight,l(6,ie)}function Ge(Qe){re=Qe,l(1,re)}return h.$$.update=()=>{var Qe,Rt;h.$$.dirty&262145&&l(3,u=Q||ae[0]),h.$$.dirty&131072&&l(15,[d,g]=v3(q,"isPrimary"),d,(l(14,g),l(17,q))),h.$$.dirty&49152&&l(12,y=m3([{isSpacer:!0,label:"Primary scenarios"},d,{isSpacer:!0,label:"Additional scenarios"},g])),h.$$.dirty&196616&&l(5,[n,w]=Kx.map(mt=>q.map(Ne=>{var $t;const At=($t=F[Ne.uid])==null?void 0:$t.color;return Ur(Xi({},Ne),{highlight:(u==null?void 0:u.uid)===Ne.uid,color:At,isSelected:Boolean(At),values:Ne[mt].data,unit:Ne[mt].unit})})),n,(l(4,w),l(17,q),l(16,F),l(3,u),l(0,Q),l(18,ae))),h.$$.dirty&32&&l(11,T=(Qe=n[0])==null?void 0:Qe.unit),h.$$.dirty&16&&l(10,M=(Rt=w[0])==null?void 0:Rt.unit),h.$$.dirty&196616&&l(2,I=q.map(mt=>{var At;const Ne=(At=F[mt.uid])==null?void 0:At.color;return Ur(Xi({},mt),{highlight:(u==null?void 0:u.uid)===mt.uid,color:Ne,isSelected:Boolean(Ne),x:mt.scenarioData["warming2050-2100"].data,y:mt.scenarioData.warming2050.data,[W0]:mt.scenarioData["warming2050-2100"].unit,[X0]:mt.scenarioData.warming2050.unit})})),h.$$.dirty&4&&l(9,[P,z]=[W0,X0].map(mt=>ja(I,[0,mt])),P,(l(8,z),l(2,I),l(17,q),l(16,F),l(3,u),l(0,Q),l(18,ae))),h.$$.dirty&2&&l(7,R=ja(Ae,re)||ja(Ae,"default"))},[Q,re,I,u,w,n,ie,R,z,P,M,T,y,se,g,d,F,q,ae,$e,Je,ze,Pe,Ge]}class C6 extends Jt{constructor(o){super(),Qt(this,o,k6,I6,ei,{})}}function z6(h){let o,l;return{c(){o=He("span"),l=Oe(h[6]),this.h()},l(u){o=Ye(u,"SPAN",{class:!0});var d=Ce(o);l=Fe(d,h[6]),d.forEach(W),this.h()},h(){H(o,"class","svelte-z07xl1")},m(u,d){Me(u,o,d),de(o,l)},p(u,d){d&64&&zt(l,u[6])},d(u){u&&W(o)}}}function P6(h){let o,l,u,d,g,y,n;const w=h[14].default,T=co(w,h,h[13],null),M=T||z6(h);let I=[h[11]],P={};for(let z=0;z<I.length;z+=1)P=Fi(P,I[z]);return{c(){o=He("div"),l=He("input"),u=bt(),d=He("label"),M&&M.c(),this.h()},l(z){o=Ye(z,"DIV",{});var R=Ce(o);l=Ye(R,"INPUT",{type:!0,id:!0,name:!0,class:!0}),u=wt(R),d=Ye(R,"LABEL",{for:!0,class:!0});var F=Ce(d);M&&M.l(F),F.forEach(W),R.forEach(W),this.h()},h(){H(l,"type","radio"),H(l,"id",h[7]),H(l,"name",h[8]),l.checked=h[0],l.disabled=h[3],l.required=h[4],l.value=h[2],H(l,"class","svelte-z07xl1"),Dt(l,"radio-button",!0),H(d,"for",h[7]),H(d,"class","svelte-z07xl1"),Dt(d,"radio-button__label",!0),Dt(d,"radio-button--is-selected",h[0]),Lr(o,P),Dt(o,"radio-button-wrapper",!0),Dt(o,"radio-button-wrapper--label-left",h[5]==="left"),Dt(o,"svelte-z07xl1",!0)},m(z,R){Me(z,o,R),de(o,l),h[16](l),de(o,u),de(o,d),M&&M.m(d,null),g=!0,y||(n=[Oi(l,"change",h[15]),Oi(l,"change",h[17])],y=!0)},p(z,[R]){(!g||R&128)&&H(l,"id",z[7]),(!g||R&256)&&H(l,"name",z[8]),(!g||R&1)&&(l.checked=z[0]),(!g||R&8)&&(l.disabled=z[3]),(!g||R&16)&&(l.required=z[4]),(!g||R&4)&&(l.value=z[2]),T?T.p&&(!g||R&8192)&&uo(T,w,z,z[13],g?po(w,z[13],R,null):ho(z[13]),null):M&&M.p&&(!g||R&64)&&M.p(z,g?R:-1),(!g||R&128)&&H(d,"for",z[7]),R&1&&Dt(d,"radio-button--is-selected",z[0]),Lr(o,P=yn(I,[R&2048&&z[11]])),Dt(o,"radio-button-wrapper",!0),Dt(o,"radio-button-wrapper--label-left",z[5]==="left"),Dt(o,"svelte-z07xl1",!0)},i(z){g||(Le(M,z),g=!0)},o(z){Xe(M,z),g=!1},d(z){z&&W(o),h[16](null),M&&M.d(z),y=!1,$s(n)}}}function D6(h,o,l){const u=["value","checked","disabled","required","labelPosition","labelText","id","name","ref"];let d=Rr(o,u),g,{$$slots:y={},$$scope:n}=o,{value:w=""}=o,{checked:T=!1}=o,{disabled:M=!1}=o,{required:I=!1}=o,{labelPosition:P="right"}=o,{labelText:z=""}=o,{id:R="ccs-"+Math.random().toString(36)}=o,{name:F=""}=o,{ref:q=null}=o;const ae=kr("RadioButtonGroup"),se=ae?ae.selectedValue:kn(T?w:void 0);xt(h,se,Ae=>l(12,g=Ae)),ae&&ae.add({id:R,checked:T,disabled:M,value:w});function ie(Ae){Vr.call(this,h,Ae)}function Q(Ae){cr[Ae?"unshift":"push"](()=>{q=Ae,l(1,q)})}const re=()=>{ae&&ae.update(w)};return h.$$set=Ae=>{o=Fi(Fi({},o),os(Ae)),l(11,d=Rr(o,u)),"value"in Ae&&l(2,w=Ae.value),"checked"in Ae&&l(0,T=Ae.checked),"disabled"in Ae&&l(3,M=Ae.disabled),"required"in Ae&&l(4,I=Ae.required),"labelPosition"in Ae&&l(5,P=Ae.labelPosition),"labelText"in Ae&&l(6,z=Ae.labelText),"id"in Ae&&l(7,R=Ae.id),"name"in Ae&&l(8,F=Ae.name),"ref"in Ae&&l(1,q=Ae.ref),"$$scope"in Ae&&l(13,n=Ae.$$scope)},h.$$.update=()=>{h.$$.dirty&4100&&l(0,T=g===w)},[T,q,w,M,I,P,z,R,F,ae,se,d,g,n,y,ie,Q,re]}class L6 extends Jt{constructor(o){super(),Qt(this,o,D6,P6,ei,{value:2,checked:0,disabled:3,required:4,labelPosition:5,labelText:6,id:7,name:8,ref:1})}}function R6(h){let o,l,u,d,g,y,n,w;const T=h[8].default,M=co(T,h,h[7],null);let I=[{id:h[1]},h[3]],P={};for(let z=0;z<I.length;z+=1)P=Fi(P,I[z]);return{c(){o=He("div"),l=He("fieldset"),u=He("legend"),d=Oe(h[0]),g=bt(),M&&M.c(),this.h()},l(z){o=Ye(z,"DIV",{id:!0});var R=Ce(o);l=Ye(R,"FIELDSET",{class:!0});var F=Ce(l);u=Ye(F,"LEGEND",{class:!0});var q=Ce(u);d=Fe(q,h[0]),q.forEach(W),g=wt(F),M&&M.l(F),F.forEach(W),R.forEach(W),this.h()},h(){H(u,"class","label text-label text-label--bold svelte-85n9jc"),H(l,"class","radio-button-group svelte-85n9jc"),Lr(o,P),Dt(o,"form-item",!0),Dt(o,"svelte-85n9jc",!0)},m(z,R){Me(z,o,R),de(o,l),de(l,u),de(u,d),de(l,g),M&&M.m(l,null),y=!0,n||(w=[Oi(o,"click",h[9]),Oi(o,"mouseover",h[10]),Oi(o,"mouseenter",h[11]),Oi(o,"mouseleave",h[12])],n=!0)},p(z,[R]){(!y||R&1)&&zt(d,z[0]),M&&M.p&&(!y||R&128)&&uo(M,T,z,z[7],y?po(T,z[7],R,null):ho(z[7]),null),Lr(o,P=yn(I,[(!y||R&2)&&{id:z[1]},R&8&&z[3]])),Dt(o,"form-item",!0),Dt(o,"svelte-85n9jc",!0)},i(z){y||(Le(M,z),y=!0)},o(z){Xe(M,z),y=!1},d(z){z&&W(o),M&&M.d(z),n=!1,$s(w)}}}function B6(h,o,l){const u=["selected","disabled","legendText","hideLegend","id"];let d=Rr(o,u),g,{$$slots:y={},$$scope:n}=o,{selected:w=void 0}=o,{disabled:T=!1}=o,{legendText:M=""}=o,{hideLegend:I=!1}=o,{id:P=void 0}=o;const z=sc(),R=kn(w);xt(h,R,ie=>l(13,g=ie)),qp("RadioButtonGroup",{selectedValue:R,add:({checked:ie,value:Q})=>{ie&&R.set(Q)},update:ie=>{l(4,w=ie)}}),Zp(()=>{X_(R,g=w,g)}),Px(()=>{X_(R,g=w,g)}),R.subscribe(ie=>{l(4,w=ie),z("change",ie)});function F(ie){Vr.call(this,h,ie)}function q(ie){Vr.call(this,h,ie)}function ae(ie){Vr.call(this,h,ie)}function se(ie){Vr.call(this,h,ie)}return h.$$set=ie=>{o=Fi(Fi({},o),os(ie)),l(3,d=Rr(o,u)),"selected"in ie&&l(4,w=ie.selected),"disabled"in ie&&l(5,T=ie.disabled),"legendText"in ie&&l(0,M=ie.legendText),"hideLegend"in ie&&l(6,I=ie.hideLegend),"id"in ie&&l(1,P=ie.id),"$$scope"in ie&&l(7,n=ie.$$scope)},[M,P,R,d,w,T,I,n,y,F,q,ae,se]}class O6 extends Jt{constructor(o){super(),Qt(this,o,B6,R6,ei,{selected:4,disabled:5,legendText:0,hideLegend:6,id:1})}}function F6(h){let o,l;return{c(){o=fi("path"),this.h()},l(u){o=di(u,"path",{class:!0,d:!0,fill:!0}),Ce(o).forEach(W),this.h()},h(){H(o,"class","path-area svelte-s5vsux"),H(o,"d",l=h[1](h[2])),H(o,"fill",h[0])},m(u,d){Me(u,o,d)},p(u,[d]){d&6&&l!==(l=u[1](u[2]))&&H(o,"d",l),d&1&&H(o,"fill",u[0])},i:ti,o:ti,d(u){u&&W(o)}}}function U6(h,o,l){let u,d,g,y,{y0Key:n="min"}=o,{y1Key:w="max"}=o,{color:T}=o;const{data:M,xGet:I,yScale:P}=kr("LayerCake");return xt(h,M,z=>l(2,y=z)),xt(h,I,z=>l(9,g=z)),xt(h,P,z=>l(8,d=z)),h.$$set=z=>{"y0Key"in z&&l(6,n=z.y0Key),"y1Key"in z&&l(7,w=z.y1Key),"color"in z&&l(0,T=z.color)},h.$$.update=()=>{h.$$.dirty&960&&l(1,u=n3().x(z=>g(z)).y0(z=>d(z[n])).y1(z=>d(z[w])))},[T,u,y,M,I,P,n,w,d,g]}class V6 extends Jt{constructor(o){super(),Qt(this,o,U6,F6,ei,{y0Key:6,y1Key:7,color:0})}}function N6(h){let o;return{c(){o=fi("path"),this.h()},l(l){o=di(l,"path",{class:!0,d:!0,style:!0}),Ce(o).forEach(W),this.h()},h(){H(o,"class","path-line svelte-1bf05h3"),H(o,"d",h[2]),lr(o,"stroke-width",h[1]),lr(o,"stroke",h[0])},m(l,u){Me(l,o,u)},p(l,[u]){u&4&&H(o,"d",l[2]),u&2&&lr(o,"stroke-width",l[1]),u&1&&lr(o,"stroke",l[0])},i:ti,o:ti,d(l){l&&W(o)}}}function j6(h,o,l){let u,d,g,y;const{data:n,xGet:w,yGet:T}=kr("LayerCake");xt(h,n,P=>l(8,y=P)),xt(h,w,P=>l(7,g=P)),xt(h,T,P=>l(6,d=P));let{color:M="#ab00d6"}=o,{strokeWidth:I=2}=o;return h.$$set=P=>{"color"in P&&l(0,M=P.color),"strokeWidth"in P&&l(1,I=P.strokeWidth)},h.$$.update=()=>{h.$$.dirty&448&&l(2,u="M"+y.map(P=>g(P)+","+d(P)).join("L"))},[M,I,u,n,w,T,d,g,y]}class G6 extends Jt{constructor(o){super(),Qt(this,o,j6,N6,ei,{color:0,strokeWidth:1})}}function q6(h){let o,l;return o=new Hp({props:{x:h[1],y:h[2],data:h[0][0].values,flatData:h[4](h[0]),$$slots:{default:[W6]},$$scope:{ctx:h}}}),{c(){ht(o.$$.fragment)},l(u){pt(o.$$.fragment,u)},m(u,d){ft(o,u,d),l=!0},p(u,d){const g={};d&2&&(g.x=u[1]),d&4&&(g.y=u[2]),d&1&&(g.data=u[0][0].values),d&1&&(g.flatData=u[4](u[0])),d&33&&(g.$$scope={dirty:d,ctx:u}),o.$set(g)},i(u){l||(Le(o.$$.fragment,u),l=!0)},o(u){Xe(o.$$.fragment,u),l=!1},d(u){dt(o,u)}}}function Z6(h){let o,l;return o=new Hp({props:{x:h[1],y:h[2],data:h[0],flatData:h[4](h[0]),$$slots:{default:[H6]},$$scope:{ctx:h}}}),{c(){ht(o.$$.fragment)},l(u){pt(o.$$.fragment,u)},m(u,d){ft(o,u,d),l=!0},p(u,d){const g={};d&2&&(g.x=u[1]),d&4&&(g.y=u[2]),d&1&&(g.data=u[0]),d&1&&(g.flatData=u[4](u[0])),d&32&&(g.$$scope={dirty:d,ctx:u}),o.$set(g)},i(u){l||(Le(o.$$.fragment,u),l=!0)},o(u){Xe(o.$$.fragment,u),l=!1},d(u){dt(o,u)}}}function $6(h){let o,l,u,d;return o=new V6({props:{color:h[0][0].color}}),u=new G6({props:{color:h[0][0].color}}),{c(){ht(o.$$.fragment),l=bt(),ht(u.$$.fragment)},l(g){pt(o.$$.fragment,g),l=wt(g),pt(u.$$.fragment,g)},m(g,y){ft(o,g,y),Me(g,l,y),ft(u,g,y),d=!0},p(g,y){const n={};y&1&&(n.color=g[0][0].color),o.$set(n);const w={};y&1&&(w.color=g[0][0].color),u.$set(w)},i(g){d||(Le(o.$$.fragment,g),Le(u.$$.fragment,g),d=!0)},o(g){Xe(o.$$.fragment,g),Xe(u.$$.fragment,g),d=!1},d(g){dt(o,g),g&&W(l),dt(u,g)}}}function W6(h){let o,l;return o=new Yp({props:{$$slots:{default:[$6]},$$scope:{ctx:h}}}),{c(){ht(o.$$.fragment)},l(u){pt(o.$$.fragment,u)},m(u,d){ft(o,u,d),l=!0},p(u,d){const g={};d&33&&(g.$$scope={dirty:d,ctx:u}),o.$set(g)},i(u){l||(Le(o.$$.fragment,u),l=!0)},o(u){Xe(o.$$.fragment,u),l=!1},d(u){dt(o,u)}}}function X6(h){let o,l;return o=new o3({}),{c(){ht(o.$$.fragment)},l(u){pt(o.$$.fragment,u)},m(u,d){ft(o,u,d),l=!0},i(u){l||(Le(o.$$.fragment,u),l=!0)},o(u){Xe(o.$$.fragment,u),l=!1},d(u){dt(o,u)}}}function H6(h){let o,l;return o=new Yp({props:{$$slots:{default:[X6]},$$scope:{ctx:h}}}),{c(){ht(o.$$.fragment)},l(u){pt(o.$$.fragment,u)},m(u,d){ft(o,u,d),l=!0},p(u,d){const g={};d&32&&(g.$$scope={dirty:d,ctx:u}),o.$set(g)},i(u){l||(Le(o.$$.fragment,u),l=!0)},o(u){Xe(o.$$.fragment,u),l=!1},d(u){dt(o,u)}}}function Y6(h){let o,l,u,d;const g=[Z6,q6],y=[];function n(w,T){return w[3]?0:1}return l=n(h),u=y[l]=g[l](h),{c(){o=He("div"),u.c(),this.h()},l(w){o=Ye(w,"DIV",{class:!0});var T=Ce(o);u.l(T),T.forEach(W),this.h()},h(){H(o,"class","chart-container svelte-1kk0jbq")},m(w,T){Me(w,o,T),y[l].m(o,null),d=!0},p(w,[T]){let M=l;l=n(w),l===M?y[l].p(w,T):(br(),Xe(y[M],1,1,()=>{y[M]=null}),wr(),u=y[l],u?u.p(w,T):(u=y[l]=g[l](w),u.c()),Le(u,1),u.m(o,null))},i(w){d||(Le(u),d=!0)},o(w){Xe(u),d=!1},d(w){w&&W(o),y[l].d()}}}function K6(h,o,l){let u,{data:d=[]}=o,{xKey:g="year"}=o,{yKey:y="value"}=o;const n=w=>w.reduce((T,M)=>(M.values.forEach(({min:I,value:P,max:z,year:R})=>{T.push({year:R,value:I}),T.push({year:R,value:P}),T.push({year:R,value:z})}),T),[]);return h.$$set=w=>{"data"in w&&l(0,d=w.data),"xKey"in w&&l(1,g=w.xKey),"yKey"in w&&l(2,y=w.yKey)},h.$$.update=()=>{h.$$.dirty&1&&l(3,u=d.length>1)},[d,g,y,u,n]}class J6 extends Jt{constructor(o){super(),Qt(this,o,K6,Y6,ei,{data:0,xKey:1,yKey:2})}}function H0(h,o,l){const u=h.slice();return u[11]=o[l],u}function Q6(h){let o,l=h[11].label+"",u,d,g,y,n,w;return y=new J6({props:{data:h[11].scenarios}}),{c(){o=He("span"),u=Oe(l),d=bt(),g=He("div"),ht(y.$$.fragment),n=bt(),this.h()},l(T){o=Ye(T,"SPAN",{});var M=Ce(o);u=Fe(M,l),M.forEach(W),d=wt(T),g=Ye(T,"DIV",{class:!0});var I=Ce(g);pt(y.$$.fragment,I),I.forEach(W),n=wt(T),this.h()},h(){H(g,"class","preview-chart svelte-h5olbi")},m(T,M){Me(T,o,M),de(o,u),Me(T,d,M),Me(T,g,M),ft(y,g,null),Me(T,n,M),w=!0},p(T,M){(!w||M&1024)&&l!==(l=T[11].label+"")&&zt(u,l);const I={};M&1024&&(I.data=T[11].scenarios),y.$set(I)},i(T){w||(Le(y.$$.fragment,T),w=!0)},o(T){Xe(y.$$.fragment,T),w=!1},d(T){T&&W(o),T&&W(d),T&&W(g),dt(y),T&&W(n)}}}function Y0(h){let o,l;return o=new L6({props:{labelText:h[11].label,value:h[11].uid,$$slots:{default:[Q6]},$$scope:{ctx:h}}}),{c(){ht(o.$$.fragment)},l(u){pt(o.$$.fragment,u)},m(u,d){ft(o,u,d),l=!0},p(u,d){const g={};d&1024&&(g.labelText=u[11].label),d&1024&&(g.value=u[11].uid),d&17408&&(g.$$scope={dirty:d,ctx:u}),o.$set(g)},i(u){l||(Le(o.$$.fragment,u),l=!0)},o(u){Xe(o.$$.fragment,u),l=!1},d(u){dt(o,u)}}}function e8(h){let o,l,u=h[10],d=[];for(let y=0;y<u.length;y+=1)d[y]=Y0(H0(h,u,y));const g=y=>Xe(d[y],1,1,()=>{d[y]=null});return{c(){for(let y=0;y<d.length;y+=1)d[y].c();o=Gi()},l(y){for(let n=0;n<d.length;n+=1)d[n].l(y);o=Gi()},m(y,n){for(let w=0;w<d.length;w+=1)d[w].m(y,n);Me(y,o,n),l=!0},p(y,n){if(n&1024){u=y[10];let w;for(w=0;w<u.length;w+=1){const T=H0(y,u,w);d[w]?(d[w].p(T,n),Le(d[w],1)):(d[w]=Y0(T),d[w].c(),Le(d[w],1),d[w].m(o.parentNode,o))}for(br(),w=u.length;w<d.length;w+=1)g(w);wr()}},i(y){if(!l){for(let n=0;n<u.length;n+=1)Le(d[n]);l=!0}},o(y){d=d.filter(Boolean);for(let n=0;n<d.length;n+=1)Xe(d[n]);l=!1},d(y){Br(d,y),y&&W(o)}}}function t8(h){let o,l,u,d;function g(n){h[9](n)}let y={legendText:"Indicators",$$slots:{default:[e8]},$$scope:{ctx:h}};return h[3]!==void 0&&(y.selected=h[3]),l=new O6({props:y}),cr.push(()=>zn(l,"selected",g)),{c(){o=He("div"),ht(l.$$.fragment),this.h()},l(n){o=Ye(n,"DIV",{class:!0});var w=Ce(o);pt(l.$$.fragment,w),w.forEach(W),this.h()},h(){H(o,"class","indicator-selection")},m(n,w){Me(n,o,w),ft(l,o,null),d=!0},p(n,w){const T={};w&17408&&(T.$$scope={dirty:w,ctx:n}),!u&&w&8&&(u=!0,T.selected=n[3],Cn(()=>u=!1)),l.$set(T)},i(n){d||(Le(l.$$.fragment,n),d=!0)},o(n){Xe(l.$$.fragment,n),d=!1},d(n){n&&W(o),dt(l)}}}function i8(h){let o,l;return o=new Xp({props:{asyncProps:{impactTimeData:h[1]},props:{currentScenarios:h[2]},process:h[0],$$slots:{default:[t8,({asyncProps:{indicatorData:u}})=>({10:u}),({asyncProps:u})=>u?1024:0]},$$scope:{ctx:h}}}),{c(){ht(o.$$.fragment)},l(u){pt(o.$$.fragment,u)},m(u,d){ft(o,u,d),l=!0},p(u,[d]){const g={};d&2&&(g.asyncProps={impactTimeData:u[1]}),d&4&&(g.props={currentScenarios:u[2]}),d&1&&(g.process=u[0]),d&17416&&(g.$$scope={dirty:d,ctx:u}),o.$set(g)},i(u){l||(Le(o.$$.fragment,u),l=!0)},o(u){Xe(o.$$.fragment,u),l=!1},d(u){dt(o,u)}}}function r8(h,o,l){let u,d,g,y,n,w,T;xt(h,Jx,z=>l(6,d=z)),xt(h,Pd,z=>l(7,g=z)),xt(h,Bu,z=>l(8,y=z)),xt(h,Wa,z=>l(2,w=z)),xt(h,Cd,z=>l(3,T=z));let{indicators:M=[]}=o,I=kn([]);xt(h,I,z=>l(1,n=z));function P(z){T=z,Cd.set(T)}return h.$$set=z=>{"indicators"in z&&l(5,M=z.indicators)},h.$$.update=()=>{h.$$.dirty&448&&Fu(I,y.map(z=>({endpoint:sy,params:{geography:g,scenario:z,indicator:d.map(R=>R.uid)}}))),h.$$.dirty&32&&l(0,u=({impactTimeData:z},{currentScenarios:R})=>({indicatorData:M.map(q=>{const ae=z.map((se,ie)=>{var Ae;const{data:Q}=se,re=R[ie];return Ur(Xi({},re),{values:((Ae=Q.data[q.uid])==null?void 0:Ae.map(($e,Je)=>({year:Q.yearStart+Q.yearStep*Je,min:$e[0],value:$e[1],max:$e[2]})))||[]})});return Ur(Xi({},q),{scenarios:ae})})}))},[u,n,w,T,I,M,d,g,y,P]}class n8 extends Jt{constructor(o){super(),Qt(this,o,r8,i8,ei,{indicators:5})}}function K0(h,o,l){const u=h.slice();return u[5]=o[l],u}function J0(h){let o,l,u,d;const g=[h[5]];let y={};for(let n=0;n<g.length;n+=1)y=Fi(y,g[n]);return l=new d1({props:y}),l.$on("change",h[2]),{c(){o=He("div"),ht(l.$$.fragment),u=bt(),this.h()},l(n){o=Ye(n,"DIV",{class:!0});var w=Ce(o);pt(l.$$.fragment,w),u=wt(w),w.forEach(W),this.h()},h(){H(o,"class","parameter svelte-plzc4w")},m(n,w){Me(n,o,w),ft(l,o,null),de(o,u),d=!0},p(n,w){const T=w&1?yn(g,[Na(n[5])]):{};l.$set(T)},i(n){d||(Le(l.$$.fragment,n),d=!0)},o(n){Xe(l.$$.fragment,n),d=!1},d(n){n&&W(o),dt(l)}}}function o8(h){let o,l,u,d=h[1].label+"",g,y,n,w,T=h[0],M=[];for(let P=0;P<T.length;P+=1)M[P]=J0(K0(h,T,P));const I=P=>Xe(M[P],1,1,()=>{M[P]=null});return{c(){o=He("div"),l=He("div"),u=Oe("Options for "),g=Oe(d),y=bt(),n=He("div");for(let P=0;P<M.length;P+=1)M[P].c();this.h()},l(P){o=Ye(P,"DIV",{class:!0});var z=Ce(o);l=Ye(z,"DIV",{class:!0});var R=Ce(l);u=Fe(R,"Options for "),g=Fe(R,d),R.forEach(W),y=wt(z),n=Ye(z,"DIV",{class:!0});var F=Ce(n);for(let q=0;q<M.length;q+=1)M[q].l(F);F.forEach(W),z.forEach(W),this.h()},h(){H(l,"class","label svelte-plzc4w"),H(n,"class","parameters svelte-plzc4w"),H(o,"class","wrapper svelte-plzc4w")},m(P,z){Me(P,o,z),de(o,l),de(l,u),de(l,g),de(o,y),de(o,n);for(let R=0;R<M.length;R+=1)M[R].m(n,null);w=!0},p(P,[z]){if((!w||z&2)&&d!==(d=P[1].label+"")&&zt(g,d),z&5){T=P[0];let R;for(R=0;R<T.length;R+=1){const F=K0(P,T,R);M[R]?(M[R].p(F,z),Le(M[R],1)):(M[R]=J0(F),M[R].c(),Le(M[R],1),M[R].m(n,null))}for(br(),R=T.length;R<M.length;R+=1)I(R);wr()}},i(P){if(!w){for(let z=0;z<T.length;z+=1)Le(M[z]);w=!0}},o(P){M=M.filter(Boolean);for(let z=0;z<M.length;z+=1)Xe(M[z]);w=!1},d(P){P&&W(o),Br(M,P)}}}function s8(h,o,l){let u,d,g,y;xt(h,Ru,w=>l(3,d=w)),xt(h,Qx,w=>l(4,g=w)),xt(h,$a,w=>l(1,y=w));function n({detail:{key:w,value:T}}){Ru.update(M=>Ur(Xi({},M),{[w]:T}))}return h.$$.update=()=>{h.$$.dirty&24&&l(0,u=g.map(w=>{let T=ja(d,w.uid);return Ur(Xi({},w),{value:T})}).filter(w=>w.options.length>1))},[u,y,n,d,g]}class a8 extends Jt{constructor(o){super(),Qt(this,o,s8,o8,ei,{})}}function Q0(h,o,l){const u=h.slice();return u[6]=o[l].icon,u[7]=o[l].label,u[8]=o[l].disabled,u}function ey(h,o,l){const u=h.slice();return u[3]=o[l].indicators,u}function ty(h){let o,l;return o=new Gs({props:{label:h[7],icon:h[6],disabled:h[8]}}),{c(){ht(o.$$.fragment)},l(u){pt(o.$$.fragment,u)},m(u,d){ft(o,u,d),l=!0},p(u,d){const g={};d&1&&(g.label=u[7]),d&1&&(g.icon=u[6]),d&1&&(g.disabled=u[8]),o.$set(g)},i(u){l||(Le(o.$$.fragment,u),l=!0)},o(u){Xe(o.$$.fragment,u),l=!1},d(u){dt(o,u)}}}function l8(h){let o,l,u,d,g,y=h[0],n=[];for(let T=0;T<y.length;T+=1)n[T]=ty(Q0(h,y,T));const w=T=>Xe(n[T],1,1,()=>{n[T]=null});return{c(){o=He("span"),l=Oe("Sectors"),u=bt();for(let T=0;T<n.length;T+=1)n[T].c();d=Gi(),this.h()},l(T){o=Ye(T,"SPAN",{class:!0});var M=Ce(o);l=Fe(M,"Sectors"),M.forEach(W),u=wt(T);for(let I=0;I<n.length;I+=1)n[I].l(T);d=Gi(),this.h()},h(){H(o,"class","text-label text-label--bold")},m(T,M){Me(T,o,M),de(o,l),Me(T,u,M);for(let I=0;I<n.length;I+=1)n[I].m(T,M);Me(T,d,M),g=!0},p(T,M){if(M&1){y=T[0];let I;for(I=0;I<y.length;I+=1){const P=Q0(T,y,I);n[I]?(n[I].p(P,M),Le(n[I],1)):(n[I]=ty(P),n[I].c(),Le(n[I],1),n[I].m(d.parentNode,d))}for(br(),I=y.length;I<n.length;I+=1)w(I);wr()}},i(T){if(!g){for(let M=0;M<y.length;M+=1)Le(n[M]);g=!0}},o(T){n=n.filter(Boolean);for(let M=0;M<n.length;M+=1)Xe(n[M]);g=!1},d(T){T&&W(o),T&&W(u),Br(n,T),T&&W(d)}}}function c8(h){let o,l,u;return o=new n8({props:{indicators:h[3]}}),{c(){ht(o.$$.fragment),l=bt()},l(d){pt(o.$$.fragment,d),l=wt(d)},m(d,g){ft(o,d,g),Me(d,l,g),u=!0},p(d,g){const y={};g&1&&(y.indicators=d[3]),o.$set(y)},i(d){u||(Le(o.$$.fragment,d),u=!0)},o(d){Xe(o.$$.fragment,d),u=!1},d(d){dt(o,d),d&&W(l)}}}function iy(h){let o,l;return o=new ao({props:{$$slots:{default:[c8]},$$scope:{ctx:h}}}),{c(){ht(o.$$.fragment)},l(u){pt(o.$$.fragment,u)},m(u,d){ft(o,u,d),l=!0},p(u,d){const g={};d&2049&&(g.$$scope={dirty:d,ctx:u}),o.$set(g)},i(u){l||(Le(o.$$.fragment,u),l=!0)},o(u){Xe(o.$$.fragment,u),l=!1},d(u){dt(o,u)}}}function u8(h){let o,l,u=h[0],d=[];for(let y=0;y<u.length;y+=1)d[y]=iy(ey(h,u,y));const g=y=>Xe(d[y],1,1,()=>{d[y]=null});return{c(){for(let y=0;y<d.length;y+=1)d[y].c();o=Gi()},l(y){for(let n=0;n<d.length;n+=1)d[n].l(y);o=Gi()},m(y,n){for(let w=0;w<d.length;w+=1)d[w].m(y,n);Me(y,o,n),l=!0},p(y,n){if(n&1){u=y[0];let w;for(w=0;w<u.length;w+=1){const T=ey(y,u,w);d[w]?(d[w].p(T,n),Le(d[w],1)):(d[w]=iy(T),d[w].c(),Le(d[w],1),d[w].m(o.parentNode,o))}for(br(),w=u.length;w<d.length;w+=1)g(w);wr()}},i(y){if(!l){for(let n=0;n<u.length;n+=1)Le(d[n]);l=!0}},o(y){d=d.filter(Boolean);for(let n=0;n<d.length;n+=1)Xe(d[n]);l=!1},d(y){Br(d,y),y&&W(o)}}}function h8(h){let o,l,u,d,g,y,n,w,T;return g=new Uu({props:{$$slots:{content:[u8],default:[l8]},$$scope:{ctx:h}}}),w=new a8({}),{c(){o=He("div"),l=He("span"),u=Oe("Select an indicator to explore"),d=bt(),ht(g.$$.fragment),y=bt(),n=He("div"),ht(w.$$.fragment),this.h()},l(M){o=Ye(M,"DIV",{class:!0});var I=Ce(o);l=Ye(I,"SPAN",{class:!0});var P=Ce(l);u=Fe(P,"Select an indicator to explore"),P.forEach(W),d=wt(I),pt(g.$$.fragment,I),I.forEach(W),y=wt(M),n=Ye(M,"DIV",{class:!0});var z=Ce(n);pt(w.$$.fragment,z),z.forEach(W),this.h()},h(){H(l,"class","intro svelte-1wrbacp"),H(o,"class","indicator-selection svelte-1wrbacp"),H(n,"class","indicator-parameters svelte-1wrbacp")},m(M,I){Me(M,o,I),de(o,l),de(l,u),de(o,d),ft(g,o,null),Me(M,y,I),Me(M,n,I),ft(w,n,null),T=!0},p(M,[I]){const P={};I&2049&&(P.$$scope={dirty:I,ctx:M}),g.$set(P)},i(M){T||(Le(g.$$.fragment,M),Le(w.$$.fragment,M),T=!0)},o(M){Xe(g.$$.fragment,M),Xe(w.$$.fragment,M),T=!1},d(M){M&&W(o),dt(g),M&&W(y),M&&W(n),dt(w)}}}function p8(h,o,l){let u,d,g;return xt(h,e3,y=>l(1,d=y)),xt(h,t3,y=>l(2,g=y)),h.$$.update=()=>{h.$$.dirty&6&&l(0,u=g.map(y=>{const n=d.filter(w=>w.sector===y.uid);return Ur(Xi({},y),{disabled:n.length===0,indicators:n})}))},[u,d,g]}class f8 extends Jt{constructor(o){super(),Qt(this,o,p8,h8,ei,{})}}function d8(h){var n,w;let o,l,u,d,g,y;return o=new bd({props:{label:"Geography",selectedValues:((n=h[0])==null?void 0:n.label)||null,missingValue:"Select a geography"}}),u=new bd({props:{label:"Scenarios",selectedValues:h[1].map(ry),missingValue:"Select at least one scenario",disabled:h[0]===null}}),g=new bd({props:{label:"Indicator",selectedValues:((w=h[2])==null?void 0:w.label)||null,missingValue:"Select an indicator",disabled:h[1].length===0}}),{c(){ht(o.$$.fragment),l=bt(),ht(u.$$.fragment),d=bt(),ht(g.$$.fragment)},l(T){pt(o.$$.fragment,T),l=wt(T),pt(u.$$.fragment,T),d=wt(T),pt(g.$$.fragment,T)},m(T,M){ft(o,T,M),Me(T,l,M),ft(u,T,M),Me(T,d,M),ft(g,T,M),y=!0},p(T,M){var R,F;const I={};M&1&&(I.selectedValues=((R=T[0])==null?void 0:R.label)||null),o.$set(I);const P={};M&2&&(P.selectedValues=T[1].map(ry)),M&1&&(P.disabled=T[0]===null),u.$set(P);const z={};M&4&&(z.selectedValues=((F=T[2])==null?void 0:F.label)||null),M&2&&(z.disabled=T[1].length===0),g.$set(z)},i(T){y||(Le(o.$$.fragment,T),Le(u.$$.fragment,T),Le(g.$$.fragment,T),y=!0)},o(T){Xe(o.$$.fragment,T),Xe(u.$$.fragment,T),Xe(g.$$.fragment,T),y=!1},d(T){dt(o,T),T&&W(l),dt(u,T),T&&W(d),dt(g,T)}}}function m8(h){let o,l;return o=new e6({}),{c(){ht(o.$$.fragment)},l(u){pt(o.$$.fragment,u)},m(u,d){ft(o,u,d),l=!0},i(u){l||(Le(o.$$.fragment,u),l=!0)},o(u){Xe(o.$$.fragment,u),l=!1},d(u){dt(o,u)}}}function _8(h){let o,l;return o=new C6({}),{c(){ht(o.$$.fragment)},l(u){pt(o.$$.fragment,u)},m(u,d){ft(o,u,d),l=!0},i(u){l||(Le(o.$$.fragment,u),l=!0)},o(u){Xe(o.$$.fragment,u),l=!1},d(u){dt(o,u)}}}function g8(h){let o,l;return o=new f8({}),{c(){ht(o.$$.fragment)},l(u){pt(o.$$.fragment,u)},m(u,d){ft(o,u,d),l=!0},i(u){l||(Le(o.$$.fragment,u),l=!0)},o(u){Xe(o.$$.fragment,u),l=!1},d(u){dt(o,u)}}}function y8(h){let o,l,u,d,g,y;return o=new ao({props:{$$slots:{default:[m8]},$$scope:{ctx:h}}}),u=new ao({props:{$$slots:{default:[_8]},$$scope:{ctx:h}}}),g=new ao({props:{$$slots:{default:[g8]},$$scope:{ctx:h}}}),{c(){ht(o.$$.fragment),l=bt(),ht(u.$$.fragment),d=bt(),ht(g.$$.fragment)},l(n){pt(o.$$.fragment,n),l=wt(n),pt(u.$$.fragment,n),d=wt(n),pt(g.$$.fragment,n)},m(n,w){ft(o,n,w),Me(n,l,w),ft(u,n,w),Me(n,d,w),ft(g,n,w),y=!0},p(n,w){const T={};w&8&&(T.$$scope={dirty:w,ctx:n}),o.$set(T);const M={};w&8&&(M.$$scope={dirty:w,ctx:n}),u.$set(M);const I={};w&8&&(I.$$scope={dirty:w,ctx:n}),g.$set(I)},i(n){y||(Le(o.$$.fragment,n),Le(u.$$.fragment,n),Le(g.$$.fragment,n),y=!0)},o(n){Xe(o.$$.fragment,n),Xe(u.$$.fragment,n),Xe(g.$$.fragment,n),y=!1},d(n){dt(o,n),n&&W(l),dt(u,n),n&&W(d),dt(g,n)}}}function v8(h){let o,l,u,d,g,y,n,w;return o=new Gs({props:{label:"Impact overview"}}),u=new Gs({props:{label:"(Un)avoidable risk"}}),g=new Gs({props:{label:"Mitigation benefits",disabled:!0}}),n=new Gs({props:{label:"Reversibility",disabled:!0}}),{c(){ht(o.$$.fragment),l=bt(),ht(u.$$.fragment),d=bt(),ht(g.$$.fragment),y=bt(),ht(n.$$.fragment)},l(T){pt(o.$$.fragment,T),l=wt(T),pt(u.$$.fragment,T),d=wt(T),pt(g.$$.fragment,T),y=wt(T),pt(n.$$.fragment,T)},m(T,M){ft(o,T,M),Me(T,l,M),ft(u,T,M),Me(T,d,M),ft(g,T,M),Me(T,y,M),ft(n,T,M),w=!0},p:ti,i(T){w||(Le(o.$$.fragment,T),Le(u.$$.fragment,T),Le(g.$$.fragment,T),Le(n.$$.fragment,T),w=!0)},o(T){Xe(o.$$.fragment,T),Xe(u.$$.fragment,T),Xe(g.$$.fragment,T),Xe(n.$$.fragment,T),w=!1},d(T){dt(o,T),T&&W(l),dt(u,T),T&&W(d),dt(g,T),T&&W(y),dt(n,T)}}}function x8(h){let o,l;return o=new f5({}),{c(){ht(o.$$.fragment)},l(u){pt(o.$$.fragment,u)},m(u,d){ft(o,u,d),l=!0},i(u){l||(Le(o.$$.fragment,u),l=!0)},o(u){Xe(o.$$.fragment,u),l=!1},d(u){dt(o,u)}}}function b8(h){let o,l;return o=new j5({}),{c(){ht(o.$$.fragment)},l(u){pt(o.$$.fragment,u)},m(u,d){ft(o,u,d),l=!0},i(u){l||(Le(o.$$.fragment,u),l=!0)},o(u){Xe(o.$$.fragment,u),l=!1},d(u){dt(o,u)}}}function w8(h){let o,l;return o=new Z5({}),{c(){ht(o.$$.fragment)},l(u){pt(o.$$.fragment,u)},m(u,d){ft(o,u,d),l=!0},i(u){l||(Le(o.$$.fragment,u),l=!0)},o(u){Xe(o.$$.fragment,u),l=!1},d(u){dt(o,u)}}}function E8(h){let o,l;return o=new X5({}),{c(){ht(o.$$.fragment)},l(u){pt(o.$$.fragment,u)},m(u,d){ft(o,u,d),l=!0},i(u){l||(Le(o.$$.fragment,u),l=!0)},o(u){Xe(o.$$.fragment,u),l=!1},d(u){dt(o,u)}}}function T8(h){let o,l,u,d,g,y,n,w;return o=new ao({props:{$$slots:{default:[x8]},$$scope:{ctx:h}}}),u=new ao({props:{$$slots:{default:[b8]},$$scope:{ctx:h}}}),g=new ao({props:{$$slots:{default:[w8]},$$scope:{ctx:h}}}),n=new ao({props:{$$slots:{default:[E8]},$$scope:{ctx:h}}}),{c(){ht(o.$$.fragment),l=bt(),ht(u.$$.fragment),d=bt(),ht(g.$$.fragment),y=bt(),ht(n.$$.fragment)},l(T){pt(o.$$.fragment,T),l=wt(T),pt(u.$$.fragment,T),d=wt(T),pt(g.$$.fragment,T),y=wt(T),pt(n.$$.fragment,T)},m(T,M){ft(o,T,M),Me(T,l,M),ft(u,T,M),Me(T,d,M),ft(g,T,M),Me(T,y,M),ft(n,T,M),w=!0},p(T,M){const I={};M&8&&(I.$$scope={dirty:M,ctx:T}),o.$set(I);const P={};M&8&&(P.$$scope={dirty:M,ctx:T}),u.$set(P);const z={};M&8&&(z.$$scope={dirty:M,ctx:T}),g.$set(z);const R={};M&8&&(R.$$scope={dirty:M,ctx:T}),n.$set(R)},i(T){w||(Le(o.$$.fragment,T),Le(u.$$.fragment,T),Le(g.$$.fragment,T),Le(n.$$.fragment,T),w=!0)},o(T){Xe(o.$$.fragment,T),Xe(u.$$.fragment,T),Xe(g.$$.fragment,T),Xe(n.$$.fragment,T),w=!1},d(T){dt(o,T),T&&W(l),dt(u,T),T&&W(d),dt(g,T),T&&W(y),dt(n,T)}}}function A8(h){let o,l,u,d,g,y,n,w,T,M,I,P,z,R,F;return M=new Uu({props:{type:"menu",$$slots:{content:[y8],default:[d8]},$$scope:{ctx:h}}}),R=new Uu({props:{type:"nav",selected:0,$$slots:{content:[T8],default:[v8]},$$scope:{ctx:h}}}),{c(){o=bt(),l=He("div"),u=He("div"),d=He("div"),g=He("p"),y=Oe(`Explore how different levels of climate action will lead to different
        climate impacts for countries, cities, and more. See where risk
        escalates and under what conditions impacts could be avoided.`),n=bt(),w=He("div"),T=He("div"),ht(M.$$.fragment),I=bt(),P=He("div"),z=He("div"),ht(R.$$.fragment),this.h()},l(q){Dx('[data-svelte="svelte-7311ap"]',document.head).forEach(W),o=wt(q),l=Ye(q,"DIV",{class:!0});var se=Ce(l);u=Ye(se,"DIV",{class:!0});var ie=Ce(u);d=Ye(ie,"DIV",{class:!0});var Q=Ce(d);g=Ye(Q,"P",{class:!0});var re=Ce(g);y=Fe(re,`Explore how different levels of climate action will lead to different
        climate impacts for countries, cities, and more. See where risk
        escalates and under what conditions impacts could be avoided.`),re.forEach(W),Q.forEach(W),ie.forEach(W),se.forEach(W),n=wt(q),w=Ye(q,"DIV",{class:!0});var Ae=Ce(w);T=Ye(Ae,"DIV",{class:!0});var $e=Ce(T);pt(M.$$.fragment,$e),$e.forEach(W),Ae.forEach(W),I=wt(q),P=Ye(q,"DIV",{class:!0});var Je=Ce(P);z=Ye(Je,"DIV",{class:!0});var ze=Ce(z);pt(R.$$.fragment,ze),ze.forEach(W),Je.forEach(W),this.h()},h(){document.title="Explore Impacts",H(g,"class","explore-description svelte-1mrvt4s"),H(d,"class","explore-intro"),H(u,"class","wrapper"),H(l,"class","impacts-header container svelte-1mrvt4s"),H(T,"class","wrapper"),H(w,"class","impacts-selection container svelte-1mrvt4s"),H(z,"class","wrapper"),H(P,"class","impacts-analysis container")},m(q,ae){Me(q,o,ae),Me(q,l,ae),de(l,u),de(u,d),de(d,g),de(g,y),Me(q,n,ae),Me(q,w,ae),de(w,T),ft(M,T,null),Me(q,I,ae),Me(q,P,ae),de(P,z),ft(R,z,null),F=!0},p(q,[ae]){const se={};ae&15&&(se.$$scope={dirty:ae,ctx:q}),M.$set(se);const ie={};ae&8&&(ie.$$scope={dirty:ae,ctx:q}),R.$set(ie)},i(q){F||(Le(M.$$.fragment,q),Le(R.$$.fragment,q),F=!0)},o(q){Xe(M.$$.fragment,q),Xe(R.$$.fragment,q),F=!1},d(q){q&&W(o),q&&W(l),q&&W(n),q&&W(w),dt(M),q&&W(I),q&&W(P),dt(R)}}}const ry=h=>h.label;function S8(h,o,l){let u,d,g;return xt(h,ac,y=>l(0,u=y)),xt(h,Wa,y=>l(1,d=y)),xt(h,$a,y=>l(2,g=y)),[u,d,g]}class N8 extends Jt{constructor(o){super(),Qt(this,o,S8,A8,ei,{})}}export{N8 as default};
